function _mergeNamespaces(o,s){for(var a=0;a<s.length;a++){const et=s[a];if(typeof et!="string"&&!Array.isArray(et)){for(const tt in et)if(tt!=="default"&&!(tt in o)){const rt=Object.getOwnPropertyDescriptor(et,tt);rt&&Object.defineProperty(o,tt,rt.get?rt:{enumerable:!0,get:()=>et[tt]})}}}return Object.freeze(Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}))}(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const tt of document.querySelectorAll('link[rel="modulepreload"]'))et(tt);new MutationObserver(tt=>{for(const rt of tt)if(rt.type==="childList")for(const nt of rt.addedNodes)nt.tagName==="LINK"&&nt.rel==="modulepreload"&&et(nt)}).observe(document,{childList:!0,subtree:!0});function a(tt){const rt={};return tt.integrity&&(rt.integrity=tt.integrity),tt.referrerPolicy&&(rt.referrerPolicy=tt.referrerPolicy),tt.crossOrigin==="use-credentials"?rt.credentials="include":tt.crossOrigin==="anonymous"?rt.credentials="omit":rt.credentials="same-origin",rt}function et(tt){if(tt.ep)return;tt.ep=!0;const rt=a(tt);fetch(tt.href,rt)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs$2(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}function getAugmentedNamespace(o){if(o.__esModule)return o;var s=o.default;if(typeof s=="function"){var a=function et(){return this instanceof et?Reflect.construct(s,arguments,this.constructor):s.apply(this,arguments)};a.prototype=s.prototype}else a={};return Object.defineProperty(a,"__esModule",{value:!0}),Object.keys(o).forEach(function(et){var tt=Object.getOwnPropertyDescriptor(o,et);Object.defineProperty(a,et,tt.get?tt:{enumerable:!0,get:function(){return o[et]}})}),a}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$3=Symbol.for("react.element"),n$3=Symbol.for("react.portal"),p$4=Symbol.for("react.fragment"),q$4=Symbol.for("react.strict_mode"),r$2=Symbol.for("react.profiler"),t$2=Symbol.for("react.provider"),u$1=Symbol.for("react.context"),v$5=Symbol.for("react.forward_ref"),w$3=Symbol.for("react.suspense"),x$2=Symbol.for("react.memo"),y$2=Symbol.for("react.lazy"),z$3=Symbol.iterator;function A$2(o){return o===null||typeof o!="object"?null:(o=z$3&&o[z$3]||o["@@iterator"],typeof o=="function"?o:null)}var B$2={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$2=Object.assign,D$2={};function E$2(o,s,a){this.props=o,this.context=s,this.refs=D$2,this.updater=a||B$2}E$2.prototype.isReactComponent={};E$2.prototype.setState=function(o,s){if(typeof o!="object"&&typeof o!="function"&&o!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,o,s,"setState")};E$2.prototype.forceUpdate=function(o){this.updater.enqueueForceUpdate(this,o,"forceUpdate")};function F$1(){}F$1.prototype=E$2.prototype;function G$2(o,s,a){this.props=o,this.context=s,this.refs=D$2,this.updater=a||B$2}var H$2=G$2.prototype=new F$1;H$2.constructor=G$2;C$2(H$2,E$2.prototype);H$2.isPureReactComponent=!0;var I$2=Array.isArray,J$1=Object.prototype.hasOwnProperty,K$3={current:null},L$2={key:!0,ref:!0,__self:!0,__source:!0};function M$2(o,s,a){var et,tt={},rt=null,nt=null;if(s!=null)for(et in s.ref!==void 0&&(nt=s.ref),s.key!==void 0&&(rt=""+s.key),s)J$1.call(s,et)&&!L$2.hasOwnProperty(et)&&(tt[et]=s[et]);var it=arguments.length-2;if(it===1)tt.children=a;else if(1<it){for(var st=Array(it),ot=0;ot<it;ot++)st[ot]=arguments[ot+2];tt.children=st}if(o&&o.defaultProps)for(et in it=o.defaultProps,it)tt[et]===void 0&&(tt[et]=it[et]);return{$$typeof:l$3,type:o,key:rt,ref:nt,props:tt,_owner:K$3.current}}function N$2(o,s){return{$$typeof:l$3,type:o.type,key:s,ref:o.ref,props:o.props,_owner:o._owner}}function O$1(o){return typeof o=="object"&&o!==null&&o.$$typeof===l$3}function escape$1(o){var s={"=":"=0",":":"=2"};return"$"+o.replace(/[=:]/g,function(a){return s[a]})}var P$1=/\/+/g;function Q$2(o,s){return typeof o=="object"&&o!==null&&o.key!=null?escape$1(""+o.key):s.toString(36)}function R$2(o,s,a,et,tt){var rt=typeof o;(rt==="undefined"||rt==="boolean")&&(o=null);var nt=!1;if(o===null)nt=!0;else switch(rt){case"string":case"number":nt=!0;break;case"object":switch(o.$$typeof){case l$3:case n$3:nt=!0}}if(nt)return nt=o,tt=tt(nt),o=et===""?"."+Q$2(nt,0):et,I$2(tt)?(a="",o!=null&&(a=o.replace(P$1,"$&/")+"/"),R$2(tt,s,a,"",function(ot){return ot})):tt!=null&&(O$1(tt)&&(tt=N$2(tt,a+(!tt.key||nt&&nt.key===tt.key?"":(""+tt.key).replace(P$1,"$&/")+"/")+o)),s.push(tt)),1;if(nt=0,et=et===""?".":et+":",I$2(o))for(var it=0;it<o.length;it++){rt=o[it];var st=et+Q$2(rt,it);nt+=R$2(rt,s,a,st,tt)}else if(st=A$2(o),typeof st=="function")for(o=st.call(o),it=0;!(rt=o.next()).done;)rt=rt.value,st=et+Q$2(rt,it++),nt+=R$2(rt,s,a,st,tt);else if(rt==="object")throw s=String(o),Error("Objects are not valid as a React child (found: "+(s==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":s)+"). If you meant to render a collection of children, use an array instead.");return nt}function S$2(o,s,a){if(o==null)return o;var et=[],tt=0;return R$2(o,et,"","",function(rt){return s.call(a,rt,tt++)}),et}function T$2(o){if(o._status===-1){var s=o._result;s=s(),s.then(function(a){(o._status===0||o._status===-1)&&(o._status=1,o._result=a)},function(a){(o._status===0||o._status===-1)&&(o._status=2,o._result=a)}),o._status===-1&&(o._status=0,o._result=s)}if(o._status===1)return o._result.default;throw o._result}var U$2={current:null},V$3={transition:null},W$2={ReactCurrentDispatcher:U$2,ReactCurrentBatchConfig:V$3,ReactCurrentOwner:K$3};function X$2(){throw Error("act(...) is not supported in production builds of React.")}react_production_min.Children={map:S$2,forEach:function(o,s,a){S$2(o,function(){s.apply(this,arguments)},a)},count:function(o){var s=0;return S$2(o,function(){s++}),s},toArray:function(o){return S$2(o,function(s){return s})||[]},only:function(o){if(!O$1(o))throw Error("React.Children.only expected to receive a single React element child.");return o}};react_production_min.Component=E$2;react_production_min.Fragment=p$4;react_production_min.Profiler=r$2;react_production_min.PureComponent=G$2;react_production_min.StrictMode=q$4;react_production_min.Suspense=w$3;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$2;react_production_min.act=X$2;react_production_min.cloneElement=function(o,s,a){if(o==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+o+".");var et=C$2({},o.props),tt=o.key,rt=o.ref,nt=o._owner;if(s!=null){if(s.ref!==void 0&&(rt=s.ref,nt=K$3.current),s.key!==void 0&&(tt=""+s.key),o.type&&o.type.defaultProps)var it=o.type.defaultProps;for(st in s)J$1.call(s,st)&&!L$2.hasOwnProperty(st)&&(et[st]=s[st]===void 0&&it!==void 0?it[st]:s[st])}var st=arguments.length-2;if(st===1)et.children=a;else if(1<st){it=Array(st);for(var ot=0;ot<st;ot++)it[ot]=arguments[ot+2];et.children=it}return{$$typeof:l$3,type:o.type,key:tt,ref:rt,props:et,_owner:nt}};react_production_min.createContext=function(o){return o={$$typeof:u$1,_currentValue:o,_currentValue2:o,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},o.Provider={$$typeof:t$2,_context:o},o.Consumer=o};react_production_min.createElement=M$2;react_production_min.createFactory=function(o){var s=M$2.bind(null,o);return s.type=o,s};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(o){return{$$typeof:v$5,render:o}};react_production_min.isValidElement=O$1;react_production_min.lazy=function(o){return{$$typeof:y$2,_payload:{_status:-1,_result:o},_init:T$2}};react_production_min.memo=function(o,s){return{$$typeof:x$2,type:o,compare:s===void 0?null:s}};react_production_min.startTransition=function(o){var s=V$3.transition;V$3.transition={};try{o()}finally{V$3.transition=s}};react_production_min.unstable_act=X$2;react_production_min.useCallback=function(o,s){return U$2.current.useCallback(o,s)};react_production_min.useContext=function(o){return U$2.current.useContext(o)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(o){return U$2.current.useDeferredValue(o)};react_production_min.useEffect=function(o,s){return U$2.current.useEffect(o,s)};react_production_min.useId=function(){return U$2.current.useId()};react_production_min.useImperativeHandle=function(o,s,a){return U$2.current.useImperativeHandle(o,s,a)};react_production_min.useInsertionEffect=function(o,s){return U$2.current.useInsertionEffect(o,s)};react_production_min.useLayoutEffect=function(o,s){return U$2.current.useLayoutEffect(o,s)};react_production_min.useMemo=function(o,s){return U$2.current.useMemo(o,s)};react_production_min.useReducer=function(o,s,a){return U$2.current.useReducer(o,s,a)};react_production_min.useRef=function(o){return U$2.current.useRef(o)};react_production_min.useState=function(o){return U$2.current.useState(o)};react_production_min.useSyncExternalStore=function(o,s,a){return U$2.current.useSyncExternalStore(o,s,a)};react_production_min.useTransition=function(){return U$2.current.useTransition()};react_production_min.version="18.3.1";react.exports=react_production_min;var reactExports=react.exports;const React=getDefaultExportFromCjs$2(reactExports),React$1=_mergeNamespaces({__proto__:null,default:React},[reactExports]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f$2=reactExports,k$3=Symbol.for("react.element"),l$2=Symbol.for("react.fragment"),m$4=Object.prototype.hasOwnProperty,n$2=f$2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$3={key:!0,ref:!0,__self:!0,__source:!0};function q$3(o,s,a){var et,tt={},rt=null,nt=null;a!==void 0&&(rt=""+a),s.key!==void 0&&(rt=""+s.key),s.ref!==void 0&&(nt=s.ref);for(et in s)m$4.call(s,et)&&!p$3.hasOwnProperty(et)&&(tt[et]=s[et]);if(o&&o.defaultProps)for(et in s=o.defaultProps,s)tt[et]===void 0&&(tt[et]=s[et]);return{$$typeof:k$3,type:o,key:rt,ref:nt,props:tt,_owner:n$2.current}}reactJsxRuntime_production_min.Fragment=l$2;reactJsxRuntime_production_min.jsx=q$3;reactJsxRuntime_production_min.jsxs=q$3;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,client={},reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(o){function s(Tt,St){var Mt=Tt.length;Tt.push(St);e:for(;0<Mt;){var jt=Mt-1>>>1,Gt=Tt[jt];if(0<tt(Gt,St))Tt[jt]=St,Tt[Mt]=Gt,Mt=jt;else break e}}function a(Tt){return Tt.length===0?null:Tt[0]}function et(Tt){if(Tt.length===0)return null;var St=Tt[0],Mt=Tt.pop();if(Mt!==St){Tt[0]=Mt;e:for(var jt=0,Gt=Tt.length,Ht=Gt>>>1;jt<Ht;){var At=2*(jt+1)-1,$t=Tt[At],kt=At+1,Lt=Tt[kt];if(0>tt($t,Mt))kt<Gt&&0>tt(Lt,$t)?(Tt[jt]=Lt,Tt[kt]=Mt,jt=kt):(Tt[jt]=$t,Tt[At]=Mt,jt=At);else if(kt<Gt&&0>tt(Lt,Mt))Tt[jt]=Lt,Tt[kt]=Mt,jt=kt;else break e}}return St}function tt(Tt,St){var Mt=Tt.sortIndex-St.sortIndex;return Mt!==0?Mt:Tt.id-St.id}if(typeof performance=="object"&&typeof performance.now=="function"){var rt=performance;o.unstable_now=function(){return rt.now()}}else{var nt=Date,it=nt.now();o.unstable_now=function(){return nt.now()-it}}var st=[],ot=[],at=1,lt=null,ct=3,ht=!1,ft=!1,dt=!1,pt=typeof setTimeout=="function"?setTimeout:null,gt=typeof clearTimeout=="function"?clearTimeout:null,mt=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function yt(Tt){for(var St=a(ot);St!==null;){if(St.callback===null)et(ot);else if(St.startTime<=Tt)et(ot),St.sortIndex=St.expirationTime,s(st,St);else break;St=a(ot)}}function vt(Tt){if(dt=!1,yt(Tt),!ft)if(a(st)!==null)ft=!0,Pt(Et);else{var St=a(ot);St!==null&&Dt(vt,St.startTime-Tt)}}function Et(Tt,St){ft=!1,dt&&(dt=!1,gt(Rt),Rt=-1),ht=!0;var Mt=ct;try{for(yt(St),lt=a(st);lt!==null&&(!(lt.expirationTime>St)||Tt&&!zt());){var jt=lt.callback;if(typeof jt=="function"){lt.callback=null,ct=lt.priorityLevel;var Gt=jt(lt.expirationTime<=St);St=o.unstable_now(),typeof Gt=="function"?lt.callback=Gt:lt===a(st)&&et(st),yt(St)}else et(st);lt=a(st)}if(lt!==null)var Ht=!0;else{var At=a(ot);At!==null&&Dt(vt,At.startTime-St),Ht=!1}return Ht}finally{lt=null,ct=Mt,ht=!1}}var xt=!1,wt=null,Rt=-1,Ct=5,Ft=-1;function zt(){return!(o.unstable_now()-Ft<Ct)}function Nt(){if(wt!==null){var Tt=o.unstable_now();Ft=Tt;var St=!0;try{St=wt(!0,Tt)}finally{St?Kt():(xt=!1,wt=null)}}else xt=!1}var Kt;if(typeof mt=="function")Kt=function(){mt(Nt)};else if(typeof MessageChannel<"u"){var Yt=new MessageChannel,Bt=Yt.port2;Yt.port1.onmessage=Nt,Kt=function(){Bt.postMessage(null)}}else Kt=function(){pt(Nt,0)};function Pt(Tt){wt=Tt,xt||(xt=!0,Kt())}function Dt(Tt,St){Rt=pt(function(){Tt(o.unstable_now())},St)}o.unstable_IdlePriority=5,o.unstable_ImmediatePriority=1,o.unstable_LowPriority=4,o.unstable_NormalPriority=3,o.unstable_Profiling=null,o.unstable_UserBlockingPriority=2,o.unstable_cancelCallback=function(Tt){Tt.callback=null},o.unstable_continueExecution=function(){ft||ht||(ft=!0,Pt(Et))},o.unstable_forceFrameRate=function(Tt){0>Tt||125<Tt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ct=0<Tt?Math.floor(1e3/Tt):5},o.unstable_getCurrentPriorityLevel=function(){return ct},o.unstable_getFirstCallbackNode=function(){return a(st)},o.unstable_next=function(Tt){switch(ct){case 1:case 2:case 3:var St=3;break;default:St=ct}var Mt=ct;ct=St;try{return Tt()}finally{ct=Mt}},o.unstable_pauseExecution=function(){},o.unstable_requestPaint=function(){},o.unstable_runWithPriority=function(Tt,St){switch(Tt){case 1:case 2:case 3:case 4:case 5:break;default:Tt=3}var Mt=ct;ct=Tt;try{return St()}finally{ct=Mt}},o.unstable_scheduleCallback=function(Tt,St,Mt){var jt=o.unstable_now();switch(typeof Mt=="object"&&Mt!==null?(Mt=Mt.delay,Mt=typeof Mt=="number"&&0<Mt?jt+Mt:jt):Mt=jt,Tt){case 1:var Gt=-1;break;case 2:Gt=250;break;case 5:Gt=1073741823;break;case 4:Gt=1e4;break;default:Gt=5e3}return Gt=Mt+Gt,Tt={id:at++,callback:St,priorityLevel:Tt,startTime:Mt,expirationTime:Gt,sortIndex:-1},Mt>jt?(Tt.sortIndex=Mt,s(ot,Tt),a(st)===null&&Tt===a(ot)&&(dt?(gt(Rt),Rt=-1):dt=!0,Dt(vt,Mt-jt))):(Tt.sortIndex=Gt,s(st,Tt),ft||ht||(ft=!0,Pt(Et))),Tt},o.unstable_shouldYield=zt,o.unstable_wrapCallback=function(Tt){var St=ct;return function(){var Mt=ct;ct=St;try{return Tt.apply(this,arguments)}finally{ct=Mt}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p$2(o){for(var s="https://reactjs.org/docs/error-decoder.html?invariant="+o,a=1;a<arguments.length;a++)s+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+o+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(o,s){ha(o,s),ha(o+"Capture",s)}function ha(o,s){for(ea[o]=s,o=0;o<s.length;o++)da.add(s[o])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(o){return ja.call(ma,o)?!0:ja.call(la,o)?!1:ka.test(o)?ma[o]=!0:(la[o]=!0,!1)}function pa(o,s,a,et){if(a!==null&&a.type===0)return!1;switch(typeof s){case"function":case"symbol":return!0;case"boolean":return et?!1:a!==null?!a.acceptsBooleans:(o=o.toLowerCase().slice(0,5),o!=="data-"&&o!=="aria-");default:return!1}}function qa(o,s,a,et){if(s===null||typeof s>"u"||pa(o,s,a,et))return!0;if(et)return!1;if(a!==null)switch(a.type){case 3:return!s;case 4:return s===!1;case 5:return isNaN(s);case 6:return isNaN(s)||1>s}return!1}function v$4(o,s,a,et,tt,rt,nt){this.acceptsBooleans=s===2||s===3||s===4,this.attributeName=et,this.attributeNamespace=tt,this.mustUseProperty=a,this.propertyName=o,this.type=s,this.sanitizeURL=rt,this.removeEmptyString=nt}var z$2={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(o){z$2[o]=new v$4(o,0,!1,o,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(o){var s=o[0];z$2[s]=new v$4(s,1,!1,o[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(o){z$2[o]=new v$4(o,2,!1,o.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(o){z$2[o]=new v$4(o,2,!1,o,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(o){z$2[o]=new v$4(o,3,!1,o.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(o){z$2[o]=new v$4(o,3,!0,o,null,!1,!1)});["capture","download"].forEach(function(o){z$2[o]=new v$4(o,4,!1,o,null,!1,!1)});["cols","rows","size","span"].forEach(function(o){z$2[o]=new v$4(o,6,!1,o,null,!1,!1)});["rowSpan","start"].forEach(function(o){z$2[o]=new v$4(o,5,!1,o.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(o){return o[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(o){var s=o.replace(ra,sa);z$2[s]=new v$4(s,1,!1,o,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(o){var s=o.replace(ra,sa);z$2[s]=new v$4(s,1,!1,o,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(o){var s=o.replace(ra,sa);z$2[s]=new v$4(s,1,!1,o,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(o){z$2[o]=new v$4(o,1,!1,o.toLowerCase(),null,!1,!1)});z$2.xlinkHref=new v$4("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(o){z$2[o]=new v$4(o,1,!1,o.toLowerCase(),null,!0,!0)});function ta(o,s,a,et){var tt=z$2.hasOwnProperty(s)?z$2[s]:null;(tt!==null?tt.type!==0:et||!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(qa(s,a,tt,et)&&(a=null),et||tt===null?oa(s)&&(a===null?o.removeAttribute(s):o.setAttribute(s,""+a)):tt.mustUseProperty?o[tt.propertyName]=a===null?tt.type===3?!1:"":a:(s=tt.attributeName,et=tt.attributeNamespace,a===null?o.removeAttribute(s):(tt=tt.type,a=tt===3||tt===4&&a===!0?"":""+a,et?o.setAttributeNS(et,s,a):o.setAttribute(s,a))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(o){return o===null||typeof o!="object"?null:(o=Ja&&o[Ja]||o["@@iterator"],typeof o=="function"?o:null)}var A$1=Object.assign,La;function Ma(o){if(La===void 0)try{throw Error()}catch(a){var s=a.stack.trim().match(/\n( *(at )?)/);La=s&&s[1]||""}return`
`+La+o}var Na=!1;function Oa(o,s){if(!o||Na)return"";Na=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(s)if(s=function(){throw Error()},Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(s,[])}catch(ot){var et=ot}Reflect.construct(o,[],s)}else{try{s.call()}catch(ot){et=ot}o.call(s.prototype)}else{try{throw Error()}catch(ot){et=ot}o()}}catch(ot){if(ot&&et&&typeof ot.stack=="string"){for(var tt=ot.stack.split(`
`),rt=et.stack.split(`
`),nt=tt.length-1,it=rt.length-1;1<=nt&&0<=it&&tt[nt]!==rt[it];)it--;for(;1<=nt&&0<=it;nt--,it--)if(tt[nt]!==rt[it]){if(nt!==1||it!==1)do if(nt--,it--,0>it||tt[nt]!==rt[it]){var st=`
`+tt[nt].replace(" at new "," at ");return o.displayName&&st.includes("<anonymous>")&&(st=st.replace("<anonymous>",o.displayName)),st}while(1<=nt&&0<=it);break}}}finally{Na=!1,Error.prepareStackTrace=a}return(o=o?o.displayName||o.name:"")?Ma(o):""}function Pa(o){switch(o.tag){case 5:return Ma(o.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return o=Oa(o.type,!1),o;case 11:return o=Oa(o.type.render,!1),o;case 1:return o=Oa(o.type,!0),o;default:return""}}function Qa(o){if(o==null)return null;if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof o=="object")switch(o.$$typeof){case Ca:return(o.displayName||"Context")+".Consumer";case Ba:return(o._context.displayName||"Context")+".Provider";case Da:var s=o.render;return o=o.displayName,o||(o=s.displayName||s.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case Ga:return s=o.displayName||null,s!==null?s:Qa(o.type)||"Memo";case Ha:s=o._payload,o=o._init;try{return Qa(o(s))}catch{}}return null}function Ra(o){var s=o.type;switch(o.tag){case 24:return"Cache";case 9:return(s.displayName||"Context")+".Consumer";case 10:return(s._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return o=s.render,o=o.displayName||o.name||"",s.displayName||(o!==""?"ForwardRef("+o+")":"ForwardRef");case 7:return"Fragment";case 5:return s;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(s);case 8:return s===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s}return null}function Sa(o){switch(typeof o){case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function Ta(o){var s=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function Ua(o){var s=Ta(o)?"checked":"value",a=Object.getOwnPropertyDescriptor(o.constructor.prototype,s),et=""+o[s];if(!o.hasOwnProperty(s)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var tt=a.get,rt=a.set;return Object.defineProperty(o,s,{configurable:!0,get:function(){return tt.call(this)},set:function(nt){et=""+nt,rt.call(this,nt)}}),Object.defineProperty(o,s,{enumerable:a.enumerable}),{getValue:function(){return et},setValue:function(nt){et=""+nt},stopTracking:function(){o._valueTracker=null,delete o[s]}}}}function Va(o){o._valueTracker||(o._valueTracker=Ua(o))}function Wa(o){if(!o)return!1;var s=o._valueTracker;if(!s)return!0;var a=s.getValue(),et="";return o&&(et=Ta(o)?o.checked?"true":"false":o.value),o=et,o!==a?(s.setValue(o),!0):!1}function Xa(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}function Ya(o,s){var a=s.checked;return A$1({},s,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:a??o._wrapperState.initialChecked})}function Za(o,s){var a=s.defaultValue==null?"":s.defaultValue,et=s.checked!=null?s.checked:s.defaultChecked;a=Sa(s.value!=null?s.value:a),o._wrapperState={initialChecked:et,initialValue:a,controlled:s.type==="checkbox"||s.type==="radio"?s.checked!=null:s.value!=null}}function ab(o,s){s=s.checked,s!=null&&ta(o,"checked",s,!1)}function bb(o,s){ab(o,s);var a=Sa(s.value),et=s.type;if(a!=null)et==="number"?(a===0&&o.value===""||o.value!=a)&&(o.value=""+a):o.value!==""+a&&(o.value=""+a);else if(et==="submit"||et==="reset"){o.removeAttribute("value");return}s.hasOwnProperty("value")?cb(o,s.type,a):s.hasOwnProperty("defaultValue")&&cb(o,s.type,Sa(s.defaultValue)),s.checked==null&&s.defaultChecked!=null&&(o.defaultChecked=!!s.defaultChecked)}function db$1(o,s,a){if(s.hasOwnProperty("value")||s.hasOwnProperty("defaultValue")){var et=s.type;if(!(et!=="submit"&&et!=="reset"||s.value!==void 0&&s.value!==null))return;s=""+o._wrapperState.initialValue,a||s===o.value||(o.value=s),o.defaultValue=s}a=o.name,a!==""&&(o.name=""),o.defaultChecked=!!o._wrapperState.initialChecked,a!==""&&(o.name=a)}function cb(o,s,a){(s!=="number"||Xa(o.ownerDocument)!==o)&&(a==null?o.defaultValue=""+o._wrapperState.initialValue:o.defaultValue!==""+a&&(o.defaultValue=""+a))}var eb=Array.isArray;function fb(o,s,a,et){if(o=o.options,s){s={};for(var tt=0;tt<a.length;tt++)s["$"+a[tt]]=!0;for(a=0;a<o.length;a++)tt=s.hasOwnProperty("$"+o[a].value),o[a].selected!==tt&&(o[a].selected=tt),tt&&et&&(o[a].defaultSelected=!0)}else{for(a=""+Sa(a),s=null,tt=0;tt<o.length;tt++){if(o[tt].value===a){o[tt].selected=!0,et&&(o[tt].defaultSelected=!0);return}s!==null||o[tt].disabled||(s=o[tt])}s!==null&&(s.selected=!0)}}function gb(o,s){if(s.dangerouslySetInnerHTML!=null)throw Error(p$2(91));return A$1({},s,{value:void 0,defaultValue:void 0,children:""+o._wrapperState.initialValue})}function hb(o,s){var a=s.value;if(a==null){if(a=s.children,s=s.defaultValue,a!=null){if(s!=null)throw Error(p$2(92));if(eb(a)){if(1<a.length)throw Error(p$2(93));a=a[0]}s=a}s==null&&(s=""),a=s}o._wrapperState={initialValue:Sa(a)}}function ib(o,s){var a=Sa(s.value),et=Sa(s.defaultValue);a!=null&&(a=""+a,a!==o.value&&(o.value=a),s.defaultValue==null&&o.defaultValue!==a&&(o.defaultValue=a)),et!=null&&(o.defaultValue=""+et)}function jb(o){var s=o.textContent;s===o._wrapperState.initialValue&&s!==""&&s!==null&&(o.value=s)}function kb(o){switch(o){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(o,s){return o==null||o==="http://www.w3.org/1999/xhtml"?kb(s):o==="http://www.w3.org/2000/svg"&&s==="foreignObject"?"http://www.w3.org/1999/xhtml":o}var mb,nb=function(o){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(s,a,et,tt){MSApp.execUnsafeLocalFunction(function(){return o(s,a,et,tt)})}:o}(function(o,s){if(o.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in o)o.innerHTML=s;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+s.valueOf().toString()+"</svg>",s=mb.firstChild;o.firstChild;)o.removeChild(o.firstChild);for(;s.firstChild;)o.appendChild(s.firstChild)}});function ob(o,s){if(s){var a=o.firstChild;if(a&&a===o.lastChild&&a.nodeType===3){a.nodeValue=s;return}}o.textContent=s}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(o){qb.forEach(function(s){s=s+o.charAt(0).toUpperCase()+o.substring(1),pb[s]=pb[o]})});function rb(o,s,a){return s==null||typeof s=="boolean"||s===""?"":a||typeof s!="number"||s===0||pb.hasOwnProperty(o)&&pb[o]?(""+s).trim():s+"px"}function sb(o,s){o=o.style;for(var a in s)if(s.hasOwnProperty(a)){var et=a.indexOf("--")===0,tt=rb(a,s[a],et);a==="float"&&(a="cssFloat"),et?o.setProperty(a,tt):o[a]=tt}}var tb=A$1({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(o,s){if(s){if(tb[o]&&(s.children!=null||s.dangerouslySetInnerHTML!=null))throw Error(p$2(137,o));if(s.dangerouslySetInnerHTML!=null){if(s.children!=null)throw Error(p$2(60));if(typeof s.dangerouslySetInnerHTML!="object"||!("__html"in s.dangerouslySetInnerHTML))throw Error(p$2(61))}if(s.style!=null&&typeof s.style!="object")throw Error(p$2(62))}}function vb(o,s){if(o.indexOf("-")===-1)return typeof s.is=="string";switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var yb=null,zb=null,Ab=null;function Bb(o){if(o=Cb(o)){if(typeof yb!="function")throw Error(p$2(280));var s=o.stateNode;s&&(s=Db(s),yb(o.stateNode,o.type,s))}}function Eb(o){zb?Ab?Ab.push(o):Ab=[o]:zb=o}function Fb(){if(zb){var o=zb,s=Ab;if(Ab=zb=null,Bb(o),s)for(o=0;o<s.length;o++)Bb(s[o])}}function Gb(o,s){return o(s)}function Hb(){}var Ib=!1;function Jb(o,s,a){if(Ib)return o(s,a);Ib=!0;try{return Gb(o,s,a)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(o,s){var a=o.stateNode;if(a===null)return null;var et=Db(a);if(et===null)return null;a=et[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(et=!et.disabled)||(o=o.type,et=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!et;break e;default:o=!1}if(o)return null;if(a&&typeof a!="function")throw Error(p$2(231,s,typeof a));return a}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb(o,s,a,et,tt,rt,nt,it,st){var ot=Array.prototype.slice.call(arguments,3);try{s.apply(a,ot)}catch(at){this.onError(at)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(o){Ob=!0,Pb=o}};function Tb(o,s,a,et,tt,rt,nt,it,st){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(o,s,a,et,tt,rt,nt,it,st){if(Tb.apply(this,arguments),Ob){if(Ob){var ot=Pb;Ob=!1,Pb=null}else throw Error(p$2(198));Qb||(Qb=!0,Rb=ot)}}function Vb(o){var s=o,a=o;if(o.alternate)for(;s.return;)s=s.return;else{o=s;do s=o,s.flags&4098&&(a=s.return),o=s.return;while(o)}return s.tag===3?a:null}function Wb(o){if(o.tag===13){var s=o.memoizedState;if(s===null&&(o=o.alternate,o!==null&&(s=o.memoizedState)),s!==null)return s.dehydrated}return null}function Xb(o){if(Vb(o)!==o)throw Error(p$2(188))}function Yb(o){var s=o.alternate;if(!s){if(s=Vb(o),s===null)throw Error(p$2(188));return s!==o?null:o}for(var a=o,et=s;;){var tt=a.return;if(tt===null)break;var rt=tt.alternate;if(rt===null){if(et=tt.return,et!==null){a=et;continue}break}if(tt.child===rt.child){for(rt=tt.child;rt;){if(rt===a)return Xb(tt),o;if(rt===et)return Xb(tt),s;rt=rt.sibling}throw Error(p$2(188))}if(a.return!==et.return)a=tt,et=rt;else{for(var nt=!1,it=tt.child;it;){if(it===a){nt=!0,a=tt,et=rt;break}if(it===et){nt=!0,et=tt,a=rt;break}it=it.sibling}if(!nt){for(it=rt.child;it;){if(it===a){nt=!0,a=rt,et=tt;break}if(it===et){nt=!0,et=rt,a=tt;break}it=it.sibling}if(!nt)throw Error(p$2(189))}}if(a.alternate!==et)throw Error(p$2(190))}if(a.tag!==3)throw Error(p$2(188));return a.stateNode.current===a?o:s}function Zb(o){return o=Yb(o),o!==null?$b(o):null}function $b(o){if(o.tag===5||o.tag===6)return o;for(o=o.child;o!==null;){var s=$b(o);if(s!==null)return s;o=o.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B$1=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(o){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,o,void 0,(o.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(o){return o>>>=0,o===0?32:31-(pc(o)/qc|0)|0}var rc=64,sc=4194304;function tc(o){switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return o&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return o}}function uc(o,s){var a=o.pendingLanes;if(a===0)return 0;var et=0,tt=o.suspendedLanes,rt=o.pingedLanes,nt=a&268435455;if(nt!==0){var it=nt&~tt;it!==0?et=tc(it):(rt&=nt,rt!==0&&(et=tc(rt)))}else nt=a&~tt,nt!==0?et=tc(nt):rt!==0&&(et=tc(rt));if(et===0)return 0;if(s!==0&&s!==et&&!(s&tt)&&(tt=et&-et,rt=s&-s,tt>=rt||tt===16&&(rt&4194240)!==0))return s;if(et&4&&(et|=a&16),s=o.entangledLanes,s!==0)for(o=o.entanglements,s&=et;0<s;)a=31-oc(s),tt=1<<a,et|=o[a],s&=~tt;return et}function vc(o,s){switch(o){case 1:case 2:case 4:return s+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(o,s){for(var a=o.suspendedLanes,et=o.pingedLanes,tt=o.expirationTimes,rt=o.pendingLanes;0<rt;){var nt=31-oc(rt),it=1<<nt,st=tt[nt];st===-1?(!(it&a)||it&et)&&(tt[nt]=vc(it,s)):st<=s&&(o.expiredLanes|=it),rt&=~it}}function xc(o){return o=o.pendingLanes&-1073741825,o!==0?o:o&1073741824?1073741824:0}function yc(){var o=rc;return rc<<=1,!(rc&4194240)&&(rc=64),o}function zc(o){for(var s=[],a=0;31>a;a++)s.push(o);return s}function Ac(o,s,a){o.pendingLanes|=s,s!==536870912&&(o.suspendedLanes=0,o.pingedLanes=0),o=o.eventTimes,s=31-oc(s),o[s]=a}function Bc(o,s){var a=o.pendingLanes&~s;o.pendingLanes=s,o.suspendedLanes=0,o.pingedLanes=0,o.expiredLanes&=s,o.mutableReadLanes&=s,o.entangledLanes&=s,s=o.entanglements;var et=o.eventTimes;for(o=o.expirationTimes;0<a;){var tt=31-oc(a),rt=1<<tt;s[tt]=0,et[tt]=-1,o[tt]=-1,a&=~rt}}function Cc(o,s){var a=o.entangledLanes|=s;for(o=o.entanglements;a;){var et=31-oc(a),tt=1<<et;tt&s|o[et]&s&&(o[et]|=s),a&=~tt}}var C$1=0;function Dc(o){return o&=-o,1<o?4<o?o&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(o,s){switch(o){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(s.pointerId)}}function Tc(o,s,a,et,tt,rt){return o===null||o.nativeEvent!==rt?(o={blockedOn:s,domEventName:a,eventSystemFlags:et,nativeEvent:rt,targetContainers:[tt]},s!==null&&(s=Cb(s),s!==null&&Fc(s)),o):(o.eventSystemFlags|=et,s=o.targetContainers,tt!==null&&s.indexOf(tt)===-1&&s.push(tt),o)}function Uc(o,s,a,et,tt){switch(s){case"focusin":return Lc=Tc(Lc,o,s,a,et,tt),!0;case"dragenter":return Mc=Tc(Mc,o,s,a,et,tt),!0;case"mouseover":return Nc=Tc(Nc,o,s,a,et,tt),!0;case"pointerover":var rt=tt.pointerId;return Oc.set(rt,Tc(Oc.get(rt)||null,o,s,a,et,tt)),!0;case"gotpointercapture":return rt=tt.pointerId,Pc.set(rt,Tc(Pc.get(rt)||null,o,s,a,et,tt)),!0}return!1}function Vc(o){var s=Wc(o.target);if(s!==null){var a=Vb(s);if(a!==null){if(s=a.tag,s===13){if(s=Wb(a),s!==null){o.blockedOn=s,Ic(o.priority,function(){Gc(a)});return}}else if(s===3&&a.stateNode.current.memoizedState.isDehydrated){o.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}o.blockedOn=null}function Xc(o){if(o.blockedOn!==null)return!1;for(var s=o.targetContainers;0<s.length;){var a=Yc(o.domEventName,o.eventSystemFlags,s[0],o.nativeEvent);if(a===null){a=o.nativeEvent;var et=new a.constructor(a.type,a);wb=et,a.target.dispatchEvent(et),wb=null}else return s=Cb(a),s!==null&&Fc(s),o.blockedOn=a,!1;s.shift()}return!0}function Zc(o,s,a){Xc(o)&&a.delete(s)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(o,s){o.blockedOn===s&&(o.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(o){function s(tt){return ad(tt,o)}if(0<Kc.length){ad(Kc[0],o);for(var a=1;a<Kc.length;a++){var et=Kc[a];et.blockedOn===o&&(et.blockedOn=null)}}for(Lc!==null&&ad(Lc,o),Mc!==null&&ad(Mc,o),Nc!==null&&ad(Nc,o),Oc.forEach(s),Pc.forEach(s),a=0;a<Qc.length;a++)et=Qc[a],et.blockedOn===o&&(et.blockedOn=null);for(;0<Qc.length&&(a=Qc[0],a.blockedOn===null);)Vc(a),a.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(o,s,a,et){var tt=C$1,rt=cd.transition;cd.transition=null;try{C$1=1,fd(o,s,a,et)}finally{C$1=tt,cd.transition=rt}}function gd(o,s,a,et){var tt=C$1,rt=cd.transition;cd.transition=null;try{C$1=4,fd(o,s,a,et)}finally{C$1=tt,cd.transition=rt}}function fd(o,s,a,et){if(dd){var tt=Yc(o,s,a,et);if(tt===null)hd(o,s,et,id$1,a),Sc(o,et);else if(Uc(tt,o,s,a,et))et.stopPropagation();else if(Sc(o,et),s&4&&-1<Rc.indexOf(o)){for(;tt!==null;){var rt=Cb(tt);if(rt!==null&&Ec(rt),rt=Yc(o,s,a,et),rt===null&&hd(o,s,et,id$1,a),rt===tt)break;tt=rt}tt!==null&&et.stopPropagation()}else hd(o,s,et,null,a)}}var id$1=null;function Yc(o,s,a,et){if(id$1=null,o=xb(et),o=Wc(o),o!==null)if(s=Vb(o),s===null)o=null;else if(a=s.tag,a===13){if(o=Wb(s),o!==null)return o;o=null}else if(a===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;o=null}else s!==o&&(o=null);return id$1=o,null}function jd(o){switch(o){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var o,s=ld,a=s.length,et,tt="value"in kd?kd.value:kd.textContent,rt=tt.length;for(o=0;o<a&&s[o]===tt[o];o++);var nt=a-o;for(et=1;et<=nt&&s[a-et]===tt[rt-et];et++);return md=tt.slice(o,1<et?1-et:void 0)}function od(o){var s=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&s===13&&(o=13)):o=s,o===10&&(o=13),32<=o||o===13?o:0}function pd(){return!0}function qd(){return!1}function rd(o){function s(a,et,tt,rt,nt){this._reactName=a,this._targetInst=tt,this.type=et,this.nativeEvent=rt,this.target=nt,this.currentTarget=null;for(var it in o)o.hasOwnProperty(it)&&(a=o[it],this[it]=a?a(rt):rt[it]);return this.isDefaultPrevented=(rt.defaultPrevented!=null?rt.defaultPrevented:rt.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A$1(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),s}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A$1({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A$1({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==yd&&(yd&&o.type==="mousemove"?(wd=o.screenX-yd.screenX,xd=o.screenY-yd.screenY):xd=wd=0,yd=o),wd)},movementY:function(o){return"movementY"in o?o.movementY:xd}}),Bd=rd(Ad),Cd=A$1({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A$1({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A$1({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A$1({},sd,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A$1({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(o){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(o):(o=Od[o])?!!s[o]:!1}function zd(){return Pd}var Qd=A$1({},ud,{key:function(o){if(o.key){var s=Md[o.key]||o.key;if(s!=="Unidentified")return s}return o.type==="keypress"?(o=od(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?Nd[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(o){return o.type==="keypress"?od(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?od(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),Rd=rd(Qd),Sd=A$1({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A$1({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A$1({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A$1({},Ad,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae$1=ia&&"CompositionEvent"in window,be$1=null;ia&&"documentMode"in document&&(be$1=document.documentMode);var ce$1=ia&&"TextEvent"in window&&!be$1,de$1=ia&&(!ae$1||be$1&&8<be$1&&11>=be$1),ee$1=" ",fe$1=!1;function ge$1(o,s){switch(o){case"keyup":return $d.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he$1(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var ie$1=!1;function je$1(o,s){switch(o){case"compositionend":return he$1(s);case"keypress":return s.which!==32?null:(fe$1=!0,ee$1);case"textInput":return o=s.data,o===ee$1&&fe$1?null:o;default:return null}}function ke$1(o,s){if(ie$1)return o==="compositionend"||!ae$1&&ge$1(o,s)?(o=nd(),md=ld=kd=null,ie$1=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return de$1&&s.locale!=="ko"?null:s.data;default:return null}}var le$1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me(o){var s=o&&o.nodeName&&o.nodeName.toLowerCase();return s==="input"?!!le$1[o.type]:s==="textarea"}function ne$1(o,s,a,et){Eb(et),s=oe$1(s,"onChange"),0<s.length&&(a=new td("onChange","change",null,a,et),o.push({event:a,listeners:s}))}var pe$1=null,qe$1=null;function re$1(o){se$1(o,0)}function te$1(o){var s=ue(o);if(Wa(s))return o}function ve$1(o,s){if(o==="change")return s}var we$1=!1;if(ia){var xe$1;if(ia){var ye$1="oninput"in document;if(!ye$1){var ze$1=document.createElement("div");ze$1.setAttribute("oninput","return;"),ye$1=typeof ze$1.oninput=="function"}xe$1=ye$1}else xe$1=!1;we$1=xe$1&&(!document.documentMode||9<document.documentMode)}function Ae$1(){pe$1&&(pe$1.detachEvent("onpropertychange",Be$1),qe$1=pe$1=null)}function Be$1(o){if(o.propertyName==="value"&&te$1(qe$1)){var s=[];ne$1(s,qe$1,o,xb(o)),Jb(re$1,s)}}function Ce(o,s,a){o==="focusin"?(Ae$1(),pe$1=s,qe$1=a,pe$1.attachEvent("onpropertychange",Be$1)):o==="focusout"&&Ae$1()}function De$1(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return te$1(qe$1)}function Ee$1(o,s){if(o==="click")return te$1(s)}function Fe$1(o,s){if(o==="input"||o==="change")return te$1(s)}function Ge(o,s){return o===s&&(o!==0||1/o===1/s)||o!==o&&s!==s}var He=typeof Object.is=="function"?Object.is:Ge;function Ie(o,s){if(He(o,s))return!0;if(typeof o!="object"||o===null||typeof s!="object"||s===null)return!1;var a=Object.keys(o),et=Object.keys(s);if(a.length!==et.length)return!1;for(et=0;et<a.length;et++){var tt=a[et];if(!ja.call(s,tt)||!He(o[tt],s[tt]))return!1}return!0}function Je(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function Ke(o,s){var a=Je(o);o=0;for(var et;a;){if(a.nodeType===3){if(et=o+a.textContent.length,o<=s&&et>=s)return{node:a,offset:s-o};o=et}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=Je(a)}}function Le(o,s){return o&&s?o===s?!0:o&&o.nodeType===3?!1:s&&s.nodeType===3?Le(o,s.parentNode):"contains"in o?o.contains(s):o.compareDocumentPosition?!!(o.compareDocumentPosition(s)&16):!1:!1}function Me$1(){for(var o=window,s=Xa();s instanceof o.HTMLIFrameElement;){try{var a=typeof s.contentWindow.location.href=="string"}catch{a=!1}if(a)o=s.contentWindow;else break;s=Xa(o.document)}return s}function Ne$1(o){var s=o&&o.nodeName&&o.nodeName.toLowerCase();return s&&(s==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||s==="textarea"||o.contentEditable==="true")}function Oe$1(o){var s=Me$1(),a=o.focusedElem,et=o.selectionRange;if(s!==a&&a&&a.ownerDocument&&Le(a.ownerDocument.documentElement,a)){if(et!==null&&Ne$1(a)){if(s=et.start,o=et.end,o===void 0&&(o=s),"selectionStart"in a)a.selectionStart=s,a.selectionEnd=Math.min(o,a.value.length);else if(o=(s=a.ownerDocument||document)&&s.defaultView||window,o.getSelection){o=o.getSelection();var tt=a.textContent.length,rt=Math.min(et.start,tt);et=et.end===void 0?rt:Math.min(et.end,tt),!o.extend&&rt>et&&(tt=et,et=rt,rt=tt),tt=Ke(a,rt);var nt=Ke(a,et);tt&&nt&&(o.rangeCount!==1||o.anchorNode!==tt.node||o.anchorOffset!==tt.offset||o.focusNode!==nt.node||o.focusOffset!==nt.offset)&&(s=s.createRange(),s.setStart(tt.node,tt.offset),o.removeAllRanges(),rt>et?(o.addRange(s),o.extend(nt.node,nt.offset)):(s.setEnd(nt.node,nt.offset),o.addRange(s)))}}for(s=[],o=a;o=o.parentNode;)o.nodeType===1&&s.push({element:o,left:o.scrollLeft,top:o.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<s.length;a++)o=s[a],o.element.scrollLeft=o.left,o.element.scrollTop=o.top}}var Pe=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re$1=null,Se$1=null,Te$1=!1;function Ue(o,s,a){var et=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;Te$1||Qe==null||Qe!==Xa(et)||(et=Qe,"selectionStart"in et&&Ne$1(et)?et={start:et.selectionStart,end:et.selectionEnd}:(et=(et.ownerDocument&&et.ownerDocument.defaultView||window).getSelection(),et={anchorNode:et.anchorNode,anchorOffset:et.anchorOffset,focusNode:et.focusNode,focusOffset:et.focusOffset}),Se$1&&Ie(Se$1,et)||(Se$1=et,et=oe$1(Re$1,"onSelect"),0<et.length&&(s=new td("onSelect","select",null,s,a),o.push({event:s,listeners:et}),s.target=Qe)))}function Ve$1(o,s){var a={};return a[o.toLowerCase()]=s.toLowerCase(),a["Webkit"+o]="webkit"+s,a["Moz"+o]="moz"+s,a}var We={animationend:Ve$1("Animation","AnimationEnd"),animationiteration:Ve$1("Animation","AnimationIteration"),animationstart:Ve$1("Animation","AnimationStart"),transitionend:Ve$1("Transition","TransitionEnd")},Xe={},Ye$1={};ia&&(Ye$1=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);function Ze(o){if(Xe[o])return Xe[o];if(!We[o])return o;var s=We[o],a;for(a in s)if(s.hasOwnProperty(a)&&a in Ye$1)return Xe[o]=s[a];return o}var $e=Ze("animationend"),af=Ze("animationiteration"),bf=Ze("animationstart"),cf=Ze("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(o,s){df.set(o,s),fa(s,[o])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(o,s,a){var et=o.type||"unknown-event";o.currentTarget=a,Ub(et,s,void 0,o),o.currentTarget=null}function se$1(o,s){s=(s&4)!==0;for(var a=0;a<o.length;a++){var et=o[a],tt=et.event;et=et.listeners;e:{var rt=void 0;if(s)for(var nt=et.length-1;0<=nt;nt--){var it=et[nt],st=it.instance,ot=it.currentTarget;if(it=it.listener,st!==rt&&tt.isPropagationStopped())break e;nf(tt,it,ot),rt=st}else for(nt=0;nt<et.length;nt++){if(it=et[nt],st=it.instance,ot=it.currentTarget,it=it.listener,st!==rt&&tt.isPropagationStopped())break e;nf(tt,it,ot),rt=st}}}if(Qb)throw o=Rb,Qb=!1,Rb=null,o}function D$1(o,s){var a=s[of];a===void 0&&(a=s[of]=new Set);var et=o+"__bubble";a.has(et)||(pf(s,o,2,!1),a.add(et))}function qf(o,s,a){var et=0;s&&(et|=4),pf(a,o,et,s)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(o){if(!o[rf]){o[rf]=!0,da.forEach(function(a){a!=="selectionchange"&&(mf.has(a)||qf(a,!1,o),qf(a,!0,o))});var s=o.nodeType===9?o:o.ownerDocument;s===null||s[rf]||(s[rf]=!0,qf("selectionchange",!1,s))}}function pf(o,s,a,et){switch(jd(s)){case 1:var tt=ed;break;case 4:tt=gd;break;default:tt=fd}a=tt.bind(null,s,a,o),tt=void 0,!Lb||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(tt=!0),et?tt!==void 0?o.addEventListener(s,a,{capture:!0,passive:tt}):o.addEventListener(s,a,!0):tt!==void 0?o.addEventListener(s,a,{passive:tt}):o.addEventListener(s,a,!1)}function hd(o,s,a,et,tt){var rt=et;if(!(s&1)&&!(s&2)&&et!==null)e:for(;;){if(et===null)return;var nt=et.tag;if(nt===3||nt===4){var it=et.stateNode.containerInfo;if(it===tt||it.nodeType===8&&it.parentNode===tt)break;if(nt===4)for(nt=et.return;nt!==null;){var st=nt.tag;if((st===3||st===4)&&(st=nt.stateNode.containerInfo,st===tt||st.nodeType===8&&st.parentNode===tt))return;nt=nt.return}for(;it!==null;){if(nt=Wc(it),nt===null)return;if(st=nt.tag,st===5||st===6){et=rt=nt;continue e}it=it.parentNode}}et=et.return}Jb(function(){var ot=rt,at=xb(a),lt=[];e:{var ct=df.get(o);if(ct!==void 0){var ht=td,ft=o;switch(o){case"keypress":if(od(a)===0)break e;case"keydown":case"keyup":ht=Rd;break;case"focusin":ft="focus",ht=Fd;break;case"focusout":ft="blur",ht=Fd;break;case"beforeblur":case"afterblur":ht=Fd;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ht=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ht=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ht=Vd;break;case $e:case af:case bf:ht=Hd;break;case cf:ht=Xd;break;case"scroll":ht=vd;break;case"wheel":ht=Zd;break;case"copy":case"cut":case"paste":ht=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ht=Td}var dt=(s&4)!==0,pt=!dt&&o==="scroll",gt=dt?ct!==null?ct+"Capture":null:ct;dt=[];for(var mt=ot,yt;mt!==null;){yt=mt;var vt=yt.stateNode;if(yt.tag===5&&vt!==null&&(yt=vt,gt!==null&&(vt=Kb(mt,gt),vt!=null&&dt.push(tf(mt,vt,yt)))),pt)break;mt=mt.return}0<dt.length&&(ct=new ht(ct,ft,null,a,at),lt.push({event:ct,listeners:dt}))}}if(!(s&7)){e:{if(ct=o==="mouseover"||o==="pointerover",ht=o==="mouseout"||o==="pointerout",ct&&a!==wb&&(ft=a.relatedTarget||a.fromElement)&&(Wc(ft)||ft[uf]))break e;if((ht||ct)&&(ct=at.window===at?at:(ct=at.ownerDocument)?ct.defaultView||ct.parentWindow:window,ht?(ft=a.relatedTarget||a.toElement,ht=ot,ft=ft?Wc(ft):null,ft!==null&&(pt=Vb(ft),ft!==pt||ft.tag!==5&&ft.tag!==6)&&(ft=null)):(ht=null,ft=ot),ht!==ft)){if(dt=Bd,vt="onMouseLeave",gt="onMouseEnter",mt="mouse",(o==="pointerout"||o==="pointerover")&&(dt=Td,vt="onPointerLeave",gt="onPointerEnter",mt="pointer"),pt=ht==null?ct:ue(ht),yt=ft==null?ct:ue(ft),ct=new dt(vt,mt+"leave",ht,a,at),ct.target=pt,ct.relatedTarget=yt,vt=null,Wc(at)===ot&&(dt=new dt(gt,mt+"enter",ft,a,at),dt.target=yt,dt.relatedTarget=pt,vt=dt),pt=vt,ht&&ft)t:{for(dt=ht,gt=ft,mt=0,yt=dt;yt;yt=vf(yt))mt++;for(yt=0,vt=gt;vt;vt=vf(vt))yt++;for(;0<mt-yt;)dt=vf(dt),mt--;for(;0<yt-mt;)gt=vf(gt),yt--;for(;mt--;){if(dt===gt||gt!==null&&dt===gt.alternate)break t;dt=vf(dt),gt=vf(gt)}dt=null}else dt=null;ht!==null&&wf(lt,ct,ht,dt,!1),ft!==null&&pt!==null&&wf(lt,pt,ft,dt,!0)}}e:{if(ct=ot?ue(ot):window,ht=ct.nodeName&&ct.nodeName.toLowerCase(),ht==="select"||ht==="input"&&ct.type==="file")var Et=ve$1;else if(me(ct))if(we$1)Et=Fe$1;else{Et=De$1;var xt=Ce}else(ht=ct.nodeName)&&ht.toLowerCase()==="input"&&(ct.type==="checkbox"||ct.type==="radio")&&(Et=Ee$1);if(Et&&(Et=Et(o,ot))){ne$1(lt,Et,a,at);break e}xt&&xt(o,ct,ot),o==="focusout"&&(xt=ct._wrapperState)&&xt.controlled&&ct.type==="number"&&cb(ct,"number",ct.value)}switch(xt=ot?ue(ot):window,o){case"focusin":(me(xt)||xt.contentEditable==="true")&&(Qe=xt,Re$1=ot,Se$1=null);break;case"focusout":Se$1=Re$1=Qe=null;break;case"mousedown":Te$1=!0;break;case"contextmenu":case"mouseup":case"dragend":Te$1=!1,Ue(lt,a,at);break;case"selectionchange":if(Pe)break;case"keydown":case"keyup":Ue(lt,a,at)}var wt;if(ae$1)e:{switch(o){case"compositionstart":var Rt="onCompositionStart";break e;case"compositionend":Rt="onCompositionEnd";break e;case"compositionupdate":Rt="onCompositionUpdate";break e}Rt=void 0}else ie$1?ge$1(o,a)&&(Rt="onCompositionEnd"):o==="keydown"&&a.keyCode===229&&(Rt="onCompositionStart");Rt&&(de$1&&a.locale!=="ko"&&(ie$1||Rt!=="onCompositionStart"?Rt==="onCompositionEnd"&&ie$1&&(wt=nd()):(kd=at,ld="value"in kd?kd.value:kd.textContent,ie$1=!0)),xt=oe$1(ot,Rt),0<xt.length&&(Rt=new Ld(Rt,o,null,a,at),lt.push({event:Rt,listeners:xt}),wt?Rt.data=wt:(wt=he$1(a),wt!==null&&(Rt.data=wt)))),(wt=ce$1?je$1(o,a):ke$1(o,a))&&(ot=oe$1(ot,"onBeforeInput"),0<ot.length&&(at=new Ld("onBeforeInput","beforeinput",null,a,at),lt.push({event:at,listeners:ot}),at.data=wt))}se$1(lt,s)})}function tf(o,s,a){return{instance:o,listener:s,currentTarget:a}}function oe$1(o,s){for(var a=s+"Capture",et=[];o!==null;){var tt=o,rt=tt.stateNode;tt.tag===5&&rt!==null&&(tt=rt,rt=Kb(o,a),rt!=null&&et.unshift(tf(o,rt,tt)),rt=Kb(o,s),rt!=null&&et.push(tf(o,rt,tt))),o=o.return}return et}function vf(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5);return o||null}function wf(o,s,a,et,tt){for(var rt=s._reactName,nt=[];a!==null&&a!==et;){var it=a,st=it.alternate,ot=it.stateNode;if(st!==null&&st===et)break;it.tag===5&&ot!==null&&(it=ot,tt?(st=Kb(a,rt),st!=null&&nt.unshift(tf(a,st,it))):tt||(st=Kb(a,rt),st!=null&&nt.push(tf(a,st,it)))),a=a.return}nt.length!==0&&o.push({event:s,listeners:nt})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(o){return(typeof o=="string"?o:""+o).replace(xf,`
`).replace(yf,"")}function Af(o,s,a){if(s=zf(s),zf(o)!==s&&a)throw Error(p$2(425))}function Bf(){}var Cf=null,Df=null;function Ef(o,s){return o==="textarea"||o==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(o){return Hf.resolve(null).then(o).catch(If)}:Ff;function If(o){setTimeout(function(){throw o})}function Kf(o,s){var a=s,et=0;do{var tt=a.nextSibling;if(o.removeChild(a),tt&&tt.nodeType===8)if(a=tt.data,a==="/$"){if(et===0){o.removeChild(tt),bd(s);return}et--}else a!=="$"&&a!=="$?"&&a!=="$!"||et++;a=tt}while(a);bd(s)}function Lf(o){for(;o!=null;o=o.nextSibling){var s=o.nodeType;if(s===1||s===3)break;if(s===8){if(s=o.data,s==="$"||s==="$!"||s==="$?")break;if(s==="/$")return null}}return o}function Mf(o){o=o.previousSibling;for(var s=0;o;){if(o.nodeType===8){var a=o.data;if(a==="$"||a==="$!"||a==="$?"){if(s===0)return o;s--}else a==="/$"&&s++}o=o.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(o){var s=o[Of];if(s)return s;for(var a=o.parentNode;a;){if(s=a[uf]||a[Of]){if(a=s.alternate,s.child!==null||a!==null&&a.child!==null)for(o=Mf(o);o!==null;){if(a=o[Of])return a;o=Mf(o)}return s}o=a,a=o.parentNode}return null}function Cb(o){return o=o[Of]||o[uf],!o||o.tag!==5&&o.tag!==6&&o.tag!==13&&o.tag!==3?null:o}function ue(o){if(o.tag===5||o.tag===6)return o.stateNode;throw Error(p$2(33))}function Db(o){return o[Pf]||null}var Sf=[],Tf=-1;function Uf(o){return{current:o}}function E$1(o){0>Tf||(o.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G$1(o,s){Tf++,Sf[Tf]=o.current,o.current=s}var Vf={},H$1=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(o,s){var a=o.type.contextTypes;if(!a)return Vf;var et=o.stateNode;if(et&&et.__reactInternalMemoizedUnmaskedChildContext===s)return et.__reactInternalMemoizedMaskedChildContext;var tt={},rt;for(rt in a)tt[rt]=s[rt];return et&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=s,o.__reactInternalMemoizedMaskedChildContext=tt),tt}function Zf(o){return o=o.childContextTypes,o!=null}function $f(){E$1(Wf),E$1(H$1)}function ag(o,s,a){if(H$1.current!==Vf)throw Error(p$2(168));G$1(H$1,s),G$1(Wf,a)}function bg(o,s,a){var et=o.stateNode;if(s=s.childContextTypes,typeof et.getChildContext!="function")return a;et=et.getChildContext();for(var tt in et)if(!(tt in s))throw Error(p$2(108,Ra(o)||"Unknown",tt));return A$1({},a,et)}function cg(o){return o=(o=o.stateNode)&&o.__reactInternalMemoizedMergedChildContext||Vf,Xf=H$1.current,G$1(H$1,o),G$1(Wf,Wf.current),!0}function dg(o,s,a){var et=o.stateNode;if(!et)throw Error(p$2(169));a?(o=bg(o,s,Xf),et.__reactInternalMemoizedMergedChildContext=o,E$1(Wf),E$1(H$1),G$1(H$1,o)):E$1(Wf),G$1(Wf,a)}var eg=null,fg=!1,gg=!1;function hg(o){eg===null?eg=[o]:eg.push(o)}function ig(o){fg=!0,hg(o)}function jg(){if(!gg&&eg!==null){gg=!0;var o=0,s=C$1;try{var a=eg;for(C$1=1;o<a.length;o++){var et=a[o];do et=et(!0);while(et!==null)}eg=null,fg=!1}catch(tt){throw eg!==null&&(eg=eg.slice(o+1)),ac(fc,jg),tt}finally{C$1=s,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(o,s){kg[lg++]=ng,kg[lg++]=mg,mg=o,ng=s}function ug(o,s,a){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=o;var et=rg;o=sg;var tt=32-oc(et)-1;et&=~(1<<tt),a+=1;var rt=32-oc(s)+tt;if(30<rt){var nt=tt-tt%5;rt=(et&(1<<nt)-1).toString(32),et>>=nt,tt-=nt,rg=1<<32-oc(s)+tt|a<<tt|et,sg=rt+o}else rg=1<<rt|a<<tt|et,sg=o}function vg(o){o.return!==null&&(tg(o,1),ug(o,1,0))}function wg(o){for(;o===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;o===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I$1=!1,zg=null;function Ag(o,s){var a=Bg(5,null,null,0);a.elementType="DELETED",a.stateNode=s,a.return=o,s=o.deletions,s===null?(o.deletions=[a],o.flags|=16):s.push(a)}function Cg(o,s){switch(o.tag){case 5:var a=o.type;return s=s.nodeType!==1||a.toLowerCase()!==s.nodeName.toLowerCase()?null:s,s!==null?(o.stateNode=s,xg=o,yg=Lf(s.firstChild),!0):!1;case 6:return s=o.pendingProps===""||s.nodeType!==3?null:s,s!==null?(o.stateNode=s,xg=o,yg=null,!0):!1;case 13:return s=s.nodeType!==8?null:s,s!==null?(a=qg!==null?{id:rg,overflow:sg}:null,o.memoizedState={dehydrated:s,treeContext:a,retryLane:1073741824},a=Bg(18,null,null,0),a.stateNode=s,a.return=o,o.child=a,xg=o,yg=null,!0):!1;default:return!1}}function Dg(o){return(o.mode&1)!==0&&(o.flags&128)===0}function Eg(o){if(I$1){var s=yg;if(s){var a=s;if(!Cg(o,s)){if(Dg(o))throw Error(p$2(418));s=Lf(a.nextSibling);var et=xg;s&&Cg(o,s)?Ag(et,a):(o.flags=o.flags&-4097|2,I$1=!1,xg=o)}}else{if(Dg(o))throw Error(p$2(418));o.flags=o.flags&-4097|2,I$1=!1,xg=o}}}function Fg(o){for(o=o.return;o!==null&&o.tag!==5&&o.tag!==3&&o.tag!==13;)o=o.return;xg=o}function Gg(o){if(o!==xg)return!1;if(!I$1)return Fg(o),I$1=!0,!1;var s;if((s=o.tag!==3)&&!(s=o.tag!==5)&&(s=o.type,s=s!=="head"&&s!=="body"&&!Ef(o.type,o.memoizedProps)),s&&(s=yg)){if(Dg(o))throw Hg(),Error(p$2(418));for(;s;)Ag(o,s),s=Lf(s.nextSibling)}if(Fg(o),o.tag===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(p$2(317));e:{for(o=o.nextSibling,s=0;o;){if(o.nodeType===8){var a=o.data;if(a==="/$"){if(s===0){yg=Lf(o.nextSibling);break e}s--}else a!=="$"&&a!=="$!"&&a!=="$?"||s++}o=o.nextSibling}yg=null}}else yg=xg?Lf(o.stateNode.nextSibling):null;return!0}function Hg(){for(var o=yg;o;)o=Lf(o.nextSibling)}function Ig(){yg=xg=null,I$1=!1}function Jg(o){zg===null?zg=[o]:zg.push(o)}var Kg=ua.ReactCurrentBatchConfig;function Lg(o,s,a){if(o=a.ref,o!==null&&typeof o!="function"&&typeof o!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(p$2(309));var et=a.stateNode}if(!et)throw Error(p$2(147,o));var tt=et,rt=""+o;return s!==null&&s.ref!==null&&typeof s.ref=="function"&&s.ref._stringRef===rt?s.ref:(s=function(nt){var it=tt.refs;nt===null?delete it[rt]:it[rt]=nt},s._stringRef=rt,s)}if(typeof o!="string")throw Error(p$2(284));if(!a._owner)throw Error(p$2(290,o))}return o}function Mg(o,s){throw o=Object.prototype.toString.call(s),Error(p$2(31,o==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":o))}function Ng(o){var s=o._init;return s(o._payload)}function Og(o){function s(gt,mt){if(o){var yt=gt.deletions;yt===null?(gt.deletions=[mt],gt.flags|=16):yt.push(mt)}}function a(gt,mt){if(!o)return null;for(;mt!==null;)s(gt,mt),mt=mt.sibling;return null}function et(gt,mt){for(gt=new Map;mt!==null;)mt.key!==null?gt.set(mt.key,mt):gt.set(mt.index,mt),mt=mt.sibling;return gt}function tt(gt,mt){return gt=Pg(gt,mt),gt.index=0,gt.sibling=null,gt}function rt(gt,mt,yt){return gt.index=yt,o?(yt=gt.alternate,yt!==null?(yt=yt.index,yt<mt?(gt.flags|=2,mt):yt):(gt.flags|=2,mt)):(gt.flags|=1048576,mt)}function nt(gt){return o&&gt.alternate===null&&(gt.flags|=2),gt}function it(gt,mt,yt,vt){return mt===null||mt.tag!==6?(mt=Qg(yt,gt.mode,vt),mt.return=gt,mt):(mt=tt(mt,yt),mt.return=gt,mt)}function st(gt,mt,yt,vt){var Et=yt.type;return Et===ya?at(gt,mt,yt.props.children,vt,yt.key):mt!==null&&(mt.elementType===Et||typeof Et=="object"&&Et!==null&&Et.$$typeof===Ha&&Ng(Et)===mt.type)?(vt=tt(mt,yt.props),vt.ref=Lg(gt,mt,yt),vt.return=gt,vt):(vt=Rg(yt.type,yt.key,yt.props,null,gt.mode,vt),vt.ref=Lg(gt,mt,yt),vt.return=gt,vt)}function ot(gt,mt,yt,vt){return mt===null||mt.tag!==4||mt.stateNode.containerInfo!==yt.containerInfo||mt.stateNode.implementation!==yt.implementation?(mt=Sg(yt,gt.mode,vt),mt.return=gt,mt):(mt=tt(mt,yt.children||[]),mt.return=gt,mt)}function at(gt,mt,yt,vt,Et){return mt===null||mt.tag!==7?(mt=Tg(yt,gt.mode,vt,Et),mt.return=gt,mt):(mt=tt(mt,yt),mt.return=gt,mt)}function lt(gt,mt,yt){if(typeof mt=="string"&&mt!==""||typeof mt=="number")return mt=Qg(""+mt,gt.mode,yt),mt.return=gt,mt;if(typeof mt=="object"&&mt!==null){switch(mt.$$typeof){case va:return yt=Rg(mt.type,mt.key,mt.props,null,gt.mode,yt),yt.ref=Lg(gt,null,mt),yt.return=gt,yt;case wa:return mt=Sg(mt,gt.mode,yt),mt.return=gt,mt;case Ha:var vt=mt._init;return lt(gt,vt(mt._payload),yt)}if(eb(mt)||Ka(mt))return mt=Tg(mt,gt.mode,yt,null),mt.return=gt,mt;Mg(gt,mt)}return null}function ct(gt,mt,yt,vt){var Et=mt!==null?mt.key:null;if(typeof yt=="string"&&yt!==""||typeof yt=="number")return Et!==null?null:it(gt,mt,""+yt,vt);if(typeof yt=="object"&&yt!==null){switch(yt.$$typeof){case va:return yt.key===Et?st(gt,mt,yt,vt):null;case wa:return yt.key===Et?ot(gt,mt,yt,vt):null;case Ha:return Et=yt._init,ct(gt,mt,Et(yt._payload),vt)}if(eb(yt)||Ka(yt))return Et!==null?null:at(gt,mt,yt,vt,null);Mg(gt,yt)}return null}function ht(gt,mt,yt,vt,Et){if(typeof vt=="string"&&vt!==""||typeof vt=="number")return gt=gt.get(yt)||null,it(mt,gt,""+vt,Et);if(typeof vt=="object"&&vt!==null){switch(vt.$$typeof){case va:return gt=gt.get(vt.key===null?yt:vt.key)||null,st(mt,gt,vt,Et);case wa:return gt=gt.get(vt.key===null?yt:vt.key)||null,ot(mt,gt,vt,Et);case Ha:var xt=vt._init;return ht(gt,mt,yt,xt(vt._payload),Et)}if(eb(vt)||Ka(vt))return gt=gt.get(yt)||null,at(mt,gt,vt,Et,null);Mg(mt,vt)}return null}function ft(gt,mt,yt,vt){for(var Et=null,xt=null,wt=mt,Rt=mt=0,Ct=null;wt!==null&&Rt<yt.length;Rt++){wt.index>Rt?(Ct=wt,wt=null):Ct=wt.sibling;var Ft=ct(gt,wt,yt[Rt],vt);if(Ft===null){wt===null&&(wt=Ct);break}o&&wt&&Ft.alternate===null&&s(gt,wt),mt=rt(Ft,mt,Rt),xt===null?Et=Ft:xt.sibling=Ft,xt=Ft,wt=Ct}if(Rt===yt.length)return a(gt,wt),I$1&&tg(gt,Rt),Et;if(wt===null){for(;Rt<yt.length;Rt++)wt=lt(gt,yt[Rt],vt),wt!==null&&(mt=rt(wt,mt,Rt),xt===null?Et=wt:xt.sibling=wt,xt=wt);return I$1&&tg(gt,Rt),Et}for(wt=et(gt,wt);Rt<yt.length;Rt++)Ct=ht(wt,gt,Rt,yt[Rt],vt),Ct!==null&&(o&&Ct.alternate!==null&&wt.delete(Ct.key===null?Rt:Ct.key),mt=rt(Ct,mt,Rt),xt===null?Et=Ct:xt.sibling=Ct,xt=Ct);return o&&wt.forEach(function(zt){return s(gt,zt)}),I$1&&tg(gt,Rt),Et}function dt(gt,mt,yt,vt){var Et=Ka(yt);if(typeof Et!="function")throw Error(p$2(150));if(yt=Et.call(yt),yt==null)throw Error(p$2(151));for(var xt=Et=null,wt=mt,Rt=mt=0,Ct=null,Ft=yt.next();wt!==null&&!Ft.done;Rt++,Ft=yt.next()){wt.index>Rt?(Ct=wt,wt=null):Ct=wt.sibling;var zt=ct(gt,wt,Ft.value,vt);if(zt===null){wt===null&&(wt=Ct);break}o&&wt&&zt.alternate===null&&s(gt,wt),mt=rt(zt,mt,Rt),xt===null?Et=zt:xt.sibling=zt,xt=zt,wt=Ct}if(Ft.done)return a(gt,wt),I$1&&tg(gt,Rt),Et;if(wt===null){for(;!Ft.done;Rt++,Ft=yt.next())Ft=lt(gt,Ft.value,vt),Ft!==null&&(mt=rt(Ft,mt,Rt),xt===null?Et=Ft:xt.sibling=Ft,xt=Ft);return I$1&&tg(gt,Rt),Et}for(wt=et(gt,wt);!Ft.done;Rt++,Ft=yt.next())Ft=ht(wt,gt,Rt,Ft.value,vt),Ft!==null&&(o&&Ft.alternate!==null&&wt.delete(Ft.key===null?Rt:Ft.key),mt=rt(Ft,mt,Rt),xt===null?Et=Ft:xt.sibling=Ft,xt=Ft);return o&&wt.forEach(function(Nt){return s(gt,Nt)}),I$1&&tg(gt,Rt),Et}function pt(gt,mt,yt,vt){if(typeof yt=="object"&&yt!==null&&yt.type===ya&&yt.key===null&&(yt=yt.props.children),typeof yt=="object"&&yt!==null){switch(yt.$$typeof){case va:e:{for(var Et=yt.key,xt=mt;xt!==null;){if(xt.key===Et){if(Et=yt.type,Et===ya){if(xt.tag===7){a(gt,xt.sibling),mt=tt(xt,yt.props.children),mt.return=gt,gt=mt;break e}}else if(xt.elementType===Et||typeof Et=="object"&&Et!==null&&Et.$$typeof===Ha&&Ng(Et)===xt.type){a(gt,xt.sibling),mt=tt(xt,yt.props),mt.ref=Lg(gt,xt,yt),mt.return=gt,gt=mt;break e}a(gt,xt);break}else s(gt,xt);xt=xt.sibling}yt.type===ya?(mt=Tg(yt.props.children,gt.mode,vt,yt.key),mt.return=gt,gt=mt):(vt=Rg(yt.type,yt.key,yt.props,null,gt.mode,vt),vt.ref=Lg(gt,mt,yt),vt.return=gt,gt=vt)}return nt(gt);case wa:e:{for(xt=yt.key;mt!==null;){if(mt.key===xt)if(mt.tag===4&&mt.stateNode.containerInfo===yt.containerInfo&&mt.stateNode.implementation===yt.implementation){a(gt,mt.sibling),mt=tt(mt,yt.children||[]),mt.return=gt,gt=mt;break e}else{a(gt,mt);break}else s(gt,mt);mt=mt.sibling}mt=Sg(yt,gt.mode,vt),mt.return=gt,gt=mt}return nt(gt);case Ha:return xt=yt._init,pt(gt,mt,xt(yt._payload),vt)}if(eb(yt))return ft(gt,mt,yt,vt);if(Ka(yt))return dt(gt,mt,yt,vt);Mg(gt,yt)}return typeof yt=="string"&&yt!==""||typeof yt=="number"?(yt=""+yt,mt!==null&&mt.tag===6?(a(gt,mt.sibling),mt=tt(mt,yt),mt.return=gt,gt=mt):(a(gt,mt),mt=Qg(yt,gt.mode,vt),mt.return=gt,gt=mt),nt(gt)):a(gt,mt)}return pt}var Ug=Og(!0),Vg=Og(!1),Wg=Uf(null),Xg=null,Yg=null,Zg=null;function $g(){Zg=Yg=Xg=null}function ah(o){var s=Wg.current;E$1(Wg),o._currentValue=s}function bh(o,s,a){for(;o!==null;){var et=o.alternate;if((o.childLanes&s)!==s?(o.childLanes|=s,et!==null&&(et.childLanes|=s)):et!==null&&(et.childLanes&s)!==s&&(et.childLanes|=s),o===a)break;o=o.return}}function ch(o,s){Xg=o,Zg=Yg=null,o=o.dependencies,o!==null&&o.firstContext!==null&&(o.lanes&s&&(dh=!0),o.firstContext=null)}function eh(o){var s=o._currentValue;if(Zg!==o)if(o={context:o,memoizedValue:s,next:null},Yg===null){if(Xg===null)throw Error(p$2(308));Yg=o,Xg.dependencies={lanes:0,firstContext:o}}else Yg=Yg.next=o;return s}var fh=null;function gh(o){fh===null?fh=[o]:fh.push(o)}function hh(o,s,a,et){var tt=s.interleaved;return tt===null?(a.next=a,gh(s)):(a.next=tt.next,tt.next=a),s.interleaved=a,ih(o,et)}function ih(o,s){o.lanes|=s;var a=o.alternate;for(a!==null&&(a.lanes|=s),a=o,o=o.return;o!==null;)o.childLanes|=s,a=o.alternate,a!==null&&(a.childLanes|=s),a=o,o=o.return;return a.tag===3?a.stateNode:null}var jh=!1;function kh(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lh(o,s){o=o.updateQueue,s.updateQueue===o&&(s.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,effects:o.effects})}function mh(o,s){return{eventTime:o,lane:s,tag:0,payload:null,callback:null,next:null}}function nh(o,s,a){var et=o.updateQueue;if(et===null)return null;if(et=et.shared,K$2&2){var tt=et.pending;return tt===null?s.next=s:(s.next=tt.next,tt.next=s),et.pending=s,ih(o,a)}return tt=et.interleaved,tt===null?(s.next=s,gh(et)):(s.next=tt.next,tt.next=s),et.interleaved=s,ih(o,a)}function oh(o,s,a){if(s=s.updateQueue,s!==null&&(s=s.shared,(a&4194240)!==0)){var et=s.lanes;et&=o.pendingLanes,a|=et,s.lanes=a,Cc(o,a)}}function ph(o,s){var a=o.updateQueue,et=o.alternate;if(et!==null&&(et=et.updateQueue,a===et)){var tt=null,rt=null;if(a=a.firstBaseUpdate,a!==null){do{var nt={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};rt===null?tt=rt=nt:rt=rt.next=nt,a=a.next}while(a!==null);rt===null?tt=rt=s:rt=rt.next=s}else tt=rt=s;a={baseState:et.baseState,firstBaseUpdate:tt,lastBaseUpdate:rt,shared:et.shared,effects:et.effects},o.updateQueue=a;return}o=a.lastBaseUpdate,o===null?a.firstBaseUpdate=s:o.next=s,a.lastBaseUpdate=s}function qh(o,s,a,et){var tt=o.updateQueue;jh=!1;var rt=tt.firstBaseUpdate,nt=tt.lastBaseUpdate,it=tt.shared.pending;if(it!==null){tt.shared.pending=null;var st=it,ot=st.next;st.next=null,nt===null?rt=ot:nt.next=ot,nt=st;var at=o.alternate;at!==null&&(at=at.updateQueue,it=at.lastBaseUpdate,it!==nt&&(it===null?at.firstBaseUpdate=ot:it.next=ot,at.lastBaseUpdate=st))}if(rt!==null){var lt=tt.baseState;nt=0,at=ot=st=null,it=rt;do{var ct=it.lane,ht=it.eventTime;if((et&ct)===ct){at!==null&&(at=at.next={eventTime:ht,lane:0,tag:it.tag,payload:it.payload,callback:it.callback,next:null});e:{var ft=o,dt=it;switch(ct=s,ht=a,dt.tag){case 1:if(ft=dt.payload,typeof ft=="function"){lt=ft.call(ht,lt,ct);break e}lt=ft;break e;case 3:ft.flags=ft.flags&-65537|128;case 0:if(ft=dt.payload,ct=typeof ft=="function"?ft.call(ht,lt,ct):ft,ct==null)break e;lt=A$1({},lt,ct);break e;case 2:jh=!0}}it.callback!==null&&it.lane!==0&&(o.flags|=64,ct=tt.effects,ct===null?tt.effects=[it]:ct.push(it))}else ht={eventTime:ht,lane:ct,tag:it.tag,payload:it.payload,callback:it.callback,next:null},at===null?(ot=at=ht,st=lt):at=at.next=ht,nt|=ct;if(it=it.next,it===null){if(it=tt.shared.pending,it===null)break;ct=it,it=ct.next,ct.next=null,tt.lastBaseUpdate=ct,tt.shared.pending=null}}while(!0);if(at===null&&(st=lt),tt.baseState=st,tt.firstBaseUpdate=ot,tt.lastBaseUpdate=at,s=tt.shared.interleaved,s!==null){tt=s;do nt|=tt.lane,tt=tt.next;while(tt!==s)}else rt===null&&(tt.shared.lanes=0);rh|=nt,o.lanes=nt,o.memoizedState=lt}}function sh(o,s,a){if(o=s.effects,s.effects=null,o!==null)for(s=0;s<o.length;s++){var et=o[s],tt=et.callback;if(tt!==null){if(et.callback=null,et=a,typeof tt!="function")throw Error(p$2(191,tt));tt.call(et)}}}var th={},uh=Uf(th),vh=Uf(th),wh=Uf(th);function xh(o){if(o===th)throw Error(p$2(174));return o}function yh(o,s){switch(G$1(wh,s),G$1(vh,o),G$1(uh,th),o=s.nodeType,o){case 9:case 11:s=(s=s.documentElement)?s.namespaceURI:lb(null,"");break;default:o=o===8?s.parentNode:s,s=o.namespaceURI||null,o=o.tagName,s=lb(s,o)}E$1(uh),G$1(uh,s)}function zh(){E$1(uh),E$1(vh),E$1(wh)}function Ah(o){xh(wh.current);var s=xh(uh.current),a=lb(s,o.type);s!==a&&(G$1(vh,o),G$1(uh,a))}function Bh(o){vh.current===o&&(E$1(uh),E$1(vh))}var L$1=Uf(0);function Ch(o){for(var s=o;s!==null;){if(s.tag===13){var a=s.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if(s.flags&128)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===o)break;for(;s.sibling===null;){if(s.return===null||s.return===o)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Dh=[];function Eh(){for(var o=0;o<Dh.length;o++)Dh[o]._workInProgressVersionPrimary=null;Dh.length=0}var Fh=ua.ReactCurrentDispatcher,Gh=ua.ReactCurrentBatchConfig,Hh=0,M$1=null,N$1=null,O=null,Ih=!1,Jh=!1,Kh=0,Lh=0;function P(){throw Error(p$2(321))}function Mh(o,s){if(s===null)return!1;for(var a=0;a<s.length&&a<o.length;a++)if(!He(o[a],s[a]))return!1;return!0}function Nh(o,s,a,et,tt,rt){if(Hh=rt,M$1=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Fh.current=o===null||o.memoizedState===null?Oh:Ph,o=a(et,tt),Jh){rt=0;do{if(Jh=!1,Kh=0,25<=rt)throw Error(p$2(301));rt+=1,O=N$1=null,s.updateQueue=null,Fh.current=Qh,o=a(et,tt)}while(Jh)}if(Fh.current=Rh,s=N$1!==null&&N$1.next!==null,Hh=0,O=N$1=M$1=null,Ih=!1,s)throw Error(p$2(300));return o}function Sh(){var o=Kh!==0;return Kh=0,o}function Th(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return O===null?M$1.memoizedState=O=o:O=O.next=o,O}function Uh(){if(N$1===null){var o=M$1.alternate;o=o!==null?o.memoizedState:null}else o=N$1.next;var s=O===null?M$1.memoizedState:O.next;if(s!==null)O=s,N$1=o;else{if(o===null)throw Error(p$2(310));N$1=o,o={memoizedState:N$1.memoizedState,baseState:N$1.baseState,baseQueue:N$1.baseQueue,queue:N$1.queue,next:null},O===null?M$1.memoizedState=O=o:O=O.next=o}return O}function Vh(o,s){return typeof s=="function"?s(o):s}function Wh(o){var s=Uh(),a=s.queue;if(a===null)throw Error(p$2(311));a.lastRenderedReducer=o;var et=N$1,tt=et.baseQueue,rt=a.pending;if(rt!==null){if(tt!==null){var nt=tt.next;tt.next=rt.next,rt.next=nt}et.baseQueue=tt=rt,a.pending=null}if(tt!==null){rt=tt.next,et=et.baseState;var it=nt=null,st=null,ot=rt;do{var at=ot.lane;if((Hh&at)===at)st!==null&&(st=st.next={lane:0,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null}),et=ot.hasEagerState?ot.eagerState:o(et,ot.action);else{var lt={lane:at,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null};st===null?(it=st=lt,nt=et):st=st.next=lt,M$1.lanes|=at,rh|=at}ot=ot.next}while(ot!==null&&ot!==rt);st===null?nt=et:st.next=it,He(et,s.memoizedState)||(dh=!0),s.memoizedState=et,s.baseState=nt,s.baseQueue=st,a.lastRenderedState=et}if(o=a.interleaved,o!==null){tt=o;do rt=tt.lane,M$1.lanes|=rt,rh|=rt,tt=tt.next;while(tt!==o)}else tt===null&&(a.lanes=0);return[s.memoizedState,a.dispatch]}function Xh(o){var s=Uh(),a=s.queue;if(a===null)throw Error(p$2(311));a.lastRenderedReducer=o;var et=a.dispatch,tt=a.pending,rt=s.memoizedState;if(tt!==null){a.pending=null;var nt=tt=tt.next;do rt=o(rt,nt.action),nt=nt.next;while(nt!==tt);He(rt,s.memoizedState)||(dh=!0),s.memoizedState=rt,s.baseQueue===null&&(s.baseState=rt),a.lastRenderedState=rt}return[rt,et]}function Yh(){}function Zh(o,s){var a=M$1,et=Uh(),tt=s(),rt=!He(et.memoizedState,tt);if(rt&&(et.memoizedState=tt,dh=!0),et=et.queue,$h(ai.bind(null,a,et,o),[o]),et.getSnapshot!==s||rt||O!==null&&O.memoizedState.tag&1){if(a.flags|=2048,bi(9,ci.bind(null,a,et,tt,s),void 0,null),Q$1===null)throw Error(p$2(349));Hh&30||di(a,s,tt)}return tt}function di(o,s,a){o.flags|=16384,o={getSnapshot:s,value:a},s=M$1.updateQueue,s===null?(s={lastEffect:null,stores:null},M$1.updateQueue=s,s.stores=[o]):(a=s.stores,a===null?s.stores=[o]:a.push(o))}function ci(o,s,a,et){s.value=a,s.getSnapshot=et,ei(s)&&fi(o)}function ai(o,s,a){return a(function(){ei(s)&&fi(o)})}function ei(o){var s=o.getSnapshot;o=o.value;try{var a=s();return!He(o,a)}catch{return!0}}function fi(o){var s=ih(o,1);s!==null&&gi(s,o,1,-1)}function hi(o){var s=Th();return typeof o=="function"&&(o=o()),s.memoizedState=s.baseState=o,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vh,lastRenderedState:o},s.queue=o,o=o.dispatch=ii.bind(null,M$1,o),[s.memoizedState,o]}function bi(o,s,a,et){return o={tag:o,create:s,destroy:a,deps:et,next:null},s=M$1.updateQueue,s===null?(s={lastEffect:null,stores:null},M$1.updateQueue=s,s.lastEffect=o.next=o):(a=s.lastEffect,a===null?s.lastEffect=o.next=o:(et=a.next,a.next=o,o.next=et,s.lastEffect=o)),o}function ji(){return Uh().memoizedState}function ki(o,s,a,et){var tt=Th();M$1.flags|=o,tt.memoizedState=bi(1|s,a,void 0,et===void 0?null:et)}function li(o,s,a,et){var tt=Uh();et=et===void 0?null:et;var rt=void 0;if(N$1!==null){var nt=N$1.memoizedState;if(rt=nt.destroy,et!==null&&Mh(et,nt.deps)){tt.memoizedState=bi(s,a,rt,et);return}}M$1.flags|=o,tt.memoizedState=bi(1|s,a,rt,et)}function mi(o,s){return ki(8390656,8,o,s)}function $h(o,s){return li(2048,8,o,s)}function ni(o,s){return li(4,2,o,s)}function oi(o,s){return li(4,4,o,s)}function pi(o,s){if(typeof s=="function")return o=o(),s(o),function(){s(null)};if(s!=null)return o=o(),s.current=o,function(){s.current=null}}function qi(o,s,a){return a=a!=null?a.concat([o]):null,li(4,4,pi.bind(null,s,o),a)}function ri(){}function si(o,s){var a=Uh();s=s===void 0?null:s;var et=a.memoizedState;return et!==null&&s!==null&&Mh(s,et[1])?et[0]:(a.memoizedState=[o,s],o)}function ti(o,s){var a=Uh();s=s===void 0?null:s;var et=a.memoizedState;return et!==null&&s!==null&&Mh(s,et[1])?et[0]:(o=o(),a.memoizedState=[o,s],o)}function ui$1(o,s,a){return Hh&21?(He(a,s)||(a=yc(),M$1.lanes|=a,rh|=a,o.baseState=!0),s):(o.baseState&&(o.baseState=!1,dh=!0),o.memoizedState=a)}function vi(o,s){var a=C$1;C$1=a!==0&&4>a?a:4,o(!0);var et=Gh.transition;Gh.transition={};try{o(!1),s()}finally{C$1=a,Gh.transition=et}}function wi(){return Uh().memoizedState}function xi(o,s,a){var et=yi(o);if(a={lane:et,action:a,hasEagerState:!1,eagerState:null,next:null},zi(o))Ai(s,a);else if(a=hh(o,s,a,et),a!==null){var tt=R$1();gi(a,o,et,tt),Bi(a,s,et)}}function ii(o,s,a){var et=yi(o),tt={lane:et,action:a,hasEagerState:!1,eagerState:null,next:null};if(zi(o))Ai(s,tt);else{var rt=o.alternate;if(o.lanes===0&&(rt===null||rt.lanes===0)&&(rt=s.lastRenderedReducer,rt!==null))try{var nt=s.lastRenderedState,it=rt(nt,a);if(tt.hasEagerState=!0,tt.eagerState=it,He(it,nt)){var st=s.interleaved;st===null?(tt.next=tt,gh(s)):(tt.next=st.next,st.next=tt),s.interleaved=tt;return}}catch{}finally{}a=hh(o,s,tt,et),a!==null&&(tt=R$1(),gi(a,o,et,tt),Bi(a,s,et))}}function zi(o){var s=o.alternate;return o===M$1||s!==null&&s===M$1}function Ai(o,s){Jh=Ih=!0;var a=o.pending;a===null?s.next=s:(s.next=a.next,a.next=s),o.pending=s}function Bi(o,s,a){if(a&4194240){var et=s.lanes;et&=o.pendingLanes,a|=et,s.lanes=a,Cc(o,a)}}var Rh={readContext:eh,useCallback:P,useContext:P,useEffect:P,useImperativeHandle:P,useInsertionEffect:P,useLayoutEffect:P,useMemo:P,useReducer:P,useRef:P,useState:P,useDebugValue:P,useDeferredValue:P,useTransition:P,useMutableSource:P,useSyncExternalStore:P,useId:P,unstable_isNewReconciler:!1},Oh={readContext:eh,useCallback:function(o,s){return Th().memoizedState=[o,s===void 0?null:s],o},useContext:eh,useEffect:mi,useImperativeHandle:function(o,s,a){return a=a!=null?a.concat([o]):null,ki(4194308,4,pi.bind(null,s,o),a)},useLayoutEffect:function(o,s){return ki(4194308,4,o,s)},useInsertionEffect:function(o,s){return ki(4,2,o,s)},useMemo:function(o,s){var a=Th();return s=s===void 0?null:s,o=o(),a.memoizedState=[o,s],o},useReducer:function(o,s,a){var et=Th();return s=a!==void 0?a(s):s,et.memoizedState=et.baseState=s,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:s},et.queue=o,o=o.dispatch=xi.bind(null,M$1,o),[et.memoizedState,o]},useRef:function(o){var s=Th();return o={current:o},s.memoizedState=o},useState:hi,useDebugValue:ri,useDeferredValue:function(o){return Th().memoizedState=o},useTransition:function(){var o=hi(!1),s=o[0];return o=vi.bind(null,o[1]),Th().memoizedState=o,[s,o]},useMutableSource:function(){},useSyncExternalStore:function(o,s,a){var et=M$1,tt=Th();if(I$1){if(a===void 0)throw Error(p$2(407));a=a()}else{if(a=s(),Q$1===null)throw Error(p$2(349));Hh&30||di(et,s,a)}tt.memoizedState=a;var rt={value:a,getSnapshot:s};return tt.queue=rt,mi(ai.bind(null,et,rt,o),[o]),et.flags|=2048,bi(9,ci.bind(null,et,rt,a,s),void 0,null),a},useId:function(){var o=Th(),s=Q$1.identifierPrefix;if(I$1){var a=sg,et=rg;a=(et&~(1<<32-oc(et)-1)).toString(32)+a,s=":"+s+"R"+a,a=Kh++,0<a&&(s+="H"+a.toString(32)),s+=":"}else a=Lh++,s=":"+s+"r"+a.toString(32)+":";return o.memoizedState=s},unstable_isNewReconciler:!1},Ph={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Wh,useRef:ji,useState:function(){return Wh(Vh)},useDebugValue:ri,useDeferredValue:function(o){var s=Uh();return ui$1(s,N$1.memoizedState,o)},useTransition:function(){var o=Wh(Vh)[0],s=Uh().memoizedState;return[o,s]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1},Qh={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Xh,useRef:ji,useState:function(){return Xh(Vh)},useDebugValue:ri,useDeferredValue:function(o){var s=Uh();return N$1===null?s.memoizedState=o:ui$1(s,N$1.memoizedState,o)},useTransition:function(){var o=Xh(Vh)[0],s=Uh().memoizedState;return[o,s]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1};function Ci(o,s){if(o&&o.defaultProps){s=A$1({},s),o=o.defaultProps;for(var a in o)s[a]===void 0&&(s[a]=o[a]);return s}return s}function Di(o,s,a,et){s=o.memoizedState,a=a(et,s),a=a==null?s:A$1({},s,a),o.memoizedState=a,o.lanes===0&&(o.updateQueue.baseState=a)}var Ei={isMounted:function(o){return(o=o._reactInternals)?Vb(o)===o:!1},enqueueSetState:function(o,s,a){o=o._reactInternals;var et=R$1(),tt=yi(o),rt=mh(et,tt);rt.payload=s,a!=null&&(rt.callback=a),s=nh(o,rt,tt),s!==null&&(gi(s,o,tt,et),oh(s,o,tt))},enqueueReplaceState:function(o,s,a){o=o._reactInternals;var et=R$1(),tt=yi(o),rt=mh(et,tt);rt.tag=1,rt.payload=s,a!=null&&(rt.callback=a),s=nh(o,rt,tt),s!==null&&(gi(s,o,tt,et),oh(s,o,tt))},enqueueForceUpdate:function(o,s){o=o._reactInternals;var a=R$1(),et=yi(o),tt=mh(a,et);tt.tag=2,s!=null&&(tt.callback=s),s=nh(o,tt,et),s!==null&&(gi(s,o,et,a),oh(s,o,et))}};function Fi(o,s,a,et,tt,rt,nt){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(et,rt,nt):s.prototype&&s.prototype.isPureReactComponent?!Ie(a,et)||!Ie(tt,rt):!0}function Gi(o,s,a){var et=!1,tt=Vf,rt=s.contextType;return typeof rt=="object"&&rt!==null?rt=eh(rt):(tt=Zf(s)?Xf:H$1.current,et=s.contextTypes,rt=(et=et!=null)?Yf(o,tt):Vf),s=new s(a,rt),o.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=Ei,o.stateNode=s,s._reactInternals=o,et&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=tt,o.__reactInternalMemoizedMaskedChildContext=rt),s}function Hi(o,s,a,et){o=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(a,et),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(a,et),s.state!==o&&Ei.enqueueReplaceState(s,s.state,null)}function Ii(o,s,a,et){var tt=o.stateNode;tt.props=a,tt.state=o.memoizedState,tt.refs={},kh(o);var rt=s.contextType;typeof rt=="object"&&rt!==null?tt.context=eh(rt):(rt=Zf(s)?Xf:H$1.current,tt.context=Yf(o,rt)),tt.state=o.memoizedState,rt=s.getDerivedStateFromProps,typeof rt=="function"&&(Di(o,s,rt,a),tt.state=o.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof tt.getSnapshotBeforeUpdate=="function"||typeof tt.UNSAFE_componentWillMount!="function"&&typeof tt.componentWillMount!="function"||(s=tt.state,typeof tt.componentWillMount=="function"&&tt.componentWillMount(),typeof tt.UNSAFE_componentWillMount=="function"&&tt.UNSAFE_componentWillMount(),s!==tt.state&&Ei.enqueueReplaceState(tt,tt.state,null),qh(o,a,tt,et),tt.state=o.memoizedState),typeof tt.componentDidMount=="function"&&(o.flags|=4194308)}function Ji(o,s){try{var a="",et=s;do a+=Pa(et),et=et.return;while(et);var tt=a}catch(rt){tt=`
Error generating stack: `+rt.message+`
`+rt.stack}return{value:o,source:s,stack:tt,digest:null}}function Ki(o,s,a){return{value:o,source:null,stack:a??null,digest:s??null}}function Li(o,s){try{console.error(s.value)}catch(a){setTimeout(function(){throw a})}}var Mi=typeof WeakMap=="function"?WeakMap:Map;function Ni(o,s,a){a=mh(-1,a),a.tag=3,a.payload={element:null};var et=s.value;return a.callback=function(){Oi||(Oi=!0,Pi=et),Li(o,s)},a}function Qi(o,s,a){a=mh(-1,a),a.tag=3;var et=o.type.getDerivedStateFromError;if(typeof et=="function"){var tt=s.value;a.payload=function(){return et(tt)},a.callback=function(){Li(o,s)}}var rt=o.stateNode;return rt!==null&&typeof rt.componentDidCatch=="function"&&(a.callback=function(){Li(o,s),typeof et!="function"&&(Ri===null?Ri=new Set([this]):Ri.add(this));var nt=s.stack;this.componentDidCatch(s.value,{componentStack:nt!==null?nt:""})}),a}function Si(o,s,a){var et=o.pingCache;if(et===null){et=o.pingCache=new Mi;var tt=new Set;et.set(s,tt)}else tt=et.get(s),tt===void 0&&(tt=new Set,et.set(s,tt));tt.has(a)||(tt.add(a),o=Ti.bind(null,o,s,a),s.then(o,o))}function Ui(o){do{var s;if((s=o.tag===13)&&(s=o.memoizedState,s=s!==null?s.dehydrated!==null:!0),s)return o;o=o.return}while(o!==null);return null}function Vi(o,s,a,et,tt){return o.mode&1?(o.flags|=65536,o.lanes=tt,o):(o===s?o.flags|=65536:(o.flags|=128,a.flags|=131072,a.flags&=-52805,a.tag===1&&(a.alternate===null?a.tag=17:(s=mh(-1,1),s.tag=2,nh(a,s,1))),a.lanes|=1),o)}var Wi=ua.ReactCurrentOwner,dh=!1;function Xi(o,s,a,et){s.child=o===null?Vg(s,null,a,et):Ug(s,o.child,a,et)}function Yi(o,s,a,et,tt){a=a.render;var rt=s.ref;return ch(s,tt),et=Nh(o,s,a,et,rt,tt),a=Sh(),o!==null&&!dh?(s.updateQueue=o.updateQueue,s.flags&=-2053,o.lanes&=~tt,Zi(o,s,tt)):(I$1&&a&&vg(s),s.flags|=1,Xi(o,s,et,tt),s.child)}function $i(o,s,a,et,tt){if(o===null){var rt=a.type;return typeof rt=="function"&&!aj(rt)&&rt.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(s.tag=15,s.type=rt,bj(o,s,rt,et,tt)):(o=Rg(a.type,null,et,s,s.mode,tt),o.ref=s.ref,o.return=s,s.child=o)}if(rt=o.child,!(o.lanes&tt)){var nt=rt.memoizedProps;if(a=a.compare,a=a!==null?a:Ie,a(nt,et)&&o.ref===s.ref)return Zi(o,s,tt)}return s.flags|=1,o=Pg(rt,et),o.ref=s.ref,o.return=s,s.child=o}function bj(o,s,a,et,tt){if(o!==null){var rt=o.memoizedProps;if(Ie(rt,et)&&o.ref===s.ref)if(dh=!1,s.pendingProps=et=rt,(o.lanes&tt)!==0)o.flags&131072&&(dh=!0);else return s.lanes=o.lanes,Zi(o,s,tt)}return cj(o,s,a,et,tt)}function dj(o,s,a){var et=s.pendingProps,tt=et.children,rt=o!==null?o.memoizedState:null;if(et.mode==="hidden")if(!(s.mode&1))s.memoizedState={baseLanes:0,cachePool:null,transitions:null},G$1(ej,fj),fj|=a;else{if(!(a&1073741824))return o=rt!==null?rt.baseLanes|a:a,s.lanes=s.childLanes=1073741824,s.memoizedState={baseLanes:o,cachePool:null,transitions:null},s.updateQueue=null,G$1(ej,fj),fj|=o,null;s.memoizedState={baseLanes:0,cachePool:null,transitions:null},et=rt!==null?rt.baseLanes:a,G$1(ej,fj),fj|=et}else rt!==null?(et=rt.baseLanes|a,s.memoizedState=null):et=a,G$1(ej,fj),fj|=et;return Xi(o,s,tt,a),s.child}function gj(o,s){var a=s.ref;(o===null&&a!==null||o!==null&&o.ref!==a)&&(s.flags|=512,s.flags|=2097152)}function cj(o,s,a,et,tt){var rt=Zf(a)?Xf:H$1.current;return rt=Yf(s,rt),ch(s,tt),a=Nh(o,s,a,et,rt,tt),et=Sh(),o!==null&&!dh?(s.updateQueue=o.updateQueue,s.flags&=-2053,o.lanes&=~tt,Zi(o,s,tt)):(I$1&&et&&vg(s),s.flags|=1,Xi(o,s,a,tt),s.child)}function hj(o,s,a,et,tt){if(Zf(a)){var rt=!0;cg(s)}else rt=!1;if(ch(s,tt),s.stateNode===null)ij(o,s),Gi(s,a,et),Ii(s,a,et,tt),et=!0;else if(o===null){var nt=s.stateNode,it=s.memoizedProps;nt.props=it;var st=nt.context,ot=a.contextType;typeof ot=="object"&&ot!==null?ot=eh(ot):(ot=Zf(a)?Xf:H$1.current,ot=Yf(s,ot));var at=a.getDerivedStateFromProps,lt=typeof at=="function"||typeof nt.getSnapshotBeforeUpdate=="function";lt||typeof nt.UNSAFE_componentWillReceiveProps!="function"&&typeof nt.componentWillReceiveProps!="function"||(it!==et||st!==ot)&&Hi(s,nt,et,ot),jh=!1;var ct=s.memoizedState;nt.state=ct,qh(s,et,nt,tt),st=s.memoizedState,it!==et||ct!==st||Wf.current||jh?(typeof at=="function"&&(Di(s,a,at,et),st=s.memoizedState),(it=jh||Fi(s,a,it,et,ct,st,ot))?(lt||typeof nt.UNSAFE_componentWillMount!="function"&&typeof nt.componentWillMount!="function"||(typeof nt.componentWillMount=="function"&&nt.componentWillMount(),typeof nt.UNSAFE_componentWillMount=="function"&&nt.UNSAFE_componentWillMount()),typeof nt.componentDidMount=="function"&&(s.flags|=4194308)):(typeof nt.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=et,s.memoizedState=st),nt.props=et,nt.state=st,nt.context=ot,et=it):(typeof nt.componentDidMount=="function"&&(s.flags|=4194308),et=!1)}else{nt=s.stateNode,lh(o,s),it=s.memoizedProps,ot=s.type===s.elementType?it:Ci(s.type,it),nt.props=ot,lt=s.pendingProps,ct=nt.context,st=a.contextType,typeof st=="object"&&st!==null?st=eh(st):(st=Zf(a)?Xf:H$1.current,st=Yf(s,st));var ht=a.getDerivedStateFromProps;(at=typeof ht=="function"||typeof nt.getSnapshotBeforeUpdate=="function")||typeof nt.UNSAFE_componentWillReceiveProps!="function"&&typeof nt.componentWillReceiveProps!="function"||(it!==lt||ct!==st)&&Hi(s,nt,et,st),jh=!1,ct=s.memoizedState,nt.state=ct,qh(s,et,nt,tt);var ft=s.memoizedState;it!==lt||ct!==ft||Wf.current||jh?(typeof ht=="function"&&(Di(s,a,ht,et),ft=s.memoizedState),(ot=jh||Fi(s,a,ot,et,ct,ft,st)||!1)?(at||typeof nt.UNSAFE_componentWillUpdate!="function"&&typeof nt.componentWillUpdate!="function"||(typeof nt.componentWillUpdate=="function"&&nt.componentWillUpdate(et,ft,st),typeof nt.UNSAFE_componentWillUpdate=="function"&&nt.UNSAFE_componentWillUpdate(et,ft,st)),typeof nt.componentDidUpdate=="function"&&(s.flags|=4),typeof nt.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof nt.componentDidUpdate!="function"||it===o.memoizedProps&&ct===o.memoizedState||(s.flags|=4),typeof nt.getSnapshotBeforeUpdate!="function"||it===o.memoizedProps&&ct===o.memoizedState||(s.flags|=1024),s.memoizedProps=et,s.memoizedState=ft),nt.props=et,nt.state=ft,nt.context=st,et=ot):(typeof nt.componentDidUpdate!="function"||it===o.memoizedProps&&ct===o.memoizedState||(s.flags|=4),typeof nt.getSnapshotBeforeUpdate!="function"||it===o.memoizedProps&&ct===o.memoizedState||(s.flags|=1024),et=!1)}return jj(o,s,a,et,rt,tt)}function jj(o,s,a,et,tt,rt){gj(o,s);var nt=(s.flags&128)!==0;if(!et&&!nt)return tt&&dg(s,a,!1),Zi(o,s,rt);et=s.stateNode,Wi.current=s;var it=nt&&typeof a.getDerivedStateFromError!="function"?null:et.render();return s.flags|=1,o!==null&&nt?(s.child=Ug(s,o.child,null,rt),s.child=Ug(s,null,it,rt)):Xi(o,s,it,rt),s.memoizedState=et.state,tt&&dg(s,a,!0),s.child}function kj(o){var s=o.stateNode;s.pendingContext?ag(o,s.pendingContext,s.pendingContext!==s.context):s.context&&ag(o,s.context,!1),yh(o,s.containerInfo)}function lj(o,s,a,et,tt){return Ig(),Jg(tt),s.flags|=256,Xi(o,s,a,et),s.child}var mj={dehydrated:null,treeContext:null,retryLane:0};function nj(o){return{baseLanes:o,cachePool:null,transitions:null}}function oj(o,s,a){var et=s.pendingProps,tt=L$1.current,rt=!1,nt=(s.flags&128)!==0,it;if((it=nt)||(it=o!==null&&o.memoizedState===null?!1:(tt&2)!==0),it?(rt=!0,s.flags&=-129):(o===null||o.memoizedState!==null)&&(tt|=1),G$1(L$1,tt&1),o===null)return Eg(s),o=s.memoizedState,o!==null&&(o=o.dehydrated,o!==null)?(s.mode&1?o.data==="$!"?s.lanes=8:s.lanes=1073741824:s.lanes=1,null):(nt=et.children,o=et.fallback,rt?(et=s.mode,rt=s.child,nt={mode:"hidden",children:nt},!(et&1)&&rt!==null?(rt.childLanes=0,rt.pendingProps=nt):rt=pj(nt,et,0,null),o=Tg(o,et,a,null),rt.return=s,o.return=s,rt.sibling=o,s.child=rt,s.child.memoizedState=nj(a),s.memoizedState=mj,o):qj(s,nt));if(tt=o.memoizedState,tt!==null&&(it=tt.dehydrated,it!==null))return rj(o,s,nt,et,it,tt,a);if(rt){rt=et.fallback,nt=s.mode,tt=o.child,it=tt.sibling;var st={mode:"hidden",children:et.children};return!(nt&1)&&s.child!==tt?(et=s.child,et.childLanes=0,et.pendingProps=st,s.deletions=null):(et=Pg(tt,st),et.subtreeFlags=tt.subtreeFlags&14680064),it!==null?rt=Pg(it,rt):(rt=Tg(rt,nt,a,null),rt.flags|=2),rt.return=s,et.return=s,et.sibling=rt,s.child=et,et=rt,rt=s.child,nt=o.child.memoizedState,nt=nt===null?nj(a):{baseLanes:nt.baseLanes|a,cachePool:null,transitions:nt.transitions},rt.memoizedState=nt,rt.childLanes=o.childLanes&~a,s.memoizedState=mj,et}return rt=o.child,o=rt.sibling,et=Pg(rt,{mode:"visible",children:et.children}),!(s.mode&1)&&(et.lanes=a),et.return=s,et.sibling=null,o!==null&&(a=s.deletions,a===null?(s.deletions=[o],s.flags|=16):a.push(o)),s.child=et,s.memoizedState=null,et}function qj(o,s){return s=pj({mode:"visible",children:s},o.mode,0,null),s.return=o,o.child=s}function sj(o,s,a,et){return et!==null&&Jg(et),Ug(s,o.child,null,a),o=qj(s,s.pendingProps.children),o.flags|=2,s.memoizedState=null,o}function rj(o,s,a,et,tt,rt,nt){if(a)return s.flags&256?(s.flags&=-257,et=Ki(Error(p$2(422))),sj(o,s,nt,et)):s.memoizedState!==null?(s.child=o.child,s.flags|=128,null):(rt=et.fallback,tt=s.mode,et=pj({mode:"visible",children:et.children},tt,0,null),rt=Tg(rt,tt,nt,null),rt.flags|=2,et.return=s,rt.return=s,et.sibling=rt,s.child=et,s.mode&1&&Ug(s,o.child,null,nt),s.child.memoizedState=nj(nt),s.memoizedState=mj,rt);if(!(s.mode&1))return sj(o,s,nt,null);if(tt.data==="$!"){if(et=tt.nextSibling&&tt.nextSibling.dataset,et)var it=et.dgst;return et=it,rt=Error(p$2(419)),et=Ki(rt,et,void 0),sj(o,s,nt,et)}if(it=(nt&o.childLanes)!==0,dh||it){if(et=Q$1,et!==null){switch(nt&-nt){case 4:tt=2;break;case 16:tt=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:tt=32;break;case 536870912:tt=268435456;break;default:tt=0}tt=tt&(et.suspendedLanes|nt)?0:tt,tt!==0&&tt!==rt.retryLane&&(rt.retryLane=tt,ih(o,tt),gi(et,o,tt,-1))}return tj(),et=Ki(Error(p$2(421))),sj(o,s,nt,et)}return tt.data==="$?"?(s.flags|=128,s.child=o.child,s=uj.bind(null,o),tt._reactRetry=s,null):(o=rt.treeContext,yg=Lf(tt.nextSibling),xg=s,I$1=!0,zg=null,o!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=o.id,sg=o.overflow,qg=s),s=qj(s,et.children),s.flags|=4096,s)}function vj(o,s,a){o.lanes|=s;var et=o.alternate;et!==null&&(et.lanes|=s),bh(o.return,s,a)}function wj(o,s,a,et,tt){var rt=o.memoizedState;rt===null?o.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:et,tail:a,tailMode:tt}:(rt.isBackwards=s,rt.rendering=null,rt.renderingStartTime=0,rt.last=et,rt.tail=a,rt.tailMode=tt)}function xj(o,s,a){var et=s.pendingProps,tt=et.revealOrder,rt=et.tail;if(Xi(o,s,et.children,a),et=L$1.current,et&2)et=et&1|2,s.flags|=128;else{if(o!==null&&o.flags&128)e:for(o=s.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&vj(o,a,s);else if(o.tag===19)vj(o,a,s);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===s)break e;for(;o.sibling===null;){if(o.return===null||o.return===s)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}et&=1}if(G$1(L$1,et),!(s.mode&1))s.memoizedState=null;else switch(tt){case"forwards":for(a=s.child,tt=null;a!==null;)o=a.alternate,o!==null&&Ch(o)===null&&(tt=a),a=a.sibling;a=tt,a===null?(tt=s.child,s.child=null):(tt=a.sibling,a.sibling=null),wj(s,!1,tt,a,rt);break;case"backwards":for(a=null,tt=s.child,s.child=null;tt!==null;){if(o=tt.alternate,o!==null&&Ch(o)===null){s.child=tt;break}o=tt.sibling,tt.sibling=a,a=tt,tt=o}wj(s,!0,a,null,rt);break;case"together":wj(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function ij(o,s){!(s.mode&1)&&o!==null&&(o.alternate=null,s.alternate=null,s.flags|=2)}function Zi(o,s,a){if(o!==null&&(s.dependencies=o.dependencies),rh|=s.lanes,!(a&s.childLanes))return null;if(o!==null&&s.child!==o.child)throw Error(p$2(153));if(s.child!==null){for(o=s.child,a=Pg(o,o.pendingProps),s.child=a,a.return=s;o.sibling!==null;)o=o.sibling,a=a.sibling=Pg(o,o.pendingProps),a.return=s;a.sibling=null}return s.child}function yj(o,s,a){switch(s.tag){case 3:kj(s),Ig();break;case 5:Ah(s);break;case 1:Zf(s.type)&&cg(s);break;case 4:yh(s,s.stateNode.containerInfo);break;case 10:var et=s.type._context,tt=s.memoizedProps.value;G$1(Wg,et._currentValue),et._currentValue=tt;break;case 13:if(et=s.memoizedState,et!==null)return et.dehydrated!==null?(G$1(L$1,L$1.current&1),s.flags|=128,null):a&s.child.childLanes?oj(o,s,a):(G$1(L$1,L$1.current&1),o=Zi(o,s,a),o!==null?o.sibling:null);G$1(L$1,L$1.current&1);break;case 19:if(et=(a&s.childLanes)!==0,o.flags&128){if(et)return xj(o,s,a);s.flags|=128}if(tt=s.memoizedState,tt!==null&&(tt.rendering=null,tt.tail=null,tt.lastEffect=null),G$1(L$1,L$1.current),et)break;return null;case 22:case 23:return s.lanes=0,dj(o,s,a)}return Zi(o,s,a)}var zj,Aj,Bj,Cj;zj=function(o,s){for(var a=s.child;a!==null;){if(a.tag===5||a.tag===6)o.appendChild(a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};Aj=function(){};Bj=function(o,s,a,et){var tt=o.memoizedProps;if(tt!==et){o=s.stateNode,xh(uh.current);var rt=null;switch(a){case"input":tt=Ya(o,tt),et=Ya(o,et),rt=[];break;case"select":tt=A$1({},tt,{value:void 0}),et=A$1({},et,{value:void 0}),rt=[];break;case"textarea":tt=gb(o,tt),et=gb(o,et),rt=[];break;default:typeof tt.onClick!="function"&&typeof et.onClick=="function"&&(o.onclick=Bf)}ub(a,et);var nt;a=null;for(ot in tt)if(!et.hasOwnProperty(ot)&&tt.hasOwnProperty(ot)&&tt[ot]!=null)if(ot==="style"){var it=tt[ot];for(nt in it)it.hasOwnProperty(nt)&&(a||(a={}),a[nt]="")}else ot!=="dangerouslySetInnerHTML"&&ot!=="children"&&ot!=="suppressContentEditableWarning"&&ot!=="suppressHydrationWarning"&&ot!=="autoFocus"&&(ea.hasOwnProperty(ot)?rt||(rt=[]):(rt=rt||[]).push(ot,null));for(ot in et){var st=et[ot];if(it=tt?.[ot],et.hasOwnProperty(ot)&&st!==it&&(st!=null||it!=null))if(ot==="style")if(it){for(nt in it)!it.hasOwnProperty(nt)||st&&st.hasOwnProperty(nt)||(a||(a={}),a[nt]="");for(nt in st)st.hasOwnProperty(nt)&&it[nt]!==st[nt]&&(a||(a={}),a[nt]=st[nt])}else a||(rt||(rt=[]),rt.push(ot,a)),a=st;else ot==="dangerouslySetInnerHTML"?(st=st?st.__html:void 0,it=it?it.__html:void 0,st!=null&&it!==st&&(rt=rt||[]).push(ot,st)):ot==="children"?typeof st!="string"&&typeof st!="number"||(rt=rt||[]).push(ot,""+st):ot!=="suppressContentEditableWarning"&&ot!=="suppressHydrationWarning"&&(ea.hasOwnProperty(ot)?(st!=null&&ot==="onScroll"&&D$1("scroll",o),rt||it===st||(rt=[])):(rt=rt||[]).push(ot,st))}a&&(rt=rt||[]).push("style",a);var ot=rt;(s.updateQueue=ot)&&(s.flags|=4)}};Cj=function(o,s,a,et){a!==et&&(s.flags|=4)};function Dj(o,s){if(!I$1)switch(o.tailMode){case"hidden":s=o.tail;for(var a=null;s!==null;)s.alternate!==null&&(a=s),s=s.sibling;a===null?o.tail=null:a.sibling=null;break;case"collapsed":a=o.tail;for(var et=null;a!==null;)a.alternate!==null&&(et=a),a=a.sibling;et===null?s||o.tail===null?o.tail=null:o.tail.sibling=null:et.sibling=null}}function S$1(o){var s=o.alternate!==null&&o.alternate.child===o.child,a=0,et=0;if(s)for(var tt=o.child;tt!==null;)a|=tt.lanes|tt.childLanes,et|=tt.subtreeFlags&14680064,et|=tt.flags&14680064,tt.return=o,tt=tt.sibling;else for(tt=o.child;tt!==null;)a|=tt.lanes|tt.childLanes,et|=tt.subtreeFlags,et|=tt.flags,tt.return=o,tt=tt.sibling;return o.subtreeFlags|=et,o.childLanes=a,s}function Ej(o,s,a){var et=s.pendingProps;switch(wg(s),s.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S$1(s),null;case 1:return Zf(s.type)&&$f(),S$1(s),null;case 3:return et=s.stateNode,zh(),E$1(Wf),E$1(H$1),Eh(),et.pendingContext&&(et.context=et.pendingContext,et.pendingContext=null),(o===null||o.child===null)&&(Gg(s)?s.flags|=4:o===null||o.memoizedState.isDehydrated&&!(s.flags&256)||(s.flags|=1024,zg!==null&&(Fj(zg),zg=null))),Aj(o,s),S$1(s),null;case 5:Bh(s);var tt=xh(wh.current);if(a=s.type,o!==null&&s.stateNode!=null)Bj(o,s,a,et,tt),o.ref!==s.ref&&(s.flags|=512,s.flags|=2097152);else{if(!et){if(s.stateNode===null)throw Error(p$2(166));return S$1(s),null}if(o=xh(uh.current),Gg(s)){et=s.stateNode,a=s.type;var rt=s.memoizedProps;switch(et[Of]=s,et[Pf]=rt,o=(s.mode&1)!==0,a){case"dialog":D$1("cancel",et),D$1("close",et);break;case"iframe":case"object":case"embed":D$1("load",et);break;case"video":case"audio":for(tt=0;tt<lf.length;tt++)D$1(lf[tt],et);break;case"source":D$1("error",et);break;case"img":case"image":case"link":D$1("error",et),D$1("load",et);break;case"details":D$1("toggle",et);break;case"input":Za(et,rt),D$1("invalid",et);break;case"select":et._wrapperState={wasMultiple:!!rt.multiple},D$1("invalid",et);break;case"textarea":hb(et,rt),D$1("invalid",et)}ub(a,rt),tt=null;for(var nt in rt)if(rt.hasOwnProperty(nt)){var it=rt[nt];nt==="children"?typeof it=="string"?et.textContent!==it&&(rt.suppressHydrationWarning!==!0&&Af(et.textContent,it,o),tt=["children",it]):typeof it=="number"&&et.textContent!==""+it&&(rt.suppressHydrationWarning!==!0&&Af(et.textContent,it,o),tt=["children",""+it]):ea.hasOwnProperty(nt)&&it!=null&&nt==="onScroll"&&D$1("scroll",et)}switch(a){case"input":Va(et),db$1(et,rt,!0);break;case"textarea":Va(et),jb(et);break;case"select":case"option":break;default:typeof rt.onClick=="function"&&(et.onclick=Bf)}et=tt,s.updateQueue=et,et!==null&&(s.flags|=4)}else{nt=tt.nodeType===9?tt:tt.ownerDocument,o==="http://www.w3.org/1999/xhtml"&&(o=kb(a)),o==="http://www.w3.org/1999/xhtml"?a==="script"?(o=nt.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild)):typeof et.is=="string"?o=nt.createElement(a,{is:et.is}):(o=nt.createElement(a),a==="select"&&(nt=o,et.multiple?nt.multiple=!0:et.size&&(nt.size=et.size))):o=nt.createElementNS(o,a),o[Of]=s,o[Pf]=et,zj(o,s,!1,!1),s.stateNode=o;e:{switch(nt=vb(a,et),a){case"dialog":D$1("cancel",o),D$1("close",o),tt=et;break;case"iframe":case"object":case"embed":D$1("load",o),tt=et;break;case"video":case"audio":for(tt=0;tt<lf.length;tt++)D$1(lf[tt],o);tt=et;break;case"source":D$1("error",o),tt=et;break;case"img":case"image":case"link":D$1("error",o),D$1("load",o),tt=et;break;case"details":D$1("toggle",o),tt=et;break;case"input":Za(o,et),tt=Ya(o,et),D$1("invalid",o);break;case"option":tt=et;break;case"select":o._wrapperState={wasMultiple:!!et.multiple},tt=A$1({},et,{value:void 0}),D$1("invalid",o);break;case"textarea":hb(o,et),tt=gb(o,et),D$1("invalid",o);break;default:tt=et}ub(a,tt),it=tt;for(rt in it)if(it.hasOwnProperty(rt)){var st=it[rt];rt==="style"?sb(o,st):rt==="dangerouslySetInnerHTML"?(st=st?st.__html:void 0,st!=null&&nb(o,st)):rt==="children"?typeof st=="string"?(a!=="textarea"||st!=="")&&ob(o,st):typeof st=="number"&&ob(o,""+st):rt!=="suppressContentEditableWarning"&&rt!=="suppressHydrationWarning"&&rt!=="autoFocus"&&(ea.hasOwnProperty(rt)?st!=null&&rt==="onScroll"&&D$1("scroll",o):st!=null&&ta(o,rt,st,nt))}switch(a){case"input":Va(o),db$1(o,et,!1);break;case"textarea":Va(o),jb(o);break;case"option":et.value!=null&&o.setAttribute("value",""+Sa(et.value));break;case"select":o.multiple=!!et.multiple,rt=et.value,rt!=null?fb(o,!!et.multiple,rt,!1):et.defaultValue!=null&&fb(o,!!et.multiple,et.defaultValue,!0);break;default:typeof tt.onClick=="function"&&(o.onclick=Bf)}switch(a){case"button":case"input":case"select":case"textarea":et=!!et.autoFocus;break e;case"img":et=!0;break e;default:et=!1}}et&&(s.flags|=4)}s.ref!==null&&(s.flags|=512,s.flags|=2097152)}return S$1(s),null;case 6:if(o&&s.stateNode!=null)Cj(o,s,o.memoizedProps,et);else{if(typeof et!="string"&&s.stateNode===null)throw Error(p$2(166));if(a=xh(wh.current),xh(uh.current),Gg(s)){if(et=s.stateNode,a=s.memoizedProps,et[Of]=s,(rt=et.nodeValue!==a)&&(o=xg,o!==null))switch(o.tag){case 3:Af(et.nodeValue,a,(o.mode&1)!==0);break;case 5:o.memoizedProps.suppressHydrationWarning!==!0&&Af(et.nodeValue,a,(o.mode&1)!==0)}rt&&(s.flags|=4)}else et=(a.nodeType===9?a:a.ownerDocument).createTextNode(et),et[Of]=s,s.stateNode=et}return S$1(s),null;case 13:if(E$1(L$1),et=s.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(I$1&&yg!==null&&s.mode&1&&!(s.flags&128))Hg(),Ig(),s.flags|=98560,rt=!1;else if(rt=Gg(s),et!==null&&et.dehydrated!==null){if(o===null){if(!rt)throw Error(p$2(318));if(rt=s.memoizedState,rt=rt!==null?rt.dehydrated:null,!rt)throw Error(p$2(317));rt[Of]=s}else Ig(),!(s.flags&128)&&(s.memoizedState=null),s.flags|=4;S$1(s),rt=!1}else zg!==null&&(Fj(zg),zg=null),rt=!0;if(!rt)return s.flags&65536?s:null}return s.flags&128?(s.lanes=a,s):(et=et!==null,et!==(o!==null&&o.memoizedState!==null)&&et&&(s.child.flags|=8192,s.mode&1&&(o===null||L$1.current&1?T$1===0&&(T$1=3):tj())),s.updateQueue!==null&&(s.flags|=4),S$1(s),null);case 4:return zh(),Aj(o,s),o===null&&sf(s.stateNode.containerInfo),S$1(s),null;case 10:return ah(s.type._context),S$1(s),null;case 17:return Zf(s.type)&&$f(),S$1(s),null;case 19:if(E$1(L$1),rt=s.memoizedState,rt===null)return S$1(s),null;if(et=(s.flags&128)!==0,nt=rt.rendering,nt===null)if(et)Dj(rt,!1);else{if(T$1!==0||o!==null&&o.flags&128)for(o=s.child;o!==null;){if(nt=Ch(o),nt!==null){for(s.flags|=128,Dj(rt,!1),et=nt.updateQueue,et!==null&&(s.updateQueue=et,s.flags|=4),s.subtreeFlags=0,et=a,a=s.child;a!==null;)rt=a,o=et,rt.flags&=14680066,nt=rt.alternate,nt===null?(rt.childLanes=0,rt.lanes=o,rt.child=null,rt.subtreeFlags=0,rt.memoizedProps=null,rt.memoizedState=null,rt.updateQueue=null,rt.dependencies=null,rt.stateNode=null):(rt.childLanes=nt.childLanes,rt.lanes=nt.lanes,rt.child=nt.child,rt.subtreeFlags=0,rt.deletions=null,rt.memoizedProps=nt.memoizedProps,rt.memoizedState=nt.memoizedState,rt.updateQueue=nt.updateQueue,rt.type=nt.type,o=nt.dependencies,rt.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),a=a.sibling;return G$1(L$1,L$1.current&1|2),s.child}o=o.sibling}rt.tail!==null&&B$1()>Gj&&(s.flags|=128,et=!0,Dj(rt,!1),s.lanes=4194304)}else{if(!et)if(o=Ch(nt),o!==null){if(s.flags|=128,et=!0,a=o.updateQueue,a!==null&&(s.updateQueue=a,s.flags|=4),Dj(rt,!0),rt.tail===null&&rt.tailMode==="hidden"&&!nt.alternate&&!I$1)return S$1(s),null}else 2*B$1()-rt.renderingStartTime>Gj&&a!==1073741824&&(s.flags|=128,et=!0,Dj(rt,!1),s.lanes=4194304);rt.isBackwards?(nt.sibling=s.child,s.child=nt):(a=rt.last,a!==null?a.sibling=nt:s.child=nt,rt.last=nt)}return rt.tail!==null?(s=rt.tail,rt.rendering=s,rt.tail=s.sibling,rt.renderingStartTime=B$1(),s.sibling=null,a=L$1.current,G$1(L$1,et?a&1|2:a&1),s):(S$1(s),null);case 22:case 23:return Hj(),et=s.memoizedState!==null,o!==null&&o.memoizedState!==null!==et&&(s.flags|=8192),et&&s.mode&1?fj&1073741824&&(S$1(s),s.subtreeFlags&6&&(s.flags|=8192)):S$1(s),null;case 24:return null;case 25:return null}throw Error(p$2(156,s.tag))}function Ij(o,s){switch(wg(s),s.tag){case 1:return Zf(s.type)&&$f(),o=s.flags,o&65536?(s.flags=o&-65537|128,s):null;case 3:return zh(),E$1(Wf),E$1(H$1),Eh(),o=s.flags,o&65536&&!(o&128)?(s.flags=o&-65537|128,s):null;case 5:return Bh(s),null;case 13:if(E$1(L$1),o=s.memoizedState,o!==null&&o.dehydrated!==null){if(s.alternate===null)throw Error(p$2(340));Ig()}return o=s.flags,o&65536?(s.flags=o&-65537|128,s):null;case 19:return E$1(L$1),null;case 4:return zh(),null;case 10:return ah(s.type._context),null;case 22:case 23:return Hj(),null;case 24:return null;default:return null}}var Jj=!1,U$1=!1,Kj=typeof WeakSet=="function"?WeakSet:Set,V$2=null;function Lj(o,s){var a=o.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(et){W$1(o,s,et)}else a.current=null}function Mj(o,s,a){try{a()}catch(et){W$1(o,s,et)}}var Nj=!1;function Oj(o,s){if(Cf=dd,o=Me$1(),Ne$1(o)){if("selectionStart"in o)var a={start:o.selectionStart,end:o.selectionEnd};else e:{a=(a=o.ownerDocument)&&a.defaultView||window;var et=a.getSelection&&a.getSelection();if(et&&et.rangeCount!==0){a=et.anchorNode;var tt=et.anchorOffset,rt=et.focusNode;et=et.focusOffset;try{a.nodeType,rt.nodeType}catch{a=null;break e}var nt=0,it=-1,st=-1,ot=0,at=0,lt=o,ct=null;t:for(;;){for(var ht;lt!==a||tt!==0&&lt.nodeType!==3||(it=nt+tt),lt!==rt||et!==0&&lt.nodeType!==3||(st=nt+et),lt.nodeType===3&&(nt+=lt.nodeValue.length),(ht=lt.firstChild)!==null;)ct=lt,lt=ht;for(;;){if(lt===o)break t;if(ct===a&&++ot===tt&&(it=nt),ct===rt&&++at===et&&(st=nt),(ht=lt.nextSibling)!==null)break;lt=ct,ct=lt.parentNode}lt=ht}a=it===-1||st===-1?null:{start:it,end:st}}else a=null}a=a||{start:0,end:0}}else a=null;for(Df={focusedElem:o,selectionRange:a},dd=!1,V$2=s;V$2!==null;)if(s=V$2,o=s.child,(s.subtreeFlags&1028)!==0&&o!==null)o.return=s,V$2=o;else for(;V$2!==null;){s=V$2;try{var ft=s.alternate;if(s.flags&1024)switch(s.tag){case 0:case 11:case 15:break;case 1:if(ft!==null){var dt=ft.memoizedProps,pt=ft.memoizedState,gt=s.stateNode,mt=gt.getSnapshotBeforeUpdate(s.elementType===s.type?dt:Ci(s.type,dt),pt);gt.__reactInternalSnapshotBeforeUpdate=mt}break;case 3:var yt=s.stateNode.containerInfo;yt.nodeType===1?yt.textContent="":yt.nodeType===9&&yt.documentElement&&yt.removeChild(yt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p$2(163))}}catch(vt){W$1(s,s.return,vt)}if(o=s.sibling,o!==null){o.return=s.return,V$2=o;break}V$2=s.return}return ft=Nj,Nj=!1,ft}function Pj(o,s,a){var et=s.updateQueue;if(et=et!==null?et.lastEffect:null,et!==null){var tt=et=et.next;do{if((tt.tag&o)===o){var rt=tt.destroy;tt.destroy=void 0,rt!==void 0&&Mj(s,a,rt)}tt=tt.next}while(tt!==et)}}function Qj(o,s){if(s=s.updateQueue,s=s!==null?s.lastEffect:null,s!==null){var a=s=s.next;do{if((a.tag&o)===o){var et=a.create;a.destroy=et()}a=a.next}while(a!==s)}}function Rj(o){var s=o.ref;if(s!==null){var a=o.stateNode;switch(o.tag){case 5:o=a;break;default:o=a}typeof s=="function"?s(o):s.current=o}}function Sj(o){var s=o.alternate;s!==null&&(o.alternate=null,Sj(s)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(s=o.stateNode,s!==null&&(delete s[Of],delete s[Pf],delete s[of],delete s[Qf],delete s[Rf])),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}function Tj(o){return o.tag===5||o.tag===3||o.tag===4}function Uj(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||Tj(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function Vj(o,s,a){var et=o.tag;if(et===5||et===6)o=o.stateNode,s?a.nodeType===8?a.parentNode.insertBefore(o,s):a.insertBefore(o,s):(a.nodeType===8?(s=a.parentNode,s.insertBefore(o,a)):(s=a,s.appendChild(o)),a=a._reactRootContainer,a!=null||s.onclick!==null||(s.onclick=Bf));else if(et!==4&&(o=o.child,o!==null))for(Vj(o,s,a),o=o.sibling;o!==null;)Vj(o,s,a),o=o.sibling}function Wj(o,s,a){var et=o.tag;if(et===5||et===6)o=o.stateNode,s?a.insertBefore(o,s):a.appendChild(o);else if(et!==4&&(o=o.child,o!==null))for(Wj(o,s,a),o=o.sibling;o!==null;)Wj(o,s,a),o=o.sibling}var X$1=null,Xj=!1;function Yj(o,s,a){for(a=a.child;a!==null;)Zj(o,s,a),a=a.sibling}function Zj(o,s,a){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,a)}catch{}switch(a.tag){case 5:U$1||Lj(a,s);case 6:var et=X$1,tt=Xj;X$1=null,Yj(o,s,a),X$1=et,Xj=tt,X$1!==null&&(Xj?(o=X$1,a=a.stateNode,o.nodeType===8?o.parentNode.removeChild(a):o.removeChild(a)):X$1.removeChild(a.stateNode));break;case 18:X$1!==null&&(Xj?(o=X$1,a=a.stateNode,o.nodeType===8?Kf(o.parentNode,a):o.nodeType===1&&Kf(o,a),bd(o)):Kf(X$1,a.stateNode));break;case 4:et=X$1,tt=Xj,X$1=a.stateNode.containerInfo,Xj=!0,Yj(o,s,a),X$1=et,Xj=tt;break;case 0:case 11:case 14:case 15:if(!U$1&&(et=a.updateQueue,et!==null&&(et=et.lastEffect,et!==null))){tt=et=et.next;do{var rt=tt,nt=rt.destroy;rt=rt.tag,nt!==void 0&&(rt&2||rt&4)&&Mj(a,s,nt),tt=tt.next}while(tt!==et)}Yj(o,s,a);break;case 1:if(!U$1&&(Lj(a,s),et=a.stateNode,typeof et.componentWillUnmount=="function"))try{et.props=a.memoizedProps,et.state=a.memoizedState,et.componentWillUnmount()}catch(it){W$1(a,s,it)}Yj(o,s,a);break;case 21:Yj(o,s,a);break;case 22:a.mode&1?(U$1=(et=U$1)||a.memoizedState!==null,Yj(o,s,a),U$1=et):Yj(o,s,a);break;default:Yj(o,s,a)}}function ak(o){var s=o.updateQueue;if(s!==null){o.updateQueue=null;var a=o.stateNode;a===null&&(a=o.stateNode=new Kj),s.forEach(function(et){var tt=bk.bind(null,o,et);a.has(et)||(a.add(et),et.then(tt,tt))})}}function ck(o,s){var a=s.deletions;if(a!==null)for(var et=0;et<a.length;et++){var tt=a[et];try{var rt=o,nt=s,it=nt;e:for(;it!==null;){switch(it.tag){case 5:X$1=it.stateNode,Xj=!1;break e;case 3:X$1=it.stateNode.containerInfo,Xj=!0;break e;case 4:X$1=it.stateNode.containerInfo,Xj=!0;break e}it=it.return}if(X$1===null)throw Error(p$2(160));Zj(rt,nt,tt),X$1=null,Xj=!1;var st=tt.alternate;st!==null&&(st.return=null),tt.return=null}catch(ot){W$1(tt,s,ot)}}if(s.subtreeFlags&12854)for(s=s.child;s!==null;)dk(s,o),s=s.sibling}function dk(o,s){var a=o.alternate,et=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:if(ck(s,o),ek(o),et&4){try{Pj(3,o,o.return),Qj(3,o)}catch(dt){W$1(o,o.return,dt)}try{Pj(5,o,o.return)}catch(dt){W$1(o,o.return,dt)}}break;case 1:ck(s,o),ek(o),et&512&&a!==null&&Lj(a,a.return);break;case 5:if(ck(s,o),ek(o),et&512&&a!==null&&Lj(a,a.return),o.flags&32){var tt=o.stateNode;try{ob(tt,"")}catch(dt){W$1(o,o.return,dt)}}if(et&4&&(tt=o.stateNode,tt!=null)){var rt=o.memoizedProps,nt=a!==null?a.memoizedProps:rt,it=o.type,st=o.updateQueue;if(o.updateQueue=null,st!==null)try{it==="input"&&rt.type==="radio"&&rt.name!=null&&ab(tt,rt),vb(it,nt);var ot=vb(it,rt);for(nt=0;nt<st.length;nt+=2){var at=st[nt],lt=st[nt+1];at==="style"?sb(tt,lt):at==="dangerouslySetInnerHTML"?nb(tt,lt):at==="children"?ob(tt,lt):ta(tt,at,lt,ot)}switch(it){case"input":bb(tt,rt);break;case"textarea":ib(tt,rt);break;case"select":var ct=tt._wrapperState.wasMultiple;tt._wrapperState.wasMultiple=!!rt.multiple;var ht=rt.value;ht!=null?fb(tt,!!rt.multiple,ht,!1):ct!==!!rt.multiple&&(rt.defaultValue!=null?fb(tt,!!rt.multiple,rt.defaultValue,!0):fb(tt,!!rt.multiple,rt.multiple?[]:"",!1))}tt[Pf]=rt}catch(dt){W$1(o,o.return,dt)}}break;case 6:if(ck(s,o),ek(o),et&4){if(o.stateNode===null)throw Error(p$2(162));tt=o.stateNode,rt=o.memoizedProps;try{tt.nodeValue=rt}catch(dt){W$1(o,o.return,dt)}}break;case 3:if(ck(s,o),ek(o),et&4&&a!==null&&a.memoizedState.isDehydrated)try{bd(s.containerInfo)}catch(dt){W$1(o,o.return,dt)}break;case 4:ck(s,o),ek(o);break;case 13:ck(s,o),ek(o),tt=o.child,tt.flags&8192&&(rt=tt.memoizedState!==null,tt.stateNode.isHidden=rt,!rt||tt.alternate!==null&&tt.alternate.memoizedState!==null||(fk=B$1())),et&4&&ak(o);break;case 22:if(at=a!==null&&a.memoizedState!==null,o.mode&1?(U$1=(ot=U$1)||at,ck(s,o),U$1=ot):ck(s,o),ek(o),et&8192){if(ot=o.memoizedState!==null,(o.stateNode.isHidden=ot)&&!at&&o.mode&1)for(V$2=o,at=o.child;at!==null;){for(lt=V$2=at;V$2!==null;){switch(ct=V$2,ht=ct.child,ct.tag){case 0:case 11:case 14:case 15:Pj(4,ct,ct.return);break;case 1:Lj(ct,ct.return);var ft=ct.stateNode;if(typeof ft.componentWillUnmount=="function"){et=ct,a=ct.return;try{s=et,ft.props=s.memoizedProps,ft.state=s.memoizedState,ft.componentWillUnmount()}catch(dt){W$1(et,a,dt)}}break;case 5:Lj(ct,ct.return);break;case 22:if(ct.memoizedState!==null){gk(lt);continue}}ht!==null?(ht.return=ct,V$2=ht):gk(lt)}at=at.sibling}e:for(at=null,lt=o;;){if(lt.tag===5){if(at===null){at=lt;try{tt=lt.stateNode,ot?(rt=tt.style,typeof rt.setProperty=="function"?rt.setProperty("display","none","important"):rt.display="none"):(it=lt.stateNode,st=lt.memoizedProps.style,nt=st!=null&&st.hasOwnProperty("display")?st.display:null,it.style.display=rb("display",nt))}catch(dt){W$1(o,o.return,dt)}}}else if(lt.tag===6){if(at===null)try{lt.stateNode.nodeValue=ot?"":lt.memoizedProps}catch(dt){W$1(o,o.return,dt)}}else if((lt.tag!==22&&lt.tag!==23||lt.memoizedState===null||lt===o)&&lt.child!==null){lt.child.return=lt,lt=lt.child;continue}if(lt===o)break e;for(;lt.sibling===null;){if(lt.return===null||lt.return===o)break e;at===lt&&(at=null),lt=lt.return}at===lt&&(at=null),lt.sibling.return=lt.return,lt=lt.sibling}}break;case 19:ck(s,o),ek(o),et&4&&ak(o);break;case 21:break;default:ck(s,o),ek(o)}}function ek(o){var s=o.flags;if(s&2){try{e:{for(var a=o.return;a!==null;){if(Tj(a)){var et=a;break e}a=a.return}throw Error(p$2(160))}switch(et.tag){case 5:var tt=et.stateNode;et.flags&32&&(ob(tt,""),et.flags&=-33);var rt=Uj(o);Wj(o,rt,tt);break;case 3:case 4:var nt=et.stateNode.containerInfo,it=Uj(o);Vj(o,it,nt);break;default:throw Error(p$2(161))}}catch(st){W$1(o,o.return,st)}o.flags&=-3}s&4096&&(o.flags&=-4097)}function hk(o,s,a){V$2=o,ik(o)}function ik(o,s,a){for(var et=(o.mode&1)!==0;V$2!==null;){var tt=V$2,rt=tt.child;if(tt.tag===22&&et){var nt=tt.memoizedState!==null||Jj;if(!nt){var it=tt.alternate,st=it!==null&&it.memoizedState!==null||U$1;it=Jj;var ot=U$1;if(Jj=nt,(U$1=st)&&!ot)for(V$2=tt;V$2!==null;)nt=V$2,st=nt.child,nt.tag===22&&nt.memoizedState!==null?jk(tt):st!==null?(st.return=nt,V$2=st):jk(tt);for(;rt!==null;)V$2=rt,ik(rt),rt=rt.sibling;V$2=tt,Jj=it,U$1=ot}kk(o)}else tt.subtreeFlags&8772&&rt!==null?(rt.return=tt,V$2=rt):kk(o)}}function kk(o){for(;V$2!==null;){var s=V$2;if(s.flags&8772){var a=s.alternate;try{if(s.flags&8772)switch(s.tag){case 0:case 11:case 15:U$1||Qj(5,s);break;case 1:var et=s.stateNode;if(s.flags&4&&!U$1)if(a===null)et.componentDidMount();else{var tt=s.elementType===s.type?a.memoizedProps:Ci(s.type,a.memoizedProps);et.componentDidUpdate(tt,a.memoizedState,et.__reactInternalSnapshotBeforeUpdate)}var rt=s.updateQueue;rt!==null&&sh(s,rt,et);break;case 3:var nt=s.updateQueue;if(nt!==null){if(a=null,s.child!==null)switch(s.child.tag){case 5:a=s.child.stateNode;break;case 1:a=s.child.stateNode}sh(s,nt,a)}break;case 5:var it=s.stateNode;if(a===null&&s.flags&4){a=it;var st=s.memoizedProps;switch(s.type){case"button":case"input":case"select":case"textarea":st.autoFocus&&a.focus();break;case"img":st.src&&(a.src=st.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(s.memoizedState===null){var ot=s.alternate;if(ot!==null){var at=ot.memoizedState;if(at!==null){var lt=at.dehydrated;lt!==null&&bd(lt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p$2(163))}U$1||s.flags&512&&Rj(s)}catch(ct){W$1(s,s.return,ct)}}if(s===o){V$2=null;break}if(a=s.sibling,a!==null){a.return=s.return,V$2=a;break}V$2=s.return}}function gk(o){for(;V$2!==null;){var s=V$2;if(s===o){V$2=null;break}var a=s.sibling;if(a!==null){a.return=s.return,V$2=a;break}V$2=s.return}}function jk(o){for(;V$2!==null;){var s=V$2;try{switch(s.tag){case 0:case 11:case 15:var a=s.return;try{Qj(4,s)}catch(st){W$1(s,a,st)}break;case 1:var et=s.stateNode;if(typeof et.componentDidMount=="function"){var tt=s.return;try{et.componentDidMount()}catch(st){W$1(s,tt,st)}}var rt=s.return;try{Rj(s)}catch(st){W$1(s,rt,st)}break;case 5:var nt=s.return;try{Rj(s)}catch(st){W$1(s,nt,st)}}}catch(st){W$1(s,s.return,st)}if(s===o){V$2=null;break}var it=s.sibling;if(it!==null){it.return=s.return,V$2=it;break}V$2=s.return}}var lk=Math.ceil,mk=ua.ReactCurrentDispatcher,nk=ua.ReactCurrentOwner,ok=ua.ReactCurrentBatchConfig,K$2=0,Q$1=null,Y$1=null,Z$1=0,fj=0,ej=Uf(0),T$1=0,pk=null,rh=0,qk=0,rk=0,sk=null,tk=null,fk=0,Gj=1/0,uk=null,Oi=!1,Pi=null,Ri=null,vk=!1,wk=null,xk=0,yk=0,zk=null,Ak=-1,Bk=0;function R$1(){return K$2&6?B$1():Ak!==-1?Ak:Ak=B$1()}function yi(o){return o.mode&1?K$2&2&&Z$1!==0?Z$1&-Z$1:Kg.transition!==null?(Bk===0&&(Bk=yc()),Bk):(o=C$1,o!==0||(o=window.event,o=o===void 0?16:jd(o.type)),o):1}function gi(o,s,a,et){if(50<yk)throw yk=0,zk=null,Error(p$2(185));Ac(o,a,et),(!(K$2&2)||o!==Q$1)&&(o===Q$1&&(!(K$2&2)&&(qk|=a),T$1===4&&Ck(o,Z$1)),Dk(o,et),a===1&&K$2===0&&!(s.mode&1)&&(Gj=B$1()+500,fg&&jg()))}function Dk(o,s){var a=o.callbackNode;wc(o,s);var et=uc(o,o===Q$1?Z$1:0);if(et===0)a!==null&&bc(a),o.callbackNode=null,o.callbackPriority=0;else if(s=et&-et,o.callbackPriority!==s){if(a!=null&&bc(a),s===1)o.tag===0?ig(Ek.bind(null,o)):hg(Ek.bind(null,o)),Jf(function(){!(K$2&6)&&jg()}),a=null;else{switch(Dc(et)){case 1:a=fc;break;case 4:a=gc;break;case 16:a=hc;break;case 536870912:a=jc;break;default:a=hc}a=Fk(a,Gk.bind(null,o))}o.callbackPriority=s,o.callbackNode=a}}function Gk(o,s){if(Ak=-1,Bk=0,K$2&6)throw Error(p$2(327));var a=o.callbackNode;if(Hk()&&o.callbackNode!==a)return null;var et=uc(o,o===Q$1?Z$1:0);if(et===0)return null;if(et&30||et&o.expiredLanes||s)s=Ik(o,et);else{s=et;var tt=K$2;K$2|=2;var rt=Jk();(Q$1!==o||Z$1!==s)&&(uk=null,Gj=B$1()+500,Kk(o,s));do try{Lk();break}catch(it){Mk(o,it)}while(!0);$g(),mk.current=rt,K$2=tt,Y$1!==null?s=0:(Q$1=null,Z$1=0,s=T$1)}if(s!==0){if(s===2&&(tt=xc(o),tt!==0&&(et=tt,s=Nk(o,tt))),s===1)throw a=pk,Kk(o,0),Ck(o,et),Dk(o,B$1()),a;if(s===6)Ck(o,et);else{if(tt=o.current.alternate,!(et&30)&&!Ok(tt)&&(s=Ik(o,et),s===2&&(rt=xc(o),rt!==0&&(et=rt,s=Nk(o,rt))),s===1))throw a=pk,Kk(o,0),Ck(o,et),Dk(o,B$1()),a;switch(o.finishedWork=tt,o.finishedLanes=et,s){case 0:case 1:throw Error(p$2(345));case 2:Pk(o,tk,uk);break;case 3:if(Ck(o,et),(et&130023424)===et&&(s=fk+500-B$1(),10<s)){if(uc(o,0)!==0)break;if(tt=o.suspendedLanes,(tt&et)!==et){R$1(),o.pingedLanes|=o.suspendedLanes&tt;break}o.timeoutHandle=Ff(Pk.bind(null,o,tk,uk),s);break}Pk(o,tk,uk);break;case 4:if(Ck(o,et),(et&4194240)===et)break;for(s=o.eventTimes,tt=-1;0<et;){var nt=31-oc(et);rt=1<<nt,nt=s[nt],nt>tt&&(tt=nt),et&=~rt}if(et=tt,et=B$1()-et,et=(120>et?120:480>et?480:1080>et?1080:1920>et?1920:3e3>et?3e3:4320>et?4320:1960*lk(et/1960))-et,10<et){o.timeoutHandle=Ff(Pk.bind(null,o,tk,uk),et);break}Pk(o,tk,uk);break;case 5:Pk(o,tk,uk);break;default:throw Error(p$2(329))}}}return Dk(o,B$1()),o.callbackNode===a?Gk.bind(null,o):null}function Nk(o,s){var a=sk;return o.current.memoizedState.isDehydrated&&(Kk(o,s).flags|=256),o=Ik(o,s),o!==2&&(s=tk,tk=a,s!==null&&Fj(s)),o}function Fj(o){tk===null?tk=o:tk.push.apply(tk,o)}function Ok(o){for(var s=o;;){if(s.flags&16384){var a=s.updateQueue;if(a!==null&&(a=a.stores,a!==null))for(var et=0;et<a.length;et++){var tt=a[et],rt=tt.getSnapshot;tt=tt.value;try{if(!He(rt(),tt))return!1}catch{return!1}}}if(a=s.child,s.subtreeFlags&16384&&a!==null)a.return=s,s=a;else{if(s===o)break;for(;s.sibling===null;){if(s.return===null||s.return===o)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Ck(o,s){for(s&=~rk,s&=~qk,o.suspendedLanes|=s,o.pingedLanes&=~s,o=o.expirationTimes;0<s;){var a=31-oc(s),et=1<<a;o[a]=-1,s&=~et}}function Ek(o){if(K$2&6)throw Error(p$2(327));Hk();var s=uc(o,0);if(!(s&1))return Dk(o,B$1()),null;var a=Ik(o,s);if(o.tag!==0&&a===2){var et=xc(o);et!==0&&(s=et,a=Nk(o,et))}if(a===1)throw a=pk,Kk(o,0),Ck(o,s),Dk(o,B$1()),a;if(a===6)throw Error(p$2(345));return o.finishedWork=o.current.alternate,o.finishedLanes=s,Pk(o,tk,uk),Dk(o,B$1()),null}function Qk(o,s){var a=K$2;K$2|=1;try{return o(s)}finally{K$2=a,K$2===0&&(Gj=B$1()+500,fg&&jg())}}function Rk(o){wk!==null&&wk.tag===0&&!(K$2&6)&&Hk();var s=K$2;K$2|=1;var a=ok.transition,et=C$1;try{if(ok.transition=null,C$1=1,o)return o()}finally{C$1=et,ok.transition=a,K$2=s,!(K$2&6)&&jg()}}function Hj(){fj=ej.current,E$1(ej)}function Kk(o,s){o.finishedWork=null,o.finishedLanes=0;var a=o.timeoutHandle;if(a!==-1&&(o.timeoutHandle=-1,Gf(a)),Y$1!==null)for(a=Y$1.return;a!==null;){var et=a;switch(wg(et),et.tag){case 1:et=et.type.childContextTypes,et!=null&&$f();break;case 3:zh(),E$1(Wf),E$1(H$1),Eh();break;case 5:Bh(et);break;case 4:zh();break;case 13:E$1(L$1);break;case 19:E$1(L$1);break;case 10:ah(et.type._context);break;case 22:case 23:Hj()}a=a.return}if(Q$1=o,Y$1=o=Pg(o.current,null),Z$1=fj=s,T$1=0,pk=null,rk=qk=rh=0,tk=sk=null,fh!==null){for(s=0;s<fh.length;s++)if(a=fh[s],et=a.interleaved,et!==null){a.interleaved=null;var tt=et.next,rt=a.pending;if(rt!==null){var nt=rt.next;rt.next=tt,et.next=nt}a.pending=et}fh=null}return o}function Mk(o,s){do{var a=Y$1;try{if($g(),Fh.current=Rh,Ih){for(var et=M$1.memoizedState;et!==null;){var tt=et.queue;tt!==null&&(tt.pending=null),et=et.next}Ih=!1}if(Hh=0,O=N$1=M$1=null,Jh=!1,Kh=0,nk.current=null,a===null||a.return===null){T$1=1,pk=s,Y$1=null;break}e:{var rt=o,nt=a.return,it=a,st=s;if(s=Z$1,it.flags|=32768,st!==null&&typeof st=="object"&&typeof st.then=="function"){var ot=st,at=it,lt=at.tag;if(!(at.mode&1)&&(lt===0||lt===11||lt===15)){var ct=at.alternate;ct?(at.updateQueue=ct.updateQueue,at.memoizedState=ct.memoizedState,at.lanes=ct.lanes):(at.updateQueue=null,at.memoizedState=null)}var ht=Ui(nt);if(ht!==null){ht.flags&=-257,Vi(ht,nt,it,rt,s),ht.mode&1&&Si(rt,ot,s),s=ht,st=ot;var ft=s.updateQueue;if(ft===null){var dt=new Set;dt.add(st),s.updateQueue=dt}else ft.add(st);break e}else{if(!(s&1)){Si(rt,ot,s),tj();break e}st=Error(p$2(426))}}else if(I$1&&it.mode&1){var pt=Ui(nt);if(pt!==null){!(pt.flags&65536)&&(pt.flags|=256),Vi(pt,nt,it,rt,s),Jg(Ji(st,it));break e}}rt=st=Ji(st,it),T$1!==4&&(T$1=2),sk===null?sk=[rt]:sk.push(rt),rt=nt;do{switch(rt.tag){case 3:rt.flags|=65536,s&=-s,rt.lanes|=s;var gt=Ni(rt,st,s);ph(rt,gt);break e;case 1:it=st;var mt=rt.type,yt=rt.stateNode;if(!(rt.flags&128)&&(typeof mt.getDerivedStateFromError=="function"||yt!==null&&typeof yt.componentDidCatch=="function"&&(Ri===null||!Ri.has(yt)))){rt.flags|=65536,s&=-s,rt.lanes|=s;var vt=Qi(rt,it,s);ph(rt,vt);break e}}rt=rt.return}while(rt!==null)}Sk(a)}catch(Et){s=Et,Y$1===a&&a!==null&&(Y$1=a=a.return);continue}break}while(!0)}function Jk(){var o=mk.current;return mk.current=Rh,o===null?Rh:o}function tj(){(T$1===0||T$1===3||T$1===2)&&(T$1=4),Q$1===null||!(rh&268435455)&&!(qk&268435455)||Ck(Q$1,Z$1)}function Ik(o,s){var a=K$2;K$2|=2;var et=Jk();(Q$1!==o||Z$1!==s)&&(uk=null,Kk(o,s));do try{Tk();break}catch(tt){Mk(o,tt)}while(!0);if($g(),K$2=a,mk.current=et,Y$1!==null)throw Error(p$2(261));return Q$1=null,Z$1=0,T$1}function Tk(){for(;Y$1!==null;)Uk(Y$1)}function Lk(){for(;Y$1!==null&&!cc();)Uk(Y$1)}function Uk(o){var s=Vk(o.alternate,o,fj);o.memoizedProps=o.pendingProps,s===null?Sk(o):Y$1=s,nk.current=null}function Sk(o){var s=o;do{var a=s.alternate;if(o=s.return,s.flags&32768){if(a=Ij(a,s),a!==null){a.flags&=32767,Y$1=a;return}if(o!==null)o.flags|=32768,o.subtreeFlags=0,o.deletions=null;else{T$1=6,Y$1=null;return}}else if(a=Ej(a,s,fj),a!==null){Y$1=a;return}if(s=s.sibling,s!==null){Y$1=s;return}Y$1=s=o}while(s!==null);T$1===0&&(T$1=5)}function Pk(o,s,a){var et=C$1,tt=ok.transition;try{ok.transition=null,C$1=1,Wk(o,s,a,et)}finally{ok.transition=tt,C$1=et}return null}function Wk(o,s,a,et){do Hk();while(wk!==null);if(K$2&6)throw Error(p$2(327));a=o.finishedWork;var tt=o.finishedLanes;if(a===null)return null;if(o.finishedWork=null,o.finishedLanes=0,a===o.current)throw Error(p$2(177));o.callbackNode=null,o.callbackPriority=0;var rt=a.lanes|a.childLanes;if(Bc(o,rt),o===Q$1&&(Y$1=Q$1=null,Z$1=0),!(a.subtreeFlags&2064)&&!(a.flags&2064)||vk||(vk=!0,Fk(hc,function(){return Hk(),null})),rt=(a.flags&15990)!==0,a.subtreeFlags&15990||rt){rt=ok.transition,ok.transition=null;var nt=C$1;C$1=1;var it=K$2;K$2|=4,nk.current=null,Oj(o,a),dk(a,o),Oe$1(Df),dd=!!Cf,Df=Cf=null,o.current=a,hk(a),dc(),K$2=it,C$1=nt,ok.transition=rt}else o.current=a;if(vk&&(vk=!1,wk=o,xk=tt),rt=o.pendingLanes,rt===0&&(Ri=null),mc(a.stateNode),Dk(o,B$1()),s!==null)for(et=o.onRecoverableError,a=0;a<s.length;a++)tt=s[a],et(tt.value,{componentStack:tt.stack,digest:tt.digest});if(Oi)throw Oi=!1,o=Pi,Pi=null,o;return xk&1&&o.tag!==0&&Hk(),rt=o.pendingLanes,rt&1?o===zk?yk++:(yk=0,zk=o):yk=0,jg(),null}function Hk(){if(wk!==null){var o=Dc(xk),s=ok.transition,a=C$1;try{if(ok.transition=null,C$1=16>o?16:o,wk===null)var et=!1;else{if(o=wk,wk=null,xk=0,K$2&6)throw Error(p$2(331));var tt=K$2;for(K$2|=4,V$2=o.current;V$2!==null;){var rt=V$2,nt=rt.child;if(V$2.flags&16){var it=rt.deletions;if(it!==null){for(var st=0;st<it.length;st++){var ot=it[st];for(V$2=ot;V$2!==null;){var at=V$2;switch(at.tag){case 0:case 11:case 15:Pj(8,at,rt)}var lt=at.child;if(lt!==null)lt.return=at,V$2=lt;else for(;V$2!==null;){at=V$2;var ct=at.sibling,ht=at.return;if(Sj(at),at===ot){V$2=null;break}if(ct!==null){ct.return=ht,V$2=ct;break}V$2=ht}}}var ft=rt.alternate;if(ft!==null){var dt=ft.child;if(dt!==null){ft.child=null;do{var pt=dt.sibling;dt.sibling=null,dt=pt}while(dt!==null)}}V$2=rt}}if(rt.subtreeFlags&2064&&nt!==null)nt.return=rt,V$2=nt;else e:for(;V$2!==null;){if(rt=V$2,rt.flags&2048)switch(rt.tag){case 0:case 11:case 15:Pj(9,rt,rt.return)}var gt=rt.sibling;if(gt!==null){gt.return=rt.return,V$2=gt;break e}V$2=rt.return}}var mt=o.current;for(V$2=mt;V$2!==null;){nt=V$2;var yt=nt.child;if(nt.subtreeFlags&2064&&yt!==null)yt.return=nt,V$2=yt;else e:for(nt=mt;V$2!==null;){if(it=V$2,it.flags&2048)try{switch(it.tag){case 0:case 11:case 15:Qj(9,it)}}catch(Et){W$1(it,it.return,Et)}if(it===nt){V$2=null;break e}var vt=it.sibling;if(vt!==null){vt.return=it.return,V$2=vt;break e}V$2=it.return}}if(K$2=tt,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,o)}catch{}et=!0}return et}finally{C$1=a,ok.transition=s}}return!1}function Xk(o,s,a){s=Ji(a,s),s=Ni(o,s,1),o=nh(o,s,1),s=R$1(),o!==null&&(Ac(o,1,s),Dk(o,s))}function W$1(o,s,a){if(o.tag===3)Xk(o,o,a);else for(;s!==null;){if(s.tag===3){Xk(s,o,a);break}else if(s.tag===1){var et=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof et.componentDidCatch=="function"&&(Ri===null||!Ri.has(et))){o=Ji(a,o),o=Qi(s,o,1),s=nh(s,o,1),o=R$1(),s!==null&&(Ac(s,1,o),Dk(s,o));break}}s=s.return}}function Ti(o,s,a){var et=o.pingCache;et!==null&&et.delete(s),s=R$1(),o.pingedLanes|=o.suspendedLanes&a,Q$1===o&&(Z$1&a)===a&&(T$1===4||T$1===3&&(Z$1&130023424)===Z$1&&500>B$1()-fk?Kk(o,0):rk|=a),Dk(o,s)}function Yk(o,s){s===0&&(o.mode&1?(s=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):s=1);var a=R$1();o=ih(o,s),o!==null&&(Ac(o,s,a),Dk(o,a))}function uj(o){var s=o.memoizedState,a=0;s!==null&&(a=s.retryLane),Yk(o,a)}function bk(o,s){var a=0;switch(o.tag){case 13:var et=o.stateNode,tt=o.memoizedState;tt!==null&&(a=tt.retryLane);break;case 19:et=o.stateNode;break;default:throw Error(p$2(314))}et!==null&&et.delete(s),Yk(o,a)}var Vk;Vk=function(o,s,a){if(o!==null)if(o.memoizedProps!==s.pendingProps||Wf.current)dh=!0;else{if(!(o.lanes&a)&&!(s.flags&128))return dh=!1,yj(o,s,a);dh=!!(o.flags&131072)}else dh=!1,I$1&&s.flags&1048576&&ug(s,ng,s.index);switch(s.lanes=0,s.tag){case 2:var et=s.type;ij(o,s),o=s.pendingProps;var tt=Yf(s,H$1.current);ch(s,a),tt=Nh(null,s,et,o,tt,a);var rt=Sh();return s.flags|=1,typeof tt=="object"&&tt!==null&&typeof tt.render=="function"&&tt.$$typeof===void 0?(s.tag=1,s.memoizedState=null,s.updateQueue=null,Zf(et)?(rt=!0,cg(s)):rt=!1,s.memoizedState=tt.state!==null&&tt.state!==void 0?tt.state:null,kh(s),tt.updater=Ei,s.stateNode=tt,tt._reactInternals=s,Ii(s,et,o,a),s=jj(null,s,et,!0,rt,a)):(s.tag=0,I$1&&rt&&vg(s),Xi(null,s,tt,a),s=s.child),s;case 16:et=s.elementType;e:{switch(ij(o,s),o=s.pendingProps,tt=et._init,et=tt(et._payload),s.type=et,tt=s.tag=Zk(et),o=Ci(et,o),tt){case 0:s=cj(null,s,et,o,a);break e;case 1:s=hj(null,s,et,o,a);break e;case 11:s=Yi(null,s,et,o,a);break e;case 14:s=$i(null,s,et,Ci(et.type,o),a);break e}throw Error(p$2(306,et,""))}return s;case 0:return et=s.type,tt=s.pendingProps,tt=s.elementType===et?tt:Ci(et,tt),cj(o,s,et,tt,a);case 1:return et=s.type,tt=s.pendingProps,tt=s.elementType===et?tt:Ci(et,tt),hj(o,s,et,tt,a);case 3:e:{if(kj(s),o===null)throw Error(p$2(387));et=s.pendingProps,rt=s.memoizedState,tt=rt.element,lh(o,s),qh(s,et,null,a);var nt=s.memoizedState;if(et=nt.element,rt.isDehydrated)if(rt={element:et,isDehydrated:!1,cache:nt.cache,pendingSuspenseBoundaries:nt.pendingSuspenseBoundaries,transitions:nt.transitions},s.updateQueue.baseState=rt,s.memoizedState=rt,s.flags&256){tt=Ji(Error(p$2(423)),s),s=lj(o,s,et,a,tt);break e}else if(et!==tt){tt=Ji(Error(p$2(424)),s),s=lj(o,s,et,a,tt);break e}else for(yg=Lf(s.stateNode.containerInfo.firstChild),xg=s,I$1=!0,zg=null,a=Vg(s,null,et,a),s.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(Ig(),et===tt){s=Zi(o,s,a);break e}Xi(o,s,et,a)}s=s.child}return s;case 5:return Ah(s),o===null&&Eg(s),et=s.type,tt=s.pendingProps,rt=o!==null?o.memoizedProps:null,nt=tt.children,Ef(et,tt)?nt=null:rt!==null&&Ef(et,rt)&&(s.flags|=32),gj(o,s),Xi(o,s,nt,a),s.child;case 6:return o===null&&Eg(s),null;case 13:return oj(o,s,a);case 4:return yh(s,s.stateNode.containerInfo),et=s.pendingProps,o===null?s.child=Ug(s,null,et,a):Xi(o,s,et,a),s.child;case 11:return et=s.type,tt=s.pendingProps,tt=s.elementType===et?tt:Ci(et,tt),Yi(o,s,et,tt,a);case 7:return Xi(o,s,s.pendingProps,a),s.child;case 8:return Xi(o,s,s.pendingProps.children,a),s.child;case 12:return Xi(o,s,s.pendingProps.children,a),s.child;case 10:e:{if(et=s.type._context,tt=s.pendingProps,rt=s.memoizedProps,nt=tt.value,G$1(Wg,et._currentValue),et._currentValue=nt,rt!==null)if(He(rt.value,nt)){if(rt.children===tt.children&&!Wf.current){s=Zi(o,s,a);break e}}else for(rt=s.child,rt!==null&&(rt.return=s);rt!==null;){var it=rt.dependencies;if(it!==null){nt=rt.child;for(var st=it.firstContext;st!==null;){if(st.context===et){if(rt.tag===1){st=mh(-1,a&-a),st.tag=2;var ot=rt.updateQueue;if(ot!==null){ot=ot.shared;var at=ot.pending;at===null?st.next=st:(st.next=at.next,at.next=st),ot.pending=st}}rt.lanes|=a,st=rt.alternate,st!==null&&(st.lanes|=a),bh(rt.return,a,s),it.lanes|=a;break}st=st.next}}else if(rt.tag===10)nt=rt.type===s.type?null:rt.child;else if(rt.tag===18){if(nt=rt.return,nt===null)throw Error(p$2(341));nt.lanes|=a,it=nt.alternate,it!==null&&(it.lanes|=a),bh(nt,a,s),nt=rt.sibling}else nt=rt.child;if(nt!==null)nt.return=rt;else for(nt=rt;nt!==null;){if(nt===s){nt=null;break}if(rt=nt.sibling,rt!==null){rt.return=nt.return,nt=rt;break}nt=nt.return}rt=nt}Xi(o,s,tt.children,a),s=s.child}return s;case 9:return tt=s.type,et=s.pendingProps.children,ch(s,a),tt=eh(tt),et=et(tt),s.flags|=1,Xi(o,s,et,a),s.child;case 14:return et=s.type,tt=Ci(et,s.pendingProps),tt=Ci(et.type,tt),$i(o,s,et,tt,a);case 15:return bj(o,s,s.type,s.pendingProps,a);case 17:return et=s.type,tt=s.pendingProps,tt=s.elementType===et?tt:Ci(et,tt),ij(o,s),s.tag=1,Zf(et)?(o=!0,cg(s)):o=!1,ch(s,a),Gi(s,et,tt),Ii(s,et,tt,a),jj(null,s,et,!0,o,a);case 19:return xj(o,s,a);case 22:return dj(o,s,a)}throw Error(p$2(156,s.tag))};function Fk(o,s){return ac(o,s)}function $k(o,s,a,et){this.tag=o,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=et,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(o,s,a,et){return new $k(o,s,a,et)}function aj(o){return o=o.prototype,!(!o||!o.isReactComponent)}function Zk(o){if(typeof o=="function")return aj(o)?1:0;if(o!=null){if(o=o.$$typeof,o===Da)return 11;if(o===Ga)return 14}return 2}function Pg(o,s){var a=o.alternate;return a===null?(a=Bg(o.tag,s,o.key,o.mode),a.elementType=o.elementType,a.type=o.type,a.stateNode=o.stateNode,a.alternate=o,o.alternate=a):(a.pendingProps=s,a.type=o.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=o.flags&14680064,a.childLanes=o.childLanes,a.lanes=o.lanes,a.child=o.child,a.memoizedProps=o.memoizedProps,a.memoizedState=o.memoizedState,a.updateQueue=o.updateQueue,s=o.dependencies,a.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},a.sibling=o.sibling,a.index=o.index,a.ref=o.ref,a}function Rg(o,s,a,et,tt,rt){var nt=2;if(et=o,typeof o=="function")aj(o)&&(nt=1);else if(typeof o=="string")nt=5;else e:switch(o){case ya:return Tg(a.children,tt,rt,s);case za:nt=8,tt|=8;break;case Aa:return o=Bg(12,a,s,tt|2),o.elementType=Aa,o.lanes=rt,o;case Ea:return o=Bg(13,a,s,tt),o.elementType=Ea,o.lanes=rt,o;case Fa:return o=Bg(19,a,s,tt),o.elementType=Fa,o.lanes=rt,o;case Ia:return pj(a,tt,rt,s);default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case Ba:nt=10;break e;case Ca:nt=9;break e;case Da:nt=11;break e;case Ga:nt=14;break e;case Ha:nt=16,et=null;break e}throw Error(p$2(130,o==null?o:typeof o,""))}return s=Bg(nt,a,s,tt),s.elementType=o,s.type=et,s.lanes=rt,s}function Tg(o,s,a,et){return o=Bg(7,o,et,s),o.lanes=a,o}function pj(o,s,a,et){return o=Bg(22,o,et,s),o.elementType=Ia,o.lanes=a,o.stateNode={isHidden:!1},o}function Qg(o,s,a){return o=Bg(6,o,null,s),o.lanes=a,o}function Sg(o,s,a){return s=Bg(4,o.children!==null?o.children:[],o.key,s),s.lanes=a,s.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},s}function al(o,s,a,et,tt){this.tag=s,this.containerInfo=o,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=et,this.onRecoverableError=tt,this.mutableSourceEagerHydrationData=null}function bl(o,s,a,et,tt,rt,nt,it,st){return o=new al(o,s,a,it,st),s===1?(s=1,rt===!0&&(s|=8)):s=0,rt=Bg(3,null,null,s),o.current=rt,rt.stateNode=o,rt.memoizedState={element:et,isDehydrated:a,cache:null,transitions:null,pendingSuspenseBoundaries:null},kh(rt),o}function cl(o,s,a){var et=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:et==null?null:""+et,children:o,containerInfo:s,implementation:a}}function dl(o){if(!o)return Vf;o=o._reactInternals;e:{if(Vb(o)!==o||o.tag!==1)throw Error(p$2(170));var s=o;do{switch(s.tag){case 3:s=s.stateNode.context;break e;case 1:if(Zf(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break e}}s=s.return}while(s!==null);throw Error(p$2(171))}if(o.tag===1){var a=o.type;if(Zf(a))return bg(o,a,s)}return s}function el(o,s,a,et,tt,rt,nt,it,st){return o=bl(a,et,!0,o,tt,rt,nt,it,st),o.context=dl(null),a=o.current,et=R$1(),tt=yi(a),rt=mh(et,tt),rt.callback=s??null,nh(a,rt,tt),o.current.lanes=tt,Ac(o,tt,et),Dk(o,et),o}function fl(o,s,a,et){var tt=s.current,rt=R$1(),nt=yi(tt);return a=dl(a),s.context===null?s.context=a:s.pendingContext=a,s=mh(rt,nt),s.payload={element:o},et=et===void 0?null:et,et!==null&&(s.callback=et),o=nh(tt,s,nt),o!==null&&(gi(o,tt,nt,rt),oh(o,tt,nt)),nt}function gl(o){if(o=o.current,!o.child)return null;switch(o.child.tag){case 5:return o.child.stateNode;default:return o.child.stateNode}}function hl(o,s){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var a=o.retryLane;o.retryLane=a!==0&&a<s?a:s}}function il(o,s){hl(o,s),(o=o.alternate)&&hl(o,s)}function jl(){return null}var kl=typeof reportError=="function"?reportError:function(o){console.error(o)};function ll(o){this._internalRoot=o}ml.prototype.render=ll.prototype.render=function(o){var s=this._internalRoot;if(s===null)throw Error(p$2(409));fl(o,s,null,null)};ml.prototype.unmount=ll.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var s=o.containerInfo;Rk(function(){fl(null,o,null,null)}),s[uf]=null}};function ml(o){this._internalRoot=o}ml.prototype.unstable_scheduleHydration=function(o){if(o){var s=Hc();o={blockedOn:null,target:o,priority:s};for(var a=0;a<Qc.length&&s!==0&&s<Qc[a].priority;a++);Qc.splice(a,0,o),a===0&&Vc(o)}};function nl(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function ol(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11&&(o.nodeType!==8||o.nodeValue!==" react-mount-point-unstable "))}function pl(){}function ql(o,s,a,et,tt){if(tt){if(typeof et=="function"){var rt=et;et=function(){var ot=gl(nt);rt.call(ot)}}var nt=el(s,et,o,0,null,!1,!1,"",pl);return o._reactRootContainer=nt,o[uf]=nt.current,sf(o.nodeType===8?o.parentNode:o),Rk(),nt}for(;tt=o.lastChild;)o.removeChild(tt);if(typeof et=="function"){var it=et;et=function(){var ot=gl(st);it.call(ot)}}var st=bl(o,0,!1,null,null,!1,!1,"",pl);return o._reactRootContainer=st,o[uf]=st.current,sf(o.nodeType===8?o.parentNode:o),Rk(function(){fl(s,st,a,et)}),st}function rl(o,s,a,et,tt){var rt=a._reactRootContainer;if(rt){var nt=rt;if(typeof tt=="function"){var it=tt;tt=function(){var st=gl(nt);it.call(st)}}fl(s,nt,o,tt)}else nt=ql(a,s,o,tt,et);return gl(nt)}Ec=function(o){switch(o.tag){case 3:var s=o.stateNode;if(s.current.memoizedState.isDehydrated){var a=tc(s.pendingLanes);a!==0&&(Cc(s,a|1),Dk(s,B$1()),!(K$2&6)&&(Gj=B$1()+500,jg()))}break;case 13:Rk(function(){var et=ih(o,1);if(et!==null){var tt=R$1();gi(et,o,1,tt)}}),il(o,1)}};Fc=function(o){if(o.tag===13){var s=ih(o,134217728);if(s!==null){var a=R$1();gi(s,o,134217728,a)}il(o,134217728)}};Gc=function(o){if(o.tag===13){var s=yi(o),a=ih(o,s);if(a!==null){var et=R$1();gi(a,o,s,et)}il(o,s)}};Hc=function(){return C$1};Ic=function(o,s){var a=C$1;try{return C$1=o,s()}finally{C$1=a}};yb=function(o,s,a){switch(s){case"input":if(bb(o,a),s=a.name,a.type==="radio"&&s!=null){for(a=o;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+s)+'][type="radio"]'),s=0;s<a.length;s++){var et=a[s];if(et!==o&&et.form===o.form){var tt=Db(et);if(!tt)throw Error(p$2(90));Wa(et),bb(et,tt)}}}break;case"textarea":ib(o,a);break;case"select":s=a.value,s!=null&&fb(o,!!a.multiple,s,!1)}};Gb=Qk;Hb=Rk;var sl={usingClientEntryPoint:!1,Events:[Cb,ue,Db,Eb,Fb,Qk]},tl={findFiberByHostInstance:Wc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ul={bundleType:tl.bundleType,version:tl.version,rendererPackageName:tl.rendererPackageName,rendererConfig:tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(o){return o=Zb(o),o===null?null:o.stateNode},findFiberByHostInstance:tl.findFiberByHostInstance||jl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vl.isDisabled&&vl.supportsFiber)try{kc=vl.inject(ul),lc=vl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sl;reactDom_production_min.createPortal=function(o,s){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nl(s))throw Error(p$2(200));return cl(o,s,null,a)};reactDom_production_min.createRoot=function(o,s){if(!nl(o))throw Error(p$2(299));var a=!1,et="",tt=kl;return s!=null&&(s.unstable_strictMode===!0&&(a=!0),s.identifierPrefix!==void 0&&(et=s.identifierPrefix),s.onRecoverableError!==void 0&&(tt=s.onRecoverableError)),s=bl(o,1,!1,null,null,a,!1,et,tt),o[uf]=s.current,sf(o.nodeType===8?o.parentNode:o),new ll(s)};reactDom_production_min.findDOMNode=function(o){if(o==null)return null;if(o.nodeType===1)return o;var s=o._reactInternals;if(s===void 0)throw typeof o.render=="function"?Error(p$2(188)):(o=Object.keys(o).join(","),Error(p$2(268,o)));return o=Zb(s),o=o===null?null:o.stateNode,o};reactDom_production_min.flushSync=function(o){return Rk(o)};reactDom_production_min.hydrate=function(o,s,a){if(!ol(s))throw Error(p$2(200));return rl(null,o,s,!0,a)};reactDom_production_min.hydrateRoot=function(o,s,a){if(!nl(o))throw Error(p$2(405));var et=a!=null&&a.hydratedSources||null,tt=!1,rt="",nt=kl;if(a!=null&&(a.unstable_strictMode===!0&&(tt=!0),a.identifierPrefix!==void 0&&(rt=a.identifierPrefix),a.onRecoverableError!==void 0&&(nt=a.onRecoverableError)),s=el(s,null,o,1,a??null,tt,!1,rt,nt),o[uf]=s.current,sf(o),et)for(o=0;o<et.length;o++)a=et[o],tt=a._getVersion,tt=tt(a._source),s.mutableSourceEagerHydrationData==null?s.mutableSourceEagerHydrationData=[a,tt]:s.mutableSourceEagerHydrationData.push(a,tt);return new ml(s)};reactDom_production_min.render=function(o,s,a){if(!ol(s))throw Error(p$2(200));return rl(null,o,s,!1,a)};reactDom_production_min.unmountComponentAtNode=function(o){if(!ol(o))throw Error(p$2(40));return o._reactRootContainer?(Rk(function(){rl(null,null,o,!1,function(){o._reactRootContainer=null,o[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Qk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(o,s,a,et){if(!ol(a))throw Error(p$2(200));if(o==null||o._reactInternals===void 0)throw Error(p$2(38));return rl(o,s,a,!1,et)};reactDom_production_min.version="18.3.1-next-f1338f8080-20240426";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(o){console.error(o)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports;const ReactDOM=getDefaultExportFromCjs$2(reactDomExports);var m$3=reactDomExports;client.createRoot=m$3.createRoot,client.hydrateRoot=m$3.hydrateRoot;const log$d=console;var document$4={};function getDefaultExportFromCjs$1(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var browser$7={exports:{}},process=browser$7.exports={},cachedSetTimeout,cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?cachedSetTimeout=setTimeout:cachedSetTimeout=defaultSetTimout}catch{cachedSetTimeout=defaultSetTimout}try{typeof clearTimeout=="function"?cachedClearTimeout=clearTimeout:cachedClearTimeout=defaultClearTimeout}catch{cachedClearTimeout=defaultClearTimeout}})();function runTimeout(o){if(cachedSetTimeout===setTimeout)return setTimeout(o,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(o,0);try{return cachedSetTimeout(o,0)}catch{try{return cachedSetTimeout.call(null,o,0)}catch{return cachedSetTimeout.call(this,o,0)}}}function runClearTimeout(o){if(cachedClearTimeout===clearTimeout)return clearTimeout(o);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(o);try{return cachedClearTimeout(o)}catch{try{return cachedClearTimeout.call(null,o)}catch{return cachedClearTimeout.call(this,o)}}}var queue$1=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){!draining||!currentQueue||(draining=!1,currentQueue.length?queue$1=currentQueue.concat(queue$1):queueIndex=-1,queue$1.length&&drainQueue())}function drainQueue(){if(!draining){var o=runTimeout(cleanUpNextTick);draining=!0;for(var s=queue$1.length;s;){for(currentQueue=queue$1,queue$1=[];++queueIndex<s;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,s=queue$1.length}currentQueue=null,draining=!1,runClearTimeout(o)}}process.nextTick=function(o){var s=new Array(arguments.length-1);if(arguments.length>1)for(var a=1;a<arguments.length;a++)s[a-1]=arguments[a];queue$1.push(new Item(o,s)),queue$1.length===1&&!draining&&runTimeout(drainQueue)};function Item(o,s){this.fun=o,this.array=s}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=!0;process.env={};process.argv=[];process.version="";process.versions={};function noop$6(){}process.on=noop$6;process.addListener=noop$6;process.once=noop$6;process.off=noop$6;process.removeListener=noop$6;process.removeAllListeners=noop$6;process.emit=noop$6;process.prependListener=noop$6;process.prependOnceListener=noop$6;process.listeners=function(o){return[]};process.binding=function(o){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(o){throw new Error("process.chdir is not supported")};process.umask=function(){return 0};var browserExports$1=browser$7.exports;const process$1=getDefaultExportFromCjs$1(browserExports$1);var util$b={},types$2={},shams$1=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var s={},a=Symbol("test"),et=Object(a);if(typeof a=="string"||Object.prototype.toString.call(a)!=="[object Symbol]"||Object.prototype.toString.call(et)!=="[object Symbol]")return!1;var tt=42;s[a]=tt;for(a in s)return!1;if(typeof Object.keys=="function"&&Object.keys(s).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(s).length!==0)return!1;var rt=Object.getOwnPropertySymbols(s);if(rt.length!==1||rt[0]!==a||!Object.prototype.propertyIsEnumerable.call(s,a))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var nt=Object.getOwnPropertyDescriptor(s,a);if(nt.value!==tt||nt.enumerable!==!0)return!1}return!0},hasSymbols$3=shams$1,shams=function(){return hasSymbols$3()&&!!Symbol.toStringTag},esErrors=Error,_eval=EvalError,range=RangeError,ref=ReferenceError,syntax=SyntaxError,type$1=TypeError,uri=URIError,origSymbol=typeof Symbol<"u"&&Symbol,hasSymbolSham=shams$1,hasSymbols$2=function(){return typeof origSymbol!="function"||typeof Symbol!="function"||typeof origSymbol("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:hasSymbolSham()},test={__proto__:null,foo:{}},$Object=Object,hasProto$1=function(){return{__proto__:test}.foo===test.foo&&!(test instanceof $Object)},ERROR_MESSAGE="Function.prototype.bind called on incompatible ",toStr$5=Object.prototype.toString,max=Math.max,funcType="[object Function]",concatty=function(s,a){for(var et=[],tt=0;tt<s.length;tt+=1)et[tt]=s[tt];for(var rt=0;rt<a.length;rt+=1)et[rt+s.length]=a[rt];return et},slicy=function(s,a){for(var et=[],tt=a,rt=0;tt<s.length;tt+=1,rt+=1)et[rt]=s[tt];return et},joiny=function(o,s){for(var a="",et=0;et<o.length;et+=1)a+=o[et],et+1<o.length&&(a+=s);return a},implementation$8=function(s){var a=this;if(typeof a!="function"||toStr$5.apply(a)!==funcType)throw new TypeError(ERROR_MESSAGE+a);for(var et=slicy(arguments,1),tt,rt=function(){if(this instanceof tt){var at=a.apply(this,concatty(et,arguments));return Object(at)===at?at:this}return a.apply(s,concatty(et,arguments))},nt=max(0,a.length-et.length),it=[],st=0;st<nt;st++)it[st]="$"+st;if(tt=Function("binder","return function ("+joiny(it,",")+"){ return binder.apply(this,arguments); }")(rt),a.prototype){var ot=function(){};ot.prototype=a.prototype,tt.prototype=new ot,ot.prototype=null}return tt},implementation$7=implementation$8,functionBind=Function.prototype.bind||implementation$7,call=Function.prototype.call,$hasOwn=Object.prototype.hasOwnProperty,bind$1=functionBind,hasown=bind$1.call(call,$hasOwn),undefined$1,$Error=esErrors,$EvalError=_eval,$RangeError=range,$ReferenceError=ref,$SyntaxError$1=syntax,$TypeError$2=type$1,$URIError=uri,$Function=Function,getEvalledConstructor=function(o){try{return $Function('"use strict"; return ('+o+").constructor;")()}catch{}},$gOPD$1=Object.getOwnPropertyDescriptor;if($gOPD$1)try{$gOPD$1({},"")}catch{$gOPD$1=null}var throwTypeError=function(){throw new $TypeError$2},ThrowTypeError=$gOPD$1?function(){try{return arguments.callee,throwTypeError}catch{try{return $gOPD$1(arguments,"callee").get}catch{return throwTypeError}}}():throwTypeError,hasSymbols$1=hasSymbols$2(),hasProto=hasProto$1(),getProto$1=Object.getPrototypeOf||(hasProto?function(o){return o.__proto__}:null),needsEval={},TypedArray=typeof Uint8Array>"u"||!getProto$1?undefined$1:getProto$1(Uint8Array),INTRINSICS={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?undefined$1:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?undefined$1:ArrayBuffer,"%ArrayIteratorPrototype%":hasSymbols$1&&getProto$1?getProto$1([][Symbol.iterator]()):undefined$1,"%AsyncFromSyncIteratorPrototype%":undefined$1,"%AsyncFunction%":needsEval,"%AsyncGenerator%":needsEval,"%AsyncGeneratorFunction%":needsEval,"%AsyncIteratorPrototype%":needsEval,"%Atomics%":typeof Atomics>"u"?undefined$1:Atomics,"%BigInt%":typeof BigInt>"u"?undefined$1:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?undefined$1:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?undefined$1:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?undefined$1:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":$Error,"%eval%":eval,"%EvalError%":$EvalError,"%Float32Array%":typeof Float32Array>"u"?undefined$1:Float32Array,"%Float64Array%":typeof Float64Array>"u"?undefined$1:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?undefined$1:FinalizationRegistry,"%Function%":$Function,"%GeneratorFunction%":needsEval,"%Int8Array%":typeof Int8Array>"u"?undefined$1:Int8Array,"%Int16Array%":typeof Int16Array>"u"?undefined$1:Int16Array,"%Int32Array%":typeof Int32Array>"u"?undefined$1:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":hasSymbols$1&&getProto$1?getProto$1(getProto$1([][Symbol.iterator]())):undefined$1,"%JSON%":typeof JSON=="object"?JSON:undefined$1,"%Map%":typeof Map>"u"?undefined$1:Map,"%MapIteratorPrototype%":typeof Map>"u"||!hasSymbols$1||!getProto$1?undefined$1:getProto$1(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?undefined$1:Promise,"%Proxy%":typeof Proxy>"u"?undefined$1:Proxy,"%RangeError%":$RangeError,"%ReferenceError%":$ReferenceError,"%Reflect%":typeof Reflect>"u"?undefined$1:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?undefined$1:Set,"%SetIteratorPrototype%":typeof Set>"u"||!hasSymbols$1||!getProto$1?undefined$1:getProto$1(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?undefined$1:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":hasSymbols$1&&getProto$1?getProto$1(""[Symbol.iterator]()):undefined$1,"%Symbol%":hasSymbols$1?Symbol:undefined$1,"%SyntaxError%":$SyntaxError$1,"%ThrowTypeError%":ThrowTypeError,"%TypedArray%":TypedArray,"%TypeError%":$TypeError$2,"%Uint8Array%":typeof Uint8Array>"u"?undefined$1:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?undefined$1:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?undefined$1:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?undefined$1:Uint32Array,"%URIError%":$URIError,"%WeakMap%":typeof WeakMap>"u"?undefined$1:WeakMap,"%WeakRef%":typeof WeakRef>"u"?undefined$1:WeakRef,"%WeakSet%":typeof WeakSet>"u"?undefined$1:WeakSet};if(getProto$1)try{null.error}catch(o){var errorProto=getProto$1(getProto$1(o));INTRINSICS["%Error.prototype%"]=errorProto}var doEval=function o(s){var a;if(s==="%AsyncFunction%")a=getEvalledConstructor("async function () {}");else if(s==="%GeneratorFunction%")a=getEvalledConstructor("function* () {}");else if(s==="%AsyncGeneratorFunction%")a=getEvalledConstructor("async function* () {}");else if(s==="%AsyncGenerator%"){var et=o("%AsyncGeneratorFunction%");et&&(a=et.prototype)}else if(s==="%AsyncIteratorPrototype%"){var tt=o("%AsyncGenerator%");tt&&getProto$1&&(a=getProto$1(tt.prototype))}return INTRINSICS[s]=a,a},LEGACY_ALIASES={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},bind=functionBind,hasOwn=hasown,$concat=bind.call(Function.call,Array.prototype.concat),$spliceApply=bind.call(Function.apply,Array.prototype.splice),$replace=bind.call(Function.call,String.prototype.replace),$strSlice=bind.call(Function.call,String.prototype.slice),$exec=bind.call(Function.call,RegExp.prototype.exec),rePropName=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,reEscapeChar=/\\(\\)?/g,stringToPath=function(s){var a=$strSlice(s,0,1),et=$strSlice(s,-1);if(a==="%"&&et!=="%")throw new $SyntaxError$1("invalid intrinsic syntax, expected closing `%`");if(et==="%"&&a!=="%")throw new $SyntaxError$1("invalid intrinsic syntax, expected opening `%`");var tt=[];return $replace(s,rePropName,function(rt,nt,it,st){tt[tt.length]=it?$replace(st,reEscapeChar,"$1"):nt||rt}),tt},getBaseIntrinsic=function(s,a){var et=s,tt;if(hasOwn(LEGACY_ALIASES,et)&&(tt=LEGACY_ALIASES[et],et="%"+tt[0]+"%"),hasOwn(INTRINSICS,et)){var rt=INTRINSICS[et];if(rt===needsEval&&(rt=doEval(et)),typeof rt>"u"&&!a)throw new $TypeError$2("intrinsic "+s+" exists, but is not available. Please file an issue!");return{alias:tt,name:et,value:rt}}throw new $SyntaxError$1("intrinsic "+s+" does not exist!")},getIntrinsic=function(s,a){if(typeof s!="string"||s.length===0)throw new $TypeError$2("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof a!="boolean")throw new $TypeError$2('"allowMissing" argument must be a boolean');if($exec(/^%?[^%]*%?$/,s)===null)throw new $SyntaxError$1("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var et=stringToPath(s),tt=et.length>0?et[0]:"",rt=getBaseIntrinsic("%"+tt+"%",a),nt=rt.name,it=rt.value,st=!1,ot=rt.alias;ot&&(tt=ot[0],$spliceApply(et,$concat([0,1],ot)));for(var at=1,lt=!0;at<et.length;at+=1){var ct=et[at],ht=$strSlice(ct,0,1),ft=$strSlice(ct,-1);if((ht==='"'||ht==="'"||ht==="`"||ft==='"'||ft==="'"||ft==="`")&&ht!==ft)throw new $SyntaxError$1("property names with quotes must have matching quotes");if((ct==="constructor"||!lt)&&(st=!0),tt+="."+ct,nt="%"+tt+"%",hasOwn(INTRINSICS,nt))it=INTRINSICS[nt];else if(it!=null){if(!(ct in it)){if(!a)throw new $TypeError$2("base intrinsic for "+s+" exists, but the property is not available.");return}if($gOPD$1&&at+1>=et.length){var dt=$gOPD$1(it,ct);lt=!!dt,lt&&"get"in dt&&!("originalValue"in dt.get)?it=dt.get:it=it[ct]}else lt=hasOwn(it,ct),it=it[ct];lt&&!st&&(INTRINSICS[nt]=it)}}return it},callBind$2={exports:{}},esDefineProperty,hasRequiredEsDefineProperty;function requireEsDefineProperty(){if(hasRequiredEsDefineProperty)return esDefineProperty;hasRequiredEsDefineProperty=1;var o=getIntrinsic,s=o("%Object.defineProperty%",!0)||!1;if(s)try{s({},"a",{value:1})}catch{s=!1}return esDefineProperty=s,esDefineProperty}var GetIntrinsic$2=getIntrinsic,$gOPD=GetIntrinsic$2("%Object.getOwnPropertyDescriptor%",!0);if($gOPD)try{$gOPD([],"length")}catch{$gOPD=null}var gopd$1=$gOPD,$defineProperty$1=requireEsDefineProperty(),$SyntaxError=syntax,$TypeError$1=type$1,gopd=gopd$1,defineDataProperty=function(s,a,et){if(!s||typeof s!="object"&&typeof s!="function")throw new $TypeError$1("`obj` must be an object or a function`");if(typeof a!="string"&&typeof a!="symbol")throw new $TypeError$1("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new $TypeError$1("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new $TypeError$1("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new $TypeError$1("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new $TypeError$1("`loose`, if provided, must be a boolean");var tt=arguments.length>3?arguments[3]:null,rt=arguments.length>4?arguments[4]:null,nt=arguments.length>5?arguments[5]:null,it=arguments.length>6?arguments[6]:!1,st=!!gopd&&gopd(s,a);if($defineProperty$1)$defineProperty$1(s,a,{configurable:nt===null&&st?st.configurable:!nt,enumerable:tt===null&&st?st.enumerable:!tt,value:et,writable:rt===null&&st?st.writable:!rt});else if(it||!tt&&!rt&&!nt)s[a]=et;else throw new $SyntaxError("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},$defineProperty=requireEsDefineProperty(),hasPropertyDescriptors=function(){return!!$defineProperty};hasPropertyDescriptors.hasArrayLengthDefineBug=function(){if(!$defineProperty)return null;try{return $defineProperty([],"length",{value:1}).length!==1}catch{return!0}};var hasPropertyDescriptors_1=hasPropertyDescriptors,GetIntrinsic$1=getIntrinsic,define=defineDataProperty,hasDescriptors=hasPropertyDescriptors_1(),gOPD$1=gopd$1,$TypeError=type$1,$floor=GetIntrinsic$1("%Math.floor%"),setFunctionLength=function(s,a){if(typeof s!="function")throw new $TypeError("`fn` is not a function");if(typeof a!="number"||a<0||a>4294967295||$floor(a)!==a)throw new $TypeError("`length` must be a positive 32-bit integer");var et=arguments.length>2&&!!arguments[2],tt=!0,rt=!0;if("length"in s&&gOPD$1){var nt=gOPD$1(s,"length");nt&&!nt.configurable&&(tt=!1),nt&&!nt.writable&&(rt=!1)}return(tt||rt||!et)&&(hasDescriptors?define(s,"length",a,!0,!0):define(s,"length",a)),s};(function(o){var s=functionBind,a=getIntrinsic,et=setFunctionLength,tt=type$1,rt=a("%Function.prototype.apply%"),nt=a("%Function.prototype.call%"),it=a("%Reflect.apply%",!0)||s.call(nt,rt),st=requireEsDefineProperty(),ot=a("%Math.max%");o.exports=function(ct){if(typeof ct!="function")throw new tt("a function is required");var ht=it(s,nt,arguments);return et(ht,1+ot(0,ct.length-(arguments.length-1)),!0)};var at=function(){return it(s,rt,arguments)};st?st(o.exports,"apply",{value:at}):o.exports.apply=at})(callBind$2);var callBindExports=callBind$2.exports,GetIntrinsic=getIntrinsic,callBind$1=callBindExports,$indexOf$1=callBind$1(GetIntrinsic("String.prototype.indexOf")),callBound$3=function(s,a){var et=GetIntrinsic(s,!!a);return typeof et=="function"&&$indexOf$1(s,".prototype.")>-1?callBind$1(et):et},hasToStringTag$3=shams(),callBound$2=callBound$3,$toString$1=callBound$2("Object.prototype.toString"),isStandardArguments=function(s){return hasToStringTag$3&&s&&typeof s=="object"&&Symbol.toStringTag in s?!1:$toString$1(s)==="[object Arguments]"},isLegacyArguments=function(s){return isStandardArguments(s)?!0:s!==null&&typeof s=="object"&&typeof s.length=="number"&&s.length>=0&&$toString$1(s)!=="[object Array]"&&$toString$1(s.callee)==="[object Function]"},supportsStandardArguments=function(){return isStandardArguments(arguments)}();isStandardArguments.isLegacyArguments=isLegacyArguments;var isArguments$1=supportsStandardArguments?isStandardArguments:isLegacyArguments,toStr$4=Object.prototype.toString,fnToStr$1=Function.prototype.toString,isFnRegex=/^\s*(?:function)?\*/,hasToStringTag$2=shams(),getProto=Object.getPrototypeOf,getGeneratorFunc=function(){if(!hasToStringTag$2)return!1;try{return Function("return function*() {}")()}catch{}},GeneratorFunction,isGeneratorFunction=function(s){if(typeof s!="function")return!1;if(isFnRegex.test(fnToStr$1.call(s)))return!0;if(!hasToStringTag$2){var a=toStr$4.call(s);return a==="[object GeneratorFunction]"}if(!getProto)return!1;if(typeof GeneratorFunction>"u"){var et=getGeneratorFunc();GeneratorFunction=et?getProto(et):!1}return getProto(s)===GeneratorFunction},fnToStr=Function.prototype.toString,reflectApply=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,badArrayLike,isCallableMarker;if(typeof reflectApply=="function"&&typeof Object.defineProperty=="function")try{badArrayLike=Object.defineProperty({},"length",{get:function(){throw isCallableMarker}}),isCallableMarker={},reflectApply(function(){throw 42},null,badArrayLike)}catch(o){o!==isCallableMarker&&(reflectApply=null)}else reflectApply=null;var constructorRegex=/^\s*class\b/,isES6ClassFn=function(s){try{var a=fnToStr.call(s);return constructorRegex.test(a)}catch{return!1}},tryFunctionObject=function(s){try{return isES6ClassFn(s)?!1:(fnToStr.call(s),!0)}catch{return!1}},toStr$3=Object.prototype.toString,objectClass="[object Object]",fnClass="[object Function]",genClass="[object GeneratorFunction]",ddaClass="[object HTMLAllCollection]",ddaClass2="[object HTML document.all class]",ddaClass3="[object HTMLCollection]",hasToStringTag$1=typeof Symbol=="function"&&!!Symbol.toStringTag,isIE68=!(0 in[,]),isDDA=function(){return!1};if(typeof document=="object"){var all$6=document.all;toStr$3.call(all$6)===toStr$3.call(document.all)&&(isDDA=function(s){if((isIE68||!s)&&(typeof s>"u"||typeof s=="object"))try{var a=toStr$3.call(s);return(a===ddaClass||a===ddaClass2||a===ddaClass3||a===objectClass)&&s("")==null}catch{}return!1})}var isCallable$1=reflectApply?function(s){if(isDDA(s))return!0;if(!s||typeof s!="function"&&typeof s!="object")return!1;try{reflectApply(s,null,badArrayLike)}catch(a){if(a!==isCallableMarker)return!1}return!isES6ClassFn(s)&&tryFunctionObject(s)}:function(s){if(isDDA(s))return!0;if(!s||typeof s!="function"&&typeof s!="object")return!1;if(hasToStringTag$1)return tryFunctionObject(s);if(isES6ClassFn(s))return!1;var a=toStr$3.call(s);return a!==fnClass&&a!==genClass&&!/^\[object HTML/.test(a)?!1:tryFunctionObject(s)},isCallable=isCallable$1,toStr$2=Object.prototype.toString,hasOwnProperty$5=Object.prototype.hasOwnProperty,forEachArray=function(s,a,et){for(var tt=0,rt=s.length;tt<rt;tt++)hasOwnProperty$5.call(s,tt)&&(et==null?a(s[tt],tt,s):a.call(et,s[tt],tt,s))},forEachString=function(s,a,et){for(var tt=0,rt=s.length;tt<rt;tt++)et==null?a(s.charAt(tt),tt,s):a.call(et,s.charAt(tt),tt,s)},forEachObject=function(s,a,et){for(var tt in s)hasOwnProperty$5.call(s,tt)&&(et==null?a(s[tt],tt,s):a.call(et,s[tt],tt,s))},forEach$2=function(s,a,et){if(!isCallable(a))throw new TypeError("iterator must be a function");var tt;arguments.length>=3&&(tt=et),toStr$2.call(s)==="[object Array]"?forEachArray(s,a,tt):typeof s=="string"?forEachString(s,a,tt):forEachObject(s,a,tt)},forEach_1=forEach$2,possibleTypedArrayNames=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],possibleNames=possibleTypedArrayNames,g$4=typeof globalThis>"u"?commonjsGlobal:globalThis,availableTypedArrays$1=function(){for(var s=[],a=0;a<possibleNames.length;a++)typeof g$4[possibleNames[a]]=="function"&&(s[s.length]=possibleNames[a]);return s},forEach$1=forEach_1,availableTypedArrays=availableTypedArrays$1,callBind=callBindExports,callBound$1=callBound$3,gOPD=gopd$1,$toString=callBound$1("Object.prototype.toString"),hasToStringTag=shams(),g$3=typeof globalThis>"u"?commonjsGlobal:globalThis,typedArrays=availableTypedArrays(),$slice=callBound$1("String.prototype.slice"),getPrototypeOf$1=Object.getPrototypeOf,$indexOf=callBound$1("Array.prototype.indexOf",!0)||function(s,a){for(var et=0;et<s.length;et+=1)if(s[et]===a)return et;return-1},cache$5={__proto__:null};hasToStringTag&&gOPD&&getPrototypeOf$1?forEach$1(typedArrays,function(o){var s=new g$3[o];if(Symbol.toStringTag in s){var a=getPrototypeOf$1(s),et=gOPD(a,Symbol.toStringTag);if(!et){var tt=getPrototypeOf$1(a);et=gOPD(tt,Symbol.toStringTag)}cache$5["$"+o]=callBind(et.get)}}):forEach$1(typedArrays,function(o){var s=new g$3[o],a=s.slice||s.set;a&&(cache$5["$"+o]=callBind(a))});var tryTypedArrays=function(s){var a=!1;return forEach$1(cache$5,function(et,tt){if(!a)try{"$"+et(s)===tt&&(a=$slice(tt,1))}catch{}}),a},trySlices=function(s){var a=!1;return forEach$1(cache$5,function(et,tt){if(!a)try{et(s),a=$slice(tt,1)}catch{}}),a},whichTypedArray$1=function(s){if(!s||typeof s!="object")return!1;if(!hasToStringTag){var a=$slice($toString(s),8,-1);return $indexOf(typedArrays,a)>-1?a:a!=="Object"?!1:trySlices(s)}return gOPD?tryTypedArrays(s):null},whichTypedArray=whichTypedArray$1,isTypedArray=function(s){return!!whichTypedArray(s)};(function(o){var s=isArguments$1,a=isGeneratorFunction,et=whichTypedArray$1,tt=isTypedArray;function rt(cr){return cr.call.bind(cr)}var nt=typeof BigInt<"u",it=typeof Symbol<"u",st=rt(Object.prototype.toString),ot=rt(Number.prototype.valueOf),at=rt(String.prototype.valueOf),lt=rt(Boolean.prototype.valueOf);if(nt)var ct=rt(BigInt.prototype.valueOf);if(it)var ht=rt(Symbol.prototype.valueOf);function ft(cr,Cr){if(typeof cr!="object")return!1;try{return Cr(cr),!0}catch{return!1}}o.isArgumentsObject=s,o.isGeneratorFunction=a,o.isTypedArray=tt;function dt(cr){return typeof Promise<"u"&&cr instanceof Promise||cr!==null&&typeof cr=="object"&&typeof cr.then=="function"&&typeof cr.catch=="function"}o.isPromise=dt;function pt(cr){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(cr):tt(cr)||Ht(cr)}o.isArrayBufferView=pt;function gt(cr){return et(cr)==="Uint8Array"}o.isUint8Array=gt;function mt(cr){return et(cr)==="Uint8ClampedArray"}o.isUint8ClampedArray=mt;function yt(cr){return et(cr)==="Uint16Array"}o.isUint16Array=yt;function vt(cr){return et(cr)==="Uint32Array"}o.isUint32Array=vt;function Et(cr){return et(cr)==="Int8Array"}o.isInt8Array=Et;function xt(cr){return et(cr)==="Int16Array"}o.isInt16Array=xt;function wt(cr){return et(cr)==="Int32Array"}o.isInt32Array=wt;function Rt(cr){return et(cr)==="Float32Array"}o.isFloat32Array=Rt;function Ct(cr){return et(cr)==="Float64Array"}o.isFloat64Array=Ct;function Ft(cr){return et(cr)==="BigInt64Array"}o.isBigInt64Array=Ft;function zt(cr){return et(cr)==="BigUint64Array"}o.isBigUint64Array=zt;function Nt(cr){return st(cr)==="[object Map]"}Nt.working=typeof Map<"u"&&Nt(new Map);function Kt(cr){return typeof Map>"u"?!1:Nt.working?Nt(cr):cr instanceof Map}o.isMap=Kt;function Yt(cr){return st(cr)==="[object Set]"}Yt.working=typeof Set<"u"&&Yt(new Set);function Bt(cr){return typeof Set>"u"?!1:Yt.working?Yt(cr):cr instanceof Set}o.isSet=Bt;function Pt(cr){return st(cr)==="[object WeakMap]"}Pt.working=typeof WeakMap<"u"&&Pt(new WeakMap);function Dt(cr){return typeof WeakMap>"u"?!1:Pt.working?Pt(cr):cr instanceof WeakMap}o.isWeakMap=Dt;function Tt(cr){return st(cr)==="[object WeakSet]"}Tt.working=typeof WeakSet<"u"&&Tt(new WeakSet);function St(cr){return Tt(cr)}o.isWeakSet=St;function Mt(cr){return st(cr)==="[object ArrayBuffer]"}Mt.working=typeof ArrayBuffer<"u"&&Mt(new ArrayBuffer);function jt(cr){return typeof ArrayBuffer>"u"?!1:Mt.working?Mt(cr):cr instanceof ArrayBuffer}o.isArrayBuffer=jt;function Gt(cr){return st(cr)==="[object DataView]"}Gt.working=typeof ArrayBuffer<"u"&&typeof DataView<"u"&&Gt(new DataView(new ArrayBuffer(1),0,1));function Ht(cr){return typeof DataView>"u"?!1:Gt.working?Gt(cr):cr instanceof DataView}o.isDataView=Ht;var At=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:void 0;function $t(cr){return st(cr)==="[object SharedArrayBuffer]"}function kt(cr){return typeof At>"u"?!1:(typeof $t.working>"u"&&($t.working=$t(new At)),$t.working?$t(cr):cr instanceof At)}o.isSharedArrayBuffer=kt;function Lt(cr){return st(cr)==="[object AsyncFunction]"}o.isAsyncFunction=Lt;function bt(cr){return st(cr)==="[object Map Iterator]"}o.isMapIterator=bt;function It(cr){return st(cr)==="[object Set Iterator]"}o.isSetIterator=It;function Ut(cr){return st(cr)==="[object Generator]"}o.isGeneratorObject=Ut;function Wt(cr){return st(cr)==="[object WebAssembly.Module]"}o.isWebAssemblyCompiledModule=Wt;function Xt(cr){return ft(cr,ot)}o.isNumberObject=Xt;function Qt(cr){return ft(cr,at)}o.isStringObject=Qt;function er(cr){return ft(cr,lt)}o.isBooleanObject=er;function lr(cr){return nt&&ft(cr,ct)}o.isBigIntObject=lr;function pr(cr){return it&&ft(cr,ht)}o.isSymbolObject=pr;function gr(cr){return Xt(cr)||Qt(cr)||er(cr)||lr(cr)||pr(cr)}o.isBoxedPrimitive=gr;function wr(cr){return typeof Uint8Array<"u"&&(jt(cr)||kt(cr))}o.isAnyArrayBuffer=wr,["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(cr){Object.defineProperty(o,cr,{enumerable:!1,value:function(){throw new Error(cr+" is not supported in userland")}})})})(types$2);var isBufferBrowser=function(s){return s&&typeof s=="object"&&typeof s.copy=="function"&&typeof s.fill=="function"&&typeof s.readUInt8=="function"},inherits_browser={exports:{}};typeof Object.create=="function"?inherits_browser.exports=function(s,a){a&&(s.super_=a,s.prototype=Object.create(a.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}))}:inherits_browser.exports=function(s,a){if(a){s.super_=a;var et=function(){};et.prototype=a.prototype,s.prototype=new et,s.prototype.constructor=s}};var inherits_browserExports=inherits_browser.exports;(function(o){var s={},a=Object.getOwnPropertyDescriptors||function(At){for(var $t=Object.keys(At),kt={},Lt=0;Lt<$t.length;Lt++)kt[$t[Lt]]=Object.getOwnPropertyDescriptor(At,$t[Lt]);return kt},et=/%[sdj%]/g;o.format=function(Ht){if(!xt(Ht)){for(var At=[],$t=0;$t<arguments.length;$t++)At.push(it(arguments[$t]));return At.join(" ")}for(var $t=1,kt=arguments,Lt=kt.length,bt=String(Ht).replace(et,function(Ut){if(Ut==="%%")return"%";if($t>=Lt)return Ut;switch(Ut){case"%s":return String(kt[$t++]);case"%d":return Number(kt[$t++]);case"%j":try{return JSON.stringify(kt[$t++])}catch{return"[Circular]"}default:return Ut}}),It=kt[$t];$t<Lt;It=kt[++$t])yt(It)||!Ft(It)?bt+=" "+It:bt+=" "+it(It);return bt},o.deprecate=function(Ht,At){if(typeof process$1<"u"&&process$1.noDeprecation===!0)return Ht;if(typeof process$1>"u")return function(){return o.deprecate(Ht,At).apply(this,arguments)};var $t=!1;function kt(){if(!$t){if(process$1.throwDeprecation)throw new Error(At);process$1.traceDeprecation?console.trace(At):console.error(At),$t=!0}return Ht.apply(this,arguments)}return kt};var tt={},rt=/^$/;if(s.NODE_DEBUG){var nt=s.NODE_DEBUG;nt=nt.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),rt=new RegExp("^"+nt+"$","i")}o.debuglog=function(Ht){if(Ht=Ht.toUpperCase(),!tt[Ht])if(rt.test(Ht)){var At=process$1.pid;tt[Ht]=function(){var $t=o.format.apply(o,arguments);console.error("%s %d: %s",Ht,At,$t)}}else tt[Ht]=function(){};return tt[Ht]};function it(Ht,At){var $t={seen:[],stylize:ot};return arguments.length>=3&&($t.depth=arguments[2]),arguments.length>=4&&($t.colors=arguments[3]),mt(At)?$t.showHidden=At:At&&o._extend($t,At),Rt($t.showHidden)&&($t.showHidden=!1),Rt($t.depth)&&($t.depth=2),Rt($t.colors)&&($t.colors=!1),Rt($t.customInspect)&&($t.customInspect=!0),$t.colors&&($t.stylize=st),lt($t,Ht,$t.depth)}o.inspect=it,it.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},it.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function st(Ht,At){var $t=it.styles[At];return $t?"\x1B["+it.colors[$t][0]+"m"+Ht+"\x1B["+it.colors[$t][1]+"m":Ht}function ot(Ht,At){return Ht}function at(Ht){var At={};return Ht.forEach(function($t,kt){At[$t]=!0}),At}function lt(Ht,At,$t){if(Ht.customInspect&&At&&Kt(At.inspect)&&At.inspect!==o.inspect&&!(At.constructor&&At.constructor.prototype===At)){var kt=At.inspect($t,Ht);return xt(kt)||(kt=lt(Ht,kt,$t)),kt}var Lt=ct(Ht,At);if(Lt)return Lt;var bt=Object.keys(At),It=at(bt);if(Ht.showHidden&&(bt=Object.getOwnPropertyNames(At)),Nt(At)&&(bt.indexOf("message")>=0||bt.indexOf("description")>=0))return ht(At);if(bt.length===0){if(Kt(At)){var Ut=At.name?": "+At.name:"";return Ht.stylize("[Function"+Ut+"]","special")}if(Ct(At))return Ht.stylize(RegExp.prototype.toString.call(At),"regexp");if(zt(At))return Ht.stylize(Date.prototype.toString.call(At),"date");if(Nt(At))return ht(At)}var Wt="",Xt=!1,Qt=["{","}"];if(gt(At)&&(Xt=!0,Qt=["[","]"]),Kt(At)){var er=At.name?": "+At.name:"";Wt=" [Function"+er+"]"}if(Ct(At)&&(Wt=" "+RegExp.prototype.toString.call(At)),zt(At)&&(Wt=" "+Date.prototype.toUTCString.call(At)),Nt(At)&&(Wt=" "+ht(At)),bt.length===0&&(!Xt||At.length==0))return Qt[0]+Wt+Qt[1];if($t<0)return Ct(At)?Ht.stylize(RegExp.prototype.toString.call(At),"regexp"):Ht.stylize("[Object]","special");Ht.seen.push(At);var lr;return Xt?lr=ft(Ht,At,$t,It,bt):lr=bt.map(function(pr){return dt(Ht,At,$t,It,pr,Xt)}),Ht.seen.pop(),pt(lr,Wt,Qt)}function ct(Ht,At){if(Rt(At))return Ht.stylize("undefined","undefined");if(xt(At)){var $t="'"+JSON.stringify(At).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return Ht.stylize($t,"string")}if(Et(At))return Ht.stylize(""+At,"number");if(mt(At))return Ht.stylize(""+At,"boolean");if(yt(At))return Ht.stylize("null","null")}function ht(Ht){return"["+Error.prototype.toString.call(Ht)+"]"}function ft(Ht,At,$t,kt,Lt){for(var bt=[],It=0,Ut=At.length;It<Ut;++It)St(At,String(It))?bt.push(dt(Ht,At,$t,kt,String(It),!0)):bt.push("");return Lt.forEach(function(Wt){Wt.match(/^\d+$/)||bt.push(dt(Ht,At,$t,kt,Wt,!0))}),bt}function dt(Ht,At,$t,kt,Lt,bt){var It,Ut,Wt;if(Wt=Object.getOwnPropertyDescriptor(At,Lt)||{value:At[Lt]},Wt.get?Wt.set?Ut=Ht.stylize("[Getter/Setter]","special"):Ut=Ht.stylize("[Getter]","special"):Wt.set&&(Ut=Ht.stylize("[Setter]","special")),St(kt,Lt)||(It="["+Lt+"]"),Ut||(Ht.seen.indexOf(Wt.value)<0?(yt($t)?Ut=lt(Ht,Wt.value,null):Ut=lt(Ht,Wt.value,$t-1),Ut.indexOf(`
`)>-1&&(bt?Ut=Ut.split(`
`).map(function(Xt){return"  "+Xt}).join(`
`).slice(2):Ut=`
`+Ut.split(`
`).map(function(Xt){return"   "+Xt}).join(`
`))):Ut=Ht.stylize("[Circular]","special")),Rt(It)){if(bt&&Lt.match(/^\d+$/))return Ut;It=JSON.stringify(""+Lt),It.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(It=It.slice(1,-1),It=Ht.stylize(It,"name")):(It=It.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),It=Ht.stylize(It,"string"))}return It+": "+Ut}function pt(Ht,At,$t){var kt=Ht.reduce(function(Lt,bt){return bt.indexOf(`
`)>=0,Lt+bt.replace(/\u001b\[\d\d?m/g,"").length+1},0);return kt>60?$t[0]+(At===""?"":At+`
 `)+" "+Ht.join(`,
  `)+" "+$t[1]:$t[0]+At+" "+Ht.join(", ")+" "+$t[1]}o.types=types$2;function gt(Ht){return Array.isArray(Ht)}o.isArray=gt;function mt(Ht){return typeof Ht=="boolean"}o.isBoolean=mt;function yt(Ht){return Ht===null}o.isNull=yt;function vt(Ht){return Ht==null}o.isNullOrUndefined=vt;function Et(Ht){return typeof Ht=="number"}o.isNumber=Et;function xt(Ht){return typeof Ht=="string"}o.isString=xt;function wt(Ht){return typeof Ht=="symbol"}o.isSymbol=wt;function Rt(Ht){return Ht===void 0}o.isUndefined=Rt;function Ct(Ht){return Ft(Ht)&&Bt(Ht)==="[object RegExp]"}o.isRegExp=Ct,o.types.isRegExp=Ct;function Ft(Ht){return typeof Ht=="object"&&Ht!==null}o.isObject=Ft;function zt(Ht){return Ft(Ht)&&Bt(Ht)==="[object Date]"}o.isDate=zt,o.types.isDate=zt;function Nt(Ht){return Ft(Ht)&&(Bt(Ht)==="[object Error]"||Ht instanceof Error)}o.isError=Nt,o.types.isNativeError=Nt;function Kt(Ht){return typeof Ht=="function"}o.isFunction=Kt;function Yt(Ht){return Ht===null||typeof Ht=="boolean"||typeof Ht=="number"||typeof Ht=="string"||typeof Ht=="symbol"||typeof Ht>"u"}o.isPrimitive=Yt,o.isBuffer=isBufferBrowser;function Bt(Ht){return Object.prototype.toString.call(Ht)}function Pt(Ht){return Ht<10?"0"+Ht.toString(10):Ht.toString(10)}var Dt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function Tt(){var Ht=new Date,At=[Pt(Ht.getHours()),Pt(Ht.getMinutes()),Pt(Ht.getSeconds())].join(":");return[Ht.getDate(),Dt[Ht.getMonth()],At].join(" ")}o.log=function(){console.log("%s - %s",Tt(),o.format.apply(o,arguments))},o.inherits=inherits_browserExports,o._extend=function(Ht,At){if(!At||!Ft(At))return Ht;for(var $t=Object.keys(At),kt=$t.length;kt--;)Ht[$t[kt]]=At[$t[kt]];return Ht};function St(Ht,At){return Object.prototype.hasOwnProperty.call(Ht,At)}var Mt=typeof Symbol<"u"?Symbol("util.promisify.custom"):void 0;o.promisify=function(At){if(typeof At!="function")throw new TypeError('The "original" argument must be of type Function');if(Mt&&At[Mt]){var $t=At[Mt];if(typeof $t!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty($t,Mt,{value:$t,enumerable:!1,writable:!1,configurable:!0}),$t}function $t(){for(var kt,Lt,bt=new Promise(function(Wt,Xt){kt=Wt,Lt=Xt}),It=[],Ut=0;Ut<arguments.length;Ut++)It.push(arguments[Ut]);It.push(function(Wt,Xt){Wt?Lt(Wt):kt(Xt)});try{At.apply(this,It)}catch(Wt){Lt(Wt)}return bt}return Object.setPrototypeOf($t,Object.getPrototypeOf(At)),Mt&&Object.defineProperty($t,Mt,{value:$t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties($t,a(At))},o.promisify.custom=Mt;function jt(Ht,At){if(!Ht){var $t=new Error("Promise was rejected with a falsy value");$t.reason=Ht,Ht=$t}return At(Ht)}function Gt(Ht){if(typeof Ht!="function")throw new TypeError('The "original" argument must be of type Function');function At(){for(var $t=[],kt=0;kt<arguments.length;kt++)$t.push(arguments[kt]);var Lt=$t.pop();if(typeof Lt!="function")throw new TypeError("The last argument must be of type Function");var bt=this,It=function(){return Lt.apply(bt,arguments)};Ht.apply(this,$t).then(function(Ut){process$1.nextTick(It.bind(null,null,Ut))},function(Ut){process$1.nextTick(jt.bind(null,Ut,It))})}return Object.setPrototypeOf(At,Object.getPrototypeOf(Ht)),Object.defineProperties(At,a(Ht)),At}o.callbackify=Gt})(util$b);var underscore$1={exports:{}};(function(o,s){(function(){var a=this,et=a._,tt=Array.prototype,rt=Object.prototype,nt=Function.prototype,it=tt.push,st=tt.slice,ot=rt.toString,at=rt.hasOwnProperty,lt=Array.isArray,ct=Object.keys,ht=nt.bind,ft=Object.create,dt=function(){},pt=function(bt){if(bt instanceof pt)return bt;if(!(this instanceof pt))return new pt(bt);this._wrapped=bt};o.exports&&(s=o.exports=pt),s._=pt,pt.VERSION="1.8.3";var gt=function(bt,It,Ut){if(It===void 0)return bt;switch(Ut??3){case 1:return function(Wt){return bt.call(It,Wt)};case 2:return function(Wt,Xt){return bt.call(It,Wt,Xt)};case 3:return function(Wt,Xt,Qt){return bt.call(It,Wt,Xt,Qt)};case 4:return function(Wt,Xt,Qt,er){return bt.call(It,Wt,Xt,Qt,er)}}return function(){return bt.apply(It,arguments)}},mt=function(bt,It,Ut){return bt==null?pt.identity:pt.isFunction(bt)?gt(bt,It,Ut):pt.isObject(bt)?pt.matcher(bt):pt.property(bt)};pt.iteratee=function(bt,It){return mt(bt,It,1/0)};var yt=function(bt,It){return function(Ut){var Wt=arguments.length;if(Wt<2||Ut==null)return Ut;for(var Xt=1;Xt<Wt;Xt++)for(var Qt=arguments[Xt],er=bt(Qt),lr=er.length,pr=0;pr<lr;pr++){var gr=er[pr];(!It||Ut[gr]===void 0)&&(Ut[gr]=Qt[gr])}return Ut}},vt=function(bt){if(!pt.isObject(bt))return{};if(ft)return ft(bt);dt.prototype=bt;var It=new dt;return dt.prototype=null,It},Et=function(bt){return function(It){return It?.[bt]}},xt=Math.pow(2,53)-1,wt=Et("length"),Rt=function(bt){var It=wt(bt);return typeof It=="number"&&It>=0&&It<=xt};pt.each=pt.forEach=function(bt,It,Ut){It=gt(It,Ut);var Wt,Xt;if(Rt(bt))for(Wt=0,Xt=bt.length;Wt<Xt;Wt++)It(bt[Wt],Wt,bt);else{var Qt=pt.keys(bt);for(Wt=0,Xt=Qt.length;Wt<Xt;Wt++)It(bt[Qt[Wt]],Qt[Wt],bt)}return bt},pt.map=pt.collect=function(bt,It,Ut){It=mt(It,Ut);for(var Wt=!Rt(bt)&&pt.keys(bt),Xt=(Wt||bt).length,Qt=Array(Xt),er=0;er<Xt;er++){var lr=Wt?Wt[er]:er;Qt[er]=It(bt[lr],lr,bt)}return Qt};function Ct(bt){function It(Ut,Wt,Xt,Qt,er,lr){for(;er>=0&&er<lr;er+=bt){var pr=Qt?Qt[er]:er;Xt=Wt(Xt,Ut[pr],pr,Ut)}return Xt}return function(Ut,Wt,Xt,Qt){Wt=gt(Wt,Qt,4);var er=!Rt(Ut)&&pt.keys(Ut),lr=(er||Ut).length,pr=bt>0?0:lr-1;return arguments.length<3&&(Xt=Ut[er?er[pr]:pr],pr+=bt),It(Ut,Wt,Xt,er,pr,lr)}}pt.reduce=pt.foldl=pt.inject=Ct(1),pt.reduceRight=pt.foldr=Ct(-1),pt.find=pt.detect=function(bt,It,Ut){var Wt;if(Rt(bt)?Wt=pt.findIndex(bt,It,Ut):Wt=pt.findKey(bt,It,Ut),Wt!==void 0&&Wt!==-1)return bt[Wt]},pt.filter=pt.select=function(bt,It,Ut){var Wt=[];return It=mt(It,Ut),pt.each(bt,function(Xt,Qt,er){It(Xt,Qt,er)&&Wt.push(Xt)}),Wt},pt.reject=function(bt,It,Ut){return pt.filter(bt,pt.negate(mt(It)),Ut)},pt.every=pt.all=function(bt,It,Ut){It=mt(It,Ut);for(var Wt=!Rt(bt)&&pt.keys(bt),Xt=(Wt||bt).length,Qt=0;Qt<Xt;Qt++){var er=Wt?Wt[Qt]:Qt;if(!It(bt[er],er,bt))return!1}return!0},pt.some=pt.any=function(bt,It,Ut){It=mt(It,Ut);for(var Wt=!Rt(bt)&&pt.keys(bt),Xt=(Wt||bt).length,Qt=0;Qt<Xt;Qt++){var er=Wt?Wt[Qt]:Qt;if(It(bt[er],er,bt))return!0}return!1},pt.contains=pt.includes=pt.include=function(bt,It,Ut,Wt){return Rt(bt)||(bt=pt.values(bt)),(typeof Ut!="number"||Wt)&&(Ut=0),pt.indexOf(bt,It,Ut)>=0},pt.invoke=function(bt,It){var Ut=st.call(arguments,2),Wt=pt.isFunction(It);return pt.map(bt,function(Xt){var Qt=Wt?It:Xt[It];return Qt==null?Qt:Qt.apply(Xt,Ut)})},pt.pluck=function(bt,It){return pt.map(bt,pt.property(It))},pt.where=function(bt,It){return pt.filter(bt,pt.matcher(It))},pt.findWhere=function(bt,It){return pt.find(bt,pt.matcher(It))},pt.max=function(bt,It,Ut){var Wt=-1/0,Xt=-1/0,Qt,er;if(It==null&&bt!=null){bt=Rt(bt)?bt:pt.values(bt);for(var lr=0,pr=bt.length;lr<pr;lr++)Qt=bt[lr],Qt>Wt&&(Wt=Qt)}else It=mt(It,Ut),pt.each(bt,function(gr,wr,cr){er=It(gr,wr,cr),(er>Xt||er===-1/0&&Wt===-1/0)&&(Wt=gr,Xt=er)});return Wt},pt.min=function(bt,It,Ut){var Wt=1/0,Xt=1/0,Qt,er;if(It==null&&bt!=null){bt=Rt(bt)?bt:pt.values(bt);for(var lr=0,pr=bt.length;lr<pr;lr++)Qt=bt[lr],Qt<Wt&&(Wt=Qt)}else It=mt(It,Ut),pt.each(bt,function(gr,wr,cr){er=It(gr,wr,cr),(er<Xt||er===1/0&&Wt===1/0)&&(Wt=gr,Xt=er)});return Wt},pt.shuffle=function(bt){for(var It=Rt(bt)?bt:pt.values(bt),Ut=It.length,Wt=Array(Ut),Xt=0,Qt;Xt<Ut;Xt++)Qt=pt.random(0,Xt),Qt!==Xt&&(Wt[Xt]=Wt[Qt]),Wt[Qt]=It[Xt];return Wt},pt.sample=function(bt,It,Ut){return It==null||Ut?(Rt(bt)||(bt=pt.values(bt)),bt[pt.random(bt.length-1)]):pt.shuffle(bt).slice(0,Math.max(0,It))},pt.sortBy=function(bt,It,Ut){return It=mt(It,Ut),pt.pluck(pt.map(bt,function(Wt,Xt,Qt){return{value:Wt,index:Xt,criteria:It(Wt,Xt,Qt)}}).sort(function(Wt,Xt){var Qt=Wt.criteria,er=Xt.criteria;if(Qt!==er){if(Qt>er||Qt===void 0)return 1;if(Qt<er||er===void 0)return-1}return Wt.index-Xt.index}),"value")};var Ft=function(bt){return function(It,Ut,Wt){var Xt={};return Ut=mt(Ut,Wt),pt.each(It,function(Qt,er){var lr=Ut(Qt,er,It);bt(Xt,Qt,lr)}),Xt}};pt.groupBy=Ft(function(bt,It,Ut){pt.has(bt,Ut)?bt[Ut].push(It):bt[Ut]=[It]}),pt.indexBy=Ft(function(bt,It,Ut){bt[Ut]=It}),pt.countBy=Ft(function(bt,It,Ut){pt.has(bt,Ut)?bt[Ut]++:bt[Ut]=1}),pt.toArray=function(bt){return bt?pt.isArray(bt)?st.call(bt):Rt(bt)?pt.map(bt,pt.identity):pt.values(bt):[]},pt.size=function(bt){return bt==null?0:Rt(bt)?bt.length:pt.keys(bt).length},pt.partition=function(bt,It,Ut){It=mt(It,Ut);var Wt=[],Xt=[];return pt.each(bt,function(Qt,er,lr){(It(Qt,er,lr)?Wt:Xt).push(Qt)}),[Wt,Xt]},pt.first=pt.head=pt.take=function(bt,It,Ut){if(bt!=null)return It==null||Ut?bt[0]:pt.initial(bt,bt.length-It)},pt.initial=function(bt,It,Ut){return st.call(bt,0,Math.max(0,bt.length-(It==null||Ut?1:It)))},pt.last=function(bt,It,Ut){if(bt!=null)return It==null||Ut?bt[bt.length-1]:pt.rest(bt,Math.max(0,bt.length-It))},pt.rest=pt.tail=pt.drop=function(bt,It,Ut){return st.call(bt,It==null||Ut?1:It)},pt.compact=function(bt){return pt.filter(bt,pt.identity)};var zt=function(bt,It,Ut,Wt){for(var Xt=[],Qt=0,er=Wt||0,lr=wt(bt);er<lr;er++){var pr=bt[er];if(Rt(pr)&&(pt.isArray(pr)||pt.isArguments(pr))){It||(pr=zt(pr,It,Ut));var gr=0,wr=pr.length;for(Xt.length+=wr;gr<wr;)Xt[Qt++]=pr[gr++]}else Ut||(Xt[Qt++]=pr)}return Xt};pt.flatten=function(bt,It){return zt(bt,It,!1)},pt.without=function(bt){return pt.difference(bt,st.call(arguments,1))},pt.uniq=pt.unique=function(bt,It,Ut,Wt){pt.isBoolean(It)||(Wt=Ut,Ut=It,It=!1),Ut!=null&&(Ut=mt(Ut,Wt));for(var Xt=[],Qt=[],er=0,lr=wt(bt);er<lr;er++){var pr=bt[er],gr=Ut?Ut(pr,er,bt):pr;It?((!er||Qt!==gr)&&Xt.push(pr),Qt=gr):Ut?pt.contains(Qt,gr)||(Qt.push(gr),Xt.push(pr)):pt.contains(Xt,pr)||Xt.push(pr)}return Xt},pt.union=function(){return pt.uniq(zt(arguments,!0,!0))},pt.intersection=function(bt){for(var It=[],Ut=arguments.length,Wt=0,Xt=wt(bt);Wt<Xt;Wt++){var Qt=bt[Wt];if(!pt.contains(It,Qt)){for(var er=1;er<Ut&&pt.contains(arguments[er],Qt);er++);er===Ut&&It.push(Qt)}}return It},pt.difference=function(bt){var It=zt(arguments,!0,!0,1);return pt.filter(bt,function(Ut){return!pt.contains(It,Ut)})},pt.zip=function(){return pt.unzip(arguments)},pt.unzip=function(bt){for(var It=bt&&pt.max(bt,wt).length||0,Ut=Array(It),Wt=0;Wt<It;Wt++)Ut[Wt]=pt.pluck(bt,Wt);return Ut},pt.object=function(bt,It){for(var Ut={},Wt=0,Xt=wt(bt);Wt<Xt;Wt++)It?Ut[bt[Wt]]=It[Wt]:Ut[bt[Wt][0]]=bt[Wt][1];return Ut};function Nt(bt){return function(It,Ut,Wt){Ut=mt(Ut,Wt);for(var Xt=wt(It),Qt=bt>0?0:Xt-1;Qt>=0&&Qt<Xt;Qt+=bt)if(Ut(It[Qt],Qt,It))return Qt;return-1}}pt.findIndex=Nt(1),pt.findLastIndex=Nt(-1),pt.sortedIndex=function(bt,It,Ut,Wt){Ut=mt(Ut,Wt,1);for(var Xt=Ut(It),Qt=0,er=wt(bt);Qt<er;){var lr=Math.floor((Qt+er)/2);Ut(bt[lr])<Xt?Qt=lr+1:er=lr}return Qt};function Kt(bt,It,Ut){return function(Wt,Xt,Qt){var er=0,lr=wt(Wt);if(typeof Qt=="number")bt>0?er=Qt>=0?Qt:Math.max(Qt+lr,er):lr=Qt>=0?Math.min(Qt+1,lr):Qt+lr+1;else if(Ut&&Qt&&lr)return Qt=Ut(Wt,Xt),Wt[Qt]===Xt?Qt:-1;if(Xt!==Xt)return Qt=It(st.call(Wt,er,lr),pt.isNaN),Qt>=0?Qt+er:-1;for(Qt=bt>0?er:lr-1;Qt>=0&&Qt<lr;Qt+=bt)if(Wt[Qt]===Xt)return Qt;return-1}}pt.indexOf=Kt(1,pt.findIndex,pt.sortedIndex),pt.lastIndexOf=Kt(-1,pt.findLastIndex),pt.range=function(bt,It,Ut){It==null&&(It=bt||0,bt=0),Ut=Ut||1;for(var Wt=Math.max(Math.ceil((It-bt)/Ut),0),Xt=Array(Wt),Qt=0;Qt<Wt;Qt++,bt+=Ut)Xt[Qt]=bt;return Xt};var Yt=function(bt,It,Ut,Wt,Xt){if(!(Wt instanceof It))return bt.apply(Ut,Xt);var Qt=vt(bt.prototype),er=bt.apply(Qt,Xt);return pt.isObject(er)?er:Qt};pt.bind=function(bt,It){if(ht&&bt.bind===ht)return ht.apply(bt,st.call(arguments,1));if(!pt.isFunction(bt))throw new TypeError("Bind must be called on a function");var Ut=st.call(arguments,2),Wt=function(){return Yt(bt,Wt,It,this,Ut.concat(st.call(arguments)))};return Wt},pt.partial=function(bt){var It=st.call(arguments,1),Ut=function(){for(var Wt=0,Xt=It.length,Qt=Array(Xt),er=0;er<Xt;er++)Qt[er]=It[er]===pt?arguments[Wt++]:It[er];for(;Wt<arguments.length;)Qt.push(arguments[Wt++]);return Yt(bt,Ut,this,this,Qt)};return Ut},pt.bindAll=function(bt){var It,Ut=arguments.length,Wt;if(Ut<=1)throw new Error("bindAll must be passed function names");for(It=1;It<Ut;It++)Wt=arguments[It],bt[Wt]=pt.bind(bt[Wt],bt);return bt},pt.memoize=function(bt,It){var Ut=function(Wt){var Xt=Ut.cache,Qt=""+(It?It.apply(this,arguments):Wt);return pt.has(Xt,Qt)||(Xt[Qt]=bt.apply(this,arguments)),Xt[Qt]};return Ut.cache={},Ut},pt.delay=function(bt,It){var Ut=st.call(arguments,2);return setTimeout(function(){return bt.apply(null,Ut)},It)},pt.defer=pt.partial(pt.delay,pt,1),pt.throttle=function(bt,It,Ut){var Wt,Xt,Qt,er=null,lr=0;Ut||(Ut={});var pr=function(){lr=Ut.leading===!1?0:pt.now(),er=null,Qt=bt.apply(Wt,Xt),er||(Wt=Xt=null)};return function(){var gr=pt.now();!lr&&Ut.leading===!1&&(lr=gr);var wr=It-(gr-lr);return Wt=this,Xt=arguments,wr<=0||wr>It?(er&&(clearTimeout(er),er=null),lr=gr,Qt=bt.apply(Wt,Xt),er||(Wt=Xt=null)):!er&&Ut.trailing!==!1&&(er=setTimeout(pr,wr)),Qt}},pt.debounce=function(bt,It,Ut){var Wt,Xt,Qt,er,lr,pr=function(){var gr=pt.now()-er;gr<It&&gr>=0?Wt=setTimeout(pr,It-gr):(Wt=null,Ut||(lr=bt.apply(Qt,Xt),Wt||(Qt=Xt=null)))};return function(){Qt=this,Xt=arguments,er=pt.now();var gr=Ut&&!Wt;return Wt||(Wt=setTimeout(pr,It)),gr&&(lr=bt.apply(Qt,Xt),Qt=Xt=null),lr}},pt.wrap=function(bt,It){return pt.partial(It,bt)},pt.negate=function(bt){return function(){return!bt.apply(this,arguments)}},pt.compose=function(){var bt=arguments,It=bt.length-1;return function(){for(var Ut=It,Wt=bt[It].apply(this,arguments);Ut--;)Wt=bt[Ut].call(this,Wt);return Wt}},pt.after=function(bt,It){return function(){if(--bt<1)return It.apply(this,arguments)}},pt.before=function(bt,It){var Ut;return function(){return--bt>0&&(Ut=It.apply(this,arguments)),bt<=1&&(It=null),Ut}},pt.once=pt.partial(pt.before,2);var Bt=!{toString:null}.propertyIsEnumerable("toString"),Pt=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function Dt(bt,It){var Ut=Pt.length,Wt=bt.constructor,Xt=pt.isFunction(Wt)&&Wt.prototype||rt,Qt="constructor";for(pt.has(bt,Qt)&&!pt.contains(It,Qt)&&It.push(Qt);Ut--;)Qt=Pt[Ut],Qt in bt&&bt[Qt]!==Xt[Qt]&&!pt.contains(It,Qt)&&It.push(Qt)}pt.keys=function(bt){if(!pt.isObject(bt))return[];if(ct)return ct(bt);var It=[];for(var Ut in bt)pt.has(bt,Ut)&&It.push(Ut);return Bt&&Dt(bt,It),It},pt.allKeys=function(bt){if(!pt.isObject(bt))return[];var It=[];for(var Ut in bt)It.push(Ut);return Bt&&Dt(bt,It),It},pt.values=function(bt){for(var It=pt.keys(bt),Ut=It.length,Wt=Array(Ut),Xt=0;Xt<Ut;Xt++)Wt[Xt]=bt[It[Xt]];return Wt},pt.mapObject=function(bt,It,Ut){It=mt(It,Ut);for(var Wt=pt.keys(bt),Xt=Wt.length,Qt={},er,lr=0;lr<Xt;lr++)er=Wt[lr],Qt[er]=It(bt[er],er,bt);return Qt},pt.pairs=function(bt){for(var It=pt.keys(bt),Ut=It.length,Wt=Array(Ut),Xt=0;Xt<Ut;Xt++)Wt[Xt]=[It[Xt],bt[It[Xt]]];return Wt},pt.invert=function(bt){for(var It={},Ut=pt.keys(bt),Wt=0,Xt=Ut.length;Wt<Xt;Wt++)It[bt[Ut[Wt]]]=Ut[Wt];return It},pt.functions=pt.methods=function(bt){var It=[];for(var Ut in bt)pt.isFunction(bt[Ut])&&It.push(Ut);return It.sort()},pt.extend=yt(pt.allKeys),pt.extendOwn=pt.assign=yt(pt.keys),pt.findKey=function(bt,It,Ut){It=mt(It,Ut);for(var Wt=pt.keys(bt),Xt,Qt=0,er=Wt.length;Qt<er;Qt++)if(Xt=Wt[Qt],It(bt[Xt],Xt,bt))return Xt},pt.pick=function(bt,It,Ut){var Wt={},Xt=bt,Qt,er;if(Xt==null)return Wt;pt.isFunction(It)?(er=pt.allKeys(Xt),Qt=gt(It,Ut)):(er=zt(arguments,!1,!1,1),Qt=function(cr,Cr,_r){return Cr in _r},Xt=Object(Xt));for(var lr=0,pr=er.length;lr<pr;lr++){var gr=er[lr],wr=Xt[gr];Qt(wr,gr,Xt)&&(Wt[gr]=wr)}return Wt},pt.omit=function(bt,It,Ut){if(pt.isFunction(It))It=pt.negate(It);else{var Wt=pt.map(zt(arguments,!1,!1,1),String);It=function(Xt,Qt){return!pt.contains(Wt,Qt)}}return pt.pick(bt,It,Ut)},pt.defaults=yt(pt.allKeys,!0),pt.create=function(bt,It){var Ut=vt(bt);return It&&pt.extendOwn(Ut,It),Ut},pt.clone=function(bt){return pt.isObject(bt)?pt.isArray(bt)?bt.slice():pt.extend({},bt):bt},pt.tap=function(bt,It){return It(bt),bt},pt.isMatch=function(bt,It){var Ut=pt.keys(It),Wt=Ut.length;if(bt==null)return!Wt;for(var Xt=Object(bt),Qt=0;Qt<Wt;Qt++){var er=Ut[Qt];if(It[er]!==Xt[er]||!(er in Xt))return!1}return!0};var Tt=function(bt,It,Ut,Wt){if(bt===It)return bt!==0||1/bt===1/It;if(bt==null||It==null)return bt===It;bt instanceof pt&&(bt=bt._wrapped),It instanceof pt&&(It=It._wrapped);var Xt=ot.call(bt);if(Xt!==ot.call(It))return!1;switch(Xt){case"[object RegExp]":case"[object String]":return""+bt==""+It;case"[object Number]":return+bt!=+bt?+It!=+It:+bt==0?1/+bt===1/It:+bt==+It;case"[object Date]":case"[object Boolean]":return+bt==+It}var Qt=Xt==="[object Array]";if(!Qt){if(typeof bt!="object"||typeof It!="object")return!1;var er=bt.constructor,lr=It.constructor;if(er!==lr&&!(pt.isFunction(er)&&er instanceof er&&pt.isFunction(lr)&&lr instanceof lr)&&"constructor"in bt&&"constructor"in It)return!1}Ut=Ut||[],Wt=Wt||[];for(var pr=Ut.length;pr--;)if(Ut[pr]===bt)return Wt[pr]===It;if(Ut.push(bt),Wt.push(It),Qt){if(pr=bt.length,pr!==It.length)return!1;for(;pr--;)if(!Tt(bt[pr],It[pr],Ut,Wt))return!1}else{var gr=pt.keys(bt),wr;if(pr=gr.length,pt.keys(It).length!==pr)return!1;for(;pr--;)if(wr=gr[pr],!(pt.has(It,wr)&&Tt(bt[wr],It[wr],Ut,Wt)))return!1}return Ut.pop(),Wt.pop(),!0};pt.isEqual=function(bt,It){return Tt(bt,It)},pt.isEmpty=function(bt){return bt==null?!0:Rt(bt)&&(pt.isArray(bt)||pt.isString(bt)||pt.isArguments(bt))?bt.length===0:pt.keys(bt).length===0},pt.isElement=function(bt){return!!(bt&&bt.nodeType===1)},pt.isArray=lt||function(bt){return ot.call(bt)==="[object Array]"},pt.isObject=function(bt){var It=typeof bt;return It==="function"||It==="object"&&!!bt},pt.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(bt){pt["is"+bt]=function(It){return ot.call(It)==="[object "+bt+"]"}}),pt.isArguments(arguments)||(pt.isArguments=function(bt){return pt.has(bt,"callee")}),typeof/./!="function"&&typeof Int8Array!="object"&&(pt.isFunction=function(bt){return typeof bt=="function"||!1}),pt.isFinite=function(bt){return isFinite(bt)&&!isNaN(parseFloat(bt))},pt.isNaN=function(bt){return pt.isNumber(bt)&&bt!==+bt},pt.isBoolean=function(bt){return bt===!0||bt===!1||ot.call(bt)==="[object Boolean]"},pt.isNull=function(bt){return bt===null},pt.isUndefined=function(bt){return bt===void 0},pt.has=function(bt,It){return bt!=null&&at.call(bt,It)},pt.noConflict=function(){return a._=et,this},pt.identity=function(bt){return bt},pt.constant=function(bt){return function(){return bt}},pt.noop=function(){},pt.property=Et,pt.propertyOf=function(bt){return bt==null?function(){}:function(It){return bt[It]}},pt.matcher=pt.matches=function(bt){return bt=pt.extendOwn({},bt),function(It){return pt.isMatch(It,bt)}},pt.times=function(bt,It,Ut){var Wt=Array(Math.max(0,bt));It=gt(It,Ut,1);for(var Xt=0;Xt<bt;Xt++)Wt[Xt]=It(Xt);return Wt},pt.random=function(bt,It){return It==null&&(It=bt,bt=0),bt+Math.floor(Math.random()*(It-bt+1))},pt.now=Date.now||function(){return new Date().getTime()};var St={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},Mt=pt.invert(St),jt=function(bt){var It=function(Qt){return bt[Qt]},Ut="(?:"+pt.keys(bt).join("|")+")",Wt=RegExp(Ut),Xt=RegExp(Ut,"g");return function(Qt){return Qt=Qt==null?"":""+Qt,Wt.test(Qt)?Qt.replace(Xt,It):Qt}};pt.escape=jt(St),pt.unescape=jt(Mt),pt.result=function(bt,It,Ut){var Wt=bt?.[It];return Wt===void 0&&(Wt=Ut),pt.isFunction(Wt)?Wt.call(bt):Wt};var Gt=0;pt.uniqueId=function(bt){var It=++Gt+"";return bt?bt+It:It},pt.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var Ht=/(.)^/,At={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},$t=/\\|'|\r|\n|\u2028|\u2029/g,kt=function(bt){return"\\"+At[bt]};pt.template=function(bt,It,Ut){!It&&Ut&&(It=Ut),It=pt.defaults({},It,pt.templateSettings);var Wt=RegExp([(It.escape||Ht).source,(It.interpolate||Ht).source,(It.evaluate||Ht).source].join("|")+"|$","g"),Xt=0,Qt="__p+='";bt.replace(Wt,function(gr,wr,cr,Cr,_r){return Qt+=bt.slice(Xt,_r).replace($t,kt),Xt=_r+gr.length,wr?Qt+=`'+
((__t=(`+wr+`))==null?'':_.escape(__t))+
'`:cr?Qt+=`'+
((__t=(`+cr+`))==null?'':__t)+
'`:Cr&&(Qt+=`';
`+Cr+`
__p+='`),gr}),Qt+=`';
`,It.variable||(Qt=`with(obj||{}){
`+Qt+`}
`),Qt=`var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};
`+Qt+`return __p;
`;try{var er=new Function(It.variable||"obj","_",Qt)}catch(gr){throw gr.source=Qt,gr}var lr=function(gr){return er.call(this,gr,pt)},pr=It.variable||"obj";return lr.source="function("+pr+`){
`+Qt+"}",lr},pt.chain=function(bt){var It=pt(bt);return It._chain=!0,It};var Lt=function(bt,It){return bt._chain?pt(It).chain():It};pt.mixin=function(bt){pt.each(pt.functions(bt),function(It){var Ut=pt[It]=bt[It];pt.prototype[It]=function(){var Wt=[this._wrapped];return it.apply(Wt,arguments),Lt(this,Ut.apply(pt,Wt))}})},pt.mixin(pt),pt.each(["pop","push","reverse","shift","sort","splice","unshift"],function(bt){var It=tt[bt];pt.prototype[bt]=function(){var Ut=this._wrapped;return It.apply(Ut,arguments),(bt==="shift"||bt==="splice")&&Ut.length===0&&delete Ut[0],Lt(this,Ut)}}),pt.each(["concat","join","slice"],function(bt){var It=tt[bt];pt.prototype[bt]=function(){return Lt(this,It.apply(this._wrapped,arguments))}}),pt.prototype.value=function(){return this._wrapped},pt.prototype.valueOf=pt.prototype.toJSON=pt.prototype.value,pt.prototype.toString=function(){return""+this._wrapped}}).call(commonjsGlobal)})(underscore$1,underscore$1.exports);var underscoreExports=underscore$1.exports,schemas$2={},_$6=underscoreExports,util$a=util$b,specAllowedKeys=["type","index","unique","sparse","default","get","set","enumerable"];function isComplexSpec(o){return typeof o=="object"&&!util$a.isArray(o)&&_$6.keys(o).every(function(s){return _$6.contains(specAllowedKeys,s)})}function mapSpec(o){return o===String?"string":o===Number?"number":o===Object?"object":o===Array?"array":o===Boolean?"boolean":o==Date?"date":o}function normalize(o){return _$6.each(o,function(s,a){if(isComplexSpec(s)){s.type=mapSpec(s.type);return}else util$a.isArray(s)?o[a]={schema:mapSpec(s[0])||void 0,type:"array"}:typeof s=="object"?o[a]={schema:normalize(s),type:"object"}:o[a]={type:mapSpec(s)}}),o}function construct(o,s){if(util$a.isArray(o)){var a=s;if(!a)return o;for(var et=o.length;et--;)typeof o[et]!=a&&(canCast(o[et],a)?o[et]=castToType(o[et],a):o.splice(et,1));return o}return _$6.each(s,function(tt,rt){if(tt.get||tt.set){var it=o[rt],nt=o.hasOwnProperty(rt);Object.defineProperty(o,rt,{get:tt.get,set:tt.set,enumerable:!0}),nt&&(o[rt]=it);return}if(tt.type){var it;o.hasOwnProperty(rt)&&canCast(o[rt],tt.type)?it=castToType(o[rt],tt.type):tt.hasOwnProperty("default")&&canCast(tt.default,tt.type)?it=castToType(tt.default,tt.type):it=defaultValue(tt.type),tt.schema&&construct(it,tt.schema),Object.defineProperty(o,rt,{enumerable:!0,get:tt.type=="array"?function(){return construct(it,tt.schema),it}:function(){return it},set:function(st){if(canCast(st,tt.type)){var ot=it;it=castToType(st,tt.type),tt.schema&&it!=ot&&construct(it,tt.schema)}}})}}),o}function canCast(o,s){return!!(s===!0||s=="mixed"||s=="array"&&util$a.isArray(o)||typeof o==s||s=="string"&&o&&o.toString||s=="number"&&!isNaN(o)||s=="date"&&!isNaN(new Date(o).getTime())||s=="boolean"&&!isNaN(o)||util$a.isRegExp(s)&&o.toString&&s.test(o))}function castToType(o,s){if(s===!0||s=="mixed"||s=="array"&&util$a.isArray(o)||typeof o==s)return o;if(s=="string")return o.toString();if(s=="number")return parseFloat(o);if(s=="boolean")return!!o;if(s=="date")return new Date(o);if(util$a.isRegExp(s))return o.toString()}function defaultValue(o){return util$a.isRegExp(o)?"":{string:"",id:null,number:0,boolean:!1,date:new Date,regexp:new RegExp,function:function(){},array:[],object:{}}[o]}function getIndexes(o,et){var a=[],et=et||"";return _$6.each(o,function(tt,rt){if(tt.schema)return a=a.concat(getIndexes(tt.schema,et+rt+"."));tt.index&&a.push({fieldName:et+rt,sparse:tt.sparse,unique:tt.unique})}),a}schemas$2.construct=construct;schemas$2.normalize=normalize;schemas$2.indexes=getIndexes;var util$9=util$b,_$5=underscoreExports,schemas$1=schemas$2,modifierFunctions={},lastStepModifierFunctions={},comparisonFunctions={},logicalOperators={},arrayComparisonFunctions={};function checkKey(o,s){if(typeof o=="string"){if(o[0]==="$"&&!(o==="$$date"&&typeof s=="number")&&!(o==="$$regex"&&typeof s=="string")&&!(o==="$$deleted"&&s===!0)&&o!=="$$indexCreated"&&o!=="$$indexRemoved")throw"Field names cannot begin with the $ character";if(o.indexOf(".")!==-1)throw"Field names cannot contain a ."}}function checkObject(o){util$9.isArray(o)&&o.forEach(function(s){checkObject(s)}),typeof o=="object"&&o!==null&&Object.keys(o).forEach(function(s){checkKey(s,o[s]),checkObject(o[s])})}function serialize$3(o){var s;return s=JSON.stringify(o,function(a,et){if(checkKey(a,et),et!==void 0)return et===null?null:typeof this[a].getTime=="function"?{$$date:this[a].getTime()}:typeof this[a].test=="function"?{$$regex:this[a].toString()}:et}),s}function deserialize$3(o){return JSON.parse(o,function(s,a){return s==="$$date"?new Date(a):typeof a=="string"||typeof a=="number"||typeof a=="boolean"||a===null?a:a&&a.$$date?a.$$date:a&&a.$$regex?deserializeRegex(a.$$regex):a})}function deserializeRegex(o){var s=o.split("/"),a=s.pop(),et=s.slice(1).join("/");return new RegExp(et,a)}function deepCopy(o,s){var a;if(typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o===null||util$9.isDate(o))return o;if(util$9.isArray(o))return a=[],o.forEach(function(et){a.push(deepCopy(et,s))}),a;if(typeof o=="object")return a={},Object.keys(o).forEach(function(et){(!s||et[0]!=="$"&&et.indexOf(".")===-1)&&(a[et]=deepCopy(o[et],s))}),a}function isPrimitiveType(o){return typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o===null||util$9.isDate(o)||util$9.isArray(o)}function compareNSB(o,s){return o<s?-1:o>s?1:0}function compareArrays(o,s){var a,et;for(a=0;a<Math.min(o.length,s.length);a+=1)if(et=compareThings(o[a],s[a]),et!==0)return et;return compareNSB(o.length,s.length)}function compoundCompareThings(o){return function(s,a){var et,tt,rt;if(s===void 0)return a===void 0?0:-1;if(a===void 0)return s===void 0?0:1;if(s===null)return a===null?0:-1;if(a===null)return s===null?0:1;for(et=0,tt=o.length;et<tt;et++)if(rt=compareThings(s[o[et]],a[o[et]]),rt!==0)return rt;return 0}}function compareThings(o,s){var a,et,tt,rt;if(o===void 0)return s===void 0?0:-1;if(s===void 0)return o===void 0?0:1;if(o===null)return s===null?0:-1;if(s===null)return o===null?0:1;if(typeof o=="number")return typeof s=="number"?compareNSB(o,s):-1;if(typeof s=="number")return typeof o=="number"?compareNSB(o,s):1;if(typeof o=="string")return typeof s=="string"?compareNSB(o,s):-1;if(typeof s=="string")return typeof o=="string"?compareNSB(o,s):1;if(typeof o=="boolean")return typeof s=="boolean"?compareNSB(o,s):-1;if(typeof s=="boolean")return typeof o=="boolean"?compareNSB(o,s):1;if(util$9.isDate(o))return util$9.isDate(s)?compareNSB(o.getTime(),s.getTime()):-1;if(util$9.isDate(s))return util$9.isDate(o)?compareNSB(o.getTime(),s.getTime()):1;if(util$9.isArray(o))return util$9.isArray(s)?compareArrays(o,s):-1;if(util$9.isArray(s))return util$9.isArray(o)?compareArrays(o,s):1;for(a=Object.keys(o).sort(),et=Object.keys(s).sort(),rt=0;rt<Math.min(a.length,et.length);rt+=1)if(tt=compareThings(o[a[rt]],s[et[rt]]),tt!==0)return tt;return compareNSB(a.length,et.length)}lastStepModifierFunctions.$set=function(o,s,a){o[s]=a};lastStepModifierFunctions.$unset=function(o,s,a){delete o[s]};lastStepModifierFunctions.$push=function(o,s,a){if(o.hasOwnProperty(s)||(o[s]=[]),!util$9.isArray(o[s]))throw"Can't $push an element on non-array values";if(a!==null&&typeof a=="object"&&a.$each){if(Object.keys(a).length>1)throw"Can't use another field in conjunction with $each";if(!util$9.isArray(a.$each))throw"$each requires an array value";a.$each.forEach(function(et){o[s].push(et)})}else o[s].push(a)};lastStepModifierFunctions.$addToSet=function(o,s,a){var et=!0;if(o.hasOwnProperty(s)||(o[s]=[]),!util$9.isArray(o[s]))throw"Can't $addToSet an element on non-array values";if(a!==null&&typeof a=="object"&&a.$each){if(Object.keys(a).length>1)throw"Can't use another field in conjunction with $each";if(!util$9.isArray(a.$each))throw"$each requires an array value";a.$each.forEach(function(tt){lastStepModifierFunctions.$addToSet(o,s,tt)})}else o[s].forEach(function(tt){compareThings(tt,a)===0&&(et=!1)}),et&&o[s].push(a)};lastStepModifierFunctions.$pop=function(o,s,a){if(!util$9.isArray(o[s]))throw"Can't $pop an element from non-array values";if(typeof a!="number")throw a+" isn't an integer, can't use it with $pop";a!==0&&(a>0?o[s]=o[s].slice(0,o[s].length-1):o[s]=o[s].slice(1))};lastStepModifierFunctions.$pull=function(o,s,a){var et,tt;if(!util$9.isArray(o[s]))throw"Can't $pull an element from non-array values";for(et=o[s],tt=et.length-1;tt>=0;tt-=1)match$1(et[tt],a)&&et.splice(tt,1)};lastStepModifierFunctions.$inc=function(o,s,a){if(typeof a!="number")throw a+" must be a number";if(typeof o[s]!="number")if(!_$5.has(o,s))o[s]=a;else throw"Don't use the $inc modifier on non-number fields";else o[s]+=a};function createModifierFunction(o){return function(s,a,et){var tt=typeof a=="string"?a.split("."):a;tt.length===1?lastStepModifierFunctions[o](s,a,et):(s[tt[0]]=s[tt[0]]||{},modifierFunctions[o](s[tt[0]],tt.slice(1),et))}}Object.keys(lastStepModifierFunctions).forEach(function(o){modifierFunctions[o]=createModifierFunction(o)});function modify(o,s){var a=Object.keys(s),et=_$5.map(a,function(it){return it[0]}),tt=_$5.filter(et,function(it){return it==="$"}),rt,nt;if(a.indexOf("_id")!==-1&&s._id!==o._id)throw"You cannot change a document's _id";if(tt.length!==0&&tt.length!==et.length)throw"You cannot mix modifiers and normal fields";if(tt.length===0?(rt=deepCopy(s),rt._id=o._id):(nt=_$5.uniq(a),rt=deepCopy(o),nt.forEach(function(it){var st;if(!modifierFunctions[it])throw"Unknown modifier "+it;try{st=Object.keys(s[it])}catch{throw"Modifier "+it+"'s argument must be an object"}st.forEach(function(ot){modifierFunctions[it](rt,ot,s[it][ot])})})),checkObject(rt),o._id!==rt._id)throw"You can't change a document's _id";return rt}function getDotValue(o,s){var a=typeof s=="string"?s.split("."):s,et,tt;if(o){if(a.length===0)return o;if(a.length===1)return o[a[0]];if(util$9.isArray(o[a[0]])){if(et=parseInt(a[1],10),typeof et=="number"&&!isNaN(et))return getDotValue(o[a[0]][et],a.slice(2));for(tt=new Array,et=0;et<o[a[0]].length;et+=1)tt.push(getDotValue(o[a[0]][et],a.slice(1)));return tt}else return getDotValue(o[a[0]],a.slice(1))}}function areThingsEqual(o,s){var a,et,tt;if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number")return o===s;if(util$9.isDate(o)||util$9.isDate(s))return util$9.isDate(o)&&util$9.isDate(s)&&o.getTime()===s.getTime();if(util$9.isArray(o)||util$9.isArray(s)||o===void 0||s===void 0)return!1;try{a=Object.keys(o),et=Object.keys(s)}catch{return!1}if(a.length!==et.length)return!1;for(tt=0;tt<a.length;tt+=1)if(et.indexOf(a[tt])===-1||!areThingsEqual(o[a[tt]],s[a[tt]]))return!1;return!0}function areComparable(o,s){return!(typeof o!="string"&&typeof o!="number"&&!util$9.isDate(o)&&typeof s!="string"&&typeof s!="number"&&!util$9.isDate(s)||typeof o!=typeof s)}comparisonFunctions.$lt=function(o,s){return areComparable(o,s)&&o<s};comparisonFunctions.$lte=function(o,s){return areComparable(o,s)&&o<=s};comparisonFunctions.$gt=function(o,s){return areComparable(o,s)&&o>s};comparisonFunctions.$gte=function(o,s){return areComparable(o,s)&&o>=s};comparisonFunctions.$ne=function(o,s){return o===void 0?!0:!areThingsEqual(o,s)};comparisonFunctions.$in=function(o,s){var a;if(!util$9.isArray(s))throw"$in operator called with a non-array";for(a=0;a<s.length;a+=1)if(areThingsEqual(o,s[a]))return!0;return!1};comparisonFunctions.$nin=function(o,s){if(!util$9.isArray(s))throw"$nin operator called with a non-array";return!comparisonFunctions.$in(o,s)};comparisonFunctions.$regex=function(o,s){if(!util$9.isRegExp(s))throw"$regex operator called with non regular expression";return typeof o!="string"?!1:s.test(o)};comparisonFunctions.$exists=function(o,s){return s||s===""?s=!0:s=!1,o===void 0?!s:s};logicalOperators.$or=function(o,s){var a;if(!util$9.isArray(s))throw"$or operator used without an array";for(a=0;a<s.length;a+=1)if(match$1(o,s[a]))return!0;return!1};logicalOperators.$and=function(o,s){var a;if(!util$9.isArray(s))throw"$and operator used without an array";for(a=0;a<s.length;a+=1)if(!match$1(o,s[a]))return!1;return!0};logicalOperators.$not=function(o,s){return!match$1(o,s)};function match$1(o,s){var a,et,tt,rt;if(isPrimitiveType(o)||isPrimitiveType(s))return matchQueryPart({needAKey:o},"needAKey",s);for(a=Object.keys(s),rt=0;rt<a.length;rt+=1)if(et=a[rt],tt=s[et],et[0]==="$"){if(!logicalOperators[et])throw"Unknown logical operator "+et;if(!logicalOperators[et](o,tt))return!1}else if(!matchQueryPart(o,et,tt))return!1;return!0}function matchQueryPart(o,s,a,et){var tt=getDotValue(o,s),rt,nt,it,st;if(util$9.isArray(tt)&&!et){if(a!==null&&typeof a=="object"&&!util$9.isRegExp(a)){for(nt=Object.keys(a),rt=0;rt<nt.length;rt+=1)if(arrayComparisonFunctions[nt[rt]])return matchQueryPart(o,s,a,!0)}for(rt=0;rt<tt.length;rt+=1)if(matchQueryPart({k:tt[rt]},"k",a))return!0;return!1}if(a!==null&&typeof a=="object"&&!util$9.isRegExp(a)){if(nt=Object.keys(a),it=_$5.map(nt,function(ot){return ot[0]}),st=_$5.filter(it,function(ot){return ot==="$"}),st.length!==0&&st.length!==it.length)throw"You cannot mix operators and normal fields";if(st.length>0){for(rt=0;rt<nt.length;rt+=1){if(!comparisonFunctions[nt[rt]])throw"Unknown comparison function "+nt[rt];if(!comparisonFunctions[nt[rt]](tt,a[nt[rt]]))return!1}return!0}}return util$9.isRegExp(a)?comparisonFunctions.$regex(tt,a):!!areThingsEqual(tt,a)}function Document(o,et){var a=this,et;et===void 0&&(et={}),typeof et=="string"&&(et=deserialize$3(et)),Object.defineProperty(this,"save",{value:function(rt){return o.save(a,rt)},writable:!1}),Object.defineProperty(this,"remove",{value:function(rt){return a._id?o.remove({_id:a._id},{},rt):rt()},writable:!1}),Object.defineProperty(this,"update",{value:function(rt,nt){return a._id===void 0&&(a._id=o.createNewId()),o.update({_id:a._id},rt,{upsert:!0},nt)},writable:!1}),Object.defineProperty(this,"copy",{value:function(rt){return deepCopy(a,rt)},writable:!1}),Object.defineProperty(this,"serialize",{value:function(rt){return serialize$3(a)},writable:!1});for(var tt in o._methods)Object.defineProperty(this,tt,{value:o._methods[tt],writable:!1});Object.defineProperty(this,"_persist",{value:function(rt,nt){nt||o.emit("save",a),o.store.put(a._id,a.serialize(),function(it){rt(it||null,it?void 0:a)})}}),_$5.extend(this,et.constructor.modelName?deepCopy(et):et),schemas$1.construct(this,o.schema),o.emit("construct",a)}document$4.Document=Document;document$4.serialize=serialize$3;document$4.deserialize=deserialize$3;document$4.checkObject=checkObject;document$4.deepCopy=deepCopy;document$4.isPrimitiveType=isPrimitiveType;document$4.modify=modify;document$4.getDotValue=getDotValue;document$4.match=match$1;document$4.areThingsEqual=areThingsEqual;document$4.compareThings=compareThings;document$4.compoundCompareThings=compoundCompareThings;document$4.comparators=comparisonFunctions;var async$1={exports:{}};async$1.exports;(function(o,s){(function(a,et){et(s)})(commonjsGlobal,function(a){function et(qt,Jt){Jt=Jt|0;for(var nr=Math.max(qt.length-Jt,0),ir=Array(nr),ur=0;ur<nr;ur++)ir[ur]=qt[Jt+ur];return ir}var tt=function(qt){var Jt=et(arguments,1);return function(){var nr=et(arguments);return qt.apply(null,Jt.concat(nr))}},rt=function(qt){return function(){var Jt=et(arguments),nr=Jt.pop();qt.call(this,Jt,nr)}};function nt(qt){var Jt=typeof qt;return qt!=null&&(Jt=="object"||Jt=="function")}var it=typeof setImmediate=="function"&&setImmediate,st=typeof process$1=="object"&&typeof process$1.nextTick=="function";function ot(qt){setTimeout(qt,0)}function at(qt){return function(Jt){var nr=et(arguments,1);qt(function(){Jt.apply(null,nr)})}}var lt;it?lt=setImmediate:st?lt=process$1.nextTick:lt=ot;var ct=at(lt);function ht(qt){return rt(function(Jt,nr){var ir;try{ir=qt.apply(this,Jt)}catch(ur){return nr(ur)}nt(ir)&&typeof ir.then=="function"?ir.then(function(ur){ft(nr,null,ur)},function(ur){ft(nr,ur.message?ur:new Error(ur))}):nr(null,ir)})}function ft(qt,Jt,nr){try{qt(Jt,nr)}catch(ir){ct(dt,ir)}}function dt(qt){throw qt}var pt=typeof Symbol=="function";function gt(qt){return pt&&qt[Symbol.toStringTag]==="AsyncFunction"}function mt(qt){return gt(qt)?ht(qt):qt}function yt(qt){return function(Jt){var nr=et(arguments,1),ir=rt(function(ur,dr){var mr=this;return qt(Jt,function(br,Tr){mt(br).apply(mr,ur.concat(Tr))},dr)});return nr.length?ir.apply(this,nr):ir}}var vt=typeof commonjsGlobal=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,Et=typeof self=="object"&&self&&self.Object===Object&&self,xt=vt||Et||Function("return this")(),wt=xt.Symbol,Rt=Object.prototype,Ct=Rt.hasOwnProperty,Ft=Rt.toString,zt=wt?wt.toStringTag:void 0;function Nt(qt){var Jt=Ct.call(qt,zt),nr=qt[zt];try{qt[zt]=void 0;var ir=!0}catch{}var ur=Ft.call(qt);return ir&&(Jt?qt[zt]=nr:delete qt[zt]),ur}var Kt=Object.prototype,Yt=Kt.toString;function Bt(qt){return Yt.call(qt)}var Pt="[object Null]",Dt="[object Undefined]",Tt=wt?wt.toStringTag:void 0;function St(qt){return qt==null?qt===void 0?Dt:Pt:Tt&&Tt in Object(qt)?Nt(qt):Bt(qt)}var Mt="[object AsyncFunction]",jt="[object Function]",Gt="[object GeneratorFunction]",Ht="[object Proxy]";function At(qt){if(!nt(qt))return!1;var Jt=St(qt);return Jt==jt||Jt==Gt||Jt==Mt||Jt==Ht}var $t=9007199254740991;function kt(qt){return typeof qt=="number"&&qt>-1&&qt%1==0&&qt<=$t}function Lt(qt){return qt!=null&&kt(qt.length)&&!At(qt)}var bt={};function It(){}function Ut(qt){return function(){if(qt!==null){var Jt=qt;qt=null,Jt.apply(this,arguments)}}}var Wt=typeof Symbol=="function"&&Symbol.iterator,Xt=function(qt){return Wt&&qt[Wt]&&qt[Wt]()};function Qt(qt,Jt){for(var nr=-1,ir=Array(qt);++nr<qt;)ir[nr]=Jt(nr);return ir}function er(qt){return qt!=null&&typeof qt=="object"}var lr="[object Arguments]";function pr(qt){return er(qt)&&St(qt)==lr}var gr=Object.prototype,wr=gr.hasOwnProperty,cr=gr.propertyIsEnumerable,Cr=pr(function(){return arguments}())?pr:function(qt){return er(qt)&&wr.call(qt,"callee")&&!cr.call(qt,"callee")},_r=Array.isArray;function kr(){return!1}var Ir=typeof a=="object"&&a&&!a.nodeType&&a,tr=Ir&&!0&&o&&!o.nodeType&&o,sr=tr&&tr.exports===Ir,vr=sr?xt.Buffer:void 0,xr=vr?vr.isBuffer:void 0,Er=xr||kr,Sr=9007199254740991,$r=/^(?:0|[1-9]\d*)$/;function Or(qt,Jt){var nr=typeof qt;return Jt=Jt??Sr,!!Jt&&(nr=="number"||nr!="symbol"&&$r.test(qt))&&qt>-1&&qt%1==0&&qt<Jt}var Nr="[object Arguments]",Rr="[object Array]",Dr="[object Boolean]",Fr="[object Date]",Kr="[object Error]",Qr="[object Function]",Xr="[object Map]",an="[object Number]",Jn="[object Object]",$n="[object RegExp]",hn="[object Set]",Zr="[object String]",bn="[object WeakMap]",_i="[object ArrayBuffer]",tn="[object DataView]",es="[object Float32Array]",Zt="[object Float64Array]",Ot="[object Int8Array]",Vt="[object Int16Array]",rr="[object Int32Array]",ar="[object Uint8Array]",hr="[object Uint8ClampedArray]",yr="[object Uint16Array]",Br="[object Uint32Array]",Lr={};Lr[es]=Lr[Zt]=Lr[Ot]=Lr[Vt]=Lr[rr]=Lr[ar]=Lr[hr]=Lr[yr]=Lr[Br]=!0,Lr[Nr]=Lr[Rr]=Lr[_i]=Lr[Dr]=Lr[tn]=Lr[Fr]=Lr[Kr]=Lr[Qr]=Lr[Xr]=Lr[an]=Lr[Jn]=Lr[$n]=Lr[hn]=Lr[Zr]=Lr[bn]=!1;function Vr(qt){return er(qt)&&kt(qt.length)&&!!Lr[St(qt)]}function Hr(qt){return function(Jt){return qt(Jt)}}var Ur=typeof a=="object"&&a&&!a.nodeType&&a,Sn=Ur&&!0&&o&&!o.nodeType&&o,$o=Sn&&Sn.exports===Ur,ts=$o&&vt.process,xs=function(){try{var qt=Sn&&Sn.require&&Sn.require("util").types;return qt||ts&&ts.binding&&ts.binding("util")}catch{}}(),_s=xs&&xs.isTypedArray,ko=_s?Hr(_s):Vr,Po=Object.prototype,Do=Po.hasOwnProperty;function Lo(qt,Jt){var nr=_r(qt),ir=!nr&&Cr(qt),ur=!nr&&!ir&&Er(qt),dr=!nr&&!ir&&!ur&&ko(qt),mr=nr||ir||ur||dr,br=mr?Qt(qt.length,String):[],Tr=br.length;for(var Pr in qt)Do.call(qt,Pr)&&!(mr&&(Pr=="length"||ur&&(Pr=="offset"||Pr=="parent")||dr&&(Pr=="buffer"||Pr=="byteLength"||Pr=="byteOffset")||Or(Pr,Tr)))&&br.push(Pr);return br}var Mo=Object.prototype;function Oo(qt){var Jt=qt&&qt.constructor,nr=typeof Jt=="function"&&Jt.prototype||Mo;return qt===nr}function No(qt,Jt){return function(nr){return qt(Jt(nr))}}var Bo=No(Object.keys,Object),Fo=Object.prototype,Uo=Fo.hasOwnProperty;function Vo(qt){if(!Oo(qt))return Bo(qt);var Jt=[];for(var nr in Object(qt))Uo.call(qt,nr)&&nr!="constructor"&&Jt.push(nr);return Jt}function rs(qt){return Lt(qt)?Lo(qt):Vo(qt)}function jo(qt){var Jt=-1,nr=qt.length;return function(){return++Jt<nr?{value:qt[Jt],key:Jt}:null}}function Ho(qt){var Jt=-1;return function(){var ir=qt.next();return ir.done?null:(Jt++,{value:ir.value,key:Jt})}}function zo(qt){var Jt=rs(qt),nr=-1,ir=Jt.length;return function ur(){var dr=Jt[++nr];return dr==="__proto__"?ur():nr<ir?{value:qt[dr],key:dr}:null}}function Go(qt){if(Lt(qt))return jo(qt);var Jt=Xt(qt);return Jt?Ho(Jt):zo(qt)}function rn(qt){return function(){if(qt===null)throw new Error("Callback was already called.");var Jt=qt;qt=null,Jt.apply(this,arguments)}}function kn(qt){return function(Jt,nr,ir){if(ir=Ut(ir||It),qt<=0||!Jt)return ir(null);var ur=Go(Jt),dr=!1,mr=0,br=!1;function Tr(Ar,Mr){if(mr-=1,Ar)dr=!0,ir(Ar);else{if(Mr===bt||dr&&mr<=0)return dr=!0,ir(null);br||Pr()}}function Pr(){for(br=!0;mr<qt&&!dr;){var Ar=ur();if(Ar===null){dr=!0,mr<=0&&ir(null);return}mr+=1,nr(Ar.value,Ar.key,rn(Tr))}br=!1}Pr()}}function dn(qt,Jt,nr,ir){kn(Jt)(qt,mt(nr),ir)}function qr(qt,Jt){return function(nr,ir,ur){return qt(nr,Jt,ir,ur)}}function Wo(qt,Jt,nr){nr=Ut(nr||It);var ir=0,ur=0,dr=qt.length;dr===0&&nr(null);function mr(br,Tr){br?nr(br):(++ur===dr||Tr===bt)&&nr(null)}for(;ir<dr;ir++)Jt(qt[ir],ir,rn(mr))}var Ko=qr(dn,1/0),cn=function(qt,Jt,nr){var ir=Lt(qt)?Wo:Ko;ir(qt,mt(Jt),nr)};function fn(qt){return function(Jt,nr,ir){return qt(cn,Jt,mt(nr),ir)}}function Ts(qt,Jt,nr,ir){ir=ir||It,Jt=Jt||[];var ur=[],dr=0,mr=mt(nr);qt(Jt,function(br,Tr,Pr){var Ar=dr++;mr(br,function(Mr,jr){ur[Ar]=jr,Pr(Mr)})},function(br){ir(br,ur)})}var Pn=fn(Ts),As=yt(Pn);function pn(qt){return function(Jt,nr,ir,ur){return qt(kn(nr),Jt,mt(ir),ur)}}var gn=pn(Ts),ns=qr(gn,1),Cs=yt(ns);function Dn(qt,Jt){for(var nr=-1,ir=qt==null?0:qt.length;++nr<ir&&Jt(qt[nr],nr,qt)!==!1;);return qt}function qo(qt){return function(Jt,nr,ir){for(var ur=-1,dr=Object(Jt),mr=ir(Jt),br=mr.length;br--;){var Tr=mr[++ur];if(nr(dr[Tr],Tr,dr)===!1)break}return Jt}}var Yo=qo();function wn(qt,Jt){return qt&&Yo(qt,Jt,rs)}function Xo(qt,Jt,nr,ir){for(var ur=qt.length,dr=nr+-1;++dr<ur;)if(Jt(qt[dr],dr,qt))return dr;return-1}function Qo(qt){return qt!==qt}function Zo(qt,Jt,nr){for(var ir=nr-1,ur=qt.length;++ir<ur;)if(qt[ir]===Jt)return ir;return-1}function Ln(qt,Jt,nr){return Jt===Jt?Zo(qt,Jt,nr):Xo(qt,Qo,nr)}var ss=function(qt,Jt,nr){typeof Jt=="function"&&(nr=Jt,Jt=null),nr=Ut(nr||It);var ir=rs(qt),ur=ir.length;if(!ur)return nr(null);Jt||(Jt=ur);var dr={},mr=0,br=!1,Tr=Object.create(null),Pr=[],Ar=[],Mr={};wn(qt,function(zr,Gr){if(!_r(zr)){jr(Gr,[zr]),Ar.push(Gr);return}var Wr=zr.slice(0,zr.length-1),ln=Wr.length;if(ln===0){jr(Gr,zr),Ar.push(Gr);return}Mr[Gr]=ln,Dn(Wr,function(En){if(!qt[En])throw new Error("async.auto task `"+Gr+"` has a non-existent dependency `"+En+"` in "+Wr.join(", "));nn(En,function(){ln--,ln===0&&jr(Gr,zr)})})}),au(),Yr();function jr(zr,Gr){Pr.push(function(){sn(zr,Gr)})}function Yr(){if(Pr.length===0&&mr===0)return nr(null,dr);for(;Pr.length&&mr<Jt;){var zr=Pr.shift();zr()}}function nn(zr,Gr){var Wr=Tr[zr];Wr||(Wr=Tr[zr]=[]),Wr.push(Gr)}function Jr(zr){var Gr=Tr[zr]||[];Dn(Gr,function(Wr){Wr()}),Yr()}function sn(zr,Gr){if(!br){var Wr=rn(function(En,Es){if(mr--,arguments.length>2&&(Es=et(arguments,1)),En){var bs={};wn(dr,function(cu,uu){bs[uu]=cu}),bs[zr]=Es,br=!0,Tr=Object.create(null),nr(En,bs)}else dr[zr]=Es,Jr(zr)});mr++;var ln=mt(Gr[Gr.length-1]);Gr.length>1?ln(dr,Wr):ln(Wr)}}function au(){for(var zr,Gr=0;Ar.length;)zr=Ar.pop(),Gr++,Dn(lu(zr),function(Wr){--Mr[Wr]===0&&Ar.push(Wr)});if(Gr!==ur)throw new Error("async.auto cannot execute tasks due to a recursive dependency")}function lu(zr){var Gr=[];return wn(qt,function(Wr,ln){_r(Wr)&&Ln(Wr,zr,0)>=0&&Gr.push(ln)}),Gr}};function mn(qt,Jt){for(var nr=-1,ir=qt==null?0:qt.length,ur=Array(ir);++nr<ir;)ur[nr]=Jt(qt[nr],nr,qt);return ur}var Jo="[object Symbol]";function na(qt){return typeof qt=="symbol"||er(qt)&&St(qt)==Jo}var ga=1/0,Rs=wt?wt.prototype:void 0,Is=Rs?Rs.toString:void 0;function os(qt){if(typeof qt=="string")return qt;if(_r(qt))return mn(qt,os)+"";if(na(qt))return Is?Is.call(qt):"";var Jt=qt+"";return Jt=="0"&&1/qt==-ga?"-0":Jt}function ba(qt,Jt,nr){var ir=-1,ur=qt.length;Jt<0&&(Jt=-Jt>ur?0:ur+Jt),nr=nr>ur?ur:nr,nr<0&&(nr+=ur),ur=Jt>nr?0:nr-Jt>>>0,Jt>>>=0;for(var dr=Array(ur);++ir<ur;)dr[ir]=qt[ir+Jt];return dr}function xa(qt,Jt,nr){var ir=qt.length;return nr=nr===void 0?ir:nr,!Jt&&nr>=ir?qt:ba(qt,Jt,nr)}function $a(qt,Jt){for(var nr=qt.length;nr--&&Ln(Jt,qt[nr],0)>-1;);return nr}function yl(qt,Jt){for(var nr=-1,ir=qt.length;++nr<ir&&Ln(Jt,qt[nr],0)>-1;);return nr}function El(qt){return qt.split("")}var Sl="\\ud800-\\udfff",wl="\\u0300-\\u036f",xl="\\ufe20-\\ufe2f",_l="\\u20d0-\\u20ff",Tl=wl+xl+_l,Al="\\ufe0e\\ufe0f",Cl="\\u200d",Rl=RegExp("["+Cl+Sl+Tl+Al+"]");function Il(qt){return Rl.test(qt)}var $s="\\ud800-\\udfff",$l="\\u0300-\\u036f",Pl="\\ufe20-\\ufe2f",Dl="\\u20d0-\\u20ff",Ll=$l+Pl+Dl,Ml="\\ufe0e\\ufe0f",Ol="["+$s+"]",as="["+Ll+"]",cs="\\ud83c[\\udffb-\\udfff]",Nl="(?:"+as+"|"+cs+")",ks="[^"+$s+"]",Ps="(?:\\ud83c[\\udde6-\\uddff]){2}",Ds="[\\ud800-\\udbff][\\udc00-\\udfff]",Fl="\\u200d",Ls=Nl+"?",Ms="["+Ml+"]?",Ul="(?:"+Fl+"(?:"+[ks,Ps,Ds].join("|")+")"+Ms+Ls+")*",Vl=Ms+Ls+Ul,Hl="(?:"+[ks+as+"?",as,Ps,Ds,Ol].join("|")+")",zl=RegExp(cs+"(?="+cs+")|"+Hl+Vl,"g");function Gl(qt){return qt.match(zl)||[]}function Os(qt){return Il(qt)?Gl(qt):El(qt)}function Wl(qt){return qt==null?"":os(qt)}var Kl=/^\s+|\s+$/g;function Yl(qt,Jt,nr){if(qt=Wl(qt),qt&&Jt===void 0)return qt.replace(Kl,"");if(!qt||!(Jt=os(Jt)))return qt;var ir=Os(qt),ur=Os(Jt),dr=yl(ir,ur),mr=$a(ir,ur)+1;return xa(ir,dr,mr).join("")}var Xl=/^(?:async\s+)?(function)?\s*[^\(]*\(\s*([^\)]*)\)/m,Ql=/,/,Zl=/(=.+)?(\s*)$/,Jl=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg;function _c(qt){return qt=qt.toString().replace(Jl,""),qt=qt.match(Xl)[2].replace(" ",""),qt=qt?qt.split(Ql):[],qt=qt.map(function(Jt){return Yl(Jt.replace(Zl,""))}),qt}function Ns(qt,Jt){var nr={};wn(qt,function(ir,ur){var dr,mr=gt(ir),br=!mr&&ir.length===1||mr&&ir.length===0;if(_r(ir))dr=ir.slice(0,-1),ir=ir[ir.length-1],nr[ur]=dr.concat(dr.length>0?Tr:ir);else if(br)nr[ur]=ir;else{if(dr=_c(ir),ir.length===0&&!mr&&dr.length===0)throw new Error("autoInject task functions require explicit parameters.");mr||dr.pop(),nr[ur]=dr.concat(Tr)}function Tr(Pr,Ar){var Mr=mn(dr,function(jr){return Pr[jr]});Mr.push(Ar),mt(ir).apply(null,Mr)}}),ss(nr,Jt)}function en(){this.head=this.tail=null,this.length=0}function Bs(qt,Jt){qt.length=1,qt.head=qt.tail=Jt}en.prototype.removeLink=function(qt){return qt.prev?qt.prev.next=qt.next:this.head=qt.next,qt.next?qt.next.prev=qt.prev:this.tail=qt.prev,qt.prev=qt.next=null,this.length-=1,qt},en.prototype.empty=function(){for(;this.head;)this.shift();return this},en.prototype.insertAfter=function(qt,Jt){Jt.prev=qt,Jt.next=qt.next,qt.next?qt.next.prev=Jt:this.tail=Jt,qt.next=Jt,this.length+=1},en.prototype.insertBefore=function(qt,Jt){Jt.prev=qt.prev,Jt.next=qt,qt.prev?qt.prev.next=Jt:this.head=Jt,qt.prev=Jt,this.length+=1},en.prototype.unshift=function(qt){this.head?this.insertBefore(this.head,qt):Bs(this,qt)},en.prototype.push=function(qt){this.tail?this.insertAfter(this.tail,qt):Bs(this,qt)},en.prototype.shift=function(){return this.head&&this.removeLink(this.head)},en.prototype.pop=function(){return this.tail&&this.removeLink(this.tail)},en.prototype.toArray=function(){for(var qt=Array(this.length),Jt=this.head,nr=0;nr<this.length;nr++)qt[nr]=Jt.data,Jt=Jt.next;return qt},en.prototype.remove=function(qt){for(var Jt=this.head;Jt;){var nr=Jt.next;qt(Jt)&&this.removeLink(Jt),Jt=nr}return this};function Fs(qt,Jt,nr){if(Jt==null)Jt=1;else if(Jt===0)throw new Error("Concurrency must not be zero");var ir=mt(qt),ur=0,dr=[],mr=!1;function br(Mr,jr,Yr){if(Yr!=null&&typeof Yr!="function")throw new Error("task callback must be a function");if(Ar.started=!0,_r(Mr)||(Mr=[Mr]),Mr.length===0&&Ar.idle())return ct(function(){Ar.drain()});for(var nn=0,Jr=Mr.length;nn<Jr;nn++){var sn={data:Mr[nn],callback:Yr||It};jr?Ar._tasks.unshift(sn):Ar._tasks.push(sn)}mr||(mr=!0,ct(function(){mr=!1,Ar.process()}))}function Tr(Mr){return function(jr){ur-=1;for(var Yr=0,nn=Mr.length;Yr<nn;Yr++){var Jr=Mr[Yr],sn=Ln(dr,Jr,0);sn===0?dr.shift():sn>0&&dr.splice(sn,1),Jr.callback.apply(Jr,arguments),jr!=null&&Ar.error(jr,Jr.data)}ur<=Ar.concurrency-Ar.buffer&&Ar.unsaturated(),Ar.idle()&&Ar.drain(),Ar.process()}}var Pr=!1,Ar={_tasks:new en,concurrency:Jt,payload:nr,saturated:It,unsaturated:It,buffer:Jt/4,empty:It,drain:It,error:It,started:!1,paused:!1,push:function(Mr,jr){br(Mr,!1,jr)},kill:function(){Ar.drain=It,Ar._tasks.empty()},unshift:function(Mr,jr){br(Mr,!0,jr)},remove:function(Mr){Ar._tasks.remove(Mr)},process:function(){if(!Pr){for(Pr=!0;!Ar.paused&&ur<Ar.concurrency&&Ar._tasks.length;){var Mr=[],jr=[],Yr=Ar._tasks.length;Ar.payload&&(Yr=Math.min(Yr,Ar.payload));for(var nn=0;nn<Yr;nn++){var Jr=Ar._tasks.shift();Mr.push(Jr),dr.push(Jr),jr.push(Jr.data)}ur+=1,Ar._tasks.length===0&&Ar.empty(),ur===Ar.concurrency&&Ar.saturated();var sn=rn(Tr(Mr));ir(jr,sn)}Pr=!1}},length:function(){return Ar._tasks.length},running:function(){return ur},workersList:function(){return dr},idle:function(){return Ar._tasks.length+ur===0},pause:function(){Ar.paused=!0},resume:function(){Ar.paused!==!1&&(Ar.paused=!1,ct(Ar.process))}};return Ar}function Us(qt,Jt){return Fs(qt,1,Jt)}var yn=qr(dn,1);function un(qt,Jt,nr,ir){ir=Ut(ir||It);var ur=mt(nr);yn(qt,function(dr,mr,br){ur(Jt,dr,function(Tr,Pr){Jt=Pr,br(Tr)})},function(dr){ir(dr,Jt)})}function us(){var qt=mn(arguments,mt);return function(){var Jt=et(arguments),nr=this,ir=Jt[Jt.length-1];typeof ir=="function"?Jt.pop():ir=It,un(qt,Jt,function(ur,dr,mr){dr.apply(nr,ur.concat(function(br){var Tr=et(arguments,1);mr(br,Tr)}))},function(ur,dr){ir.apply(nr,[ur].concat(dr))})}}var Vs=function(){return us.apply(null,et(arguments).reverse())},eu=Array.prototype.concat,Mn=function(qt,Jt,nr,ir){ir=ir||It;var ur=mt(nr);gn(qt,Jt,function(dr,mr){ur(dr,function(br){return br?mr(br):mr(null,et(arguments,1))})},function(dr,mr){for(var br=[],Tr=0;Tr<mr.length;Tr++)mr[Tr]&&(br=eu.apply(br,mr[Tr]));return ir(dr,br)})},js=qr(Mn,1/0),Hs=qr(Mn,1),zs=function(){var qt=et(arguments),Jt=[null].concat(qt);return function(){var nr=arguments[arguments.length-1];return nr.apply(this,Jt)}};function xn(qt){return qt}function vn(qt,Jt){return function(nr,ir,ur,dr){dr=dr||It;var mr=!1,br;nr(ir,function(Tr,Pr,Ar){ur(Tr,function(Mr,jr){Mr?Ar(Mr):qt(jr)&&!br?(mr=!0,br=Jt(!0,Tr),Ar(null,bt)):Ar()})},function(Tr){Tr?dr(Tr):dr(null,mr?br:Jt(!1))})}}function Gs(qt,Jt){return Jt}var On=fn(vn(xn,Gs)),_n=pn(vn(xn,Gs)),Nn=qr(_n,1);function Ws(qt){return function(Jt){var nr=et(arguments,1);nr.push(function(ir){var ur=et(arguments,1);typeof console=="object"&&(ir?console.error&&console.error(ir):console[qt]&&Dn(ur,function(dr){console[qt](dr)}))}),mt(Jt).apply(null,nr)}}var Ks=Ws("dir");function qs(qt,Jt,nr){nr=rn(nr||It);var ir=mt(qt),ur=mt(Jt);function dr(br){if(br)return nr(br);var Tr=et(arguments,1);Tr.push(mr),ur.apply(this,Tr)}function mr(br,Tr){if(br)return nr(br);if(!Tr)return nr(null);ir(dr)}mr(null,!0)}function ds(qt,Jt,nr){nr=rn(nr||It);var ir=mt(qt),ur=function(dr){if(dr)return nr(dr);var mr=et(arguments,1);if(Jt.apply(this,mr))return ir(ur);nr.apply(null,[null].concat(mr))};ir(ur)}function Ys(qt,Jt,nr){ds(qt,function(){return!Jt.apply(this,arguments)},nr)}function Xs(qt,Jt,nr){nr=rn(nr||It);var ir=mt(Jt),ur=mt(qt);function dr(br){if(br)return nr(br);ur(mr)}function mr(br,Tr){if(br)return nr(br);if(!Tr)return nr(null);ir(dr)}ur(mr)}function Qs(qt){return function(Jt,nr,ir){return qt(Jt,ir)}}function Bn(qt,Jt,nr){cn(qt,Qs(mt(Jt)),nr)}function Tn(qt,Jt,nr,ir){kn(Jt)(qt,Qs(mt(nr)),ir)}var An=qr(Tn,1);function hs(qt){return gt(qt)?qt:rt(function(Jt,nr){var ir=!0;Jt.push(function(){var ur=arguments;ir?ct(function(){nr.apply(null,ur)}):nr.apply(null,ur)}),qt.apply(this,Jt),ir=!1})}function Fn(qt){return!qt}var Un=fn(vn(Fn,Fn)),Cn=pn(vn(Fn,Fn)),Vn=qr(Cn,1);function Zs(qt){return function(Jt){return Jt?.[qt]}}function tu(qt,Jt,nr,ir){var ur=new Array(Jt.length);qt(Jt,function(dr,mr,br){nr(dr,function(Tr,Pr){ur[mr]=!!Pr,br(Tr)})},function(dr){if(dr)return ir(dr);for(var mr=[],br=0;br<Jt.length;br++)ur[br]&&mr.push(Jt[br]);ir(null,mr)})}function ru(qt,Jt,nr,ir){var ur=[];qt(Jt,function(dr,mr,br){nr(dr,function(Tr,Pr){Tr?br(Tr):(Pr&&ur.push({index:mr,value:dr}),br())})},function(dr){dr?ir(dr):ir(null,mn(ur.sort(function(mr,br){return mr.index-br.index}),Zs("value")))})}function fs(qt,Jt,nr,ir){var ur=Lt(Jt)?tu:ru;ur(qt,Jt,mt(nr),ir||It)}var jn=fn(fs),Rn=pn(fs),Hn=qr(Rn,1);function Js(qt,Jt){var nr=rn(Jt||It),ir=mt(hs(qt));function ur(dr){if(dr)return nr(dr);ir(ur)}ur()}var zn=function(qt,Jt,nr,ir){ir=ir||It;var ur=mt(nr);gn(qt,Jt,function(dr,mr){ur(dr,function(br,Tr){return br?mr(br):mr(null,{key:Tr,val:dr})})},function(dr,mr){for(var br={},Tr=Object.prototype.hasOwnProperty,Pr=0;Pr<mr.length;Pr++)if(mr[Pr]){var Ar=mr[Pr].key,Mr=mr[Pr].val;Tr.call(br,Ar)?br[Ar].push(Mr):br[Ar]=[Mr]}return ir(dr,br)})},eo=qr(zn,1/0),to=qr(zn,1),ro=Ws("log");function Gn(qt,Jt,nr,ir){ir=Ut(ir||It);var ur={},dr=mt(nr);dn(qt,Jt,function(mr,br,Tr){dr(mr,br,function(Pr,Ar){if(Pr)return Tr(Pr);ur[br]=Ar,Tr()})},function(mr){ir(mr,ur)})}var no=qr(Gn,1/0),io=qr(Gn,1);function so(qt,Jt){return Jt in qt}function oo(qt,Jt){var nr=Object.create(null),ir=Object.create(null);Jt=Jt||xn;var ur=mt(qt),dr=rt(function(br,Tr){var Pr=Jt.apply(null,br);so(nr,Pr)?ct(function(){Tr.apply(null,nr[Pr])}):so(ir,Pr)?ir[Pr].push(Tr):(ir[Pr]=[Tr],ur.apply(null,br.concat(function(){var Ar=et(arguments);nr[Pr]=Ar;var Mr=ir[Pr];delete ir[Pr];for(var jr=0,Yr=Mr.length;jr<Yr;jr++)Mr[jr].apply(null,Ar)})))});return dr.memo=nr,dr.unmemoized=qt,dr}var Wn;st?Wn=process$1.nextTick:it?Wn=setImmediate:Wn=ot;var ao=at(Wn);function ps(qt,Jt,nr){nr=nr||It;var ir=Lt(Jt)?[]:{};qt(Jt,function(ur,dr,mr){mt(ur)(function(br,Tr){arguments.length>2&&(Tr=et(arguments,1)),ir[dr]=Tr,mr(br)})},function(ur){nr(ur,ir)})}function lo(qt,Jt){ps(cn,qt,Jt)}function co(qt,Jt,nr){ps(kn(Jt),qt,nr)}var gs=function(qt,Jt){var nr=mt(qt);return Fs(function(ir,ur){nr(ir[0],ur)},Jt,1)},uo=function(qt,Jt){var nr=gs(qt,Jt);return nr.push=function(ir,ur,dr){if(dr==null&&(dr=It),typeof dr!="function")throw new Error("task callback must be a function");if(nr.started=!0,_r(ir)||(ir=[ir]),ir.length===0)return ct(function(){nr.drain()});ur=ur||0;for(var mr=nr._tasks.head;mr&&ur>=mr.priority;)mr=mr.next;for(var br=0,Tr=ir.length;br<Tr;br++){var Pr={data:ir[br],priority:ur,callback:dr};mr?nr._tasks.insertBefore(mr,Pr):nr._tasks.push(Pr)}ct(nr.process)},delete nr.unshift,nr};function ho(qt,Jt){if(Jt=Ut(Jt||It),!_r(qt))return Jt(new TypeError("First argument to race must be an array of functions"));if(!qt.length)return Jt();for(var nr=0,ir=qt.length;nr<ir;nr++)mt(qt[nr])(Jt)}function Kn(qt,Jt,nr,ir){var ur=et(qt).reverse();un(ur,Jt,nr,ir)}function qn(qt){var Jt=mt(qt);return rt(function(ir,ur){return ir.push(function(mr,br){if(mr)ur(null,{error:mr});else{var Tr;arguments.length<=2?Tr=br:Tr=et(arguments,1),ur(null,{value:Tr})}}),Jt.apply(this,ir)})}function fo(qt){var Jt;return _r(qt)?Jt=mn(qt,qn):(Jt={},wn(qt,function(nr,ir){Jt[ir]=qn.call(this,nr)})),Jt}function po(qt,Jt,nr,ir){fs(qt,Jt,function(ur,dr){nr(ur,function(mr,br){dr(mr,!br)})},ir)}var go=fn(po),ys=pn(po),mo=qr(ys,1);function yo(qt){return function(){return qt}}function Yn(qt,Jt,nr){var ir=5,ur=0,dr={times:ir,intervalFunc:yo(ur)};function mr(Ar,Mr){if(typeof Mr=="object")Ar.times=+Mr.times||ir,Ar.intervalFunc=typeof Mr.interval=="function"?Mr.interval:yo(+Mr.interval||ur),Ar.errorFilter=Mr.errorFilter;else if(typeof Mr=="number"||typeof Mr=="string")Ar.times=+Mr||ir;else throw new Error("Invalid arguments for async.retry")}if(arguments.length<3&&typeof qt=="function"?(nr=Jt||It,Jt=qt):(mr(dr,qt),nr=nr||It),typeof Jt!="function")throw new Error("Invalid arguments for async.retry");var br=mt(Jt),Tr=1;function Pr(){br(function(Ar){Ar&&Tr++<dr.times&&(typeof dr.errorFilter!="function"||dr.errorFilter(Ar))?setTimeout(Pr,dr.intervalFunc(Tr)):nr.apply(null,arguments)})}Pr()}var vo=function(qt,Jt){Jt||(Jt=qt,qt=null);var nr=mt(Jt);return rt(function(ir,ur){function dr(mr){nr.apply(null,ir.concat(mr))}qt?Yn(qt,dr,ur):Yn(dr,ur)})};function Eo(qt,Jt){ps(yn,qt,Jt)}var Xn=fn(vn(Boolean,xn)),In=pn(vn(Boolean,xn)),Qn=qr(In,1);function bo(qt,Jt,nr){var ir=mt(Jt);Pn(qt,function(dr,mr){ir(dr,function(br,Tr){if(br)return mr(br);mr(null,{value:dr,criteria:Tr})})},function(dr,mr){if(dr)return nr(dr);nr(null,mn(mr.sort(ur),Zs("value")))});function ur(dr,mr){var br=dr.criteria,Tr=mr.criteria;return br<Tr?-1:br>Tr?1:0}}function So(qt,Jt,nr){var ir=mt(qt);return rt(function(ur,dr){var mr=!1,br;function Tr(){var Pr=qt.name||"anonymous",Ar=new Error('Callback function "'+Pr+'" timed out.');Ar.code="ETIMEDOUT",nr&&(Ar.info=nr),mr=!0,dr(Ar)}ur.push(function(){mr||(dr.apply(null,arguments),clearTimeout(br))}),br=setTimeout(Tr,Jt),ir.apply(null,ur)})}var nu=Math.ceil,iu=Math.max;function su(qt,Jt,nr,ir){for(var ur=-1,dr=iu(nu((Jt-qt)/nr),0),mr=Array(dr);dr--;)mr[++ur]=qt,qt+=nr;return mr}function Zn(qt,Jt,nr,ir){var ur=mt(nr);gn(su(0,qt,1),Jt,ur,ir)}var wo=qr(Zn,1/0),xo=qr(Zn,1);function _o(qt,Jt,nr,ir){arguments.length<=3&&(ir=nr,nr=Jt,Jt=_r(qt)?[]:{}),ir=Ut(ir||It);var ur=mt(nr);cn(qt,function(dr,mr,br){ur(Jt,dr,mr,br)},function(dr){ir(dr,Jt)})}function To(qt,Jt){var nr=null,ir;Jt=Jt||It,An(qt,function(ur,dr){mt(ur)(function(mr,br){arguments.length>2?ir=et(arguments,1):ir=br,nr=mr,dr(!mr)})},function(){Jt(nr,ir)})}function Ao(qt){return function(){return(qt.unmemoized||qt).apply(null,arguments)}}function vs(qt,Jt,nr){nr=rn(nr||It);var ir=mt(Jt);if(!qt())return nr(null);var ur=function(dr){if(dr)return nr(dr);if(qt())return ir(ur);var mr=et(arguments,1);nr.apply(null,[null].concat(mr))};ir(ur)}function Co(qt,Jt,nr){vs(function(){return!qt.apply(this,arguments)},Jt,nr)}var Ro=function(qt,Jt){if(Jt=Ut(Jt||It),!_r(qt))return Jt(new Error("First argument to waterfall must be an array of functions"));if(!qt.length)return Jt();var nr=0;function ir(dr){var mr=mt(qt[nr++]);dr.push(rn(ur)),mr.apply(null,dr)}function ur(dr){if(dr||nr===qt.length)return Jt.apply(null,arguments);ir(et(arguments,1))}ir([])},ou={apply:tt,applyEach:As,applyEachSeries:Cs,asyncify:ht,auto:ss,autoInject:Ns,cargo:Us,compose:Vs,concat:js,concatLimit:Mn,concatSeries:Hs,constant:zs,detect:On,detectLimit:_n,detectSeries:Nn,dir:Ks,doDuring:qs,doUntil:Ys,doWhilst:ds,during:Xs,each:Bn,eachLimit:Tn,eachOf:cn,eachOfLimit:dn,eachOfSeries:yn,eachSeries:An,ensureAsync:hs,every:Un,everyLimit:Cn,everySeries:Vn,filter:jn,filterLimit:Rn,filterSeries:Hn,forever:Js,groupBy:eo,groupByLimit:zn,groupBySeries:to,log:ro,map:Pn,mapLimit:gn,mapSeries:ns,mapValues:no,mapValuesLimit:Gn,mapValuesSeries:io,memoize:oo,nextTick:ao,parallel:lo,parallelLimit:co,priorityQueue:uo,queue:gs,race:ho,reduce:un,reduceRight:Kn,reflect:qn,reflectAll:fo,reject:go,rejectLimit:ys,rejectSeries:mo,retry:Yn,retryable:vo,seq:us,series:Eo,setImmediate:ct,some:Xn,someLimit:In,someSeries:Qn,sortBy:bo,timeout:So,times:wo,timesLimit:Zn,timesSeries:xo,transform:_o,tryEach:To,unmemoize:Ao,until:Co,waterfall:Ro,whilst:vs,all:Un,allLimit:Cn,allSeries:Vn,any:Xn,anyLimit:In,anySeries:Qn,find:On,findLimit:_n,findSeries:Nn,forEach:Bn,forEachSeries:An,forEachLimit:Tn,forEachOf:cn,forEachOfSeries:yn,forEachOfLimit:dn,inject:un,foldl:un,foldr:Kn,select:jn,selectLimit:Rn,selectSeries:Hn,wrapSync:ht};a.default=ou,a.apply=tt,a.applyEach=As,a.applyEachSeries=Cs,a.asyncify=ht,a.auto=ss,a.autoInject=Ns,a.cargo=Us,a.compose=Vs,a.concat=js,a.concatLimit=Mn,a.concatSeries=Hs,a.constant=zs,a.detect=On,a.detectLimit=_n,a.detectSeries=Nn,a.dir=Ks,a.doDuring=qs,a.doUntil=Ys,a.doWhilst=ds,a.during=Xs,a.each=Bn,a.eachLimit=Tn,a.eachOf=cn,a.eachOfLimit=dn,a.eachOfSeries=yn,a.eachSeries=An,a.ensureAsync=hs,a.every=Un,a.everyLimit=Cn,a.everySeries=Vn,a.filter=jn,a.filterLimit=Rn,a.filterSeries=Hn,a.forever=Js,a.groupBy=eo,a.groupByLimit=zn,a.groupBySeries=to,a.log=ro,a.map=Pn,a.mapLimit=gn,a.mapSeries=ns,a.mapValues=no,a.mapValuesLimit=Gn,a.mapValuesSeries=io,a.memoize=oo,a.nextTick=ao,a.parallel=lo,a.parallelLimit=co,a.priorityQueue=uo,a.queue=gs,a.race=ho,a.reduce=un,a.reduceRight=Kn,a.reflect=qn,a.reflectAll=fo,a.reject=go,a.rejectLimit=ys,a.rejectSeries=mo,a.retry=Yn,a.retryable=vo,a.seq=us,a.series=Eo,a.setImmediate=ct,a.some=Xn,a.someLimit=In,a.someSeries=Qn,a.sortBy=bo,a.timeout=So,a.times=wo,a.timesLimit=Zn,a.timesSeries=xo,a.transform=_o,a.tryEach=To,a.unmemoize=Ao,a.until=Co,a.waterfall=Ro,a.whilst=vs,a.all=Un,a.allLimit=Cn,a.allSeries=Vn,a.any=Xn,a.anyLimit=In,a.anySeries=Qn,a.find=On,a.findLimit=_n,a.findSeries=Nn,a.forEach=Bn,a.forEachSeries=An,a.forEachLimit=Tn,a.forEachOf=cn,a.forEachOfSeries=yn,a.forEachOfLimit=dn,a.inject=un,a.foldl=un,a.foldr=Kn,a.select=jn,a.selectLimit=Rn,a.selectSeries=Hn,a.wrapSync=ht,Object.defineProperty(a,"__esModule",{value:!0})})})(async$1,async$1.exports);var asyncExports=async$1.exports,events$4={exports:{}},R=typeof Reflect=="object"?Reflect:null,ReflectApply=R&&typeof R.apply=="function"?R.apply:function(s,a,et){return Function.prototype.apply.call(s,a,et)},ReflectOwnKeys;R&&typeof R.ownKeys=="function"?ReflectOwnKeys=R.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys=function(s){return Object.getOwnPropertyNames(s).concat(Object.getOwnPropertySymbols(s))}:ReflectOwnKeys=function(s){return Object.getOwnPropertyNames(s)};function ProcessEmitWarning(o){console&&console.warn&&console.warn(o)}var NumberIsNaN=Number.isNaN||function(s){return s!==s};function EventEmitter$3(){EventEmitter$3.init.call(this)}events$4.exports=EventEmitter$3;events$4.exports.once=once$1;EventEmitter$3.EventEmitter=EventEmitter$3;EventEmitter$3.prototype._events=void 0;EventEmitter$3.prototype._eventsCount=0;EventEmitter$3.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(o){if(typeof o!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof o)}Object.defineProperty(EventEmitter$3,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(o){if(typeof o!="number"||o<0||NumberIsNaN(o))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+o+".");defaultMaxListeners=o}});EventEmitter$3.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter$3.prototype.setMaxListeners=function(s){if(typeof s!="number"||s<0||NumberIsNaN(s))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+s+".");return this._maxListeners=s,this};function _getMaxListeners(o){return o._maxListeners===void 0?EventEmitter$3.defaultMaxListeners:o._maxListeners}EventEmitter$3.prototype.getMaxListeners=function(){return _getMaxListeners(this)};EventEmitter$3.prototype.emit=function(s){for(var a=[],et=1;et<arguments.length;et++)a.push(arguments[et]);var tt=s==="error",rt=this._events;if(rt!==void 0)tt=tt&&rt.error===void 0;else if(!tt)return!1;if(tt){var nt;if(a.length>0&&(nt=a[0]),nt instanceof Error)throw nt;var it=new Error("Unhandled error."+(nt?" ("+nt.message+")":""));throw it.context=nt,it}var st=rt[s];if(st===void 0)return!1;if(typeof st=="function")ReflectApply(st,this,a);else for(var ot=st.length,at=arrayClone(st,ot),et=0;et<ot;++et)ReflectApply(at[et],this,a);return!0};function _addListener(o,s,a,et){var tt,rt,nt;if(checkListener(a),rt=o._events,rt===void 0?(rt=o._events=Object.create(null),o._eventsCount=0):(rt.newListener!==void 0&&(o.emit("newListener",s,a.listener?a.listener:a),rt=o._events),nt=rt[s]),nt===void 0)nt=rt[s]=a,++o._eventsCount;else if(typeof nt=="function"?nt=rt[s]=et?[a,nt]:[nt,a]:et?nt.unshift(a):nt.push(a),tt=_getMaxListeners(o),tt>0&&nt.length>tt&&!nt.warned){nt.warned=!0;var it=new Error("Possible EventEmitter memory leak detected. "+nt.length+" "+String(s)+" listeners added. Use emitter.setMaxListeners() to increase limit");it.name="MaxListenersExceededWarning",it.emitter=o,it.type=s,it.count=nt.length,ProcessEmitWarning(it)}return o}EventEmitter$3.prototype.addListener=function(s,a){return _addListener(this,s,a,!1)};EventEmitter$3.prototype.on=EventEmitter$3.prototype.addListener;EventEmitter$3.prototype.prependListener=function(s,a){return _addListener(this,s,a,!0)};function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(o,s,a){var et={fired:!1,wrapFn:void 0,target:o,type:s,listener:a},tt=onceWrapper.bind(et);return tt.listener=a,et.wrapFn=tt,tt}EventEmitter$3.prototype.once=function(s,a){return checkListener(a),this.on(s,_onceWrap(this,s,a)),this};EventEmitter$3.prototype.prependOnceListener=function(s,a){return checkListener(a),this.prependListener(s,_onceWrap(this,s,a)),this};EventEmitter$3.prototype.removeListener=function(s,a){var et,tt,rt,nt,it;if(checkListener(a),tt=this._events,tt===void 0)return this;if(et=tt[s],et===void 0)return this;if(et===a||et.listener===a)--this._eventsCount===0?this._events=Object.create(null):(delete tt[s],tt.removeListener&&this.emit("removeListener",s,et.listener||a));else if(typeof et!="function"){for(rt=-1,nt=et.length-1;nt>=0;nt--)if(et[nt]===a||et[nt].listener===a){it=et[nt].listener,rt=nt;break}if(rt<0)return this;rt===0?et.shift():spliceOne(et,rt),et.length===1&&(tt[s]=et[0]),tt.removeListener!==void 0&&this.emit("removeListener",s,it||a)}return this};EventEmitter$3.prototype.off=EventEmitter$3.prototype.removeListener;EventEmitter$3.prototype.removeAllListeners=function(s){var a,et,tt;if(et=this._events,et===void 0)return this;if(et.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):et[s]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete et[s]),this;if(arguments.length===0){var rt=Object.keys(et),nt;for(tt=0;tt<rt.length;++tt)nt=rt[tt],nt!=="removeListener"&&this.removeAllListeners(nt);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(a=et[s],typeof a=="function")this.removeListener(s,a);else if(a!==void 0)for(tt=a.length-1;tt>=0;tt--)this.removeListener(s,a[tt]);return this};function _listeners(o,s,a){var et=o._events;if(et===void 0)return[];var tt=et[s];return tt===void 0?[]:typeof tt=="function"?a?[tt.listener||tt]:[tt]:a?unwrapListeners(tt):arrayClone(tt,tt.length)}EventEmitter$3.prototype.listeners=function(s){return _listeners(this,s,!0)};EventEmitter$3.prototype.rawListeners=function(s){return _listeners(this,s,!1)};EventEmitter$3.listenerCount=function(o,s){return typeof o.listenerCount=="function"?o.listenerCount(s):listenerCount.call(o,s)};EventEmitter$3.prototype.listenerCount=listenerCount;function listenerCount(o){var s=this._events;if(s!==void 0){var a=s[o];if(typeof a=="function")return 1;if(a!==void 0)return a.length}return 0}EventEmitter$3.prototype.eventNames=function(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(o,s){for(var a=new Array(s),et=0;et<s;++et)a[et]=o[et];return a}function spliceOne(o,s){for(;s+1<o.length;s++)o[s]=o[s+1];o.pop()}function unwrapListeners(o){for(var s=new Array(o.length),a=0;a<s.length;++a)s[a]=o[a].listener||o[a];return s}function once$1(o,s){return new Promise(function(a,et){function tt(nt){o.removeListener(s,rt),et(nt)}function rt(){typeof o.removeListener=="function"&&o.removeListener("error",tt),a([].slice.call(arguments))}eventTargetAgnosticAddListener(o,s,rt,{once:!0}),s!=="error"&&addErrorHandlerIfEventEmitter(o,tt,{once:!0})})}function addErrorHandlerIfEventEmitter(o,s,a){typeof o.on=="function"&&eventTargetAgnosticAddListener(o,"error",s,a)}function eventTargetAgnosticAddListener(o,s,a,et){if(typeof o.on=="function")et.once?o.once(s,a):o.on(s,a);else if(typeof o.addEventListener=="function")o.addEventListener(s,function tt(rt){et.once&&o.removeEventListener(s,tt),a(rt)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof o)}var eventsExports=events$4.exports;const EventEmitter$4=getDefaultExportFromCjs$2(eventsExports);var inherits$9={exports:{}};typeof Object.create=="function"?inherits$9.exports=function(s,a){s.super_=a,s.prototype=Object.create(a.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}})}:inherits$9.exports=function(s,a){s.super_=a;var et=function(){};et.prototype=a.prototype,s.prototype=new et,s.prototype.constructor=s};var inheritsExports=inherits$9.exports,events$3=eventsExports,inherits$8=inheritsExports,Bagpipe=function(o,s){events$3.EventEmitter.call(this),this.limit=o,this.active=0,this.paused=!1,this.queue=[],this.options={disabled:!1,refuse:!1,ratio:1,timeout:null},typeof s=="boolean"&&(s={disabled:s}),s=s||{};for(var a in this.options)s.hasOwnProperty(a)&&(this.options[a]=s[a]);this.queueLength=Math.round(this.limit*(this.options.ratio||1))};inherits$8(Bagpipe,events$3.EventEmitter);var addToQueue=function(o){return function(s){var a=[].slice.call(arguments,1),et=a[a.length-1];if(typeof et!="function"&&a.push(function(){}),this.options.disabled||this.limit<1)return s.apply(null,a),this;if(this.queue.length<this.queueLength||!this.options.refuse)this.queue[o?"unshift":"push"]({method:s,args:a});else{var tt=new Error("Too much async call in queue");tt.name="TooMuchAsyncCallError",et(tt)}return this.queue.length>1&&this.emit("full",this.queue.length),this.next(),this}};Bagpipe.prototype.push=addToQueue(0);Bagpipe.prototype.unshift=addToQueue(1);Bagpipe.prototype.pause=function(){this.paused=!0};Bagpipe.prototype.resume=function(){this.paused=!1,this.next()};/*!
 * 
 */Bagpipe.prototype.next=function(){if(!this.paused){var o=this;if(o.active<o.limit&&o.queue.length){var s=o.queue.shift();o.run(s.method,s.args)}}};Bagpipe.prototype._next=function(){this.active--,this.next()};/*!
 * 
 */Bagpipe.prototype.run=function(o,s){var a=this;a.active++;var et=s[s.length-1],tt=null,rt=!1;s[s.length-1]=function(it){tt&&(clearTimeout(tt),tt=null),rt?it&&a.emit("outdated",it):(a._next(),et.apply(null,arguments))};var nt=a.options.timeout;nt&&(tt=setTimeout(function(){rt=!0,a._next();var it=new Error(nt+"ms timeout");it.name="BagpipeTimeoutError",it.data={name:o.name,method:o.toString(),args:s.slice(0,-1)},et(it)},nt)),setTimeout(function(){o.apply(null,s)},0)};var bagpipe$2=Bagpipe,bagpipe$1=bagpipe$2,binarySearchTree={},customUtils$2={};function getRandomArray(o){var s,a;return o===0?[]:o===1?[0]:(s=getRandomArray(o-1),a=Math.floor(Math.random()*o),s.splice(a,0,o-1),s)}customUtils$2.getRandomArray=getRandomArray;function defaultCompareKeysFunction(o,s){if(o<s)return-1;if(o>s)return 1;if(o===s)return 0;var a=new Error("Couldn't compare elements");throw a.a=o,a.b=s,a}customUtils$2.defaultCompareKeysFunction=defaultCompareKeysFunction;function defaultCheckValueEquality(o,s){return o===s}customUtils$2.defaultCheckValueEquality=defaultCheckValueEquality;var customUtils$1=customUtils$2;function BinarySearchTree$2(o){o=o||{},this.left=null,this.right=null,this.parent=o.parent!==void 0?o.parent:null,o.hasOwnProperty("key")&&(this.key=o.key),this.data=o.hasOwnProperty("value")?[o.value]:[],this.unique=o.unique||!1,this.compareKeys=o.compareKeys||customUtils$1.defaultCompareKeysFunction,this.checkValueEquality=o.checkValueEquality||customUtils$1.defaultCheckValueEquality}BinarySearchTree$2.prototype.getMaxKeyDescendant=function(){return this.right?this.right.getMaxKeyDescendant():this};BinarySearchTree$2.prototype.getMaxKey=function(){return this.getMaxKeyDescendant().key};BinarySearchTree$2.prototype.getMinKeyDescendant=function(){return this.left?this.left.getMinKeyDescendant():this};BinarySearchTree$2.prototype.getMinKey=function(){return this.getMinKeyDescendant().key};BinarySearchTree$2.prototype.checkAllNodesFullfillCondition=function(o){this.hasOwnProperty("key")&&(o(this.key,this.data),this.left&&this.left.checkAllNodesFullfillCondition(o),this.right&&this.right.checkAllNodesFullfillCondition(o))};BinarySearchTree$2.prototype.checkNodeOrdering=function(){var o=this;this.hasOwnProperty("key")&&(this.left&&(this.left.checkAllNodesFullfillCondition(function(s){if(o.compareKeys(s,o.key)>=0)throw new Error("Tree with root "+o.key+" is not a binary search tree")}),this.left.checkNodeOrdering()),this.right&&(this.right.checkAllNodesFullfillCondition(function(s){if(o.compareKeys(s,o.key)<=0)throw new Error("Tree with root "+o.key+" is not a binary search tree")}),this.right.checkNodeOrdering()))};BinarySearchTree$2.prototype.checkInternalPointers=function(){if(this.left){if(this.left.parent!==this)throw new Error("Parent pointer broken for key "+this.key);this.left.checkInternalPointers()}if(this.right){if(this.right.parent!==this)throw new Error("Parent pointer broken for key "+this.key);this.right.checkInternalPointers()}};BinarySearchTree$2.prototype.checkIsBST=function(){if(this.checkNodeOrdering(),this.checkInternalPointers(),this.parent)throw new Error("The root shouldn't have a parent")};BinarySearchTree$2.prototype.getNumberOfKeys=function(){var o;return this.hasOwnProperty("key")?(o=1,this.left&&(o+=this.left.getNumberOfKeys()),this.right&&(o+=this.right.getNumberOfKeys()),o):0};BinarySearchTree$2.prototype.createSimilar=function(o){return o=o||{},o.unique=this.unique,o.compareKeys=this.compareKeys,o.checkValueEquality=this.checkValueEquality,new this.constructor(o)};BinarySearchTree$2.prototype.createLeftChild=function(o){var s=this.createSimilar(o);return s.parent=this,this.left=s,s};BinarySearchTree$2.prototype.createRightChild=function(o){var s=this.createSimilar(o);return s.parent=this,this.right=s,s};BinarySearchTree$2.prototype.insert=function(o,s){if(!this.hasOwnProperty("key")){this.key=o,this.data.push(s);return}if(this.compareKeys(this.key,o)===0){if(this.unique){var a=new Error("Can't insert key "+o+", it violates the unique constraint");throw a.key=o,a.errorType="uniqueViolated",a}else this.data.push(s);return}this.compareKeys(o,this.key)<0?this.left?this.left.insert(o,s):this.createLeftChild({key:o,value:s}):this.right?this.right.insert(o,s):this.createRightChild({key:o,value:s})};BinarySearchTree$2.prototype.search=function(o){return this.hasOwnProperty("key")?this.compareKeys(this.key,o)===0?this.data:this.compareKeys(o,this.key)<0?this.left?this.left.search(o):[]:this.right?this.right.search(o):[]:[]};BinarySearchTree$2.prototype.getLowerBoundMatcher=function(o){var s=this;return!o.hasOwnProperty("$gt")&&!o.hasOwnProperty("$gte")?function(){return!0}:o.hasOwnProperty("$gt")&&o.hasOwnProperty("$gte")?s.compareKeys(o.$gte,o.$gt)===0?function(a){return s.compareKeys(a,o.$gt)>0}:s.compareKeys(o.$gte,o.$gt)>0?function(a){return s.compareKeys(a,o.$gte)>=0}:function(a){return s.compareKeys(a,o.$gt)>0}:o.hasOwnProperty("$gt")?function(a){return s.compareKeys(a,o.$gt)>0}:function(a){return s.compareKeys(a,o.$gte)>=0}};BinarySearchTree$2.prototype.getUpperBoundMatcher=function(o){var s=this;return!o.hasOwnProperty("$lt")&&!o.hasOwnProperty("$lte")?function(){return!0}:o.hasOwnProperty("$lt")&&o.hasOwnProperty("$lte")?s.compareKeys(o.$lte,o.$lt)===0?function(a){return s.compareKeys(a,o.$lt)<0}:s.compareKeys(o.$lte,o.$lt)<0?function(a){return s.compareKeys(a,o.$lte)<=0}:function(a){return s.compareKeys(a,o.$lt)<0}:o.hasOwnProperty("$lt")?function(a){return s.compareKeys(a,o.$lt)<0}:function(a){return s.compareKeys(a,o.$lte)<=0}};function append$2(o,s){var a;for(a=0;a<s.length;a+=1)o.push(s[a])}BinarySearchTree$2.prototype.betweenBounds=function(o,s,a){var et=[];return this.hasOwnProperty("key")?(s=s||this.getLowerBoundMatcher(o),a=a||this.getUpperBoundMatcher(o),s(this.key)&&this.left&&append$2(et,this.left.betweenBounds(o,s,a)),s(this.key)&&a(this.key)&&append$2(et,this.data),a(this.key)&&this.right&&append$2(et,this.right.betweenBounds(o,s,a)),et):[]};BinarySearchTree$2.prototype.deleteIfLeaf=function(){return this.left||this.right?!1:this.parent?(this.parent.left===this?this.parent.left=null:this.parent.right=null,!0):(delete this.key,this.data=[],!0)};BinarySearchTree$2.prototype.deleteIfOnlyOneChild=function(){var o;return this.left&&!this.right&&(o=this.left),!this.left&&this.right&&(o=this.right),o?this.parent?(this.parent.left===this?(this.parent.left=o,o.parent=this.parent):(this.parent.right=o,o.parent=this.parent),!0):(this.key=o.key,this.data=o.data,this.left=null,o.left&&(this.left=o.left,o.left.parent=this),this.right=null,o.right&&(this.right=o.right,o.right.parent=this),!0):!1};BinarySearchTree$2.prototype.delete=function(o,s){var a=[],et,tt=this;if(this.hasOwnProperty("key")){if(this.compareKeys(o,this.key)<0){this.left&&this.left.delete(o,s);return}if(this.compareKeys(o,this.key)>0){this.right&&this.right.delete(o,s);return}if(!this.compareKeys(o,this.key)!==0){if(this.data.length>1&&s!==void 0){this.data.forEach(function(rt){tt.checkValueEquality(rt,s)||a.push(rt)}),tt.data=a;return}this.deleteIfLeaf()||this.deleteIfOnlyOneChild()||(Math.random()>=.5?(et=this.left.getMaxKeyDescendant(),this.key=et.key,this.data=et.data,this===et.parent?(this.left=et.left,et.left&&(et.left.parent=et.parent)):(et.parent.right=et.left,et.left&&(et.left.parent=et.parent))):(et=this.right.getMinKeyDescendant(),this.key=et.key,this.data=et.data,this===et.parent?(this.right=et.right,et.right&&(et.right.parent=et.parent)):(et.parent.left=et.right,et.right&&(et.right.parent=et.parent))))}}};BinarySearchTree$2.prototype.executeOnEveryNode=function(o){this.left&&this.left.executeOnEveryNode(o),o(this),this.right&&this.right.executeOnEveryNode(o)};BinarySearchTree$2.prototype.prettyPrint=function(o,s){s=s||"",console.log(s+"* "+this.key),o&&console.log(s+"* "+this.data),!(!this.left&&!this.right)&&(this.left?this.left.prettyPrint(o,s+"  "):console.log(s+"  *"),this.right?this.right.prettyPrint(o,s+"  "):console.log(s+"  *"))};var bst=BinarySearchTree$2,underscore={exports:{}};(function(o,s){(function(){var a=this,et=a._,tt={},rt=Array.prototype,nt=Object.prototype,it=Function.prototype,st=rt.push,ot=rt.slice,at=rt.concat,lt=nt.toString,ct=nt.hasOwnProperty,ht=rt.forEach,ft=rt.map,dt=rt.reduce,pt=rt.reduceRight,gt=rt.filter,mt=rt.every,yt=rt.some,vt=rt.indexOf,Et=rt.lastIndexOf,xt=Array.isArray,wt=Object.keys,Rt=it.bind,Ct=function(At){if(At instanceof Ct)return At;if(!(this instanceof Ct))return new Ct(At);this._wrapped=At};o.exports&&(s=o.exports=Ct),s._=Ct,Ct.VERSION="1.4.4";var Ft=Ct.each=Ct.forEach=function(At,$t,kt){if(At!=null){if(ht&&At.forEach===ht)At.forEach($t,kt);else if(At.length===+At.length){for(var Lt=0,bt=At.length;Lt<bt;Lt++)if($t.call(kt,At[Lt],Lt,At)===tt)return}else for(var It in At)if(Ct.has(At,It)&&$t.call(kt,At[It],It,At)===tt)return}};Ct.map=Ct.collect=function(At,$t,kt){var Lt=[];return At==null?Lt:ft&&At.map===ft?At.map($t,kt):(Ft(At,function(bt,It,Ut){Lt[Lt.length]=$t.call(kt,bt,It,Ut)}),Lt)};var zt="Reduce of empty array with no initial value";Ct.reduce=Ct.foldl=Ct.inject=function(At,$t,kt,Lt){var bt=arguments.length>2;if(At==null&&(At=[]),dt&&At.reduce===dt)return Lt&&($t=Ct.bind($t,Lt)),bt?At.reduce($t,kt):At.reduce($t);if(Ft(At,function(It,Ut,Wt){bt?kt=$t.call(Lt,kt,It,Ut,Wt):(kt=It,bt=!0)}),!bt)throw new TypeError(zt);return kt},Ct.reduceRight=Ct.foldr=function(At,$t,kt,Lt){var bt=arguments.length>2;if(At==null&&(At=[]),pt&&At.reduceRight===pt)return Lt&&($t=Ct.bind($t,Lt)),bt?At.reduceRight($t,kt):At.reduceRight($t);var It=At.length;if(It!==+It){var Ut=Ct.keys(At);It=Ut.length}if(Ft(At,function(Wt,Xt,Qt){Xt=Ut?Ut[--It]:--It,bt?kt=$t.call(Lt,kt,At[Xt],Xt,Qt):(kt=At[Xt],bt=!0)}),!bt)throw new TypeError(zt);return kt},Ct.find=Ct.detect=function(At,$t,kt){var Lt;return Nt(At,function(bt,It,Ut){if($t.call(kt,bt,It,Ut))return Lt=bt,!0}),Lt},Ct.filter=Ct.select=function(At,$t,kt){var Lt=[];return At==null?Lt:gt&&At.filter===gt?At.filter($t,kt):(Ft(At,function(bt,It,Ut){$t.call(kt,bt,It,Ut)&&(Lt[Lt.length]=bt)}),Lt)},Ct.reject=function(At,$t,kt){return Ct.filter(At,function(Lt,bt,It){return!$t.call(kt,Lt,bt,It)},kt)},Ct.every=Ct.all=function(At,$t,kt){$t||($t=Ct.identity);var Lt=!0;return At==null?Lt:mt&&At.every===mt?At.every($t,kt):(Ft(At,function(bt,It,Ut){if(!(Lt=Lt&&$t.call(kt,bt,It,Ut)))return tt}),!!Lt)};var Nt=Ct.some=Ct.any=function(At,$t,kt){$t||($t=Ct.identity);var Lt=!1;return At==null?Lt:yt&&At.some===yt?At.some($t,kt):(Ft(At,function(bt,It,Ut){if(Lt||(Lt=$t.call(kt,bt,It,Ut)))return tt}),!!Lt)};Ct.contains=Ct.include=function(At,$t){return At==null?!1:vt&&At.indexOf===vt?At.indexOf($t)!=-1:Nt(At,function(kt){return kt===$t})},Ct.invoke=function(At,$t){var kt=ot.call(arguments,2),Lt=Ct.isFunction($t);return Ct.map(At,function(bt){return(Lt?$t:bt[$t]).apply(bt,kt)})},Ct.pluck=function(At,$t){return Ct.map(At,function(kt){return kt[$t]})},Ct.where=function(At,$t,kt){return Ct.isEmpty($t)?kt?null:[]:Ct[kt?"find":"filter"](At,function(Lt){for(var bt in $t)if($t[bt]!==Lt[bt])return!1;return!0})},Ct.findWhere=function(At,$t){return Ct.where(At,$t,!0)},Ct.max=function(At,$t,kt){if(!$t&&Ct.isArray(At)&&At[0]===+At[0]&&At.length<65535)return Math.max.apply(Math,At);if(!$t&&Ct.isEmpty(At))return-1/0;var Lt={computed:-1/0,value:-1/0};return Ft(At,function(bt,It,Ut){var Wt=$t?$t.call(kt,bt,It,Ut):bt;Wt>=Lt.computed&&(Lt={value:bt,computed:Wt})}),Lt.value},Ct.min=function(At,$t,kt){if(!$t&&Ct.isArray(At)&&At[0]===+At[0]&&At.length<65535)return Math.min.apply(Math,At);if(!$t&&Ct.isEmpty(At))return 1/0;var Lt={computed:1/0,value:1/0};return Ft(At,function(bt,It,Ut){var Wt=$t?$t.call(kt,bt,It,Ut):bt;Wt<Lt.computed&&(Lt={value:bt,computed:Wt})}),Lt.value},Ct.shuffle=function(At){var $t,kt=0,Lt=[];return Ft(At,function(bt){$t=Ct.random(kt++),Lt[kt-1]=Lt[$t],Lt[$t]=bt}),Lt};var Kt=function(At){return Ct.isFunction(At)?At:function($t){return $t[At]}};Ct.sortBy=function(At,$t,kt){var Lt=Kt($t);return Ct.pluck(Ct.map(At,function(bt,It,Ut){return{value:bt,index:It,criteria:Lt.call(kt,bt,It,Ut)}}).sort(function(bt,It){var Ut=bt.criteria,Wt=It.criteria;if(Ut!==Wt){if(Ut>Wt||Ut===void 0)return 1;if(Ut<Wt||Wt===void 0)return-1}return bt.index<It.index?-1:1}),"value")};var Yt=function(At,$t,kt,Lt){var bt={},It=Kt($t||Ct.identity);return Ft(At,function(Ut,Wt){var Xt=It.call(kt,Ut,Wt,At);Lt(bt,Xt,Ut)}),bt};Ct.groupBy=function(At,$t,kt){return Yt(At,$t,kt,function(Lt,bt,It){(Ct.has(Lt,bt)?Lt[bt]:Lt[bt]=[]).push(It)})},Ct.countBy=function(At,$t,kt){return Yt(At,$t,kt,function(Lt,bt){Ct.has(Lt,bt)||(Lt[bt]=0),Lt[bt]++})},Ct.sortedIndex=function(At,$t,kt,Lt){kt=kt==null?Ct.identity:Kt(kt);for(var bt=kt.call(Lt,$t),It=0,Ut=At.length;It<Ut;){var Wt=It+Ut>>>1;kt.call(Lt,At[Wt])<bt?It=Wt+1:Ut=Wt}return It},Ct.toArray=function(At){return At?Ct.isArray(At)?ot.call(At):At.length===+At.length?Ct.map(At,Ct.identity):Ct.values(At):[]},Ct.size=function(At){return At==null?0:At.length===+At.length?At.length:Ct.keys(At).length},Ct.first=Ct.head=Ct.take=function(At,$t,kt){if(At!=null)return $t!=null&&!kt?ot.call(At,0,$t):At[0]},Ct.initial=function(At,$t,kt){return ot.call(At,0,At.length-($t==null||kt?1:$t))},Ct.last=function(At,$t,kt){if(At!=null)return $t!=null&&!kt?ot.call(At,Math.max(At.length-$t,0)):At[At.length-1]},Ct.rest=Ct.tail=Ct.drop=function(At,$t,kt){return ot.call(At,$t==null||kt?1:$t)},Ct.compact=function(At){return Ct.filter(At,Ct.identity)};var Bt=function(At,$t,kt){return Ft(At,function(Lt){Ct.isArray(Lt)?$t?st.apply(kt,Lt):Bt(Lt,$t,kt):kt.push(Lt)}),kt};Ct.flatten=function(At,$t){return Bt(At,$t,[])},Ct.without=function(At){return Ct.difference(At,ot.call(arguments,1))},Ct.uniq=Ct.unique=function(At,$t,kt,Lt){Ct.isFunction($t)&&(Lt=kt,kt=$t,$t=!1);var bt=kt?Ct.map(At,kt,Lt):At,It=[],Ut=[];return Ft(bt,function(Wt,Xt){($t?!Xt||Ut[Ut.length-1]!==Wt:!Ct.contains(Ut,Wt))&&(Ut.push(Wt),It.push(At[Xt]))}),It},Ct.union=function(){return Ct.uniq(at.apply(rt,arguments))},Ct.intersection=function(At){var $t=ot.call(arguments,1);return Ct.filter(Ct.uniq(At),function(kt){return Ct.every($t,function(Lt){return Ct.indexOf(Lt,kt)>=0})})},Ct.difference=function(At){var $t=at.apply(rt,ot.call(arguments,1));return Ct.filter(At,function(kt){return!Ct.contains($t,kt)})},Ct.zip=function(){for(var At=ot.call(arguments),$t=Ct.max(Ct.pluck(At,"length")),kt=new Array($t),Lt=0;Lt<$t;Lt++)kt[Lt]=Ct.pluck(At,""+Lt);return kt},Ct.object=function(At,$t){if(At==null)return{};for(var kt={},Lt=0,bt=At.length;Lt<bt;Lt++)$t?kt[At[Lt]]=$t[Lt]:kt[At[Lt][0]]=At[Lt][1];return kt},Ct.indexOf=function(At,$t,kt){if(At==null)return-1;var Lt=0,bt=At.length;if(kt)if(typeof kt=="number")Lt=kt<0?Math.max(0,bt+kt):kt;else return Lt=Ct.sortedIndex(At,$t),At[Lt]===$t?Lt:-1;if(vt&&At.indexOf===vt)return At.indexOf($t,kt);for(;Lt<bt;Lt++)if(At[Lt]===$t)return Lt;return-1},Ct.lastIndexOf=function(At,$t,kt){if(At==null)return-1;var Lt=kt!=null;if(Et&&At.lastIndexOf===Et)return Lt?At.lastIndexOf($t,kt):At.lastIndexOf($t);for(var bt=Lt?kt:At.length;bt--;)if(At[bt]===$t)return bt;return-1},Ct.range=function(At,$t,kt){arguments.length<=1&&($t=At||0,At=0),kt=arguments[2]||1;for(var Lt=Math.max(Math.ceil(($t-At)/kt),0),bt=0,It=new Array(Lt);bt<Lt;)It[bt++]=At,At+=kt;return It},Ct.bind=function(At,$t){if(At.bind===Rt&&Rt)return Rt.apply(At,ot.call(arguments,1));var kt=ot.call(arguments,2);return function(){return At.apply($t,kt.concat(ot.call(arguments)))}},Ct.partial=function(At){var $t=ot.call(arguments,1);return function(){return At.apply(this,$t.concat(ot.call(arguments)))}},Ct.bindAll=function(At){var $t=ot.call(arguments,1);return $t.length===0&&($t=Ct.functions(At)),Ft($t,function(kt){At[kt]=Ct.bind(At[kt],At)}),At},Ct.memoize=function(At,$t){var kt={};return $t||($t=Ct.identity),function(){var Lt=$t.apply(this,arguments);return Ct.has(kt,Lt)?kt[Lt]:kt[Lt]=At.apply(this,arguments)}},Ct.delay=function(At,$t){var kt=ot.call(arguments,2);return setTimeout(function(){return At.apply(null,kt)},$t)},Ct.defer=function(At){return Ct.delay.apply(Ct,[At,1].concat(ot.call(arguments,1)))},Ct.throttle=function(At,$t){var kt,Lt,bt,It,Ut=0,Wt=function(){Ut=new Date,bt=null,It=At.apply(kt,Lt)};return function(){var Xt=new Date,Qt=$t-(Xt-Ut);return kt=this,Lt=arguments,Qt<=0?(clearTimeout(bt),bt=null,Ut=Xt,It=At.apply(kt,Lt)):bt||(bt=setTimeout(Wt,Qt)),It}},Ct.debounce=function(At,$t,kt){var Lt,bt;return function(){var It=this,Ut=arguments,Wt=function(){Lt=null,kt||(bt=At.apply(It,Ut))},Xt=kt&&!Lt;return clearTimeout(Lt),Lt=setTimeout(Wt,$t),Xt&&(bt=At.apply(It,Ut)),bt}},Ct.once=function(At){var $t=!1,kt;return function(){return $t||($t=!0,kt=At.apply(this,arguments),At=null),kt}},Ct.wrap=function(At,$t){return function(){var kt=[At];return st.apply(kt,arguments),$t.apply(this,kt)}},Ct.compose=function(){var At=arguments;return function(){for(var $t=arguments,kt=At.length-1;kt>=0;kt--)$t=[At[kt].apply(this,$t)];return $t[0]}},Ct.after=function(At,$t){return At<=0?$t():function(){if(--At<1)return $t.apply(this,arguments)}},Ct.keys=wt||function(At){if(At!==Object(At))throw new TypeError("Invalid object");var $t=[];for(var kt in At)Ct.has(At,kt)&&($t[$t.length]=kt);return $t},Ct.values=function(At){var $t=[];for(var kt in At)Ct.has(At,kt)&&$t.push(At[kt]);return $t},Ct.pairs=function(At){var $t=[];for(var kt in At)Ct.has(At,kt)&&$t.push([kt,At[kt]]);return $t},Ct.invert=function(At){var $t={};for(var kt in At)Ct.has(At,kt)&&($t[At[kt]]=kt);return $t},Ct.functions=Ct.methods=function(At){var $t=[];for(var kt in At)Ct.isFunction(At[kt])&&$t.push(kt);return $t.sort()},Ct.extend=function(At){return Ft(ot.call(arguments,1),function($t){if($t)for(var kt in $t)At[kt]=$t[kt]}),At},Ct.pick=function(At){var $t={},kt=at.apply(rt,ot.call(arguments,1));return Ft(kt,function(Lt){Lt in At&&($t[Lt]=At[Lt])}),$t},Ct.omit=function(At){var $t={},kt=at.apply(rt,ot.call(arguments,1));for(var Lt in At)Ct.contains(kt,Lt)||($t[Lt]=At[Lt]);return $t},Ct.defaults=function(At){return Ft(ot.call(arguments,1),function($t){if($t)for(var kt in $t)At[kt]==null&&(At[kt]=$t[kt])}),At},Ct.clone=function(At){return Ct.isObject(At)?Ct.isArray(At)?At.slice():Ct.extend({},At):At},Ct.tap=function(At,$t){return $t(At),At};var Pt=function(At,$t,kt,Lt){if(At===$t)return At!==0||1/At==1/$t;if(At==null||$t==null)return At===$t;At instanceof Ct&&(At=At._wrapped),$t instanceof Ct&&($t=$t._wrapped);var bt=lt.call(At);if(bt!=lt.call($t))return!1;switch(bt){case"[object String]":return At==String($t);case"[object Number]":return At!=+At?$t!=+$t:At==0?1/At==1/$t:At==+$t;case"[object Date]":case"[object Boolean]":return+At==+$t;case"[object RegExp]":return At.source==$t.source&&At.global==$t.global&&At.multiline==$t.multiline&&At.ignoreCase==$t.ignoreCase}if(typeof At!="object"||typeof $t!="object")return!1;for(var It=kt.length;It--;)if(kt[It]==At)return Lt[It]==$t;kt.push(At),Lt.push($t);var Ut=0,Wt=!0;if(bt=="[object Array]"){if(Ut=At.length,Wt=Ut==$t.length,Wt)for(;Ut--&&(Wt=Pt(At[Ut],$t[Ut],kt,Lt)););}else{var Xt=At.constructor,Qt=$t.constructor;if(Xt!==Qt&&!(Ct.isFunction(Xt)&&Xt instanceof Xt&&Ct.isFunction(Qt)&&Qt instanceof Qt))return!1;for(var er in At)if(Ct.has(At,er)&&(Ut++,!(Wt=Ct.has($t,er)&&Pt(At[er],$t[er],kt,Lt))))break;if(Wt){for(er in $t)if(Ct.has($t,er)&&!Ut--)break;Wt=!Ut}}return kt.pop(),Lt.pop(),Wt};Ct.isEqual=function(At,$t){return Pt(At,$t,[],[])},Ct.isEmpty=function(At){if(At==null)return!0;if(Ct.isArray(At)||Ct.isString(At))return At.length===0;for(var $t in At)if(Ct.has(At,$t))return!1;return!0},Ct.isElement=function(At){return!!(At&&At.nodeType===1)},Ct.isArray=xt||function(At){return lt.call(At)=="[object Array]"},Ct.isObject=function(At){return At===Object(At)},Ft(["Arguments","Function","String","Number","Date","RegExp"],function(At){Ct["is"+At]=function($t){return lt.call($t)=="[object "+At+"]"}}),Ct.isArguments(arguments)||(Ct.isArguments=function(At){return!!(At&&Ct.has(At,"callee"))}),typeof/./!="function"&&(Ct.isFunction=function(At){return typeof At=="function"}),Ct.isFinite=function(At){return isFinite(At)&&!isNaN(parseFloat(At))},Ct.isNaN=function(At){return Ct.isNumber(At)&&At!=+At},Ct.isBoolean=function(At){return At===!0||At===!1||lt.call(At)=="[object Boolean]"},Ct.isNull=function(At){return At===null},Ct.isUndefined=function(At){return At===void 0},Ct.has=function(At,$t){return ct.call(At,$t)},Ct.noConflict=function(){return a._=et,this},Ct.identity=function(At){return At},Ct.times=function(At,$t,kt){for(var Lt=Array(At),bt=0;bt<At;bt++)Lt[bt]=$t.call(kt,bt);return Lt},Ct.random=function(At,$t){return $t==null&&($t=At,At=0),At+Math.floor(Math.random()*($t-At+1))};var Dt={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};Dt.unescape=Ct.invert(Dt.escape);var Tt={escape:new RegExp("["+Ct.keys(Dt.escape).join("")+"]","g"),unescape:new RegExp("("+Ct.keys(Dt.unescape).join("|")+")","g")};Ct.each(["escape","unescape"],function(At){Ct[At]=function($t){return $t==null?"":(""+$t).replace(Tt[At],function(kt){return Dt[At][kt]})}}),Ct.result=function(At,$t){if(At==null)return null;var kt=At[$t];return Ct.isFunction(kt)?kt.call(At):kt},Ct.mixin=function(At){Ft(Ct.functions(At),function($t){var kt=Ct[$t]=At[$t];Ct.prototype[$t]=function(){var Lt=[this._wrapped];return st.apply(Lt,arguments),Ht.call(this,kt.apply(Ct,Lt))}})};var St=0;Ct.uniqueId=function(At){var $t=++St+"";return At?At+$t:$t},Ct.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var Mt=/(.)^/,jt={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},Gt=/\\|'|\r|\n|\t|\u2028|\u2029/g;Ct.template=function(At,$t,kt){var Lt;kt=Ct.defaults({},kt,Ct.templateSettings);var bt=new RegExp([(kt.escape||Mt).source,(kt.interpolate||Mt).source,(kt.evaluate||Mt).source].join("|")+"|$","g"),It=0,Ut="__p+='";At.replace(bt,function(Xt,Qt,er,lr,pr){return Ut+=At.slice(It,pr).replace(Gt,function(gr){return"\\"+jt[gr]}),Qt&&(Ut+=`'+
((__t=(`+Qt+`))==null?'':_.escape(__t))+
'`),er&&(Ut+=`'+
((__t=(`+er+`))==null?'':__t)+
'`),lr&&(Ut+=`';
`+lr+`
__p+='`),It=pr+Xt.length,Xt}),Ut+=`';
`,kt.variable||(Ut=`with(obj||{}){
`+Ut+`}
`),Ut=`var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};
`+Ut+`return __p;
`;try{Lt=new Function(kt.variable||"obj","_",Ut)}catch(Xt){throw Xt.source=Ut,Xt}if($t)return Lt($t,Ct);var Wt=function(Xt){return Lt.call(this,Xt,Ct)};return Wt.source="function("+(kt.variable||"obj")+`){
`+Ut+"}",Wt},Ct.chain=function(At){return Ct(At).chain()};var Ht=function(At){return this._chain?Ct(At).chain():At};Ct.mixin(Ct),Ft(["pop","push","reverse","shift","sort","splice","unshift"],function(At){var $t=rt[At];Ct.prototype[At]=function(){var kt=this._wrapped;return $t.apply(kt,arguments),(At=="shift"||At=="splice")&&kt.length===0&&delete kt[0],Ht.call(this,kt)}}),Ft(["concat","join","slice"],function(At){var $t=rt[At];Ct.prototype[At]=function(){return Ht.call(this,$t.apply(this._wrapped,arguments))}}),Ct.extend(Ct.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(commonjsGlobal)})(underscore,underscore.exports);var BinarySearchTree$1=bst,customUtils=customUtils$2,util$8=util$b;function AVLTree(o){this.tree=new _AVLTree(o)}function _AVLTree(o){o=o||{},this.left=null,this.right=null,this.parent=o.parent!==void 0?o.parent:null,o.hasOwnProperty("key")&&(this.key=o.key),this.data=o.hasOwnProperty("value")?[o.value]:[],this.unique=o.unique||!1,this.compareKeys=o.compareKeys||customUtils.defaultCompareKeysFunction,this.checkValueEquality=o.checkValueEquality||customUtils.defaultCheckValueEquality}util$8.inherits(_AVLTree,BinarySearchTree$1);AVLTree._AVLTree=_AVLTree;_AVLTree.prototype.checkHeightCorrect=function(){var o,s;if(this.hasOwnProperty("key")){if(this.left&&this.left.height===void 0)throw new Error("Undefined height for node "+this.left.key);if(this.right&&this.right.height===void 0)throw new Error("Undefined height for node "+this.right.key);if(this.height===void 0)throw new Error("Undefined height for node "+this.key);if(o=this.left?this.left.height:0,s=this.right?this.right.height:0,this.height!==1+Math.max(o,s))throw new Error("Height constraint failed for node "+this.key);this.left&&this.left.checkHeightCorrect(),this.right&&this.right.checkHeightCorrect()}};_AVLTree.prototype.balanceFactor=function(){var o=this.left?this.left.height:0,s=this.right?this.right.height:0;return o-s};_AVLTree.prototype.checkBalanceFactors=function(){if(Math.abs(this.balanceFactor())>1)throw new Error("Tree is unbalanced at node "+this.key);this.left&&this.left.checkBalanceFactors(),this.right&&this.right.checkBalanceFactors()};_AVLTree.prototype.checkIsAVLT=function(){_AVLTree.super_.prototype.checkIsBST.call(this),this.checkHeightCorrect(),this.checkBalanceFactors()};AVLTree.prototype.checkIsAVLT=function(){this.tree.checkIsAVLT()};_AVLTree.prototype.rightRotation=function(){var o=this,s=this.left,a,et,tt,rt;return s?(a=s.right,o.parent?(s.parent=o.parent,o.parent.left===o?o.parent.left=s:o.parent.right=s):s.parent=null,s.right=o,o.parent=s,o.left=a,a&&(a.parent=o),et=s.left?s.left.height:0,tt=a?a.height:0,rt=o.right?o.right.height:0,o.height=Math.max(tt,rt)+1,s.height=Math.max(et,o.height)+1,s):this};_AVLTree.prototype.leftRotation=function(){var o=this,s=this.right,a,et,tt,rt;return s?(a=s.left,o.parent?(s.parent=o.parent,o.parent.left===o?o.parent.left=s:o.parent.right=s):s.parent=null,s.left=o,o.parent=s,o.right=a,a&&(a.parent=o),et=o.left?o.left.height:0,tt=a?a.height:0,rt=s.right?s.right.height:0,o.height=Math.max(et,tt)+1,s.height=Math.max(rt,o.height)+1,s):this};_AVLTree.prototype.rightTooSmall=function(){return this.balanceFactor()<=1?this:(this.left.balanceFactor()<0&&this.left.leftRotation(),this.rightRotation())};_AVLTree.prototype.leftTooSmall=function(){return this.balanceFactor()>=-1?this:(this.right.balanceFactor()>0&&this.right.rightRotation(),this.leftRotation())};_AVLTree.prototype.rebalanceAlongPath=function(o){var s=this,a,et;if(!this.hasOwnProperty("key"))return delete this.height,this;for(et=o.length-1;et>=0;et-=1)o[et].height=1+Math.max(o[et].left?o[et].left.height:0,o[et].right?o[et].right.height:0),o[et].balanceFactor()>1&&(a=o[et].rightTooSmall(),et===0&&(s=a)),o[et].balanceFactor()<-1&&(a=o[et].leftTooSmall(),et===0&&(s=a));return s};_AVLTree.prototype.insert=function(o,s){var a=[],et=this;if(!this.hasOwnProperty("key"))return this.key=o,this.data.push(s),this.height=1,this;for(;;){if(et.compareKeys(et.key,o)===0){if(et.unique){var tt=new Error("Can't insert key "+o+", it violates the unique constraint");throw tt.key=o,tt.errorType="uniqueViolated",tt}else et.data.push(s);return this}if(a.push(et),et.compareKeys(o,et.key)<0)if(et.left)et=et.left;else{a.push(et.createLeftChild({key:o,value:s}));break}else if(et.right)et=et.right;else{a.push(et.createRightChild({key:o,value:s}));break}}return this.rebalanceAlongPath(a)};AVLTree.prototype.insert=function(o,s){var a=this.tree.insert(o,s);a&&(this.tree=a)};_AVLTree.prototype.delete=function(o,s){var a=[],et,tt=this,rt=[];if(!this.hasOwnProperty("key"))return this;for(;tt.compareKeys(o,tt.key)!==0;)if(rt.push(tt),tt.compareKeys(o,tt.key)<0)if(tt.left)tt=tt.left;else return this;else if(tt.right)tt=tt.right;else return this;if(tt.data.length>1&&s!==void 0)return tt.data.forEach(function(nt){tt.checkValueEquality(nt,s)||a.push(nt)}),tt.data=a,this;if(!tt.left&&!tt.right)return tt===this?(delete tt.key,tt.data=[],delete tt.height,this):(tt.parent.left===tt?tt.parent.left=null:tt.parent.right=null,this.rebalanceAlongPath(rt));if(!tt.left||!tt.right)return et=tt.left?tt.left:tt.right,tt===this?(et.parent=null,et):(tt.parent.left===tt?(tt.parent.left=et,et.parent=tt.parent):(tt.parent.right=et,et.parent=tt.parent),this.rebalanceAlongPath(rt));if(rt.push(tt),et=tt.left,!et.right)return tt.key=et.key,tt.data=et.data,tt.left=et.left,et.left&&(et.left.parent=tt),this.rebalanceAlongPath(rt);for(;et.right;)rt.push(et),et=et.right;return tt.key=et.key,tt.data=et.data,et.parent.right=et.left,et.left&&(et.left.parent=et.parent),this.rebalanceAlongPath(rt)};AVLTree.prototype.delete=function(o,s){var a=this.tree.delete(o,s);a&&(this.tree=a)};["getNumberOfKeys","search","betweenBounds","prettyPrint","executeOnEveryNode"].forEach(function(o){AVLTree.prototype[o]=function(){return this.tree[o].apply(this.tree,arguments)}});var avltree=AVLTree;binarySearchTree.BinarySearchTree=bst;binarySearchTree.AVLTree=avltree;var BinarySearchTree=binarySearchTree.AVLTree,document$3=document$4,_$4=underscoreExports,util$7=util$b;function checkValueEquality(o,s){return o===s}function projectForUnique(o){return o===null?"$null":typeof o=="string"?"$string"+o:typeof o=="boolean"?"$boolean"+o:typeof o=="number"?"$number"+o:util$7.isArray(o)?"$date"+o.getTime():o}function getDotValues(o,s){var a,et,tt,rt;if(util$7.isArray(s)){for(et={},tt=0,rt=s.length;tt<rt;tt++)a=s[tt],et[a]=document$3.getDotValue(o,a);return et}else return document$3.getDotValue(o,s)}function Index$1(o){this.fieldName=o.fieldName,this.unique=o.unique||!1,this.sparse=o.sparse||!1;var s=util$7.isArray(this.fieldName)?document$3.compoundCompareThings(this.fieldName):document$3.compareThings;this.treeOptions={unique:this.unique,compareKeys:s,checkValueEquality},this.reset()}Index$1.prototype.reset=function(){this.tree=new BinarySearchTree(this.treeOptions),this.ready=!1};Index$1.prototype.insert=function(o){var s,a,et,tt,rt;if(util$7.isArray(o)){this.insertMultipleDocs(o);return}if(s=getDotValues(o,this.fieldName),!((s===void 0||_$4.isEmpty(s))&&this.sparse))if(!util$7.isArray(s))this.tree.insert(s,o._id);else{for(a=_$4.uniq(s,projectForUnique),et=0;et<a.length;et+=1)try{this.tree.insert(a[et],o._id)}catch(nt){rt=nt,tt=et;break}if(rt){for(et=0;et<tt;et+=1)this.tree.delete(a[et],o._id);throw rt}}};Index$1.prototype.insertMultipleDocs=function(o){var s,a,et;for(s=0;s<o.length;s+=1)try{this.insert(o[s])}catch(tt){a=tt,et=s;break}if(a){for(s=0;s<et;s+=1)this.remove(o[s]);throw a}};Index$1.prototype.remove=function(o){var s,a=this;if(util$7.isArray(o)){o.forEach(function(et){a.remove(et)});return}s=getDotValues(o,this.fieldName),!((s===void 0||_$4.isEmpty(s))&&this.sparse)&&(util$7.isArray(s)?_$4.uniq(s,projectForUnique).forEach(function(et){a.tree.delete(et,o._id)}):this.tree.delete(s,o._id))};Index$1.prototype.update=function(o,s){if(util$7.isArray(o)){this.updateMultipleDocs(o);return}this.remove(o);try{this.insert(s)}catch(a){throw this.insert(o),a}};Index$1.prototype.updateMultipleDocs=function(o){var s,a,et;for(s=0;s<o.length;s+=1)o[s].oldDoc&&this.remove(o[s].oldDoc);for(s=0;s<o.length;s+=1)try{o[s].newDoc&&this.insert(o[s].newDoc)}catch(tt){et=tt,a=s;break}if(et){for(s=0;s<a;s+=1)o[s].newDoc&&this.remove(o[s].newDoc);for(s=0;s<o.length;s+=1)o[s].oldDoc&&this.insert(o[s].oldDoc);throw et}};Index$1.prototype.revertUpdate=function(o,s){var a=[];util$7.isArray(o)?(o.forEach(function(et){a.push({oldDoc:et.newDoc,newDoc:et.oldDoc})}),this.update(a)):this.update(s,o)};function append$1(o,s){var a;for(a=0;a<s.length;a+=1)o.push(s[a])}Index$1.prototype.getMatching=function(o){var s,a=this;return util$7.isArray(o)?(s=[],o.forEach(function(et){append$1(s,a.getMatching(et))}),s):this.tree.search(o)};Index$1.prototype.getBetweenBounds=function(o){return this.tree.betweenBounds(o)};Index$1.prototype.getAll=function(o){var s=[];return this.tree.executeOnEveryNode(function(a){if(!(typeof o=="function"&&!o(a))){var et;for(et=0;et<a.data.length;et+=1)s.push(a.data[et])}}),s};var indexes=Index$1;function assertPath(o){if(typeof o!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(o))}function normalizeStringPosix(o,s){for(var a="",et=0,tt=-1,rt=0,nt,it=0;it<=o.length;++it){if(it<o.length)nt=o.charCodeAt(it);else{if(nt===47)break;nt=47}if(nt===47){if(!(tt===it-1||rt===1))if(tt!==it-1&&rt===2){if(a.length<2||et!==2||a.charCodeAt(a.length-1)!==46||a.charCodeAt(a.length-2)!==46){if(a.length>2){var st=a.lastIndexOf("/");if(st!==a.length-1){st===-1?(a="",et=0):(a=a.slice(0,st),et=a.length-1-a.lastIndexOf("/")),tt=it,rt=0;continue}}else if(a.length===2||a.length===1){a="",et=0,tt=it,rt=0;continue}}s&&(a.length>0?a+="/..":a="..",et=2)}else a.length>0?a+="/"+o.slice(tt+1,it):a=o.slice(tt+1,it),et=it-tt-1;tt=it,rt=0}else nt===46&&rt!==-1?++rt:rt=-1}return a}function _format(o,s){var a=s.dir||s.root,et=s.base||(s.name||"")+(s.ext||"");return a?a===s.root?a+et:a+o+et:et}var posix={resolve:function(){for(var s="",a=!1,et,tt=arguments.length-1;tt>=-1&&!a;tt--){var rt;tt>=0?rt=arguments[tt]:(et===void 0&&(et=process$1.cwd()),rt=et),assertPath(rt),rt.length!==0&&(s=rt+"/"+s,a=rt.charCodeAt(0)===47)}return s=normalizeStringPosix(s,!a),a?s.length>0?"/"+s:"/":s.length>0?s:"."},normalize:function(s){if(assertPath(s),s.length===0)return".";var a=s.charCodeAt(0)===47,et=s.charCodeAt(s.length-1)===47;return s=normalizeStringPosix(s,!a),s.length===0&&!a&&(s="."),s.length>0&&et&&(s+="/"),a?"/"+s:s},isAbsolute:function(s){return assertPath(s),s.length>0&&s.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var s,a=0;a<arguments.length;++a){var et=arguments[a];assertPath(et),et.length>0&&(s===void 0?s=et:s+="/"+et)}return s===void 0?".":posix.normalize(s)},relative:function(s,a){if(assertPath(s),assertPath(a),s===a||(s=posix.resolve(s),a=posix.resolve(a),s===a))return"";for(var et=1;et<s.length&&s.charCodeAt(et)===47;++et);for(var tt=s.length,rt=tt-et,nt=1;nt<a.length&&a.charCodeAt(nt)===47;++nt);for(var it=a.length,st=it-nt,ot=rt<st?rt:st,at=-1,lt=0;lt<=ot;++lt){if(lt===ot){if(st>ot){if(a.charCodeAt(nt+lt)===47)return a.slice(nt+lt+1);if(lt===0)return a.slice(nt+lt)}else rt>ot&&(s.charCodeAt(et+lt)===47?at=lt:lt===0&&(at=0));break}var ct=s.charCodeAt(et+lt),ht=a.charCodeAt(nt+lt);if(ct!==ht)break;ct===47&&(at=lt)}var ft="";for(lt=et+at+1;lt<=tt;++lt)(lt===tt||s.charCodeAt(lt)===47)&&(ft.length===0?ft+="..":ft+="/..");return ft.length>0?ft+a.slice(nt+at):(nt+=at,a.charCodeAt(nt)===47&&++nt,a.slice(nt))},_makeLong:function(s){return s},dirname:function(s){if(assertPath(s),s.length===0)return".";for(var a=s.charCodeAt(0),et=a===47,tt=-1,rt=!0,nt=s.length-1;nt>=1;--nt)if(a=s.charCodeAt(nt),a===47){if(!rt){tt=nt;break}}else rt=!1;return tt===-1?et?"/":".":et&&tt===1?"//":s.slice(0,tt)},basename:function(s,a){if(a!==void 0&&typeof a!="string")throw new TypeError('"ext" argument must be a string');assertPath(s);var et=0,tt=-1,rt=!0,nt;if(a!==void 0&&a.length>0&&a.length<=s.length){if(a.length===s.length&&a===s)return"";var it=a.length-1,st=-1;for(nt=s.length-1;nt>=0;--nt){var ot=s.charCodeAt(nt);if(ot===47){if(!rt){et=nt+1;break}}else st===-1&&(rt=!1,st=nt+1),it>=0&&(ot===a.charCodeAt(it)?--it===-1&&(tt=nt):(it=-1,tt=st))}return et===tt?tt=st:tt===-1&&(tt=s.length),s.slice(et,tt)}else{for(nt=s.length-1;nt>=0;--nt)if(s.charCodeAt(nt)===47){if(!rt){et=nt+1;break}}else tt===-1&&(rt=!1,tt=nt+1);return tt===-1?"":s.slice(et,tt)}},extname:function(s){assertPath(s);for(var a=-1,et=0,tt=-1,rt=!0,nt=0,it=s.length-1;it>=0;--it){var st=s.charCodeAt(it);if(st===47){if(!rt){et=it+1;break}continue}tt===-1&&(rt=!1,tt=it+1),st===46?a===-1?a=it:nt!==1&&(nt=1):a!==-1&&(nt=-1)}return a===-1||tt===-1||nt===0||nt===1&&a===tt-1&&a===et+1?"":s.slice(a,tt)},format:function(s){if(s===null||typeof s!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof s);return _format("/",s)},parse:function(s){assertPath(s);var a={root:"",dir:"",base:"",ext:"",name:""};if(s.length===0)return a;var et=s.charCodeAt(0),tt=et===47,rt;tt?(a.root="/",rt=1):rt=0;for(var nt=-1,it=0,st=-1,ot=!0,at=s.length-1,lt=0;at>=rt;--at){if(et=s.charCodeAt(at),et===47){if(!ot){it=at+1;break}continue}st===-1&&(ot=!1,st=at+1),et===46?nt===-1?nt=at:lt!==1&&(lt=1):nt!==-1&&(lt=-1)}return nt===-1||st===-1||lt===0||lt===1&&nt===st-1&&nt===it+1?st!==-1&&(it===0&&tt?a.base=a.name=s.slice(1,st):a.base=a.name=s.slice(it,st)):(it===0&&tt?(a.name=s.slice(1,nt),a.base=s.slice(1,st)):(a.name=s.slice(it,nt),a.base=s.slice(it,st)),a.ext=s.slice(nt,st)),it>0?a.dir=s.slice(0,it-1):tt&&(a.dir="/"),a},sep:"/",delimiter:":",win32:null,posix:null};posix.posix=posix;var pathBrowserify=posix;const path$1=getDefaultExportFromCjs$2(pathBrowserify);var document$2=document$4,events$2=eventsExports,util$6=util$b,_$3=underscoreExports,INDEX_BUILDING_DEBOUNCE=10,LIVE_QUERY_DEBOUNCE=30;function Cursor$1(o,s,a){this.db=o,this.query=s||{},a&&(this.execFn=a)}Cursor$1.prototype.limit=function(o){return this._limit=o,this};Cursor$1.prototype.skip=function(o){return this._skip=o,this};Cursor$1.prototype.filter=function(o){return typeof o!="function"?this:(this._filter=o,this)};Cursor$1.prototype.find=function(o){return this.query=o||this.query,this};Cursor$1.prototype.sort=function(o){return this._sort=o,this};Cursor$1.prototype.map=function(o){return typeof o=="function"&&(this._map=o),this};Cursor$1.prototype.reduce=function(o,s){return typeof o=="function"&&(this._reduce=s===void 0?[o]:[o,s]),this};Cursor$1.prototype.aggregate=function(o){return this._aggregate=o,this};Cursor$1.prototype.exec=function(o){var s=[],a={},et={},tt=this,rt=null,nt,it;typeof this._sort=="function"?it=this._sort:nt=this._sort;var st;tt._reduce&&(st=[].concat(tt._reduce)),st&&st[1]&&(st[1]=document$2.deepCopy(tt._reduce[1])),this._quiet||this.db.emit("query",this.query);var ot=Cursor$1.getMatchesStream(this.db,this.query,nt,this._prefetched);ot.on("error",function(ct){o(ct)}),ot.removeListener("ids",ot.trigger),ot.on("ids",function(ct){var ht=ct._indexed,ft=ct._sorted,dt=ht&&ft&&!tt._filter&&!it,pt=(ft||!nt)&&!it,gt=dt&&pt&&tt._map&&st;if(dt&&(ct=at(ct,tt._limit||ct.length,tt._skip||0)),dt&&tt._count)return s=ct,lt();ot.trigger(ct),s=new Array(ct.length),gt&&(s=st[1]||void 0);var mt=function(yt){ot.close(),rt=yt,s=void 0};ot.on("data",function(yt){var vt=yt.val();if(!(!ht&&!document$2.match(vt,tt.query))){try{if(tt._filter&&!tt._filter(vt))return}catch(Et){mt(Et)}if(tt._live&&(et[vt._id]=vt,a[vt._id]=!0),gt){try{vt=tt._map(vt),s=s===void 0?vt:st[0](s,vt)}catch(Et){mt(Et)}return}s&&(s[yt.idx]=vt),tt._ondata&&tt._ondata(vt)}}),ot.on("ready",function(){if(rt||(tt._live&&(tt._ids=a),tt._prefetched=et,gt))return lt();try{s=s.filter(function(yt){return yt!==null}),pt||(s=s.sort(it||Cursor$1.getSorter(nt))),dt||(s=at(s,tt._limit||s.length,tt._skip||0)),tt._map&&(s=s.map(function(yt){return tt._map(yt)})),st&&(s=s.reduce.apply(s,st))}catch(yt){rt=yt,s=void 0}lt()})});function at(ct,ht,ft){return ct.slice(ft,ht+ft)}function lt(){return s&&tt._count&&(s=s.length),s&&tt._aggregate&&(s=tt._aggregate(s)),typeof tt.execFn=="function"?tt.execFn(rt,s,o):o(rt,s)}};Cursor$1.prototype.count=function(o){return this._count=!0,o&&this.exec(o),this};Cursor$1.prototype.live=function(o){var s=this;if(o!==void 0&&(this.query=o),this._live)return this.refresh(),this;this._live=!0,this._ids={},this._prefetched={},this.res=void 0;var a=_$3.debounce(function(nt){s.exec(function(it,st){it&&console.error(it),s.res=st,s.db.emit("liveQueryUpdate",s.query),typeof nt=="function"&&nt()})},s.db.options.liveQueryDebounce||LIVE_QUERY_DEBOUNCE);a();function et(nt){var it=!1;nt.forEach(function(st){var ot=s._count||s._ids[st._id]||document$2.match(st,s.query);ot&&(s._prefetched[st._id]=st),it=it||ot}),it&&a()}function tt(nt){nt.some(function(it){return s._ids[it]})&&a()}function rt(){s._live=!1,delete s.refresh,delete s.stop,this.db.removeListener("updated",et),this.db.removeListener("inserted",et),this.db.removeListener("removed",tt),this.db.removeListener("reload",a),this.db.removeListener("liveQueryRefresh",a)}return this.db.on("updated",et),this.db.on("inserted",et),this.db.on("removed",tt),this.db.on("reload",a),this.db.on("liveQueryRefresh",a),s.refresh=a,s.stop=rt,this};Cursor$1.prototype.stream=function(o,s){this._ondata=o,this.exec(s)};Cursor$1.getMatchesStream=function(o,s,tt,et){var tt=tt||{},rt=new events$2.EventEmitter;return rt._closed=!1,rt._waiting=null,rt.close=function(){rt._closed=!0},setTimeout(function(nt){try{var it=Cursor$1.getIdsForQuery(o,s,tt);if(it)return rt.emit("ids",it)}catch(st){return rt.emit("error",st)}o._pipe.queue.length==0&&_$3.some(o.indexes,function(st){return!st.ready})&&o._pipe.push(function(st){setTimeout(st,o.options.indexBuildingDebounce||INDEX_BUILDING_DEBOUNCE)},_$3.noop),o._pipe.push(o.buildIndexes.bind(o),function(){it=Cursor$1.getIdsForQuery(o,s,tt),it?rt.emit("ids",it):rt.emit("error",new Error("getIdsForQuery returned null after index building"))})},function(){}),rt.on("ids",rt.trigger=function(nt){if(rt._waiting=nt.length,!nt.length)return setTimeout(function(){rt.emit("ready")});nt.forEach(function(it,st){o._retrQueue.push(function(ot){Cursor$1.retriever({stream:rt,id:it,idx:st,db:o,prefetched:et&&et[it]},function(){--rt._waiting==0&&rt.emit("ready"),ot()})})})}),rt};Cursor$1.retriever=function(o,s){var a=o.db._retrQueue._locked,et=o.db._retrQueue._locks;if(o.stream._closed)return s();if(o.prefetched)return setTimeout(function(){return o.stream.emit("data",{id:o.id,idx:o.idx,val:function(){return o.prefetched},lock:_$3.noop,unlock:_$3.noop}),s()});o.db.store.get(o.id,function(tt,rt){if(o.stream._closed||tt&&tt.type=="NotFoundError")return s();tt?o.stream.emit("error",tt):o.stream.emit("data",{id:o.id,idx:o.idx,val:function(){return new o.db(rt)},lock:function(){return et.hasOwnProperty(o.id)||(et[o.id]=0),et[o.id]++,a[o.id]=a[o.id]||this.val()},unlock:function(){et[o.id]--,et[o.id]||(delete et[o.id],delete a[o.id])}}),s()})};Cursor$1.getIdsForQuery=function(o,s,a){var et=o,tt=!0,rt=!0,nt=null,it=[],st=function(ct){nt=nt?_$3.intersection(nt,ct):_$3.uniq(ct)},ot=function(ct){it=_$3.union(it,ct)},at=_$3.first(_$3.keys(a));rt=at?!!o.indexes[at]&&_$3.keys(a).length==1:!0,a&&_$3.each(a,function(ct,ht){lt(ht,s[ht]),rt&&ht==at&&ct==-1&&nt&&(nt=nt.reverse())}),_$3.each(s,function(ct,ht){a&&a[ht]||lt(ht,ct)});function lt(ct,ht){if(ct[0]=="$"){if(ct=="$and"||ct=="$or"){if(!util$6.isArray(ht))throw ct+" operator used without an array";var ft=ht.map(function(mt){return Cursor$1.getIdsForQuery(o,mt)}),dt=ct=="$and"?_$3.intersection:_$3.union;ft.indexOf(null)>-1?tt=!1:st(dt.apply(_$3,ft))}if(ct=="$not"){var ft=Cursor$1.getIdsForQuery(o,ht);ft===null?tt=!1:ot(ft)}return}o.indexes[ct]&&o.indexes[ct].ready||(tt=!1,o.options.autoIndexing&&o.ensureIndex({fieldName:ct}));var pt=o.indexes[ct];if(pt&&(tt||!o.options.autoIndexing)){if(ht===void 0)return st(pt.getAll());if(document$2.isPrimitiveType(ht)||typeof ht=="object"&&!_$3.keys(ht).some(function(mt){return document$2.comparators[mt]}))return st(pt.getMatching(ht));if(ht&&ht.hasOwnProperty("$ne")&&ot(pt.getMatching(ht.$ne)),ht&&ht.hasOwnProperty("$in")&&st(pt.getMatching(ht.$in)),ht&&ht.hasOwnProperty("$nin")&&ot(pt.getMatching(ht.$nin)),(ht&&ht.hasOwnProperty("$lt")||ht.hasOwnProperty("$lte")||ht.hasOwnProperty("$gt")||ht.hasOwnProperty("$gte"))&&st(pt.getBetweenBounds(ht)),ht&&ht.hasOwnProperty("$exists")&&ht.$exists==!0&&st(pt.getAll(function(mt){return mt.key!==void 0})),ht&&ht.hasOwnProperty("$exists")&&ht.$exists==!1&&st(pt.getAll(function(mt){return mt.key===void 0})),ht&&ht.hasOwnProperty("$regex")){var gt=ht.$regex;st(pt.getAll(function(mt){return mt.key&&mt.key.match(gt)}))}}}return!tt&&o.options.autoIndexing?null:!nt&&!o.indexes._id.ready?!1:(nt=_$3.difference(nt||et.getAllData(),it),nt._indexed=tt,nt._sorted=rt,nt)};Cursor$1.getSorter=function(o){var s=_$3.map(o,function(a,et){return{key:et,direction:a}});return function(a,et){var tt,rt,nt;for(nt=0;nt<s.length;nt++)if(tt=s[nt],rt=tt.direction*document$2.compareThings(document$2.getDotValue(a,tt.key),document$2.getDotValue(et,tt.key)),rt!==0)return rt;return 0}};var cursor$1=Cursor$1,immutable=extend$3,hasOwnProperty$4=Object.prototype.hasOwnProperty;function extend$3(){for(var o={},s=0;s<arguments.length;s++){var a=arguments[s];for(var et in a)hasOwnProperty$4.call(a,et)&&(o[et]=a[et])}return o}var deferredLeveldown={exports:{}},abstractLeveldown$7={},dist={};(function(o){Object.defineProperties(o,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var s={},a={};a.byteLength=at,a.toByteArray=ct,a.fromByteArray=dt;for(var et=[],tt=[],rt=typeof Uint8Array<"u"?Uint8Array:Array,nt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",it=0,st=nt.length;it<st;++it)et[it]=nt[it],tt[nt.charCodeAt(it)]=it;tt[45]=62,tt[95]=63;function ot(mt){var yt=mt.length;if(yt%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var vt=mt.indexOf("=");vt===-1&&(vt=yt);var Et=vt===yt?0:4-vt%4;return[vt,Et]}function at(mt){var yt=ot(mt),vt=yt[0],Et=yt[1];return(vt+Et)*3/4-Et}function lt(mt,yt,vt){return(yt+vt)*3/4-vt}function ct(mt){var yt,vt=ot(mt),Et=vt[0],xt=vt[1],wt=new rt(lt(mt,Et,xt)),Rt=0,Ct=xt>0?Et-4:Et,Ft;for(Ft=0;Ft<Ct;Ft+=4)yt=tt[mt.charCodeAt(Ft)]<<18|tt[mt.charCodeAt(Ft+1)]<<12|tt[mt.charCodeAt(Ft+2)]<<6|tt[mt.charCodeAt(Ft+3)],wt[Rt++]=yt>>16&255,wt[Rt++]=yt>>8&255,wt[Rt++]=yt&255;return xt===2&&(yt=tt[mt.charCodeAt(Ft)]<<2|tt[mt.charCodeAt(Ft+1)]>>4,wt[Rt++]=yt&255),xt===1&&(yt=tt[mt.charCodeAt(Ft)]<<10|tt[mt.charCodeAt(Ft+1)]<<4|tt[mt.charCodeAt(Ft+2)]>>2,wt[Rt++]=yt>>8&255,wt[Rt++]=yt&255),wt}function ht(mt){return et[mt>>18&63]+et[mt>>12&63]+et[mt>>6&63]+et[mt&63]}function ft(mt,yt,vt){for(var Et,xt=[],wt=yt;wt<vt;wt+=3)Et=(mt[wt]<<16&16711680)+(mt[wt+1]<<8&65280)+(mt[wt+2]&255),xt.push(ht(Et));return xt.join("")}function dt(mt){for(var yt,vt=mt.length,Et=vt%3,xt=[],wt=16383,Rt=0,Ct=vt-Et;Rt<Ct;Rt+=wt)xt.push(ft(mt,Rt,Rt+wt>Ct?Ct:Rt+wt));return Et===1?(yt=mt[vt-1],xt.push(et[yt>>2]+et[yt<<4&63]+"==")):Et===2&&(yt=(mt[vt-2]<<8)+mt[vt-1],xt.push(et[yt>>10]+et[yt>>4&63]+et[yt<<2&63]+"=")),xt.join("")}var pt={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */pt.read=function(mt,yt,vt,Et,xt){var wt,Rt,Ct=xt*8-Et-1,Ft=(1<<Ct)-1,zt=Ft>>1,Nt=-7,Kt=vt?xt-1:0,Yt=vt?-1:1,Bt=mt[yt+Kt];for(Kt+=Yt,wt=Bt&(1<<-Nt)-1,Bt>>=-Nt,Nt+=Ct;Nt>0;wt=wt*256+mt[yt+Kt],Kt+=Yt,Nt-=8);for(Rt=wt&(1<<-Nt)-1,wt>>=-Nt,Nt+=Et;Nt>0;Rt=Rt*256+mt[yt+Kt],Kt+=Yt,Nt-=8);if(wt===0)wt=1-zt;else{if(wt===Ft)return Rt?NaN:(Bt?-1:1)*(1/0);Rt=Rt+Math.pow(2,Et),wt=wt-zt}return(Bt?-1:1)*Rt*Math.pow(2,wt-Et)},pt.write=function(mt,yt,vt,Et,xt,wt){var Rt,Ct,Ft,zt=wt*8-xt-1,Nt=(1<<zt)-1,Kt=Nt>>1,Yt=xt===23?Math.pow(2,-24)-Math.pow(2,-77):0,Bt=Et?0:wt-1,Pt=Et?1:-1,Dt=yt<0||yt===0&&1/yt<0?1:0;for(yt=Math.abs(yt),isNaN(yt)||yt===1/0?(Ct=isNaN(yt)?1:0,Rt=Nt):(Rt=Math.floor(Math.log(yt)/Math.LN2),yt*(Ft=Math.pow(2,-Rt))<1&&(Rt--,Ft*=2),Rt+Kt>=1?yt+=Yt/Ft:yt+=Yt*Math.pow(2,1-Kt),yt*Ft>=2&&(Rt++,Ft/=2),Rt+Kt>=Nt?(Ct=0,Rt=Nt):Rt+Kt>=1?(Ct=(yt*Ft-1)*Math.pow(2,xt),Rt=Rt+Kt):(Ct=yt*Math.pow(2,Kt-1)*Math.pow(2,xt),Rt=0));xt>=8;mt[vt+Bt]=Ct&255,Bt+=Pt,Ct/=256,xt-=8);for(Rt=Rt<<xt|Ct,zt+=xt;zt>0;mt[vt+Bt]=Rt&255,Bt+=Pt,Rt/=256,zt-=8);mt[vt+Bt-Pt]|=Dt*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(mt){const yt=a,vt=pt,Et=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;mt.Buffer=Nt,mt.SlowBuffer=Ht,mt.INSPECT_MAX_BYTES=50;const xt=2147483647;mt.kMaxLength=xt;const{Uint8Array:wt,ArrayBuffer:Rt,SharedArrayBuffer:Ct}=globalThis;Nt.TYPED_ARRAY_SUPPORT=Ft(),!Nt.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function Ft(){try{const Zt=new wt(1),Ot={foo:function(){return 42}};return Object.setPrototypeOf(Ot,wt.prototype),Object.setPrototypeOf(Zt,Ot),Zt.foo()===42}catch{return!1}}Object.defineProperty(Nt.prototype,"parent",{enumerable:!0,get:function(){if(Nt.isBuffer(this))return this.buffer}}),Object.defineProperty(Nt.prototype,"offset",{enumerable:!0,get:function(){if(Nt.isBuffer(this))return this.byteOffset}});function zt(Zt){if(Zt>xt)throw new RangeError('The value "'+Zt+'" is invalid for option "size"');const Ot=new wt(Zt);return Object.setPrototypeOf(Ot,Nt.prototype),Ot}function Nt(Zt,Ot,Vt){if(typeof Zt=="number"){if(typeof Ot=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return Pt(Zt)}return Kt(Zt,Ot,Vt)}Nt.poolSize=8192;function Kt(Zt,Ot,Vt){if(typeof Zt=="string")return Dt(Zt,Ot);if(Rt.isView(Zt))return St(Zt);if(Zt==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Zt);if(Zr(Zt,Rt)||Zt&&Zr(Zt.buffer,Rt)||typeof Ct<"u"&&(Zr(Zt,Ct)||Zt&&Zr(Zt.buffer,Ct)))return Mt(Zt,Ot,Vt);if(typeof Zt=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const rr=Zt.valueOf&&Zt.valueOf();if(rr!=null&&rr!==Zt)return Nt.from(rr,Ot,Vt);const ar=jt(Zt);if(ar)return ar;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof Zt[Symbol.toPrimitive]=="function")return Nt.from(Zt[Symbol.toPrimitive]("string"),Ot,Vt);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Zt)}Nt.from=function(Zt,Ot,Vt){return Kt(Zt,Ot,Vt)},Object.setPrototypeOf(Nt.prototype,wt.prototype),Object.setPrototypeOf(Nt,wt);function Yt(Zt){if(typeof Zt!="number")throw new TypeError('"size" argument must be of type number');if(Zt<0)throw new RangeError('The value "'+Zt+'" is invalid for option "size"')}function Bt(Zt,Ot,Vt){return Yt(Zt),Zt<=0?zt(Zt):Ot!==void 0?typeof Vt=="string"?zt(Zt).fill(Ot,Vt):zt(Zt).fill(Ot):zt(Zt)}Nt.alloc=function(Zt,Ot,Vt){return Bt(Zt,Ot,Vt)};function Pt(Zt){return Yt(Zt),zt(Zt<0?0:Gt(Zt)|0)}Nt.allocUnsafe=function(Zt){return Pt(Zt)},Nt.allocUnsafeSlow=function(Zt){return Pt(Zt)};function Dt(Zt,Ot){if((typeof Ot!="string"||Ot==="")&&(Ot="utf8"),!Nt.isEncoding(Ot))throw new TypeError("Unknown encoding: "+Ot);const Vt=At(Zt,Ot)|0;let rr=zt(Vt);const ar=rr.write(Zt,Ot);return ar!==Vt&&(rr=rr.slice(0,ar)),rr}function Tt(Zt){const Ot=Zt.length<0?0:Gt(Zt.length)|0,Vt=zt(Ot);for(let rr=0;rr<Ot;rr+=1)Vt[rr]=Zt[rr]&255;return Vt}function St(Zt){if(Zr(Zt,wt)){const Ot=new wt(Zt);return Mt(Ot.buffer,Ot.byteOffset,Ot.byteLength)}return Tt(Zt)}function Mt(Zt,Ot,Vt){if(Ot<0||Zt.byteLength<Ot)throw new RangeError('"offset" is outside of buffer bounds');if(Zt.byteLength<Ot+(Vt||0))throw new RangeError('"length" is outside of buffer bounds');let rr;return Ot===void 0&&Vt===void 0?rr=new wt(Zt):Vt===void 0?rr=new wt(Zt,Ot):rr=new wt(Zt,Ot,Vt),Object.setPrototypeOf(rr,Nt.prototype),rr}function jt(Zt){if(Nt.isBuffer(Zt)){const Ot=Gt(Zt.length)|0,Vt=zt(Ot);return Vt.length===0||Zt.copy(Vt,0,0,Ot),Vt}if(Zt.length!==void 0)return typeof Zt.length!="number"||bn(Zt.length)?zt(0):Tt(Zt);if(Zt.type==="Buffer"&&Array.isArray(Zt.data))return Tt(Zt.data)}function Gt(Zt){if(Zt>=xt)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+xt.toString(16)+" bytes");return Zt|0}function Ht(Zt){return+Zt!=Zt&&(Zt=0),Nt.alloc(+Zt)}Nt.isBuffer=function(Ot){return Ot!=null&&Ot._isBuffer===!0&&Ot!==Nt.prototype},Nt.compare=function(Ot,Vt){if(Zr(Ot,wt)&&(Ot=Nt.from(Ot,Ot.offset,Ot.byteLength)),Zr(Vt,wt)&&(Vt=Nt.from(Vt,Vt.offset,Vt.byteLength)),!Nt.isBuffer(Ot)||!Nt.isBuffer(Vt))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(Ot===Vt)return 0;let rr=Ot.length,ar=Vt.length;for(let hr=0,yr=Math.min(rr,ar);hr<yr;++hr)if(Ot[hr]!==Vt[hr]){rr=Ot[hr],ar=Vt[hr];break}return rr<ar?-1:ar<rr?1:0},Nt.isEncoding=function(Ot){switch(String(Ot).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Nt.concat=function(Ot,Vt){if(!Array.isArray(Ot))throw new TypeError('"list" argument must be an Array of Buffers');if(Ot.length===0)return Nt.alloc(0);let rr;if(Vt===void 0)for(Vt=0,rr=0;rr<Ot.length;++rr)Vt+=Ot[rr].length;const ar=Nt.allocUnsafe(Vt);let hr=0;for(rr=0;rr<Ot.length;++rr){let yr=Ot[rr];if(Zr(yr,wt))hr+yr.length>ar.length?(Nt.isBuffer(yr)||(yr=Nt.from(yr)),yr.copy(ar,hr)):wt.prototype.set.call(ar,yr,hr);else if(Nt.isBuffer(yr))yr.copy(ar,hr);else throw new TypeError('"list" argument must be an Array of Buffers');hr+=yr.length}return ar};function At(Zt,Ot){if(Nt.isBuffer(Zt))return Zt.length;if(Rt.isView(Zt)||Zr(Zt,Rt))return Zt.byteLength;if(typeof Zt!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof Zt);const Vt=Zt.length,rr=arguments.length>2&&arguments[2]===!0;if(!rr&&Vt===0)return 0;let ar=!1;for(;;)switch(Ot){case"ascii":case"latin1":case"binary":return Vt;case"utf8":case"utf-8":return Xr(Zt).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Vt*2;case"hex":return Vt>>>1;case"base64":return $n(Zt).length;default:if(ar)return rr?-1:Xr(Zt).length;Ot=(""+Ot).toLowerCase(),ar=!0}}Nt.byteLength=At;function $t(Zt,Ot,Vt){let rr=!1;if((Ot===void 0||Ot<0)&&(Ot=0),Ot>this.length||((Vt===void 0||Vt>this.length)&&(Vt=this.length),Vt<=0)||(Vt>>>=0,Ot>>>=0,Vt<=Ot))return"";for(Zt||(Zt="utf8");;)switch(Zt){case"hex":return Cr(this,Ot,Vt);case"utf8":case"utf-8":return lr(this,Ot,Vt);case"ascii":return wr(this,Ot,Vt);case"latin1":case"binary":return cr(this,Ot,Vt);case"base64":return er(this,Ot,Vt);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _r(this,Ot,Vt);default:if(rr)throw new TypeError("Unknown encoding: "+Zt);Zt=(Zt+"").toLowerCase(),rr=!0}}Nt.prototype._isBuffer=!0;function kt(Zt,Ot,Vt){const rr=Zt[Ot];Zt[Ot]=Zt[Vt],Zt[Vt]=rr}Nt.prototype.swap16=function(){const Ot=this.length;if(Ot%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let Vt=0;Vt<Ot;Vt+=2)kt(this,Vt,Vt+1);return this},Nt.prototype.swap32=function(){const Ot=this.length;if(Ot%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let Vt=0;Vt<Ot;Vt+=4)kt(this,Vt,Vt+3),kt(this,Vt+1,Vt+2);return this},Nt.prototype.swap64=function(){const Ot=this.length;if(Ot%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let Vt=0;Vt<Ot;Vt+=8)kt(this,Vt,Vt+7),kt(this,Vt+1,Vt+6),kt(this,Vt+2,Vt+5),kt(this,Vt+3,Vt+4);return this},Nt.prototype.toString=function(){const Ot=this.length;return Ot===0?"":arguments.length===0?lr(this,0,Ot):$t.apply(this,arguments)},Nt.prototype.toLocaleString=Nt.prototype.toString,Nt.prototype.equals=function(Ot){if(!Nt.isBuffer(Ot))throw new TypeError("Argument must be a Buffer");return this===Ot?!0:Nt.compare(this,Ot)===0},Nt.prototype.inspect=function(){let Ot="";const Vt=mt.INSPECT_MAX_BYTES;return Ot=this.toString("hex",0,Vt).replace(/(.{2})/g,"$1 ").trim(),this.length>Vt&&(Ot+=" ... "),"<Buffer "+Ot+">"},Et&&(Nt.prototype[Et]=Nt.prototype.inspect),Nt.prototype.compare=function(Ot,Vt,rr,ar,hr){if(Zr(Ot,wt)&&(Ot=Nt.from(Ot,Ot.offset,Ot.byteLength)),!Nt.isBuffer(Ot))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof Ot);if(Vt===void 0&&(Vt=0),rr===void 0&&(rr=Ot?Ot.length:0),ar===void 0&&(ar=0),hr===void 0&&(hr=this.length),Vt<0||rr>Ot.length||ar<0||hr>this.length)throw new RangeError("out of range index");if(ar>=hr&&Vt>=rr)return 0;if(ar>=hr)return-1;if(Vt>=rr)return 1;if(Vt>>>=0,rr>>>=0,ar>>>=0,hr>>>=0,this===Ot)return 0;let yr=hr-ar,Br=rr-Vt;const Lr=Math.min(yr,Br),Vr=this.slice(ar,hr),Hr=Ot.slice(Vt,rr);for(let Ur=0;Ur<Lr;++Ur)if(Vr[Ur]!==Hr[Ur]){yr=Vr[Ur],Br=Hr[Ur];break}return yr<Br?-1:Br<yr?1:0};function Lt(Zt,Ot,Vt,rr,ar){if(Zt.length===0)return-1;if(typeof Vt=="string"?(rr=Vt,Vt=0):Vt>2147483647?Vt=2147483647:Vt<-2147483648&&(Vt=-2147483648),Vt=+Vt,bn(Vt)&&(Vt=ar?0:Zt.length-1),Vt<0&&(Vt=Zt.length+Vt),Vt>=Zt.length){if(ar)return-1;Vt=Zt.length-1}else if(Vt<0)if(ar)Vt=0;else return-1;if(typeof Ot=="string"&&(Ot=Nt.from(Ot,rr)),Nt.isBuffer(Ot))return Ot.length===0?-1:bt(Zt,Ot,Vt,rr,ar);if(typeof Ot=="number")return Ot=Ot&255,typeof wt.prototype.indexOf=="function"?ar?wt.prototype.indexOf.call(Zt,Ot,Vt):wt.prototype.lastIndexOf.call(Zt,Ot,Vt):bt(Zt,[Ot],Vt,rr,ar);throw new TypeError("val must be string, number or Buffer")}function bt(Zt,Ot,Vt,rr,ar){let hr=1,yr=Zt.length,Br=Ot.length;if(rr!==void 0&&(rr=String(rr).toLowerCase(),rr==="ucs2"||rr==="ucs-2"||rr==="utf16le"||rr==="utf-16le")){if(Zt.length<2||Ot.length<2)return-1;hr=2,yr/=2,Br/=2,Vt/=2}function Lr(Hr,Ur){return hr===1?Hr[Ur]:Hr.readUInt16BE(Ur*hr)}let Vr;if(ar){let Hr=-1;for(Vr=Vt;Vr<yr;Vr++)if(Lr(Zt,Vr)===Lr(Ot,Hr===-1?0:Vr-Hr)){if(Hr===-1&&(Hr=Vr),Vr-Hr+1===Br)return Hr*hr}else Hr!==-1&&(Vr-=Vr-Hr),Hr=-1}else for(Vt+Br>yr&&(Vt=yr-Br),Vr=Vt;Vr>=0;Vr--){let Hr=!0;for(let Ur=0;Ur<Br;Ur++)if(Lr(Zt,Vr+Ur)!==Lr(Ot,Ur)){Hr=!1;break}if(Hr)return Vr}return-1}Nt.prototype.includes=function(Ot,Vt,rr){return this.indexOf(Ot,Vt,rr)!==-1},Nt.prototype.indexOf=function(Ot,Vt,rr){return Lt(this,Ot,Vt,rr,!0)},Nt.prototype.lastIndexOf=function(Ot,Vt,rr){return Lt(this,Ot,Vt,rr,!1)};function It(Zt,Ot,Vt,rr){Vt=Number(Vt)||0;const ar=Zt.length-Vt;rr?(rr=Number(rr),rr>ar&&(rr=ar)):rr=ar;const hr=Ot.length;rr>hr/2&&(rr=hr/2);let yr;for(yr=0;yr<rr;++yr){const Br=parseInt(Ot.substr(yr*2,2),16);if(bn(Br))return yr;Zt[Vt+yr]=Br}return yr}function Ut(Zt,Ot,Vt,rr){return hn(Xr(Ot,Zt.length-Vt),Zt,Vt,rr)}function Wt(Zt,Ot,Vt,rr){return hn(an(Ot),Zt,Vt,rr)}function Xt(Zt,Ot,Vt,rr){return hn($n(Ot),Zt,Vt,rr)}function Qt(Zt,Ot,Vt,rr){return hn(Jn(Ot,Zt.length-Vt),Zt,Vt,rr)}Nt.prototype.write=function(Ot,Vt,rr,ar){if(Vt===void 0)ar="utf8",rr=this.length,Vt=0;else if(rr===void 0&&typeof Vt=="string")ar=Vt,rr=this.length,Vt=0;else if(isFinite(Vt))Vt=Vt>>>0,isFinite(rr)?(rr=rr>>>0,ar===void 0&&(ar="utf8")):(ar=rr,rr=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const hr=this.length-Vt;if((rr===void 0||rr>hr)&&(rr=hr),Ot.length>0&&(rr<0||Vt<0)||Vt>this.length)throw new RangeError("Attempt to write outside buffer bounds");ar||(ar="utf8");let yr=!1;for(;;)switch(ar){case"hex":return It(this,Ot,Vt,rr);case"utf8":case"utf-8":return Ut(this,Ot,Vt,rr);case"ascii":case"latin1":case"binary":return Wt(this,Ot,Vt,rr);case"base64":return Xt(this,Ot,Vt,rr);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Qt(this,Ot,Vt,rr);default:if(yr)throw new TypeError("Unknown encoding: "+ar);ar=(""+ar).toLowerCase(),yr=!0}},Nt.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function er(Zt,Ot,Vt){return Ot===0&&Vt===Zt.length?yt.fromByteArray(Zt):yt.fromByteArray(Zt.slice(Ot,Vt))}function lr(Zt,Ot,Vt){Vt=Math.min(Zt.length,Vt);const rr=[];let ar=Ot;for(;ar<Vt;){const hr=Zt[ar];let yr=null,Br=hr>239?4:hr>223?3:hr>191?2:1;if(ar+Br<=Vt){let Lr,Vr,Hr,Ur;switch(Br){case 1:hr<128&&(yr=hr);break;case 2:Lr=Zt[ar+1],(Lr&192)===128&&(Ur=(hr&31)<<6|Lr&63,Ur>127&&(yr=Ur));break;case 3:Lr=Zt[ar+1],Vr=Zt[ar+2],(Lr&192)===128&&(Vr&192)===128&&(Ur=(hr&15)<<12|(Lr&63)<<6|Vr&63,Ur>2047&&(Ur<55296||Ur>57343)&&(yr=Ur));break;case 4:Lr=Zt[ar+1],Vr=Zt[ar+2],Hr=Zt[ar+3],(Lr&192)===128&&(Vr&192)===128&&(Hr&192)===128&&(Ur=(hr&15)<<18|(Lr&63)<<12|(Vr&63)<<6|Hr&63,Ur>65535&&Ur<1114112&&(yr=Ur))}}yr===null?(yr=65533,Br=1):yr>65535&&(yr-=65536,rr.push(yr>>>10&1023|55296),yr=56320|yr&1023),rr.push(yr),ar+=Br}return gr(rr)}const pr=4096;function gr(Zt){const Ot=Zt.length;if(Ot<=pr)return String.fromCharCode.apply(String,Zt);let Vt="",rr=0;for(;rr<Ot;)Vt+=String.fromCharCode.apply(String,Zt.slice(rr,rr+=pr));return Vt}function wr(Zt,Ot,Vt){let rr="";Vt=Math.min(Zt.length,Vt);for(let ar=Ot;ar<Vt;++ar)rr+=String.fromCharCode(Zt[ar]&127);return rr}function cr(Zt,Ot,Vt){let rr="";Vt=Math.min(Zt.length,Vt);for(let ar=Ot;ar<Vt;++ar)rr+=String.fromCharCode(Zt[ar]);return rr}function Cr(Zt,Ot,Vt){const rr=Zt.length;(!Ot||Ot<0)&&(Ot=0),(!Vt||Vt<0||Vt>rr)&&(Vt=rr);let ar="";for(let hr=Ot;hr<Vt;++hr)ar+=_i[Zt[hr]];return ar}function _r(Zt,Ot,Vt){const rr=Zt.slice(Ot,Vt);let ar="";for(let hr=0;hr<rr.length-1;hr+=2)ar+=String.fromCharCode(rr[hr]+rr[hr+1]*256);return ar}Nt.prototype.slice=function(Ot,Vt){const rr=this.length;Ot=~~Ot,Vt=Vt===void 0?rr:~~Vt,Ot<0?(Ot+=rr,Ot<0&&(Ot=0)):Ot>rr&&(Ot=rr),Vt<0?(Vt+=rr,Vt<0&&(Vt=0)):Vt>rr&&(Vt=rr),Vt<Ot&&(Vt=Ot);const ar=this.subarray(Ot,Vt);return Object.setPrototypeOf(ar,Nt.prototype),ar};function kr(Zt,Ot,Vt){if(Zt%1!==0||Zt<0)throw new RangeError("offset is not uint");if(Zt+Ot>Vt)throw new RangeError("Trying to access beyond buffer length")}Nt.prototype.readUintLE=Nt.prototype.readUIntLE=function(Ot,Vt,rr){Ot=Ot>>>0,Vt=Vt>>>0,rr||kr(Ot,Vt,this.length);let ar=this[Ot],hr=1,yr=0;for(;++yr<Vt&&(hr*=256);)ar+=this[Ot+yr]*hr;return ar},Nt.prototype.readUintBE=Nt.prototype.readUIntBE=function(Ot,Vt,rr){Ot=Ot>>>0,Vt=Vt>>>0,rr||kr(Ot,Vt,this.length);let ar=this[Ot+--Vt],hr=1;for(;Vt>0&&(hr*=256);)ar+=this[Ot+--Vt]*hr;return ar},Nt.prototype.readUint8=Nt.prototype.readUInt8=function(Ot,Vt){return Ot=Ot>>>0,Vt||kr(Ot,1,this.length),this[Ot]},Nt.prototype.readUint16LE=Nt.prototype.readUInt16LE=function(Ot,Vt){return Ot=Ot>>>0,Vt||kr(Ot,2,this.length),this[Ot]|this[Ot+1]<<8},Nt.prototype.readUint16BE=Nt.prototype.readUInt16BE=function(Ot,Vt){return Ot=Ot>>>0,Vt||kr(Ot,2,this.length),this[Ot]<<8|this[Ot+1]},Nt.prototype.readUint32LE=Nt.prototype.readUInt32LE=function(Ot,Vt){return Ot=Ot>>>0,Vt||kr(Ot,4,this.length),(this[Ot]|this[Ot+1]<<8|this[Ot+2]<<16)+this[Ot+3]*16777216},Nt.prototype.readUint32BE=Nt.prototype.readUInt32BE=function(Ot,Vt){return Ot=Ot>>>0,Vt||kr(Ot,4,this.length),this[Ot]*16777216+(this[Ot+1]<<16|this[Ot+2]<<8|this[Ot+3])},Nt.prototype.readBigUInt64LE=tn(function(Ot){Ot=Ot>>>0,Dr(Ot,"offset");const Vt=this[Ot],rr=this[Ot+7];(Vt===void 0||rr===void 0)&&Fr(Ot,this.length-8);const ar=Vt+this[++Ot]*2**8+this[++Ot]*2**16+this[++Ot]*2**24,hr=this[++Ot]+this[++Ot]*2**8+this[++Ot]*2**16+rr*2**24;return BigInt(ar)+(BigInt(hr)<<BigInt(32))}),Nt.prototype.readBigUInt64BE=tn(function(Ot){Ot=Ot>>>0,Dr(Ot,"offset");const Vt=this[Ot],rr=this[Ot+7];(Vt===void 0||rr===void 0)&&Fr(Ot,this.length-8);const ar=Vt*2**24+this[++Ot]*2**16+this[++Ot]*2**8+this[++Ot],hr=this[++Ot]*2**24+this[++Ot]*2**16+this[++Ot]*2**8+rr;return(BigInt(ar)<<BigInt(32))+BigInt(hr)}),Nt.prototype.readIntLE=function(Ot,Vt,rr){Ot=Ot>>>0,Vt=Vt>>>0,rr||kr(Ot,Vt,this.length);let ar=this[Ot],hr=1,yr=0;for(;++yr<Vt&&(hr*=256);)ar+=this[Ot+yr]*hr;return hr*=128,ar>=hr&&(ar-=Math.pow(2,8*Vt)),ar},Nt.prototype.readIntBE=function(Ot,Vt,rr){Ot=Ot>>>0,Vt=Vt>>>0,rr||kr(Ot,Vt,this.length);let ar=Vt,hr=1,yr=this[Ot+--ar];for(;ar>0&&(hr*=256);)yr+=this[Ot+--ar]*hr;return hr*=128,yr>=hr&&(yr-=Math.pow(2,8*Vt)),yr},Nt.prototype.readInt8=function(Ot,Vt){return Ot=Ot>>>0,Vt||kr(Ot,1,this.length),this[Ot]&128?(255-this[Ot]+1)*-1:this[Ot]},Nt.prototype.readInt16LE=function(Ot,Vt){Ot=Ot>>>0,Vt||kr(Ot,2,this.length);const rr=this[Ot]|this[Ot+1]<<8;return rr&32768?rr|4294901760:rr},Nt.prototype.readInt16BE=function(Ot,Vt){Ot=Ot>>>0,Vt||kr(Ot,2,this.length);const rr=this[Ot+1]|this[Ot]<<8;return rr&32768?rr|4294901760:rr},Nt.prototype.readInt32LE=function(Ot,Vt){return Ot=Ot>>>0,Vt||kr(Ot,4,this.length),this[Ot]|this[Ot+1]<<8|this[Ot+2]<<16|this[Ot+3]<<24},Nt.prototype.readInt32BE=function(Ot,Vt){return Ot=Ot>>>0,Vt||kr(Ot,4,this.length),this[Ot]<<24|this[Ot+1]<<16|this[Ot+2]<<8|this[Ot+3]},Nt.prototype.readBigInt64LE=tn(function(Ot){Ot=Ot>>>0,Dr(Ot,"offset");const Vt=this[Ot],rr=this[Ot+7];(Vt===void 0||rr===void 0)&&Fr(Ot,this.length-8);const ar=this[Ot+4]+this[Ot+5]*2**8+this[Ot+6]*2**16+(rr<<24);return(BigInt(ar)<<BigInt(32))+BigInt(Vt+this[++Ot]*2**8+this[++Ot]*2**16+this[++Ot]*2**24)}),Nt.prototype.readBigInt64BE=tn(function(Ot){Ot=Ot>>>0,Dr(Ot,"offset");const Vt=this[Ot],rr=this[Ot+7];(Vt===void 0||rr===void 0)&&Fr(Ot,this.length-8);const ar=(Vt<<24)+this[++Ot]*2**16+this[++Ot]*2**8+this[++Ot];return(BigInt(ar)<<BigInt(32))+BigInt(this[++Ot]*2**24+this[++Ot]*2**16+this[++Ot]*2**8+rr)}),Nt.prototype.readFloatLE=function(Ot,Vt){return Ot=Ot>>>0,Vt||kr(Ot,4,this.length),vt.read(this,Ot,!0,23,4)},Nt.prototype.readFloatBE=function(Ot,Vt){return Ot=Ot>>>0,Vt||kr(Ot,4,this.length),vt.read(this,Ot,!1,23,4)},Nt.prototype.readDoubleLE=function(Ot,Vt){return Ot=Ot>>>0,Vt||kr(Ot,8,this.length),vt.read(this,Ot,!0,52,8)},Nt.prototype.readDoubleBE=function(Ot,Vt){return Ot=Ot>>>0,Vt||kr(Ot,8,this.length),vt.read(this,Ot,!1,52,8)};function Ir(Zt,Ot,Vt,rr,ar,hr){if(!Nt.isBuffer(Zt))throw new TypeError('"buffer" argument must be a Buffer instance');if(Ot>ar||Ot<hr)throw new RangeError('"value" argument is out of bounds');if(Vt+rr>Zt.length)throw new RangeError("Index out of range")}Nt.prototype.writeUintLE=Nt.prototype.writeUIntLE=function(Ot,Vt,rr,ar){if(Ot=+Ot,Vt=Vt>>>0,rr=rr>>>0,!ar){const Br=Math.pow(2,8*rr)-1;Ir(this,Ot,Vt,rr,Br,0)}let hr=1,yr=0;for(this[Vt]=Ot&255;++yr<rr&&(hr*=256);)this[Vt+yr]=Ot/hr&255;return Vt+rr},Nt.prototype.writeUintBE=Nt.prototype.writeUIntBE=function(Ot,Vt,rr,ar){if(Ot=+Ot,Vt=Vt>>>0,rr=rr>>>0,!ar){const Br=Math.pow(2,8*rr)-1;Ir(this,Ot,Vt,rr,Br,0)}let hr=rr-1,yr=1;for(this[Vt+hr]=Ot&255;--hr>=0&&(yr*=256);)this[Vt+hr]=Ot/yr&255;return Vt+rr},Nt.prototype.writeUint8=Nt.prototype.writeUInt8=function(Ot,Vt,rr){return Ot=+Ot,Vt=Vt>>>0,rr||Ir(this,Ot,Vt,1,255,0),this[Vt]=Ot&255,Vt+1},Nt.prototype.writeUint16LE=Nt.prototype.writeUInt16LE=function(Ot,Vt,rr){return Ot=+Ot,Vt=Vt>>>0,rr||Ir(this,Ot,Vt,2,65535,0),this[Vt]=Ot&255,this[Vt+1]=Ot>>>8,Vt+2},Nt.prototype.writeUint16BE=Nt.prototype.writeUInt16BE=function(Ot,Vt,rr){return Ot=+Ot,Vt=Vt>>>0,rr||Ir(this,Ot,Vt,2,65535,0),this[Vt]=Ot>>>8,this[Vt+1]=Ot&255,Vt+2},Nt.prototype.writeUint32LE=Nt.prototype.writeUInt32LE=function(Ot,Vt,rr){return Ot=+Ot,Vt=Vt>>>0,rr||Ir(this,Ot,Vt,4,4294967295,0),this[Vt+3]=Ot>>>24,this[Vt+2]=Ot>>>16,this[Vt+1]=Ot>>>8,this[Vt]=Ot&255,Vt+4},Nt.prototype.writeUint32BE=Nt.prototype.writeUInt32BE=function(Ot,Vt,rr){return Ot=+Ot,Vt=Vt>>>0,rr||Ir(this,Ot,Vt,4,4294967295,0),this[Vt]=Ot>>>24,this[Vt+1]=Ot>>>16,this[Vt+2]=Ot>>>8,this[Vt+3]=Ot&255,Vt+4};function tr(Zt,Ot,Vt,rr,ar){Rr(Ot,rr,ar,Zt,Vt,7);let hr=Number(Ot&BigInt(4294967295));Zt[Vt++]=hr,hr=hr>>8,Zt[Vt++]=hr,hr=hr>>8,Zt[Vt++]=hr,hr=hr>>8,Zt[Vt++]=hr;let yr=Number(Ot>>BigInt(32)&BigInt(4294967295));return Zt[Vt++]=yr,yr=yr>>8,Zt[Vt++]=yr,yr=yr>>8,Zt[Vt++]=yr,yr=yr>>8,Zt[Vt++]=yr,Vt}function sr(Zt,Ot,Vt,rr,ar){Rr(Ot,rr,ar,Zt,Vt,7);let hr=Number(Ot&BigInt(4294967295));Zt[Vt+7]=hr,hr=hr>>8,Zt[Vt+6]=hr,hr=hr>>8,Zt[Vt+5]=hr,hr=hr>>8,Zt[Vt+4]=hr;let yr=Number(Ot>>BigInt(32)&BigInt(4294967295));return Zt[Vt+3]=yr,yr=yr>>8,Zt[Vt+2]=yr,yr=yr>>8,Zt[Vt+1]=yr,yr=yr>>8,Zt[Vt]=yr,Vt+8}Nt.prototype.writeBigUInt64LE=tn(function(Ot,Vt=0){return tr(this,Ot,Vt,BigInt(0),BigInt("0xffffffffffffffff"))}),Nt.prototype.writeBigUInt64BE=tn(function(Ot,Vt=0){return sr(this,Ot,Vt,BigInt(0),BigInt("0xffffffffffffffff"))}),Nt.prototype.writeIntLE=function(Ot,Vt,rr,ar){if(Ot=+Ot,Vt=Vt>>>0,!ar){const Lr=Math.pow(2,8*rr-1);Ir(this,Ot,Vt,rr,Lr-1,-Lr)}let hr=0,yr=1,Br=0;for(this[Vt]=Ot&255;++hr<rr&&(yr*=256);)Ot<0&&Br===0&&this[Vt+hr-1]!==0&&(Br=1),this[Vt+hr]=(Ot/yr>>0)-Br&255;return Vt+rr},Nt.prototype.writeIntBE=function(Ot,Vt,rr,ar){if(Ot=+Ot,Vt=Vt>>>0,!ar){const Lr=Math.pow(2,8*rr-1);Ir(this,Ot,Vt,rr,Lr-1,-Lr)}let hr=rr-1,yr=1,Br=0;for(this[Vt+hr]=Ot&255;--hr>=0&&(yr*=256);)Ot<0&&Br===0&&this[Vt+hr+1]!==0&&(Br=1),this[Vt+hr]=(Ot/yr>>0)-Br&255;return Vt+rr},Nt.prototype.writeInt8=function(Ot,Vt,rr){return Ot=+Ot,Vt=Vt>>>0,rr||Ir(this,Ot,Vt,1,127,-128),Ot<0&&(Ot=255+Ot+1),this[Vt]=Ot&255,Vt+1},Nt.prototype.writeInt16LE=function(Ot,Vt,rr){return Ot=+Ot,Vt=Vt>>>0,rr||Ir(this,Ot,Vt,2,32767,-32768),this[Vt]=Ot&255,this[Vt+1]=Ot>>>8,Vt+2},Nt.prototype.writeInt16BE=function(Ot,Vt,rr){return Ot=+Ot,Vt=Vt>>>0,rr||Ir(this,Ot,Vt,2,32767,-32768),this[Vt]=Ot>>>8,this[Vt+1]=Ot&255,Vt+2},Nt.prototype.writeInt32LE=function(Ot,Vt,rr){return Ot=+Ot,Vt=Vt>>>0,rr||Ir(this,Ot,Vt,4,2147483647,-2147483648),this[Vt]=Ot&255,this[Vt+1]=Ot>>>8,this[Vt+2]=Ot>>>16,this[Vt+3]=Ot>>>24,Vt+4},Nt.prototype.writeInt32BE=function(Ot,Vt,rr){return Ot=+Ot,Vt=Vt>>>0,rr||Ir(this,Ot,Vt,4,2147483647,-2147483648),Ot<0&&(Ot=4294967295+Ot+1),this[Vt]=Ot>>>24,this[Vt+1]=Ot>>>16,this[Vt+2]=Ot>>>8,this[Vt+3]=Ot&255,Vt+4},Nt.prototype.writeBigInt64LE=tn(function(Ot,Vt=0){return tr(this,Ot,Vt,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),Nt.prototype.writeBigInt64BE=tn(function(Ot,Vt=0){return sr(this,Ot,Vt,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function vr(Zt,Ot,Vt,rr,ar,hr){if(Vt+rr>Zt.length)throw new RangeError("Index out of range");if(Vt<0)throw new RangeError("Index out of range")}function xr(Zt,Ot,Vt,rr,ar){return Ot=+Ot,Vt=Vt>>>0,ar||vr(Zt,Ot,Vt,4),vt.write(Zt,Ot,Vt,rr,23,4),Vt+4}Nt.prototype.writeFloatLE=function(Ot,Vt,rr){return xr(this,Ot,Vt,!0,rr)},Nt.prototype.writeFloatBE=function(Ot,Vt,rr){return xr(this,Ot,Vt,!1,rr)};function Er(Zt,Ot,Vt,rr,ar){return Ot=+Ot,Vt=Vt>>>0,ar||vr(Zt,Ot,Vt,8),vt.write(Zt,Ot,Vt,rr,52,8),Vt+8}Nt.prototype.writeDoubleLE=function(Ot,Vt,rr){return Er(this,Ot,Vt,!0,rr)},Nt.prototype.writeDoubleBE=function(Ot,Vt,rr){return Er(this,Ot,Vt,!1,rr)},Nt.prototype.copy=function(Ot,Vt,rr,ar){if(!Nt.isBuffer(Ot))throw new TypeError("argument should be a Buffer");if(rr||(rr=0),!ar&&ar!==0&&(ar=this.length),Vt>=Ot.length&&(Vt=Ot.length),Vt||(Vt=0),ar>0&&ar<rr&&(ar=rr),ar===rr||Ot.length===0||this.length===0)return 0;if(Vt<0)throw new RangeError("targetStart out of bounds");if(rr<0||rr>=this.length)throw new RangeError("Index out of range");if(ar<0)throw new RangeError("sourceEnd out of bounds");ar>this.length&&(ar=this.length),Ot.length-Vt<ar-rr&&(ar=Ot.length-Vt+rr);const hr=ar-rr;return this===Ot&&typeof wt.prototype.copyWithin=="function"?this.copyWithin(Vt,rr,ar):wt.prototype.set.call(Ot,this.subarray(rr,ar),Vt),hr},Nt.prototype.fill=function(Ot,Vt,rr,ar){if(typeof Ot=="string"){if(typeof Vt=="string"?(ar=Vt,Vt=0,rr=this.length):typeof rr=="string"&&(ar=rr,rr=this.length),ar!==void 0&&typeof ar!="string")throw new TypeError("encoding must be a string");if(typeof ar=="string"&&!Nt.isEncoding(ar))throw new TypeError("Unknown encoding: "+ar);if(Ot.length===1){const yr=Ot.charCodeAt(0);(ar==="utf8"&&yr<128||ar==="latin1")&&(Ot=yr)}}else typeof Ot=="number"?Ot=Ot&255:typeof Ot=="boolean"&&(Ot=Number(Ot));if(Vt<0||this.length<Vt||this.length<rr)throw new RangeError("Out of range index");if(rr<=Vt)return this;Vt=Vt>>>0,rr=rr===void 0?this.length:rr>>>0,Ot||(Ot=0);let hr;if(typeof Ot=="number")for(hr=Vt;hr<rr;++hr)this[hr]=Ot;else{const yr=Nt.isBuffer(Ot)?Ot:Nt.from(Ot,ar),Br=yr.length;if(Br===0)throw new TypeError('The value "'+Ot+'" is invalid for argument "value"');for(hr=0;hr<rr-Vt;++hr)this[hr+Vt]=yr[hr%Br]}return this};const Sr={};function $r(Zt,Ot,Vt){Sr[Zt]=class extends Vt{constructor(){super(),Object.defineProperty(this,"message",{value:Ot.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${Zt}]`,this.stack,delete this.name}get code(){return Zt}set code(ar){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:ar,writable:!0})}toString(){return`${this.name} [${Zt}]: ${this.message}`}}}$r("ERR_BUFFER_OUT_OF_BOUNDS",function(Zt){return Zt?`${Zt} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),$r("ERR_INVALID_ARG_TYPE",function(Zt,Ot){return`The "${Zt}" argument must be of type number. Received type ${typeof Ot}`},TypeError),$r("ERR_OUT_OF_RANGE",function(Zt,Ot,Vt){let rr=`The value of "${Zt}" is out of range.`,ar=Vt;return Number.isInteger(Vt)&&Math.abs(Vt)>2**32?ar=Or(String(Vt)):typeof Vt=="bigint"&&(ar=String(Vt),(Vt>BigInt(2)**BigInt(32)||Vt<-(BigInt(2)**BigInt(32)))&&(ar=Or(ar)),ar+="n"),rr+=` It must be ${Ot}. Received ${ar}`,rr},RangeError);function Or(Zt){let Ot="",Vt=Zt.length;const rr=Zt[0]==="-"?1:0;for(;Vt>=rr+4;Vt-=3)Ot=`_${Zt.slice(Vt-3,Vt)}${Ot}`;return`${Zt.slice(0,Vt)}${Ot}`}function Nr(Zt,Ot,Vt){Dr(Ot,"offset"),(Zt[Ot]===void 0||Zt[Ot+Vt]===void 0)&&Fr(Ot,Zt.length-(Vt+1))}function Rr(Zt,Ot,Vt,rr,ar,hr){if(Zt>Vt||Zt<Ot){const yr=typeof Ot=="bigint"?"n":"";let Br;throw Ot===0||Ot===BigInt(0)?Br=`>= 0${yr} and < 2${yr} ** ${(hr+1)*8}${yr}`:Br=`>= -(2${yr} ** ${(hr+1)*8-1}${yr}) and < 2 ** ${(hr+1)*8-1}${yr}`,new Sr.ERR_OUT_OF_RANGE("value",Br,Zt)}Nr(rr,ar,hr)}function Dr(Zt,Ot){if(typeof Zt!="number")throw new Sr.ERR_INVALID_ARG_TYPE(Ot,"number",Zt)}function Fr(Zt,Ot,Vt){throw Math.floor(Zt)!==Zt?(Dr(Zt,Vt),new Sr.ERR_OUT_OF_RANGE("offset","an integer",Zt)):Ot<0?new Sr.ERR_BUFFER_OUT_OF_BOUNDS:new Sr.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${Ot}`,Zt)}const Kr=/[^+/0-9A-Za-z-_]/g;function Qr(Zt){if(Zt=Zt.split("=")[0],Zt=Zt.trim().replace(Kr,""),Zt.length<2)return"";for(;Zt.length%4!==0;)Zt=Zt+"=";return Zt}function Xr(Zt,Ot){Ot=Ot||1/0;let Vt;const rr=Zt.length;let ar=null;const hr=[];for(let yr=0;yr<rr;++yr){if(Vt=Zt.charCodeAt(yr),Vt>55295&&Vt<57344){if(!ar){if(Vt>56319){(Ot-=3)>-1&&hr.push(239,191,189);continue}else if(yr+1===rr){(Ot-=3)>-1&&hr.push(239,191,189);continue}ar=Vt;continue}if(Vt<56320){(Ot-=3)>-1&&hr.push(239,191,189),ar=Vt;continue}Vt=(ar-55296<<10|Vt-56320)+65536}else ar&&(Ot-=3)>-1&&hr.push(239,191,189);if(ar=null,Vt<128){if((Ot-=1)<0)break;hr.push(Vt)}else if(Vt<2048){if((Ot-=2)<0)break;hr.push(Vt>>6|192,Vt&63|128)}else if(Vt<65536){if((Ot-=3)<0)break;hr.push(Vt>>12|224,Vt>>6&63|128,Vt&63|128)}else if(Vt<1114112){if((Ot-=4)<0)break;hr.push(Vt>>18|240,Vt>>12&63|128,Vt>>6&63|128,Vt&63|128)}else throw new Error("Invalid code point")}return hr}function an(Zt){const Ot=[];for(let Vt=0;Vt<Zt.length;++Vt)Ot.push(Zt.charCodeAt(Vt)&255);return Ot}function Jn(Zt,Ot){let Vt,rr,ar;const hr=[];for(let yr=0;yr<Zt.length&&!((Ot-=2)<0);++yr)Vt=Zt.charCodeAt(yr),rr=Vt>>8,ar=Vt%256,hr.push(ar),hr.push(rr);return hr}function $n(Zt){return yt.toByteArray(Qr(Zt))}function hn(Zt,Ot,Vt,rr){let ar;for(ar=0;ar<rr&&!(ar+Vt>=Ot.length||ar>=Zt.length);++ar)Ot[ar+Vt]=Zt[ar];return ar}function Zr(Zt,Ot){return Zt instanceof Ot||Zt!=null&&Zt.constructor!=null&&Zt.constructor.name!=null&&Zt.constructor.name===Ot.name}function bn(Zt){return Zt!==Zt}const _i=function(){const Zt="0123456789abcdef",Ot=new Array(256);for(let Vt=0;Vt<16;++Vt){const rr=Vt*16;for(let ar=0;ar<16;++ar)Ot[rr+ar]=Zt[Vt]+Zt[ar]}return Ot}();function tn(Zt){return typeof BigInt>"u"?es:Zt}function es(){throw new Error("BigInt not supported")}})(s);const gt=s.Buffer;o.Blob=s.Blob,o.BlobOptions=s.BlobOptions,o.Buffer=s.Buffer,o.File=s.File,o.FileOptions=s.FileOptions,o.INSPECT_MAX_BYTES=s.INSPECT_MAX_BYTES,o.SlowBuffer=s.SlowBuffer,o.TranscodeEncoding=s.TranscodeEncoding,o.atob=s.atob,o.btoa=s.btoa,o.constants=s.constants,o.default=gt,o.isAscii=s.isAscii,o.isUtf8=s.isUtf8,o.kMaxLength=s.kMaxLength,o.kStringMaxLength=s.kStringMaxLength,o.resolveObjectURL=s.resolveObjectURL,o.transcode=s.transcode})(dist);const Buffer$2=getDefaultExportFromCjs$2(dist);function AbstractIterator$8(o){this.db=o,this._ended=!1,this._nexting=!1}AbstractIterator$8.prototype.next=function(o){var s=this;if(typeof o!="function")throw new Error("next() requires a callback argument");return s._ended?(process$1.nextTick(o,new Error("cannot call next() after end()")),s):s._nexting?(process$1.nextTick(o,new Error("cannot call next() before previous next() has completed")),s):(s._nexting=!0,s._next(function(){s._nexting=!1,o.apply(null,arguments)}),s)};AbstractIterator$8.prototype._next=function(o){process$1.nextTick(o)};AbstractIterator$8.prototype.end=function(o){if(typeof o!="function")throw new Error("end() requires a callback argument");if(this._ended)return process$1.nextTick(o,new Error("end() already called on iterator"));this._ended=!0,this._end(o)};AbstractIterator$8.prototype._end=function(o){process$1.nextTick(o)};var abstractIterator$3=AbstractIterator$8;function AbstractChainedBatch$6(o){this._db=o,this._operations=[],this._written=!1}AbstractChainedBatch$6.prototype._serializeKey=function(o){return this._db._serializeKey(o)};AbstractChainedBatch$6.prototype._serializeValue=function(o){return this._db._serializeValue(o)};AbstractChainedBatch$6.prototype._checkWritten=function(){if(this._written)throw new Error("write() already called on this batch")};AbstractChainedBatch$6.prototype.put=function(o,s){this._checkWritten();var a=this._db._checkKey(o,"key");if(a)throw a;return o=this._serializeKey(o),s=this._serializeValue(s),this._put(o,s),this};AbstractChainedBatch$6.prototype._put=function(o,s){this._operations.push({type:"put",key:o,value:s})};AbstractChainedBatch$6.prototype.del=function(o){this._checkWritten();var s=this._db._checkKey(o,"key");if(s)throw s;return o=this._serializeKey(o),this._del(o),this};AbstractChainedBatch$6.prototype._del=function(o){this._operations.push({type:"del",key:o})};AbstractChainedBatch$6.prototype.clear=function(){return this._checkWritten(),this._operations=[],this._clear(),this};AbstractChainedBatch$6.prototype._clear=function(){};AbstractChainedBatch$6.prototype.write=function(o,s){if(this._checkWritten(),typeof o=="function"&&(s=o),typeof s!="function")throw new Error("write() requires a callback argument");if(typeof o!="object"&&(o={}),this._written=!0,typeof this._write=="function")return this._write(s);if(typeof this._db._batch=="function")return this._db._batch(this._operations,o,s);process$1.nextTick(s)};var abstractChainedBatch$3=AbstractChainedBatch$6,xtend$2=immutable,AbstractIterator$7=abstractIterator$3,AbstractChainedBatch$5=abstractChainedBatch$3,hasOwnProperty$3=Object.prototype.hasOwnProperty,rangeOptions$2="start end gt gte lt lte".split(" ");function AbstractLevelDOWN$5(o){if(!arguments.length||o===void 0)throw new Error("constructor requires at least a location argument");if(typeof o!="string")throw new Error("constructor requires a location string argument");this.location=o,this.status="new"}AbstractLevelDOWN$5.prototype.open=function(o,s){var a=this,et=this.status;if(typeof o=="function"&&(s=o),typeof s!="function")throw new Error("open() requires a callback argument");typeof o!="object"&&(o={}),o.createIfMissing=o.createIfMissing!==!1,o.errorIfExists=!!o.errorIfExists,this.status="opening",this._open(o,function(tt){if(tt)return a.status=et,s(tt);a.status="open",s()})};AbstractLevelDOWN$5.prototype._open=function(o,s){process$1.nextTick(s)};AbstractLevelDOWN$5.prototype.close=function(o){var s=this,a=this.status;if(typeof o!="function")throw new Error("close() requires a callback argument");this.status="closing",this._close(function(et){if(et)return s.status=a,o(et);s.status="closed",o()})};AbstractLevelDOWN$5.prototype._close=function(o){process$1.nextTick(o)};AbstractLevelDOWN$5.prototype.get=function(o,s,a){if(typeof s=="function"&&(a=s),typeof a!="function")throw new Error("get() requires a callback argument");var et=this._checkKey(o,"key");if(et)return process$1.nextTick(a,et);o=this._serializeKey(o),typeof s!="object"&&(s={}),s.asBuffer=s.asBuffer!==!1,this._get(o,s,a)};AbstractLevelDOWN$5.prototype._get=function(o,s,a){process$1.nextTick(function(){a(new Error("NotFound"))})};AbstractLevelDOWN$5.prototype.put=function(o,s,a,et){if(typeof a=="function"&&(et=a),typeof et!="function")throw new Error("put() requires a callback argument");var tt=this._checkKey(o,"key");if(tt)return process$1.nextTick(et,tt);o=this._serializeKey(o),s=this._serializeValue(s),typeof a!="object"&&(a={}),this._put(o,s,a,et)};AbstractLevelDOWN$5.prototype._put=function(o,s,a,et){process$1.nextTick(et)};AbstractLevelDOWN$5.prototype.del=function(o,s,a){if(typeof s=="function"&&(a=s),typeof a!="function")throw new Error("del() requires a callback argument");var et=this._checkKey(o,"key");if(et)return process$1.nextTick(a,et);o=this._serializeKey(o),typeof s!="object"&&(s={}),this._del(o,s,a)};AbstractLevelDOWN$5.prototype._del=function(o,s,a){process$1.nextTick(a)};AbstractLevelDOWN$5.prototype.batch=function(o,s,a){if(!arguments.length)return this._chainedBatch();if(typeof s=="function"&&(a=s),typeof o=="function"&&(a=o),typeof a!="function")throw new Error("batch(array) requires a callback argument");if(!Array.isArray(o))return process$1.nextTick(a,new Error("batch(array) requires an array argument"));(!s||typeof s!="object")&&(s={});for(var et=new Array(o.length),tt=0;tt<o.length;tt++){if(typeof o[tt]!="object"||o[tt]===null)return process$1.nextTick(a,new Error("batch(array) element must be an object and not `null`"));var rt=xtend$2(o[tt]);if(rt.type!=="put"&&rt.type!=="del")return process$1.nextTick(a,new Error("`type` must be 'put' or 'del'"));var nt=this._checkKey(rt.key,"key");if(nt)return process$1.nextTick(a,nt);rt.key=this._serializeKey(rt.key),rt.type==="put"&&(rt.value=this._serializeValue(rt.value)),et[tt]=rt}this._batch(et,s,a)};AbstractLevelDOWN$5.prototype._batch=function(o,s,a){process$1.nextTick(a)};AbstractLevelDOWN$5.prototype._setupIteratorOptions=function(o){return o=cleanRangeOptions$2(o),o.reverse=!!o.reverse,o.keys=o.keys!==!1,o.values=o.values!==!1,o.limit="limit"in o?o.limit:-1,o.keyAsBuffer=o.keyAsBuffer!==!1,o.valueAsBuffer=o.valueAsBuffer!==!1,o};function cleanRangeOptions$2(o){var s={};for(var a in o)hasOwnProperty$3.call(o,a)&&(isRangeOption$2(a)&&isEmptyRangeOption$1(o[a])||(s[a]=o[a]));return s}function isRangeOption$2(o){return rangeOptions$2.indexOf(o)!==-1}function isEmptyRangeOption$1(o){return o===""||o==null||isEmptyBuffer$1(o)}function isEmptyBuffer$1(o){return Buffer$2.isBuffer(o)&&o.length===0}AbstractLevelDOWN$5.prototype.iterator=function(o){return typeof o!="object"&&(o={}),o=this._setupIteratorOptions(o),this._iterator(o)};AbstractLevelDOWN$5.prototype._iterator=function(o){return new AbstractIterator$7(this)};AbstractLevelDOWN$5.prototype._chainedBatch=function(){return new AbstractChainedBatch$5(this)};AbstractLevelDOWN$5.prototype._serializeKey=function(o){return Buffer$2.isBuffer(o)?o:String(o)};AbstractLevelDOWN$5.prototype._serializeValue=function(o){return o==null?"":Buffer$2.isBuffer(o)||process$1.browser?o:String(o)};AbstractLevelDOWN$5.prototype._checkKey=function(o,s){if(o==null)return new Error(s+" cannot be `null` or `undefined`");if(Buffer$2.isBuffer(o)&&o.length===0)return new Error(s+" cannot be an empty Buffer");if(String(o)==="")return new Error(s+" cannot be an empty String")};var abstractLeveldown$6=AbstractLevelDOWN$5;abstractLeveldown$7.AbstractLevelDOWN=abstractLeveldown$6;abstractLeveldown$7.AbstractIterator=abstractIterator$3;abstractLeveldown$7.AbstractChainedBatch=abstractChainedBatch$3;var AbstractIterator$6=abstractLeveldown$7.AbstractIterator,inherits$7=inherits_browserExports;function DeferredIterator$1(o){AbstractIterator$6.call(this,o),this._options=o,this._iterator=null,this._operations=[]}inherits$7(DeferredIterator$1,AbstractIterator$6);DeferredIterator$1.prototype.setDb=function(o){var s=this._iterator=o.iterator(this._options);this._operations.forEach(function(a){s[a.method].apply(s,a.args)})};DeferredIterator$1.prototype._operation=function(o,s){if(this._iterator)return this._iterator[o].apply(this._iterator,s);this._operations.push({method:o,args:s})};"next end".split(" ").forEach(function(o){DeferredIterator$1.prototype["_"+o]=function(){this._operation(o,arguments)}});var deferredIterator=DeferredIterator$1,AbstractLevelDOWN$4=abstractLeveldown$7.AbstractLevelDOWN,inherits$6=inherits_browserExports,DeferredIterator=deferredIterator,deferrables="put get del batch".split(" ");function DeferredLevelDOWN$1(o){AbstractLevelDOWN$4.call(this,""),this._db=o,this._operations=[],this._iterators=[],closed(this)}inherits$6(DeferredLevelDOWN$1,AbstractLevelDOWN$4);DeferredLevelDOWN$1.prototype._open=function(o,s){var a=this;this._db.open(o,function(et){if(et)return s(et);a._operations.forEach(function(tt){a._db[tt.method].apply(a._db,tt.args)}),a._operations=[],a._iterators.forEach(function(tt){tt.setDb(a._db)}),a._iterators=[],open(a),s()})};DeferredLevelDOWN$1.prototype._close=function(o){var s=this;this._db.close(function(a){if(a)return o(a);closed(s),o()})};function open(o){deferrables.concat("iterator").forEach(function(s){o["_"+s]=function(){return this._db[s].apply(this._db,arguments)}}),o._db.approximateSize&&(o.approximateSize=function(){return this._db.approximateSize.apply(this._db,arguments)})}function closed(o){deferrables.forEach(function(s){o["_"+s]=function(){this._operations.push({method:s,args:arguments})}}),typeof o._db.approximateSize=="function"&&(o.approximateSize=function(){this._operations.push({method:"approximateSize",args:arguments})}),o._iterator=function(s){var a=new DeferredIterator(s);return this._iterators.push(a),a}}DeferredLevelDOWN$1.prototype._serializeKey=function(o){return o};DeferredLevelDOWN$1.prototype._serializeValue=function(o){return o};deferredLeveldown.exports=DeferredLevelDOWN$1;deferredLeveldown.exports.DeferredIterator=DeferredIterator;var deferredLeveldownExports=deferredLeveldown.exports,readableBrowser={exports:{}},processNextickArgs={exports:{}};typeof process$1>"u"||!process$1.version||process$1.version.indexOf("v0.")===0||process$1.version.indexOf("v1.")===0&&process$1.version.indexOf("v1.8.")!==0?processNextickArgs.exports={nextTick:nextTick$2}:processNextickArgs.exports=process$1;function nextTick$2(o,s,a,et){if(typeof o!="function")throw new TypeError('"callback" argument must be a function');var tt=arguments.length,rt,nt;switch(tt){case 0:case 1:return process$1.nextTick(o);case 2:return process$1.nextTick(function(){o.call(null,s)});case 3:return process$1.nextTick(function(){o.call(null,s,a)});case 4:return process$1.nextTick(function(){o.call(null,s,a,et)});default:for(rt=new Array(tt-1),nt=0;nt<rt.length;)rt[nt++]=arguments[nt];return process$1.nextTick(function(){o.apply(null,rt)})}}var processNextickArgsExports=processNextickArgs.exports,toString$n={}.toString,isarray=Array.isArray||function(o){return toString$n.call(o)=="[object Array]"},streamBrowser=eventsExports.EventEmitter,safeBuffer$1={exports:{}};(function(o,s){var a=dist,et=a.Buffer;function tt(nt,it){for(var st in nt)it[st]=nt[st]}et.from&&et.alloc&&et.allocUnsafe&&et.allocUnsafeSlow?o.exports=a:(tt(a,s),s.Buffer=rt);function rt(nt,it,st){return et(nt,it,st)}tt(et,rt),rt.from=function(nt,it,st){if(typeof nt=="number")throw new TypeError("Argument must not be a number");return et(nt,it,st)},rt.alloc=function(nt,it,st){if(typeof nt!="number")throw new TypeError("Argument must be a number");var ot=et(nt);return it!==void 0?typeof st=="string"?ot.fill(it,st):ot.fill(it):ot.fill(0),ot},rt.allocUnsafe=function(nt){if(typeof nt!="number")throw new TypeError("Argument must be a number");return et(nt)},rt.allocUnsafeSlow=function(nt){if(typeof nt!="number")throw new TypeError("Argument must be a number");return a.SlowBuffer(nt)}})(safeBuffer$1,safeBuffer$1.exports);var safeBufferExports=safeBuffer$1.exports,util$5={};function isArray$2(o){return Array.isArray?Array.isArray(o):objectToString(o)==="[object Array]"}util$5.isArray=isArray$2;function isBoolean$2(o){return typeof o=="boolean"}util$5.isBoolean=isBoolean$2;function isNull(o){return o===null}util$5.isNull=isNull;function isNullOrUndefined$2(o){return o==null}util$5.isNullOrUndefined=isNullOrUndefined$2;function isNumber$2(o){return typeof o=="number"}util$5.isNumber=isNumber$2;function isString$3(o){return typeof o=="string"}util$5.isString=isString$3;function isSymbol(o){return typeof o=="symbol"}util$5.isSymbol=isSymbol;function isUndefined(o){return o===void 0}util$5.isUndefined=isUndefined;function isRegExp(o){return objectToString(o)==="[object RegExp]"}util$5.isRegExp=isRegExp;function isObject$2(o){return typeof o=="object"&&o!==null}util$5.isObject=isObject$2;function isDate(o){return objectToString(o)==="[object Date]"}util$5.isDate=isDate;function isError(o){return objectToString(o)==="[object Error]"||o instanceof Error}util$5.isError=isError;function isFunction$2(o){return typeof o=="function"}util$5.isFunction=isFunction$2;function isPrimitive(o){return o===null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||typeof o=="symbol"||typeof o>"u"}util$5.isPrimitive=isPrimitive;util$5.isBuffer=Buffer$2.isBuffer;function objectToString(o){return Object.prototype.toString.call(o)}var BufferList={exports:{}},hasRequiredBufferList;function requireBufferList(){return hasRequiredBufferList||(hasRequiredBufferList=1,function(o){function s(rt,nt){if(!(rt instanceof nt))throw new TypeError("Cannot call a class as a function")}var a=safeBufferExports.Buffer,et=util$b;function tt(rt,nt,it){rt.copy(nt,it)}o.exports=function(){function rt(){s(this,rt),this.head=null,this.tail=null,this.length=0}return rt.prototype.push=function(it){var st={data:it,next:null};this.length>0?this.tail.next=st:this.head=st,this.tail=st,++this.length},rt.prototype.unshift=function(it){var st={data:it,next:this.head};this.length===0&&(this.tail=st),this.head=st,++this.length},rt.prototype.shift=function(){if(this.length!==0){var it=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,it}},rt.prototype.clear=function(){this.head=this.tail=null,this.length=0},rt.prototype.join=function(it){if(this.length===0)return"";for(var st=this.head,ot=""+st.data;st=st.next;)ot+=it+st.data;return ot},rt.prototype.concat=function(it){if(this.length===0)return a.alloc(0);for(var st=a.allocUnsafe(it>>>0),ot=this.head,at=0;ot;)tt(ot.data,st,at),at+=ot.data.length,ot=ot.next;return st},rt}(),et&&et.inspect&&et.inspect.custom&&(o.exports.prototype[et.inspect.custom]=function(){var rt=et.inspect({length:this.length});return this.constructor.name+" "+rt})}(BufferList)),BufferList.exports}var pna=processNextickArgsExports;function destroy$1(o,s){var a=this,et=this._readableState&&this._readableState.destroyed,tt=this._writableState&&this._writableState.destroyed;return et||tt?(s?s(o):o&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,pna.nextTick(emitErrorNT,this,o)):pna.nextTick(emitErrorNT,this,o)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(o||null,function(rt){!s&&rt?a._writableState?a._writableState.errorEmitted||(a._writableState.errorEmitted=!0,pna.nextTick(emitErrorNT,a,rt)):pna.nextTick(emitErrorNT,a,rt):s&&s(rt)}),this)}function undestroy(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function emitErrorNT(o,s){o.emit("error",s)}var destroy_1={destroy:destroy$1,undestroy},browser$6=deprecate;function deprecate(o,s){if(config$1("noDeprecation"))return o;var a=!1;function et(){if(!a){if(config$1("throwDeprecation"))throw new Error(s);config$1("traceDeprecation")?console.trace(s):console.warn(s),a=!0}return o.apply(this,arguments)}return et}function config$1(o){try{if(!commonjsGlobal.localStorage)return!1}catch{return!1}var s=commonjsGlobal.localStorage[o];return s==null?!1:String(s).toLowerCase()==="true"}var _stream_writable,hasRequired_stream_writable;function require_stream_writable(){if(hasRequired_stream_writable)return _stream_writable;hasRequired_stream_writable=1;var o=processNextickArgsExports;_stream_writable=dt;function s(Dt){var Tt=this;this.next=null,this.entry=null,this.finish=function(){Pt(Tt,Dt)}}var a=!process$1.browser&&["v0.10","v0.9."].indexOf(process$1.version.slice(0,5))>-1?setImmediate:o.nextTick,et;dt.WritableState=ht;var tt=Object.create(util$5);tt.inherits=inherits_browserExports;var rt={deprecate:browser$6},nt=streamBrowser,it=safeBufferExports.Buffer,st=(typeof commonjsGlobal<"u"?commonjsGlobal:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function ot(Dt){return it.from(Dt)}function at(Dt){return it.isBuffer(Dt)||Dt instanceof st}var lt=destroy_1;tt.inherits(dt,nt);function ct(){}function ht(Dt,Tt){et=et||require_stream_duplex(),Dt=Dt||{};var St=Tt instanceof et;this.objectMode=!!Dt.objectMode,St&&(this.objectMode=this.objectMode||!!Dt.writableObjectMode);var Mt=Dt.highWaterMark,jt=Dt.writableHighWaterMark,Gt=this.objectMode?16:16*1024;Mt||Mt===0?this.highWaterMark=Mt:St&&(jt||jt===0)?this.highWaterMark=jt:this.highWaterMark=Gt,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var Ht=Dt.decodeStrings===!1;this.decodeStrings=!Ht,this.defaultEncoding=Dt.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(At){wt(Tt,At)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}ht.prototype.getBuffer=function(){for(var Tt=this.bufferedRequest,St=[];Tt;)St.push(Tt),Tt=Tt.next;return St},function(){try{Object.defineProperty(ht.prototype,"buffer",{get:rt.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var ft;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(ft=Function.prototype[Symbol.hasInstance],Object.defineProperty(dt,Symbol.hasInstance,{value:function(Dt){return ft.call(this,Dt)?!0:this!==dt?!1:Dt&&Dt._writableState instanceof ht}})):ft=function(Dt){return Dt instanceof this};function dt(Dt){if(et=et||require_stream_duplex(),!ft.call(dt,this)&&!(this instanceof et))return new dt(Dt);this._writableState=new ht(Dt,this),this.writable=!0,Dt&&(typeof Dt.write=="function"&&(this._write=Dt.write),typeof Dt.writev=="function"&&(this._writev=Dt.writev),typeof Dt.destroy=="function"&&(this._destroy=Dt.destroy),typeof Dt.final=="function"&&(this._final=Dt.final)),nt.call(this)}dt.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function pt(Dt,Tt){var St=new Error("write after end");Dt.emit("error",St),o.nextTick(Tt,St)}function gt(Dt,Tt,St,Mt){var jt=!0,Gt=!1;return St===null?Gt=new TypeError("May not write null values to stream"):typeof St!="string"&&St!==void 0&&!Tt.objectMode&&(Gt=new TypeError("Invalid non-string/buffer chunk")),Gt&&(Dt.emit("error",Gt),o.nextTick(Mt,Gt),jt=!1),jt}dt.prototype.write=function(Dt,Tt,St){var Mt=this._writableState,jt=!1,Gt=!Mt.objectMode&&at(Dt);return Gt&&!it.isBuffer(Dt)&&(Dt=ot(Dt)),typeof Tt=="function"&&(St=Tt,Tt=null),Gt?Tt="buffer":Tt||(Tt=Mt.defaultEncoding),typeof St!="function"&&(St=ct),Mt.ended?pt(this,St):(Gt||gt(this,Mt,Dt,St))&&(Mt.pendingcb++,jt=yt(this,Mt,Gt,Dt,Tt,St)),jt},dt.prototype.cork=function(){var Dt=this._writableState;Dt.corked++},dt.prototype.uncork=function(){var Dt=this._writableState;Dt.corked&&(Dt.corked--,!Dt.writing&&!Dt.corked&&!Dt.bufferProcessing&&Dt.bufferedRequest&&Ft(this,Dt))},dt.prototype.setDefaultEncoding=function(Tt){if(typeof Tt=="string"&&(Tt=Tt.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((Tt+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+Tt);return this._writableState.defaultEncoding=Tt,this};function mt(Dt,Tt,St){return!Dt.objectMode&&Dt.decodeStrings!==!1&&typeof Tt=="string"&&(Tt=it.from(Tt,St)),Tt}Object.defineProperty(dt.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function yt(Dt,Tt,St,Mt,jt,Gt){if(!St){var Ht=mt(Tt,Mt,jt);Mt!==Ht&&(St=!0,jt="buffer",Mt=Ht)}var At=Tt.objectMode?1:Mt.length;Tt.length+=At;var $t=Tt.length<Tt.highWaterMark;if($t||(Tt.needDrain=!0),Tt.writing||Tt.corked){var kt=Tt.lastBufferedRequest;Tt.lastBufferedRequest={chunk:Mt,encoding:jt,isBuf:St,callback:Gt,next:null},kt?kt.next=Tt.lastBufferedRequest:Tt.bufferedRequest=Tt.lastBufferedRequest,Tt.bufferedRequestCount+=1}else vt(Dt,Tt,!1,At,Mt,jt,Gt);return $t}function vt(Dt,Tt,St,Mt,jt,Gt,Ht){Tt.writelen=Mt,Tt.writecb=Ht,Tt.writing=!0,Tt.sync=!0,St?Dt._writev(jt,Tt.onwrite):Dt._write(jt,Gt,Tt.onwrite),Tt.sync=!1}function Et(Dt,Tt,St,Mt,jt){--Tt.pendingcb,St?(o.nextTick(jt,Mt),o.nextTick(Yt,Dt,Tt),Dt._writableState.errorEmitted=!0,Dt.emit("error",Mt)):(jt(Mt),Dt._writableState.errorEmitted=!0,Dt.emit("error",Mt),Yt(Dt,Tt))}function xt(Dt){Dt.writing=!1,Dt.writecb=null,Dt.length-=Dt.writelen,Dt.writelen=0}function wt(Dt,Tt){var St=Dt._writableState,Mt=St.sync,jt=St.writecb;if(xt(St),Tt)Et(Dt,St,Mt,Tt,jt);else{var Gt=zt(St);!Gt&&!St.corked&&!St.bufferProcessing&&St.bufferedRequest&&Ft(Dt,St),Mt?a(Rt,Dt,St,Gt,jt):Rt(Dt,St,Gt,jt)}}function Rt(Dt,Tt,St,Mt){St||Ct(Dt,Tt),Tt.pendingcb--,Mt(),Yt(Dt,Tt)}function Ct(Dt,Tt){Tt.length===0&&Tt.needDrain&&(Tt.needDrain=!1,Dt.emit("drain"))}function Ft(Dt,Tt){Tt.bufferProcessing=!0;var St=Tt.bufferedRequest;if(Dt._writev&&St&&St.next){var Mt=Tt.bufferedRequestCount,jt=new Array(Mt),Gt=Tt.corkedRequestsFree;Gt.entry=St;for(var Ht=0,At=!0;St;)jt[Ht]=St,St.isBuf||(At=!1),St=St.next,Ht+=1;jt.allBuffers=At,vt(Dt,Tt,!0,Tt.length,jt,"",Gt.finish),Tt.pendingcb++,Tt.lastBufferedRequest=null,Gt.next?(Tt.corkedRequestsFree=Gt.next,Gt.next=null):Tt.corkedRequestsFree=new s(Tt),Tt.bufferedRequestCount=0}else{for(;St;){var $t=St.chunk,kt=St.encoding,Lt=St.callback,bt=Tt.objectMode?1:$t.length;if(vt(Dt,Tt,!1,bt,$t,kt,Lt),St=St.next,Tt.bufferedRequestCount--,Tt.writing)break}St===null&&(Tt.lastBufferedRequest=null)}Tt.bufferedRequest=St,Tt.bufferProcessing=!1}dt.prototype._write=function(Dt,Tt,St){St(new Error("_write() is not implemented"))},dt.prototype._writev=null,dt.prototype.end=function(Dt,Tt,St){var Mt=this._writableState;typeof Dt=="function"?(St=Dt,Dt=null,Tt=null):typeof Tt=="function"&&(St=Tt,Tt=null),Dt!=null&&this.write(Dt,Tt),Mt.corked&&(Mt.corked=1,this.uncork()),Mt.ending||Bt(this,Mt,St)};function zt(Dt){return Dt.ending&&Dt.length===0&&Dt.bufferedRequest===null&&!Dt.finished&&!Dt.writing}function Nt(Dt,Tt){Dt._final(function(St){Tt.pendingcb--,St&&Dt.emit("error",St),Tt.prefinished=!0,Dt.emit("prefinish"),Yt(Dt,Tt)})}function Kt(Dt,Tt){!Tt.prefinished&&!Tt.finalCalled&&(typeof Dt._final=="function"?(Tt.pendingcb++,Tt.finalCalled=!0,o.nextTick(Nt,Dt,Tt)):(Tt.prefinished=!0,Dt.emit("prefinish")))}function Yt(Dt,Tt){var St=zt(Tt);return St&&(Kt(Dt,Tt),Tt.pendingcb===0&&(Tt.finished=!0,Dt.emit("finish"))),St}function Bt(Dt,Tt,St){Tt.ending=!0,Yt(Dt,Tt),St&&(Tt.finished?o.nextTick(St):Dt.once("finish",St)),Tt.ended=!0,Dt.writable=!1}function Pt(Dt,Tt,St){var Mt=Dt.entry;for(Dt.entry=null;Mt;){var jt=Mt.callback;Tt.pendingcb--,jt(St),Mt=Mt.next}Tt.corkedRequestsFree.next=Dt}return Object.defineProperty(dt.prototype,"destroyed",{get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(Dt){this._writableState&&(this._writableState.destroyed=Dt)}}),dt.prototype.destroy=lt.destroy,dt.prototype._undestroy=lt.undestroy,dt.prototype._destroy=function(Dt,Tt){this.end(),Tt(Dt)},_stream_writable}var _stream_duplex,hasRequired_stream_duplex;function require_stream_duplex(){if(hasRequired_stream_duplex)return _stream_duplex;hasRequired_stream_duplex=1;var o=processNextickArgsExports,s=Object.keys||function(lt){var ct=[];for(var ht in lt)ct.push(ht);return ct};_stream_duplex=st;var a=Object.create(util$5);a.inherits=inherits_browserExports;var et=require_stream_readable(),tt=require_stream_writable();a.inherits(st,et);for(var rt=s(tt.prototype),nt=0;nt<rt.length;nt++){var it=rt[nt];st.prototype[it]||(st.prototype[it]=tt.prototype[it])}function st(lt){if(!(this instanceof st))return new st(lt);et.call(this,lt),tt.call(this,lt),lt&&lt.readable===!1&&(this.readable=!1),lt&&lt.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,lt&&lt.allowHalfOpen===!1&&(this.allowHalfOpen=!1),this.once("end",ot)}Object.defineProperty(st.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function ot(){this.allowHalfOpen||this._writableState.ended||o.nextTick(at,this)}function at(lt){lt.end()}return Object.defineProperty(st.prototype,"destroyed",{get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(lt){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=lt,this._writableState.destroyed=lt)}}),st.prototype._destroy=function(lt,ct){this.push(null),this.end(),o.nextTick(ct,lt)},_stream_duplex}var string_decoder={},safeBuffer={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var hasRequiredSafeBuffer;function requireSafeBuffer(){return hasRequiredSafeBuffer||(hasRequiredSafeBuffer=1,function(o,s){var a=dist,et=a.Buffer;function tt(nt,it){for(var st in nt)it[st]=nt[st]}et.from&&et.alloc&&et.allocUnsafe&&et.allocUnsafeSlow?o.exports=a:(tt(a,s),s.Buffer=rt);function rt(nt,it,st){return et(nt,it,st)}rt.prototype=Object.create(et.prototype),tt(et,rt),rt.from=function(nt,it,st){if(typeof nt=="number")throw new TypeError("Argument must not be a number");return et(nt,it,st)},rt.alloc=function(nt,it,st){if(typeof nt!="number")throw new TypeError("Argument must be a number");var ot=et(nt);return it!==void 0?typeof st=="string"?ot.fill(it,st):ot.fill(it):ot.fill(0),ot},rt.allocUnsafe=function(nt){if(typeof nt!="number")throw new TypeError("Argument must be a number");return et(nt)},rt.allocUnsafeSlow=function(nt){if(typeof nt!="number")throw new TypeError("Argument must be a number");return a.SlowBuffer(nt)}}(safeBuffer,safeBuffer.exports)),safeBuffer.exports}var hasRequiredString_decoder;function requireString_decoder(){if(hasRequiredString_decoder)return string_decoder;hasRequiredString_decoder=1;var o=requireSafeBuffer().Buffer,s=o.isEncoding||function(gt){switch(gt=""+gt,gt&&gt.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function a(gt){if(!gt)return"utf8";for(var mt;;)switch(gt){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return gt;default:if(mt)return;gt=(""+gt).toLowerCase(),mt=!0}}function et(gt){var mt=a(gt);if(typeof mt!="string"&&(o.isEncoding===s||!s(gt)))throw new Error("Unknown encoding: "+gt);return mt||gt}string_decoder.StringDecoder=tt;function tt(gt){this.encoding=et(gt);var mt;switch(this.encoding){case"utf16le":this.text=lt,this.end=ct,mt=4;break;case"utf8":this.fillLast=st,mt=4;break;case"base64":this.text=ht,this.end=ft,mt=3;break;default:this.write=dt,this.end=pt;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=o.allocUnsafe(mt)}tt.prototype.write=function(gt){if(gt.length===0)return"";var mt,yt;if(this.lastNeed){if(mt=this.fillLast(gt),mt===void 0)return"";yt=this.lastNeed,this.lastNeed=0}else yt=0;return yt<gt.length?mt?mt+this.text(gt,yt):this.text(gt,yt):mt||""},tt.prototype.end=at,tt.prototype.text=ot,tt.prototype.fillLast=function(gt){if(this.lastNeed<=gt.length)return gt.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);gt.copy(this.lastChar,this.lastTotal-this.lastNeed,0,gt.length),this.lastNeed-=gt.length};function rt(gt){return gt<=127?0:gt>>5===6?2:gt>>4===14?3:gt>>3===30?4:gt>>6===2?-1:-2}function nt(gt,mt,yt){var vt=mt.length-1;if(vt<yt)return 0;var Et=rt(mt[vt]);return Et>=0?(Et>0&&(gt.lastNeed=Et-1),Et):--vt<yt||Et===-2?0:(Et=rt(mt[vt]),Et>=0?(Et>0&&(gt.lastNeed=Et-2),Et):--vt<yt||Et===-2?0:(Et=rt(mt[vt]),Et>=0?(Et>0&&(Et===2?Et=0:gt.lastNeed=Et-3),Et):0))}function it(gt,mt,yt){if((mt[0]&192)!==128)return gt.lastNeed=0,"";if(gt.lastNeed>1&&mt.length>1){if((mt[1]&192)!==128)return gt.lastNeed=1,"";if(gt.lastNeed>2&&mt.length>2&&(mt[2]&192)!==128)return gt.lastNeed=2,""}}function st(gt){var mt=this.lastTotal-this.lastNeed,yt=it(this,gt);if(yt!==void 0)return yt;if(this.lastNeed<=gt.length)return gt.copy(this.lastChar,mt,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);gt.copy(this.lastChar,mt,0,gt.length),this.lastNeed-=gt.length}function ot(gt,mt){var yt=nt(this,gt,mt);if(!this.lastNeed)return gt.toString("utf8",mt);this.lastTotal=yt;var vt=gt.length-(yt-this.lastNeed);return gt.copy(this.lastChar,0,vt),gt.toString("utf8",mt,vt)}function at(gt){var mt=gt&&gt.length?this.write(gt):"";return this.lastNeed?mt+"":mt}function lt(gt,mt){if((gt.length-mt)%2===0){var yt=gt.toString("utf16le",mt);if(yt){var vt=yt.charCodeAt(yt.length-1);if(vt>=55296&&vt<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=gt[gt.length-2],this.lastChar[1]=gt[gt.length-1],yt.slice(0,-1)}return yt}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=gt[gt.length-1],gt.toString("utf16le",mt,gt.length-1)}function ct(gt){var mt=gt&&gt.length?this.write(gt):"";if(this.lastNeed){var yt=this.lastTotal-this.lastNeed;return mt+this.lastChar.toString("utf16le",0,yt)}return mt}function ht(gt,mt){var yt=(gt.length-mt)%3;return yt===0?gt.toString("base64",mt):(this.lastNeed=3-yt,this.lastTotal=3,yt===1?this.lastChar[0]=gt[gt.length-1]:(this.lastChar[0]=gt[gt.length-2],this.lastChar[1]=gt[gt.length-1]),gt.toString("base64",mt,gt.length-yt))}function ft(gt){var mt=gt&&gt.length?this.write(gt):"";return this.lastNeed?mt+this.lastChar.toString("base64",0,3-this.lastNeed):mt}function dt(gt){return gt.toString(this.encoding)}function pt(gt){return gt&&gt.length?this.write(gt):""}return string_decoder}var _stream_readable,hasRequired_stream_readable;function require_stream_readable(){if(hasRequired_stream_readable)return _stream_readable;hasRequired_stream_readable=1;var o=processNextickArgsExports;_stream_readable=mt;var s=isarray,a;mt.ReadableState=gt,eventsExports.EventEmitter;var et=function(Lt,bt){return Lt.listeners(bt).length},tt=streamBrowser,rt=safeBufferExports.Buffer,nt=(typeof commonjsGlobal<"u"?commonjsGlobal:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function it(Lt){return rt.from(Lt)}function st(Lt){return rt.isBuffer(Lt)||Lt instanceof nt}var ot=Object.create(util$5);ot.inherits=inherits_browserExports;var at=util$b,lt=void 0;at&&at.debuglog?lt=at.debuglog("stream"):lt=function(){};var ct=requireBufferList(),ht=destroy_1,ft;ot.inherits(mt,tt);var dt=["error","close","destroy","pause","resume"];function pt(Lt,bt,It){if(typeof Lt.prependListener=="function")return Lt.prependListener(bt,It);!Lt._events||!Lt._events[bt]?Lt.on(bt,It):s(Lt._events[bt])?Lt._events[bt].unshift(It):Lt._events[bt]=[It,Lt._events[bt]]}function gt(Lt,bt){a=a||require_stream_duplex(),Lt=Lt||{};var It=bt instanceof a;this.objectMode=!!Lt.objectMode,It&&(this.objectMode=this.objectMode||!!Lt.readableObjectMode);var Ut=Lt.highWaterMark,Wt=Lt.readableHighWaterMark,Xt=this.objectMode?16:16*1024;Ut||Ut===0?this.highWaterMark=Ut:It&&(Wt||Wt===0)?this.highWaterMark=Wt:this.highWaterMark=Xt,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new ct,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=Lt.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,Lt.encoding&&(ft||(ft=requireString_decoder().StringDecoder),this.decoder=new ft(Lt.encoding),this.encoding=Lt.encoding)}function mt(Lt){if(a=a||require_stream_duplex(),!(this instanceof mt))return new mt(Lt);this._readableState=new gt(Lt,this),this.readable=!0,Lt&&(typeof Lt.read=="function"&&(this._read=Lt.read),typeof Lt.destroy=="function"&&(this._destroy=Lt.destroy)),tt.call(this)}Object.defineProperty(mt.prototype,"destroyed",{get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(Lt){this._readableState&&(this._readableState.destroyed=Lt)}}),mt.prototype.destroy=ht.destroy,mt.prototype._undestroy=ht.undestroy,mt.prototype._destroy=function(Lt,bt){this.push(null),bt(Lt)},mt.prototype.push=function(Lt,bt){var It=this._readableState,Ut;return It.objectMode?Ut=!0:typeof Lt=="string"&&(bt=bt||It.defaultEncoding,bt!==It.encoding&&(Lt=rt.from(Lt,bt),bt=""),Ut=!0),yt(this,Lt,bt,!1,Ut)},mt.prototype.unshift=function(Lt){return yt(this,Lt,null,!0,!1)};function yt(Lt,bt,It,Ut,Wt){var Xt=Lt._readableState;if(bt===null)Xt.reading=!1,Ft(Lt,Xt);else{var Qt;Wt||(Qt=Et(Xt,bt)),Qt?Lt.emit("error",Qt):Xt.objectMode||bt&&bt.length>0?(typeof bt!="string"&&!Xt.objectMode&&Object.getPrototypeOf(bt)!==rt.prototype&&(bt=it(bt)),Ut?Xt.endEmitted?Lt.emit("error",new Error("stream.unshift() after end event")):vt(Lt,Xt,bt,!0):Xt.ended?Lt.emit("error",new Error("stream.push() after EOF")):(Xt.reading=!1,Xt.decoder&&!It?(bt=Xt.decoder.write(bt),Xt.objectMode||bt.length!==0?vt(Lt,Xt,bt,!1):Kt(Lt,Xt)):vt(Lt,Xt,bt,!1))):Ut||(Xt.reading=!1)}return xt(Xt)}function vt(Lt,bt,It,Ut){bt.flowing&&bt.length===0&&!bt.sync?(Lt.emit("data",It),Lt.read(0)):(bt.length+=bt.objectMode?1:It.length,Ut?bt.buffer.unshift(It):bt.buffer.push(It),bt.needReadable&&zt(Lt)),Kt(Lt,bt)}function Et(Lt,bt){var It;return!st(bt)&&typeof bt!="string"&&bt!==void 0&&!Lt.objectMode&&(It=new TypeError("Invalid non-string/buffer chunk")),It}function xt(Lt){return!Lt.ended&&(Lt.needReadable||Lt.length<Lt.highWaterMark||Lt.length===0)}mt.prototype.isPaused=function(){return this._readableState.flowing===!1},mt.prototype.setEncoding=function(Lt){return ft||(ft=requireString_decoder().StringDecoder),this._readableState.decoder=new ft(Lt),this._readableState.encoding=Lt,this};var wt=8388608;function Rt(Lt){return Lt>=wt?Lt=wt:(Lt--,Lt|=Lt>>>1,Lt|=Lt>>>2,Lt|=Lt>>>4,Lt|=Lt>>>8,Lt|=Lt>>>16,Lt++),Lt}function Ct(Lt,bt){return Lt<=0||bt.length===0&&bt.ended?0:bt.objectMode?1:Lt!==Lt?bt.flowing&&bt.length?bt.buffer.head.data.length:bt.length:(Lt>bt.highWaterMark&&(bt.highWaterMark=Rt(Lt)),Lt<=bt.length?Lt:bt.ended?bt.length:(bt.needReadable=!0,0))}mt.prototype.read=function(Lt){lt("read",Lt),Lt=parseInt(Lt,10);var bt=this._readableState,It=Lt;if(Lt!==0&&(bt.emittedReadable=!1),Lt===0&&bt.needReadable&&(bt.length>=bt.highWaterMark||bt.ended))return lt("read: emitReadable",bt.length,bt.ended),bt.length===0&&bt.ended?At(this):zt(this),null;if(Lt=Ct(Lt,bt),Lt===0&&bt.ended)return bt.length===0&&At(this),null;var Ut=bt.needReadable;lt("need readable",Ut),(bt.length===0||bt.length-Lt<bt.highWaterMark)&&(Ut=!0,lt("length less than watermark",Ut)),bt.ended||bt.reading?(Ut=!1,lt("reading or ended",Ut)):Ut&&(lt("do read"),bt.reading=!0,bt.sync=!0,bt.length===0&&(bt.needReadable=!0),this._read(bt.highWaterMark),bt.sync=!1,bt.reading||(Lt=Ct(It,bt)));var Wt;return Lt>0?Wt=Mt(Lt,bt):Wt=null,Wt===null?(bt.needReadable=!0,Lt=0):bt.length-=Lt,bt.length===0&&(bt.ended||(bt.needReadable=!0),It!==Lt&&bt.ended&&At(this)),Wt!==null&&this.emit("data",Wt),Wt};function Ft(Lt,bt){if(!bt.ended){if(bt.decoder){var It=bt.decoder.end();It&&It.length&&(bt.buffer.push(It),bt.length+=bt.objectMode?1:It.length)}bt.ended=!0,zt(Lt)}}function zt(Lt){var bt=Lt._readableState;bt.needReadable=!1,bt.emittedReadable||(lt("emitReadable",bt.flowing),bt.emittedReadable=!0,bt.sync?o.nextTick(Nt,Lt):Nt(Lt))}function Nt(Lt){lt("emit readable"),Lt.emit("readable"),St(Lt)}function Kt(Lt,bt){bt.readingMore||(bt.readingMore=!0,o.nextTick(Yt,Lt,bt))}function Yt(Lt,bt){for(var It=bt.length;!bt.reading&&!bt.flowing&&!bt.ended&&bt.length<bt.highWaterMark&&(lt("maybeReadMore read 0"),Lt.read(0),It!==bt.length);)It=bt.length;bt.readingMore=!1}mt.prototype._read=function(Lt){this.emit("error",new Error("_read() is not implemented"))},mt.prototype.pipe=function(Lt,bt){var It=this,Ut=this._readableState;switch(Ut.pipesCount){case 0:Ut.pipes=Lt;break;case 1:Ut.pipes=[Ut.pipes,Lt];break;default:Ut.pipes.push(Lt);break}Ut.pipesCount+=1,lt("pipe count=%d opts=%j",Ut.pipesCount,bt);var Wt=(!bt||bt.end!==!1)&&Lt!==process$1.stdout&&Lt!==process$1.stderr,Xt=Wt?er:Ir;Ut.endEmitted?o.nextTick(Xt):It.once("end",Xt),Lt.on("unpipe",Qt);function Qt(tr,sr){lt("onunpipe"),tr===It&&sr&&sr.hasUnpiped===!1&&(sr.hasUnpiped=!0,gr())}function er(){lt("onend"),Lt.end()}var lr=Bt(It);Lt.on("drain",lr);var pr=!1;function gr(){lt("cleanup"),Lt.removeListener("close",_r),Lt.removeListener("finish",kr),Lt.removeListener("drain",lr),Lt.removeListener("error",Cr),Lt.removeListener("unpipe",Qt),It.removeListener("end",er),It.removeListener("end",Ir),It.removeListener("data",cr),pr=!0,Ut.awaitDrain&&(!Lt._writableState||Lt._writableState.needDrain)&&lr()}var wr=!1;It.on("data",cr);function cr(tr){lt("ondata"),wr=!1;var sr=Lt.write(tr);sr===!1&&!wr&&((Ut.pipesCount===1&&Ut.pipes===Lt||Ut.pipesCount>1&&kt(Ut.pipes,Lt)!==-1)&&!pr&&(lt("false write response, pause",Ut.awaitDrain),Ut.awaitDrain++,wr=!0),It.pause())}function Cr(tr){lt("onerror",tr),Ir(),Lt.removeListener("error",Cr),et(Lt,"error")===0&&Lt.emit("error",tr)}pt(Lt,"error",Cr);function _r(){Lt.removeListener("finish",kr),Ir()}Lt.once("close",_r);function kr(){lt("onfinish"),Lt.removeListener("close",_r),Ir()}Lt.once("finish",kr);function Ir(){lt("unpipe"),It.unpipe(Lt)}return Lt.emit("pipe",It),Ut.flowing||(lt("pipe resume"),It.resume()),Lt};function Bt(Lt){return function(){var bt=Lt._readableState;lt("pipeOnDrain",bt.awaitDrain),bt.awaitDrain&&bt.awaitDrain--,bt.awaitDrain===0&&et(Lt,"data")&&(bt.flowing=!0,St(Lt))}}mt.prototype.unpipe=function(Lt){var bt=this._readableState,It={hasUnpiped:!1};if(bt.pipesCount===0)return this;if(bt.pipesCount===1)return Lt&&Lt!==bt.pipes?this:(Lt||(Lt=bt.pipes),bt.pipes=null,bt.pipesCount=0,bt.flowing=!1,Lt&&Lt.emit("unpipe",this,It),this);if(!Lt){var Ut=bt.pipes,Wt=bt.pipesCount;bt.pipes=null,bt.pipesCount=0,bt.flowing=!1;for(var Xt=0;Xt<Wt;Xt++)Ut[Xt].emit("unpipe",this,{hasUnpiped:!1});return this}var Qt=kt(bt.pipes,Lt);return Qt===-1?this:(bt.pipes.splice(Qt,1),bt.pipesCount-=1,bt.pipesCount===1&&(bt.pipes=bt.pipes[0]),Lt.emit("unpipe",this,It),this)},mt.prototype.on=function(Lt,bt){var It=tt.prototype.on.call(this,Lt,bt);if(Lt==="data")this._readableState.flowing!==!1&&this.resume();else if(Lt==="readable"){var Ut=this._readableState;!Ut.endEmitted&&!Ut.readableListening&&(Ut.readableListening=Ut.needReadable=!0,Ut.emittedReadable=!1,Ut.reading?Ut.length&&zt(this):o.nextTick(Pt,this))}return It},mt.prototype.addListener=mt.prototype.on;function Pt(Lt){lt("readable nexttick read 0"),Lt.read(0)}mt.prototype.resume=function(){var Lt=this._readableState;return Lt.flowing||(lt("resume"),Lt.flowing=!0,Dt(this,Lt)),this};function Dt(Lt,bt){bt.resumeScheduled||(bt.resumeScheduled=!0,o.nextTick(Tt,Lt,bt))}function Tt(Lt,bt){bt.reading||(lt("resume read 0"),Lt.read(0)),bt.resumeScheduled=!1,bt.awaitDrain=0,Lt.emit("resume"),St(Lt),bt.flowing&&!bt.reading&&Lt.read(0)}mt.prototype.pause=function(){return lt("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(lt("pause"),this._readableState.flowing=!1,this.emit("pause")),this};function St(Lt){var bt=Lt._readableState;for(lt("flow",bt.flowing);bt.flowing&&Lt.read()!==null;);}mt.prototype.wrap=function(Lt){var bt=this,It=this._readableState,Ut=!1;Lt.on("end",function(){if(lt("wrapped end"),It.decoder&&!It.ended){var Qt=It.decoder.end();Qt&&Qt.length&&bt.push(Qt)}bt.push(null)}),Lt.on("data",function(Qt){if(lt("wrapped data"),It.decoder&&(Qt=It.decoder.write(Qt)),!(It.objectMode&&Qt==null)&&!(!It.objectMode&&(!Qt||!Qt.length))){var er=bt.push(Qt);er||(Ut=!0,Lt.pause())}});for(var Wt in Lt)this[Wt]===void 0&&typeof Lt[Wt]=="function"&&(this[Wt]=function(Qt){return function(){return Lt[Qt].apply(Lt,arguments)}}(Wt));for(var Xt=0;Xt<dt.length;Xt++)Lt.on(dt[Xt],this.emit.bind(this,dt[Xt]));return this._read=function(Qt){lt("wrapped _read",Qt),Ut&&(Ut=!1,Lt.resume())},this},Object.defineProperty(mt.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),mt._fromList=Mt;function Mt(Lt,bt){if(bt.length===0)return null;var It;return bt.objectMode?It=bt.buffer.shift():!Lt||Lt>=bt.length?(bt.decoder?It=bt.buffer.join(""):bt.buffer.length===1?It=bt.buffer.head.data:It=bt.buffer.concat(bt.length),bt.buffer.clear()):It=jt(Lt,bt.buffer,bt.decoder),It}function jt(Lt,bt,It){var Ut;return Lt<bt.head.data.length?(Ut=bt.head.data.slice(0,Lt),bt.head.data=bt.head.data.slice(Lt)):Lt===bt.head.data.length?Ut=bt.shift():Ut=It?Gt(Lt,bt):Ht(Lt,bt),Ut}function Gt(Lt,bt){var It=bt.head,Ut=1,Wt=It.data;for(Lt-=Wt.length;It=It.next;){var Xt=It.data,Qt=Lt>Xt.length?Xt.length:Lt;if(Qt===Xt.length?Wt+=Xt:Wt+=Xt.slice(0,Lt),Lt-=Qt,Lt===0){Qt===Xt.length?(++Ut,It.next?bt.head=It.next:bt.head=bt.tail=null):(bt.head=It,It.data=Xt.slice(Qt));break}++Ut}return bt.length-=Ut,Wt}function Ht(Lt,bt){var It=rt.allocUnsafe(Lt),Ut=bt.head,Wt=1;for(Ut.data.copy(It),Lt-=Ut.data.length;Ut=Ut.next;){var Xt=Ut.data,Qt=Lt>Xt.length?Xt.length:Lt;if(Xt.copy(It,It.length-Lt,0,Qt),Lt-=Qt,Lt===0){Qt===Xt.length?(++Wt,Ut.next?bt.head=Ut.next:bt.head=bt.tail=null):(bt.head=Ut,Ut.data=Xt.slice(Qt));break}++Wt}return bt.length-=Wt,It}function At(Lt){var bt=Lt._readableState;if(bt.length>0)throw new Error('"endReadable()" called on non-empty stream');bt.endEmitted||(bt.ended=!0,o.nextTick($t,bt,Lt))}function $t(Lt,bt){!Lt.endEmitted&&Lt.length===0&&(Lt.endEmitted=!0,bt.readable=!1,bt.emit("end"))}function kt(Lt,bt){for(var It=0,Ut=Lt.length;It<Ut;It++)if(Lt[It]===bt)return It;return-1}return _stream_readable}var _stream_transform=Transform$1,Duplex=require_stream_duplex(),util$4=Object.create(util$5);util$4.inherits=inherits_browserExports;util$4.inherits(Transform$1,Duplex);function afterTransform(o,s){var a=this._transformState;a.transforming=!1;var et=a.writecb;if(!et)return this.emit("error",new Error("write callback called multiple times"));a.writechunk=null,a.writecb=null,s!=null&&this.push(s),et(o);var tt=this._readableState;tt.reading=!1,(tt.needReadable||tt.length<tt.highWaterMark)&&this._read(tt.highWaterMark)}function Transform$1(o){if(!(this instanceof Transform$1))return new Transform$1(o);Duplex.call(this,o),this._transformState={afterTransform:afterTransform.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,o&&(typeof o.transform=="function"&&(this._transform=o.transform),typeof o.flush=="function"&&(this._flush=o.flush)),this.on("prefinish",prefinish)}function prefinish(){var o=this;typeof this._flush=="function"?this._flush(function(s,a){done(o,s,a)}):done(this,null,null)}Transform$1.prototype.push=function(o,s){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,o,s)};Transform$1.prototype._transform=function(o,s,a){throw new Error("_transform() is not implemented")};Transform$1.prototype._write=function(o,s,a){var et=this._transformState;if(et.writecb=a,et.writechunk=o,et.writeencoding=s,!et.transforming){var tt=this._readableState;(et.needTransform||tt.needReadable||tt.length<tt.highWaterMark)&&this._read(tt.highWaterMark)}};Transform$1.prototype._read=function(o){var s=this._transformState;s.writechunk!==null&&s.writecb&&!s.transforming?(s.transforming=!0,this._transform(s.writechunk,s.writeencoding,s.afterTransform)):s.needTransform=!0};Transform$1.prototype._destroy=function(o,s){var a=this;Duplex.prototype._destroy.call(this,o,function(et){s(et),a.emit("close")})};function done(o,s,a){if(s)return o.emit("error",s);if(a!=null&&o.push(a),o._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(o._transformState.transforming)throw new Error("Calling transform done when still transforming");return o.push(null)}var _stream_passthrough=PassThrough,Transform=_stream_transform,util$3=Object.create(util$5);util$3.inherits=inherits_browserExports;util$3.inherits(PassThrough,Transform);function PassThrough(o){if(!(this instanceof PassThrough))return new PassThrough(o);Transform.call(this,o)}PassThrough.prototype._transform=function(o,s,a){a(null,o)};(function(o,s){s=o.exports=require_stream_readable(),s.Stream=s,s.Readable=s,s.Writable=require_stream_writable(),s.Duplex=require_stream_duplex(),s.Transform=_stream_transform,s.PassThrough=_stream_passthrough})(readableBrowser,readableBrowser.exports);var readableBrowserExports=readableBrowser.exports,inherits$5=inherits_browserExports,Readable=readableBrowserExports.Readable,extend$2=immutable,levelIteratorStream=ReadStream;inherits$5(ReadStream,Readable);function ReadStream(o,s){if(!(this instanceof ReadStream))return new ReadStream(o,s);s=s||{},Readable.call(this,extend$2(s,{objectMode:!0})),this._iterator=o,this._options=s,this.on("end",this.destroy.bind(this,null,null))}ReadStream.prototype._read=function(){var o=this,s=this._options;this.destroyed||this._iterator.next(function(a,et,tt){if(!o.destroyed){if(a)return o.destroy(a);et===void 0&&tt===void 0?o.push(null):s.keys!==!1&&s.values===!1?o.push(et):s.keys===!1&&s.values!==!1?o.push(tt):o.push({key:et,value:tt})}})};ReadStream.prototype._destroy=function(o,s){var a=this;this._iterator.end(function(et){s(o||et),process$1.nextTick(function(){a.emit("close")})})};var errno={exports:{}},prr$1={exports:{}};/*!
  * prr
  * (c) 2013 Rod Vagg <rod@vagg.org>
  * https://github.com/rvagg/prr
  * License: MIT
  */(function(o){(function(s,a,et){o.exports?o.exports=et():a[s]=et()})("prr",commonjsGlobal,function(){var s=typeof Object.defineProperty=="function"?function(tt,rt,nt){return Object.defineProperty(tt,rt,nt),tt}:function(tt,rt,nt){return tt[rt]=nt.value,tt},a=function(tt,rt){var nt=typeof rt=="object",it=!nt&&typeof rt=="string",st=function(ot){return nt?!!rt[ot]:it?rt.indexOf(ot[0])>-1:!1};return{enumerable:st("enumerable"),configurable:st("configurable"),writable:st("writable"),value:tt}},et=function(tt,rt,nt,it){var st;if(it=a(nt,it),typeof rt=="object"){for(st in rt)Object.hasOwnProperty.call(rt,st)&&(it.value=rt[st],s(tt,st,it));return tt}return s(tt,rt,it)};return et})})(prr$1);var prrExports=prr$1.exports,prr=prrExports;function init(o,s,a){s&&typeof s!="string"&&(s=s.message||s.name),prr(this,{type:o,name:o,cause:typeof s!="string"?s:a,message:s},"ewr")}function CustomError(o,s){Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),init.call(this,"CustomError",o,s)}CustomError.prototype=new Error;function createError$2(o,s,a){var et=function(tt,rt){init.call(this,s,tt,rt),s=="FilesystemError"&&(this.code=this.cause.code,this.path=this.cause.path,this.errno=this.cause.errno,this.message=(o.errno[this.cause.errno]?o.errno[this.cause.errno].description:this.cause.message)+(this.cause.path?" ["+this.cause.path+"]":"")),Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,et)};return et.prototype=a?new a:new CustomError,et}var custom=function(o){var s=function(a,et){return createError$2(o,a,et)};return{CustomError,FilesystemError:s("FilesystemError"),createError:s}};(function(o){var s=o.exports.all=[{errno:-2,code:"ENOENT",description:"no such file or directory"},{errno:-1,code:"UNKNOWN",description:"unknown error"},{errno:0,code:"OK",description:"success"},{errno:1,code:"EOF",description:"end of file"},{errno:2,code:"EADDRINFO",description:"getaddrinfo error"},{errno:3,code:"EACCES",description:"permission denied"},{errno:4,code:"EAGAIN",description:"resource temporarily unavailable"},{errno:5,code:"EADDRINUSE",description:"address already in use"},{errno:6,code:"EADDRNOTAVAIL",description:"address not available"},{errno:7,code:"EAFNOSUPPORT",description:"address family not supported"},{errno:8,code:"EALREADY",description:"connection already in progress"},{errno:9,code:"EBADF",description:"bad file descriptor"},{errno:10,code:"EBUSY",description:"resource busy or locked"},{errno:11,code:"ECONNABORTED",description:"software caused connection abort"},{errno:12,code:"ECONNREFUSED",description:"connection refused"},{errno:13,code:"ECONNRESET",description:"connection reset by peer"},{errno:14,code:"EDESTADDRREQ",description:"destination address required"},{errno:15,code:"EFAULT",description:"bad address in system call argument"},{errno:16,code:"EHOSTUNREACH",description:"host is unreachable"},{errno:17,code:"EINTR",description:"interrupted system call"},{errno:18,code:"EINVAL",description:"invalid argument"},{errno:19,code:"EISCONN",description:"socket is already connected"},{errno:20,code:"EMFILE",description:"too many open files"},{errno:21,code:"EMSGSIZE",description:"message too long"},{errno:22,code:"ENETDOWN",description:"network is down"},{errno:23,code:"ENETUNREACH",description:"network is unreachable"},{errno:24,code:"ENFILE",description:"file table overflow"},{errno:25,code:"ENOBUFS",description:"no buffer space available"},{errno:26,code:"ENOMEM",description:"not enough memory"},{errno:27,code:"ENOTDIR",description:"not a directory"},{errno:28,code:"EISDIR",description:"illegal operation on a directory"},{errno:29,code:"ENONET",description:"machine is not on the network"},{errno:31,code:"ENOTCONN",description:"socket is not connected"},{errno:32,code:"ENOTSOCK",description:"socket operation on non-socket"},{errno:33,code:"ENOTSUP",description:"operation not supported on socket"},{errno:34,code:"ENOENT",description:"no such file or directory"},{errno:35,code:"ENOSYS",description:"function not implemented"},{errno:36,code:"EPIPE",description:"broken pipe"},{errno:37,code:"EPROTO",description:"protocol error"},{errno:38,code:"EPROTONOSUPPORT",description:"protocol not supported"},{errno:39,code:"EPROTOTYPE",description:"protocol wrong type for socket"},{errno:40,code:"ETIMEDOUT",description:"connection timed out"},{errno:41,code:"ECHARSET",description:"invalid Unicode character"},{errno:42,code:"EAIFAMNOSUPPORT",description:"address family for hostname not supported"},{errno:44,code:"EAISERVICE",description:"servname not supported for ai_socktype"},{errno:45,code:"EAISOCKTYPE",description:"ai_socktype not supported"},{errno:46,code:"ESHUTDOWN",description:"cannot send after transport endpoint shutdown"},{errno:47,code:"EEXIST",description:"file already exists"},{errno:48,code:"ESRCH",description:"no such process"},{errno:49,code:"ENAMETOOLONG",description:"name too long"},{errno:50,code:"EPERM",description:"operation not permitted"},{errno:51,code:"ELOOP",description:"too many symbolic links encountered"},{errno:52,code:"EXDEV",description:"cross-device link not permitted"},{errno:53,code:"ENOTEMPTY",description:"directory not empty"},{errno:54,code:"ENOSPC",description:"no space left on device"},{errno:55,code:"EIO",description:"i/o error"},{errno:56,code:"EROFS",description:"read-only file system"},{errno:57,code:"ENODEV",description:"no such device"},{errno:58,code:"ESPIPE",description:"invalid seek"},{errno:59,code:"ECANCELED",description:"operation canceled"}];o.exports.errno={},o.exports.code={},s.forEach(function(a){o.exports.errno[a.errno]=a,o.exports.code[a.code]=a}),o.exports.custom=custom(o.exports),o.exports.create=o.exports.custom.createError})(errno);var errnoExports=errno.exports,createError$1=errnoExports.create,LevelUPError=createError$1("LevelUPError"),NotFoundError$1=createError$1("NotFoundError",LevelUPError);NotFoundError$1.prototype.notFound=!0;NotFoundError$1.prototype.status=404;var errors$2={LevelUPError,InitializationError:createError$1("InitializationError",LevelUPError),OpenError:createError$1("OpenError",LevelUPError),ReadError:createError$1("ReadError",LevelUPError),WriteError:createError$1("WriteError",LevelUPError),NotFoundError:NotFoundError$1,EncodingError:createError$1("EncodingError",LevelUPError)};function promisify$2(){var o,s=new Promise(function(a,et){o=function(rt,nt){rt?et(rt):a(nt)}});return o.promise=s,o}var promisify_1=promisify$2,common$3={};common$3.getCallback=function(o,s){return typeof o=="function"?o:s};common$3.getOptions=function(o){return typeof o=="object"&&o!==null?o:{}};var WriteError$1=errors$2.WriteError,promisify$1=promisify_1,getCallback$2=common$3.getCallback,getOptions$2=common$3.getOptions;function Batch$2(o){this._levelup=o,this.batch=o.db.batch(),this.ops=[],this.length=0}Batch$2.prototype.put=function(o,s){try{this.batch.put(o,s)}catch(a){throw new WriteError$1(a)}return this.ops.push({type:"put",key:o,value:s}),this.length++,this};Batch$2.prototype.del=function(o){try{this.batch.del(o)}catch(s){throw new WriteError$1(s)}return this.ops.push({type:"del",key:o}),this.length++,this};Batch$2.prototype.clear=function(){try{this.batch.clear()}catch(o){throw new WriteError$1(o)}return this.ops=[],this.length=0,this};Batch$2.prototype.write=function(o,s){var a=this._levelup,et=this.ops,tt;s=getCallback$2(o,s),s||(s=promisify$1(),tt=s.promise),o=getOptions$2(o);try{this.batch.write(o,function(rt){if(rt)return s(new WriteError$1(rt));a.emit("batch",et),s()})}catch(rt){throw new WriteError$1(rt)}return tt};var batch$1=Batch$2,assert$1={exports:{}},errors$1={},hasRequiredErrors;function requireErrors(){if(hasRequiredErrors)return errors$1;hasRequiredErrors=1;function o(mt){"@babel/helpers - typeof";return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(yt){return typeof yt}:function(yt){return yt&&typeof Symbol=="function"&&yt.constructor===Symbol&&yt!==Symbol.prototype?"symbol":typeof yt},o(mt)}function s(mt,yt,vt){return Object.defineProperty(mt,"prototype",{writable:!1}),mt}function a(mt,yt){if(!(mt instanceof yt))throw new TypeError("Cannot call a class as a function")}function et(mt,yt){if(typeof yt!="function"&&yt!==null)throw new TypeError("Super expression must either be null or a function");mt.prototype=Object.create(yt&&yt.prototype,{constructor:{value:mt,writable:!0,configurable:!0}}),Object.defineProperty(mt,"prototype",{writable:!1}),yt&&tt(mt,yt)}function tt(mt,yt){return tt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(Et,xt){return Et.__proto__=xt,Et},tt(mt,yt)}function rt(mt){var yt=st();return function(){var Et=ot(mt),xt;if(yt){var wt=ot(this).constructor;xt=Reflect.construct(Et,arguments,wt)}else xt=Et.apply(this,arguments);return nt(this,xt)}}function nt(mt,yt){if(yt&&(o(yt)==="object"||typeof yt=="function"))return yt;if(yt!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return it(mt)}function it(mt){if(mt===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return mt}function st(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ot(mt){return ot=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(vt){return vt.__proto__||Object.getPrototypeOf(vt)},ot(mt)}var at={},lt,ct;function ht(mt,yt,vt){vt||(vt=Error);function Et(wt,Rt,Ct){return typeof yt=="string"?yt:yt(wt,Rt,Ct)}var xt=function(wt){et(Ct,wt);var Rt=rt(Ct);function Ct(Ft,zt,Nt){var Kt;return a(this,Ct),Kt=Rt.call(this,Et(Ft,zt,Nt)),Kt.code=mt,Kt}return s(Ct)}(vt);at[mt]=xt}function ft(mt,yt){if(Array.isArray(mt)){var vt=mt.length;return mt=mt.map(function(Et){return String(Et)}),vt>2?"one of ".concat(yt," ").concat(mt.slice(0,vt-1).join(", "),", or ")+mt[vt-1]:vt===2?"one of ".concat(yt," ").concat(mt[0]," or ").concat(mt[1]):"of ".concat(yt," ").concat(mt[0])}else return"of ".concat(yt," ").concat(String(mt))}function dt(mt,yt,vt){return mt.substr(0,yt.length)===yt}function pt(mt,yt,vt){return(vt===void 0||vt>mt.length)&&(vt=mt.length),mt.substring(vt-yt.length,vt)===yt}function gt(mt,yt,vt){return typeof vt!="number"&&(vt=0),vt+yt.length>mt.length?!1:mt.indexOf(yt,vt)!==-1}return ht("ERR_AMBIGUOUS_ARGUMENT",'The "%s" argument is ambiguous. %s',TypeError),ht("ERR_INVALID_ARG_TYPE",function(mt,yt,vt){lt===void 0&&(lt=requireAssert()),lt(typeof mt=="string","'name' must be a string");var Et;typeof yt=="string"&&dt(yt,"not ")?(Et="must not be",yt=yt.replace(/^not /,"")):Et="must be";var xt;if(pt(mt," argument"))xt="The ".concat(mt," ").concat(Et," ").concat(ft(yt,"type"));else{var wt=gt(mt,".")?"property":"argument";xt='The "'.concat(mt,'" ').concat(wt," ").concat(Et," ").concat(ft(yt,"type"))}return xt+=". Received type ".concat(o(vt)),xt},TypeError),ht("ERR_INVALID_ARG_VALUE",function(mt,yt){var vt=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"is invalid";ct===void 0&&(ct=util$b);var Et=ct.inspect(yt);return Et.length>128&&(Et="".concat(Et.slice(0,128),"...")),"The argument '".concat(mt,"' ").concat(vt,". Received ").concat(Et)},TypeError),ht("ERR_INVALID_RETURN_VALUE",function(mt,yt,vt){var Et;return vt&&vt.constructor&&vt.constructor.name?Et="instance of ".concat(vt.constructor.name):Et="type ".concat(o(vt)),"Expected ".concat(mt,' to be returned from the "').concat(yt,'"')+" function but got ".concat(Et,".")},TypeError),ht("ERR_MISSING_ARGS",function(){for(var mt=arguments.length,yt=new Array(mt),vt=0;vt<mt;vt++)yt[vt]=arguments[vt];lt===void 0&&(lt=requireAssert()),lt(yt.length>0,"At least one arg needs to be specified");var Et="The ",xt=yt.length;switch(yt=yt.map(function(wt){return'"'.concat(wt,'"')}),xt){case 1:Et+="".concat(yt[0]," argument");break;case 2:Et+="".concat(yt[0]," and ").concat(yt[1]," arguments");break;default:Et+=yt.slice(0,xt-1).join(", "),Et+=", and ".concat(yt[xt-1]," arguments");break}return"".concat(Et," must be specified")},TypeError),errors$1.codes=at,errors$1}var assertion_error,hasRequiredAssertion_error;function requireAssertion_error(){if(hasRequiredAssertion_error)return assertion_error;hasRequiredAssertion_error=1;function o(St,Mt){var jt=Object.keys(St);if(Object.getOwnPropertySymbols){var Gt=Object.getOwnPropertySymbols(St);Mt&&(Gt=Gt.filter(function(Ht){return Object.getOwnPropertyDescriptor(St,Ht).enumerable})),jt.push.apply(jt,Gt)}return jt}function s(St){for(var Mt=1;Mt<arguments.length;Mt++){var jt=arguments[Mt]!=null?arguments[Mt]:{};Mt%2?o(Object(jt),!0).forEach(function(Gt){a(St,Gt,jt[Gt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(St,Object.getOwnPropertyDescriptors(jt)):o(Object(jt)).forEach(function(Gt){Object.defineProperty(St,Gt,Object.getOwnPropertyDescriptor(jt,Gt))})}return St}function a(St,Mt,jt){return Mt=nt(Mt),Mt in St?Object.defineProperty(St,Mt,{value:jt,enumerable:!0,configurable:!0,writable:!0}):St[Mt]=jt,St}function et(St,Mt){if(!(St instanceof Mt))throw new TypeError("Cannot call a class as a function")}function tt(St,Mt){for(var jt=0;jt<Mt.length;jt++){var Gt=Mt[jt];Gt.enumerable=Gt.enumerable||!1,Gt.configurable=!0,"value"in Gt&&(Gt.writable=!0),Object.defineProperty(St,nt(Gt.key),Gt)}}function rt(St,Mt,jt){return Mt&&tt(St.prototype,Mt),Object.defineProperty(St,"prototype",{writable:!1}),St}function nt(St){var Mt=it(St,"string");return mt(Mt)==="symbol"?Mt:String(Mt)}function it(St,Mt){if(mt(St)!=="object"||St===null)return St;var jt=St[Symbol.toPrimitive];if(jt!==void 0){var Gt=jt.call(St,Mt||"default");if(mt(Gt)!=="object")return Gt;throw new TypeError("@@toPrimitive must return a primitive value.")}return(Mt==="string"?String:Number)(St)}function st(St,Mt){if(typeof Mt!="function"&&Mt!==null)throw new TypeError("Super expression must either be null or a function");St.prototype=Object.create(Mt&&Mt.prototype,{constructor:{value:St,writable:!0,configurable:!0}}),Object.defineProperty(St,"prototype",{writable:!1}),Mt&&pt(St,Mt)}function ot(St){var Mt=ft();return function(){var Gt=gt(St),Ht;if(Mt){var At=gt(this).constructor;Ht=Reflect.construct(Gt,arguments,At)}else Ht=Gt.apply(this,arguments);return at(this,Ht)}}function at(St,Mt){if(Mt&&(mt(Mt)==="object"||typeof Mt=="function"))return Mt;if(Mt!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return lt(St)}function lt(St){if(St===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return St}function ct(St){var Mt=typeof Map=="function"?new Map:void 0;return ct=function(Gt){if(Gt===null||!dt(Gt))return Gt;if(typeof Gt!="function")throw new TypeError("Super expression must either be null or a function");if(typeof Mt<"u"){if(Mt.has(Gt))return Mt.get(Gt);Mt.set(Gt,Ht)}function Ht(){return ht(Gt,arguments,gt(this).constructor)}return Ht.prototype=Object.create(Gt.prototype,{constructor:{value:Ht,enumerable:!1,writable:!0,configurable:!0}}),pt(Ht,Gt)},ct(St)}function ht(St,Mt,jt){return ft()?ht=Reflect.construct.bind():ht=function(Ht,At,$t){var kt=[null];kt.push.apply(kt,At);var Lt=Function.bind.apply(Ht,kt),bt=new Lt;return $t&&pt(bt,$t.prototype),bt},ht.apply(null,arguments)}function ft(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function dt(St){return Function.toString.call(St).indexOf("[native code]")!==-1}function pt(St,Mt){return pt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(Gt,Ht){return Gt.__proto__=Ht,Gt},pt(St,Mt)}function gt(St){return gt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(jt){return jt.__proto__||Object.getPrototypeOf(jt)},gt(St)}function mt(St){"@babel/helpers - typeof";return mt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Mt){return typeof Mt}:function(Mt){return Mt&&typeof Symbol=="function"&&Mt.constructor===Symbol&&Mt!==Symbol.prototype?"symbol":typeof Mt},mt(St)}var yt=util$b,vt=yt.inspect,Et=requireErrors(),xt=Et.codes.ERR_INVALID_ARG_TYPE;function wt(St,Mt,jt){return(jt===void 0||jt>St.length)&&(jt=St.length),St.substring(jt-Mt.length,jt)===Mt}function Rt(St,Mt){if(Mt=Math.floor(Mt),St.length==0||Mt==0)return"";var jt=St.length*Mt;for(Mt=Math.floor(Math.log(Mt)/Math.log(2));Mt;)St+=St,Mt--;return St+=St.substring(0,jt-St.length),St}var Ct="",Ft="",zt="",Nt="",Kt={deepStrictEqual:"Expected values to be strictly deep-equal:",strictEqual:"Expected values to be strictly equal:",strictEqualObject:'Expected "actual" to be reference-equal to "expected":',deepEqual:"Expected values to be loosely deep-equal:",equal:"Expected values to be loosely equal:",notDeepStrictEqual:'Expected "actual" not to be strictly deep-equal to:',notStrictEqual:'Expected "actual" to be strictly unequal to:',notStrictEqualObject:'Expected "actual" not to be reference-equal to "expected":',notDeepEqual:'Expected "actual" not to be loosely deep-equal to:',notEqual:'Expected "actual" to be loosely unequal to:',notIdentical:"Values identical but not reference-equal:"},Yt=10;function Bt(St){var Mt=Object.keys(St),jt=Object.create(Object.getPrototypeOf(St));return Mt.forEach(function(Gt){jt[Gt]=St[Gt]}),Object.defineProperty(jt,"message",{value:St.message}),jt}function Pt(St){return vt(St,{compact:!1,customInspect:!1,depth:1e3,maxArrayLength:1/0,showHidden:!1,breakLength:1/0,showProxy:!1,sorted:!0,getters:!0})}function Dt(St,Mt,jt){var Gt="",Ht="",At=0,$t="",kt=!1,Lt=Pt(St),bt=Lt.split(`
`),It=Pt(Mt).split(`
`),Ut=0,Wt="";if(jt==="strictEqual"&&mt(St)==="object"&&mt(Mt)==="object"&&St!==null&&Mt!==null&&(jt="strictEqualObject"),bt.length===1&&It.length===1&&bt[0]!==It[0]){var Xt=bt[0].length+It[0].length;if(Xt<=Yt){if((mt(St)!=="object"||St===null)&&(mt(Mt)!=="object"||Mt===null)&&(St!==0||Mt!==0))return"".concat(Kt[jt],`

`)+"".concat(bt[0]," !== ").concat(It[0],`
`)}else if(jt!=="strictEqualObject"){var Qt=process$1.stderr&&process$1.stderr.isTTY?process$1.stderr.columns:80;if(Xt<Qt){for(;bt[0][Ut]===It[0][Ut];)Ut++;Ut>2&&(Wt=`
  `.concat(Rt(" ",Ut),"^"),Ut=0)}}}for(var er=bt[bt.length-1],lr=It[It.length-1];er===lr&&(Ut++<2?$t=`
  `.concat(er).concat($t):Gt=er,bt.pop(),It.pop(),!(bt.length===0||It.length===0));)er=bt[bt.length-1],lr=It[It.length-1];var pr=Math.max(bt.length,It.length);if(pr===0){var gr=Lt.split(`
`);if(gr.length>30)for(gr[26]="".concat(Ct,"...").concat(Nt);gr.length>27;)gr.pop();return"".concat(Kt.notIdentical,`

`).concat(gr.join(`
`),`
`)}Ut>3&&($t=`
`.concat(Ct,"...").concat(Nt).concat($t),kt=!0),Gt!==""&&($t=`
  `.concat(Gt).concat($t),Gt="");var wr=0,cr=Kt[jt]+`
`.concat(Ft,"+ actual").concat(Nt," ").concat(zt,"- expected").concat(Nt),Cr=" ".concat(Ct,"...").concat(Nt," Lines skipped");for(Ut=0;Ut<pr;Ut++){var _r=Ut-At;if(bt.length<Ut+1)_r>1&&Ut>2&&(_r>4?(Ht+=`
`.concat(Ct,"...").concat(Nt),kt=!0):_r>3&&(Ht+=`
  `.concat(It[Ut-2]),wr++),Ht+=`
  `.concat(It[Ut-1]),wr++),At=Ut,Gt+=`
`.concat(zt,"-").concat(Nt," ").concat(It[Ut]),wr++;else if(It.length<Ut+1)_r>1&&Ut>2&&(_r>4?(Ht+=`
`.concat(Ct,"...").concat(Nt),kt=!0):_r>3&&(Ht+=`
  `.concat(bt[Ut-2]),wr++),Ht+=`
  `.concat(bt[Ut-1]),wr++),At=Ut,Ht+=`
`.concat(Ft,"+").concat(Nt," ").concat(bt[Ut]),wr++;else{var kr=It[Ut],Ir=bt[Ut],tr=Ir!==kr&&(!wt(Ir,",")||Ir.slice(0,-1)!==kr);tr&&wt(kr,",")&&kr.slice(0,-1)===Ir&&(tr=!1,Ir+=","),tr?(_r>1&&Ut>2&&(_r>4?(Ht+=`
`.concat(Ct,"...").concat(Nt),kt=!0):_r>3&&(Ht+=`
  `.concat(bt[Ut-2]),wr++),Ht+=`
  `.concat(bt[Ut-1]),wr++),At=Ut,Ht+=`
`.concat(Ft,"+").concat(Nt," ").concat(Ir),Gt+=`
`.concat(zt,"-").concat(Nt," ").concat(kr),wr+=2):(Ht+=Gt,Gt="",(_r===1||Ut===0)&&(Ht+=`
  `.concat(Ir),wr++))}if(wr>20&&Ut<pr-2)return"".concat(cr).concat(Cr,`
`).concat(Ht,`
`).concat(Ct,"...").concat(Nt).concat(Gt,`
`)+"".concat(Ct,"...").concat(Nt)}return"".concat(cr).concat(kt?Cr:"",`
`).concat(Ht).concat(Gt).concat($t).concat(Wt)}var Tt=function(St,Mt){st(Gt,St);var jt=ot(Gt);function Gt(Ht){var At;if(et(this,Gt),mt(Ht)!=="object"||Ht===null)throw new xt("options","Object",Ht);var $t=Ht.message,kt=Ht.operator,Lt=Ht.stackStartFn,bt=Ht.actual,It=Ht.expected,Ut=Error.stackTraceLimit;if(Error.stackTraceLimit=0,$t!=null)At=jt.call(this,String($t));else if(process$1.stderr&&process$1.stderr.isTTY&&(process$1.stderr&&process$1.stderr.getColorDepth&&process$1.stderr.getColorDepth()!==1?(Ct="\x1B[34m",Ft="\x1B[32m",Nt="\x1B[39m",zt="\x1B[31m"):(Ct="",Ft="",Nt="",zt="")),mt(bt)==="object"&&bt!==null&&mt(It)==="object"&&It!==null&&"stack"in bt&&bt instanceof Error&&"stack"in It&&It instanceof Error&&(bt=Bt(bt),It=Bt(It)),kt==="deepStrictEqual"||kt==="strictEqual")At=jt.call(this,Dt(bt,It,kt));else if(kt==="notDeepStrictEqual"||kt==="notStrictEqual"){var Wt=Kt[kt],Xt=Pt(bt).split(`
`);if(kt==="notStrictEqual"&&mt(bt)==="object"&&bt!==null&&(Wt=Kt.notStrictEqualObject),Xt.length>30)for(Xt[26]="".concat(Ct,"...").concat(Nt);Xt.length>27;)Xt.pop();Xt.length===1?At=jt.call(this,"".concat(Wt," ").concat(Xt[0])):At=jt.call(this,"".concat(Wt,`

`).concat(Xt.join(`
`),`
`))}else{var Qt=Pt(bt),er="",lr=Kt[kt];kt==="notDeepEqual"||kt==="notEqual"?(Qt="".concat(Kt[kt],`

`).concat(Qt),Qt.length>1024&&(Qt="".concat(Qt.slice(0,1021),"..."))):(er="".concat(Pt(It)),Qt.length>512&&(Qt="".concat(Qt.slice(0,509),"...")),er.length>512&&(er="".concat(er.slice(0,509),"...")),kt==="deepEqual"||kt==="equal"?Qt="".concat(lr,`

`).concat(Qt,`

should equal

`):er=" ".concat(kt," ").concat(er)),At=jt.call(this,"".concat(Qt).concat(er))}return Error.stackTraceLimit=Ut,At.generatedMessage=!$t,Object.defineProperty(lt(At),"name",{value:"AssertionError [ERR_ASSERTION]",enumerable:!1,writable:!0,configurable:!0}),At.code="ERR_ASSERTION",At.actual=bt,At.expected=It,At.operator=kt,Error.captureStackTrace&&Error.captureStackTrace(lt(At),Lt),At.stack,At.name="AssertionError",at(At)}return rt(Gt,[{key:"toString",value:function(){return"".concat(this.name," [").concat(this.code,"]: ").concat(this.message)}},{key:Mt,value:function(At,$t){return vt(this,s(s({},$t),{},{customInspect:!1,depth:0}))}}]),Gt}(ct(Error),vt.custom);return assertion_error=Tt,assertion_error}var toStr$1=Object.prototype.toString,isArguments=function(s){var a=toStr$1.call(s),et=a==="[object Arguments]";return et||(et=a!=="[object Array]"&&s!==null&&typeof s=="object"&&typeof s.length=="number"&&s.length>=0&&toStr$1.call(s.callee)==="[object Function]"),et},implementation$6,hasRequiredImplementation$1;function requireImplementation$1(){if(hasRequiredImplementation$1)return implementation$6;hasRequiredImplementation$1=1;var o;if(!Object.keys){var s=Object.prototype.hasOwnProperty,a=Object.prototype.toString,et=isArguments,tt=Object.prototype.propertyIsEnumerable,rt=!tt.call({toString:null},"toString"),nt=tt.call(function(){},"prototype"),it=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],st=function(ct){var ht=ct.constructor;return ht&&ht.prototype===ct},ot={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},at=function(){if(typeof window>"u")return!1;for(var ct in window)try{if(!ot["$"+ct]&&s.call(window,ct)&&window[ct]!==null&&typeof window[ct]=="object")try{st(window[ct])}catch{return!0}}catch{return!0}return!1}(),lt=function(ct){if(typeof window>"u"||!at)return st(ct);try{return st(ct)}catch{return!1}};o=function(ht){var ft=ht!==null&&typeof ht=="object",dt=a.call(ht)==="[object Function]",pt=et(ht),gt=ft&&a.call(ht)==="[object String]",mt=[];if(!ft&&!dt&&!pt)throw new TypeError("Object.keys called on a non-object");var yt=nt&&dt;if(gt&&ht.length>0&&!s.call(ht,0))for(var vt=0;vt<ht.length;++vt)mt.push(String(vt));if(pt&&ht.length>0)for(var Et=0;Et<ht.length;++Et)mt.push(String(Et));else for(var xt in ht)!(yt&&xt==="prototype")&&s.call(ht,xt)&&mt.push(String(xt));if(rt)for(var wt=lt(ht),Rt=0;Rt<it.length;++Rt)!(wt&&it[Rt]==="constructor")&&s.call(ht,it[Rt])&&mt.push(it[Rt]);return mt}}return implementation$6=o,implementation$6}var slice$2=Array.prototype.slice,isArgs=isArguments,origKeys=Object.keys,keysShim=origKeys?function(s){return origKeys(s)}:requireImplementation$1(),originalKeys=Object.keys;keysShim.shim=function(){if(Object.keys){var s=function(){var a=Object.keys(arguments);return a&&a.length===arguments.length}(1,2);s||(Object.keys=function(et){return isArgs(et)?originalKeys(slice$2.call(et)):originalKeys(et)})}else Object.keys=keysShim;return Object.keys||keysShim};var objectKeys$1=keysShim,objectKeys=objectKeys$1,hasSymbols=shams$1(),callBound=callBound$3,toObject=Object,$push=callBound("Array.prototype.push"),$propIsEnumerable=callBound("Object.prototype.propertyIsEnumerable"),originalGetSymbols=hasSymbols?Object.getOwnPropertySymbols:null,implementation$5=function(s,a){if(s==null)throw new TypeError("target must be an object");var et=toObject(s);if(arguments.length===1)return et;for(var tt=1;tt<arguments.length;++tt){var rt=toObject(arguments[tt]),nt=objectKeys(rt),it=hasSymbols&&(Object.getOwnPropertySymbols||originalGetSymbols);if(it)for(var st=it(rt),ot=0;ot<st.length;++ot){var at=st[ot];$propIsEnumerable(rt,at)&&$push(nt,at)}for(var lt=0;lt<nt.length;++lt){var ct=nt[lt];if($propIsEnumerable(rt,ct)){var ht=rt[ct];et[ct]=ht}}}return et},implementation$4=implementation$5,lacksProperEnumerationOrder=function(){if(!Object.assign)return!1;for(var o="abcdefghijklmnopqrst",s=o.split(""),a={},et=0;et<s.length;++et)a[s[et]]=s[et];var tt=Object.assign({},a),rt="";for(var nt in tt)rt+=nt;return o!==rt},assignHasPendingExceptions=function(){if(!Object.assign||!Object.preventExtensions)return!1;var o=Object.preventExtensions({1:2});try{Object.assign(o,"xy")}catch{return o[1]==="y"}return!1},polyfill$2=function(){return!Object.assign||lacksProperEnumerationOrder()||assignHasPendingExceptions()?implementation$4:Object.assign},numberIsNaN=function(o){return o!==o},implementation$3=function(s,a){return s===0&&a===0?1/s===1/a:!!(s===a||numberIsNaN(s)&&numberIsNaN(a))},implementation$2=implementation$3,polyfill$1=function(){return typeof Object.is=="function"?Object.is:implementation$2},defineProperties_1,hasRequiredDefineProperties;function requireDefineProperties(){if(hasRequiredDefineProperties)return defineProperties_1;hasRequiredDefineProperties=1;var o=objectKeys$1,s=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",a=Object.prototype.toString,et=Array.prototype.concat,tt=defineDataProperty,rt=function(ot){return typeof ot=="function"&&a.call(ot)==="[object Function]"},nt=hasPropertyDescriptors_1(),it=function(ot,at,lt,ct){if(at in ot){if(ct===!0){if(ot[at]===lt)return}else if(!rt(ct)||!ct())return}nt?tt(ot,at,lt,!0):tt(ot,at,lt)},st=function(ot,at){var lt=arguments.length>2?arguments[2]:{},ct=o(at);s&&(ct=et.call(ct,Object.getOwnPropertySymbols(at)));for(var ht=0;ht<ct.length;ht+=1)it(ot,ct[ht],at[ct[ht]],lt[ct[ht]])};return st.supportsDescriptors=!!nt,defineProperties_1=st,defineProperties_1}var shim$1,hasRequiredShim$1;function requireShim$1(){if(hasRequiredShim$1)return shim$1;hasRequiredShim$1=1;var o=polyfill$1,s=requireDefineProperties();return shim$1=function(){var et=o();return s(Object,{is:et},{is:function(){return Object.is!==et}}),et},shim$1}var objectIs,hasRequiredObjectIs;function requireObjectIs(){if(hasRequiredObjectIs)return objectIs;hasRequiredObjectIs=1;var o=requireDefineProperties(),s=callBindExports,a=implementation$3,et=polyfill$1,tt=requireShim$1(),rt=s(et(),Object);return o(rt,{getPolyfill:et,implementation:a,shim:tt}),objectIs=rt,objectIs}var implementation$1,hasRequiredImplementation;function requireImplementation(){return hasRequiredImplementation||(hasRequiredImplementation=1,implementation$1=function(s){return s!==s}),implementation$1}var polyfill,hasRequiredPolyfill;function requirePolyfill(){if(hasRequiredPolyfill)return polyfill;hasRequiredPolyfill=1;var o=requireImplementation();return polyfill=function(){return Number.isNaN&&Number.isNaN(NaN)&&!Number.isNaN("a")?Number.isNaN:o},polyfill}var shim,hasRequiredShim;function requireShim(){if(hasRequiredShim)return shim;hasRequiredShim=1;var o=requireDefineProperties(),s=requirePolyfill();return shim=function(){var et=s();return o(Number,{isNaN:et},{isNaN:function(){return Number.isNaN!==et}}),et},shim}var isNan,hasRequiredIsNan;function requireIsNan(){if(hasRequiredIsNan)return isNan;hasRequiredIsNan=1;var o=callBindExports,s=requireDefineProperties(),a=requireImplementation(),et=requirePolyfill(),tt=requireShim(),rt=o(et(),Number);return s(rt,{getPolyfill:et,implementation:a,shim:tt}),isNan=rt,isNan}var comparisons,hasRequiredComparisons;function requireComparisons(){if(hasRequiredComparisons)return comparisons;hasRequiredComparisons=1;function o(tr,sr){return rt(tr)||tt(tr,sr)||a(tr,sr)||s()}function s(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function a(tr,sr){if(tr){if(typeof tr=="string")return et(tr,sr);var vr=Object.prototype.toString.call(tr).slice(8,-1);if(vr==="Object"&&tr.constructor&&(vr=tr.constructor.name),vr==="Map"||vr==="Set")return Array.from(tr);if(vr==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(vr))return et(tr,sr)}}function et(tr,sr){(sr==null||sr>tr.length)&&(sr=tr.length);for(var vr=0,xr=new Array(sr);vr<sr;vr++)xr[vr]=tr[vr];return xr}function tt(tr,sr){var vr=tr==null?null:typeof Symbol<"u"&&tr[Symbol.iterator]||tr["@@iterator"];if(vr!=null){var xr,Er,Sr,$r,Or=[],Nr=!0,Rr=!1;try{if(Sr=(vr=vr.call(tr)).next,sr!==0)for(;!(Nr=(xr=Sr.call(vr)).done)&&(Or.push(xr.value),Or.length!==sr);Nr=!0);}catch(Dr){Rr=!0,Er=Dr}finally{try{if(!Nr&&vr.return!=null&&($r=vr.return(),Object($r)!==$r))return}finally{if(Rr)throw Er}}return Or}}function rt(tr){if(Array.isArray(tr))return tr}function nt(tr){"@babel/helpers - typeof";return nt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(sr){return typeof sr}:function(sr){return sr&&typeof Symbol=="function"&&sr.constructor===Symbol&&sr!==Symbol.prototype?"symbol":typeof sr},nt(tr)}var it=/a/g.flags!==void 0,st=function(sr){var vr=[];return sr.forEach(function(xr){return vr.push(xr)}),vr},ot=function(sr){var vr=[];return sr.forEach(function(xr,Er){return vr.push([Er,xr])}),vr},at=Object.is?Object.is:requireObjectIs(),lt=Object.getOwnPropertySymbols?Object.getOwnPropertySymbols:function(){return[]},ct=Number.isNaN?Number.isNaN:requireIsNan();function ht(tr){return tr.call.bind(tr)}var ft=ht(Object.prototype.hasOwnProperty),dt=ht(Object.prototype.propertyIsEnumerable),pt=ht(Object.prototype.toString),gt=util$b.types,mt=gt.isAnyArrayBuffer,yt=gt.isArrayBufferView,vt=gt.isDate,Et=gt.isMap,xt=gt.isRegExp,wt=gt.isSet,Rt=gt.isNativeError,Ct=gt.isBoxedPrimitive,Ft=gt.isNumberObject,zt=gt.isStringObject,Nt=gt.isBooleanObject,Kt=gt.isBigIntObject,Yt=gt.isSymbolObject,Bt=gt.isFloat32Array,Pt=gt.isFloat64Array;function Dt(tr){if(tr.length===0||tr.length>10)return!0;for(var sr=0;sr<tr.length;sr++){var vr=tr.charCodeAt(sr);if(vr<48||vr>57)return!0}return tr.length===10&&tr>=Math.pow(2,32)}function Tt(tr){return Object.keys(tr).filter(Dt).concat(lt(tr).filter(Object.prototype.propertyIsEnumerable.bind(tr)))}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function St(tr,sr){if(tr===sr)return 0;for(var vr=tr.length,xr=sr.length,Er=0,Sr=Math.min(vr,xr);Er<Sr;++Er)if(tr[Er]!==sr[Er]){vr=tr[Er],xr=sr[Er];break}return vr<xr?-1:xr<vr?1:0}var Mt=!0,jt=!1,Gt=0,Ht=1,At=2,$t=3;function kt(tr,sr){return it?tr.source===sr.source&&tr.flags===sr.flags:RegExp.prototype.toString.call(tr)===RegExp.prototype.toString.call(sr)}function Lt(tr,sr){if(tr.byteLength!==sr.byteLength)return!1;for(var vr=0;vr<tr.byteLength;vr++)if(tr[vr]!==sr[vr])return!1;return!0}function bt(tr,sr){return tr.byteLength!==sr.byteLength?!1:St(new Uint8Array(tr.buffer,tr.byteOffset,tr.byteLength),new Uint8Array(sr.buffer,sr.byteOffset,sr.byteLength))===0}function It(tr,sr){return tr.byteLength===sr.byteLength&&St(new Uint8Array(tr),new Uint8Array(sr))===0}function Ut(tr,sr){return Ft(tr)?Ft(sr)&&at(Number.prototype.valueOf.call(tr),Number.prototype.valueOf.call(sr)):zt(tr)?zt(sr)&&String.prototype.valueOf.call(tr)===String.prototype.valueOf.call(sr):Nt(tr)?Nt(sr)&&Boolean.prototype.valueOf.call(tr)===Boolean.prototype.valueOf.call(sr):Kt(tr)?Kt(sr)&&BigInt.prototype.valueOf.call(tr)===BigInt.prototype.valueOf.call(sr):Yt(sr)&&Symbol.prototype.valueOf.call(tr)===Symbol.prototype.valueOf.call(sr)}function Wt(tr,sr,vr,xr){if(tr===sr)return tr!==0?!0:vr?at(tr,sr):!0;if(vr){if(nt(tr)!=="object")return typeof tr=="number"&&ct(tr)&&ct(sr);if(nt(sr)!=="object"||tr===null||sr===null||Object.getPrototypeOf(tr)!==Object.getPrototypeOf(sr))return!1}else{if(tr===null||nt(tr)!=="object")return sr===null||nt(sr)!=="object"?tr==sr:!1;if(sr===null||nt(sr)!=="object")return!1}var Er=pt(tr),Sr=pt(sr);if(Er!==Sr)return!1;if(Array.isArray(tr)){if(tr.length!==sr.length)return!1;var $r=Tt(tr),Or=Tt(sr);return $r.length!==Or.length?!1:Qt(tr,sr,vr,xr,Ht,$r)}if(Er==="[object Object]"&&(!Et(tr)&&Et(sr)||!wt(tr)&&wt(sr)))return!1;if(vt(tr)){if(!vt(sr)||Date.prototype.getTime.call(tr)!==Date.prototype.getTime.call(sr))return!1}else if(xt(tr)){if(!xt(sr)||!kt(tr,sr))return!1}else if(Rt(tr)||tr instanceof Error){if(tr.message!==sr.message||tr.name!==sr.name)return!1}else if(yt(tr)){if(!vr&&(Bt(tr)||Pt(tr))){if(!Lt(tr,sr))return!1}else if(!bt(tr,sr))return!1;var Nr=Tt(tr),Rr=Tt(sr);return Nr.length!==Rr.length?!1:Qt(tr,sr,vr,xr,Gt,Nr)}else{if(wt(tr))return!wt(sr)||tr.size!==sr.size?!1:Qt(tr,sr,vr,xr,At);if(Et(tr))return!Et(sr)||tr.size!==sr.size?!1:Qt(tr,sr,vr,xr,$t);if(mt(tr)){if(!It(tr,sr))return!1}else if(Ct(tr)&&!Ut(tr,sr))return!1}return Qt(tr,sr,vr,xr,Gt)}function Xt(tr,sr){return sr.filter(function(vr){return dt(tr,vr)})}function Qt(tr,sr,vr,xr,Er,Sr){if(arguments.length===5){Sr=Object.keys(tr);var $r=Object.keys(sr);if(Sr.length!==$r.length)return!1}for(var Or=0;Or<Sr.length;Or++)if(!ft(sr,Sr[Or]))return!1;if(vr&&arguments.length===5){var Nr=lt(tr);if(Nr.length!==0){var Rr=0;for(Or=0;Or<Nr.length;Or++){var Dr=Nr[Or];if(dt(tr,Dr)){if(!dt(sr,Dr))return!1;Sr.push(Dr),Rr++}else if(dt(sr,Dr))return!1}var Fr=lt(sr);if(Nr.length!==Fr.length&&Xt(sr,Fr).length!==Rr)return!1}else{var Kr=lt(sr);if(Kr.length!==0&&Xt(sr,Kr).length!==0)return!1}}if(Sr.length===0&&(Er===Gt||Er===Ht&&tr.length===0||tr.size===0))return!0;if(xr===void 0)xr={val1:new Map,val2:new Map,position:0};else{var Qr=xr.val1.get(tr);if(Qr!==void 0){var Xr=xr.val2.get(sr);if(Xr!==void 0)return Qr===Xr}xr.position++}xr.val1.set(tr,xr.position),xr.val2.set(sr,xr.position);var an=_r(tr,sr,vr,Sr,xr,Er);return xr.val1.delete(tr),xr.val2.delete(sr),an}function er(tr,sr,vr,xr){for(var Er=st(tr),Sr=0;Sr<Er.length;Sr++){var $r=Er[Sr];if(Wt(sr,$r,vr,xr))return tr.delete($r),!0}return!1}function lr(tr){switch(nt(tr)){case"undefined":return null;case"object":return;case"symbol":return!1;case"string":tr=+tr;case"number":if(ct(tr))return!1}return!0}function pr(tr,sr,vr){var xr=lr(vr);return xr??(sr.has(xr)&&!tr.has(xr))}function gr(tr,sr,vr,xr,Er){var Sr=lr(vr);if(Sr!=null)return Sr;var $r=sr.get(Sr);return $r===void 0&&!sr.has(Sr)||!Wt(xr,$r,!1,Er)?!1:!tr.has(Sr)&&Wt(xr,$r,!1,Er)}function wr(tr,sr,vr,xr){for(var Er=null,Sr=st(tr),$r=0;$r<Sr.length;$r++){var Or=Sr[$r];if(nt(Or)==="object"&&Or!==null)Er===null&&(Er=new Set),Er.add(Or);else if(!sr.has(Or)){if(vr||!pr(tr,sr,Or))return!1;Er===null&&(Er=new Set),Er.add(Or)}}if(Er!==null){for(var Nr=st(sr),Rr=0;Rr<Nr.length;Rr++){var Dr=Nr[Rr];if(nt(Dr)==="object"&&Dr!==null){if(!er(Er,Dr,vr,xr))return!1}else if(!vr&&!tr.has(Dr)&&!er(Er,Dr,vr,xr))return!1}return Er.size===0}return!0}function cr(tr,sr,vr,xr,Er,Sr){for(var $r=st(tr),Or=0;Or<$r.length;Or++){var Nr=$r[Or];if(Wt(vr,Nr,Er,Sr)&&Wt(xr,sr.get(Nr),Er,Sr))return tr.delete(Nr),!0}return!1}function Cr(tr,sr,vr,xr){for(var Er=null,Sr=ot(tr),$r=0;$r<Sr.length;$r++){var Or=o(Sr[$r],2),Nr=Or[0],Rr=Or[1];if(nt(Nr)==="object"&&Nr!==null)Er===null&&(Er=new Set),Er.add(Nr);else{var Dr=sr.get(Nr);if(Dr===void 0&&!sr.has(Nr)||!Wt(Rr,Dr,vr,xr)){if(vr||!gr(tr,sr,Nr,Rr,xr))return!1;Er===null&&(Er=new Set),Er.add(Nr)}}}if(Er!==null){for(var Fr=ot(sr),Kr=0;Kr<Fr.length;Kr++){var Qr=o(Fr[Kr],2),Xr=Qr[0],an=Qr[1];if(nt(Xr)==="object"&&Xr!==null){if(!cr(Er,tr,Xr,an,vr,xr))return!1}else if(!vr&&(!tr.has(Xr)||!Wt(tr.get(Xr),an,!1,xr))&&!cr(Er,tr,Xr,an,!1,xr))return!1}return Er.size===0}return!0}function _r(tr,sr,vr,xr,Er,Sr){var $r=0;if(Sr===At){if(!wr(tr,sr,vr,Er))return!1}else if(Sr===$t){if(!Cr(tr,sr,vr,Er))return!1}else if(Sr===Ht)for(;$r<tr.length;$r++)if(ft(tr,$r)){if(!ft(sr,$r)||!Wt(tr[$r],sr[$r],vr,Er))return!1}else{if(ft(sr,$r))return!1;for(var Or=Object.keys(tr);$r<Or.length;$r++){var Nr=Or[$r];if(!ft(sr,Nr)||!Wt(tr[Nr],sr[Nr],vr,Er))return!1}return Or.length===Object.keys(sr).length}for($r=0;$r<xr.length;$r++){var Rr=xr[$r];if(!Wt(tr[Rr],sr[Rr],vr,Er))return!1}return!0}function kr(tr,sr){return Wt(tr,sr,jt)}function Ir(tr,sr){return Wt(tr,sr,Mt)}return comparisons={isDeepEqual:kr,isDeepStrictEqual:Ir},comparisons}var hasRequiredAssert;function requireAssert(){if(hasRequiredAssert)return assert$1.exports;hasRequiredAssert=1;function o(At){"@babel/helpers - typeof";return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function($t){return typeof $t}:function($t){return $t&&typeof Symbol=="function"&&$t.constructor===Symbol&&$t!==Symbol.prototype?"symbol":typeof $t},o(At)}function s(At,$t,kt){return Object.defineProperty(At,"prototype",{writable:!1}),At}function a(At,$t){if(!(At instanceof $t))throw new TypeError("Cannot call a class as a function")}var et=requireErrors(),tt=et.codes,rt=tt.ERR_AMBIGUOUS_ARGUMENT,nt=tt.ERR_INVALID_ARG_TYPE,it=tt.ERR_INVALID_ARG_VALUE,st=tt.ERR_INVALID_RETURN_VALUE,ot=tt.ERR_MISSING_ARGS,at=requireAssertion_error(),lt=util$b,ct=lt.inspect,ht=util$b.types,ft=ht.isPromise,dt=ht.isRegExp,pt=polyfill$2(),gt=polyfill$1(),mt=callBound$3("RegExp.prototype.test"),yt,vt;function Et(){var At=requireComparisons();yt=At.isDeepEqual,vt=At.isDeepStrictEqual}var xt=!1,wt=assert$1.exports=Nt,Rt={};function Ct(At){throw At.message instanceof Error?At.message:new at(At)}function Ft(At,$t,kt,Lt,bt){var It=arguments.length,Ut;if(It===0)Ut="Failed";else if(It===1)kt=At,At=void 0;else{if(xt===!1){xt=!0;var Wt=process$1.emitWarning?process$1.emitWarning:console.warn.bind(console);Wt("assert.fail() with more than one argument is deprecated. Please use assert.strictEqual() instead or only pass a message.","DeprecationWarning","DEP0094")}It===2&&(Lt="!=")}if(kt instanceof Error)throw kt;var Xt={actual:At,expected:$t,operator:Lt===void 0?"fail":Lt,stackStartFn:bt||Ft};kt!==void 0&&(Xt.message=kt);var Qt=new at(Xt);throw Ut&&(Qt.message=Ut,Qt.generatedMessage=!0),Qt}wt.fail=Ft,wt.AssertionError=at;function zt(At,$t,kt,Lt){if(!kt){var bt=!1;if($t===0)bt=!0,Lt="No value argument passed to `assert.ok()`";else if(Lt instanceof Error)throw Lt;var It=new at({actual:kt,expected:!0,message:Lt,operator:"==",stackStartFn:At});throw It.generatedMessage=bt,It}}function Nt(){for(var At=arguments.length,$t=new Array(At),kt=0;kt<At;kt++)$t[kt]=arguments[kt];zt.apply(void 0,[Nt,$t.length].concat($t))}wt.ok=Nt,wt.equal=function At($t,kt,Lt){if(arguments.length<2)throw new ot("actual","expected");$t!=kt&&Ct({actual:$t,expected:kt,message:Lt,operator:"==",stackStartFn:At})},wt.notEqual=function At($t,kt,Lt){if(arguments.length<2)throw new ot("actual","expected");$t==kt&&Ct({actual:$t,expected:kt,message:Lt,operator:"!=",stackStartFn:At})},wt.deepEqual=function At($t,kt,Lt){if(arguments.length<2)throw new ot("actual","expected");yt===void 0&&Et(),yt($t,kt)||Ct({actual:$t,expected:kt,message:Lt,operator:"deepEqual",stackStartFn:At})},wt.notDeepEqual=function At($t,kt,Lt){if(arguments.length<2)throw new ot("actual","expected");yt===void 0&&Et(),yt($t,kt)&&Ct({actual:$t,expected:kt,message:Lt,operator:"notDeepEqual",stackStartFn:At})},wt.deepStrictEqual=function At($t,kt,Lt){if(arguments.length<2)throw new ot("actual","expected");yt===void 0&&Et(),vt($t,kt)||Ct({actual:$t,expected:kt,message:Lt,operator:"deepStrictEqual",stackStartFn:At})},wt.notDeepStrictEqual=Kt;function Kt(At,$t,kt){if(arguments.length<2)throw new ot("actual","expected");yt===void 0&&Et(),vt(At,$t)&&Ct({actual:At,expected:$t,message:kt,operator:"notDeepStrictEqual",stackStartFn:Kt})}wt.strictEqual=function At($t,kt,Lt){if(arguments.length<2)throw new ot("actual","expected");gt($t,kt)||Ct({actual:$t,expected:kt,message:Lt,operator:"strictEqual",stackStartFn:At})},wt.notStrictEqual=function At($t,kt,Lt){if(arguments.length<2)throw new ot("actual","expected");gt($t,kt)&&Ct({actual:$t,expected:kt,message:Lt,operator:"notStrictEqual",stackStartFn:At})};var Yt=s(function At($t,kt,Lt){var bt=this;a(this,At),kt.forEach(function(It){It in $t&&(Lt!==void 0&&typeof Lt[It]=="string"&&dt($t[It])&&mt($t[It],Lt[It])?bt[It]=Lt[It]:bt[It]=$t[It])})});function Bt(At,$t,kt,Lt,bt,It){if(!(kt in At)||!vt(At[kt],$t[kt])){if(!Lt){var Ut=new Yt(At,bt),Wt=new Yt($t,bt,At),Xt=new at({actual:Ut,expected:Wt,operator:"deepStrictEqual",stackStartFn:It});throw Xt.actual=At,Xt.expected=$t,Xt.operator=It.name,Xt}Ct({actual:At,expected:$t,message:Lt,operator:It.name,stackStartFn:It})}}function Pt(At,$t,kt,Lt){if(typeof $t!="function"){if(dt($t))return mt($t,At);if(arguments.length===2)throw new nt("expected",["Function","RegExp"],$t);if(o(At)!=="object"||At===null){var bt=new at({actual:At,expected:$t,message:kt,operator:"deepStrictEqual",stackStartFn:Lt});throw bt.operator=Lt.name,bt}var It=Object.keys($t);if($t instanceof Error)It.push("name","message");else if(It.length===0)throw new it("error",$t,"may not be an empty object");return yt===void 0&&Et(),It.forEach(function(Ut){typeof At[Ut]=="string"&&dt($t[Ut])&&mt($t[Ut],At[Ut])||Bt(At,$t,Ut,kt,It,Lt)}),!0}return $t.prototype!==void 0&&At instanceof $t?!0:Error.isPrototypeOf($t)?!1:$t.call({},At)===!0}function Dt(At){if(typeof At!="function")throw new nt("fn","Function",At);try{At()}catch($t){return $t}return Rt}function Tt(At){return ft(At)||At!==null&&o(At)==="object"&&typeof At.then=="function"&&typeof At.catch=="function"}function St(At){return Promise.resolve().then(function(){var $t;if(typeof At=="function"){if($t=At(),!Tt($t))throw new st("instance of Promise","promiseFn",$t)}else if(Tt(At))$t=At;else throw new nt("promiseFn",["Function","Promise"],At);return Promise.resolve().then(function(){return $t}).then(function(){return Rt}).catch(function(kt){return kt})})}function Mt(At,$t,kt,Lt){if(typeof kt=="string"){if(arguments.length===4)throw new nt("error",["Object","Error","Function","RegExp"],kt);if(o($t)==="object"&&$t!==null){if($t.message===kt)throw new rt("error/message",'The error message "'.concat($t.message,'" is identical to the message.'))}else if($t===kt)throw new rt("error/message",'The error "'.concat($t,'" is identical to the message.'));Lt=kt,kt=void 0}else if(kt!=null&&o(kt)!=="object"&&typeof kt!="function")throw new nt("error",["Object","Error","Function","RegExp"],kt);if($t===Rt){var bt="";kt&&kt.name&&(bt+=" (".concat(kt.name,")")),bt+=Lt?": ".concat(Lt):".";var It=At.name==="rejects"?"rejection":"exception";Ct({actual:void 0,expected:kt,operator:At.name,message:"Missing expected ".concat(It).concat(bt),stackStartFn:At})}if(kt&&!Pt($t,kt,Lt,At))throw $t}function jt(At,$t,kt,Lt){if($t!==Rt){if(typeof kt=="string"&&(Lt=kt,kt=void 0),!kt||Pt($t,kt)){var bt=Lt?": ".concat(Lt):".",It=At.name==="doesNotReject"?"rejection":"exception";Ct({actual:$t,expected:kt,operator:At.name,message:"Got unwanted ".concat(It).concat(bt,`
`)+'Actual message: "'.concat($t&&$t.message,'"'),stackStartFn:At})}throw $t}}wt.throws=function At($t){for(var kt=arguments.length,Lt=new Array(kt>1?kt-1:0),bt=1;bt<kt;bt++)Lt[bt-1]=arguments[bt];Mt.apply(void 0,[At,Dt($t)].concat(Lt))},wt.rejects=function At($t){for(var kt=arguments.length,Lt=new Array(kt>1?kt-1:0),bt=1;bt<kt;bt++)Lt[bt-1]=arguments[bt];return St($t).then(function(It){return Mt.apply(void 0,[At,It].concat(Lt))})},wt.doesNotThrow=function At($t){for(var kt=arguments.length,Lt=new Array(kt>1?kt-1:0),bt=1;bt<kt;bt++)Lt[bt-1]=arguments[bt];jt.apply(void 0,[At,Dt($t)].concat(Lt))},wt.doesNotReject=function At($t){for(var kt=arguments.length,Lt=new Array(kt>1?kt-1:0),bt=1;bt<kt;bt++)Lt[bt-1]=arguments[bt];return St($t).then(function(It){return jt.apply(void 0,[At,It].concat(Lt))})},wt.ifError=function At($t){if($t!=null){var kt="ifError got unwanted exception: ";o($t)==="object"&&typeof $t.message=="string"?$t.message.length===0&&$t.constructor?kt+=$t.constructor.name:kt+=$t.message:kt+=ct($t);var Lt=new at({actual:$t,expected:null,operator:"ifError",message:kt,stackStartFn:At}),bt=$t.stack;if(typeof bt=="string"){var It=bt.split(`
`);It.shift();for(var Ut=Lt.stack.split(`
`),Wt=0;Wt<It.length;Wt++){var Xt=Ut.indexOf(It[Wt]);if(Xt!==-1){Ut=Ut.slice(0,Xt);break}}Lt.stack="".concat(Ut.join(`
`),`
`).concat(It.join(`
`))}throw Lt}};function Gt(At,$t,kt,Lt,bt){if(!dt($t))throw new nt("regexp","RegExp",$t);var It=bt==="match";if(typeof At!="string"||mt($t,At)!==It){if(kt instanceof Error)throw kt;var Ut=!kt;kt=kt||(typeof At!="string"?'The "string" argument must be of type string. Received type '+"".concat(o(At)," (").concat(ct(At),")"):(It?"The input did not match the regular expression ":"The input was expected to not match the regular expression ")+"".concat(ct($t),`. Input:

`).concat(ct(At),`
`));var Wt=new at({actual:At,expected:$t,message:kt,operator:bt,stackStartFn:Lt});throw Wt.generatedMessage=Ut,Wt}}wt.match=function At($t,kt,Lt){Gt($t,kt,Lt,At,"match")},wt.doesNotMatch=function At($t,kt,Lt){Gt($t,kt,Lt,At,"doesNotMatch")};function Ht(){for(var At=arguments.length,$t=new Array(At),kt=0;kt<At;kt++)$t[kt]=arguments[kt];zt.apply(void 0,[Ht,$t.length].concat($t))}return wt.strict=pt(Ht,wt,{equal:wt.strictEqual,deepEqual:wt.deepStrictEqual,notEqual:wt.notStrictEqual,notDeepEqual:wt.notDeepStrictEqual}),wt.strict.strict=wt.strict,assert$1.exports}var EventEmitter$2=eventsExports.EventEmitter,inherits$4=util$b.inherits,extend$1=immutable,DeferredLevelDOWN=deferredLeveldownExports,IteratorStream=levelIteratorStream,Batch$1=batch$1,errors=errors$2,assert=requireAssert(),promisify=promisify_1,getCallback$1=common$3.getCallback,getOptions$1=common$3.getOptions,WriteError=errors.WriteError,ReadError=errors.ReadError,NotFoundError=errors.NotFoundError,OpenError=errors.OpenError,InitializationError=errors.InitializationError;function LevelUP(o,s,a){if(!(this instanceof LevelUP))return new LevelUP(o,s,a);var et;if(EventEmitter$2.call(this),this.setMaxListeners(1/0),typeof s=="function"&&(a=s,s={}),s=s||{},!o||typeof o!="object"){if(et=new InitializationError("First argument must be an abstract-leveldown compliant store"),typeof a=="function")return process$1.nextTick(a,et);throw et}assert.equal(typeof o.status,"string",".status required, old abstract-leveldown"),this.options=getOptions$1(s),this._db=o,this.db=new DeferredLevelDOWN(o),this.open(a)}LevelUP.prototype.emit=EventEmitter$2.prototype.emit;LevelUP.prototype.once=EventEmitter$2.prototype.once;inherits$4(LevelUP,EventEmitter$2);LevelUP.prototype.open=function(o){var s=this,a;return o||(o=promisify(),a=o.promise),this.isOpen()?(process$1.nextTick(o,null,s),a):this._isOpening()?(this.once("open",function(){o(null,s)}),a):(this.emit("opening"),this.db.open(this.options,function(et){if(et)return o(new OpenError(et));s.db=s._db,o(null,s),s.emit("open"),s.emit("ready")}),a)};LevelUP.prototype.close=function(o){var s=this,a;return o||(o=promisify(),a=o.promise),this.isOpen()?(this.db.close(function(){s.emit("closed"),o.apply(null,arguments)}),this.emit("closing"),this.db=new DeferredLevelDOWN(this._db)):this.isClosed()?process$1.nextTick(o):this.db.status==="closing"?this.once("closed",o):this._isOpening()&&this.once("open",function(){s.close(o)}),a};LevelUP.prototype.isOpen=function(){return this.db.status==="open"};LevelUP.prototype._isOpening=function(){return this.db.status==="opening"};LevelUP.prototype.isClosed=function(){return/^clos|new/.test(this.db.status)};LevelUP.prototype.get=function(o,s,a){if(o==null)throw new ReadError("get() requires a key argument");var et;return a=getCallback$1(s,a),a||(a=promisify(),et=a.promise),maybeError$1(this,a)||(s=getOptions$1(s),this.db.get(o,s,function(tt,rt){if(tt)return/notfound/i.test(tt)||tt.notFound?tt=new NotFoundError("Key not found in database ["+o+"]",tt):tt=new ReadError(tt),a(tt);a(null,rt)})),et};LevelUP.prototype.put=function(o,s,a,et){if(o==null)throw new WriteError("put() requires a key argument");var tt=this,rt;return et=getCallback$1(a,et),et||(et=promisify(),rt=et.promise),maybeError$1(this,et)||(a=getOptions$1(a),this.db.put(o,s,a,function(nt){if(nt)return et(new WriteError(nt));tt.emit("put",o,s),et()})),rt};LevelUP.prototype.del=function(o,s,a){if(o==null)throw new WriteError("del() requires a key argument");var et=this,tt;return a=getCallback$1(s,a),a||(a=promisify(),tt=a.promise),maybeError$1(this,a)||(s=getOptions$1(s),this.db.del(o,s,function(rt){if(rt)return a(new WriteError(rt));et.emit("del",o),a()})),tt};LevelUP.prototype.batch=function(o,s,a){if(!arguments.length)return new Batch$1(this);if(!Array.isArray(o))throw new WriteError("batch() requires an array argument");var et=this,tt;return a=getCallback$1(s,a),a||(a=promisify(),tt=a.promise),maybeError$1(this,a)||(s=getOptions$1(s),this.db.batch(o,s,function(rt){if(rt)return a(new WriteError(rt));et.emit("batch",o),a()})),tt};LevelUP.prototype.iterator=function(o){return this.db.iterator(o)};LevelUP.prototype.readStream=LevelUP.prototype.createReadStream=function(o){return o=extend$1({keys:!0,values:!0},o),typeof o.limit!="number"&&(o.limit=-1),new IteratorStream(this.db.iterator(o),o)};LevelUP.prototype.keyStream=LevelUP.prototype.createKeyStream=function(o){return this.createReadStream(extend$1(o,{keys:!0,values:!1}))};LevelUP.prototype.valueStream=LevelUP.prototype.createValueStream=function(o){return this.createReadStream(extend$1(o,{keys:!1,values:!0}))};LevelUP.prototype.toString=function(){return"LevelUP"};function maybeError$1(o,s){if(!o._isOpening()&&!o.isOpen())return process$1.nextTick(s,new ReadError("Database is not open")),!0}LevelUP.errors=errors;var levelup$1=LevelUP.default=LevelUP,abstractLeveldown$5={};function AbstractIterator$5(o){this.db=o,this._ended=!1,this._nexting=!1}AbstractIterator$5.prototype.next=function(o){var s=this;if(typeof o!="function")throw new Error("next() requires a callback argument");return s._ended?(process$1.nextTick(o,new Error("cannot call next() after end()")),s):s._nexting?(process$1.nextTick(o,new Error("cannot call next() before previous next() has completed")),s):(s._nexting=!0,s._next(function(){s._nexting=!1,o.apply(null,arguments)}),s)};AbstractIterator$5.prototype._next=function(o){process$1.nextTick(o)};AbstractIterator$5.prototype.end=function(o){if(typeof o!="function")throw new Error("end() requires a callback argument");if(this._ended)return process$1.nextTick(o,new Error("end() already called on iterator"));this._ended=!0,this._end(o)};AbstractIterator$5.prototype._end=function(o){process$1.nextTick(o)};var abstractIterator$2=AbstractIterator$5;function AbstractChainedBatch$4(o){this._db=o,this._operations=[],this._written=!1}AbstractChainedBatch$4.prototype._serializeKey=function(o){return this._db._serializeKey(o)};AbstractChainedBatch$4.prototype._serializeValue=function(o){return this._db._serializeValue(o)};AbstractChainedBatch$4.prototype._checkWritten=function(){if(this._written)throw new Error("write() already called on this batch")};AbstractChainedBatch$4.prototype.put=function(o,s){this._checkWritten();var a=this._db._checkKey(o,"key");if(a)throw a;return o=this._serializeKey(o),s=this._serializeValue(s),this._put(o,s),this};AbstractChainedBatch$4.prototype._put=function(o,s){this._operations.push({type:"put",key:o,value:s})};AbstractChainedBatch$4.prototype.del=function(o){this._checkWritten();var s=this._db._checkKey(o,"key");if(s)throw s;return o=this._serializeKey(o),this._del(o),this};AbstractChainedBatch$4.prototype._del=function(o){this._operations.push({type:"del",key:o})};AbstractChainedBatch$4.prototype.clear=function(){return this._checkWritten(),this._operations=[],this._clear(),this};AbstractChainedBatch$4.prototype._clear=function(){};AbstractChainedBatch$4.prototype.write=function(o,s){if(this._checkWritten(),typeof o=="function"&&(s=o),typeof s!="function")throw new Error("write() requires a callback argument");if(typeof o!="object"&&(o={}),this._written=!0,typeof this._write=="function")return this._write(s);if(typeof this._db._batch=="function")return this._db._batch(this._operations,o,s);process$1.nextTick(s)};var abstractChainedBatch$2=AbstractChainedBatch$4,xtend$1=immutable,AbstractIterator$4=abstractIterator$2,AbstractChainedBatch$3=abstractChainedBatch$2,hasOwnProperty$2=Object.prototype.hasOwnProperty,rangeOptions$1="start end gt gte lt lte".split(" ");function AbstractLevelDOWN$3(o){if(!arguments.length||o===void 0)throw new Error("constructor requires at least a location argument");if(typeof o!="string")throw new Error("constructor requires a location string argument");this.location=o,this.status="new"}AbstractLevelDOWN$3.prototype.open=function(o,s){var a=this,et=this.status;if(typeof o=="function"&&(s=o),typeof s!="function")throw new Error("open() requires a callback argument");typeof o!="object"&&(o={}),o.createIfMissing=o.createIfMissing!==!1,o.errorIfExists=!!o.errorIfExists,this.status="opening",this._open(o,function(tt){if(tt)return a.status=et,s(tt);a.status="open",s()})};AbstractLevelDOWN$3.prototype._open=function(o,s){process$1.nextTick(s)};AbstractLevelDOWN$3.prototype.close=function(o){var s=this,a=this.status;if(typeof o!="function")throw new Error("close() requires a callback argument");this.status="closing",this._close(function(et){if(et)return s.status=a,o(et);s.status="closed",o()})};AbstractLevelDOWN$3.prototype._close=function(o){process$1.nextTick(o)};AbstractLevelDOWN$3.prototype.get=function(o,s,a){if(typeof s=="function"&&(a=s),typeof a!="function")throw new Error("get() requires a callback argument");var et=this._checkKey(o,"key");if(et)return process$1.nextTick(a,et);o=this._serializeKey(o),typeof s!="object"&&(s={}),s.asBuffer=s.asBuffer!==!1,this._get(o,s,a)};AbstractLevelDOWN$3.prototype._get=function(o,s,a){process$1.nextTick(function(){a(new Error("NotFound"))})};AbstractLevelDOWN$3.prototype.put=function(o,s,a,et){if(typeof a=="function"&&(et=a),typeof et!="function")throw new Error("put() requires a callback argument");var tt=this._checkKey(o,"key");if(tt)return process$1.nextTick(et,tt);o=this._serializeKey(o),s=this._serializeValue(s),typeof a!="object"&&(a={}),this._put(o,s,a,et)};AbstractLevelDOWN$3.prototype._put=function(o,s,a,et){process$1.nextTick(et)};AbstractLevelDOWN$3.prototype.del=function(o,s,a){if(typeof s=="function"&&(a=s),typeof a!="function")throw new Error("del() requires a callback argument");var et=this._checkKey(o,"key");if(et)return process$1.nextTick(a,et);o=this._serializeKey(o),typeof s!="object"&&(s={}),this._del(o,s,a)};AbstractLevelDOWN$3.prototype._del=function(o,s,a){process$1.nextTick(a)};AbstractLevelDOWN$3.prototype.batch=function(o,s,a){if(!arguments.length)return this._chainedBatch();if(typeof s=="function"&&(a=s),typeof o=="function"&&(a=o),typeof a!="function")throw new Error("batch(array) requires a callback argument");if(!Array.isArray(o))return process$1.nextTick(a,new Error("batch(array) requires an array argument"));(!s||typeof s!="object")&&(s={});for(var et=new Array(o.length),tt=0;tt<o.length;tt++){if(typeof o[tt]!="object"||o[tt]===null)return process$1.nextTick(a,new Error("batch(array) element must be an object and not `null`"));var rt=xtend$1(o[tt]);if(rt.type!=="put"&&rt.type!=="del")return process$1.nextTick(a,new Error("`type` must be 'put' or 'del'"));var nt=this._checkKey(rt.key,"key");if(nt)return process$1.nextTick(a,nt);rt.key=this._serializeKey(rt.key),rt.type==="put"&&(rt.value=this._serializeValue(rt.value)),et[tt]=rt}this._batch(et,s,a)};AbstractLevelDOWN$3.prototype._batch=function(o,s,a){process$1.nextTick(a)};AbstractLevelDOWN$3.prototype._setupIteratorOptions=function(o){return o=cleanRangeOptions$1(o),o.reverse=!!o.reverse,o.keys=o.keys!==!1,o.values=o.values!==!1,o.limit="limit"in o?o.limit:-1,o.keyAsBuffer=o.keyAsBuffer!==!1,o.valueAsBuffer=o.valueAsBuffer!==!1,o};function cleanRangeOptions$1(o){var s={};for(var a in o)hasOwnProperty$2.call(o,a)&&(isRangeOption$1(a)&&isEmptyRangeOption(o[a])||(s[a]=o[a]));return s}function isRangeOption$1(o){return rangeOptions$1.indexOf(o)!==-1}function isEmptyRangeOption(o){return o===""||o==null||isEmptyBuffer(o)}function isEmptyBuffer(o){return Buffer$2.isBuffer(o)&&o.length===0}AbstractLevelDOWN$3.prototype.iterator=function(o){return typeof o!="object"&&(o={}),o=this._setupIteratorOptions(o),this._iterator(o)};AbstractLevelDOWN$3.prototype._iterator=function(o){return new AbstractIterator$4(this)};AbstractLevelDOWN$3.prototype._chainedBatch=function(){return new AbstractChainedBatch$3(this)};AbstractLevelDOWN$3.prototype._serializeKey=function(o){return Buffer$2.isBuffer(o)?o:String(o)};AbstractLevelDOWN$3.prototype._serializeValue=function(o){return o==null?"":Buffer$2.isBuffer(o)||process$1.browser?o:String(o)};AbstractLevelDOWN$3.prototype._checkKey=function(o,s){if(o==null)return new Error(s+" cannot be `null` or `undefined`");if(Buffer$2.isBuffer(o)&&o.length===0)return new Error(s+" cannot be an empty Buffer");if(String(o)==="")return new Error(s+" cannot be an empty String")};var abstractLeveldown$4=AbstractLevelDOWN$3;abstractLeveldown$5.AbstractLevelDOWN=abstractLeveldown$4;abstractLeveldown$5.AbstractIterator=abstractIterator$2;abstractLeveldown$5.AbstractChainedBatch=abstractChainedBatch$2;var encodings$1={};(function(o){var s=dist.Buffer;o.utf8=o["utf-8"]={encode:function(rt){return tt(rt)?rt:String(rt)},decode:et,buffer:!1,type:"utf8"},o.json={encode:JSON.stringify,decode:JSON.parse,buffer:!1,type:"json"},o.binary={encode:function(rt){return tt(rt)?rt:s.from(rt)},decode:et,buffer:!0,type:"binary"},o.none={encode:et,decode:et,buffer:!1,type:"id"},o.id=o.none;var a=["hex","ascii","base64","ucs2","ucs-2","utf16le","utf-16le"];a.forEach(function(rt){o[rt]={encode:function(nt){return tt(nt)?nt:s.from(nt,rt)},decode:function(nt){return nt.toString(rt)},buffer:!0,type:rt}});function et(rt){return rt}function tt(rt){return rt==null||s.isBuffer(rt)}})(encodings$1);var encodings=encodings$1,levelCodec=Codec$3;function Codec$3(o){if(!(this instanceof Codec$3))return new Codec$3(o);this.opts=o||{},this.encodings=encodings}Codec$3.prototype._encoding=function(o){return typeof o=="string"&&(o=encodings[o]),o||(o=encodings.id),o};Codec$3.prototype._keyEncoding=function(o,s){return this._encoding(s&&s.keyEncoding||o&&o.keyEncoding||this.opts.keyEncoding)};Codec$3.prototype._valueEncoding=function(o,s){return this._encoding(s&&(s.valueEncoding||s.encoding)||o&&(o.valueEncoding||o.encoding)||this.opts.valueEncoding||this.opts.encoding)};Codec$3.prototype.encodeKey=function(o,s,a){return this._keyEncoding(s,a).encode(o)};Codec$3.prototype.encodeValue=function(o,s,a){return this._valueEncoding(s,a).encode(o)};Codec$3.prototype.decodeKey=function(o,s){return this._keyEncoding(s).decode(o)};Codec$3.prototype.decodeValue=function(o,s){return this._valueEncoding(s).decode(o)};Codec$3.prototype.encodeBatch=function(o,s){var a=this;return o.map(function(et){var tt={type:et.type,key:a.encodeKey(et.key,s,et)};return a.keyAsBuffer(s,et)&&(tt.keyEncoding="binary"),et.prefix&&(tt.prefix=et.prefix),"value"in et&&(tt.value=a.encodeValue(et.value,s,et),a.valueAsBuffer(s,et)&&(tt.valueEncoding="binary")),tt})};var ltgtKeys=["lt","gt","lte","gte","start","end"];Codec$3.prototype.encodeLtgt=function(o){var s=this,a={};return Object.keys(o).forEach(function(et){a[et]=ltgtKeys.indexOf(et)>-1?s.encodeKey(o[et],o):o[et]}),a};Codec$3.prototype.createStreamDecoder=function(o){var s=this;return o.keys&&o.values?function(a,et){return{key:s.decodeKey(a,o),value:s.decodeValue(et,o)}}:o.keys?function(a){return s.decodeKey(a,o)}:o.values?function(a,et){return s.decodeValue(et,o)}:function(){}};Codec$3.prototype.keyAsBuffer=function(o){return this._keyEncoding(o).buffer};Codec$3.prototype.valueAsBuffer=function(o){return this._valueEncoding(o).buffer};var AbstractLevelDOWN$2=abstractLeveldown$5.AbstractLevelDOWN,AbstractChainedBatch$2=abstractLeveldown$5.AbstractChainedBatch,AbstractIterator$3=abstractLeveldown$5.AbstractIterator,inherits$3=inherits_browserExports,xtend=immutable,Codec$2=levelCodec,EncodingError=errors$2.EncodingError,encodingDown=DB$1.default=DB$1;function DB$1(o,s){if(!(this instanceof DB$1))return new DB$1(o,s);AbstractLevelDOWN$2.call(this,""),s=s||{},typeof s.keyEncoding>"u"&&(s.keyEncoding="utf8"),typeof s.valueEncoding>"u"&&(s.valueEncoding="utf8"),this.db=o,this.codec=new Codec$2(s)}inherits$3(DB$1,AbstractLevelDOWN$2);DB$1.prototype._serializeKey=DB$1.prototype._serializeValue=function(o){return o};DB$1.prototype._open=function(o,s){this.db.open(o,s)};DB$1.prototype._close=function(o){this.db.close(o)};DB$1.prototype._put=function(o,s,a,et){o=this.codec.encodeKey(o,a),s=this.codec.encodeValue(s,a),this.db.put(o,s,a,et)};DB$1.prototype._get=function(o,s,a){var et=this;o=this.codec.encodeKey(o,s),s.asBuffer=this.codec.valueAsBuffer(s),this.db.get(o,s,function(tt,rt){if(tt)return a(tt);try{rt=et.codec.decodeValue(rt,s)}catch(nt){return a(new EncodingError(nt))}a(null,rt)})};DB$1.prototype._del=function(o,s,a){o=this.codec.encodeKey(o,s),this.db.del(o,s,a)};DB$1.prototype._chainedBatch=function(){return new Batch(this)};DB$1.prototype._batch=function(o,s,a){o=this.codec.encodeBatch(o,s),this.db.batch(o,s,a)};DB$1.prototype._iterator=function(o){return o.keyAsBuffer=this.codec.keyAsBuffer(o),o.valueAsBuffer=this.codec.valueAsBuffer(o),new Iterator$2(this,o)};DB$1.prototype._setupIteratorOptions=function(o){return o=xtend(o),o.reverse=!!o.reverse,o.keys=o.keys!==!1,o.values=o.values!==!1,o.limit="limit"in o?o.limit:-1,o.keyAsBuffer=o.keyAsBuffer!==!1,o.valueAsBuffer=o.valueAsBuffer!==!1,o};DB$1.prototype.approximateSize=function(o,s,a,et){return this.db.approximateSize(o,s,a,et)};function Iterator$2(o,s){AbstractIterator$3.call(this,o),this.codec=o.codec,this.keys=s.keys,this.values=s.values,this.opts=this.codec.encodeLtgt(s),this.it=o.db.iterator(this.opts)}inherits$3(Iterator$2,AbstractIterator$3);Iterator$2.prototype._next=function(o){var s=this;this.it.next(function(a,et,tt){if(a)return o(a);try{s.keys&&typeof et<"u"?et=s.codec.decodeKey(et,s.opts):et=void 0,s.values&&typeof tt<"u"?tt=s.codec.decodeValue(tt,s.opts):tt=void 0}catch(rt){return o(new EncodingError(rt))}o(null,et,tt)})};Iterator$2.prototype._end=function(o){this.it.end(o)};function Batch(o,s){AbstractChainedBatch$2.call(this,o),this.codec=o.codec,this.batch=o.db.batch()}inherits$3(Batch,AbstractChainedBatch$2);Batch.prototype._put=function(o,s){o=this.codec.encodeKey(o),s=this.codec.encodeValue(s),this.batch.put(o,s)};Batch.prototype._del=function(o){o=this.codec.encodeKey(o),this.batch.del(o)};Batch.prototype._clear=function(){this.batch.clear()};Batch.prototype._write=function(o,s){this.batch.write(o,s)};var hat$2={exports:{}},hat$1=hat$2.exports=function(o,s){if(s||(s=16),o===void 0&&(o=128),o<=0)return"0";for(var a=Math.log(Math.pow(2,o))/Math.log(s),et=2;a===1/0;et*=2)a=Math.log(Math.pow(2,o/et))/Math.log(s)*et;for(var tt=a-Math.floor(a),rt="",et=0;et<Math.floor(a);et++){var nt=Math.floor(Math.random()*s).toString(s);rt=nt+rt}if(tt){var it=Math.pow(s,tt),nt=Math.floor(Math.random()*it).toString(s);rt=nt+rt}var st=parseInt(rt,s);return st!==1/0&&st>=Math.pow(2,o)?hat$1(o,s):rt};hat$1.rack=function(o,s,a){var et=function(rt){var nt=0;do{if(nt++>10)if(a)o+=a;else throw new Error("too many ID collisions, use more bits");var it=hat$1(o,s)}while(Object.hasOwnProperty.call(tt,it));return tt[it]=rt,it},tt=et.hats={};return et.get=function(rt){return et.hats[rt]},et.set=function(rt,nt){return et.hats[rt]=nt,et},et.bits=o||128,et.base=s||16,et};var hatExports=hat$2.exports,abstractLeveldown$3={},mutable,hasRequiredMutable;function requireMutable(){if(hasRequiredMutable)return mutable;hasRequiredMutable=1,mutable=s;var o=Object.prototype.hasOwnProperty;function s(a){for(var et=1;et<arguments.length;et++){var tt=arguments[et];for(var rt in tt)o.call(tt,rt)&&(a[rt]=tt[rt])}return a}return mutable}var levelSupports$1,hasRequiredLevelSupports;function requireLevelSupports(){if(hasRequiredLevelSupports)return levelSupports$1;hasRequiredLevelSupports=1;var o=immutable,s=requireMutable();return levelSupports$1=function(){var et=o.apply(null,arguments);return s(et,{bufferKeys:et.bufferKeys||!1,snapshots:et.snapshots||!1,permanence:et.permanence||!1,seek:et.seek||!1,clear:et.clear||!1,status:et.status||!1,createIfMissing:et.createIfMissing||!1,errorIfExists:et.errorIfExists||!1,deferredOpen:et.deferredOpen||!1,openCallback:et.openCallback||!1,promises:et.promises||!1,streams:et.streams||!1,encodings:et.encodings||!1,additionalMethods:o(et.additionalMethods)})},levelSupports$1}const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$0$2=getAugmentedNamespace(__viteBrowserExternal$1);var queueMicrotask$3={},hasRequiredQueueMicrotask;function requireQueueMicrotask(){return hasRequiredQueueMicrotask||(hasRequiredQueueMicrotask=1,queueMicrotask$3.test=function(){return typeof commonjsGlobal.queueMicrotask=="function"},queueMicrotask$3.install=function(o){return function(){commonjsGlobal.queueMicrotask(o)}}),queueMicrotask$3}var mutation={},hasRequiredMutation;function requireMutation(){if(hasRequiredMutation)return mutation;hasRequiredMutation=1;var o=commonjsGlobal.MutationObserver||commonjsGlobal.WebKitMutationObserver;return mutation.test=function(){return o},mutation.install=function(s){var a=0,et=new o(s),tt=commonjsGlobal.document.createTextNode("");return et.observe(tt,{characterData:!0}),function(){tt.data=a=++a%2}},mutation}var messageChannel={},hasRequiredMessageChannel;function requireMessageChannel(){return hasRequiredMessageChannel||(hasRequiredMessageChannel=1,messageChannel.test=function(){return commonjsGlobal.setImmediate?!1:typeof commonjsGlobal.MessageChannel<"u"},messageChannel.install=function(o){var s=new commonjsGlobal.MessageChannel;return s.port1.onmessage=o,function(){s.port2.postMessage(0)}}),messageChannel}var stateChange={},hasRequiredStateChange;function requireStateChange(){return hasRequiredStateChange||(hasRequiredStateChange=1,stateChange.test=function(){return"document"in commonjsGlobal&&"onreadystatechange"in commonjsGlobal.document.createElement("script")},stateChange.install=function(o){return function(){var s=commonjsGlobal.document.createElement("script");return s.onreadystatechange=function(){o(),s.onreadystatechange=null,s.parentNode.removeChild(s),s=null},commonjsGlobal.document.documentElement.appendChild(s),o}}),stateChange}var timeout={},hasRequiredTimeout;function requireTimeout(){return hasRequiredTimeout||(hasRequiredTimeout=1,timeout.test=function(){return!0},timeout.install=function(o){return function(){setTimeout(o,0)}}),timeout}var lib$2,hasRequiredLib;function requireLib(){if(hasRequiredLib)return lib$2;hasRequiredLib=1;var o=[require$$0$2,requireQueueMicrotask(),requireMutation(),requireMessageChannel(),requireStateChange(),requireTimeout()],s,a,et=-1,tt=[],rt=!1;function nt(){!s||!a||(s=!1,a.length?tt=a.concat(tt):et=-1,tt.length&&it())}function it(){if(!s){rt=!1,s=!0;for(var ht=tt.length,ft=setTimeout(nt);ht;){for(a=tt,tt=[];a&&++et<ht;)a[et].run();et=-1,ht=tt.length}a=null,et=-1,s=!1,clearTimeout(ft)}}for(var st,ot=-1,at=o.length;++ot<at;)if(o[ot]&&o[ot].test&&o[ot].test()){st=o[ot].install(it);break}function lt(ht,ft){this.fun=ht,this.array=ft}lt.prototype.run=function(){var ht=this.fun,ft=this.array;switch(ft.length){case 0:return ht();case 1:return ht(ft[0]);case 2:return ht(ft[0],ft[1]);case 3:return ht(ft[0],ft[1],ft[2]);default:return ht.apply(null,ft)}},lib$2=ct;function ct(ht){var ft=new Array(arguments.length-1);if(arguments.length>1)for(var dt=1;dt<arguments.length;dt++)ft[dt-1]=arguments[dt];tt.push(new lt(ht,ft)),!rt&&!s&&(rt=!0,st())}return lib$2}var nextTickBrowser$2,hasRequiredNextTickBrowser;function requireNextTickBrowser(){return hasRequiredNextTickBrowser||(hasRequiredNextTickBrowser=1,nextTickBrowser$2=requireLib()),nextTickBrowser$2}var abstractIterator$1,hasRequiredAbstractIterator;function requireAbstractIterator(){if(hasRequiredAbstractIterator)return abstractIterator$1;hasRequiredAbstractIterator=1;var o=requireNextTickBrowser();function s(a){if(typeof a!="object"||a===null)throw new TypeError("First argument must be an abstract-leveldown compliant store");this.db=a,this._ended=!1,this._nexting=!1}return s.prototype.next=function(a){var et=this;if(typeof a!="function")throw new Error("next() requires a callback argument");return et._ended?(o(a,new Error("cannot call next() after end()")),et):et._nexting?(o(a,new Error("cannot call next() before previous next() has completed")),et):(et._nexting=!0,et._next(function(){et._nexting=!1,a.apply(null,arguments)}),et)},s.prototype._next=function(a){o(a)},s.prototype.seek=function(a){if(this._ended)throw new Error("cannot call seek() after end()");if(this._nexting)throw new Error("cannot call seek() before next() has completed");a=this.db._serializeKey(a),this._seek(a)},s.prototype._seek=function(a){},s.prototype.end=function(a){if(typeof a!="function")throw new Error("end() requires a callback argument");if(this._ended)return o(a,new Error("end() already called on iterator"));this._ended=!0,this._end(a)},s.prototype._end=function(a){o(a)},s.prototype._nextTick=o,abstractIterator$1=s,abstractIterator$1}var abstractChainedBatch$1,hasRequiredAbstractChainedBatch;function requireAbstractChainedBatch(){if(hasRequiredAbstractChainedBatch)return abstractChainedBatch$1;hasRequiredAbstractChainedBatch=1;var o=requireNextTickBrowser();function s(a){if(typeof a!="object"||a===null)throw new TypeError("First argument must be an abstract-leveldown compliant store");this.db=a,this._operations=[],this._written=!1}return s.prototype._checkWritten=function(){if(this._written)throw new Error("write() already called on this batch")},s.prototype.put=function(a,et){this._checkWritten();var tt=this.db._checkKey(a)||this.db._checkValue(et);if(tt)throw tt;return a=this.db._serializeKey(a),et=this.db._serializeValue(et),this._put(a,et),this},s.prototype._put=function(a,et){this._operations.push({type:"put",key:a,value:et})},s.prototype.del=function(a){this._checkWritten();var et=this.db._checkKey(a);if(et)throw et;return a=this.db._serializeKey(a),this._del(a),this},s.prototype._del=function(a){this._operations.push({type:"del",key:a})},s.prototype.clear=function(){return this._checkWritten(),this._clear(),this},s.prototype._clear=function(){this._operations=[]},s.prototype.write=function(a,et){if(this._checkWritten(),typeof a=="function"&&(et=a),typeof et!="function")throw new Error("write() requires a callback argument");(typeof a!="object"||a===null)&&(a={}),this._written=!0,this._write(a,et)},s.prototype._write=function(a,et){this.db._batch(this._operations,a,et)},s.prototype._nextTick=o,abstractChainedBatch$1=s,abstractChainedBatch$1}var abstractLeveldown$2,hasRequiredAbstractLeveldown$1;function requireAbstractLeveldown$1(){if(hasRequiredAbstractLeveldown$1)return abstractLeveldown$2;hasRequiredAbstractLeveldown$1=1;var o=immutable,s=requireLevelSupports(),a=dist.Buffer,et=requireAbstractIterator(),tt=requireAbstractChainedBatch(),rt=requireNextTickBrowser(),nt=Object.prototype.hasOwnProperty,it="start end gt gte lt lte".split(" ");function st(lt){this.status="new",this.supports=s(lt,{status:!0})}st.prototype.open=function(lt,ct){var ht=this,ft=this.status;if(typeof lt=="function"&&(ct=lt),typeof ct!="function")throw new Error("open() requires a callback argument");(typeof lt!="object"||lt===null)&&(lt={}),lt.createIfMissing=lt.createIfMissing!==!1,lt.errorIfExists=!!lt.errorIfExists,this.status="opening",this._open(lt,function(dt){if(dt)return ht.status=ft,ct(dt);ht.status="open",ct()})},st.prototype._open=function(lt,ct){rt(ct)},st.prototype.close=function(lt){var ct=this,ht=this.status;if(typeof lt!="function")throw new Error("close() requires a callback argument");this.status="closing",this._close(function(ft){if(ft)return ct.status=ht,lt(ft);ct.status="closed",lt()})},st.prototype._close=function(lt){rt(lt)},st.prototype.get=function(lt,ct,ht){if(typeof ct=="function"&&(ht=ct),typeof ht!="function")throw new Error("get() requires a callback argument");var ft=this._checkKey(lt);if(ft)return rt(ht,ft);lt=this._serializeKey(lt),(typeof ct!="object"||ct===null)&&(ct={}),ct.asBuffer=ct.asBuffer!==!1,this._get(lt,ct,ht)},st.prototype._get=function(lt,ct,ht){rt(function(){ht(new Error("NotFound"))})},st.prototype.put=function(lt,ct,ht,ft){if(typeof ht=="function"&&(ft=ht),typeof ft!="function")throw new Error("put() requires a callback argument");var dt=this._checkKey(lt)||this._checkValue(ct);if(dt)return rt(ft,dt);lt=this._serializeKey(lt),ct=this._serializeValue(ct),(typeof ht!="object"||ht===null)&&(ht={}),this._put(lt,ct,ht,ft)},st.prototype._put=function(lt,ct,ht,ft){rt(ft)},st.prototype.del=function(lt,ct,ht){if(typeof ct=="function"&&(ht=ct),typeof ht!="function")throw new Error("del() requires a callback argument");var ft=this._checkKey(lt);if(ft)return rt(ht,ft);lt=this._serializeKey(lt),(typeof ct!="object"||ct===null)&&(ct={}),this._del(lt,ct,ht)},st.prototype._del=function(lt,ct,ht){rt(ht)},st.prototype.batch=function(lt,ct,ht){if(!arguments.length)return this._chainedBatch();if(typeof ct=="function"&&(ht=ct),typeof lt=="function"&&(ht=lt),typeof ht!="function")throw new Error("batch(array) requires a callback argument");if(!Array.isArray(lt))return rt(ht,new Error("batch(array) requires an array argument"));if(lt.length===0)return rt(ht);(typeof ct!="object"||ct===null)&&(ct={});for(var ft=new Array(lt.length),dt=0;dt<lt.length;dt++){if(typeof lt[dt]!="object"||lt[dt]===null)return rt(ht,new Error("batch(array) element must be an object and not `null`"));var pt=o(lt[dt]);if(pt.type!=="put"&&pt.type!=="del")return rt(ht,new Error("`type` must be 'put' or 'del'"));var gt=this._checkKey(pt.key);if(gt)return rt(ht,gt);if(pt.key=this._serializeKey(pt.key),pt.type==="put"){var mt=this._checkValue(pt.value);if(mt)return rt(ht,mt);pt.value=this._serializeValue(pt.value)}ft[dt]=pt}this._batch(ft,ct,ht)},st.prototype._batch=function(lt,ct,ht){rt(ht)},st.prototype.clear=function(lt,ct){if(typeof lt=="function")ct=lt;else if(typeof ct!="function")throw new Error("clear() requires a callback argument");lt=ot(this,lt),lt.reverse=!!lt.reverse,lt.limit="limit"in lt?lt.limit:-1,this._clear(lt,ct)},st.prototype._clear=function(lt,ct){lt.keys=!0,lt.values=!1,lt.keyAsBuffer=!0,lt.valueAsBuffer=!0;var ht=this._iterator(lt),ft={},dt=this,pt=function(gt){if(gt)return ht.end(function(){ct(gt)});ht.next(function(mt,yt){if(mt)return pt(mt);if(yt===void 0)return ht.end(ct);dt._del(yt,ft,pt)})};pt()},st.prototype._setupIteratorOptions=function(lt){return lt=ot(this,lt),lt.reverse=!!lt.reverse,lt.keys=lt.keys!==!1,lt.values=lt.values!==!1,lt.limit="limit"in lt?lt.limit:-1,lt.keyAsBuffer=lt.keyAsBuffer!==!1,lt.valueAsBuffer=lt.valueAsBuffer!==!1,lt};function ot(lt,ct){var ht={};for(var ft in ct)if(nt.call(ct,ft)){var dt=ct[ft];at(ft)&&(dt=lt._serializeKey(dt)),ht[ft]=dt}return ht}function at(lt){return it.indexOf(lt)!==-1}return st.prototype.iterator=function(lt){return(typeof lt!="object"||lt===null)&&(lt={}),lt=this._setupIteratorOptions(lt),this._iterator(lt)},st.prototype._iterator=function(lt){return new et(this)},st.prototype._chainedBatch=function(){return new tt(this)},st.prototype._serializeKey=function(lt){return lt},st.prototype._serializeValue=function(lt){return lt},st.prototype._checkKey=function(lt){if(lt==null)return new Error("key cannot be `null` or `undefined`");if(a.isBuffer(lt)&&lt.length===0)return new Error("key cannot be an empty Buffer");if(lt==="")return new Error("key cannot be an empty String");if(Array.isArray(lt)&&lt.length===0)return new Error("key cannot be an empty Array")},st.prototype._checkValue=function(lt){if(lt==null)return new Error("value cannot be `null` or `undefined`")},st.prototype._nextTick=rt,abstractLeveldown$2=st,abstractLeveldown$2}var hasRequiredAbstractLeveldown;function requireAbstractLeveldown(){return hasRequiredAbstractLeveldown||(hasRequiredAbstractLeveldown=1,abstractLeveldown$3.AbstractLevelDOWN=requireAbstractLeveldown$1(),abstractLeveldown$3.AbstractIterator=requireAbstractIterator(),abstractLeveldown$3.AbstractChainedBatch=requireAbstractChainedBatch()),abstractLeveldown$3}function commonjsRequire(o){throw new Error('Could not dynamically require "'+o+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var empty$1=null;const empty$2=Object.freeze(Object.defineProperty({__proto__:null,default:empty$1},Symbol.toStringTag,{value:"Module"})),require$$0$1=getAugmentedNamespace(empty$2);var browser$5={};browser$5.endianness=function(){return"LE"};browser$5.hostname=function(){return typeof location<"u"?location.hostname:""};browser$5.loadavg=function(){return[]};browser$5.uptime=function(){return 0};browser$5.freemem=function(){return Number.MAX_VALUE};browser$5.totalmem=function(){return Number.MAX_VALUE};browser$5.cpus=function(){return[]};browser$5.type=function(){return"Browser"};browser$5.release=function(){return typeof navigator<"u"?navigator.appVersion:""};browser$5.networkInterfaces=browser$5.getNetworkInterfaces=function(){return{}};browser$5.arch=function(){return"javascript"};browser$5.platform=function(){return"browser"};browser$5.tmpdir=browser$5.tmpDir=function(){return"/tmp"};browser$5.EOL=`
`;browser$5.homedir=function(){return"/"};var nodeGypBuild,hasRequiredNodeGypBuild;function requireNodeGypBuild(){if(hasRequiredNodeGypBuild)return nodeGypBuild;hasRequiredNodeGypBuild=1;var o={},s=require$$0$1,a=pathBrowserify,et=browser$5,tt=typeof __webpack_require__=="function"?__non_webpack_require__:commonjsRequire,rt=!!o.PREBUILDS_ONLY,nt=process$1.versions.modules,it=Et()?"electron":"node",st=et.arch(),ot=et.platform(),at=o.LIBC||(xt(ot)?"musl":"glibc"),lt=o.ARM_VERSION||(st==="arm64"?"8":process$1.config.variables.arm_version)||"",ct=(process$1.versions.uv||"").split(".")[0];nodeGypBuild=ht;function ht(wt){return tt(ht.path(wt))}ht.path=function(wt){wt=a.resolve(wt||".");try{var Rt=tt(a.join(wt,"package.json")).name.toUpperCase().replace(/-/g,"_");o[Rt+"_PREBUILD"]&&(wt=o[Rt+"_PREBUILD"])}catch{}if(!rt){var Ct=dt(a.join(wt,"build/Release"),pt);if(Ct)return Ct;var Ft=dt(a.join(wt,"build/Debug"),pt);if(Ft)return Ft}var zt=a.join(wt,"prebuilds",ot+"-"+st),Nt=ft(zt).map(gt),Kt=Nt.filter(mt(it,nt)),Yt=Kt.sort(vt(it))[0];if(Yt)return a.join(zt,Yt.file);var Bt=["platform="+ot,"arch="+st,"runtime="+it,"abi="+nt,"uv="+ct,lt?"armv="+lt:"","libc="+at].filter(Boolean).join(" ");throw new Error("No native build was found for "+Bt)};function ft(wt){try{return s.readdirSync(wt)}catch{return[]}}function dt(wt,Rt){var Ct=ft(wt).filter(Rt);return Ct[0]&&a.join(wt,Ct[0])}function pt(wt){return/\.node$/.test(wt)}function gt(wt){var Rt=wt.split("."),Ct=Rt.pop(),Ft={file:wt,specificity:0};if(Ct==="node"){for(var zt=0;zt<Rt.length;zt++){var Nt=Rt[zt];if(Nt==="node"||Nt==="electron"||Nt==="node-webkit")Ft.runtime=Nt;else if(Nt==="napi")Ft.napi=!0;else if(Nt.slice(0,3)==="abi")Ft.abi=Nt.slice(3);else if(Nt.slice(0,2)==="uv")Ft.uv=Nt.slice(2);else if(Nt.slice(0,4)==="armv")Ft.armv=Nt.slice(4);else if(Nt==="glibc"||Nt==="musl")Ft.libc=Nt;else continue;Ft.specificity++}return Ft}}function mt(wt,Rt){return function(Ct){return!(Ct==null||Ct.runtime!==wt&&!yt(Ct)||Ct.abi!==Rt&&!Ct.napi||Ct.uv&&Ct.uv!==ct||Ct.armv&&Ct.armv!==lt||Ct.libc&&Ct.libc!==at)}}function yt(wt){return wt.runtime==="node"&&wt.napi}function vt(wt){return function(Rt,Ct){return Rt.runtime!==Ct.runtime?Rt.runtime===wt?-1:1:Rt.abi!==Ct.abi?Rt.abi?-1:1:Rt.specificity!==Ct.specificity?Rt.specificity>Ct.specificity?-1:1:0}}function Et(){return process$1.versions&&process$1.versions.electron||o.ELECTRON_RUN_AS_NODE?!0:typeof window<"u"&&window.process&&window.process.type==="renderer"}function xt(wt){return wt==="linux"&&s.existsSync("/etc/alpine-release")}return ht.parseTags=gt,ht.matchTags=mt,ht.compareTags=vt,nodeGypBuild}var binding,hasRequiredBinding;function requireBinding(){return hasRequiredBinding||(hasRequiredBinding=1,binding=requireNodeGypBuild()(__dirname)),binding}var chainedBatch,hasRequiredChainedBatch;function requireChainedBatch(){if(hasRequiredChainedBatch)return chainedBatch;hasRequiredChainedBatch=1;const o=util$b,s=requireAbstractLeveldown().AbstractChainedBatch,a=requireBinding();function et(tt){s.call(this,tt),this.context=a.batch_init(tt.context)}return et.prototype._put=function(tt,rt){a.batch_put(this.context,tt,rt)},et.prototype._del=function(tt){a.batch_del(this.context,tt)},et.prototype._clear=function(){a.batch_clear(this.context)},et.prototype._write=function(tt,rt){a.batch_write(this.context,tt,rt)},o.inherits(et,s),chainedBatch=et,chainedBatch}var iterator$1,hasRequiredIterator;function requireIterator(){if(hasRequiredIterator)return iterator$1;hasRequiredIterator=1;const o=util$b,s=requireAbstractLeveldown().AbstractIterator,a=requireBinding();function et(tt,rt){s.call(this,tt),this.context=a.iterator_init(tt.context,rt),this.cache=null,this.finished=!1}return o.inherits(et,s),et.prototype._seek=function(tt){if(tt.length===0)throw new Error("cannot seek() to an empty target");this.cache=null,a.iterator_seek(this.context,tt),this.finished=!1},et.prototype._next=function(tt){var rt=this;return this.cache&&this.cache.length?process$1.nextTick(tt,null,this.cache.pop(),this.cache.pop()):this.finished?process$1.nextTick(tt):a.iterator_next(this.context,function(nt,it,st){if(nt)return tt(nt);rt.cache=it,rt.finished=st,rt._next(tt)}),this},et.prototype._end=function(tt){delete this.cache,a.iterator_end(this.context,tt)},iterator$1=et,iterator$1}var leveldown$1,hasRequiredLeveldown;function requireLeveldown(){if(hasRequiredLeveldown)return leveldown$1;hasRequiredLeveldown=1;const o=util$b,s=requireAbstractLeveldown().AbstractLevelDOWN,a=requireBinding(),et=requireChainedBatch(),tt=requireIterator();function rt(nt){if(!(this instanceof rt))return new rt(nt);if(typeof nt!="string")throw new Error("constructor requires a location string argument");s.call(this,{bufferKeys:!0,snapshots:!0,permanence:!0,seek:!0,clear:!0,createIfMissing:!0,errorIfExists:!0,additionalMethods:{approximateSize:!0,compactRange:!0}}),this.location=nt,this.context=a.db_init()}return o.inherits(rt,s),rt.prototype._open=function(nt,it){a.db_open(this.context,this.location,nt,it)},rt.prototype._close=function(nt){a.db_close(this.context,nt)},rt.prototype._serializeKey=function(nt){return Buffer$2.isBuffer(nt)?nt:String(nt)},rt.prototype._serializeValue=function(nt){return Buffer$2.isBuffer(nt)?nt:String(nt)},rt.prototype._put=function(nt,it,st,ot){a.db_put(this.context,nt,it,st,ot)},rt.prototype._get=function(nt,it,st){a.db_get(this.context,nt,it,st)},rt.prototype._del=function(nt,it,st){a.db_del(this.context,nt,it,st)},rt.prototype._chainedBatch=function(){return new et(this)},rt.prototype._batch=function(nt,it,st){a.batch_do(this.context,nt,it,st)},rt.prototype.approximateSize=function(nt,it,st){if(nt==null||it==null||typeof nt=="function"||typeof it=="function")throw new Error("approximateSize() requires valid `start` and `end` arguments");if(typeof st!="function")throw new Error("approximateSize() requires a callback argument");nt=this._serializeKey(nt),it=this._serializeKey(it),a.db_approximate_size(this.context,nt,it,st)},rt.prototype.compactRange=function(nt,it,st){if(nt==null||it==null||typeof nt=="function"||typeof it=="function")throw new Error("compactRange() requires valid `start` and `end` arguments");if(typeof st!="function")throw new Error("compactRange() requires a callback argument");nt=this._serializeKey(nt),it=this._serializeKey(it),a.db_compact_range(this.context,nt,it,st)},rt.prototype.getProperty=function(nt){if(typeof nt!="string")throw new Error("getProperty() requires a valid `property` argument");return a.db_get_property(this.context,nt)},rt.prototype._iterator=function(nt){if(this.status!=="open")throw new Error("cannot call iterator() before open()");return new tt(this,nt)},rt.destroy=function(nt,it){if(arguments.length<2)throw new Error("destroy() requires `location` and `callback` arguments");if(typeof nt!="string")throw new Error("destroy() requires a location string argument");if(typeof it!="function")throw new Error("destroy() requires a callback function argument");a.destroy_db(nt,it)},rt.repair=function(nt,it){if(arguments.length<2)throw new Error("repair() requires `location` and `callback` arguments");if(typeof nt!="string")throw new Error("repair() requires a location string argument");if(typeof it!="function")throw new Error("repair() requires a callback function argument");a.repair_db(nt,it)},leveldown$1=rt.default=rt,leveldown$1}var document$1=document$4,schemas=schemas$2,async=asyncExports,bagpipe=bagpipe$1,Index=indexes,util$2=util$b,path=pathBrowserify,_$2=underscoreExports,events$1=eventsExports,Cursor=cursor$1,levelup=levelup$1,encode$f=encodingDown,hat=hatExports,leveldown=null;try{leveldown=requireLeveldown()}catch{}var stores={},LEVELUP_RETR_CONCURRENCY=10;function Model$1(o,s,a){if(typeof o!="string")throw"model name must be provided and a string";arguments.length==1&&(a={},s={}),arguments.length==2&&(a=s,s={});var et=function(it){return document$1.Document.call(this,et,it)};_$2.extend(et,Model$1.prototype);var tt=new events$1.EventEmitter;tt.setMaxListeners(0);for(var rt in tt)et[rt]=tt[rt];return et.modelName=o,et.schema=schemas.normalize(Object.assign({},s)),et.filename=path.normalize(a.filename||path.join(Model$1.dbPath||".",o+".db")),et.options=_$2.extend({},Model$1.defaults,a),et.indexes={},et.indexes._id=new Index({fieldName:"_id",unique:!0}),schemas.indexes(s).forEach(function(nt){et.ensureIndex(nt)}),et._pipe=new bagpipe(1),et._pipe.pause(),et._retrQueue=new bagpipe(LEVELUP_RETR_CONCURRENCY),et._retrQueue._locked={},et._retrQueue._locks={},et._methods={},et.options.autoLoad&&et.initStore(),et}Model$1.defaults={autoIndexing:!0,autoLoad:!0};Model$1.prototype.static=function(o,s){!Model$1.prototype.hasOwnProperty(o)&&typeof s=="function"&&(this[o]=s)};Model$1.prototype.method=function(o,s){!Model$1.prototype.hasOwnProperty(o)&&typeof s=="function"&&(this._methods[o]=s)};Model$1.prototype.initStore=function(){var o=this.filename;if(!o)return this._pipe.pause();this.store=stores[path.resolve(o)];var s=this.options.store||{},a=s.db||leveldown;this.store=stores[path.resolve(o)]=this.store&&this.store.isOpen()?this.store:levelup(encode$f(a(o),s),s),this._pipe.resume()};Model$1.prototype.reload=function(o){var s=this;s.emit("reset"),this.resetIndexes(),this._pipe.push(this.buildIndexes.bind(this),function(){o(null),s.emit("reload")})};Model$1.prototype.buildIndexes=function(o){var s=this,a=_$2.filter(s.indexes,function(et){return!et.ready});if(!a.length)return setTimeout(function(){o(null)});_$2.each(a,function(et){et.reset()}),s.emit("indexesBuild",a),s.store.createReadStream().on("data",function(et){var tt=schemas.construct(document$1.deserialize(et.value),s.schema);s.emit("construct",tt),s.emit("indexesConstruct",tt,a),_$2.each(a,function(rt){try{rt.insert(tt)}catch{}})}).on("end",function(){_$2.each(a,function(et){et.ready=!0}),s.emit("indexesReady",a),o(null)})};Model$1.prototype.getAllData=function(){return this.indexes._id.getAll()};Model$1.prototype.resetIndexes=function(){var o=this;Object.keys(this.indexes).forEach(function(s){o.indexes[s].reset()})};Model$1.prototype.ensureIndex=function(o,s){var a=s||function(){};if(o=o||{},!o.fieldName)return a({missingFieldName:!0});if(this.indexes[o.fieldName])return a(null);this.indexes[o.fieldName]=new Index(o),a(null)};Model$1.prototype.removeIndex=function(o,s){var a=s||function(){};delete this.indexes[o],a(null)};Model$1.prototype.addToIndexes=function(o){var s,a,et,tt=Object.keys(this.indexes);for(s=0;s<tt.length;s+=1)try{this.indexes[tt[s]].insert(o)}catch(rt){a=s,et=rt;break}if(et){for(s=0;s<a;s+=1)this.indexes[tt[s]].remove(o);throw et}};Model$1.prototype.removeFromIndexes=function(o){var s=this;Object.keys(this.indexes).forEach(function(a){s.indexes[a].remove(o)})};Model$1.prototype.updateIndexes=function(o,s){var a,et,tt,rt=Object.keys(this.indexes);for(o&&o._id,s&&s._id,a=0;a<rt.length;a+=1)try{this.indexes[rt[a]].update(o,s)}catch(nt){et=a,tt=nt;break}if(tt){for(a=0;a<et;a+=1)this.indexes[rt[a]].revertUpdate(o,s);throw tt}};Model$1.prototype.insert=function(o,s){var a=util$2.isArray(o),et=s||function(){},tt=this;o=(util$2.isArray(o)?o:[o]).map(function(rt){return new tt(rt)}),tt._pipe.push(this.buildIndexes.bind(this),function(){try{tt._insertInIdx(o)}catch(rt){return et(rt)}async.map(o,function(rt,nt){tt.emit("insert",rt),rt._persist(nt)},function(rt,nt){tt.emit("inserted",nt),et(rt||null,rt?void 0:a?nt:nt[0])})})};Model$1.prototype.createNewId=function(){var o=hat(32);return this.indexes._id.getMatching(o).length>0&&(o=this.createNewId()),o};Model$1.prototype.prepareDocumentForInsertion=function(o){var s=this;return(util$2.isArray(o)?o:[o]).forEach(function(a){a._id===void 0&&(a._id=s.createNewId()),document$1.checkObject(a)}),o};Model$1.prototype._insertInIdx=function(o){util$2.isArray(o)?this._insertMultipleDocsInIdx(o):this.addToIndexes(this.prepareDocumentForInsertion(o))};Model$1.prototype._insertMultipleDocsInIdx=function(o){var s,a,et,tt=this.prepareDocumentForInsertion(o);for(s=0;s<tt.length;s+=1)try{this.addToIndexes(tt[s])}catch(rt){et=rt,a=s;break}if(et){for(s=0;s<a;s+=1)this.removeFromIndexes(tt[s]);throw et}};Model$1.prototype.findById=function(o,s){return this.findOne({_id:o},s)};Model$1.prototype.count=function(o,s,a){var et=new Cursor(this,o);return et._quiet=a,typeof s=="function"&&et.count(s),et};Model$1.prototype.find=function(o,s,a){var et=new Cursor(this,o,function(tt,rt,nt){return nt(tt||null,tt?void 0:rt)});return et._quiet=a,typeof s=="function"&&et.exec(s),et};Model$1.prototype.findOne=function(o,s){var a=new Cursor(this,o,function(et,tt,rt){return et?rt(et):rt(null,tt.length?tt[0]:null)});return typeof s=="function"&&a.exec(s),a};Model$1.prototype.live=function(o){return this.find(o).live()};Model$1.prototype.update=function(o,s,a,et){var tt,rt=this,nt,it,st;typeof a=="function"&&(et=a,a={}),tt=_$2.once(et||function(){}),nt=a.multi!==void 0?a.multi:!1,it=a.upsert!==void 0?a.upsert:!1;var ot=Cursor.getMatchesStream(rt,o);ot.on("error",function(at){st=at,ot.close(),tt(st)}),ot.on("ids",function(at){var lt=at._indexed;if(it&&!at.length){var ct;if(typeof s=="function")ct=new rt(document$1.deepCopy(o,!0)),s(ct);else try{document$1.checkObject(s),ct=s}catch{try{ct=document$1.modify(document$1.deepCopy(o,!0),s)}catch(dt){ot.close(),tt(dt)}}return rt.insert(ct,function(ft,dt){return ft?tt(ft):tt(null,1,dt)})}var ht=[];ot.on("data",function(ft){try{if(!lt&&!document$1.match(ft.val(),o))return}catch(pt){st=pt,ot.close();return}try{var dt=ft.lock();if(typeof s=="function"){if(s(dt),ft.id!=dt._id)throw"update function cannot change _id";ft.newDoc=dt}else ft.newDoc=document$1.modify(dt,s);ft.oldDoc=dt.copy(),_$2.extend(dt,ft.newDoc),ht.push(ft),nt||ot.close()}catch(pt){st=pt,ot.close(),ft.unlock();return}}),ot.on("ready",function(){if(st)return tt(st);try{rt.updateIndexes(ht)}catch(ft){return tt(ft)}async.map(ht,function(ft,dt){new rt(ft.newDoc)._persist(function(pt,gt){ft.unlock(),dt(pt,gt)})},function(ft,dt){dt&&rt.emit("updated",dt),tt(ft||null,ft?void 0:dt.length,!ft&&dt.length?dt[0]:void 0)})})})};Model$1.prototype.save=function(o,s,a){var et=this;s=s||function(){},o=(Array.isArray(o)?o:[o]).map(function(nt){return nt.constructor.modelName==et.modelName?nt:new et(nt)}),this.prepareDocumentForInsertion(o);var tt={},rt=Cursor.getMatchesStream(this,{_id:{$in:_$2.chain(o).pluck("_id").compact().value()}});rt.on("error",function(nt){rt.close(),s(nt)}),rt.on("data",function(nt){tt[nt.id]=nt.val()}),rt.on("ready",function(){var nt=[];o.forEach(function(it){nt.push({oldDoc:tt[it._id],newDoc:it})});try{et.updateIndexes(nt)}catch(it){return s(it)}async.each(nt,function(it,st){!it.oldDoc&&!a&&et.emit("insert",it.newDoc),it.newDoc._persist(st,a)},function(it){if(it)return s(it);var st=nt.filter(function(at){return!at.oldDoc}).map(function(at){return at.newDoc}),ot=nt.filter(function(at){return at.oldDoc}).map(function(at){return at.newDoc});st.length&&et.emit("inserted",st,a),ot.length&&et.emit("updated",ot,a),s(null,o.length<=1?o[0]:o,{inserted:st.length,updated:ot.length})})})};Model$1.prototype.remove=function(o,s,a){var et,tt=this,rt=[],nt;typeof s=="function"&&(a=s,s={}),et=a||function(){};var it=s.multi!==void 0?s.multi:!1,st=Cursor.getMatchesStream(this,o),ot;st.on("ids",function(at){ot=at._indexed}),st.on("data",function(at){try{var lt=at.val();(ot||document$1.match(lt,o))&&(it||rt.length===0)&&(rt.push(lt._id),tt.removeFromIndexes(lt),tt.emit("remove",lt))}catch(ct){nt=ct}}),st.on("ready",function(){if(nt)return et(nt);async.each(rt,function(at,lt){tt.store.del(at,lt)},function(at){tt.emit("removed",rt),et(at||null,at?void 0:rt.length)})}),st.on("error",function(at){st.close(),et(at)})};Model$1.Cursor=Cursor;var model=Model$1,Model=model,linvodb3=Model;const LinvoDB=getDefaultExportFromCjs$2(linvodb3);var abstractLeveldown$1={},levelSupports=function(...s){const a=s.reduce((et,tt)=>Object.assign(et,tt),{});return Object.assign(a,{bufferKeys:a.bufferKeys||!1,snapshots:a.snapshots||!1,permanence:a.permanence||!1,seek:a.seek||!1,clear:a.clear||!1,getMany:a.getMany||!1,keyIterator:a.keyIterator||!1,valueIterator:a.valueIterator||!1,iteratorNextv:a.iteratorNextv||!1,iteratorAll:a.iteratorAll||!1,status:a.status||!1,idempotentOpen:a.idempotentOpen||!1,passiveOpen:a.passiveOpen||!1,serialize:a.serialize||!1,createIfMissing:a.createIfMissing||!1,errorIfExists:a.errorIfExists||!1,deferredOpen:a.deferredOpen||!1,openCallback:a.openCallback||!1,promises:a.promises||!1,streams:a.streams||!1,encodings:maybeObject(a.encodings),events:maybeObject(a.events),additionalMethods:Object.assign({},a.additionalMethods)})};function maybeObject(o){return o?Object.assign({},o):!1}/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var isBuffer$3=function(s){return s!=null&&s.constructor!=null&&typeof s.constructor.isBuffer=="function"&&s.constructor.isBuffer(s)},catering$1={},nextTickBrowser$1=typeof queueMicrotask=="function"?queueMicrotask:o=>Promise.resolve().then(o),nextTick$1=nextTickBrowser$1;catering$1.fromCallback=function(o,s){if(o===void 0){var a=new Promise(function(et,tt){o=function(rt,nt){rt?tt(rt):et(nt)}});o[s!==void 0?s:"promise"]=a}else if(typeof o!="function")throw new TypeError("Callback must be a function");return o};catering$1.fromPromise=function(o,s){if(s===void 0)return o;o.then(function(a){nextTick$1(()=>s(null,a))}).catch(function(a){nextTick$1(()=>s(a))})};/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let promise;var queueMicrotask_1=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:commonjsGlobal):o=>(promise||(promise=Promise.resolve())).then(o).catch(s=>setTimeout(()=>{throw s},0));const queueMicrotask$2=queueMicrotask_1;var nextTickBrowser=function(o,...s){s.length===0?queueMicrotask$2(o):queueMicrotask$2(()=>o(...s))};function AbstractIterator$2(o){if(typeof o!="object"||o===null)throw new TypeError("First argument must be an abstract-leveldown compliant store");this.db=o,this._ended=!1,this._nexting=!1}AbstractIterator$2.prototype.next=function(o){let s=this;if(o===void 0)s=new Promise(function(a,et){o=function(tt,rt,nt){tt?et(tt):rt===void 0&&nt===void 0?a():a([rt,nt])}});else if(typeof o!="function")throw new Error("next() requires a callback argument");return this._ended?(this._nextTick(o,new Error("cannot call next() after end()")),s):this._nexting?(this._nextTick(o,new Error("cannot call next() before previous next() has completed")),s):(this._nexting=!0,this._next((a,...et)=>{this._nexting=!1,o(a,...et)}),s)};AbstractIterator$2.prototype._next=function(o){this._nextTick(o)};AbstractIterator$2.prototype.seek=function(o){if(this._ended)throw new Error("cannot call seek() after end()");if(this._nexting)throw new Error("cannot call seek() before next() has completed");o=this.db._serializeKey(o),this._seek(o)};AbstractIterator$2.prototype._seek=function(o){};AbstractIterator$2.prototype.end=function(o){let s;if(o===void 0)s=new Promise(function(a,et){o=function(tt){tt?et(tt):a()}});else if(typeof o!="function")throw new Error("end() requires a callback argument");return this._ended?(this._nextTick(o,new Error("end() already called on iterator")),s):(this._ended=!0,this._end(o),s)};AbstractIterator$2.prototype._end=function(o){this._nextTick(o)};AbstractIterator$2.prototype[Symbol.asyncIterator]=async function*(){try{let o;for(;(o=await this.next())!==void 0;)yield o}finally{this._ended||await this.end()}};AbstractIterator$2.prototype._nextTick=nextTickBrowser;var abstractIterator=AbstractIterator$2;const emptyOptions=Object.freeze({});function AbstractChainedBatch$1(o){if(typeof o!="object"||o===null)throw new TypeError("First argument must be an abstract-leveldown compliant store");this.db=o,this._operations=[],this._written=!1}AbstractChainedBatch$1.prototype._checkWritten=function(){if(this._written)throw new Error("write() already called on this batch")};AbstractChainedBatch$1.prototype.put=function(o,s,a){this._checkWritten();const et=this.db._checkKey(o)||this.db._checkValue(s);if(et)throw et;return o=this.db._serializeKey(o),s=this.db._serializeValue(s),this._put(o,s,a??emptyOptions),this};AbstractChainedBatch$1.prototype._put=function(o,s,a){this._operations.push({...a,type:"put",key:o,value:s})};AbstractChainedBatch$1.prototype.del=function(o,s){this._checkWritten();const a=this.db._checkKey(o);if(a)throw a;return o=this.db._serializeKey(o),this._del(o,s??emptyOptions),this};AbstractChainedBatch$1.prototype._del=function(o,s){this._operations.push({...s,type:"del",key:o})};AbstractChainedBatch$1.prototype.clear=function(){return this._checkWritten(),this._clear(),this};AbstractChainedBatch$1.prototype._clear=function(){this._operations=[]};AbstractChainedBatch$1.prototype.write=function(o,s){if(this._checkWritten(),typeof o=="function"&&(s=o),typeof s!="function")throw new Error("write() requires a callback argument");(typeof o!="object"||o===null)&&(o={}),this._written=!0,this._write(o,s)};AbstractChainedBatch$1.prototype._write=function(o,s){this.db._batch(this._operations,o,s)};AbstractChainedBatch$1.prototype._nextTick=nextTickBrowser;var abstractChainedBatch=AbstractChainedBatch$1,common$2={};common$2.getCallback=function(o,s){return typeof o=="function"?o:s};common$2.getOptions=function(o){return typeof o=="object"&&o!==null?o:{}};const supports$1=levelSupports,isBuffer$2=isBuffer$3,catering=catering$1,AbstractIterator$1=abstractIterator,AbstractChainedBatch=abstractChainedBatch,getCallback=common$2.getCallback,getOptions=common$2.getOptions,hasOwnProperty$1=Object.prototype.hasOwnProperty,rangeOptions=["lt","lte","gt","gte"];function AbstractLevelDOWN$1(o){this.status="new",this.supports=supports$1(o,{status:!0})}AbstractLevelDOWN$1.prototype.open=function(o,s){const a=this.status;if(typeof o=="function"&&(s=o),typeof s!="function")throw new Error("open() requires a callback argument");(typeof o!="object"||o===null)&&(o={}),o.createIfMissing=o.createIfMissing!==!1,o.errorIfExists=!!o.errorIfExists,this.status="opening",this._open(o,et=>{if(et)return this.status=a,s(et);this.status="open",s()})};AbstractLevelDOWN$1.prototype._open=function(o,s){this._nextTick(s)};AbstractLevelDOWN$1.prototype.close=function(o){const s=this.status;if(typeof o!="function")throw new Error("close() requires a callback argument");this.status="closing",this._close(a=>{if(a)return this.status=s,o(a);this.status="closed",o()})};AbstractLevelDOWN$1.prototype._close=function(o){this._nextTick(o)};AbstractLevelDOWN$1.prototype.get=function(o,s,a){if(typeof s=="function"&&(a=s),typeof a!="function")throw new Error("get() requires a callback argument");const et=this._checkKey(o);if(et)return this._nextTick(a,et);o=this._serializeKey(o),(typeof s!="object"||s===null)&&(s={}),s.asBuffer=s.asBuffer!==!1,this._get(o,s,a)};AbstractLevelDOWN$1.prototype._get=function(o,s,a){this._nextTick(function(){a(new Error("NotFound"))})};AbstractLevelDOWN$1.prototype.getMany=function(o,s,a){if(a=getCallback(s,a),a=catering.fromCallback(a),s=getOptions(s),maybeError(this,a))return a.promise;if(!Array.isArray(o))return this._nextTick(a,new Error("getMany() requires an array argument")),a.promise;if(o.length===0)return this._nextTick(a,null,[]),a.promise;typeof s.asBuffer!="boolean"&&(s={...s,asBuffer:!0});const et=new Array(o.length);for(let tt=0;tt<o.length;tt++){const rt=o[tt],nt=this._checkKey(rt);if(nt)return this._nextTick(a,nt),a.promise;et[tt]=this._serializeKey(rt)}return this._getMany(et,s,a),a.promise};AbstractLevelDOWN$1.prototype._getMany=function(o,s,a){this._nextTick(a,null,new Array(o.length).fill(void 0))};AbstractLevelDOWN$1.prototype.put=function(o,s,a,et){if(typeof a=="function"&&(et=a),typeof et!="function")throw new Error("put() requires a callback argument");const tt=this._checkKey(o)||this._checkValue(s);if(tt)return this._nextTick(et,tt);o=this._serializeKey(o),s=this._serializeValue(s),(typeof a!="object"||a===null)&&(a={}),this._put(o,s,a,et)};AbstractLevelDOWN$1.prototype._put=function(o,s,a,et){this._nextTick(et)};AbstractLevelDOWN$1.prototype.del=function(o,s,a){if(typeof s=="function"&&(a=s),typeof a!="function")throw new Error("del() requires a callback argument");const et=this._checkKey(o);if(et)return this._nextTick(a,et);o=this._serializeKey(o),(typeof s!="object"||s===null)&&(s={}),this._del(o,s,a)};AbstractLevelDOWN$1.prototype._del=function(o,s,a){this._nextTick(a)};AbstractLevelDOWN$1.prototype.batch=function(o,s,a){if(!arguments.length)return this._chainedBatch();if(typeof s=="function"&&(a=s),typeof o=="function"&&(a=o),typeof a!="function")throw new Error("batch(array) requires a callback argument");if(!Array.isArray(o))return this._nextTick(a,new Error("batch(array) requires an array argument"));if(o.length===0)return this._nextTick(a);(typeof s!="object"||s===null)&&(s={});const et=new Array(o.length);for(let tt=0;tt<o.length;tt++){if(typeof o[tt]!="object"||o[tt]===null)return this._nextTick(a,new Error("batch(array) element must be an object and not `null`"));const rt=Object.assign({},o[tt]);if(rt.type!=="put"&&rt.type!=="del")return this._nextTick(a,new Error("`type` must be 'put' or 'del'"));const nt=this._checkKey(rt.key);if(nt)return this._nextTick(a,nt);if(rt.key=this._serializeKey(rt.key),rt.type==="put"){const it=this._checkValue(rt.value);if(it)return this._nextTick(a,it);rt.value=this._serializeValue(rt.value)}et[tt]=rt}this._batch(et,s,a)};AbstractLevelDOWN$1.prototype._batch=function(o,s,a){this._nextTick(a)};AbstractLevelDOWN$1.prototype.clear=function(o,s){if(typeof o=="function")s=o;else if(typeof s!="function")throw new Error("clear() requires a callback argument");o=cleanRangeOptions(this,o),o.reverse=!!o.reverse,o.limit="limit"in o?o.limit:-1,this._clear(o,s)};AbstractLevelDOWN$1.prototype._clear=function(o,s){o.keys=!0,o.values=!1,o.keyAsBuffer=!0,o.valueAsBuffer=!0;const a=this._iterator(o),et={},tt=rt=>{if(rt)return a.end(function(){s(rt)});a.next((nt,it)=>{if(nt)return tt(nt);if(it===void 0)return a.end(s);this._del(it,et,tt)})};tt()};AbstractLevelDOWN$1.prototype._setupIteratorOptions=function(o){return o=cleanRangeOptions(this,o),o.reverse=!!o.reverse,o.keys=o.keys!==!1,o.values=o.values!==!1,o.limit="limit"in o?o.limit:-1,o.keyAsBuffer=o.keyAsBuffer!==!1,o.valueAsBuffer=o.valueAsBuffer!==!1,o};function cleanRangeOptions(o,s){const a={};for(const et in s){if(!hasOwnProperty$1.call(s,et))continue;if(et==="start"||et==="end")throw new Error('Legacy range options ("start" and "end") have been removed');let tt=s[et];isRangeOption(et)&&(tt=o._serializeKey(tt)),a[et]=tt}return a}function isRangeOption(o){return rangeOptions.indexOf(o)!==-1}AbstractLevelDOWN$1.prototype.iterator=function(o){return(typeof o!="object"||o===null)&&(o={}),o=this._setupIteratorOptions(o),this._iterator(o)};AbstractLevelDOWN$1.prototype._iterator=function(o){return new AbstractIterator$1(this)};AbstractLevelDOWN$1.prototype._chainedBatch=function(){return new AbstractChainedBatch(this)};AbstractLevelDOWN$1.prototype._serializeKey=function(o){return o};AbstractLevelDOWN$1.prototype._serializeValue=function(o){return o};AbstractLevelDOWN$1.prototype._checkKey=function(o){if(o==null)return new Error("key cannot be `null` or `undefined`");if(isBuffer$2(o)&&o.length===0)return new Error("key cannot be an empty Buffer");if(o==="")return new Error("key cannot be an empty String");if(Array.isArray(o)&&o.length===0)return new Error("key cannot be an empty Array")};AbstractLevelDOWN$1.prototype._checkValue=function(o){if(o==null)return new Error("value cannot be `null` or `undefined`")};AbstractLevelDOWN$1.prototype.isOperational=function(){return this.status==="open"||this._isOperational()};AbstractLevelDOWN$1.prototype._isOperational=function(){return!1};AbstractLevelDOWN$1.prototype._nextTick=nextTickBrowser;var abstractLeveldown=AbstractLevelDOWN$1;function maybeError(o,s){return o.isOperational()?!1:(o._nextTick(s,new Error("Database is not open")),!0)}abstractLeveldown$1.AbstractLevelDOWN=abstractLeveldown;abstractLeveldown$1.AbstractIterator=abstractIterator;abstractLeveldown$1.AbstractChainedBatch=abstractChainedBatch;/*! run-parallel-limit. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var runParallelLimit_1=runParallelLimit;const queueMicrotask$1=queueMicrotask_1;function runParallelLimit(o,s,a){if(typeof s!="number")throw new Error("second argument must be a Number");let et,tt,rt,nt,it,st=!0,ot;Array.isArray(o)?(et=[],rt=tt=o.length):(nt=Object.keys(o),et={},rt=tt=nt.length);function at(ct){function ht(){a&&a(ct,et),a=null}st?queueMicrotask$1(ht):ht()}function lt(ct,ht,ft){if(et[ct]=ft,ht&&(it=!0),--rt===0||ht)at(ht);else if(!it&&ot<tt){let dt;nt?(dt=nt[ot],ot+=1,o[dt](function(pt,gt){lt(dt,pt,gt)})):(dt=ot,ot+=1,o[dt](function(pt,gt){lt(dt,pt,gt)}))}}ot=s,rt?nt?nt.some(function(ct,ht){return o[ct](function(ft,dt){lt(ct,ft,dt)}),ht===s-1}):o.some(function(ct,ht){return ct(function(ft,dt){lt(ht,ft,dt)}),ht===s-1}):at(null),st=!1}var ltgt$1={};(function(o){o.compare=function(ht,ft){if(Buffer$2.isBuffer(ht)){for(var dt=Math.min(ht.length,ft.length),pt=0;pt<dt;pt++){var gt=ht[pt]-ft[pt];if(gt)return gt}return ht.length-ft.length}return ht<ft?-1:ht>ft?1:0};function s(ht){return ht!==void 0&&ht!==""}function a(ht,ft){return Object.hasOwnProperty.call(ht,ft)}function et(ht,ft){return Object.hasOwnProperty.call(ht,ft)&&ft}var tt=o.lowerBoundKey=function(ht){return et(ht,"gt")||et(ht,"gte")||et(ht,"min")||(ht.reverse?et(ht,"end"):et(ht,"start"))||void 0},rt=o.lowerBound=function(ht,ft){var dt=tt(ht);return dt?ht[dt]:ft},nt=o.lowerBoundInclusive=function(ht){return!a(ht,"gt")},it=o.upperBoundInclusive=function(ht){return!a(ht,"lt")},st=o.lowerBoundExclusive=function(ht){return!nt(ht)},ot=o.upperBoundExclusive=function(ht){return!it(ht)},at=o.upperBoundKey=function(ht){return et(ht,"lt")||et(ht,"lte")||et(ht,"max")||(ht.reverse?et(ht,"start"):et(ht,"end"))||void 0},lt=o.upperBound=function(ht,ft){var dt=at(ht);return dt?ht[dt]:ft};o.start=function(ht,ft){return ht.reverse?lt(ht,ft):rt(ht,ft)},o.end=function(ht,ft){return ht.reverse?rt(ht,ft):lt(ht,ft)},o.startInclusive=function(ht){return ht.reverse?it(ht):nt(ht)},o.endInclusive=function(ht){return ht.reverse?nt(ht):it(ht)};function ct(ht){return ht}o.toLtgt=function(ht,ft,dt,pt,gt){ft=ft||{},dt=dt||ct;var mt=arguments.length>3,yt=o.lowerBoundKey(ht),vt=o.upperBoundKey(ht);return yt?yt==="gt"?ft.gt=dt(ht.gt,!1):ft.gte=dt(ht[yt],!1):mt&&(ft.gte=dt(pt,!1)),vt?vt==="lt"?ft.lt=dt(ht.lt,!0):ft.lte=dt(ht[vt],!0):mt&&(ft.lte=dt(gt,!0)),ht.reverse!=null&&(ft.reverse=!!ht.reverse),a(ft,"max")&&delete ft.max,a(ft,"min")&&delete ft.min,a(ft,"start")&&delete ft.start,a(ft,"end")&&delete ft.end,ft},o.contains=function(ht,ft,dt){dt=dt||o.compare;var pt=rt(ht);if(s(pt)){var gt=dt(ft,pt);if(gt<0||gt===0&&st(ht))return!1}var mt=lt(ht);if(s(mt)){var gt=dt(ft,mt);if(gt>0||gt===0&&ot(ht))return!1}return!0},o.filter=function(ht,ft){return function(dt){return o.contains(ht,dt,ft)}}})(ltgt$1);const ltgt=ltgt$1,NONE=Symbol("none");var keyRange=function(s){const a=ltgt.lowerBound(s,NONE),et=ltgt.upperBound(s,NONE),tt=ltgt.lowerBoundExclusive(s,NONE),rt=ltgt.upperBoundExclusive(s,NONE);return a!==NONE&&et!==NONE?IDBKeyRange.bound(a,et,tt,rt):a!==NONE?IDBKeyRange.lowerBound(a,tt):et!==NONE?IDBKeyRange.upperBound(et,rt):null};const Buffer$1=dist.Buffer,ta2str=function(){if(commonjsGlobal.TextDecoder){const o=new TextDecoder("utf-8");return o.decode.bind(o)}else return function(s){return ta2buf(s).toString()}}(),ab2str=function(){if(commonjsGlobal.TextDecoder){const o=new TextDecoder("utf-8");return o.decode.bind(o)}else return function(s){return Buffer$1.from(s).toString()}}();function ta2buf(o){const s=Buffer$1.from(o.buffer);return o.byteLength===o.buffer.byteLength?s:s.slice(o.byteOffset,o.byteOffset+o.byteLength)}var deserialize$2=function(o,s){return o instanceof Uint8Array?s?ta2buf(o):ta2str(o):o instanceof ArrayBuffer?s?Buffer$1.from(o):ab2str(o):s?Buffer$1.from(String(o)):String(o)};const inherits$2=inherits_browserExports,AbstractIterator=abstractLeveldown$1.AbstractIterator,createKeyRange$1=keyRange,deserialize$1=deserialize$2,noop$5=function(){};var iterator=Iterator$1;function Iterator$1(o,s,a){if(AbstractIterator.call(this,o),this._limit=a.limit,this._count=0,this._callback=null,this._cache=[],this._completed=!1,this._aborted=!1,this._error=null,this._transaction=null,this._keys=a.keys,this._values=a.values,this._keyAsBuffer=a.keyAsBuffer,this._valueAsBuffer=a.valueAsBuffer,this._limit===0){this._completed=!0;return}let et;try{et=createKeyRange$1(a)}catch{this._completed=!0;return}this.createIterator(s,et,a.reverse)}inherits$2(Iterator$1,AbstractIterator);Iterator$1.prototype.createIterator=function(o,s,a){const et=this.db.db.transaction([o],"readonly"),rt=et.objectStore(o).openCursor(s,a?"prev":"next");rt.onsuccess=nt=>{const it=nt.target.result;it&&this.onItem(it)},this._transaction=et,et.onabort=()=>{this.onAbort(this._transaction.error||new Error("aborted by user"))},et.oncomplete=()=>{this.onComplete()}};Iterator$1.prototype.onItem=function(o){this._cache.push(o.key,o.value),(this._limit<=0||++this._count<this._limit)&&o.continue(),this.maybeNext()};Iterator$1.prototype.onAbort=function(o){this._aborted=!0,this._error=o,this.maybeNext()};Iterator$1.prototype.onComplete=function(){this._completed=!0,this.maybeNext()};Iterator$1.prototype.maybeNext=function(){this._callback&&(this._next(this._callback),this._callback=null)};Iterator$1.prototype._next=function(o){if(this._aborted){const s=this._error;this._error=null,this._nextTick(o,s)}else if(this._cache.length>0){let s=this._cache.shift(),a=this._cache.shift();this._keys&&s!==void 0?s=this._deserializeKey(s,this._keyAsBuffer):s=void 0,this._values&&a!==void 0?a=this._deserializeValue(a,this._valueAsBuffer):a=void 0,this._nextTick(o,null,s,a)}else this._completed?this._nextTick(o):this._callback=o};Iterator$1.prototype._deserializeKey=deserialize$1;Iterator$1.prototype._deserializeValue=deserialize$1;Iterator$1.prototype._end=function(o){if(this._aborted||this._completed)return this._nextTick(o,this._error);this.onItem=noop$5,this.onAbort=o,this.onComplete=o};const Buffer=dist.Buffer,str2bin=function(){if(commonjsGlobal.TextEncoder){const o=new TextEncoder("utf-8");return o.encode.bind(o)}else return Buffer.from}();var serialize$2=function(o,s){return s?Buffer.isBuffer(o)?o:str2bin(String(o)):String(o)},support$2={};(function(o){const s=dist.Buffer;o.test=function(a){return function(tt){try{return tt.cmp(a,0),!0}catch{return!1}}},o.bufferKeys=o.test(s.alloc(0))})(support$2);var clear$1=function(s,a,et,tt,rt){if(tt.limit===0)return s._nextTick(rt);const nt=s.db.transaction([a],"readwrite"),it=nt.objectStore(a);let st=0;nt.oncomplete=function(){rt()},nt.onabort=function(){rt(nt.error||new Error("aborted by user"))};const ot=it.openKeyCursor?"openKeyCursor":"openCursor",at=tt.reverse?"prev":"next";it[ot](et,at).onsuccess=function(lt){const ct=lt.target.result;ct&&(it.delete(ct.key).onsuccess=function(){(tt.limit<=0||++st<tt.limit)&&ct.continue()})}},levelJs=Level$1;const AbstractLevelDOWN=abstractLeveldown$1.AbstractLevelDOWN,inherits$1=inherits_browserExports,parallel$1=runParallelLimit_1,Iterator=iterator,serialize$1=serialize$2,deserialize=deserialize$2,support$1=support$2,clear=clear$1,createKeyRange=keyRange,DEFAULT_PREFIX="level-js-";function Level$1(o,s){if(!(this instanceof Level$1))return new Level$1(o,s);if(AbstractLevelDOWN.call(this,{bufferKeys:support$1.bufferKeys(indexedDB),snapshots:!0,permanence:!0,clear:!0,getMany:!0}),s=s||{},typeof o!="string")throw new Error("constructor requires a location string argument");this.location=o,this.prefix=s.prefix==null?DEFAULT_PREFIX:s.prefix,this.version=parseInt(s.version||1,10)}inherits$1(Level$1,AbstractLevelDOWN);Level$1.prototype.type="level-js";Level$1.prototype._open=function(o,s){const a=indexedDB.open(this.prefix+this.location,this.version);a.onerror=function(){s(a.error||new Error("unknown error"))},a.onsuccess=()=>{this.db=a.result,s()},a.onupgradeneeded=et=>{const tt=et.target.result;tt.objectStoreNames.contains(this.location)||tt.createObjectStore(this.location)}};Level$1.prototype.store=function(o){return this.db.transaction([this.location],o).objectStore(this.location)};Level$1.prototype.await=function(o,s){const a=o.transaction;a.onabort=function(){s(a.error||new Error("aborted by user"))},a.oncomplete=function(){s(null,o.result)}};Level$1.prototype._get=function(o,s,a){const et=this.store("readonly");let tt;try{tt=et.get(o)}catch(rt){return this._nextTick(a,rt)}this.await(tt,function(rt,nt){if(rt)return a(rt);if(nt===void 0)return a(new Error("NotFound"));a(null,deserialize(nt,s.asBuffer))})};Level$1.prototype._getMany=function(o,s,a){const et=s.asBuffer,tt=this.store("readonly"),rt=o.map(nt=>it=>{let st;try{st=tt.get(nt)}catch(ot){return it(ot)}st.onsuccess=()=>{const ot=st.result;it(null,ot===void 0?ot:deserialize(ot,et))},st.onerror=ot=>{ot.stopPropagation(),it(st.error)}});parallel$1(rt,16,a)};Level$1.prototype._del=function(o,s,a){const et=this.store("readwrite");let tt;try{tt=et.delete(o)}catch(rt){return this._nextTick(a,rt)}this.await(tt,a)};Level$1.prototype._put=function(o,s,a,et){const tt=this.store("readwrite");let rt;try{rt=tt.put(s,o)}catch(nt){return this._nextTick(et,nt)}this.await(rt,et)};Level$1.prototype._serializeKey=function(o){return serialize$1(o,this.supports.bufferKeys)};Level$1.prototype._serializeValue=function(o){return serialize$1(o,!0)};Level$1.prototype._iterator=function(o){return new Iterator(this,this.location,o)};Level$1.prototype._batch=function(o,s,a){if(o.length===0)return this._nextTick(a);const et=this.store("readwrite"),tt=et.transaction;let rt=0,nt;tt.onabort=function(){a(nt||tt.error||new Error("aborted by user"))},tt.oncomplete=function(){a()};function it(){const st=o[rt++],ot=st.key;let at;try{at=st.type==="del"?et.delete(ot):et.put(st.value,ot)}catch(lt){nt=lt,tt.abort();return}rt<o.length&&(at.onsuccess=it)}it()};Level$1.prototype._clear=function(o,s){let a,et;try{a=createKeyRange(o)}catch{return this._nextTick(s)}if(o.limit>=0)return clear(this,this.location,a,o,s);try{const tt=this.store("readwrite");et=a?tt.delete(a):tt.clear()}catch(tt){return this._nextTick(s,tt)}this.await(et,s)};Level$1.prototype._close=function(o){this.db.close(),this._nextTick(o)};Level$1.prototype.upgrade=function(o){if(this.status!=="open")return this._nextTick(o,new Error("cannot upgrade() before open()"));const s=this.iterator(),a={},et=this;s._deserializeKey=s._deserializeValue=it,tt();function tt(st){if(st)return nt(st);s.next(rt)}function rt(st,ot,at){if(st||ot===void 0)return nt(st);const lt=et._serializeKey(deserialize(ot,!0)),ct=et._serializeValue(deserialize(at,!0));et._batch([{type:"del",key:ot},{type:"put",key:lt,value:ct}],a,tt)}function nt(st){s.end(function(ot){o(st||ot)})}function it(st){return st}};Level$1.destroy=function(o,s,a){typeof s=="function"&&(a=s,s=DEFAULT_PREFIX);const et=indexedDB.deleteDatabase(s+o);et.onsuccess=function(){a()},et.onerror=function(tt){a(tt)}};const engine=getDefaultExportFromCjs$2(levelJs);LinvoDB.defaults.store={db:engine};LinvoDB.defaults.autoIndexing=!1;class DB{constructor(){this.db={},this.id=null}connect(s){return s in this.db||(log$d.warn(`Connecting to db: ${s}`),this.db[s]=new LinvoDB(s)),this.id=s,this}_promiseFactory(s){return new Promise((a,et)=>{if(!(this.id in this.db))return et();s(a)})}exists(s){return s in this.db}delete(){return this._promiseFactory(s=>{this.db[this.id].remove({},{multi:!0},a=>{delete this.db[this.id],s(!0)})})}insert(s){return this._promiseFactory(a=>{this.db[this.id].insert(s,()=>{a(s)})})}search(s){return this._promiseFactory(a=>{const et=new RegExp(`${s}`,"gi");this.db[this.id].find({"meta.title":{$regex:et}}).exec((tt,rt)=>{a(rt)})})}filter(s={}){return this._promiseFactory(a=>{const et=Object.is(s.order,"desc")?-1:1,tt={..."genres"in s&&{"meta.genres":{$in:[s.genres]}}};this.db[this.id].find(tt).sort({[s.sort_by]:et}).limit(s.limit).skip(s.skip).exec((rt,nt)=>{a(nt)})})}get(s){return this._promiseFactory(a=>{this.db[this.id].findOne({_id:s},(et,tt)=>{a(tt)})})}all(){return this._promiseFactory(s=>{this.db[this.id].find({},(a,et)=>{s(et)})})}count(s){return this._promiseFactory(a=>{this.db[this.id].count(s,(et,tt)=>{a(tt)})})}}function DBFactory(){return new DB}function asUint8Array$c(o){return globalThis.Buffer!=null?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):o}function allocUnsafe$t(o=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?asUint8Array$c(globalThis.Buffer.allocUnsafe(o)):new Uint8Array(o)}function concat$e(o,s){s||(s=o.reduce((tt,rt)=>tt+rt.length,0));const a=allocUnsafe$t(s);let et=0;for(const tt of o)a.set(tt,et),et+=tt.length;return asUint8Array$c(a)}const concat$f=Object.freeze(Object.defineProperty({__proto__:null,concat:concat$e},Symbol.toStringTag,{value:"Module"}));function base$4(o,s){if(o.length>=255)throw new TypeError("Alphabet too long");for(var a=new Uint8Array(256),et=0;et<a.length;et++)a[et]=255;for(var tt=0;tt<o.length;tt++){var rt=o.charAt(tt),nt=rt.charCodeAt(0);if(a[nt]!==255)throw new TypeError(rt+" is ambiguous");a[nt]=tt}var it=o.length,st=o.charAt(0),ot=Math.log(it)/Math.log(256),at=Math.log(256)/Math.log(it);function lt(ft){if(ft instanceof Uint8Array||(ArrayBuffer.isView(ft)?ft=new Uint8Array(ft.buffer,ft.byteOffset,ft.byteLength):Array.isArray(ft)&&(ft=Uint8Array.from(ft))),!(ft instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(ft.length===0)return"";for(var dt=0,pt=0,gt=0,mt=ft.length;gt!==mt&&ft[gt]===0;)gt++,dt++;for(var yt=(mt-gt)*at+1>>>0,vt=new Uint8Array(yt);gt!==mt;){for(var Et=ft[gt],xt=0,wt=yt-1;(Et!==0||xt<pt)&&wt!==-1;wt--,xt++)Et+=256*vt[wt]>>>0,vt[wt]=Et%it>>>0,Et=Et/it>>>0;if(Et!==0)throw new Error("Non-zero carry");pt=xt,gt++}for(var Rt=yt-pt;Rt!==yt&&vt[Rt]===0;)Rt++;for(var Ct=st.repeat(dt);Rt<yt;++Rt)Ct+=o.charAt(vt[Rt]);return Ct}function ct(ft){if(typeof ft!="string")throw new TypeError("Expected String");if(ft.length===0)return new Uint8Array;var dt=0;if(ft[dt]!==" "){for(var pt=0,gt=0;ft[dt]===st;)pt++,dt++;for(var mt=(ft.length-dt)*ot+1>>>0,yt=new Uint8Array(mt);ft[dt];){var vt=a[ft.charCodeAt(dt)];if(vt===255)return;for(var Et=0,xt=mt-1;(vt!==0||Et<gt)&&xt!==-1;xt--,Et++)vt+=it*yt[xt]>>>0,yt[xt]=vt%256>>>0,vt=vt/256>>>0;if(vt!==0)throw new Error("Non-zero carry");gt=Et,dt++}if(ft[dt]!==" "){for(var wt=mt-gt;wt!==mt&&yt[wt]===0;)wt++;for(var Rt=new Uint8Array(pt+(mt-wt)),Ct=pt;wt!==mt;)Rt[Ct++]=yt[wt++];return Rt}}}function ht(ft){var dt=ct(ft);if(dt)return dt;throw new Error(`Non-${s} character`)}return{encode:lt,decodeUnsafe:ct,decode:ht}}var src$4=base$4,_brrp__multiformats_scope_baseX$1=src$4;const coerce$1=o=>{if(o instanceof Uint8Array&&o.constructor.name==="Uint8Array")return o;if(o instanceof ArrayBuffer)return new Uint8Array(o);if(ArrayBuffer.isView(o))return new Uint8Array(o.buffer,o.byteOffset,o.byteLength);throw new Error("Unknown type, must be binary type")},fromString$s=o=>new TextEncoder().encode(o),toString$m=o=>new TextDecoder().decode(o);let Encoder$2=class{constructor(s,a,et){this.name=s,this.prefix=a,this.baseEncode=et}encode(s){if(s instanceof Uint8Array)return`${this.prefix}${this.baseEncode(s)}`;throw Error("Unknown type, must be binary type")}},Decoder$3=class{constructor(s,a,et){if(this.name=s,this.prefix=a,a.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=a.codePointAt(0),this.baseDecode=et}decode(s){if(typeof s=="string"){if(s.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(s)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(s.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(s){return or$3(this,s)}},ComposedDecoder$1=class{constructor(s){this.decoders=s}or(s){return or$3(this,s)}decode(s){const a=s[0],et=this.decoders[a];if(et)return et.decode(s);throw RangeError(`Unable to decode multibase string ${JSON.stringify(s)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const or$3=(o,s)=>new ComposedDecoder$1({...o.decoders||{[o.prefix]:o},...s.decoders||{[s.prefix]:s}});let Codec$1=class{constructor(s,a,et,tt){this.name=s,this.prefix=a,this.baseEncode=et,this.baseDecode=tt,this.encoder=new Encoder$2(s,a,et),this.decoder=new Decoder$3(s,a,tt)}encode(s){return this.encoder.encode(s)}decode(s){return this.decoder.decode(s)}};const from$3=({name:o,prefix:s,encode:a,decode:et})=>new Codec$1(o,s,a,et),baseX$2=({prefix:o,name:s,alphabet:a})=>{const{encode:et,decode:tt}=_brrp__multiformats_scope_baseX$1(a,s);return from$3({prefix:o,name:s,encode:et,decode:rt=>coerce$1(tt(rt))})},decode$i=(o,s,a,et)=>{const tt={};for(let at=0;at<s.length;++at)tt[s[at]]=at;let rt=o.length;for(;o[rt-1]==="=";)--rt;const nt=new Uint8Array(rt*a/8|0);let it=0,st=0,ot=0;for(let at=0;at<rt;++at){const lt=tt[o[at]];if(lt===void 0)throw new SyntaxError(`Non-${et} character`);st=st<<a|lt,it+=a,it>=8&&(it-=8,nt[ot++]=255&st>>it)}if(it>=a||255&st<<8-it)throw new SyntaxError("Unexpected end of data");return nt},encode$e=(o,s,a)=>{const et=s[s.length-1]==="=",tt=(1<<a)-1;let rt="",nt=0,it=0;for(let st=0;st<o.length;++st)for(it=it<<8|o[st],nt+=8;nt>a;)nt-=a,rt+=s[tt&it>>nt];if(nt&&(rt+=s[tt&it<<a-nt]),et)for(;rt.length*a&7;)rt+="=";return rt},rfc4648$3=({name:o,prefix:s,bitsPerChar:a,alphabet:et})=>from$3({prefix:s,name:o,encode(tt){return encode$e(tt,et,a)},decode(tt){return decode$i(tt,et,a,o)}}),identity$3=from$3({prefix:"\0",name:"identity",encode:o=>toString$m(o),decode:o=>fromString$s(o)}),identityBase$1=Object.freeze(Object.defineProperty({__proto__:null,identity:identity$3},Symbol.toStringTag,{value:"Module"})),base2$2=rfc4648$3({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),base2$3=Object.freeze(Object.defineProperty({__proto__:null,base2:base2$2},Symbol.toStringTag,{value:"Module"})),base8$2=rfc4648$3({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),base8$3=Object.freeze(Object.defineProperty({__proto__:null,base8:base8$2},Symbol.toStringTag,{value:"Module"})),base10$2=baseX$2({prefix:"9",name:"base10",alphabet:"0123456789"}),base10$3=Object.freeze(Object.defineProperty({__proto__:null,base10:base10$2},Symbol.toStringTag,{value:"Module"})),base16$2=rfc4648$3({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper$1=rfc4648$3({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),base16$3=Object.freeze(Object.defineProperty({__proto__:null,base16:base16$2,base16upper:base16upper$1},Symbol.toStringTag,{value:"Module"})),base32$2=rfc4648$3({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper$1=rfc4648$3({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad$1=rfc4648$3({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper$1=rfc4648$3({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex$1=rfc4648$3({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper$1=rfc4648$3({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad$1=rfc4648$3({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper$1=rfc4648$3({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z$1=rfc4648$3({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base32$3=Object.freeze(Object.defineProperty({__proto__:null,base32:base32$2,base32hex:base32hex$1,base32hexpad:base32hexpad$1,base32hexpadupper:base32hexpadupper$1,base32hexupper:base32hexupper$1,base32pad:base32pad$1,base32padupper:base32padupper$1,base32upper:base32upper$1,base32z:base32z$1},Symbol.toStringTag,{value:"Module"})),base36$2=baseX$2({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper$1=baseX$2({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),base36$3=Object.freeze(Object.defineProperty({__proto__:null,base36:base36$2,base36upper:base36upper$1},Symbol.toStringTag,{value:"Module"})),base58btc$1=baseX$2({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr$1=baseX$2({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),base58$1=Object.freeze(Object.defineProperty({__proto__:null,base58btc:base58btc$1,base58flickr:base58flickr$1},Symbol.toStringTag,{value:"Module"})),base64$2=rfc4648$3({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad$1=rfc4648$3({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url$1=rfc4648$3({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad$1=rfc4648$3({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),base64$3=Object.freeze(Object.defineProperty({__proto__:null,base64:base64$2,base64pad:base64pad$1,base64url:base64url$1,base64urlpad:base64urlpad$1},Symbol.toStringTag,{value:"Module"})),alphabet$4=Array.from(""),alphabetBytesToChars$1=alphabet$4.reduce((o,s,a)=>(o[a]=s,o),[]),alphabetCharsToBytes$1=alphabet$4.reduce((o,s,a)=>(o[s.codePointAt(0)]=a,o),[]);function encode$d(o){return o.reduce((s,a)=>(s+=alphabetBytesToChars$1[a],s),"")}function decode$h(o){const s=[];for(const a of o){const et=alphabetCharsToBytes$1[a.codePointAt(0)];if(et===void 0)throw new Error(`Non-base256emoji character: ${a}`);s.push(et)}return new Uint8Array(s)}const base256emoji$2=from$3({prefix:"",name:"base256emoji",encode:encode$d,decode:decode$h}),base256emoji$3=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:base256emoji$2},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const bases$1={...identityBase$1,...base2$3,...base8$3,...base10$3,...base16$3,...base32$3,...base36$3,...base58$1,...base64$3,...base256emoji$3};function createCodec$r(o,s,a,et){return{name:o,prefix:s,encoder:{name:o,prefix:s,encode:a},decoder:{decode:et}}}const string$r=createCodec$r("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),ascii$q=createCodec$r("ascii","a",o=>{let s="a";for(let a=0;a<o.length;a++)s+=String.fromCharCode(o[a]);return s},o=>{o=o.substring(1);const s=allocUnsafe$t(o.length);for(let a=0;a<o.length;a++)s[a]=o.charCodeAt(a);return s}),BASES$q={utf8:string$r,"utf-8":string$r,hex:bases$1.base16,latin1:ascii$q,ascii:ascii$q,binary:ascii$q,...bases$1};function toString$k(o,s="utf8"){const a=BASES$q[s];if(!a)throw new Error(`Unsupported encoding "${s}"`);return(s==="utf8"||s==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(o.buffer,o.byteOffset,o.byteLength).toString("utf8"):a.encoder.encode(o).substring(1)}const toString$l=Object.freeze(Object.defineProperty({__proto__:null,toString:toString$k},Symbol.toStringTag,{value:"Module"})),all$4=async o=>{const s=[];for await(const a of o)s.push(a);return s};var itAll=all$4;const all$5=getDefaultExportFromCjs$2(itAll),Bootstrap$1=async(o,{Helia:s,runtime:a})=>{const{node:et,fs:tt}=await s(a);async function rt(nt){const it=concat$e(await all$5(tt.cat(nt))),st=toString$k(it);return JSON.parse(st)}return o.on("node-start",async(nt,it)=>{log$d.info(`Processing ${it}`);const st=await rt(it);if(!st.manifest)throw new Error("Fetched content with invalid manifest.");log$d.info(`Collecting ${st.count} entries`);for await(const[ot,at]of Object.entries(st.manifest)){const lt=await rt(at.data),ct=Object.assign(at,{meta:lt,type:"watchit/data",count:st.count,progress:(+ot+1)/st.count*100,end:+ot+1===st.count});log$d.info(`Processing ${+ot+1}/${ct.count} ${ct.progress}%`),nt.reply("notification",ct)}}),o.on("online-status-changed",async(nt,it)=>{log$d.info("Going "+(it?"online":"offline"))}),o.on("node-close",async()=>{await orbit.stop()}),o.on("node-flush",async()=>{}),et};class Broker extends EventEmitter$4{constructor(s){super(),this.ipc=s}getIPC(){return this.ipc}stopListeningIPC(){this.ipc.removeAllListeners("notification")}startListeningIPC(){this.ipc.on("notification",(...s)=>{this.emit("notification",...s)})}connect(s){return this.ipc.send("node-start",s),this}}function BrokerFactory(o){return new Broker(o)}class WebIPC extends EventEmitter$4{send(s,...a){this.emit(s,this,...a)}reply(s,...a){this.send(s,...a)}}const webIPC=new WebIPC,connectionSymbol=Symbol.for("@libp2p/connection"),contentRoutingSymbol=Symbol.for("@libp2p/content-routing"),peerDiscoverySymbol=Symbol.for("@libp2p/peer-discovery"),peerIdSymbol=Symbol.for("@libp2p/peer-id");function isPeerId(o){return o!=null&&!!o[peerIdSymbol]}const peerRoutingSymbol=Symbol.for("@libp2p/peer-routing"),KEEP_ALIVE="keep-alive",StrictSign="StrictSign",StrictNoSign="StrictNoSign";var TopicValidatorResult;(function(o){o.Accept="accept",o.Ignore="ignore",o.Reject="reject"})(TopicValidatorResult||(TopicValidatorResult={}));const transportSymbol=Symbol.for("@libp2p/transport");var FaultTolerance;(function(o){o[o.FATAL_ALL=0]="FATAL_ALL",o[o.NO_FATAL=1]="NO_FATAL"})(FaultTolerance||(FaultTolerance={}));let AbortError$5=class Ss extends Error{code;type;constructor(s="The operation was aborted"){super(s),this.name="AbortError",this.code=Ss.code,this.type=Ss.type}static code="ABORT_ERR";static type="aborted"},CodeError$3=class extends Error{code;props;constructor(s,a,et){super(s),this.code=a,this.name=et?.name??"CodeError",this.props=et??{}}};class AggregateCodeError extends AggregateError{code;props;constructor(s,a,et,tt){super(s,a),this.code=et,this.name=tt?.name??"AggregateCodeError",this.props=tt??{}}}const ERR_TIMEOUT="ERR_TIMEOUT",ERR_INVALID_MESSAGE="ERR_INVALID_MESSAGE",setMaxListeners=(o,...s)=>{try{eventsExports.setMaxListeners(o,...s)}catch{}};class TypedEventEmitter extends EventTarget{#e=new Map;constructor(){super(),setMaxListeners(1/0,this)}listenerCount(s){const a=this.#e.get(s);return a==null?0:a.length}addEventListener(s,a,et){super.addEventListener(s,a,et);let tt=this.#e.get(s);tt==null&&(tt=[],this.#e.set(s,tt)),tt.push({callback:a,once:(et!==!0&&et!==!1&&et?.once)??!1})}removeEventListener(s,a,et){super.removeEventListener(s.toString(),a??null,et);let tt=this.#e.get(s);tt!=null&&(tt=tt.filter(({callback:rt})=>rt!==a),this.#e.set(s,tt))}dispatchEvent(s){const a=super.dispatchEvent(s);let et=this.#e.get(s.type);return et==null||(et=et.filter(({once:tt})=>!tt),this.#e.set(s.type,et)),a}safeDispatchEvent(s,a={}){return this.dispatchEvent(new CustomEvent$2(s,a))}}class CustomEventPolyfill extends Event{detail;constructor(s,a){super(s,a),this.detail=a?.detail}}const CustomEvent$2=globalThis.CustomEvent??CustomEventPolyfill;function isStartable(o){return o!=null&&typeof o.start=="function"&&typeof o.stop=="function"}async function start(...o){const s=[];for(const a of o)isStartable(a)&&s.push(a);await Promise.all(s.map(async a=>{a.beforeStart!=null&&await a.beforeStart()})),await Promise.all(s.map(async a=>{await a.start()})),await Promise.all(s.map(async a=>{a.afterStart!=null&&await a.afterStart()}))}async function stop(...o){const s=[];for(const a of o)isStartable(a)&&s.push(a);await Promise.all(s.map(async a=>{a.beforeStop!=null&&await a.beforeStop()})),await Promise.all(s.map(async a=>{await a.stop()})),await Promise.all(s.map(async a=>{a.afterStop!=null&&await a.afterStop()}))}const serviceCapabilities=Symbol.for("@libp2p/service-capabilities"),serviceDependencies=Symbol.for("@libp2p/service-dependencies");function anySignal(o){const s=new globalThis.AbortController;function a(){s.abort();for(const rt of o)rt?.removeEventListener!=null&&rt.removeEventListener("abort",a)}for(const rt of o){if(rt?.aborted===!0){a();break}rt?.addEventListener!=null&&rt.addEventListener("abort",a)}function et(){for(const rt of o)rt?.removeEventListener!=null&&rt.removeEventListener("abort",a)}const tt=s.signal;return tt.clear=et,tt}function pDefer(){const o={};return o.promise=new Promise((s,a)=>{o.resolve=s,o.reject=a}),o}class FixedFIFO{buffer;mask;top;btm;next;constructor(s){if(!(s>0)||s-1&s)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(s),this.mask=s-1,this.top=0,this.btm=0,this.next=null}push(s){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=s,this.top=this.top+1&this.mask,!0)}shift(){const s=this.buffer[this.btm];if(s!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,s}isEmpty(){return this.buffer[this.btm]===void 0}}class FIFO{size;hwm;head;tail;constructor(s={}){this.hwm=s.splitLimit??16,this.head=new FixedFIFO(this.hwm),this.tail=this.head,this.size=0}calculateSize(s){return s?.byteLength!=null?s.byteLength:1}push(s){if(s?.value!=null&&(this.size+=this.calculateSize(s.value)),!this.head.push(s)){const a=this.head;this.head=a.next=new FixedFIFO(2*this.head.buffer.length),this.head.push(s)}}shift(){let s=this.tail.shift();if(s===void 0&&this.tail.next!=null){const a=this.tail.next;this.tail.next=null,this.tail=a,s=this.tail.shift()}return s?.value!=null&&(this.size-=this.calculateSize(s.value)),s}isEmpty(){return this.head.isEmpty()}}let AbortError$4=class extends Error{type;code;constructor(s,a){super(s??"The operation was aborted"),this.type="aborted",this.code=a??"ABORT_ERR"}};function pushable(o={}){return _pushable(a=>{const et=a.shift();if(et==null)return{done:!0};if(et.error!=null)throw et.error;return{done:et.done===!0,value:et.value}},o)}function _pushable(o,s){s=s??{};let a=s.onEnd,et=new FIFO,tt,rt,nt,it=pDefer();const st=async()=>{try{return et.isEmpty()?nt?{done:!0}:await new Promise((pt,gt)=>{rt=mt=>{rt=null,et.push(mt);try{pt(o(et))}catch(yt){gt(yt)}return tt}}):o(et)}finally{et.isEmpty()&&queueMicrotask(()=>{it.resolve(),it=pDefer()})}},ot=pt=>rt!=null?rt(pt):(et.push(pt),tt),at=pt=>(et=new FIFO,rt!=null?rt({error:pt}):(et.push({error:pt}),tt)),lt=pt=>{if(nt)return tt;if(s?.objectMode!==!0&&pt?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return ot({done:!1,value:pt})},ct=pt=>nt?tt:(nt=!0,pt!=null?at(pt):ot({done:!0})),ht=()=>(et=new FIFO,ct(),{done:!0}),ft=pt=>(ct(pt),{done:!0});if(tt={[Symbol.asyncIterator](){return this},next:st,return:ht,throw:ft,push:lt,end:ct,get readableLength(){return et.size},onEmpty:async pt=>{const gt=pt?.signal;if(gt?.throwIfAborted(),et.isEmpty())return;let mt,yt;gt!=null&&(mt=new Promise((vt,Et)=>{yt=()=>{Et(new AbortError$4)},gt.addEventListener("abort",yt)}));try{await Promise.race([it.promise,mt])}finally{yt!=null&&gt!=null&&gt?.removeEventListener("abort",yt)}}},a==null)return tt;const dt=tt;return tt={[Symbol.asyncIterator](){return this},next(){return dt.next()},throw(pt){return dt.throw(pt),a!=null&&(a(pt),a=void 0),{done:!0}},return(){return dt.return(),a!=null&&(a(),a=void 0),{done:!0}},push:lt,end(pt){return dt.end(pt),a!=null&&(a(pt),a=void 0),tt},get readableLength(){return dt.readableLength},onEmpty:pt=>dt.onEmpty(pt)},tt}let AbortError$3=class extends Error{type;code;constructor(s,a){super(s??"The operation was aborted"),this.type="aborted",this.name="AbortError",this.code=a??"ABORT_ERR"}};async function raceEvent(o,s,a,et){const tt=new AbortError$3(et?.errorMessage,et?.errorCode);return a?.aborted===!0?Promise.reject(tt):new Promise((rt,nt)=>{function it(){a?.removeEventListener("abort",at),o.removeEventListener(s,st),et?.errorEvent!=null&&o.removeEventListener(et.errorEvent,ot)}const st=lt=>{try{if(et?.filter?.(lt)===!1)return}catch(ct){it(),nt(ct);return}it(),rt(lt)},ot=lt=>{it(),nt(lt.detail)},at=()=>{it(),nt(tt)};a?.addEventListener("abort",at),o.addEventListener(s,st),et?.errorEvent!=null&&o.addEventListener(et.errorEvent,ot)})}let AbortError$2=class extends Error{type;code;constructor(s,a){super(s??"The operation was aborted"),this.type="aborted",this.name="AbortError",this.code=a??"ABORT_ERR"}};async function raceSignal(o,s,a){if(s==null)return o;if(s.aborted)return Promise.reject(new AbortError$2(a?.errorMessage,a?.errorCode));let et;const tt=new AbortError$2(a?.errorMessage,a?.errorCode);try{return await Promise.race([o,new Promise((rt,nt)=>{et=()=>{nt(tt)},s.addEventListener("abort",et)})])}finally{et!=null&&s.removeEventListener("abort",et)}}class JobRecipient{deferred;signal;constructor(s){this.signal=s,this.deferred=pDefer(),this.onAbort=this.onAbort.bind(this),this.signal?.addEventListener("abort",this.onAbort)}onAbort(){this.deferred.reject(this.signal?.reason??new AbortError$5)}cleanup(){this.signal?.removeEventListener("abort",this.onAbort)}}function randomId(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}class Job{id;fn;options;recipients;status;timeline;controller;constructor(s,a){this.id=randomId(),this.status="queued",this.fn=s,this.options=a,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,setMaxListeners(1/0,this.controller.signal),this.onAbort=this.onAbort.bind(this)}abort(s){this.controller.abort(s)}onAbort(){this.recipients.reduce((a,et)=>a&&et.signal?.aborted===!0,!0)&&(this.controller.abort(new AbortError$5),this.cleanup())}async join(s={}){const a=new JobRecipient(s.signal);return this.recipients.push(a),s.signal?.addEventListener("abort",this.onAbort),a.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();const s=await raceSignal(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(a=>{a.deferred.resolve(s)}),this.status="complete"}catch(s){this.recipients.forEach(a=>{a.deferred.reject(s)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(s=>{s.cleanup(),s.signal?.removeEventListener("abort",this.onAbort)})}}class Queue extends TypedEventEmitter{concurrency;queue;pending;sort;constructor(s={}){super(),this.concurrency=s.concurrency??Number.POSITIVE_INFINITY,this.pending=0,s.metricName!=null&&s.metrics?.registerMetricGroup(s.metricName,{calculate:()=>({size:this.queue.length,running:this.pending,queued:this.queue.length-this.pending})}),this.sort=s.sort,this.queue=[]}tryToStartAnother(){if(this.size===0)return queueMicrotask(()=>{this.safeDispatchEvent("empty")}),this.running===0&&queueMicrotask(()=>{this.safeDispatchEvent("idle")}),!1;if(this.pending<this.concurrency){let s;for(const a of this.queue)if(a.status==="queued"){s=a;break}return s==null?!1:(this.safeDispatchEvent("active"),this.pending++,s.run().finally(()=>{for(let a=0;a<this.queue.length;a++)if(this.queue[a]===s){this.queue.splice(a,1);break}this.pending--,this.tryToStartAnother(),this.safeDispatchEvent("next")}),!0)}return!1}enqueue(s){this.queue.push(s),this.sort!=null&&this.queue.sort(this.sort)}async add(s,a){a?.signal?.throwIfAborted();const et=new Job(s,a);return this.enqueue(et),this.safeDispatchEvent("add"),this.tryToStartAnother(),et.join(a).then(tt=>(this.safeDispatchEvent("completed",{detail:tt}),this.safeDispatchEvent("success",{detail:{job:et,result:tt}}),tt)).catch(tt=>{if(et.status==="queued"){for(let rt=0;rt<this.queue.length;rt++)if(this.queue[rt]===et){this.queue.splice(rt,1);break}}throw this.safeDispatchEvent("error",{detail:tt}),this.safeDispatchEvent("failure",{detail:{job:et,error:tt}}),tt})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(s=>{s.abort(new AbortError$5)}),this.clear()}async onEmpty(s){this.size!==0&&await raceEvent(this,"empty",s?.signal)}async onSizeLessThan(s,a){this.size<s||await raceEvent(this,"next",a?.signal,{filter:()=>this.size<s})}async onIdle(s){this.pending===0&&this.size===0||await raceEvent(this,"idle",s?.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(s){s?.signal?.throwIfAborted();const a=pushable({objectMode:!0}),et=st=>{st!=null?this.abort():this.clear(),a.end(st)},tt=st=>{st.detail!=null&&a.push(st.detail)},rt=st=>{et(st.detail)},nt=()=>{et()},it=()=>{et(new CodeError$3("Queue aborted","ERR_QUEUE_ABORTED"))};this.addEventListener("completed",tt),this.addEventListener("error",rt),this.addEventListener("idle",nt),s?.signal?.addEventListener("abort",it);try{yield*a}finally{this.removeEventListener("completed",tt),this.removeEventListener("error",rt),this.removeEventListener("idle",nt),s?.signal?.removeEventListener("abort",it),et()}}}class PeerQueue extends Queue{has(s){return this.find(s)!=null}find(s){return this.queue.find(a=>s.equals(a.options.peerId))}}function isAsyncIterable$g(o){return o[Symbol.asyncIterator]!=null}function drain(o){if(isAsyncIterable$g(o))return(async()=>{for await(const s of o);})();for(const s of o);}function allocUnsafe$s(o=0){return new Uint8Array(o)}const N1$2=Math.pow(2,7),N2$2=Math.pow(2,14),N3$2=Math.pow(2,21),N4$2=Math.pow(2,28),N5$2=Math.pow(2,35),N6$2=Math.pow(2,42),N7$2=Math.pow(2,49),MSB$4=128,REST$4=127;function encodingLength$1(o){if(o<N1$2)return 1;if(o<N2$2)return 2;if(o<N3$2)return 3;if(o<N4$2)return 4;if(o<N5$2)return 5;if(o<N6$2)return 6;if(o<N7$2)return 7;if(Number.MAX_SAFE_INTEGER!=null&&o>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function encodeUint8Array(o,s,a=0){switch(encodingLength$1(o)){case 8:s[a++]=o&255|MSB$4,o/=128;case 7:s[a++]=o&255|MSB$4,o/=128;case 6:s[a++]=o&255|MSB$4,o/=128;case 5:s[a++]=o&255|MSB$4,o/=128;case 4:s[a++]=o&255|MSB$4,o>>>=7;case 3:s[a++]=o&255|MSB$4,o>>>=7;case 2:s[a++]=o&255|MSB$4,o>>>=7;case 1:{s[a++]=o&255,o>>>=7;break}default:throw new Error("unreachable")}return s}function encodeUint8ArrayList(o,s,a=0){switch(encodingLength$1(o)){case 8:s.set(a++,o&255|MSB$4),o/=128;case 7:s.set(a++,o&255|MSB$4),o/=128;case 6:s.set(a++,o&255|MSB$4),o/=128;case 5:s.set(a++,o&255|MSB$4),o/=128;case 4:s.set(a++,o&255|MSB$4),o>>>=7;case 3:s.set(a++,o&255|MSB$4),o>>>=7;case 2:s.set(a++,o&255|MSB$4),o>>>=7;case 1:{s.set(a++,o&255),o>>>=7;break}default:throw new Error("unreachable")}return s}function decodeUint8Array(o,s){let a=o[s],et=0;if(et+=a&REST$4,a<MSB$4||(a=o[s+1],et+=(a&REST$4)<<7,a<MSB$4)||(a=o[s+2],et+=(a&REST$4)<<14,a<MSB$4)||(a=o[s+3],et+=(a&REST$4)<<21,a<MSB$4)||(a=o[s+4],et+=(a&REST$4)*N4$2,a<MSB$4)||(a=o[s+5],et+=(a&REST$4)*N5$2,a<MSB$4)||(a=o[s+6],et+=(a&REST$4)*N6$2,a<MSB$4)||(a=o[s+7],et+=(a&REST$4)*N7$2,a<MSB$4))return et;throw new RangeError("Could not decode varint")}function decodeUint8ArrayList(o,s){let a=o.get(s),et=0;if(et+=a&REST$4,a<MSB$4||(a=o.get(s+1),et+=(a&REST$4)<<7,a<MSB$4)||(a=o.get(s+2),et+=(a&REST$4)<<14,a<MSB$4)||(a=o.get(s+3),et+=(a&REST$4)<<21,a<MSB$4)||(a=o.get(s+4),et+=(a&REST$4)*N4$2,a<MSB$4)||(a=o.get(s+5),et+=(a&REST$4)*N5$2,a<MSB$4)||(a=o.get(s+6),et+=(a&REST$4)*N6$2,a<MSB$4)||(a=o.get(s+7),et+=(a&REST$4)*N7$2,a<MSB$4))return et;throw new RangeError("Could not decode varint")}function encode$c(o,s,a=0){return s==null&&(s=allocUnsafe$s(encodingLength$1(o))),s instanceof Uint8Array?encodeUint8Array(o,s,a):encodeUint8ArrayList(o,s,a)}function decode$g(o,s=0){return o instanceof Uint8Array?decodeUint8Array(o,s):decodeUint8ArrayList(o,s)}function alloc$b(o=0){return new Uint8Array(o)}function allocUnsafe$r(o=0){return new Uint8Array(o)}function asUint8Array$b(o){return o}function concat$d(o,s){s==null&&(s=o.reduce((tt,rt)=>tt+rt.length,0));const a=allocUnsafe$r(s);let et=0;for(const tt of o)a.set(tt,et),et+=tt.length;return a}function equals$i(o,s){if(o===s)return!0;if(o.byteLength!==s.byteLength)return!1;for(let a=0;a<o.byteLength;a++)if(o[a]!==s[a])return!1;return!0}const symbol$1=Symbol.for("@achingbrain/uint8arraylist");function findBufAndOffset(o,s){if(s==null||s<0)throw new RangeError("index is out of bounds");let a=0;for(const et of o){const tt=a+et.byteLength;if(s<tt)return{buf:et,index:s-a};a=tt}throw new RangeError("index is out of bounds")}function isUint8ArrayList(o){return!!o?.[symbol$1]}class Uint8ArrayList{bufs;length;[symbol$1]=!0;constructor(...s){this.bufs=[],this.length=0,s.length>0&&this.appendAll(s)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...s){this.appendAll(s)}appendAll(s){let a=0;for(const et of s)if(et instanceof Uint8Array)a+=et.byteLength,this.bufs.push(et);else if(isUint8ArrayList(et))a+=et.byteLength,this.bufs.push(...et.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=a}prepend(...s){this.prependAll(s)}prependAll(s){let a=0;for(const et of s.reverse())if(et instanceof Uint8Array)a+=et.byteLength,this.bufs.unshift(et);else if(isUint8ArrayList(et))a+=et.byteLength,this.bufs.unshift(...et.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=a}get(s){const a=findBufAndOffset(this.bufs,s);return a.buf[a.index]}set(s,a){const et=findBufAndOffset(this.bufs,s);et.buf[et.index]=a}write(s,a=0){if(s instanceof Uint8Array)for(let et=0;et<s.length;et++)this.set(a+et,s[et]);else if(isUint8ArrayList(s))for(let et=0;et<s.length;et++)this.set(a+et,s.get(et));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(s){if(s=Math.trunc(s),!(Number.isNaN(s)||s<=0)){if(s===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(s>=this.bufs[0].byteLength)s-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(s),this.length-=s;break}}}slice(s,a){const{bufs:et,length:tt}=this._subList(s,a);return concat$d(et,tt)}subarray(s,a){const{bufs:et,length:tt}=this._subList(s,a);return et.length===1?et[0]:concat$d(et,tt)}sublist(s,a){const{bufs:et,length:tt}=this._subList(s,a),rt=new Uint8ArrayList;return rt.length=tt,rt.bufs=[...et],rt}_subList(s,a){if(s=s??0,a=a??this.length,s<0&&(s=this.length+s),a<0&&(a=this.length+a),s<0||a>this.length)throw new RangeError("index is out of bounds");if(s===a)return{bufs:[],length:0};if(s===0&&a===this.length)return{bufs:this.bufs,length:this.length};const et=[];let tt=0;for(let rt=0;rt<this.bufs.length;rt++){const nt=this.bufs[rt],it=tt,st=it+nt.byteLength;if(tt=st,s>=st)continue;const ot=s>=it&&s<st,at=a>it&&a<=st;if(ot&&at){if(s===it&&a===st){et.push(nt);break}const lt=s-it;et.push(nt.subarray(lt,lt+(a-s)));break}if(ot){if(s===0){et.push(nt);continue}et.push(nt.subarray(s-it));continue}if(at){if(a===st){et.push(nt);break}et.push(nt.subarray(0,a-it));break}et.push(nt)}return{bufs:et,length:a-s}}indexOf(s,a=0){if(!isUint8ArrayList(s)&&!(s instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');const et=s instanceof Uint8Array?s:s.subarray();if(a=Number(a??0),isNaN(a)&&(a=0),a<0&&(a=this.length+a),a<0&&(a=0),s.length===0)return a>this.length?this.length:a;const tt=et.byteLength;if(tt===0)throw new TypeError("search must be at least 1 byte long");const rt=256,nt=new Int32Array(rt);for(let lt=0;lt<rt;lt++)nt[lt]=-1;for(let lt=0;lt<tt;lt++)nt[et[lt]]=lt;const it=nt,st=this.byteLength-et.byteLength,ot=et.byteLength-1;let at;for(let lt=a;lt<=st;lt+=at){at=0;for(let ct=ot;ct>=0;ct--){const ht=this.get(lt+ct);if(et[ct]!==ht){at=Math.max(1,ct-it[ht]);break}}if(at===0)return lt}return-1}getInt8(s){const a=this.subarray(s,s+1);return new DataView(a.buffer,a.byteOffset,a.byteLength).getInt8(0)}setInt8(s,a){const et=allocUnsafe$r(1);new DataView(et.buffer,et.byteOffset,et.byteLength).setInt8(0,a),this.write(et,s)}getInt16(s,a){const et=this.subarray(s,s+2);return new DataView(et.buffer,et.byteOffset,et.byteLength).getInt16(0,a)}setInt16(s,a,et){const tt=alloc$b(2);new DataView(tt.buffer,tt.byteOffset,tt.byteLength).setInt16(0,a,et),this.write(tt,s)}getInt32(s,a){const et=this.subarray(s,s+4);return new DataView(et.buffer,et.byteOffset,et.byteLength).getInt32(0,a)}setInt32(s,a,et){const tt=alloc$b(4);new DataView(tt.buffer,tt.byteOffset,tt.byteLength).setInt32(0,a,et),this.write(tt,s)}getBigInt64(s,a){const et=this.subarray(s,s+8);return new DataView(et.buffer,et.byteOffset,et.byteLength).getBigInt64(0,a)}setBigInt64(s,a,et){const tt=alloc$b(8);new DataView(tt.buffer,tt.byteOffset,tt.byteLength).setBigInt64(0,a,et),this.write(tt,s)}getUint8(s){const a=this.subarray(s,s+1);return new DataView(a.buffer,a.byteOffset,a.byteLength).getUint8(0)}setUint8(s,a){const et=allocUnsafe$r(1);new DataView(et.buffer,et.byteOffset,et.byteLength).setUint8(0,a),this.write(et,s)}getUint16(s,a){const et=this.subarray(s,s+2);return new DataView(et.buffer,et.byteOffset,et.byteLength).getUint16(0,a)}setUint16(s,a,et){const tt=alloc$b(2);new DataView(tt.buffer,tt.byteOffset,tt.byteLength).setUint16(0,a,et),this.write(tt,s)}getUint32(s,a){const et=this.subarray(s,s+4);return new DataView(et.buffer,et.byteOffset,et.byteLength).getUint32(0,a)}setUint32(s,a,et){const tt=alloc$b(4);new DataView(tt.buffer,tt.byteOffset,tt.byteLength).setUint32(0,a,et),this.write(tt,s)}getBigUint64(s,a){const et=this.subarray(s,s+8);return new DataView(et.buffer,et.byteOffset,et.byteLength).getBigUint64(0,a)}setBigUint64(s,a,et){const tt=alloc$b(8);new DataView(tt.buffer,tt.byteOffset,tt.byteLength).setBigUint64(0,a,et),this.write(tt,s)}getFloat32(s,a){const et=this.subarray(s,s+4);return new DataView(et.buffer,et.byteOffset,et.byteLength).getFloat32(0,a)}setFloat32(s,a,et){const tt=alloc$b(4);new DataView(tt.buffer,tt.byteOffset,tt.byteLength).setFloat32(0,a,et),this.write(tt,s)}getFloat64(s,a){const et=this.subarray(s,s+8);return new DataView(et.buffer,et.byteOffset,et.byteLength).getFloat64(0,a)}setFloat64(s,a,et){const tt=alloc$b(8);new DataView(tt.buffer,tt.byteOffset,tt.byteLength).setFloat64(0,a,et),this.write(tt,s)}equals(s){if(s==null||!(s instanceof Uint8ArrayList)||s.bufs.length!==this.bufs.length)return!1;for(let a=0;a<this.bufs.length;a++)if(!equals$i(this.bufs[a],s.bufs[a]))return!1;return!0}static fromUint8Arrays(s,a){const et=new Uint8ArrayList;return et.bufs=s,a==null&&(a=s.reduce((tt,rt)=>tt+rt.byteLength,0)),et.length=a,et}}function allocUnsafe$q(o=0){return new Uint8Array(o)}function isAsyncIterable$f(o){return o[Symbol.asyncIterator]!=null}const defaultEncoder=o=>{const s=encodingLength$1(o),a=allocUnsafe$q(s);return encode$c(o,a),defaultEncoder.bytes=s,a};defaultEncoder.bytes=0;function encode$b(o,s){s=s??{};const a=s.lengthEncoder??defaultEncoder;function*et(tt){const rt=a(tt.byteLength);rt instanceof Uint8Array?yield rt:yield*rt,tt instanceof Uint8Array?yield tt:yield*tt}return isAsyncIterable$f(o)?async function*(){for await(const tt of o)yield*et(tt)}():function*(){for(const tt of o)yield*et(tt)}()}encode$b.single=(o,s)=>{s=s??{};const a=s.lengthEncoder??defaultEncoder;return new Uint8ArrayList(a(o.byteLength),o)};function assign$1(o,s){for(const a in s)Object.defineProperty(o,a,{value:s[a],enumerable:!0,configurable:!0});return o}function createError(o,s,a){if(!o||typeof o=="string")throw new TypeError("Please pass an Error to err-code");a||(a={}),typeof s=="object"&&(a=s,s=""),s&&(a.code=s);try{return assign$1(o,a)}catch{a.message=o.message,a.stack=o.stack;const tt=function(){};return tt.prototype=Object.create(Object.getPrototypeOf(o)),assign$1(new tt,a)}}var errCode=createError;const errCode$1=getDefaultExportFromCjs$2(errCode),MAX_LENGTH_LENGTH=8,MAX_DATA_LENGTH=1024*1024*4;var ReadMode;(function(o){o[o.LENGTH=0]="LENGTH",o[o.DATA=1]="DATA"})(ReadMode||(ReadMode={}));const defaultDecoder=o=>{const s=decode$g(o);return defaultDecoder.bytes=encodingLength$1(s),s};defaultDecoder.bytes=0;function decode$f(o,s){const a=new Uint8ArrayList;let et=ReadMode.LENGTH,tt=-1;const rt=s?.lengthDecoder??defaultDecoder,nt=s?.maxLengthLength??MAX_LENGTH_LENGTH,it=s?.maxDataLength??MAX_DATA_LENGTH;function*st(){for(;a.byteLength>0;){if(et===ReadMode.LENGTH)try{if(tt=rt(a),tt<0)throw errCode$1(new Error("invalid message length"),"ERR_INVALID_MSG_LENGTH");if(tt>it)throw errCode$1(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");const ot=rt.bytes;a.consume(ot),s?.onLength!=null&&s.onLength(tt),et=ReadMode.DATA}catch(ot){if(ot instanceof RangeError){if(a.byteLength>nt)throw errCode$1(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG");break}throw ot}if(et===ReadMode.DATA){if(a.byteLength<tt)break;const ot=a.sublist(0,tt);a.consume(tt),s?.onData!=null&&s.onData(ot),yield ot,et=ReadMode.LENGTH}}}return isAsyncIterable$f(o)?async function*(){for await(const ot of o)a.append(ot),yield*st();if(a.byteLength>0)throw errCode$1(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}():function*(){for(const ot of o)a.append(ot),yield*st();if(a.byteLength>0)throw errCode$1(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}()}decode$f.fromReader=(o,s)=>{let a=1;const et=async function*(){for(;;)try{const{done:rt,value:nt}=await o.next(a);if(rt===!0)return;nt!=null&&(yield nt)}catch(rt){if(rt.code==="ERR_UNDER_READ")return{done:!0,value:null};throw rt}finally{a=1}}();return decode$f(et,{...s??{},onLength:rt=>{a=rt}})};function peekable(o){const[s,a]=o[Symbol.asyncIterator]!=null?[o[Symbol.asyncIterator](),Symbol.asyncIterator]:[o[Symbol.iterator](),Symbol.iterator],et=[];return{peek:()=>s.next(),push:tt=>{et.push(tt)},next:()=>et.length>0?{done:!1,value:et.shift()}:s.next(),[a](){return this}}}function isAsyncIterable$e(o){return o[Symbol.asyncIterator]!=null}function map$1(o,s){let a=0;if(isAsyncIterable$e(o))return async function*(){for await(const st of o)yield s(st,a++)}();const et=peekable(o),{value:tt,done:rt}=et.next();if(rt===!0)return function*(){}();const nt=s(tt,a++);if(typeof nt.then=="function")return async function*(){yield await nt;for await(const st of et)yield s(st,a++)}();const it=s;return function*(){yield nt;for(const st of et)yield it(st,a++)}()}function isAsyncIterable$d(o){return o[Symbol.asyncIterator]!=null}function merge$2(...o){const s=[];for(const a of o)isAsyncIterable$d(a)||s.push(a);return s.length===o.length?function*(){for(const a of s)yield*a}():async function*(){const a=pushable({objectMode:!0});Promise.resolve().then(async()=>{try{await Promise.all(o.map(async et=>{for await(const tt of et)a.push(tt)})),a.end()}catch(et){a.end(et)}}),yield*a}()}function pipe(o,...s){if(o==null)throw new Error("Empty pipeline");if(isDuplex(o)){const et=o;o=()=>et.source}else if(isIterable$1(o)||isAsyncIterable$c(o)){const et=o;o=()=>et}const a=[o,...s];if(a.length>1&&isDuplex(a[a.length-1])&&(a[a.length-1]=a[a.length-1].sink),a.length>2)for(let et=1;et<a.length-1;et++)isDuplex(a[et])&&(a[et]=duplexPipelineFn(a[et]));return rawPipe(...a)}const rawPipe=(...o)=>{let s;for(;o.length>0;)s=o.shift()(s);return s},isAsyncIterable$c=o=>o?.[Symbol.asyncIterator]!=null,isIterable$1=o=>o?.[Symbol.iterator]!=null,isDuplex=o=>o==null?!1:o.sink!=null&&o.source!=null,duplexPipelineFn=o=>s=>{const a=o.sink(s);if(a?.then!=null){const et=pushable({objectMode:!0});a.then(()=>{et.end()},nt=>{et.end(nt)});let tt;const rt=o.source;if(isAsyncIterable$c(rt))tt=async function*(){yield*rt,et.end()};else if(isIterable$1(rt))tt=function*(){yield*rt,et.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return merge$2(et,tt())}return o.source};function isAsyncIterable$b(o){return o[Symbol.asyncIterator]!=null}function take(o,s){return isAsyncIterable$b(o)?async function*(){let a=0;if(!(s<1)){for await(const et of o)if(yield et,a++,a===s)return}}():function*(){let a=0;if(!(s<1)){for(const et of o)if(yield et,a++,a===s)return}}()}class CustomProgressEvent extends Event{constructor(s,a){super(s),this.detail=a}}const BITSWAP_120="/ipfs/bitswap/1.2.0",DEFAULT_MAX_SIZE_REPLACE_HAS_WITH_BLOCK=1024,DEFAULT_MAX_INBOUND_STREAMS$2=1024,DEFAULT_MAX_OUTBOUND_STREAMS$2=1024,DEFAULT_MESSAGE_RECEIVE_TIMEOUT=5e3,DEFAULT_MESSAGE_SEND_DELAY=10,DEFAULT_MESSAGE_SEND_CONCURRENCY=50,DEFAULT_RUN_ON_TRANSIENT_CONNECTIONS=!1,DEFAULT_MAX_PROVIDERS_PER_REQUEST=3,DEFAULT_MAX_OUTGOING_MESSAGE_SIZE=1024*1024*4,DEFAULT_MAX_INCOMING_MESSAGE_SIZE=DEFAULT_MAX_OUTGOING_MESSAGE_SIZE,f32=new Float32Array([-0]),f8b=new Uint8Array(f32.buffer);function writeFloatLE(o,s,a){f32[0]=o,s[a]=f8b[0],s[a+1]=f8b[1],s[a+2]=f8b[2],s[a+3]=f8b[3]}function readFloatLE(o,s){return f8b[0]=o[s],f8b[1]=o[s+1],f8b[2]=o[s+2],f8b[3]=o[s+3],f32[0]}const f64=new Float64Array([-0]),d8b=new Uint8Array(f64.buffer);function writeDoubleLE(o,s,a){f64[0]=o,s[a]=d8b[0],s[a+1]=d8b[1],s[a+2]=d8b[2],s[a+3]=d8b[3],s[a+4]=d8b[4],s[a+5]=d8b[5],s[a+6]=d8b[6],s[a+7]=d8b[7]}function readDoubleLE(o,s){return d8b[0]=o[s],d8b[1]=o[s+1],d8b[2]=o[s+2],d8b[3]=o[s+3],d8b[4]=o[s+4],d8b[5]=o[s+5],d8b[6]=o[s+6],d8b[7]=o[s+7],f64[0]}const MAX_SAFE_NUMBER_INTEGER=BigInt(Number.MAX_SAFE_INTEGER),MIN_SAFE_NUMBER_INTEGER=BigInt(Number.MIN_SAFE_INTEGER);class LongBits{lo;hi;constructor(s,a){this.lo=s|0,this.hi=a|0}toNumber(s=!1){if(!s&&this.hi>>>31>0){const a=~this.lo+1>>>0;let et=~this.hi>>>0;return a===0&&(et=et+1>>>0),-(a+et*4294967296)}return this.lo+this.hi*4294967296}toBigInt(s=!1){if(s)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){const a=~this.lo+1>>>0;let et=~this.hi>>>0;return a===0&&(et=et+1>>>0),-(BigInt(a)+(BigInt(et)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(s=!1){return this.toBigInt(s).toString()}zzEncode(){const s=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^s)>>>0,this.lo=(this.lo<<1^s)>>>0,this}zzDecode(){const s=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^s)>>>0,this.hi=(this.hi>>>1^s)>>>0,this}length(){const s=this.lo,a=(this.lo>>>28|this.hi<<4)>>>0,et=this.hi>>>24;return et===0?a===0?s<16384?s<128?1:2:s<2097152?3:4:a<16384?a<128?5:6:a<2097152?7:8:et<128?9:10}static fromBigInt(s){if(s===0n)return zero;if(s<MAX_SAFE_NUMBER_INTEGER&&s>MIN_SAFE_NUMBER_INTEGER)return this.fromNumber(Number(s));const a=s<0n;a&&(s=-s);let et=s>>32n,tt=s-(et<<32n);return a&&(et=~et|0n,tt=~tt|0n,++tt>TWO_32&&(tt=0n,++et>TWO_32&&(et=0n))),new LongBits(Number(tt),Number(et))}static fromNumber(s){if(s===0)return zero;const a=s<0;a&&(s=-s);let et=s>>>0,tt=(s-et)/4294967296>>>0;return a&&(tt=~tt>>>0,et=~et>>>0,++et>4294967295&&(et=0,++tt>4294967295&&(tt=0))),new LongBits(et,tt)}static from(s){return typeof s=="number"?LongBits.fromNumber(s):typeof s=="bigint"?LongBits.fromBigInt(s):typeof s=="string"?LongBits.fromBigInt(BigInt(s)):s.low!=null||s.high!=null?new LongBits(s.low>>>0,s.high>>>0):zero}}const zero=new LongBits(0,0);zero.toBigInt=function(){return 0n};zero.zzEncode=zero.zzDecode=function(){return this};zero.length=function(){return 1};const TWO_32=4294967296n;function length$4(o){let s=0,a=0;for(let et=0;et<o.length;++et)a=o.charCodeAt(et),a<128?s+=1:a<2048?s+=2:(a&64512)===55296&&(o.charCodeAt(et+1)&64512)===56320?(++et,s+=4):s+=3;return s}function read$3(o,s,a){if(a-s<1)return"";let tt;const rt=[];let nt=0,it;for(;s<a;)it=o[s++],it<128?rt[nt++]=it:it>191&&it<224?rt[nt++]=(it&31)<<6|o[s++]&63:it>239&&it<365?(it=((it&7)<<18|(o[s++]&63)<<12|(o[s++]&63)<<6|o[s++]&63)-65536,rt[nt++]=55296+(it>>10),rt[nt++]=56320+(it&1023)):rt[nt++]=(it&15)<<12|(o[s++]&63)<<6|o[s++]&63,nt>8191&&((tt??(tt=[])).push(String.fromCharCode.apply(String,rt)),nt=0);return tt!=null?(nt>0&&tt.push(String.fromCharCode.apply(String,rt.slice(0,nt))),tt.join("")):String.fromCharCode.apply(String,rt.slice(0,nt))}function write$1(o,s,a){const et=a;let tt,rt;for(let nt=0;nt<o.length;++nt)tt=o.charCodeAt(nt),tt<128?s[a++]=tt:tt<2048?(s[a++]=tt>>6|192,s[a++]=tt&63|128):(tt&64512)===55296&&((rt=o.charCodeAt(nt+1))&64512)===56320?(tt=65536+((tt&1023)<<10)+(rt&1023),++nt,s[a++]=tt>>18|240,s[a++]=tt>>12&63|128,s[a++]=tt>>6&63|128,s[a++]=tt&63|128):(s[a++]=tt>>12|224,s[a++]=tt>>6&63|128,s[a++]=tt&63|128);return a-et}function indexOutOfRange(o,s){return RangeError(`index out of range: ${o.pos} + ${s??1} > ${o.len}`)}function readFixed32End(o,s){return(o[s-4]|o[s-3]<<8|o[s-2]<<16|o[s-1]<<24)>>>0}class Uint8ArrayReader{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(s){this.buf=s,this.pos=0,this.len=s.length}uint32(){let s=4294967295;if(s=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(s=(s|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(s=(s|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(s=(s|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(s=(s|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return s;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return s}int32(){return this.uint32()|0}sint32(){const s=this.uint32();return s>>>1^-(s&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32End(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32End(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);const s=readFloatLE(this.buf,this.pos);return this.pos+=4,s}double(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);const s=readDoubleLE(this.buf,this.pos);return this.pos+=8,s}bytes(){const s=this.uint32(),a=this.pos,et=this.pos+s;if(et>this.len)throw indexOutOfRange(this,s);return this.pos+=s,a===et?new Uint8Array(0):this.buf.subarray(a,et)}string(){const s=this.bytes();return read$3(s,0,s.length)}skip(s){if(typeof s=="number"){if(this.pos+s>this.len)throw indexOutOfRange(this,s);this.pos+=s}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(this.buf[this.pos++]&128);return this}skipType(s){switch(s){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(s=this.uint32()&7)!==4;)this.skipType(s);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${s} at offset ${this.pos}`)}return this}readLongVarint(){const s=new LongBits(0,0);let a=0;if(this.len-this.pos>4){for(;a<4;++a)if(s.lo=(s.lo|(this.buf[this.pos]&127)<<a*7)>>>0,this.buf[this.pos++]<128)return s;if(s.lo=(s.lo|(this.buf[this.pos]&127)<<28)>>>0,s.hi=(s.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return s;a=0}else{for(;a<3;++a){if(this.pos>=this.len)throw indexOutOfRange(this);if(s.lo=(s.lo|(this.buf[this.pos]&127)<<a*7)>>>0,this.buf[this.pos++]<128)return s}return s.lo=(s.lo|(this.buf[this.pos++]&127)<<a*7)>>>0,s}if(this.len-this.pos>4){for(;a<5;++a)if(s.hi=(s.hi|(this.buf[this.pos]&127)<<a*7+3)>>>0,this.buf[this.pos++]<128)return s}else for(;a<5;++a){if(this.pos>=this.len)throw indexOutOfRange(this);if(s.hi=(s.hi|(this.buf[this.pos]&127)<<a*7+3)>>>0,this.buf[this.pos++]<128)return s}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);const s=readFixed32End(this.buf,this.pos+=4),a=readFixed32End(this.buf,this.pos+=4);return new LongBits(s,a)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){const s=decodeUint8Array(this.buf,this.pos);return this.pos+=encodingLength$1(s),s}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}}function createReader(o){return new Uint8ArrayReader(o instanceof Uint8Array?o:o.subarray())}function decodeMessage(o,s,a){const et=createReader(o);return s.decode(et,void 0,a)}function allocUnsafe$p(o=0){return new Uint8Array(o)}const empty=new Uint8Array(0);function fromHex(o){const s=o.match(/../g);return s!=null?new Uint8Array(s.map(a=>parseInt(a,16))):empty}function equals$h(o,s){if(o===s)return!0;if(o.byteLength!==s.byteLength)return!1;for(let a=0;a<o.byteLength;a++)if(o[a]!==s[a])return!1;return!0}function coerce(o){if(o instanceof Uint8Array&&o.constructor.name==="Uint8Array")return o;if(o instanceof ArrayBuffer)return new Uint8Array(o);if(ArrayBuffer.isView(o))return new Uint8Array(o.buffer,o.byteOffset,o.byteLength);throw new Error("Unknown type, must be binary type")}function fromString$r(o){return new TextEncoder().encode(o)}function toString$j(o){return new TextDecoder().decode(o)}function base$3(o,s){if(o.length>=255)throw new TypeError("Alphabet too long");for(var a=new Uint8Array(256),et=0;et<a.length;et++)a[et]=255;for(var tt=0;tt<o.length;tt++){var rt=o.charAt(tt),nt=rt.charCodeAt(0);if(a[nt]!==255)throw new TypeError(rt+" is ambiguous");a[nt]=tt}var it=o.length,st=o.charAt(0),ot=Math.log(it)/Math.log(256),at=Math.log(256)/Math.log(it);function lt(ft){if(ft instanceof Uint8Array||(ArrayBuffer.isView(ft)?ft=new Uint8Array(ft.buffer,ft.byteOffset,ft.byteLength):Array.isArray(ft)&&(ft=Uint8Array.from(ft))),!(ft instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(ft.length===0)return"";for(var dt=0,pt=0,gt=0,mt=ft.length;gt!==mt&&ft[gt]===0;)gt++,dt++;for(var yt=(mt-gt)*at+1>>>0,vt=new Uint8Array(yt);gt!==mt;){for(var Et=ft[gt],xt=0,wt=yt-1;(Et!==0||xt<pt)&&wt!==-1;wt--,xt++)Et+=256*vt[wt]>>>0,vt[wt]=Et%it>>>0,Et=Et/it>>>0;if(Et!==0)throw new Error("Non-zero carry");pt=xt,gt++}for(var Rt=yt-pt;Rt!==yt&&vt[Rt]===0;)Rt++;for(var Ct=st.repeat(dt);Rt<yt;++Rt)Ct+=o.charAt(vt[Rt]);return Ct}function ct(ft){if(typeof ft!="string")throw new TypeError("Expected String");if(ft.length===0)return new Uint8Array;var dt=0;if(ft[dt]!==" "){for(var pt=0,gt=0;ft[dt]===st;)pt++,dt++;for(var mt=(ft.length-dt)*ot+1>>>0,yt=new Uint8Array(mt);ft[dt];){var vt=a[ft.charCodeAt(dt)];if(vt===255)return;for(var Et=0,xt=mt-1;(vt!==0||Et<gt)&&xt!==-1;xt--,Et++)vt+=it*yt[xt]>>>0,yt[xt]=vt%256>>>0,vt=vt/256>>>0;if(vt!==0)throw new Error("Non-zero carry");gt=Et,dt++}if(ft[dt]!==" "){for(var wt=mt-gt;wt!==mt&&yt[wt]===0;)wt++;for(var Rt=new Uint8Array(pt+(mt-wt)),Ct=pt;wt!==mt;)Rt[Ct++]=yt[wt++];return Rt}}}function ht(ft){var dt=ct(ft);if(dt)return dt;throw new Error(`Non-${s} character`)}return{encode:lt,decodeUnsafe:ct,decode:ht}}var src$3=base$3,_brrp__multiformats_scope_baseX=src$3;let Encoder$1=class{name;prefix;baseEncode;constructor(s,a,et){this.name=s,this.prefix=a,this.baseEncode=et}encode(s){if(s instanceof Uint8Array)return`${this.prefix}${this.baseEncode(s)}`;throw Error("Unknown type, must be binary type")}},Decoder$2=class{name;prefix;baseDecode;prefixCodePoint;constructor(s,a,et){if(this.name=s,this.prefix=a,a.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=a.codePointAt(0),this.baseDecode=et}decode(s){if(typeof s=="string"){if(s.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(s)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(s.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(s){return or$2(this,s)}};class ComposedDecoder{decoders;constructor(s){this.decoders=s}or(s){return or$2(this,s)}decode(s){const a=s[0],et=this.decoders[a];if(et!=null)return et.decode(s);throw RangeError(`Unable to decode multibase string ${JSON.stringify(s)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function or$2(o,s){return new ComposedDecoder({...o.decoders??{[o.prefix]:o},...s.decoders??{[s.prefix]:s}})}class Codec{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(s,a,et,tt){this.name=s,this.prefix=a,this.baseEncode=et,this.baseDecode=tt,this.encoder=new Encoder$1(s,a,et),this.decoder=new Decoder$2(s,a,tt)}encode(s){return this.encoder.encode(s)}decode(s){return this.decoder.decode(s)}}function from$2({name:o,prefix:s,encode:a,decode:et}){return new Codec(o,s,a,et)}function baseX$1({name:o,prefix:s,alphabet:a}){const{encode:et,decode:tt}=_brrp__multiformats_scope_baseX(a,o);return from$2({prefix:s,name:o,encode:et,decode:rt=>coerce(tt(rt))})}function decode$e(o,s,a,et){const tt={};for(let at=0;at<s.length;++at)tt[s[at]]=at;let rt=o.length;for(;o[rt-1]==="=";)--rt;const nt=new Uint8Array(rt*a/8|0);let it=0,st=0,ot=0;for(let at=0;at<rt;++at){const lt=tt[o[at]];if(lt===void 0)throw new SyntaxError(`Non-${et} character`);st=st<<a|lt,it+=a,it>=8&&(it-=8,nt[ot++]=255&st>>it)}if(it>=a||255&st<<8-it)throw new SyntaxError("Unexpected end of data");return nt}function encode$a(o,s,a){const et=s[s.length-1]==="=",tt=(1<<a)-1;let rt="",nt=0,it=0;for(let st=0;st<o.length;++st)for(it=it<<8|o[st],nt+=8;nt>a;)nt-=a,rt+=s[tt&it>>nt];if(nt!==0&&(rt+=s[tt&it<<a-nt]),et)for(;rt.length*a&7;)rt+="=";return rt}function rfc4648$2({name:o,prefix:s,bitsPerChar:a,alphabet:et}){return from$2({prefix:s,name:o,encode(tt){return encode$a(tt,et,a)},decode(tt){return decode$e(tt,et,a,o)}})}const base10=baseX$1({prefix:"9",name:"base10",alphabet:"0123456789"}),base10$1=Object.freeze(Object.defineProperty({__proto__:null,base10},Symbol.toStringTag,{value:"Module"})),base16=rfc4648$2({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper=rfc4648$2({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),base16$1=Object.freeze(Object.defineProperty({__proto__:null,base16,base16upper},Symbol.toStringTag,{value:"Module"})),base2=rfc4648$2({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),base2$1=Object.freeze(Object.defineProperty({__proto__:null,base2},Symbol.toStringTag,{value:"Module"})),alphabet$3=Array.from(""),alphabetBytesToChars=alphabet$3.reduce((o,s,a)=>(o[a]=s,o),[]),alphabetCharsToBytes=alphabet$3.reduce((o,s,a)=>(o[s.codePointAt(0)]=a,o),[]);function encode$9(o){return o.reduce((s,a)=>(s+=alphabetBytesToChars[a],s),"")}function decode$d(o){const s=[];for(const a of o){const et=alphabetCharsToBytes[a.codePointAt(0)];if(et===void 0)throw new Error(`Non-base256emoji character: ${a}`);s.push(et)}return new Uint8Array(s)}const base256emoji=from$2({prefix:"",name:"base256emoji",encode:encode$9,decode:decode$d}),base256emoji$1=Object.freeze(Object.defineProperty({__proto__:null,base256emoji},Symbol.toStringTag,{value:"Module"})),base32=rfc4648$2({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper=rfc4648$2({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad=rfc4648$2({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper=rfc4648$2({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex=rfc4648$2({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper=rfc4648$2({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad=rfc4648$2({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper=rfc4648$2({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z=rfc4648$2({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base32$1=Object.freeze(Object.defineProperty({__proto__:null,base32,base32hex,base32hexpad,base32hexpadupper,base32hexupper,base32pad,base32padupper,base32upper,base32z},Symbol.toStringTag,{value:"Module"})),base36=baseX$1({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper=baseX$1({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),base36$1=Object.freeze(Object.defineProperty({__proto__:null,base36,base36upper},Symbol.toStringTag,{value:"Module"})),base58btc=baseX$1({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr=baseX$1({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),base58=Object.freeze(Object.defineProperty({__proto__:null,base58btc,base58flickr},Symbol.toStringTag,{value:"Module"})),base64=rfc4648$2({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad=rfc4648$2({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url=rfc4648$2({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad=rfc4648$2({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),base64$1=Object.freeze(Object.defineProperty({__proto__:null,base64,base64pad,base64url,base64urlpad},Symbol.toStringTag,{value:"Module"})),base8=rfc4648$2({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),base8$1=Object.freeze(Object.defineProperty({__proto__:null,base8},Symbol.toStringTag,{value:"Module"})),identity$2=from$2({prefix:"\0",name:"identity",encode:o=>toString$j(o),decode:o=>fromString$r(o)}),identityBase=Object.freeze(Object.defineProperty({__proto__:null,identity:identity$2},Symbol.toStringTag,{value:"Module"}));new TextEncoder;const textDecoder$3=new TextDecoder,code$5=512;function decode$c(o){return JSON.parse(textDecoder$3.decode(o))}const name$5="raw",code$4=85;function encode$8(o){return coerce(o)}function decode$b(o){return coerce(o)}const raw=Object.freeze(Object.defineProperty({__proto__:null,code:code$4,decode:decode$b,encode:encode$8,name:name$5},Symbol.toStringTag,{value:"Module"}));var encode_1$1=encode$7,MSB$3=128,REST$3=127,MSBALL$1=~REST$3,INT$1=Math.pow(2,31);function encode$7(o,s,a){s=s||[],a=a||0;for(var et=a;o>=INT$1;)s[a++]=o&255|MSB$3,o/=128;for(;o&MSBALL$1;)s[a++]=o&255|MSB$3,o>>>=7;return s[a]=o|0,encode$7.bytes=a-et+1,s}var decode$a=read$2,MSB$1$1=128,REST$1$1=127;function read$2(o,et){var a=0,et=et||0,tt=0,rt=et,nt,it=o.length;do{if(rt>=it)throw read$2.bytes=0,new RangeError("Could not decode varint");nt=o[rt++],a+=tt<28?(nt&REST$1$1)<<tt:(nt&REST$1$1)*Math.pow(2,tt),tt+=7}while(nt>=MSB$1$1);return read$2.bytes=rt-et,a}var N1$1=Math.pow(2,7),N2$1=Math.pow(2,14),N3$1=Math.pow(2,21),N4$1=Math.pow(2,28),N5$1=Math.pow(2,35),N6$1=Math.pow(2,42),N7$1=Math.pow(2,49),N8$1=Math.pow(2,56),N9$1=Math.pow(2,63),length$3=function(o){return o<N1$1?1:o<N2$1?2:o<N3$1?3:o<N4$1?4:o<N5$1?5:o<N6$1?6:o<N7$1?7:o<N8$1?8:o<N9$1?9:10},varint$2={encode:encode_1$1,decode:decode$a,encodingLength:length$3},_brrp_varint=varint$2;function decode$9(o,s=0){return[_brrp_varint.decode(o,s),_brrp_varint.decode.bytes]}function encodeTo(o,s,a=0){return _brrp_varint.encode(o,s,a),s}function encodingLength(o){return _brrp_varint.encodingLength(o)}function create$1(o,s){const a=s.byteLength,et=encodingLength(o),tt=et+encodingLength(a),rt=new Uint8Array(tt+a);return encodeTo(o,rt,0),encodeTo(a,rt,et),rt.set(s,tt),new Digest(o,a,s,rt)}function decode$8(o){const s=coerce(o),[a,et]=decode$9(s),[tt,rt]=decode$9(s.subarray(et)),nt=s.subarray(et+rt);if(nt.byteLength!==tt)throw new Error("Incorrect length");return new Digest(a,tt,nt,s)}function equals$g(o,s){if(o===s)return!0;{const a=s;return o.code===a.code&&o.size===a.size&&a.bytes instanceof Uint8Array&&equals$h(o.bytes,a.bytes)}}class Digest{code;size;digest;bytes;constructor(s,a,et,tt){this.code=s,this.size=a,this.digest=et,this.bytes=tt}}const code$3=0,name$4="identity",encode$6=coerce;function digest(o){return create$1(code$3,encode$6(o))}const identity$1={code:code$3,name:name$4,encode:encode$6,digest};function from$1({name:o,code:s,encode:a}){return new Hasher(o,s,a)}class Hasher{name;code;encode;constructor(s,a,et){this.name=s,this.code=a,this.encode=et}digest(s){if(s instanceof Uint8Array){const a=this.encode(s);return a instanceof Uint8Array?create$1(this.code,a):a.then(et=>create$1(this.code,et))}else throw Error("Unknown type, must be binary type")}}function sha(o){return async s=>new Uint8Array(await crypto.subtle.digest(o,s))}const sha256$1=from$1({name:"sha2-256",code:18,encode:sha("SHA-256")}),sha512$1=from$1({name:"sha2-512",code:19,encode:sha("SHA-512")});function format$3(o,s){const{bytes:a,version:et}=o;switch(et){case 0:return toStringV0(a,baseCache(o),s??base58btc.encoder);default:return toStringV1(a,baseCache(o),s??base32.encoder)}}const cache$4=new WeakMap;function baseCache(o){const s=cache$4.get(o);if(s==null){const a=new Map;return cache$4.set(o,a),a}return s}class CID{code;version;multihash;bytes;"/";constructor(s,a,et,tt){this.code=a,this.version=s,this.multihash=et,this.bytes=tt,this["/"]=tt}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:s,multihash:a}=this;if(s!==DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(a.code!==SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return CID.createV0(a)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:s,digest:a}=this.multihash,et=create$1(s,a);return CID.createV1(this.code,et)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(s){return CID.equals(this,s)}static equals(s,a){const et=a;return et!=null&&s.code===et.code&&s.version===et.version&&equals$g(s.multihash,et.multihash)}toString(s){return format$3(this,s)}toJSON(){return{"/":format$3(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(s){if(s==null)return null;const a=s;if(a instanceof CID)return a;if(a["/"]!=null&&a["/"]===a.bytes||a.asCID===a){const{version:et,code:tt,multihash:rt,bytes:nt}=a;return new CID(et,tt,rt,nt??encodeCID(et,tt,rt.bytes))}else if(a[cidSymbol]===!0){const{version:et,multihash:tt,code:rt}=a,nt=decode$8(tt);return CID.create(et,rt,nt)}else return null}static create(s,a,et){if(typeof a!="number")throw new Error("String codecs are no longer supported");if(!(et.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(s){case 0:{if(a!==DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${DAG_PB_CODE}) block encoding`);return new CID(s,a,et,et.bytes)}case 1:{const tt=encodeCID(s,a,et.bytes);return new CID(s,a,et,tt)}default:throw new Error("Invalid version")}}static createV0(s){return CID.create(0,DAG_PB_CODE,s)}static createV1(s,a){return CID.create(1,s,a)}static decode(s){const[a,et]=CID.decodeFirst(s);if(et.length!==0)throw new Error("Incorrect length");return a}static decodeFirst(s){const a=CID.inspectBytes(s),et=a.size-a.multihashSize,tt=coerce(s.subarray(et,et+a.multihashSize));if(tt.byteLength!==a.multihashSize)throw new Error("Incorrect length");const rt=tt.subarray(a.multihashSize-a.digestSize),nt=new Digest(a.multihashCode,a.digestSize,rt,tt);return[a.version===0?CID.createV0(nt):CID.createV1(a.codec,nt),s.subarray(a.size)]}static inspectBytes(s){let a=0;const et=()=>{const[lt,ct]=decode$9(s.subarray(a));return a+=ct,lt};let tt=et(),rt=DAG_PB_CODE;if(tt===18?(tt=0,a=0):rt=et(),tt!==0&&tt!==1)throw new RangeError(`Invalid CID version ${tt}`);const nt=a,it=et(),st=et(),ot=a+st,at=ot-nt;return{version:tt,codec:rt,multihashCode:it,digestSize:st,multihashSize:at,size:ot}}static parse(s,a){const[et,tt]=parseCIDtoBytes(s,a),rt=CID.decode(tt);if(rt.version===0&&s[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return baseCache(rt).set(et,s),rt}}function parseCIDtoBytes(o,s){switch(o[0]){case"Q":{const a=s??base58btc;return[base58btc.prefix,a.decode(`${base58btc.prefix}${o}`)]}case base58btc.prefix:{const a=s??base58btc;return[base58btc.prefix,a.decode(o)]}case base32.prefix:{const a=s??base32;return[base32.prefix,a.decode(o)]}default:{if(s==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[o[0],s.decode(o)]}}}function toStringV0(o,s,a){const{prefix:et}=a;if(et!==base58btc.prefix)throw Error(`Cannot string encode V0 in ${a.name} encoding`);const tt=s.get(et);if(tt==null){const rt=a.encode(o).slice(1);return s.set(et,rt),rt}else return tt}function toStringV1(o,s,a){const{prefix:et}=a,tt=s.get(et);if(tt==null){const rt=a.encode(o);return s.set(et,rt),rt}else return tt}const DAG_PB_CODE=112,SHA_256_CODE=18;function encodeCID(o,s,a){const et=encodingLength(o),tt=et+encodingLength(s),rt=new Uint8Array(tt+a.byteLength);return encodeTo(o,rt,0),encodeTo(s,rt,et),rt.set(a,tt),rt}const cidSymbol=Symbol.for("@ipld/js-cid/CID"),bases={...identityBase,...base2$1,...base8$1,...base10$1,...base16$1,...base32$1,...base36$1,...base58,...base64$1,...base256emoji$1};function createCodec$q(o,s,a,et){return{name:o,prefix:s,encoder:{name:o,prefix:s,encode:a},decoder:{decode:et}}}const string$q=createCodec$q("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),ascii$p=createCodec$q("ascii","a",o=>{let s="a";for(let a=0;a<o.length;a++)s+=String.fromCharCode(o[a]);return s},o=>{o=o.substring(1);const s=allocUnsafe$p(o.length);for(let a=0;a<o.length;a++)s[a]=o.charCodeAt(a);return s}),BASES$p={utf8:string$q,"utf-8":string$q,hex:bases.base16,latin1:ascii$p,ascii:ascii$p,binary:ascii$p,...bases};function fromString$q(o,s="utf8"){const a=BASES$p[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.decoder.decode(`${a.prefix}${o}`)}function pool(o){let et,tt=8192;return function(nt){if(nt<1||nt>4096)return allocUnsafe$p(nt);tt+nt>8192&&(et=allocUnsafe$p(8192),tt=0);const it=et.subarray(tt,tt+=nt);return tt&7&&(tt=(tt|7)+1),it}}class Op{fn;len;next;val;constructor(s,a,et){this.fn=s,this.len=a,this.next=void 0,this.val=et}}function noop$4(){}let State$1=class{head;tail;len;next;constructor(s){this.head=s.head,this.tail=s.tail,this.len=s.len,this.next=s.states}};const bufferPool=pool();function alloc$a(o){return globalThis.Buffer!=null?allocUnsafe$p(o):bufferPool(o)}class Uint8ArrayWriter{len;head;tail;states;constructor(){this.len=0,this.head=new Op(noop$4,0,0),this.tail=this.head,this.states=null}_push(s,a,et){return this.tail=this.tail.next=new Op(s,a,et),this.len+=a,this}uint32(s){return this.len+=(this.tail=this.tail.next=new VarintOp((s=s>>>0)<128?1:s<16384?2:s<2097152?3:s<268435456?4:5,s)).len,this}int32(s){return s<0?this._push(writeVarint64,10,LongBits.fromNumber(s)):this.uint32(s)}sint32(s){return this.uint32((s<<1^s>>31)>>>0)}uint64(s){const a=LongBits.fromBigInt(s);return this._push(writeVarint64,a.length(),a)}uint64Number(s){return this._push(encodeUint8Array,encodingLength$1(s),s)}uint64String(s){return this.uint64(BigInt(s))}int64(s){return this.uint64(s)}int64Number(s){return this.uint64Number(s)}int64String(s){return this.uint64String(s)}sint64(s){const a=LongBits.fromBigInt(s).zzEncode();return this._push(writeVarint64,a.length(),a)}sint64Number(s){const a=LongBits.fromNumber(s).zzEncode();return this._push(writeVarint64,a.length(),a)}sint64String(s){return this.sint64(BigInt(s))}bool(s){return this._push(writeByte,1,s?1:0)}fixed32(s){return this._push(writeFixed32,4,s>>>0)}sfixed32(s){return this.fixed32(s)}fixed64(s){const a=LongBits.fromBigInt(s);return this._push(writeFixed32,4,a.lo)._push(writeFixed32,4,a.hi)}fixed64Number(s){const a=LongBits.fromNumber(s);return this._push(writeFixed32,4,a.lo)._push(writeFixed32,4,a.hi)}fixed64String(s){return this.fixed64(BigInt(s))}sfixed64(s){return this.fixed64(s)}sfixed64Number(s){return this.fixed64Number(s)}sfixed64String(s){return this.fixed64String(s)}float(s){return this._push(writeFloatLE,4,s)}double(s){return this._push(writeDoubleLE,8,s)}bytes(s){const a=s.length>>>0;return a===0?this._push(writeByte,1,0):this.uint32(a)._push(writeBytes,a,s)}string(s){const a=length$4(s);return a!==0?this.uint32(a)._push(write$1,a,s):this._push(writeByte,1,0)}fork(){return this.states=new State$1(this),this.head=this.tail=new Op(noop$4,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop$4,0,0),this.len=0),this}ldelim(){const s=this.head,a=this.tail,et=this.len;return this.reset().uint32(et),et!==0&&(this.tail.next=s.next,this.tail=a,this.len+=et),this}finish(){let s=this.head.next;const a=alloc$a(this.len);let et=0;for(;s!=null;)s.fn(s.val,a,et),et+=s.len,s=s.next;return a}}function writeByte(o,s,a){s[a]=o&255}function writeVarint32(o,s,a){for(;o>127;)s[a++]=o&127|128,o>>>=7;s[a]=o}class VarintOp extends Op{next;constructor(s,a){super(writeVarint32,s,a),this.next=void 0}}function writeVarint64(o,s,a){for(;o.hi!==0;)s[a++]=o.lo&127|128,o.lo=(o.lo>>>7|o.hi<<25)>>>0,o.hi>>>=7;for(;o.lo>127;)s[a++]=o.lo&127|128,o.lo=o.lo>>>7;s[a++]=o.lo}function writeFixed32(o,s,a){s[a]=o&255,s[a+1]=o>>>8&255,s[a+2]=o>>>16&255,s[a+3]=o>>>24}function writeBytes(o,s,a){s.set(o,a)}globalThis.Buffer!=null&&(Uint8ArrayWriter.prototype.bytes=function(o){const s=o.length>>>0;return this.uint32(s),s>0&&this._push(writeBytesBuffer,s,o),this},Uint8ArrayWriter.prototype.string=function(o){const s=globalThis.Buffer.byteLength(o);return this.uint32(s),s>0&&this._push(writeStringBuffer,s,o),this});function writeBytesBuffer(o,s,a){s.set(o,a)}function writeStringBuffer(o,s,a){o.length<40?write$1(o,s,a):s.utf8Write!=null?s.utf8Write(o,a):s.set(fromString$q(o),a)}function createWriter(){return new Uint8ArrayWriter}function encodeMessage(o,s){const a=createWriter();return s.encode(o,a,{lengthDelimited:!1}),a.finish()}var CODEC_TYPES;(function(o){o[o.VARINT=0]="VARINT",o[o.BIT64=1]="BIT64",o[o.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",o[o.START_GROUP=3]="START_GROUP",o[o.END_GROUP=4]="END_GROUP",o[o.BIT32=5]="BIT32"})(CODEC_TYPES||(CODEC_TYPES={}));function createCodec$p(o,s,a,et){return{name:o,type:s,encode:a,decode:et}}function enumeration(o){function s(tt){if(o[tt.toString()]==null)throw new Error("Invalid enum value");return o[tt]}const a=function(rt,nt){const it=s(rt);nt.int32(it)},et=function(rt){const nt=rt.int32();return s(nt)};return createCodec$p("enum",CODEC_TYPES.VARINT,a,et)}function message(o,s){return createCodec$p("message",CODEC_TYPES.LENGTH_DELIMITED,o,s)}let CodeError$2=class extends Error{code;constructor(s,a,et){super(s,et),this.code=a}};function alloc$9(o=0){return new Uint8Array(o)}function allocUnsafe$o(o=0){return new Uint8Array(o)}var WantType;(function(o){o.WantBlock="WantBlock",o.WantHave="WantHave"})(WantType||(WantType={}));var __WantTypeValues;(function(o){o[o.WantBlock=0]="WantBlock",o[o.WantHave=1]="WantHave"})(__WantTypeValues||(__WantTypeValues={}));(function(o){o.codec=()=>enumeration(__WantTypeValues)})(WantType||(WantType={}));var WantlistEntry;(function(o){let s;o.codec=()=>(s==null&&(s=message((a,et,tt={})=>{tt.lengthDelimited!==!1&&et.fork(),a.cid!=null&&a.cid.byteLength>0&&(et.uint32(10),et.bytes(a.cid)),a.priority!=null&&a.priority!==0&&(et.uint32(16),et.int32(a.priority)),a.cancel!=null&&(et.uint32(24),et.bool(a.cancel)),a.wantType!=null&&(et.uint32(32),WantType.codec().encode(a.wantType,et)),a.sendDontHave!=null&&(et.uint32(40),et.bool(a.sendDontHave)),tt.lengthDelimited!==!1&&et.ldelim()},(a,et,tt={})=>{const rt={cid:alloc$9(0),priority:0},nt=et==null?a.len:a.pos+et;for(;a.pos<nt;){const it=a.uint32();switch(it>>>3){case 1:{rt.cid=a.bytes();break}case 2:{rt.priority=a.int32();break}case 3:{rt.cancel=a.bool();break}case 4:{rt.wantType=WantType.codec().decode(a);break}case 5:{rt.sendDontHave=a.bool();break}default:{a.skipType(it&7);break}}}return rt})),s),o.encode=a=>encodeMessage(a,o.codec()),o.decode=(a,et)=>decodeMessage(a,o.codec(),et)})(WantlistEntry||(WantlistEntry={}));var Wantlist;(function(o){let s;o.codec=()=>(s==null&&(s=message((a,et,tt={})=>{if(tt.lengthDelimited!==!1&&et.fork(),a.entries!=null)for(const rt of a.entries)et.uint32(10),WantlistEntry.codec().encode(rt,et);a.full!=null&&(et.uint32(16),et.bool(a.full)),tt.lengthDelimited!==!1&&et.ldelim()},(a,et,tt={})=>{const rt={entries:[]},nt=et==null?a.len:a.pos+et;for(;a.pos<nt;){const it=a.uint32();switch(it>>>3){case 1:{if(tt.limits?.entries!=null&&rt.entries.length===tt.limits.entries)throw new CodeError$2('decode error - map field "entries" had too many elements',"ERR_MAX_LENGTH");rt.entries.push(WantlistEntry.codec().decode(a,a.uint32(),{limits:tt.limits?.entries$}));break}case 2:{rt.full=a.bool();break}default:{a.skipType(it&7);break}}}return rt})),s),o.encode=a=>encodeMessage(a,o.codec()),o.decode=(a,et)=>decodeMessage(a,o.codec(),et)})(Wantlist||(Wantlist={}));var Block;(function(o){let s;o.codec=()=>(s==null&&(s=message((a,et,tt={})=>{tt.lengthDelimited!==!1&&et.fork(),a.prefix!=null&&a.prefix.byteLength>0&&(et.uint32(10),et.bytes(a.prefix)),a.data!=null&&a.data.byteLength>0&&(et.uint32(18),et.bytes(a.data)),tt.lengthDelimited!==!1&&et.ldelim()},(a,et,tt={})=>{const rt={prefix:alloc$9(0),data:alloc$9(0)},nt=et==null?a.len:a.pos+et;for(;a.pos<nt;){const it=a.uint32();switch(it>>>3){case 1:{rt.prefix=a.bytes();break}case 2:{rt.data=a.bytes();break}default:{a.skipType(it&7);break}}}return rt})),s),o.encode=a=>encodeMessage(a,o.codec()),o.decode=(a,et)=>decodeMessage(a,o.codec(),et)})(Block||(Block={}));var BlockPresenceType;(function(o){o.HaveBlock="HaveBlock",o.DontHaveBlock="DontHaveBlock"})(BlockPresenceType||(BlockPresenceType={}));var __BlockPresenceTypeValues;(function(o){o[o.HaveBlock=0]="HaveBlock",o[o.DontHaveBlock=1]="DontHaveBlock"})(__BlockPresenceTypeValues||(__BlockPresenceTypeValues={}));(function(o){o.codec=()=>enumeration(__BlockPresenceTypeValues)})(BlockPresenceType||(BlockPresenceType={}));var BlockPresence;(function(o){let s;o.codec=()=>(s==null&&(s=message((a,et,tt={})=>{tt.lengthDelimited!==!1&&et.fork(),a.cid!=null&&a.cid.byteLength>0&&(et.uint32(10),et.bytes(a.cid)),a.type!=null&&__BlockPresenceTypeValues[a.type]!==0&&(et.uint32(16),BlockPresenceType.codec().encode(a.type,et)),tt.lengthDelimited!==!1&&et.ldelim()},(a,et,tt={})=>{const rt={cid:alloc$9(0),type:BlockPresenceType.HaveBlock},nt=et==null?a.len:a.pos+et;for(;a.pos<nt;){const it=a.uint32();switch(it>>>3){case 1:{rt.cid=a.bytes();break}case 2:{rt.type=BlockPresenceType.codec().decode(a);break}default:{a.skipType(it&7);break}}}return rt})),s),o.encode=a=>encodeMessage(a,o.codec()),o.decode=(a,et)=>decodeMessage(a,o.codec(),et)})(BlockPresence||(BlockPresence={}));var BitswapMessage;(function(o){let s;o.codec=()=>(s==null&&(s=message((a,et,tt={})=>{if(tt.lengthDelimited!==!1&&et.fork(),a.wantlist!=null&&(et.uint32(10),Wantlist.codec().encode(a.wantlist,et)),a.blocks!=null)for(const rt of a.blocks)et.uint32(26),Block.codec().encode(rt,et);if(a.blockPresences!=null)for(const rt of a.blockPresences)et.uint32(34),BlockPresence.codec().encode(rt,et);a.pendingBytes!=null&&a.pendingBytes!==0&&(et.uint32(40),et.int32(a.pendingBytes)),tt.lengthDelimited!==!1&&et.ldelim()},(a,et,tt={})=>{const rt={blocks:[],blockPresences:[],pendingBytes:0},nt=et==null?a.len:a.pos+et;for(;a.pos<nt;){const it=a.uint32();switch(it>>>3){case 1:{rt.wantlist=Wantlist.codec().decode(a,a.uint32(),{limits:tt.limits?.wantlist});break}case 3:{if(tt.limits?.blocks!=null&&rt.blocks.length===tt.limits.blocks)throw new CodeError$2('decode error - map field "blocks" had too many elements',"ERR_MAX_LENGTH");rt.blocks.push(Block.codec().decode(a,a.uint32(),{limits:tt.limits?.blocks$}));break}case 4:{if(tt.limits?.blockPresences!=null&&rt.blockPresences.length===tt.limits.blockPresences)throw new CodeError$2('decode error - map field "blockPresences" had too many elements',"ERR_MAX_LENGTH");rt.blockPresences.push(BlockPresence.codec().decode(a,a.uint32(),{limits:tt.limits?.blockPresences$}));break}case 5:{rt.pendingBytes=a.int32();break}default:{a.skipType(it&7);break}}}return rt})),s),o.encode=a=>encodeMessage(a,o.codec()),o.decode=(a,et)=>decodeMessage(a,o.codec(),et)})(BitswapMessage||(BitswapMessage={}));function mergeMessages(o,s){for(const[a,et]of s.wantlist.entries()){const tt=o.wantlist.get(a);tt!=null&&(tt.priority>et.priority&&(et.priority=tt.priority),et.cancel=et.cancel??tt.cancel,et.wantType=et.wantType??tt.wantType,et.sendDontHave=et.sendDontHave??tt.sendDontHave),o.wantlist.set(a,et)}for(const[a,et]of s.blockPresences.entries())o.blockPresences.set(a,et);for(const[a,et]of s.blocks.entries())o.blocks.set(a,et);return s.full&&!o.full&&(o.full=!0),o}const MAX_BLOCK_SIZE=4193648,MAX_ENCODED_BLOCK_SIZE=MAX_BLOCK_SIZE+16;function*splitMessage(o,s){const a=[...o.wantlist.values()],et=[...o.blockPresences.values()],tt=[...o.blocks.values()];let rt=0,nt=0,it=0,st=!1;for(;;){const ot={wantlist:{full:o.full??!1,entries:[]},blockPresences:[],blocks:[],pendingBytes:0};let at=BitswapMessage.encode(ot).byteLength,{added:lt,hasMore:ct,newSize:ht}=addToMessage(tt,ot.blocks,it,s,at,calculateEncodedBlockSize);it+=lt,at=ht;const ft=ct;({added:lt,hasMore:ct,newSize:ht}=addToMessage(et,ot.blockPresences,nt,s,at,calculateEncodedBlockPresenceSize)),nt+=lt,at=ht;const dt=ct;if({added:lt,hasMore:ct,newSize:ht}=addToMessage(a,ot.wantlist.entries,rt,s,at,calculateEncodedWantlistEntrySize),rt+=lt,at=ht,st=!ft&&!dt&&!ct,st||(ot.wantlist.full=!1),yield BitswapMessage.encode(ot),st)break}}function addToMessage(o,s,a,et,tt,rt){let nt=0,it=!1;for(let st=a;st<o.length;st++){const ot=o[st],at=rt(ot);if(at>MAX_ENCODED_BLOCK_SIZE)throw new CodeError$3("Cannot send block as after encoding it is over the max message size","ERR_BLOCK_TOO_LARGE");const lt=tt+at;if(lt>et){it=!0;break}s.push(ot),nt++,tt=lt}return{hasMore:it,added:nt,newSize:tt}}function calculateEncodedBlockSize(o){return calculateLength(3,Block.encode(o))}function calculateEncodedBlockPresenceSize(o){return calculateLength(4,BlockPresence.encode(o))}function calculateEncodedWantlistEntrySize(o){return calculateLength(1,WantlistEntry.encode(o))}function calculateLength(o,s){const a=encodingLength$1(o),et=encodingLength$1(s.byteLength);return a+et+s.byteLength}let Network$1=class extends TypedEventEmitter{log;libp2p;routing;protocols;running;maxInboundStreams;maxOutboundStreams;messageReceiveTimeout;registrarIds;metrics;sendQueue;runOnTransientConnections;maxOutgoingMessageSize;maxIncomingMessageSize;constructor(s,a={}){super(),this.log=s.logger.forComponent("helia:bitswap:network"),this.libp2p=s.libp2p,this.routing=s.routing,this.protocols=a.protocols??[BITSWAP_120],this.registrarIds=[],this.running=!1,this._onStream=this._onStream.bind(this),this.maxInboundStreams=a.maxInboundStreams??DEFAULT_MAX_INBOUND_STREAMS$2,this.maxOutboundStreams=a.maxOutboundStreams??DEFAULT_MAX_OUTBOUND_STREAMS$2,this.messageReceiveTimeout=a.messageReceiveTimeout??DEFAULT_MESSAGE_RECEIVE_TIMEOUT,this.runOnTransientConnections=a.runOnTransientConnections??DEFAULT_RUN_ON_TRANSIENT_CONNECTIONS,this.maxIncomingMessageSize=a.maxIncomingMessageSize??DEFAULT_MAX_OUTGOING_MESSAGE_SIZE,this.maxOutgoingMessageSize=a.maxOutgoingMessageSize??a.maxIncomingMessageSize??DEFAULT_MAX_INCOMING_MESSAGE_SIZE,this.metrics={blocksSent:s.metrics?.registerCounter("helia_bitswap_sent_blocks_total"),dataSent:s.metrics?.registerCounter("helia_bitswap_sent_data_bytes_total")},this.sendQueue=new PeerQueue({concurrency:a.messageSendConcurrency??DEFAULT_MESSAGE_SEND_CONCURRENCY,metrics:s.metrics,metricName:"helia_bitswap_message_send_queue"}),this.sendQueue.addEventListener("error",et=>{this.log.error("error sending wantlist to peer",et.detail)})}async start(){if(this.running)return;this.running=!0,await this.libp2p.handle(this.protocols,this._onStream,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnTransientConnection:this.runOnTransientConnections});const s={onConnect:a=>{this.safeDispatchEvent("peer:connected",{detail:a})},onDisconnect:a=>{this.safeDispatchEvent("peer:disconnected",{detail:a})}};this.registrarIds=[];for(const a of this.protocols)this.registrarIds.push(await this.libp2p.register(a,s));this.libp2p.getConnections().forEach(a=>{this.safeDispatchEvent("peer:connected",{detail:a.remotePeer})})}async stop(){if(this.running=!1,await this.libp2p.unhandle(this.protocols),this.registrarIds!=null){for(const s of this.registrarIds)this.libp2p.unregister(s);this.registrarIds=[]}}_onStream(s){if(!this.running)return;const{stream:a,connection:et}=s;Promise.resolve().then(async()=>{this.log("incoming new bitswap %s stream from %p",a.protocol,et.remotePeer);const tt=()=>{a.status==="open"?a.abort(new CodeError$3(`Incoming Bitswap stream timed out after ${this.messageReceiveTimeout}ms`,"ERR_TIMEOUT")):this.log("stream aborted with status %s",a.status)};let rt=AbortSignal.timeout(this.messageReceiveTimeout);setMaxListeners(1/0,rt),rt.addEventListener("abort",tt),await a.closeWrite(),await pipe(a,nt=>decode$f(nt,{maxDataLength:this.maxIncomingMessageSize}),async nt=>{for await(const it of nt)try{const st=BitswapMessage.decode(it);this.log("incoming new bitswap %s message from %p on stream",a.protocol,et.remotePeer,a.id),this.safeDispatchEvent("bitswap:message",{detail:{peer:et.remotePeer,message:st}}),rt.removeEventListener("abort",tt),rt=AbortSignal.timeout(this.messageReceiveTimeout),setMaxListeners(1/0,rt),rt.addEventListener("abort",tt)}catch(st){this.log.error("error reading incoming bitswap message from %p on stream",et.remotePeer,a.id,st),a.abort(st);break}})}).catch(tt=>{this.log.error("error handling incoming stream from %p",et.remotePeer,tt),a.abort(tt)})}async*findProviders(s,a){a?.onProgress?.(new CustomProgressEvent("bitswap:network:find-providers",s));for await(const et of this.routing.findProviders(s,a))await this.libp2p.isDialable(et.multiaddrs,{runOnTransientConnection:this.runOnTransientConnections})&&(yield et)}async findAndConnect(s,a){await drain(map$1(take(this.findProviders(s,a),a?.maxProviders??DEFAULT_MAX_PROVIDERS_PER_REQUEST),async et=>this.connectTo(et.id,a))).catch(et=>{this.log.error(et)})}async sendMessage(s,a,et){if(!this.running)throw new Error("network isn't running");const tt=this.sendQueue.queue.find(rt=>s.equals(rt.options.peerId)&&rt.status==="queued");if(tt!=null){tt.options.message=mergeMessages(tt.options.message,a),await tt.join({signal:et?.signal});return}await this.sendQueue.add(async rt=>{const nt=rt?.message;if(nt==null)throw new CodeError$3("No message to send","ERR_NO_MESSAGE");this.log("sendMessage to %p",s),rt?.onProgress?.(new CustomProgressEvent("bitswap:network:send-wantlist",s));const it=await this.libp2p.dialProtocol(s,BITSWAP_120,rt);await it.closeRead();try{await pipe(splitMessage(nt,this.maxOutgoingMessageSize),st=>encode$b(st),it),await it.close(rt)}catch(st){rt?.onProgress?.(new CustomProgressEvent("bitswap:network:send-wantlist:error",{peer:s,error:st})),this.log.error("error sending message to %p",s,st),it.abort(st)}this._updateSentStats(nt.blocks)},{peerId:s,signal:et?.signal,message:a})}async connectTo(s,a){if(!this.running)throw new CodeError$3("Network isn't running","ERR_NOT_STARTED");a?.onProgress?.(new CustomProgressEvent("bitswap:network:dial",s));const[et]=await Promise.all([this.libp2p.dial(s,a),raceEvent(this.libp2p,"peer:identify",a?.signal,{filter:tt=>{if(!tt.detail.peerId.equals(s))return!1;if(tt.detail.protocols.includes(BITSWAP_120))return!0;throw new CodeError$3(`${s} did not support ${BITSWAP_120}`,"ERR_BITSWAP_UNSUPPORTED_BY_PEER")}})]);return et}_updateSentStats(s){let a=0;for(const et of s.values())a+=et.data.byteLength;this.metrics.dataSent?.increment(a),this.metrics.blocksSent?.increment(s.size)}};function equals$f(o,s){if(o===s)return!0;if(o.byteLength!==s.byteLength)return!1;for(let a=0;a<o.byteLength;a++)if(o[a]!==s[a])return!1;return!0}const inspect$2=Symbol.for("nodejs.util.inspect.custom"),baseDecoder=Object.values(bases).map(o=>o.decoder).reduce((o,s)=>o.or(s),bases.identity.decoder),LIBP2P_KEY_CODE=114,MARSHALLED_ED225519_PUBLIC_KEY_LENGTH=36,MARSHALLED_SECP256K1_PUBLIC_KEY_LENGTH=37;class PeerIdImpl{type;multihash;privateKey;publicKey;string;constructor(s){this.type=s.type,this.multihash=s.multihash,this.privateKey=s.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[peerIdSymbol]=!0;toString(){return this.string==null&&(this.string=base58btc.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return CID.createV1(LIBP2P_KEY_CODE,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(s){if(s==null)return!1;if(s instanceof Uint8Array)return equals$f(this.multihash.bytes,s);if(typeof s=="string")return peerIdFromString(s).equals(this);if(s?.multihash?.bytes!=null)return equals$f(this.multihash.bytes,s.multihash.bytes);throw new Error("not valid Id")}[inspect$2](){return`PeerId(${this.toString()})`}}class RSAPeerIdImpl extends PeerIdImpl{type="RSA";publicKey;constructor(s){super({...s,type:"RSA"}),this.publicKey=s.publicKey}}class Ed25519PeerIdImpl extends PeerIdImpl{type="Ed25519";publicKey;constructor(s){super({...s,type:"Ed25519"}),this.publicKey=s.multihash.digest}}class Secp256k1PeerIdImpl extends PeerIdImpl{type="secp256k1";publicKey;constructor(s){super({...s,type:"secp256k1"}),this.publicKey=s.multihash.digest}}function peerIdFromPeerId(o){if(o.type==="RSA")return new RSAPeerIdImpl(o);if(o.type==="Ed25519")return new Ed25519PeerIdImpl(o);if(o.type==="secp256k1")return new Secp256k1PeerIdImpl(o);throw new CodeError$3("Not a PeerId","ERR_INVALID_PARAMETERS")}function peerIdFromString(o,s){if(s=s??baseDecoder,o.charAt(0)==="1"||o.charAt(0)==="Q"){const a=decode$8(base58btc.decode(`z${o}`));return o.startsWith("12D")?new Ed25519PeerIdImpl({multihash:a}):o.startsWith("16U")?new Secp256k1PeerIdImpl({multihash:a}):new RSAPeerIdImpl({multihash:a})}return peerIdFromBytes(baseDecoder.decode(o))}function peerIdFromBytes(o){try{const s=decode$8(o);if(s.code===identity$1.code){if(s.digest.length===MARSHALLED_ED225519_PUBLIC_KEY_LENGTH)return new Ed25519PeerIdImpl({multihash:s});if(s.digest.length===MARSHALLED_SECP256K1_PUBLIC_KEY_LENGTH)return new Secp256k1PeerIdImpl({multihash:s})}if(s.code===sha256$1.code)return new RSAPeerIdImpl({multihash:s})}catch{return peerIdFromCID(CID.decode(o))}throw new Error("Supplied PeerID CID is invalid")}function peerIdFromCID(o){if(o==null||o.multihash==null||o.version==null||o.version===1&&o.code!==LIBP2P_KEY_CODE)throw new Error("Supplied PeerID CID is invalid");const s=o.multihash;if(s.code===sha256$1.code)return new RSAPeerIdImpl({multihash:o.multihash});if(s.code===identity$1.code){if(s.digest.length===MARSHALLED_ED225519_PUBLIC_KEY_LENGTH)return new Ed25519PeerIdImpl({multihash:o.multihash});if(s.digest.length===MARSHALLED_SECP256K1_PUBLIC_KEY_LENGTH)return new Secp256k1PeerIdImpl({multihash:o.multihash})}throw new Error("Supplied PeerID CID is invalid")}async function peerIdFromKeys(o,s){return o.length===MARSHALLED_ED225519_PUBLIC_KEY_LENGTH?new Ed25519PeerIdImpl({multihash:create$1(identity$1.code,o),privateKey:s}):o.length===MARSHALLED_SECP256K1_PUBLIC_KEY_LENGTH?new Secp256k1PeerIdImpl({multihash:create$1(identity$1.code,o),privateKey:s}):new RSAPeerIdImpl({multihash:await sha256$1.digest(o),publicKey:o,privateKey:s})}function mapIterable(o,s){const a={[Symbol.iterator]:()=>a,next:()=>{const et=o.next(),tt=et.value;return et.done===!0||tt==null?{done:!0,value:void 0}:{done:!1,value:s(tt)}}};return a}class PeerMap{map;constructor(s){if(this.map=new Map,s!=null)for(const[a,et]of s.entries())this.map.set(a.toString(),et)}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(s){return this.map.delete(s.toString())}entries(){return mapIterable(this.map.entries(),s=>[peerIdFromString(s[0]),s[1]])}forEach(s){this.map.forEach((a,et)=>{s(a,peerIdFromString(et),this)})}get(s){return this.map.get(s.toString())}has(s){return this.map.has(s.toString())}set(s,a){this.map.set(s.toString(),a)}keys(){return mapIterable(this.map.keys(),s=>peerIdFromString(s))}values(){return this.map.values()}get size(){return this.map.size}}class PeerSet{set;constructor(s){if(this.set=new Set,s!=null)for(const a of s)this.set.add(a.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(s){this.set.add(s.toString())}clear(){this.set.clear()}delete(s){this.set.delete(s.toString())}entries(){return mapIterable(this.set.entries(),s=>{const a=peerIdFromString(s[0]);return[a,a]})}forEach(s){this.set.forEach(a=>{const et=peerIdFromString(a);s(et,et,this)})}has(s){return this.set.has(s.toString())}values(){return mapIterable(this.set.values(),s=>peerIdFromString(s))}intersection(s){const a=new PeerSet;for(const et of s)this.has(et)&&a.add(et);return a}difference(s){const a=new PeerSet;for(const et of this)s.has(et)||a.add(et);return a}union(s){const a=new PeerSet;for(const et of s)a.add(et);for(const et of this)a.add(et);return a}}const webcrypto={get(o=globalThis){const s=o.crypto;if(s==null||s.subtle==null)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return s}};function equals$e(o,s){if(o===s)return!0;if(o.byteLength!==s.byteLength)return!1;for(let a=0;a<o.byteLength;a++)if(o[a]!==s[a])return!1;return!0}function allocUnsafe$n(o=0){return new Uint8Array(o)}function asUint8Array$a(o){return o}function concat$c(o,s){s==null&&(s=o.reduce((tt,rt)=>tt+rt.length,0));const a=allocUnsafe$n(s);let et=0;for(const tt of o)a.set(tt,et),et+=tt.length;return a}function createCodec$o(o,s,a,et){return{name:o,prefix:s,encoder:{name:o,prefix:s,encode:a},decoder:{decode:et}}}const string$p=createCodec$o("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),ascii$o=createCodec$o("ascii","a",o=>{let s="a";for(let a=0;a<o.length;a++)s+=String.fromCharCode(o[a]);return s},o=>{o=o.substring(1);const s=allocUnsafe$n(o.length);for(let a=0;a<o.length;a++)s[a]=o.charCodeAt(a);return s}),BASES$o={utf8:string$p,"utf-8":string$p,hex:bases.base16,latin1:ascii$o,ascii:ascii$o,binary:ascii$o,...bases};function fromString$p(o,s="utf8"){const a=BASES$o[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.decoder.decode(`${a.prefix}${o}`)}function isPromise$6(o){return o==null?!1:typeof o.then=="function"&&typeof o.catch=="function"&&typeof o.finally=="function"}function number$2(o){if(!Number.isSafeInteger(o)||o<0)throw new Error(`positive integer expected, not ${o}`)}function isBytes$3(o){return o instanceof Uint8Array||o!=null&&typeof o=="object"&&o.constructor.name==="Uint8Array"}function bytes$1(o,...s){if(!isBytes$3(o))throw new Error("Uint8Array expected");if(s.length>0&&!s.includes(o.length))throw new Error(`Uint8Array expected of length ${s}, not of length=${o.length}`)}function hash$2(o){if(typeof o!="function"||typeof o.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number$2(o.outputLen),number$2(o.blockLen)}function exists$2(o,s=!0){if(o.destroyed)throw new Error("Hash instance has been destroyed");if(s&&o.finished)throw new Error("Hash#digest() has already been called")}function output$1(o,s){bytes$1(o);const a=s.outputLen;if(o.length<a)throw new Error(`digestInto() expects output buffer of length at least ${a}`)}const crypto$2=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const createView$1=o=>new DataView(o.buffer,o.byteOffset,o.byteLength),rotr=(o,s)=>o<<32-s|o>>>s,rotl$1=(o,s)=>o<<s|o>>>32-s>>>0;new Uint8Array(new Uint32Array([287454020]).buffer)[0];const nextTick=async()=>{};async function asyncLoop(o,s,a){let et=Date.now();for(let tt=0;tt<o;tt++){a(tt);const rt=Date.now()-et;rt>=0&&rt<s||(await nextTick(),et+=rt)}}function utf8ToBytes$3(o){if(typeof o!="string")throw new Error(`utf8ToBytes expected string, got ${typeof o}`);return new Uint8Array(new TextEncoder().encode(o))}function toBytes$2(o){return typeof o=="string"&&(o=utf8ToBytes$3(o)),bytes$1(o),o}function concatBytes$1(...o){let s=0;for(let et=0;et<o.length;et++){const tt=o[et];bytes$1(tt),s+=tt.length}const a=new Uint8Array(s);for(let et=0,tt=0;et<o.length;et++){const rt=o[et];a.set(rt,tt),tt+=rt.length}return a}class Hash{clone(){return this._cloneInto()}}const toStr={}.toString;function checkOpts$1(o,s){if(s!==void 0&&toStr.call(s)!=="[object Object]")throw new Error("Options should be object or undefined");return Object.assign(o,s)}function wrapConstructor(o){const s=et=>o().update(toBytes$2(et)).digest(),a=o();return s.outputLen=a.outputLen,s.blockLen=a.blockLen,s.create=()=>o(),s}function randomBytes$1(o=32){if(crypto$2&&typeof crypto$2.getRandomValues=="function")return crypto$2.getRandomValues(new Uint8Array(o));throw new Error("crypto.getRandomValues must be defined")}function setBigUint64$1(o,s,a,et){if(typeof o.setBigUint64=="function")return o.setBigUint64(s,a,et);const tt=BigInt(32),rt=BigInt(4294967295),nt=Number(a>>tt&rt),it=Number(a&rt),st=et?4:0,ot=et?0:4;o.setUint32(s+st,nt,et),o.setUint32(s+ot,it,et)}const Chi=(o,s,a)=>o&s^~o&a,Maj=(o,s,a)=>o&s^o&a^s&a;class HashMD extends Hash{constructor(s,a,et,tt){super(),this.blockLen=s,this.outputLen=a,this.padOffset=et,this.isLE=tt,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(s),this.view=createView$1(this.buffer)}update(s){exists$2(this);const{view:a,buffer:et,blockLen:tt}=this;s=toBytes$2(s);const rt=s.length;for(let nt=0;nt<rt;){const it=Math.min(tt-this.pos,rt-nt);if(it===tt){const st=createView$1(s);for(;tt<=rt-nt;nt+=tt)this.process(st,nt);continue}et.set(s.subarray(nt,nt+it),this.pos),this.pos+=it,nt+=it,this.pos===tt&&(this.process(a,0),this.pos=0)}return this.length+=s.length,this.roundClean(),this}digestInto(s){exists$2(this),output$1(s,this),this.finished=!0;const{buffer:a,view:et,blockLen:tt,isLE:rt}=this;let{pos:nt}=this;a[nt++]=128,this.buffer.subarray(nt).fill(0),this.padOffset>tt-nt&&(this.process(et,0),nt=0);for(let lt=nt;lt<tt;lt++)a[lt]=0;setBigUint64$1(et,tt-8,BigInt(this.length*8),rt),this.process(et,0);const it=createView$1(s),st=this.outputLen;if(st%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const ot=st/4,at=this.get();if(ot>at.length)throw new Error("_sha2: outputLen bigger than state");for(let lt=0;lt<ot;lt++)it.setUint32(4*lt,at[lt],rt)}digest(){const{buffer:s,outputLen:a}=this;this.digestInto(s);const et=s.slice(0,a);return this.destroy(),et}_cloneInto(s){s||(s=new this.constructor),s.set(...this.get());const{blockLen:a,buffer:et,length:tt,finished:rt,destroyed:nt,pos:it}=this;return s.length=tt,s.pos=it,s.finished=rt,s.destroyed=nt,tt%a&&s.buffer.set(et),s}}const U32_MASK64=BigInt(2**32-1),_32n=BigInt(32);function fromBig(o,s=!1){return s?{h:Number(o&U32_MASK64),l:Number(o>>_32n&U32_MASK64)}:{h:Number(o>>_32n&U32_MASK64)|0,l:Number(o&U32_MASK64)|0}}function split(o,s=!1){let a=new Uint32Array(o.length),et=new Uint32Array(o.length);for(let tt=0;tt<o.length;tt++){const{h:rt,l:nt}=fromBig(o[tt],s);[a[tt],et[tt]]=[rt,nt]}return[a,et]}const toBig=(o,s)=>BigInt(o>>>0)<<_32n|BigInt(s>>>0),shrSH=(o,s,a)=>o>>>a,shrSL=(o,s,a)=>o<<32-a|s>>>a,rotrSH=(o,s,a)=>o>>>a|s<<32-a,rotrSL=(o,s,a)=>o<<32-a|s>>>a,rotrBH=(o,s,a)=>o<<64-a|s>>>a-32,rotrBL=(o,s,a)=>o>>>a-32|s<<64-a,rotr32H=(o,s)=>s,rotr32L=(o,s)=>o,rotlSH=(o,s,a)=>o<<a|s>>>32-a,rotlSL=(o,s,a)=>s<<a|o>>>32-a,rotlBH=(o,s,a)=>s<<a-32|o>>>64-a,rotlBL=(o,s,a)=>o<<a-32|s>>>64-a;function add(o,s,a,et){const tt=(s>>>0)+(et>>>0);return{h:o+a+(tt/2**32|0)|0,l:tt|0}}const add3L=(o,s,a)=>(o>>>0)+(s>>>0)+(a>>>0),add3H=(o,s,a,et)=>s+a+et+(o/2**32|0)|0,add4L=(o,s,a,et)=>(o>>>0)+(s>>>0)+(a>>>0)+(et>>>0),add4H=(o,s,a,et,tt)=>s+a+et+tt+(o/2**32|0)|0,add5L=(o,s,a,et,tt)=>(o>>>0)+(s>>>0)+(a>>>0)+(et>>>0)+(tt>>>0),add5H=(o,s,a,et,tt,rt)=>s+a+et+tt+rt+(o/2**32|0)|0,u64={fromBig,split,toBig,shrSH,shrSL,rotrSH,rotrSL,rotrBH,rotrBL,rotr32H,rotr32L,rotlSH,rotlSL,rotlBH,rotlBL,add,add3L,add3H,add4L,add4H,add5H,add5L},[SHA512_Kh,SHA512_Kl]=u64.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(o=>BigInt(o))),SHA512_W_H=new Uint32Array(80),SHA512_W_L=new Uint32Array(80);class SHA512 extends HashMD{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:s,Al:a,Bh:et,Bl:tt,Ch:rt,Cl:nt,Dh:it,Dl:st,Eh:ot,El:at,Fh:lt,Fl:ct,Gh:ht,Gl:ft,Hh:dt,Hl:pt}=this;return[s,a,et,tt,rt,nt,it,st,ot,at,lt,ct,ht,ft,dt,pt]}set(s,a,et,tt,rt,nt,it,st,ot,at,lt,ct,ht,ft,dt,pt){this.Ah=s|0,this.Al=a|0,this.Bh=et|0,this.Bl=tt|0,this.Ch=rt|0,this.Cl=nt|0,this.Dh=it|0,this.Dl=st|0,this.Eh=ot|0,this.El=at|0,this.Fh=lt|0,this.Fl=ct|0,this.Gh=ht|0,this.Gl=ft|0,this.Hh=dt|0,this.Hl=pt|0}process(s,a){for(let yt=0;yt<16;yt++,a+=4)SHA512_W_H[yt]=s.getUint32(a),SHA512_W_L[yt]=s.getUint32(a+=4);for(let yt=16;yt<80;yt++){const vt=SHA512_W_H[yt-15]|0,Et=SHA512_W_L[yt-15]|0,xt=u64.rotrSH(vt,Et,1)^u64.rotrSH(vt,Et,8)^u64.shrSH(vt,Et,7),wt=u64.rotrSL(vt,Et,1)^u64.rotrSL(vt,Et,8)^u64.shrSL(vt,Et,7),Rt=SHA512_W_H[yt-2]|0,Ct=SHA512_W_L[yt-2]|0,Ft=u64.rotrSH(Rt,Ct,19)^u64.rotrBH(Rt,Ct,61)^u64.shrSH(Rt,Ct,6),zt=u64.rotrSL(Rt,Ct,19)^u64.rotrBL(Rt,Ct,61)^u64.shrSL(Rt,Ct,6),Nt=u64.add4L(wt,zt,SHA512_W_L[yt-7],SHA512_W_L[yt-16]),Kt=u64.add4H(Nt,xt,Ft,SHA512_W_H[yt-7],SHA512_W_H[yt-16]);SHA512_W_H[yt]=Kt|0,SHA512_W_L[yt]=Nt|0}let{Ah:et,Al:tt,Bh:rt,Bl:nt,Ch:it,Cl:st,Dh:ot,Dl:at,Eh:lt,El:ct,Fh:ht,Fl:ft,Gh:dt,Gl:pt,Hh:gt,Hl:mt}=this;for(let yt=0;yt<80;yt++){const vt=u64.rotrSH(lt,ct,14)^u64.rotrSH(lt,ct,18)^u64.rotrBH(lt,ct,41),Et=u64.rotrSL(lt,ct,14)^u64.rotrSL(lt,ct,18)^u64.rotrBL(lt,ct,41),xt=lt&ht^~lt&dt,wt=ct&ft^~ct&pt,Rt=u64.add5L(mt,Et,wt,SHA512_Kl[yt],SHA512_W_L[yt]),Ct=u64.add5H(Rt,gt,vt,xt,SHA512_Kh[yt],SHA512_W_H[yt]),Ft=Rt|0,zt=u64.rotrSH(et,tt,28)^u64.rotrBH(et,tt,34)^u64.rotrBH(et,tt,39),Nt=u64.rotrSL(et,tt,28)^u64.rotrBL(et,tt,34)^u64.rotrBL(et,tt,39),Kt=et&rt^et&it^rt&it,Yt=tt&nt^tt&st^nt&st;gt=dt|0,mt=pt|0,dt=ht|0,pt=ft|0,ht=lt|0,ft=ct|0,{h:lt,l:ct}=u64.add(ot|0,at|0,Ct|0,Ft|0),ot=it|0,at=st|0,it=rt|0,st=nt|0,rt=et|0,nt=tt|0;const Bt=u64.add3L(Ft,Nt,Yt);et=u64.add3H(Bt,Ct,zt,Kt),tt=Bt|0}({h:et,l:tt}=u64.add(this.Ah|0,this.Al|0,et|0,tt|0)),{h:rt,l:nt}=u64.add(this.Bh|0,this.Bl|0,rt|0,nt|0),{h:it,l:st}=u64.add(this.Ch|0,this.Cl|0,it|0,st|0),{h:ot,l:at}=u64.add(this.Dh|0,this.Dl|0,ot|0,at|0),{h:lt,l:ct}=u64.add(this.Eh|0,this.El|0,lt|0,ct|0),{h:ht,l:ft}=u64.add(this.Fh|0,this.Fl|0,ht|0,ft|0),{h:dt,l:pt}=u64.add(this.Gh|0,this.Gl|0,dt|0,pt|0),{h:gt,l:mt}=u64.add(this.Hh|0,this.Hl|0,gt|0,mt|0),this.set(et,tt,rt,nt,it,st,ot,at,lt,ct,ht,ft,dt,pt,gt,mt)}roundClean(){SHA512_W_H.fill(0),SHA512_W_L.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const sha512=wrapConstructor(()=>new SHA512);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$5=BigInt(0),_1n$7=BigInt(1),_2n$4=BigInt(2);function isBytes$2(o){return o instanceof Uint8Array||o!=null&&typeof o=="object"&&o.constructor.name==="Uint8Array"}function abytes(o){if(!isBytes$2(o))throw new Error("Uint8Array expected")}const hexes=Array.from({length:256},(o,s)=>s.toString(16).padStart(2,"0"));function bytesToHex(o){abytes(o);let s="";for(let a=0;a<o.length;a++)s+=hexes[o[a]];return s}function numberToHexUnpadded(o){const s=o.toString(16);return s.length&1?`0${s}`:s}function hexToNumber(o){if(typeof o!="string")throw new Error("hex string expected, got "+typeof o);return BigInt(o===""?"0":`0x${o}`)}const asciis={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function asciiToBase16(o){if(o>=asciis._0&&o<=asciis._9)return o-asciis._0;if(o>=asciis._A&&o<=asciis._F)return o-(asciis._A-10);if(o>=asciis._a&&o<=asciis._f)return o-(asciis._a-10)}function hexToBytes(o){if(typeof o!="string")throw new Error("hex string expected, got "+typeof o);const s=o.length,a=s/2;if(s%2)throw new Error("padded hex string expected, got unpadded hex of length "+s);const et=new Uint8Array(a);for(let tt=0,rt=0;tt<a;tt++,rt+=2){const nt=asciiToBase16(o.charCodeAt(rt)),it=asciiToBase16(o.charCodeAt(rt+1));if(nt===void 0||it===void 0){const st=o[rt]+o[rt+1];throw new Error('hex string expected, got non-hex character "'+st+'" at index '+rt)}et[tt]=nt*16+it}return et}function bytesToNumberBE(o){return hexToNumber(bytesToHex(o))}function bytesToNumberLE(o){return abytes(o),hexToNumber(bytesToHex(Uint8Array.from(o).reverse()))}function numberToBytesBE(o,s){return hexToBytes(o.toString(16).padStart(s*2,"0"))}function numberToBytesLE(o,s){return numberToBytesBE(o,s).reverse()}function numberToVarBytesBE(o){return hexToBytes(numberToHexUnpadded(o))}function ensureBytes$1(o,s,a){let et;if(typeof s=="string")try{et=hexToBytes(s)}catch(rt){throw new Error(`${o} must be valid hex string, got "${s}". Cause: ${rt}`)}else if(isBytes$2(s))et=Uint8Array.from(s);else throw new Error(`${o} must be hex string or Uint8Array`);const tt=et.length;if(typeof a=="number"&&tt!==a)throw new Error(`${o} expected ${a} bytes, got ${tt}`);return et}function concatBytes(...o){let s=0;for(let et=0;et<o.length;et++){const tt=o[et];abytes(tt),s+=tt.length}const a=new Uint8Array(s);for(let et=0,tt=0;et<o.length;et++){const rt=o[et];a.set(rt,tt),tt+=rt.length}return a}function equalBytes$1(o,s){if(o.length!==s.length)return!1;let a=0;for(let et=0;et<o.length;et++)a|=o[et]^s[et];return a===0}function utf8ToBytes$2(o){if(typeof o!="string")throw new Error(`utf8ToBytes expected string, got ${typeof o}`);return new Uint8Array(new TextEncoder().encode(o))}function bitLen(o){let s;for(s=0;o>_0n$5;o>>=_1n$7,s+=1);return s}function bitGet(o,s){return o>>BigInt(s)&_1n$7}function bitSet(o,s,a){return o|(a?_1n$7:_0n$5)<<BigInt(s)}const bitMask=o=>(_2n$4<<BigInt(o-1))-_1n$7,u8n=o=>new Uint8Array(o),u8fr=o=>Uint8Array.from(o);function createHmacDrbg(o,s,a){if(typeof o!="number"||o<2)throw new Error("hashLen must be a number");if(typeof s!="number"||s<2)throw new Error("qByteLen must be a number");if(typeof a!="function")throw new Error("hmacFn must be a function");let et=u8n(o),tt=u8n(o),rt=0;const nt=()=>{et.fill(1),tt.fill(0),rt=0},it=(...lt)=>a(tt,et,...lt),st=(lt=u8n())=>{tt=it(u8fr([0]),lt),et=it(),lt.length!==0&&(tt=it(u8fr([1]),lt),et=it())},ot=()=>{if(rt++>=1e3)throw new Error("drbg: tried 1000 values");let lt=0;const ct=[];for(;lt<s;){et=it();const ht=et.slice();ct.push(ht),lt+=et.length}return concatBytes(...ct)};return(lt,ct)=>{nt(),st(lt);let ht;for(;!(ht=ct(ot()));)st();return nt(),ht}}const validatorFns={bigint:o=>typeof o=="bigint",function:o=>typeof o=="function",boolean:o=>typeof o=="boolean",string:o=>typeof o=="string",stringOrUint8Array:o=>typeof o=="string"||isBytes$2(o),isSafeInteger:o=>Number.isSafeInteger(o),array:o=>Array.isArray(o),field:(o,s)=>s.Fp.isValid(o),hash:o=>typeof o=="function"&&Number.isSafeInteger(o.outputLen)};function validateObject(o,s,a={}){const et=(tt,rt,nt)=>{const it=validatorFns[rt];if(typeof it!="function")throw new Error(`Invalid validator "${rt}", expected function`);const st=o[tt];if(!(nt&&st===void 0)&&!it(st,o))throw new Error(`Invalid param ${String(tt)}=${st} (${typeof st}), expected ${rt}`)};for(const[tt,rt]of Object.entries(s))et(tt,rt,!1);for(const[tt,rt]of Object.entries(a))et(tt,rt,!0);return o}const ut=Object.freeze(Object.defineProperty({__proto__:null,abytes,bitGet,bitLen,bitMask,bitSet,bytesToHex,bytesToNumberBE,bytesToNumberLE,concatBytes,createHmacDrbg,ensureBytes:ensureBytes$1,equalBytes:equalBytes$1,hexToBytes,hexToNumber,isBytes:isBytes$2,numberToBytesBE,numberToBytesLE,numberToHexUnpadded,numberToVarBytesBE,utf8ToBytes:utf8ToBytes$2,validateObject},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$4=BigInt(0),_1n$6=BigInt(1),_2n$3=BigInt(2),_3n$1=BigInt(3),_4n=BigInt(4),_5n$1=BigInt(5),_8n$1=BigInt(8);BigInt(9);BigInt(16);function mod(o,s){const a=o%s;return a>=_0n$4?a:s+a}function pow(o,s,a){if(a<=_0n$4||s<_0n$4)throw new Error("Expected power/modulo > 0");if(a===_1n$6)return _0n$4;let et=_1n$6;for(;s>_0n$4;)s&_1n$6&&(et=et*o%a),o=o*o%a,s>>=_1n$6;return et}function pow2(o,s,a){let et=o;for(;s-- >_0n$4;)et*=et,et%=a;return et}function invert(o,s){if(o===_0n$4||s<=_0n$4)throw new Error(`invert: expected positive integers, got n=${o} mod=${s}`);let a=mod(o,s),et=s,tt=_0n$4,rt=_1n$6;for(;a!==_0n$4;){const it=et/a,st=et%a,ot=tt-rt*it;et=a,a=st,tt=rt,rt=ot}if(et!==_1n$6)throw new Error("invert: does not exist");return mod(tt,s)}function tonelliShanks(o){const s=(o-_1n$6)/_2n$3;let a,et,tt;for(a=o-_1n$6,et=0;a%_2n$3===_0n$4;a/=_2n$3,et++);for(tt=_2n$3;tt<o&&pow(tt,s,o)!==o-_1n$6;tt++);if(et===1){const nt=(o+_1n$6)/_4n;return function(st,ot){const at=st.pow(ot,nt);if(!st.eql(st.sqr(at),ot))throw new Error("Cannot find square root");return at}}const rt=(a+_1n$6)/_2n$3;return function(it,st){if(it.pow(st,s)===it.neg(it.ONE))throw new Error("Cannot find square root");let ot=et,at=it.pow(it.mul(it.ONE,tt),a),lt=it.pow(st,rt),ct=it.pow(st,a);for(;!it.eql(ct,it.ONE);){if(it.eql(ct,it.ZERO))return it.ZERO;let ht=1;for(let dt=it.sqr(ct);ht<ot&&!it.eql(dt,it.ONE);ht++)dt=it.sqr(dt);const ft=it.pow(at,_1n$6<<BigInt(ot-ht-1));at=it.sqr(ft),lt=it.mul(lt,ft),ct=it.mul(ct,at),ot=ht}return lt}}function FpSqrt(o){if(o%_4n===_3n$1){const s=(o+_1n$6)/_4n;return function(et,tt){const rt=et.pow(tt,s);if(!et.eql(et.sqr(rt),tt))throw new Error("Cannot find square root");return rt}}if(o%_8n$1===_5n$1){const s=(o-_5n$1)/_8n$1;return function(et,tt){const rt=et.mul(tt,_2n$3),nt=et.pow(rt,s),it=et.mul(tt,nt),st=et.mul(et.mul(it,_2n$3),nt),ot=et.mul(it,et.sub(st,et.ONE));if(!et.eql(et.sqr(ot),tt))throw new Error("Cannot find square root");return ot}}return tonelliShanks(o)}const isNegativeLE=(o,s)=>(mod(o,s)&_1n$6)===_1n$6,FIELD_FIELDS=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField(o){const s={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},a=FIELD_FIELDS.reduce((et,tt)=>(et[tt]="function",et),s);return validateObject(o,a)}function FpPow(o,s,a){if(a<_0n$4)throw new Error("Expected power > 0");if(a===_0n$4)return o.ONE;if(a===_1n$6)return s;let et=o.ONE,tt=s;for(;a>_0n$4;)a&_1n$6&&(et=o.mul(et,tt)),tt=o.sqr(tt),a>>=_1n$6;return et}function FpInvertBatch(o,s){const a=new Array(s.length),et=s.reduce((rt,nt,it)=>o.is0(nt)?rt:(a[it]=rt,o.mul(rt,nt)),o.ONE),tt=o.inv(et);return s.reduceRight((rt,nt,it)=>o.is0(nt)?rt:(a[it]=o.mul(rt,a[it]),o.mul(rt,nt)),tt),a}function nLength(o,s){const a=s!==void 0?s:o.toString(2).length,et=Math.ceil(a/8);return{nBitLength:a,nByteLength:et}}function Field(o,s,a=!1,et={}){if(o<=_0n$4)throw new Error(`Expected Field ORDER > 0, got ${o}`);const{nBitLength:tt,nByteLength:rt}=nLength(o,s);if(rt>2048)throw new Error("Field lengths over 2048 bytes are not supported");const nt=FpSqrt(o),it=Object.freeze({ORDER:o,BITS:tt,BYTES:rt,MASK:bitMask(tt),ZERO:_0n$4,ONE:_1n$6,create:st=>mod(st,o),isValid:st=>{if(typeof st!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof st}`);return _0n$4<=st&&st<o},is0:st=>st===_0n$4,isOdd:st=>(st&_1n$6)===_1n$6,neg:st=>mod(-st,o),eql:(st,ot)=>st===ot,sqr:st=>mod(st*st,o),add:(st,ot)=>mod(st+ot,o),sub:(st,ot)=>mod(st-ot,o),mul:(st,ot)=>mod(st*ot,o),pow:(st,ot)=>FpPow(it,st,ot),div:(st,ot)=>mod(st*invert(ot,o),o),sqrN:st=>st*st,addN:(st,ot)=>st+ot,subN:(st,ot)=>st-ot,mulN:(st,ot)=>st*ot,inv:st=>invert(st,o),sqrt:et.sqrt||(st=>nt(it,st)),invertBatch:st=>FpInvertBatch(it,st),cmov:(st,ot,at)=>at?ot:st,toBytes:st=>a?numberToBytesLE(st,rt):numberToBytesBE(st,rt),fromBytes:st=>{if(st.length!==rt)throw new Error(`Fp.fromBytes: expected ${rt}, got ${st.length}`);return a?bytesToNumberLE(st):bytesToNumberBE(st)}});return Object.freeze(it)}function FpSqrtEven(o,s){if(!o.isOdd)throw new Error("Field doesn't have isOdd");const a=o.sqrt(s);return o.isOdd(a)?o.neg(a):a}function getFieldBytesLength(o){if(typeof o!="bigint")throw new Error("field order must be bigint");const s=o.toString(2).length;return Math.ceil(s/8)}function getMinHashLength(o){const s=getFieldBytesLength(o);return s+Math.ceil(s/2)}function mapHashToField(o,s,a=!1){const et=o.length,tt=getFieldBytesLength(s),rt=getMinHashLength(s);if(et<16||et<rt||et>1024)throw new Error(`expected ${rt}-1024 bytes of input, got ${et}`);const nt=a?bytesToNumberBE(o):bytesToNumberLE(o),it=mod(nt,s-_1n$6)+_1n$6;return a?numberToBytesLE(it,tt):numberToBytesBE(it,tt)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$3=BigInt(0),_1n$5=BigInt(1);function wNAF(o,s){const a=(tt,rt)=>{const nt=rt.negate();return tt?nt:rt},et=tt=>{const rt=Math.ceil(s/tt)+1,nt=2**(tt-1);return{windows:rt,windowSize:nt}};return{constTimeNegate:a,unsafeLadder(tt,rt){let nt=o.ZERO,it=tt;for(;rt>_0n$3;)rt&_1n$5&&(nt=nt.add(it)),it=it.double(),rt>>=_1n$5;return nt},precomputeWindow(tt,rt){const{windows:nt,windowSize:it}=et(rt),st=[];let ot=tt,at=ot;for(let lt=0;lt<nt;lt++){at=ot,st.push(at);for(let ct=1;ct<it;ct++)at=at.add(ot),st.push(at);ot=at.double()}return st},wNAF(tt,rt,nt){const{windows:it,windowSize:st}=et(tt);let ot=o.ZERO,at=o.BASE;const lt=BigInt(2**tt-1),ct=2**tt,ht=BigInt(tt);for(let ft=0;ft<it;ft++){const dt=ft*st;let pt=Number(nt&lt);nt>>=ht,pt>st&&(pt-=ct,nt+=_1n$5);const gt=dt,mt=dt+Math.abs(pt)-1,yt=ft%2!==0,vt=pt<0;pt===0?at=at.add(a(yt,rt[gt])):ot=ot.add(a(vt,rt[mt]))}return{p:ot,f:at}},wNAFCached(tt,rt,nt,it){const st=tt._WINDOW_SIZE||1;let ot=rt.get(tt);return ot||(ot=this.precomputeWindow(tt,st),st!==1&&rt.set(tt,it(ot))),this.wNAF(st,ot,nt)}}}function validateBasic(o){return validateField(o.Fp),validateObject(o,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...nLength(o.n,o.nBitLength),...o,p:o.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$2=BigInt(0),_1n$4=BigInt(1),_2n$2=BigInt(2),_8n=BigInt(8),VERIFY_DEFAULT={zip215:!0};function validateOpts$2(o){const s=validateBasic(o);return validateObject(o,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...s})}function twistedEdwards(o){const s=validateOpts$2(o),{Fp:a,n:et,prehash:tt,hash:rt,randomBytes:nt,nByteLength:it,h:st}=s,ot=_2n$2<<BigInt(it*8)-_1n$4,at=a.create,lt=s.uvRatio||((Tt,St)=>{try{return{isValid:!0,value:a.sqrt(Tt*a.inv(St))}}catch{return{isValid:!1,value:_0n$2}}}),ct=s.adjustScalarBytes||(Tt=>Tt),ht=s.domain||((Tt,St,Mt)=>{if(St.length||Mt)throw new Error("Contexts/pre-hash are not supported");return Tt}),ft=Tt=>typeof Tt=="bigint"&&_0n$2<Tt,dt=(Tt,St)=>ft(Tt)&&ft(St)&&Tt<St,pt=Tt=>Tt===_0n$2||dt(Tt,ot);function gt(Tt,St){if(dt(Tt,St))return Tt;throw new Error(`Expected valid scalar < ${St}, got ${typeof Tt} ${Tt}`)}function mt(Tt){return Tt===_0n$2?Tt:gt(Tt,et)}const yt=new Map;function vt(Tt){if(!(Tt instanceof Et))throw new Error("ExtendedPoint expected")}class Et{constructor(St,Mt,jt,Gt){if(this.ex=St,this.ey=Mt,this.ez=jt,this.et=Gt,!pt(St))throw new Error("x required");if(!pt(Mt))throw new Error("y required");if(!pt(jt))throw new Error("z required");if(!pt(Gt))throw new Error("t required")}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(St){if(St instanceof Et)throw new Error("extended point not allowed");const{x:Mt,y:jt}=St||{};if(!pt(Mt)||!pt(jt))throw new Error("invalid affine point");return new Et(Mt,jt,_1n$4,at(Mt*jt))}static normalizeZ(St){const Mt=a.invertBatch(St.map(jt=>jt.ez));return St.map((jt,Gt)=>jt.toAffine(Mt[Gt])).map(Et.fromAffine)}_setWindowSize(St){this._WINDOW_SIZE=St,yt.delete(this)}assertValidity(){const{a:St,d:Mt}=s;if(this.is0())throw new Error("bad point: ZERO");const{ex:jt,ey:Gt,ez:Ht,et:At}=this,$t=at(jt*jt),kt=at(Gt*Gt),Lt=at(Ht*Ht),bt=at(Lt*Lt),It=at($t*St),Ut=at(Lt*at(It+kt)),Wt=at(bt+at(Mt*at($t*kt)));if(Ut!==Wt)throw new Error("bad point: equation left != right (1)");const Xt=at(jt*Gt),Qt=at(Ht*At);if(Xt!==Qt)throw new Error("bad point: equation left != right (2)")}equals(St){vt(St);const{ex:Mt,ey:jt,ez:Gt}=this,{ex:Ht,ey:At,ez:$t}=St,kt=at(Mt*$t),Lt=at(Ht*Gt),bt=at(jt*$t),It=at(At*Gt);return kt===Lt&&bt===It}is0(){return this.equals(Et.ZERO)}negate(){return new Et(at(-this.ex),this.ey,this.ez,at(-this.et))}double(){const{a:St}=s,{ex:Mt,ey:jt,ez:Gt}=this,Ht=at(Mt*Mt),At=at(jt*jt),$t=at(_2n$2*at(Gt*Gt)),kt=at(St*Ht),Lt=Mt+jt,bt=at(at(Lt*Lt)-Ht-At),It=kt+At,Ut=It-$t,Wt=kt-At,Xt=at(bt*Ut),Qt=at(It*Wt),er=at(bt*Wt),lr=at(Ut*It);return new Et(Xt,Qt,lr,er)}add(St){vt(St);const{a:Mt,d:jt}=s,{ex:Gt,ey:Ht,ez:At,et:$t}=this,{ex:kt,ey:Lt,ez:bt,et:It}=St;if(Mt===BigInt(-1)){const kr=at((Ht-Gt)*(Lt+kt)),Ir=at((Ht+Gt)*(Lt-kt)),tr=at(Ir-kr);if(tr===_0n$2)return this.double();const sr=at(At*_2n$2*It),vr=at($t*_2n$2*bt),xr=vr+sr,Er=Ir+kr,Sr=vr-sr,$r=at(xr*tr),Or=at(Er*Sr),Nr=at(xr*Sr),Rr=at(tr*Er);return new Et($r,Or,Rr,Nr)}const Ut=at(Gt*kt),Wt=at(Ht*Lt),Xt=at($t*jt*It),Qt=at(At*bt),er=at((Gt+Ht)*(kt+Lt)-Ut-Wt),lr=Qt-Xt,pr=Qt+Xt,gr=at(Wt-Mt*Ut),wr=at(er*lr),cr=at(pr*gr),Cr=at(er*gr),_r=at(lr*pr);return new Et(wr,cr,_r,Cr)}subtract(St){return this.add(St.negate())}wNAF(St){return Rt.wNAFCached(this,yt,St,Et.normalizeZ)}multiply(St){const{p:Mt,f:jt}=this.wNAF(gt(St,et));return Et.normalizeZ([Mt,jt])[0]}multiplyUnsafe(St){let Mt=mt(St);return Mt===_0n$2?wt:this.equals(wt)||Mt===_1n$4?this:this.equals(xt)?this.wNAF(Mt).p:Rt.unsafeLadder(this,Mt)}isSmallOrder(){return this.multiplyUnsafe(st).is0()}isTorsionFree(){return Rt.unsafeLadder(this,et).is0()}toAffine(St){const{ex:Mt,ey:jt,ez:Gt}=this,Ht=this.is0();St==null&&(St=Ht?_8n:a.inv(Gt));const At=at(Mt*St),$t=at(jt*St),kt=at(Gt*St);if(Ht)return{x:_0n$2,y:_1n$4};if(kt!==_1n$4)throw new Error("invZ was invalid");return{x:At,y:$t}}clearCofactor(){const{h:St}=s;return St===_1n$4?this:this.multiplyUnsafe(St)}static fromHex(St,Mt=!1){const{d:jt,a:Gt}=s,Ht=a.BYTES;St=ensureBytes$1("pointHex",St,Ht);const At=St.slice(),$t=St[Ht-1];At[Ht-1]=$t&-129;const kt=bytesToNumberLE(At);kt===_0n$2||(Mt?gt(kt,ot):gt(kt,a.ORDER));const Lt=at(kt*kt),bt=at(Lt-_1n$4),It=at(jt*Lt-Gt);let{isValid:Ut,value:Wt}=lt(bt,It);if(!Ut)throw new Error("Point.fromHex: invalid y coordinate");const Xt=(Wt&_1n$4)===_1n$4,Qt=($t&128)!==0;if(!Mt&&Wt===_0n$2&&Qt)throw new Error("Point.fromHex: x=0 and x_0=1");return Qt!==Xt&&(Wt=at(-Wt)),Et.fromAffine({x:Wt,y:kt})}static fromPrivateKey(St){return zt(St).point}toRawBytes(){const{x:St,y:Mt}=this.toAffine(),jt=numberToBytesLE(Mt,a.BYTES);return jt[jt.length-1]|=St&_1n$4?128:0,jt}toHex(){return bytesToHex(this.toRawBytes())}}Et.BASE=new Et(s.Gx,s.Gy,_1n$4,at(s.Gx*s.Gy)),Et.ZERO=new Et(_0n$2,_1n$4,_1n$4,_0n$2);const{BASE:xt,ZERO:wt}=Et,Rt=wNAF(Et,it*8);function Ct(Tt){return mod(Tt,et)}function Ft(Tt){return Ct(bytesToNumberLE(Tt))}function zt(Tt){const St=it;Tt=ensureBytes$1("private key",Tt,St);const Mt=ensureBytes$1("hashed private key",rt(Tt),2*St),jt=ct(Mt.slice(0,St)),Gt=Mt.slice(St,2*St),Ht=Ft(jt),At=xt.multiply(Ht),$t=At.toRawBytes();return{head:jt,prefix:Gt,scalar:Ht,point:At,pointBytes:$t}}function Nt(Tt){return zt(Tt).pointBytes}function Kt(Tt=new Uint8Array,...St){const Mt=concatBytes(...St);return Ft(rt(ht(Mt,ensureBytes$1("context",Tt),!!tt)))}function Yt(Tt,St,Mt={}){Tt=ensureBytes$1("message",Tt),tt&&(Tt=tt(Tt));const{prefix:jt,scalar:Gt,pointBytes:Ht}=zt(St),At=Kt(Mt.context,jt,Tt),$t=xt.multiply(At).toRawBytes(),kt=Kt(Mt.context,$t,Ht,Tt),Lt=Ct(At+kt*Gt);mt(Lt);const bt=concatBytes($t,numberToBytesLE(Lt,a.BYTES));return ensureBytes$1("result",bt,it*2)}const Bt=VERIFY_DEFAULT;function Pt(Tt,St,Mt,jt=Bt){const{context:Gt,zip215:Ht}=jt,At=a.BYTES;Tt=ensureBytes$1("signature",Tt,2*At),St=ensureBytes$1("message",St),tt&&(St=tt(St));const $t=bytesToNumberLE(Tt.slice(At,2*At));let kt,Lt,bt;try{kt=Et.fromHex(Mt,Ht),Lt=Et.fromHex(Tt.slice(0,At),Ht),bt=xt.multiplyUnsafe($t)}catch{return!1}if(!Ht&&kt.isSmallOrder())return!1;const It=Kt(Gt,Lt.toRawBytes(),kt.toRawBytes(),St);return Lt.add(kt.multiplyUnsafe(It)).subtract(bt).clearCofactor().equals(Et.ZERO)}return xt._setWindowSize(8),{CURVE:s,getPublicKey:Nt,sign:Yt,verify:Pt,ExtendedPoint:Et,utils:{getExtendedPublicKey:zt,randomPrivateKey:()=>nt(a.BYTES),precompute(Tt=8,St=Et.BASE){return St._setWindowSize(Tt),St.multiply(BigInt(3)),St}}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$1=BigInt(0),_1n$3=BigInt(1);function validateOpts$1(o){return validateObject(o,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...o})}function montgomery(o){const s=validateOpts$1(o),{P:a}=s,et=yt=>mod(yt,a),tt=s.montgomeryBits,rt=Math.ceil(tt/8),nt=s.nByteLength,it=s.adjustScalarBytes||(yt=>yt),st=s.powPminus2||(yt=>pow(yt,a-BigInt(2),a));function ot(yt,vt,Et){const xt=et(yt*(vt-Et));return vt=et(vt-xt),Et=et(Et+xt),[vt,Et]}function at(yt){if(typeof yt=="bigint"&&_0n$1<=yt&&yt<a)return yt;throw new Error("Expected valid scalar 0 < scalar < CURVE.P")}const lt=(s.a-BigInt(2))/BigInt(4);function ct(yt,vt){const Et=at(yt),xt=at(vt),wt=Et;let Rt=_1n$3,Ct=_0n$1,Ft=Et,zt=_1n$3,Nt=_0n$1,Kt;for(let Bt=BigInt(tt-1);Bt>=_0n$1;Bt--){const Pt=xt>>Bt&_1n$3;Nt^=Pt,Kt=ot(Nt,Rt,Ft),Rt=Kt[0],Ft=Kt[1],Kt=ot(Nt,Ct,zt),Ct=Kt[0],zt=Kt[1],Nt=Pt;const Dt=Rt+Ct,Tt=et(Dt*Dt),St=Rt-Ct,Mt=et(St*St),jt=Tt-Mt,Gt=Ft+zt,Ht=Ft-zt,At=et(Ht*Dt),$t=et(Gt*St),kt=At+$t,Lt=At-$t;Ft=et(kt*kt),zt=et(wt*et(Lt*Lt)),Rt=et(Tt*Mt),Ct=et(jt*(Tt+et(lt*jt)))}Kt=ot(Nt,Rt,Ft),Rt=Kt[0],Ft=Kt[1],Kt=ot(Nt,Ct,zt),Ct=Kt[0],zt=Kt[1];const Yt=st(Ct);return et(Rt*Yt)}function ht(yt){return numberToBytesLE(et(yt),rt)}function ft(yt){const vt=ensureBytes$1("u coordinate",yt,rt);return nt===32&&(vt[31]&=127),bytesToNumberLE(vt)}function dt(yt){const vt=ensureBytes$1("scalar",yt),Et=vt.length;if(Et!==rt&&Et!==nt)throw new Error(`Expected ${rt} or ${nt} bytes, got ${Et}`);return bytesToNumberLE(it(vt))}function pt(yt,vt){const Et=ft(vt),xt=dt(yt),wt=ct(Et,xt);if(wt===_0n$1)throw new Error("Invalid private or public key received");return ht(wt)}const gt=ht(s.Gu);function mt(yt){return pt(yt,gt)}return{scalarMult:pt,scalarMultBase:mt,getSharedSecret:(yt,vt)=>pt(yt,vt),getPublicKey:yt=>mt(yt),utils:{randomPrivateKey:()=>s.randomBytes(s.nByteLength)},GuBytes:gt}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ED25519_P=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),ED25519_SQRT_M1=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const _1n$2=BigInt(1),_2n$1=BigInt(2),_5n=BigInt(5),_10n=BigInt(10),_20n=BigInt(20),_40n=BigInt(40),_80n=BigInt(80);function ed25519_pow_2_252_3(o){const s=ED25519_P,et=o*o%s*o%s,tt=pow2(et,_2n$1,s)*et%s,rt=pow2(tt,_1n$2,s)*o%s,nt=pow2(rt,_5n,s)*rt%s,it=pow2(nt,_10n,s)*nt%s,st=pow2(it,_20n,s)*it%s,ot=pow2(st,_40n,s)*st%s,at=pow2(ot,_80n,s)*ot%s,lt=pow2(at,_80n,s)*ot%s,ct=pow2(lt,_10n,s)*nt%s;return{pow_p_5_8:pow2(ct,_2n$1,s)*o%s,b2:et}}function adjustScalarBytes(o){return o[0]&=248,o[31]&=127,o[31]|=64,o}function uvRatio(o,s){const a=ED25519_P,et=mod(s*s*s,a),tt=mod(et*et*s,a),rt=ed25519_pow_2_252_3(o*tt).pow_p_5_8;let nt=mod(o*et*rt,a);const it=mod(s*nt*nt,a),st=nt,ot=mod(nt*ED25519_SQRT_M1,a),at=it===o,lt=it===mod(-o,a),ct=it===mod(-o*ED25519_SQRT_M1,a);return at&&(nt=st),(lt||ct)&&(nt=ot),isNegativeLE(nt,a)&&(nt=mod(-nt,a)),{isValid:at||lt,value:nt}}const Fp$1=Field(ED25519_P,void 0,!0),ed25519Defaults={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Fp$1,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:sha512,randomBytes:randomBytes$1,adjustScalarBytes,uvRatio},ed25519=twistedEdwards(ed25519Defaults);function ed25519_domain(o,s,a){if(s.length>255)throw new Error("Context is too big");return concatBytes$1(utf8ToBytes$3("SigEd25519 no Ed25519 collisions"),new Uint8Array([a?1:0,s.length]),s,o)}({...ed25519Defaults});({...ed25519Defaults});const x25519=montgomery({P:ED25519_P,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:o=>{const s=ED25519_P,{pow_p_5_8:a,b2:et}=ed25519_pow_2_252_3(o);return mod(pow2(a,BigInt(3),s)*et,s)},adjustScalarBytes,randomBytes:randomBytes$1}),ELL2_C1=(Fp$1.ORDER+BigInt(3))/BigInt(8);Fp$1.pow(_2n$1,ELL2_C1);Fp$1.sqrt(Fp$1.neg(Fp$1.ONE));(Fp$1.ORDER-BigInt(5))/BigInt(8);BigInt(486662);FpSqrtEven(Fp$1,Fp$1.neg(BigInt(486664)));BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235");BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578");BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838");BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");const PUBLIC_KEY_BYTE_LENGTH=32,PRIVATE_KEY_BYTE_LENGTH=64,KEYS_BYTE_LENGTH=32;function generateKey$2(){const o=ed25519.utils.randomPrivateKey(),s=ed25519.getPublicKey(o);return{privateKey:concatKeys(o,s),publicKey:s}}function generateKeyFromSeed(o){if(o.length!==KEYS_BYTE_LENGTH)throw new TypeError('"seed" must be 32 bytes in length.');if(!(o instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const s=o,a=ed25519.getPublicKey(s);return{privateKey:concatKeys(s,a),publicKey:a}}function hashAndSign$2(o,s){const a=o.subarray(0,KEYS_BYTE_LENGTH);return ed25519.sign(s instanceof Uint8Array?s:s.subarray(),a)}function hashAndVerify$2(o,s,a){return ed25519.verify(s,a instanceof Uint8Array?a:a.subarray(),o)}function concatKeys(o,s){const a=new Uint8Array(PRIVATE_KEY_BYTE_LENGTH);for(let et=0;et<KEYS_BYTE_LENGTH;et++)a[et]=o[et],a[KEYS_BYTE_LENGTH+et]=s[et];return a}const derivedEmptyPasswordKey={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};function create(o){const s="AES-GCM";let a=16;const et=12,tt="SHA-256",rt=16,nt=32767,it=webcrypto.get();a*=8;async function st(lt,ct){const ht=it.getRandomValues(new Uint8Array(rt)),ft=it.getRandomValues(new Uint8Array(et)),dt={name:s,iv:ft};typeof ct=="string"&&(ct=fromString$p(ct));let pt;if(ct.length===0){pt=await it.subtle.importKey("jwk",derivedEmptyPasswordKey,{name:"AES-GCM"},!0,["encrypt"]);try{const mt={name:"PBKDF2",salt:ht,iterations:nt,hash:{name:tt}},yt=await it.subtle.importKey("raw",ct,{name:"PBKDF2"},!1,["deriveKey"]);pt=await it.subtle.deriveKey(mt,yt,{name:s,length:a},!0,["encrypt"])}catch{pt=await it.subtle.importKey("jwk",derivedEmptyPasswordKey,{name:"AES-GCM"},!0,["encrypt"])}}else{const mt={name:"PBKDF2",salt:ht,iterations:nt,hash:{name:tt}},yt=await it.subtle.importKey("raw",ct,{name:"PBKDF2"},!1,["deriveKey"]);pt=await it.subtle.deriveKey(mt,yt,{name:s,length:a},!0,["encrypt"])}const gt=await it.subtle.encrypt(dt,pt,lt);return concat$c([ht,dt.iv,new Uint8Array(gt)])}async function ot(lt,ct){const ht=lt.subarray(0,rt),ft=lt.subarray(rt,rt+et),dt=lt.subarray(rt+et),pt={name:s,iv:ft};typeof ct=="string"&&(ct=fromString$p(ct));let gt;if(ct.length===0)try{const yt={name:"PBKDF2",salt:ht,iterations:nt,hash:{name:tt}},vt=await it.subtle.importKey("raw",ct,{name:"PBKDF2"},!1,["deriveKey"]);gt=await it.subtle.deriveKey(yt,vt,{name:s,length:a},!0,["decrypt"])}catch{gt=await it.subtle.importKey("jwk",derivedEmptyPasswordKey,{name:"AES-GCM"},!0,["decrypt"])}else{const yt={name:"PBKDF2",salt:ht,iterations:nt,hash:{name:tt}},vt=await it.subtle.importKey("raw",ct,{name:"PBKDF2"},!1,["deriveKey"]);gt=await it.subtle.deriveKey(yt,vt,{name:s,length:a},!0,["decrypt"])}const mt=await it.subtle.decrypt(pt,gt,dt);return new Uint8Array(mt)}return{encrypt:st,decrypt:ot}}async function exporter$1(o,s){const et=await create().encrypt(o,s);return base64.encode(et)}var KeyType;(function(o){o.RSA="RSA",o.Ed25519="Ed25519",o.Secp256k1="Secp256k1"})(KeyType||(KeyType={}));var __KeyTypeValues;(function(o){o[o.RSA=0]="RSA",o[o.Ed25519=1]="Ed25519",o[o.Secp256k1=2]="Secp256k1"})(__KeyTypeValues||(__KeyTypeValues={}));(function(o){o.codec=()=>enumeration(__KeyTypeValues)})(KeyType||(KeyType={}));var PublicKey;(function(o){let s;o.codec=()=>(s==null&&(s=message((a,et,tt={})=>{tt.lengthDelimited!==!1&&et.fork(),a.Type!=null&&(et.uint32(8),KeyType.codec().encode(a.Type,et)),a.Data!=null&&(et.uint32(18),et.bytes(a.Data)),tt.lengthDelimited!==!1&&et.ldelim()},(a,et)=>{const tt={},rt=et==null?a.len:a.pos+et;for(;a.pos<rt;){const nt=a.uint32();switch(nt>>>3){case 1:tt.Type=KeyType.codec().decode(a);break;case 2:tt.Data=a.bytes();break;default:a.skipType(nt&7);break}}return tt})),s),o.encode=a=>encodeMessage(a,o.codec()),o.decode=a=>decodeMessage(a,o.codec())})(PublicKey||(PublicKey={}));var PrivateKey;(function(o){let s;o.codec=()=>(s==null&&(s=message((a,et,tt={})=>{tt.lengthDelimited!==!1&&et.fork(),a.Type!=null&&(et.uint32(8),KeyType.codec().encode(a.Type,et)),a.Data!=null&&(et.uint32(18),et.bytes(a.Data)),tt.lengthDelimited!==!1&&et.ldelim()},(a,et)=>{const tt={},rt=et==null?a.len:a.pos+et;for(;a.pos<rt;){const nt=a.uint32();switch(nt>>>3){case 1:tt.Type=KeyType.codec().decode(a);break;case 2:tt.Data=a.bytes();break;default:a.skipType(nt&7);break}}return tt})),s),o.encode=a=>encodeMessage(a,o.codec()),o.decode=a=>decodeMessage(a,o.codec())})(PrivateKey||(PrivateKey={}));class Ed25519PublicKey{_key;constructor(s){this._key=ensureKey(s,PUBLIC_KEY_BYTE_LENGTH)}verify(s,a){return hashAndVerify$2(this._key,a,s)}marshal(){return this._key}get bytes(){return PublicKey.encode({Type:KeyType.Ed25519,Data:this.marshal()}).subarray()}equals(s){return equals$e(this.bytes,s.bytes)}hash(){const s=sha256$1.digest(this.bytes);return isPromise$6(s)?s.then(({bytes:a})=>a):s.bytes}}class Ed25519PrivateKey{_key;_publicKey;constructor(s,a){this._key=ensureKey(s,PRIVATE_KEY_BYTE_LENGTH),this._publicKey=ensureKey(a,PUBLIC_KEY_BYTE_LENGTH)}sign(s){return hashAndSign$2(this._key,s)}get public(){return new Ed25519PublicKey(this._publicKey)}marshal(){return this._key}get bytes(){return PrivateKey.encode({Type:KeyType.Ed25519,Data:this.marshal()}).subarray()}equals(s){return equals$e(this.bytes,s.bytes)}async hash(){const s=sha256$1.digest(this.bytes);let a;return isPromise$6(s)?{bytes:a}=await s:a=s.bytes,a}async id(){const s=identity$1.digest(this.public.bytes);return base58btc.encode(s.bytes).substring(1)}async export(s,a="libp2p-key"){if(a==="libp2p-key")return exporter$1(this.bytes,s);throw new CodeError$3(`export format '${a}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function unmarshalEd25519PrivateKey(o){if(o.length>PRIVATE_KEY_BYTE_LENGTH){o=ensureKey(o,PRIVATE_KEY_BYTE_LENGTH+PUBLIC_KEY_BYTE_LENGTH);const et=o.subarray(0,PRIVATE_KEY_BYTE_LENGTH),tt=o.subarray(PRIVATE_KEY_BYTE_LENGTH,o.length);return new Ed25519PrivateKey(et,tt)}o=ensureKey(o,PRIVATE_KEY_BYTE_LENGTH);const s=o.subarray(0,PRIVATE_KEY_BYTE_LENGTH),a=o.subarray(PUBLIC_KEY_BYTE_LENGTH);return new Ed25519PrivateKey(s,a)}function unmarshalEd25519PublicKey(o){return o=ensureKey(o,PUBLIC_KEY_BYTE_LENGTH),new Ed25519PublicKey(o)}async function generateKeyPair$3(){const{privateKey:o,publicKey:s}=generateKey$2();return new Ed25519PrivateKey(o,s)}async function generateKeyPairFromSeed(o){const{privateKey:s,publicKey:a}=generateKeyFromSeed(o);return new Ed25519PrivateKey(s,a)}function ensureKey(o,s){if(o=Uint8Array.from(o??[]),o.length!==s)throw new CodeError$3(`Key must be a Uint8Array of length ${s}, got ${o.length}`,"ERR_INVALID_KEY_TYPE");return o}const Ed25519=Object.freeze(Object.defineProperty({__proto__:null,Ed25519PrivateKey,Ed25519PublicKey,generateKeyPair:generateKeyPair$3,generateKeyPairFromSeed,unmarshalEd25519PrivateKey,unmarshalEd25519PublicKey},Symbol.toStringTag,{value:"Module"}));function toString$i(o,s="utf8"){const a=BASES$o[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.encoder.encode(o).substring(1)}async function importer$1(o,s){const a=base64.decode(o);return create().decrypt(a,s)}function randomBytes(o){if(isNaN(o)||o<=0)throw new CodeError$3("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return randomBytes$1(o)}class HMAC extends Hash{constructor(s,a){super(),this.finished=!1,this.destroyed=!1,hash$2(s);const et=toBytes$2(a);if(this.iHash=s.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const tt=this.blockLen,rt=new Uint8Array(tt);rt.set(et.length>tt?s.create().update(et).digest():et);for(let nt=0;nt<rt.length;nt++)rt[nt]^=54;this.iHash.update(rt),this.oHash=s.create();for(let nt=0;nt<rt.length;nt++)rt[nt]^=106;this.oHash.update(rt),rt.fill(0)}update(s){return exists$2(this),this.iHash.update(s),this}digestInto(s){exists$2(this),bytes$1(s,this.outputLen),this.finished=!0,this.iHash.digestInto(s),this.oHash.update(s),this.oHash.digestInto(s),this.destroy()}digest(){const s=new Uint8Array(this.oHash.outputLen);return this.digestInto(s),s}_cloneInto(s){s||(s=Object.create(Object.getPrototypeOf(this),{}));const{oHash:a,iHash:et,finished:tt,destroyed:rt,blockLen:nt,outputLen:it}=this;return s=s,s.finished=tt,s.destroyed=rt,s.blockLen=nt,s.outputLen=it,s.oHash=a._cloneInto(s.oHash),s.iHash=et._cloneInto(s.iHash),s}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const hmac=(o,s,a)=>new HMAC(o,s).update(a).digest();hmac.create=(o,s)=>new HMAC(o,s);function pbkdf2Init(o,s,a,et){hash$2(o);const tt=checkOpts$1({dkLen:32,asyncTick:10},et),{c:rt,dkLen:nt,asyncTick:it}=tt;if(number$2(rt),number$2(nt),number$2(it),rt<1)throw new Error("PBKDF2: iterations (c) should be >= 1");const st=toBytes$2(s),ot=toBytes$2(a),at=new Uint8Array(nt),lt=hmac.create(o,st),ct=lt._cloneInto().update(ot);return{c:rt,dkLen:nt,asyncTick:it,DK:at,PRF:lt,PRFSalt:ct}}function pbkdf2Output(o,s,a,et,tt){return o.destroy(),s.destroy(),et&&et.destroy(),tt.fill(0),a}function pbkdf2$1(o,s,a,et){const{c:tt,dkLen:rt,DK:nt,PRF:it,PRFSalt:st}=pbkdf2Init(o,s,a,et);let ot;const at=new Uint8Array(4),lt=createView$1(at),ct=new Uint8Array(it.outputLen);for(let ht=1,ft=0;ft<rt;ht++,ft+=it.outputLen){const dt=nt.subarray(ft,ft+it.outputLen);lt.setInt32(0,ht,!1),(ot=st._cloneInto(ot)).update(at).digestInto(ct),dt.set(ct.subarray(0,dt.length));for(let pt=1;pt<tt;pt++){it._cloneInto(ot).update(ct).digestInto(ct);for(let gt=0;gt<dt.length;gt++)dt[gt]^=ct[gt]}}return pbkdf2Output(it,st,nt,ot,ct)}async function pbkdf2Async(o,s,a,et){const{c:tt,dkLen:rt,asyncTick:nt,DK:it,PRF:st,PRFSalt:ot}=pbkdf2Init(o,s,a,et);let at;const lt=new Uint8Array(4),ct=createView$1(lt),ht=new Uint8Array(st.outputLen);for(let ft=1,dt=0;dt<rt;ft++,dt+=st.outputLen){const pt=it.subarray(dt,dt+st.outputLen);ct.setInt32(0,ft,!1),(at=ot._cloneInto(at)).update(lt).digestInto(ht),pt.set(ht.subarray(0,pt.length)),await asyncLoop(tt-1,nt,()=>{st._cloneInto(at).update(ht).digestInto(ht);for(let gt=0;gt<pt.length;gt++)pt[gt]^=ht[gt]})}return pbkdf2Output(st,ot,it,at,ht)}/*!
 * MIT License
 * 
 * Copyright (c) 2017-2022 Peculiar Ventures, LLC
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const ARRAY_BUFFER_NAME="[object ArrayBuffer]";class BufferSourceConverter{static isArrayBuffer(s){return Object.prototype.toString.call(s)===ARRAY_BUFFER_NAME}static toArrayBuffer(s){return this.isArrayBuffer(s)?s:s.byteLength===s.buffer.byteLength||s.byteOffset===0&&s.byteLength===s.buffer.byteLength?s.buffer:this.toUint8Array(s.buffer).slice(s.byteOffset,s.byteOffset+s.byteLength).buffer}static toUint8Array(s){return this.toView(s,Uint8Array)}static toView(s,a){if(s.constructor===a)return s;if(this.isArrayBuffer(s))return new a(s);if(this.isArrayBufferView(s))return new a(s.buffer,s.byteOffset,s.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(s){return this.isArrayBufferView(s)||this.isArrayBuffer(s)}static isArrayBufferView(s){return ArrayBuffer.isView(s)||s&&this.isArrayBuffer(s.buffer)}static isEqual(s,a){const et=BufferSourceConverter.toUint8Array(s),tt=BufferSourceConverter.toUint8Array(a);if(et.length!==tt.byteLength)return!1;for(let rt=0;rt<et.length;rt++)if(et[rt]!==tt[rt])return!1;return!0}static concat(...s){let a;Array.isArray(s[0])&&!(s[1]instanceof Function)||Array.isArray(s[0])&&s[1]instanceof Function?a=s[0]:s[s.length-1]instanceof Function?a=s.slice(0,s.length-1):a=s;let et=0;for(const nt of a)et+=nt.byteLength;const tt=new Uint8Array(et);let rt=0;for(const nt of a){const it=this.toUint8Array(nt);tt.set(it,rt),rt+=it.length}return s[s.length-1]instanceof Function?this.toView(tt,s[s.length-1]):tt.buffer}}const STRING_TYPE="string",HEX_REGEX=/^[0-9a-f]+$/i,BASE64_REGEX=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,BASE64URL_REGEX=/^[a-zA-Z0-9-_]+$/;class Utf8Converter{static fromString(s){const a=unescape(encodeURIComponent(s)),et=new Uint8Array(a.length);for(let tt=0;tt<a.length;tt++)et[tt]=a.charCodeAt(tt);return et.buffer}static toString(s){const a=BufferSourceConverter.toUint8Array(s);let et="";for(let rt=0;rt<a.length;rt++)et+=String.fromCharCode(a[rt]);return decodeURIComponent(escape(et))}}class Utf16Converter{static toString(s,a=!1){const et=BufferSourceConverter.toArrayBuffer(s),tt=new DataView(et);let rt="";for(let nt=0;nt<et.byteLength;nt+=2){const it=tt.getUint16(nt,a);rt+=String.fromCharCode(it)}return rt}static fromString(s,a=!1){const et=new ArrayBuffer(s.length*2),tt=new DataView(et);for(let rt=0;rt<s.length;rt++)tt.setUint16(rt*2,s.charCodeAt(rt),a);return et}}class Convert{static isHex(s){return typeof s===STRING_TYPE&&HEX_REGEX.test(s)}static isBase64(s){return typeof s===STRING_TYPE&&BASE64_REGEX.test(s)}static isBase64Url(s){return typeof s===STRING_TYPE&&BASE64URL_REGEX.test(s)}static ToString(s,a="utf8"){const et=BufferSourceConverter.toUint8Array(s);switch(a.toLowerCase()){case"utf8":return this.ToUtf8String(et);case"binary":return this.ToBinary(et);case"hex":return this.ToHex(et);case"base64":return this.ToBase64(et);case"base64url":return this.ToBase64Url(et);case"utf16le":return Utf16Converter.toString(et,!0);case"utf16":case"utf16be":return Utf16Converter.toString(et);default:throw new Error(`Unknown type of encoding '${a}'`)}}static FromString(s,a="utf8"){if(!s)return new ArrayBuffer(0);switch(a.toLowerCase()){case"utf8":return this.FromUtf8String(s);case"binary":return this.FromBinary(s);case"hex":return this.FromHex(s);case"base64":return this.FromBase64(s);case"base64url":return this.FromBase64Url(s);case"utf16le":return Utf16Converter.fromString(s,!0);case"utf16":case"utf16be":return Utf16Converter.fromString(s);default:throw new Error(`Unknown type of encoding '${a}'`)}}static ToBase64(s){const a=BufferSourceConverter.toUint8Array(s);if(typeof btoa<"u"){const et=this.ToString(a,"binary");return btoa(et)}else return Buffer$2.from(a).toString("base64")}static FromBase64(s){const a=this.formatString(s);if(!a)return new ArrayBuffer(0);if(!Convert.isBase64(a))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(a)):new Uint8Array(Buffer$2.from(a,"base64")).buffer}static FromBase64Url(s){const a=this.formatString(s);if(!a)return new ArrayBuffer(0);if(!Convert.isBase64Url(a))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(a.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(s){return this.ToBase64(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(s,a=Convert.DEFAULT_UTF8_ENCODING){switch(a){case"ascii":return this.FromBinary(s);case"utf8":return Utf8Converter.fromString(s);case"utf16":case"utf16be":return Utf16Converter.fromString(s);case"utf16le":case"usc2":return Utf16Converter.fromString(s,!0);default:throw new Error(`Unknown type of encoding '${a}'`)}}static ToUtf8String(s,a=Convert.DEFAULT_UTF8_ENCODING){switch(a){case"ascii":return this.ToBinary(s);case"utf8":return Utf8Converter.toString(s);case"utf16":case"utf16be":return Utf16Converter.toString(s);case"utf16le":case"usc2":return Utf16Converter.toString(s,!0);default:throw new Error(`Unknown type of encoding '${a}'`)}}static FromBinary(s){const a=s.length,et=new Uint8Array(a);for(let tt=0;tt<a;tt++)et[tt]=s.charCodeAt(tt);return et.buffer}static ToBinary(s){const a=BufferSourceConverter.toUint8Array(s);let et="";for(let tt=0;tt<a.length;tt++)et+=String.fromCharCode(a[tt]);return et}static ToHex(s){const a=BufferSourceConverter.toUint8Array(s);let et="";const tt=a.length;for(let rt=0;rt<tt;rt++){const nt=a[rt];nt<16&&(et+="0"),et+=nt.toString(16)}return et}static FromHex(s){let a=this.formatString(s);if(!a)return new ArrayBuffer(0);if(!Convert.isHex(a))throw new TypeError("Argument 'hexString' is not HEX encoded");a.length%2&&(a=`0${a}`);const et=new Uint8Array(a.length/2);for(let tt=0;tt<a.length;tt=tt+2){const rt=a.slice(tt,tt+2);et[tt/2]=parseInt(rt,16)}return et.buffer}static ToUtf16String(s,a=!1){return Utf16Converter.toString(s,a)}static FromUtf16String(s,a=!1){return Utf16Converter.fromString(s,a)}static Base64Padding(s){const a=4-s.length%4;if(a<4)for(let et=0;et<a;et++)s+="=";return s}static formatString(s){return s?.replace(/[\n\r\t ]/g,"")||""}}Convert.DEFAULT_UTF8_ENCODING="utf8";/*!
 Copyright (c) Peculiar Ventures, LLC
*/function utilFromBase(o,s){let a=0;if(o.length===1)return o[0];for(let et=o.length-1;et>=0;et--)a+=o[o.length-1-et]*Math.pow(2,s*et);return a}function utilToBase(o,s,a=-1){const et=a;let tt=o,rt=0,nt=Math.pow(2,s);for(let it=1;it<8;it++){if(o<nt){let st;if(et<0)st=new ArrayBuffer(it),rt=it;else{if(et<it)return new ArrayBuffer(0);st=new ArrayBuffer(et),rt=et}const ot=new Uint8Array(st);for(let at=it-1;at>=0;at--){const lt=Math.pow(2,at*s);ot[rt-at-1]=Math.floor(tt/lt),tt-=ot[rt-at-1]*lt}return st}nt*=Math.pow(2,s)}return new ArrayBuffer(0)}function utilConcatView(...o){let s=0,a=0;for(const rt of o)s+=rt.length;const et=new ArrayBuffer(s),tt=new Uint8Array(et);for(const rt of o)tt.set(rt,a),a+=rt.length;return tt}function utilDecodeTC(){const o=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const it=o[0]===255&&o[1]&128,st=o[0]===0&&(o[1]&128)===0;(it||st)&&this.warnings.push("Needlessly long format")}const s=new ArrayBuffer(this.valueHex.byteLength),a=new Uint8Array(s);for(let it=0;it<this.valueHex.byteLength;it++)a[it]=0;a[0]=o[0]&128;const et=utilFromBase(a,8),tt=new ArrayBuffer(this.valueHex.byteLength),rt=new Uint8Array(tt);for(let it=0;it<this.valueHex.byteLength;it++)rt[it]=o[it];return rt[0]&=127,utilFromBase(rt,8)-et}function utilEncodeTC(o){const s=o<0?o*-1:o;let a=128;for(let et=1;et<8;et++){if(s<=a){if(o<0){const nt=a-s,it=utilToBase(nt,8,et),st=new Uint8Array(it);return st[0]|=128,it}let tt=utilToBase(s,8,et),rt=new Uint8Array(tt);if(rt[0]&128){const nt=tt.slice(0),it=new Uint8Array(nt);tt=new ArrayBuffer(tt.byteLength+1),rt=new Uint8Array(tt);for(let st=0;st<nt.byteLength;st++)rt[st+1]=it[st];rt[0]=0}return tt}a*=Math.pow(2,8)}return new ArrayBuffer(0)}function isEqualBuffer(o,s){if(o.byteLength!==s.byteLength)return!1;const a=new Uint8Array(o),et=new Uint8Array(s);for(let tt=0;tt<a.length;tt++)if(a[tt]!==et[tt])return!1;return!0}function padNumber(o,s){const a=o.toString(10);if(s<a.length)return"";const et=s-a.length,tt=new Array(et);for(let nt=0;nt<et;nt++)tt[nt]="0";return tt.join("").concat(a)}/*!
 * Copyright (c) 2014, GMO GlobalSign
 * Copyright (c) 2015-2022, Peculiar Ventures
 * All rights reserved.
 * 
 * Author 2014-2019, Yury Strozhevsky
 * 
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 * 
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 * 
 * * Redistributions in binary form must reproduce the above copyright notice, this
 *   list of conditions and the following disclaimer in the documentation and/or
 *   other materials provided with the distribution.
 * 
 * * Neither the name of the copyright holder nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 * 
 */function assertBigInt(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function concat$b(o){let s=0,a=0;for(let tt=0;tt<o.length;tt++){const rt=o[tt];s+=rt.byteLength}const et=new Uint8Array(s);for(let tt=0;tt<o.length;tt++){const rt=o[tt];et.set(new Uint8Array(rt),a),a+=rt.byteLength}return et.buffer}function checkBufferParams(o,s,a,et){return s instanceof Uint8Array?s.byteLength?a<0?(o.error="Wrong parameter: inputOffset less than zero",!1):et<0?(o.error="Wrong parameter: inputLength less than zero",!1):s.byteLength-a-et<0?(o.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(o.error="Wrong parameter: inputBuffer has zero length",!1):(o.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class ViewWriter{constructor(){this.items=[]}write(s){this.items.push(s)}final(){return concat$b(this.items)}}const powers2=[new Uint8Array([1])],digitsString="0123456789",EMPTY_STRING="",EMPTY_BUFFER$1=new ArrayBuffer(0),EMPTY_VIEW=new Uint8Array(0),END_OF_CONTENT_NAME="EndOfContent",OCTET_STRING_NAME="OCTET STRING",BIT_STRING_NAME="BIT STRING";function HexBlock(o){var s;return s=class extends o{constructor(...et){var tt;super(...et);const rt=et[0]||{};this.isHexOnly=(tt=rt.isHexOnly)!==null&&tt!==void 0?tt:!1,this.valueHexView=rt.valueHex?BufferSourceConverter.toUint8Array(rt.valueHex):EMPTY_VIEW}get valueHex(){return this.valueHexView.slice().buffer}set valueHex(et){this.valueHexView=new Uint8Array(et)}fromBER(et,tt,rt){const nt=et instanceof ArrayBuffer?new Uint8Array(et):et;if(!checkBufferParams(this,nt,tt,rt))return-1;const it=tt+rt;return this.valueHexView=nt.subarray(tt,it),this.valueHexView.length?(this.blockLength=rt,it):(this.warnings.push("Zero buffer length"),tt)}toBER(et=!1){return this.isHexOnly?et?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",EMPTY_BUFFER$1)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:Convert.ToHex(this.valueHexView)}}},s.NAME="hexBlock",s}class LocalBaseBlock{constructor({blockLength:s=0,error:a=EMPTY_STRING,warnings:et=[],valueBeforeDecode:tt=EMPTY_VIEW}={}){this.blockLength=s,this.error=a,this.warnings=et,this.valueBeforeDecodeView=BufferSourceConverter.toUint8Array(tt)}static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(s){this.valueBeforeDecodeView=new Uint8Array(s)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:Convert.ToHex(this.valueBeforeDecodeView)}}}LocalBaseBlock.NAME="baseBlock";class ValueBlock extends LocalBaseBlock{fromBER(s,a,et){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(s,a){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}ValueBlock.NAME="valueBlock";class LocalIdentificationBlock extends HexBlock(LocalBaseBlock){constructor({idBlock:s={}}={}){var a,et,tt,rt;super(),s?(this.isHexOnly=(a=s.isHexOnly)!==null&&a!==void 0?a:!1,this.valueHexView=s.valueHex?BufferSourceConverter.toUint8Array(s.valueHex):EMPTY_VIEW,this.tagClass=(et=s.tagClass)!==null&&et!==void 0?et:-1,this.tagNumber=(tt=s.tagNumber)!==null&&tt!==void 0?tt:-1,this.isConstructed=(rt=s.isConstructed)!==null&&rt!==void 0?rt:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(s=!1){let a=0;switch(this.tagClass){case 1:a|=0;break;case 2:a|=64;break;case 3:a|=128;break;case 4:a|=192;break;default:return this.error="Unknown tag class",EMPTY_BUFFER$1}if(this.isConstructed&&(a|=32),this.tagNumber<31&&!this.isHexOnly){const tt=new Uint8Array(1);if(!s){let rt=this.tagNumber;rt&=31,a|=rt,tt[0]=a}return tt.buffer}if(!this.isHexOnly){const tt=utilToBase(this.tagNumber,7),rt=new Uint8Array(tt),nt=tt.byteLength,it=new Uint8Array(nt+1);if(it[0]=a|31,!s){for(let st=0;st<nt-1;st++)it[st+1]=rt[st]|128;it[nt]=rt[nt-1]}return it.buffer}const et=new Uint8Array(this.valueHexView.byteLength+1);if(et[0]=a|31,!s){const tt=this.valueHexView;for(let rt=0;rt<tt.length-1;rt++)et[rt+1]=tt[rt]|128;et[this.valueHexView.byteLength]=tt[tt.length-1]}return et.buffer}fromBER(s,a,et){const tt=BufferSourceConverter.toUint8Array(s);if(!checkBufferParams(this,tt,a,et))return-1;const rt=tt.subarray(a,a+et);if(rt.length===0)return this.error="Zero buffer length",-1;switch(rt[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(rt[0]&32)===32,this.isHexOnly=!1;const it=rt[0]&31;if(it!==31)this.tagNumber=it,this.blockLength=1;else{let st=1,ot=this.valueHexView=new Uint8Array(255),at=255;for(;rt[st]&128;){if(ot[st-1]=rt[st]&127,st++,st>=rt.length)return this.error="End of input reached before message was fully decoded",-1;if(st===at){at+=255;const ct=new Uint8Array(at);for(let ht=0;ht<ot.length;ht++)ct[ht]=ot[ht];ot=this.valueHexView=new Uint8Array(at)}}this.blockLength=st+1,ot[st-1]=rt[st]&127;const lt=new Uint8Array(st);for(let ct=0;ct<st;ct++)lt[ct]=ot[ct];ot=this.valueHexView=new Uint8Array(st),ot.set(lt),this.blockLength<=9?this.tagNumber=utilFromBase(ot,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return a+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}LocalIdentificationBlock.NAME="identificationBlock";class LocalLengthBlock extends LocalBaseBlock{constructor({lenBlock:s={}}={}){var a,et,tt;super(),this.isIndefiniteForm=(a=s.isIndefiniteForm)!==null&&a!==void 0?a:!1,this.longFormUsed=(et=s.longFormUsed)!==null&&et!==void 0?et:!1,this.length=(tt=s.length)!==null&&tt!==void 0?tt:0}fromBER(s,a,et){const tt=BufferSourceConverter.toUint8Array(s);if(!checkBufferParams(this,tt,a,et))return-1;const rt=tt.subarray(a,a+et);if(rt.length===0)return this.error="Zero buffer length",-1;if(rt[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=rt[0]===128,this.isIndefiniteForm)return this.blockLength=1,a+this.blockLength;if(this.longFormUsed=!!(rt[0]&128),this.longFormUsed===!1)return this.length=rt[0],this.blockLength=1,a+this.blockLength;const nt=rt[0]&127;if(nt>8)return this.error="Too big integer",-1;if(nt+1>rt.length)return this.error="End of input reached before message was fully decoded",-1;const it=a+1,st=tt.subarray(it,it+nt);return st[nt-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=utilFromBase(st,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=nt+1,a+this.blockLength}toBER(s=!1){let a,et;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return a=new ArrayBuffer(1),s===!1&&(et=new Uint8Array(a),et[0]=128),a;if(this.longFormUsed){const tt=utilToBase(this.length,8);if(tt.byteLength>127)return this.error="Too big length",EMPTY_BUFFER$1;if(a=new ArrayBuffer(tt.byteLength+1),s)return a;const rt=new Uint8Array(tt);et=new Uint8Array(a),et[0]=tt.byteLength|128;for(let nt=0;nt<tt.byteLength;nt++)et[nt+1]=rt[nt];return a}return a=new ArrayBuffer(1),s===!1&&(et=new Uint8Array(a),et[0]=this.length),a}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}LocalLengthBlock.NAME="lengthBlock";const typeStore={};class BaseBlock extends LocalBaseBlock{constructor({name:s=EMPTY_STRING,optional:a=!1,primitiveSchema:et,...tt}={},rt){super(tt),this.name=s,this.optional=a,et&&(this.primitiveSchema=et),this.idBlock=new LocalIdentificationBlock(tt),this.lenBlock=new LocalLengthBlock(tt),this.valueBlock=rt?new rt(tt):new ValueBlock(tt)}fromBER(s,a,et){const tt=this.valueBlock.fromBER(s,a,this.lenBlock.isIndefiniteForm?et:this.lenBlock.length);return tt===-1?(this.error=this.valueBlock.error,tt):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),tt)}toBER(s,a){const et=a||new ViewWriter;a||prepareIndefiniteForm(this);const tt=this.idBlock.toBER(s);if(et.write(tt),this.lenBlock.isIndefiniteForm)et.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(s,et),et.write(new ArrayBuffer(2));else{const rt=this.valueBlock.toBER(s);this.lenBlock.length=rt.byteLength;const nt=this.lenBlock.toBER(s);et.write(nt),et.write(rt)}return a?EMPTY_BUFFER$1:et.final()}toJSON(){const s={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(s.primitiveSchema=this.primitiveSchema.toJSON()),s}toString(s="ascii"){return s==="ascii"?this.onAsciiEncoding():Convert.ToHex(this.toBER())}onAsciiEncoding(){return`${this.constructor.NAME} : ${Convert.ToHex(this.valueBlock.valueBeforeDecodeView)}`}isEqual(s){if(this===s)return!0;if(!(s instanceof this.constructor))return!1;const a=this.toBER(),et=s.toBER();return isEqualBuffer(a,et)}}BaseBlock.NAME="BaseBlock";function prepareIndefiniteForm(o){if(o instanceof typeStore.Constructed)for(const s of o.valueBlock.value)prepareIndefiniteForm(s)&&(o.lenBlock.isIndefiniteForm=!0);return!!o.lenBlock.isIndefiniteForm}class BaseStringBlock extends BaseBlock{constructor({value:s=EMPTY_STRING,...a}={},et){super(a,et),s&&this.fromString(s)}getValue(){return this.valueBlock.value}setValue(s){this.valueBlock.value=s}fromBER(s,a,et){const tt=this.valueBlock.fromBER(s,a,this.lenBlock.isIndefiniteForm?et:this.lenBlock.length);return tt===-1?(this.error=this.valueBlock.error,tt):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),tt)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}BaseStringBlock.NAME="BaseStringBlock";class LocalPrimitiveValueBlock extends HexBlock(ValueBlock){constructor({isHexOnly:s=!0,...a}={}){super(a),this.isHexOnly=s}}LocalPrimitiveValueBlock.NAME="PrimitiveValueBlock";var _a$w;class Primitive extends BaseBlock{constructor(s={}){super(s,LocalPrimitiveValueBlock),this.idBlock.isConstructed=!1}}_a$w=Primitive;typeStore.Primitive=_a$w;Primitive.NAME="PRIMITIVE";function localChangeType(o,s){if(o instanceof s)return o;const a=new s;return a.idBlock=o.idBlock,a.lenBlock=o.lenBlock,a.warnings=o.warnings,a.valueBeforeDecodeView=o.valueBeforeDecodeView,a}function localFromBER(o,s=0,a=o.length){const et=s;let tt=new BaseBlock({},ValueBlock);const rt=new LocalBaseBlock;if(!checkBufferParams(rt,o,s,a))return tt.error=rt.error,{offset:-1,result:tt};if(!o.subarray(s,s+a).length)return tt.error="Zero buffer length",{offset:-1,result:tt};let it=tt.idBlock.fromBER(o,s,a);if(tt.idBlock.warnings.length&&tt.warnings.concat(tt.idBlock.warnings),it===-1)return tt.error=tt.idBlock.error,{offset:-1,result:tt};if(s=it,a-=tt.idBlock.blockLength,it=tt.lenBlock.fromBER(o,s,a),tt.lenBlock.warnings.length&&tt.warnings.concat(tt.lenBlock.warnings),it===-1)return tt.error=tt.lenBlock.error,{offset:-1,result:tt};if(s=it,a-=tt.lenBlock.blockLength,!tt.idBlock.isConstructed&&tt.lenBlock.isIndefiniteForm)return tt.error="Indefinite length form used for primitive encoding form",{offset:-1,result:tt};let st=BaseBlock;switch(tt.idBlock.tagClass){case 1:if(tt.idBlock.tagNumber>=37&&tt.idBlock.isHexOnly===!1)return tt.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:tt};switch(tt.idBlock.tagNumber){case 0:if(tt.idBlock.isConstructed&&tt.lenBlock.length>0)return tt.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:tt};st=typeStore.EndOfContent;break;case 1:st=typeStore.Boolean;break;case 2:st=typeStore.Integer;break;case 3:st=typeStore.BitString;break;case 4:st=typeStore.OctetString;break;case 5:st=typeStore.Null;break;case 6:st=typeStore.ObjectIdentifier;break;case 10:st=typeStore.Enumerated;break;case 12:st=typeStore.Utf8String;break;case 13:st=typeStore.RelativeObjectIdentifier;break;case 14:st=typeStore.TIME;break;case 15:return tt.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:tt};case 16:st=typeStore.Sequence;break;case 17:st=typeStore.Set;break;case 18:st=typeStore.NumericString;break;case 19:st=typeStore.PrintableString;break;case 20:st=typeStore.TeletexString;break;case 21:st=typeStore.VideotexString;break;case 22:st=typeStore.IA5String;break;case 23:st=typeStore.UTCTime;break;case 24:st=typeStore.GeneralizedTime;break;case 25:st=typeStore.GraphicString;break;case 26:st=typeStore.VisibleString;break;case 27:st=typeStore.GeneralString;break;case 28:st=typeStore.UniversalString;break;case 29:st=typeStore.CharacterString;break;case 30:st=typeStore.BmpString;break;case 31:st=typeStore.DATE;break;case 32:st=typeStore.TimeOfDay;break;case 33:st=typeStore.DateTime;break;case 34:st=typeStore.Duration;break;default:{const ot=tt.idBlock.isConstructed?new typeStore.Constructed:new typeStore.Primitive;ot.idBlock=tt.idBlock,ot.lenBlock=tt.lenBlock,ot.warnings=tt.warnings,tt=ot}}break;case 2:case 3:case 4:default:st=tt.idBlock.isConstructed?typeStore.Constructed:typeStore.Primitive}return tt=localChangeType(tt,st),it=tt.fromBER(o,s,tt.lenBlock.isIndefiniteForm?a:tt.lenBlock.length),tt.valueBeforeDecodeView=o.subarray(et,et+tt.blockLength),{offset:it,result:tt}}function fromBER(o){if(!o.byteLength){const s=new BaseBlock({},ValueBlock);return s.error="Input buffer has zero length",{offset:-1,result:s}}return localFromBER(BufferSourceConverter.toUint8Array(o).slice(),0,o.byteLength)}function checkLen(o,s){return o?1:s}class LocalConstructedValueBlock extends ValueBlock{constructor({value:s=[],isIndefiniteForm:a=!1,...et}={}){super(et),this.value=s,this.isIndefiniteForm=a}fromBER(s,a,et){const tt=BufferSourceConverter.toUint8Array(s);if(!checkBufferParams(this,tt,a,et))return-1;if(this.valueBeforeDecodeView=tt.subarray(a,a+et),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),a;let rt=a;for(;checkLen(this.isIndefiniteForm,et)>0;){const nt=localFromBER(tt,rt,et);if(nt.offset===-1)return this.error=nt.result.error,this.warnings.concat(nt.result.warnings),-1;if(rt=nt.offset,this.blockLength+=nt.result.blockLength,et-=nt.result.blockLength,this.value.push(nt.result),this.isIndefiniteForm&&nt.result.constructor.NAME===END_OF_CONTENT_NAME)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===END_OF_CONTENT_NAME?this.value.pop():this.warnings.push("No EndOfContent block encoded")),rt}toBER(s,a){const et=a||new ViewWriter;for(let tt=0;tt<this.value.length;tt++)this.value[tt].toBER(s,et);return a?EMPTY_BUFFER$1:et.final()}toJSON(){const s={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(const a of this.value)s.value.push(a.toJSON());return s}}LocalConstructedValueBlock.NAME="ConstructedValueBlock";var _a$v;class Constructed extends BaseBlock{constructor(s={}){super(s,LocalConstructedValueBlock),this.idBlock.isConstructed=!0}fromBER(s,a,et){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const tt=this.valueBlock.fromBER(s,a,this.lenBlock.isIndefiniteForm?et:this.lenBlock.length);return tt===-1?(this.error=this.valueBlock.error,tt):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),tt)}onAsciiEncoding(){const s=[];for(const et of this.valueBlock.value)s.push(et.toString("ascii").split(`
`).map(tt=>`  ${tt}`).join(`
`));const a=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return s.length?`${a} :
${s.join(`
`)}`:`${a} :`}}_a$v=Constructed;typeStore.Constructed=_a$v;Constructed.NAME="CONSTRUCTED";class LocalEndOfContentValueBlock extends ValueBlock{fromBER(s,a,et){return a}toBER(s){return EMPTY_BUFFER$1}}LocalEndOfContentValueBlock.override="EndOfContentValueBlock";var _a$u;class EndOfContent extends BaseBlock{constructor(s={}){super(s,LocalEndOfContentValueBlock),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}_a$u=EndOfContent;typeStore.EndOfContent=_a$u;EndOfContent.NAME=END_OF_CONTENT_NAME;var _a$t;class Null extends BaseBlock{constructor(s={}){super(s,ValueBlock),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(s,a,et){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=et,a+et>s.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):a+et}toBER(s,a){const et=new ArrayBuffer(2);if(!s){const tt=new Uint8Array(et);tt[0]=5,tt[1]=0}return a&&a.write(et),et}onAsciiEncoding(){return`${this.constructor.NAME}`}}_a$t=Null;typeStore.Null=_a$t;Null.NAME="NULL";class LocalBooleanValueBlock extends HexBlock(ValueBlock){constructor({value:s,...a}={}){super(a),a.valueHex?this.valueHexView=BufferSourceConverter.toUint8Array(a.valueHex):this.valueHexView=new Uint8Array(1),s&&(this.value=s)}get value(){for(const s of this.valueHexView)if(s>0)return!0;return!1}set value(s){this.valueHexView[0]=s?255:0}fromBER(s,a,et){const tt=BufferSourceConverter.toUint8Array(s);return checkBufferParams(this,tt,a,et)?(this.valueHexView=tt.subarray(a,a+et),et>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,utilDecodeTC.call(this),this.blockLength=et,a+et):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}LocalBooleanValueBlock.NAME="BooleanValueBlock";var _a$s;let Boolean$1=class extends BaseBlock{constructor(s={}){super(s,LocalBooleanValueBlock),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}getValue(){return this.valueBlock.value}setValue(s){this.valueBlock.value=s}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}};_a$s=Boolean$1;typeStore.Boolean=_a$s;Boolean$1.NAME="BOOLEAN";class LocalOctetStringValueBlock extends HexBlock(LocalConstructedValueBlock){constructor({isConstructed:s=!1,...a}={}){super(a),this.isConstructed=s}fromBER(s,a,et){let tt=0;if(this.isConstructed){if(this.isHexOnly=!1,tt=LocalConstructedValueBlock.prototype.fromBER.call(this,s,a,et),tt===-1)return tt;for(let rt=0;rt<this.value.length;rt++){const nt=this.value[rt].constructor.NAME;if(nt===END_OF_CONTENT_NAME){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(nt!==OCTET_STRING_NAME)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,tt=super.fromBER(s,a,et),this.blockLength=et;return tt}toBER(s,a){return this.isConstructed?LocalConstructedValueBlock.prototype.toBER.call(this,s,a):s?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}LocalOctetStringValueBlock.NAME="OctetStringValueBlock";var _a$r;class OctetString extends BaseBlock{constructor({idBlock:s={},lenBlock:a={},...et}={}){var tt,rt;(tt=et.isConstructed)!==null&&tt!==void 0||(et.isConstructed=!!(!((rt=et.value)===null||rt===void 0)&&rt.length)),super({idBlock:{isConstructed:et.isConstructed,...s},lenBlock:{...a,isIndefiniteForm:!!et.isIndefiniteForm},...et},LocalOctetStringValueBlock),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(s,a,et){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,et===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),a;if(!this.valueBlock.isConstructed){const rt=(s instanceof ArrayBuffer?new Uint8Array(s):s).subarray(a,a+et);try{if(rt.byteLength){const nt=localFromBER(rt,0,rt.byteLength);nt.offset!==-1&&nt.offset===et&&(this.valueBlock.value=[nt.result])}}catch{}}return super.fromBER(s,a,et)}onAsciiEncoding(){return this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length?Constructed.prototype.onAsciiEncoding.call(this):`${this.constructor.NAME} : ${Convert.ToHex(this.valueBlock.valueHexView)}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;const s=[];for(const a of this.valueBlock.value)a instanceof OctetString&&s.push(a.valueBlock.valueHexView);return BufferSourceConverter.concat(s)}}_a$r=OctetString;typeStore.OctetString=_a$r;OctetString.NAME=OCTET_STRING_NAME;class LocalBitStringValueBlock extends HexBlock(LocalConstructedValueBlock){constructor({unusedBits:s=0,isConstructed:a=!1,...et}={}){super(et),this.unusedBits=s,this.isConstructed=a,this.blockLength=this.valueHexView.byteLength}fromBER(s,a,et){if(!et)return a;let tt=-1;if(this.isConstructed){if(tt=LocalConstructedValueBlock.prototype.fromBER.call(this,s,a,et),tt===-1)return tt;for(const it of this.value){const st=it.constructor.NAME;if(st===END_OF_CONTENT_NAME){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(st!==BIT_STRING_NAME)return this.error="BIT STRING may consists of BIT STRINGs only",-1;const ot=it.valueBlock;if(this.unusedBits>0&&ot.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=ot.unusedBits}return tt}const rt=BufferSourceConverter.toUint8Array(s);if(!checkBufferParams(this,rt,a,et))return-1;const nt=rt.subarray(a,a+et);if(this.unusedBits=nt[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){const it=nt.subarray(1);try{if(it.byteLength){const st=localFromBER(it,0,it.byteLength);st.offset!==-1&&st.offset===et-1&&(this.value=[st.result])}}catch{}}return this.valueHexView=nt.subarray(1),this.blockLength=nt.length,a+et}toBER(s,a){if(this.isConstructed)return LocalConstructedValueBlock.prototype.toBER.call(this,s,a);if(s)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return EMPTY_BUFFER$1;const et=new Uint8Array(this.valueHexView.length+1);return et[0]=this.unusedBits,et.set(this.valueHexView,1),et.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}LocalBitStringValueBlock.NAME="BitStringValueBlock";var _a$q;class BitString extends BaseBlock{constructor({idBlock:s={},lenBlock:a={},...et}={}){var tt,rt;(tt=et.isConstructed)!==null&&tt!==void 0||(et.isConstructed=!!(!((rt=et.value)===null||rt===void 0)&&rt.length)),super({idBlock:{isConstructed:et.isConstructed,...s},lenBlock:{...a,isIndefiniteForm:!!et.isIndefiniteForm},...et},LocalBitStringValueBlock),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(s,a,et){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(s,a,et)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return Constructed.prototype.onAsciiEncoding.call(this);{const s=[],a=this.valueBlock.valueHexView;for(const tt of a)s.push(tt.toString(2).padStart(8,"0"));const et=s.join("");return`${this.constructor.NAME} : ${et.substring(0,et.length-this.valueBlock.unusedBits)}`}}}_a$q=BitString;typeStore.BitString=_a$q;BitString.NAME=BIT_STRING_NAME;var _a$p;function viewAdd(o,s){const a=new Uint8Array([0]),et=new Uint8Array(o),tt=new Uint8Array(s);let rt=et.slice(0);const nt=rt.length-1,it=tt.slice(0),st=it.length-1;let ot=0;const at=st<nt?nt:st;let lt=0;for(let ct=at;ct>=0;ct--,lt++){switch(!0){case lt<it.length:ot=rt[nt-lt]+it[st-lt]+a[0];break;default:ot=rt[nt-lt]+a[0]}switch(a[0]=ot/10,!0){case lt>=rt.length:rt=utilConcatView(new Uint8Array([ot%10]),rt);break;default:rt[nt-lt]=ot%10}}return a[0]>0&&(rt=utilConcatView(a,rt)),rt}function power2(o){if(o>=powers2.length)for(let s=powers2.length;s<=o;s++){const a=new Uint8Array([0]);let et=powers2[s-1].slice(0);for(let tt=et.length-1;tt>=0;tt--){const rt=new Uint8Array([(et[tt]<<1)+a[0]]);a[0]=rt[0]/10,et[tt]=rt[0]%10}a[0]>0&&(et=utilConcatView(a,et)),powers2.push(et)}return powers2[o]}function viewSub(o,s){let a=0;const et=new Uint8Array(o),tt=new Uint8Array(s),rt=et.slice(0),nt=rt.length-1,it=tt.slice(0),st=it.length-1;let ot,at=0;for(let lt=st;lt>=0;lt--,at++)switch(ot=rt[nt-at]-it[st-at]-a,!0){case ot<0:a=1,rt[nt-at]=ot+10;break;default:a=0,rt[nt-at]=ot}if(a>0)for(let lt=nt-st+1;lt>=0;lt--,at++)if(ot=rt[nt-at]-a,ot<0)a=1,rt[nt-at]=ot+10;else{a=0,rt[nt-at]=ot;break}return rt.slice()}class LocalIntegerValueBlock extends HexBlock(ValueBlock){constructor({value:s,...a}={}){super(a),this._valueDec=0,a.valueHex&&this.setValueHex(),s!==void 0&&(this.valueDec=s)}setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=utilDecodeTC.call(this)))}set valueDec(s){this._valueDec=s,this.isHexOnly=!1,this.valueHexView=new Uint8Array(utilEncodeTC(s))}get valueDec(){return this._valueDec}fromDER(s,a,et,tt=0){const rt=this.fromBER(s,a,et);if(rt===-1)return rt;const nt=this.valueHexView;return nt[0]===0&&nt[1]&128?this.valueHexView=nt.subarray(1):tt!==0&&nt.length<tt&&(tt-nt.length>1&&(tt=nt.length+1),this.valueHexView=nt.subarray(tt-nt.length)),rt}toDER(s=!1){const a=this.valueHexView;switch(!0){case(a[0]&128)!==0:{const et=new Uint8Array(this.valueHexView.length+1);et[0]=0,et.set(a,1),this.valueHexView=et}break;case(a[0]===0&&(a[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(s)}fromBER(s,a,et){const tt=super.fromBER(s,a,et);return tt===-1||this.setValueHex(),tt}toBER(s){return s?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){const s=this.valueHexView.length*8-1;let a=new Uint8Array(this.valueHexView.length*8/3),et=0,tt;const rt=this.valueHexView;let nt="",it=!1;for(let st=rt.byteLength-1;st>=0;st--){tt=rt[st];for(let ot=0;ot<8;ot++){if((tt&1)===1)switch(et){case s:a=viewSub(power2(et),a),nt="-";break;default:a=viewAdd(a,power2(et))}et++,tt>>=1}}for(let st=0;st<a.length;st++)a[st]&&(it=!0),it&&(nt+=digitsString.charAt(a[st]));return it===!1&&(nt+=digitsString.charAt(0)),nt}}_a$p=LocalIntegerValueBlock;LocalIntegerValueBlock.NAME="IntegerValueBlock";Object.defineProperty(_a$p.prototype,"valueHex",{set:function(o){this.valueHexView=new Uint8Array(o),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var _a$o;class Integer extends BaseBlock{constructor(s={}){super(s,LocalIntegerValueBlock),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return assertBigInt(),BigInt(this.valueBlock.toString())}static fromBigInt(s){assertBigInt();const a=BigInt(s),et=new ViewWriter,tt=a.toString(16).replace(/^-/,""),rt=new Uint8Array(Convert.FromHex(tt));if(a<0){const it=new Uint8Array(rt.length+(rt[0]&128?1:0));it[0]|=128;const ot=BigInt(`0x${Convert.ToHex(it)}`)+a,at=BufferSourceConverter.toUint8Array(Convert.FromHex(ot.toString(16)));at[0]|=128,et.write(at)}else rt[0]&128&&et.write(new Uint8Array([0])),et.write(rt);return new Integer({valueHex:et.final()})}convertToDER(){const s=new Integer({valueHex:this.valueBlock.valueHexView});return s.valueBlock.toDER(),s}convertFromDER(){return new Integer({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}_a$o=Integer;typeStore.Integer=_a$o;Integer.NAME="INTEGER";var _a$n;class Enumerated extends Integer{constructor(s={}){super(s),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}_a$n=Enumerated;typeStore.Enumerated=_a$n;Enumerated.NAME="ENUMERATED";class LocalSidValueBlock extends HexBlock(ValueBlock){constructor({valueDec:s=-1,isFirstSid:a=!1,...et}={}){super(et),this.valueDec=s,this.isFirstSid=a}fromBER(s,a,et){if(!et)return a;const tt=BufferSourceConverter.toUint8Array(s);if(!checkBufferParams(this,tt,a,et))return-1;const rt=tt.subarray(a,a+et);this.valueHexView=new Uint8Array(et);for(let it=0;it<et&&(this.valueHexView[it]=rt[it]&127,this.blockLength++,!!(rt[it]&128));it++);const nt=new Uint8Array(this.blockLength);for(let it=0;it<this.blockLength;it++)nt[it]=this.valueHexView[it];return this.valueHexView=nt,rt[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=utilFromBase(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),a+this.blockLength)}set valueBigInt(s){assertBigInt();let a=BigInt(s).toString(2);for(;a.length%7;)a="0"+a;const et=new Uint8Array(a.length/7);for(let tt=0;tt<et.length;tt++)et[tt]=parseInt(a.slice(tt*7,tt*7+7),2)+(tt+1<et.length?128:0);this.fromBER(et.buffer,0,et.length)}toBER(s){if(this.isHexOnly){if(s)return new ArrayBuffer(this.valueHexView.byteLength);const tt=this.valueHexView,rt=new Uint8Array(this.blockLength);for(let nt=0;nt<this.blockLength-1;nt++)rt[nt]=tt[nt]|128;return rt[this.blockLength-1]=tt[this.blockLength-1],rt.buffer}const a=utilToBase(this.valueDec,7);if(a.byteLength===0)return this.error="Error during encoding SID value",EMPTY_BUFFER$1;const et=new Uint8Array(a.byteLength);if(!s){const tt=new Uint8Array(a),rt=a.byteLength-1;for(let nt=0;nt<rt;nt++)et[nt]=tt[nt]|128;et[rt]=tt[rt]}return et}toString(){let s="";if(this.isHexOnly)s=Convert.ToHex(this.valueHexView);else if(this.isFirstSid){let a=this.valueDec;this.valueDec<=39?s="0.":this.valueDec<=79?(s="1.",a-=40):(s="2.",a-=80),s+=a.toString()}else s=this.valueDec.toString();return s}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}LocalSidValueBlock.NAME="sidBlock";class LocalObjectIdentifierValueBlock extends ValueBlock{constructor({value:s=EMPTY_STRING,...a}={}){super(a),this.value=[],s&&this.fromString(s)}fromBER(s,a,et){let tt=a;for(;et>0;){const rt=new LocalSidValueBlock;if(tt=rt.fromBER(s,tt,et),tt===-1)return this.blockLength=0,this.error=rt.error,tt;this.value.length===0&&(rt.isFirstSid=!0),this.blockLength+=rt.blockLength,et-=rt.blockLength,this.value.push(rt)}return tt}toBER(s){const a=[];for(let et=0;et<this.value.length;et++){const tt=this.value[et].toBER(s);if(tt.byteLength===0)return this.error=this.value[et].error,EMPTY_BUFFER$1;a.push(tt)}return concat$b(a)}fromString(s){this.value=[];let a=0,et=0,tt="",rt=!1;do if(et=s.indexOf(".",a),et===-1?tt=s.substring(a):tt=s.substring(a,et),a=et+1,rt){const nt=this.value[0];let it=0;switch(nt.valueDec){case 0:break;case 1:it=40;break;case 2:it=80;break;default:this.value=[];return}const st=parseInt(tt,10);if(isNaN(st))return;nt.valueDec=st+it,rt=!1}else{const nt=new LocalSidValueBlock;if(tt>Number.MAX_SAFE_INTEGER){assertBigInt();const it=BigInt(tt);nt.valueBigInt=it}else if(nt.valueDec=parseInt(tt,10),isNaN(nt.valueDec))return;this.value.length||(nt.isFirstSid=!0,rt=!0),this.value.push(nt)}while(et!==-1)}toString(){let s="",a=!1;for(let et=0;et<this.value.length;et++){a=this.value[et].isHexOnly;let tt=this.value[et].toString();et!==0&&(s=`${s}.`),a?(tt=`{${tt}}`,this.value[et].isFirstSid?s=`2.{${tt} - 80}`:s+=tt):s+=tt}return s}toJSON(){const s={...super.toJSON(),value:this.toString(),sidArray:[]};for(let a=0;a<this.value.length;a++)s.sidArray.push(this.value[a].toJSON());return s}}LocalObjectIdentifierValueBlock.NAME="ObjectIdentifierValueBlock";var _a$m;class ObjectIdentifier extends BaseBlock{constructor(s={}){super(s,LocalObjectIdentifierValueBlock),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}getValue(){return this.valueBlock.toString()}setValue(s){this.valueBlock.fromString(s)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}_a$m=ObjectIdentifier;typeStore.ObjectIdentifier=_a$m;ObjectIdentifier.NAME="OBJECT IDENTIFIER";class LocalRelativeSidValueBlock extends HexBlock(LocalBaseBlock){constructor({valueDec:s=0,...a}={}){super(a),this.valueDec=s}fromBER(s,a,et){if(et===0)return a;const tt=BufferSourceConverter.toUint8Array(s);if(!checkBufferParams(this,tt,a,et))return-1;const rt=tt.subarray(a,a+et);this.valueHexView=new Uint8Array(et);for(let it=0;it<et&&(this.valueHexView[it]=rt[it]&127,this.blockLength++,!!(rt[it]&128));it++);const nt=new Uint8Array(this.blockLength);for(let it=0;it<this.blockLength;it++)nt[it]=this.valueHexView[it];return this.valueHexView=nt,rt[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=utilFromBase(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),a+this.blockLength)}toBER(s){if(this.isHexOnly){if(s)return new ArrayBuffer(this.valueHexView.byteLength);const tt=this.valueHexView,rt=new Uint8Array(this.blockLength);for(let nt=0;nt<this.blockLength-1;nt++)rt[nt]=tt[nt]|128;return rt[this.blockLength-1]=tt[this.blockLength-1],rt.buffer}const a=utilToBase(this.valueDec,7);if(a.byteLength===0)return this.error="Error during encoding SID value",EMPTY_BUFFER$1;const et=new Uint8Array(a.byteLength);if(!s){const tt=new Uint8Array(a),rt=a.byteLength-1;for(let nt=0;nt<rt;nt++)et[nt]=tt[nt]|128;et[rt]=tt[rt]}return et.buffer}toString(){let s="";return this.isHexOnly?s=Convert.ToHex(this.valueHexView):s=this.valueDec.toString(),s}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}LocalRelativeSidValueBlock.NAME="relativeSidBlock";class LocalRelativeObjectIdentifierValueBlock extends ValueBlock{constructor({value:s=EMPTY_STRING,...a}={}){super(a),this.value=[],s&&this.fromString(s)}fromBER(s,a,et){let tt=a;for(;et>0;){const rt=new LocalRelativeSidValueBlock;if(tt=rt.fromBER(s,tt,et),tt===-1)return this.blockLength=0,this.error=rt.error,tt;this.blockLength+=rt.blockLength,et-=rt.blockLength,this.value.push(rt)}return tt}toBER(s,a){const et=[];for(let tt=0;tt<this.value.length;tt++){const rt=this.value[tt].toBER(s);if(rt.byteLength===0)return this.error=this.value[tt].error,EMPTY_BUFFER$1;et.push(rt)}return concat$b(et)}fromString(s){this.value=[];let a=0,et=0,tt="";do{et=s.indexOf(".",a),et===-1?tt=s.substring(a):tt=s.substring(a,et),a=et+1;const rt=new LocalRelativeSidValueBlock;if(rt.valueDec=parseInt(tt,10),isNaN(rt.valueDec))return!0;this.value.push(rt)}while(et!==-1);return!0}toString(){let s="",a=!1;for(let et=0;et<this.value.length;et++){a=this.value[et].isHexOnly;let tt=this.value[et].toString();et!==0&&(s=`${s}.`),a&&(tt=`{${tt}}`),s+=tt}return s}toJSON(){const s={...super.toJSON(),value:this.toString(),sidArray:[]};for(let a=0;a<this.value.length;a++)s.sidArray.push(this.value[a].toJSON());return s}}LocalRelativeObjectIdentifierValueBlock.NAME="RelativeObjectIdentifierValueBlock";var _a$l;class RelativeObjectIdentifier extends BaseBlock{constructor(s={}){super(s,LocalRelativeObjectIdentifierValueBlock),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}getValue(){return this.valueBlock.toString()}setValue(s){this.valueBlock.fromString(s)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}_a$l=RelativeObjectIdentifier;typeStore.RelativeObjectIdentifier=_a$l;RelativeObjectIdentifier.NAME="RelativeObjectIdentifier";var _a$k;class Sequence extends Constructed{constructor(s={}){super(s),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}_a$k=Sequence;typeStore.Sequence=_a$k;Sequence.NAME="SEQUENCE";var _a$j;let Set$1=class extends Constructed{constructor(s={}){super(s),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}};_a$j=Set$1;typeStore.Set=_a$j;Set$1.NAME="SET";class LocalStringValueBlock extends HexBlock(ValueBlock){constructor({...s}={}){super(s),this.isHexOnly=!0,this.value=EMPTY_STRING}toJSON(){return{...super.toJSON(),value:this.value}}}LocalStringValueBlock.NAME="StringValueBlock";class LocalSimpleStringValueBlock extends LocalStringValueBlock{}LocalSimpleStringValueBlock.NAME="SimpleStringValueBlock";class LocalSimpleStringBlock extends BaseStringBlock{constructor({...s}={}){super(s,LocalSimpleStringValueBlock)}fromBuffer(s){this.valueBlock.value=String.fromCharCode.apply(null,BufferSourceConverter.toUint8Array(s))}fromString(s){const a=s.length,et=this.valueBlock.valueHexView=new Uint8Array(a);for(let tt=0;tt<a;tt++)et[tt]=s.charCodeAt(tt);this.valueBlock.value=s}}LocalSimpleStringBlock.NAME="SIMPLE STRING";class LocalUtf8StringValueBlock extends LocalSimpleStringBlock{fromBuffer(s){this.valueBlock.valueHexView=BufferSourceConverter.toUint8Array(s);try{this.valueBlock.value=Convert.ToUtf8String(s)}catch(a){this.warnings.push(`Error during "decodeURIComponent": ${a}, using raw string`),this.valueBlock.value=Convert.ToBinary(s)}}fromString(s){this.valueBlock.valueHexView=new Uint8Array(Convert.FromUtf8String(s)),this.valueBlock.value=s}}LocalUtf8StringValueBlock.NAME="Utf8StringValueBlock";var _a$i;class Utf8String extends LocalUtf8StringValueBlock{constructor(s={}){super(s),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}_a$i=Utf8String;typeStore.Utf8String=_a$i;Utf8String.NAME="UTF8String";class LocalBmpStringValueBlock extends LocalSimpleStringBlock{fromBuffer(s){this.valueBlock.value=Convert.ToUtf16String(s),this.valueBlock.valueHexView=BufferSourceConverter.toUint8Array(s)}fromString(s){this.valueBlock.value=s,this.valueBlock.valueHexView=new Uint8Array(Convert.FromUtf16String(s))}}LocalBmpStringValueBlock.NAME="BmpStringValueBlock";var _a$h;class BmpString extends LocalBmpStringValueBlock{constructor({...s}={}){super(s),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}_a$h=BmpString;typeStore.BmpString=_a$h;BmpString.NAME="BMPString";class LocalUniversalStringValueBlock extends LocalSimpleStringBlock{fromBuffer(s){const a=ArrayBuffer.isView(s)?s.slice().buffer:s.slice(0),et=new Uint8Array(a);for(let tt=0;tt<et.length;tt+=4)et[tt]=et[tt+3],et[tt+1]=et[tt+2],et[tt+2]=0,et[tt+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(a))}fromString(s){const a=s.length,et=this.valueBlock.valueHexView=new Uint8Array(a*4);for(let tt=0;tt<a;tt++){const rt=utilToBase(s.charCodeAt(tt),8),nt=new Uint8Array(rt);if(nt.length>4)continue;const it=4-nt.length;for(let st=nt.length-1;st>=0;st--)et[tt*4+st+it]=nt[st]}this.valueBlock.value=s}}LocalUniversalStringValueBlock.NAME="UniversalStringValueBlock";var _a$g;class UniversalString extends LocalUniversalStringValueBlock{constructor({...s}={}){super(s),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}_a$g=UniversalString;typeStore.UniversalString=_a$g;UniversalString.NAME="UniversalString";var _a$f;class NumericString extends LocalSimpleStringBlock{constructor(s={}){super(s),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}_a$f=NumericString;typeStore.NumericString=_a$f;NumericString.NAME="NumericString";var _a$e;class PrintableString extends LocalSimpleStringBlock{constructor(s={}){super(s),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}_a$e=PrintableString;typeStore.PrintableString=_a$e;PrintableString.NAME="PrintableString";var _a$d;class TeletexString extends LocalSimpleStringBlock{constructor(s={}){super(s),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}_a$d=TeletexString;typeStore.TeletexString=_a$d;TeletexString.NAME="TeletexString";var _a$c;class VideotexString extends LocalSimpleStringBlock{constructor(s={}){super(s),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}_a$c=VideotexString;typeStore.VideotexString=_a$c;VideotexString.NAME="VideotexString";var _a$b;class IA5String extends LocalSimpleStringBlock{constructor(s={}){super(s),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}_a$b=IA5String;typeStore.IA5String=_a$b;IA5String.NAME="IA5String";var _a$a;class GraphicString extends LocalSimpleStringBlock{constructor(s={}){super(s),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}_a$a=GraphicString;typeStore.GraphicString=_a$a;GraphicString.NAME="GraphicString";var _a$9;class VisibleString extends LocalSimpleStringBlock{constructor(s={}){super(s),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}_a$9=VisibleString;typeStore.VisibleString=_a$9;VisibleString.NAME="VisibleString";var _a$8;class GeneralString extends LocalSimpleStringBlock{constructor(s={}){super(s),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}_a$8=GeneralString;typeStore.GeneralString=_a$8;GeneralString.NAME="GeneralString";var _a$7;class CharacterString extends LocalSimpleStringBlock{constructor(s={}){super(s),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}_a$7=CharacterString;typeStore.CharacterString=_a$7;CharacterString.NAME="CharacterString";var _a$6;class UTCTime extends VisibleString{constructor({value:s,valueDate:a,...et}={}){if(super(et),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,s){this.fromString(s),this.valueBlock.valueHexView=new Uint8Array(s.length);for(let tt=0;tt<s.length;tt++)this.valueBlock.valueHexView[tt]=s.charCodeAt(tt)}a&&(this.fromDate(a),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(s){this.fromString(String.fromCharCode.apply(null,BufferSourceConverter.toUint8Array(s)))}toBuffer(){const s=this.toString(),a=new ArrayBuffer(s.length),et=new Uint8Array(a);for(let tt=0;tt<s.length;tt++)et[tt]=s.charCodeAt(tt);return a}fromDate(s){this.year=s.getUTCFullYear(),this.month=s.getUTCMonth()+1,this.day=s.getUTCDate(),this.hour=s.getUTCHours(),this.minute=s.getUTCMinutes(),this.second=s.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(s){const et=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(s);if(et===null){this.error="Wrong input string for conversion";return}const tt=parseInt(et[1],10);tt>=50?this.year=1900+tt:this.year=2e3+tt,this.month=parseInt(et[2],10),this.day=parseInt(et[3],10),this.hour=parseInt(et[4],10),this.minute=parseInt(et[5],10),this.second=parseInt(et[6],10)}toString(s="iso"){if(s==="iso"){const a=new Array(7);return a[0]=padNumber(this.year<2e3?this.year-1900:this.year-2e3,2),a[1]=padNumber(this.month,2),a[2]=padNumber(this.day,2),a[3]=padNumber(this.hour,2),a[4]=padNumber(this.minute,2),a[5]=padNumber(this.second,2),a[6]="Z",a.join("")}return super.toString(s)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}_a$6=UTCTime;typeStore.UTCTime=_a$6;UTCTime.NAME="UTCTime";var _a$5;class GeneralizedTime extends UTCTime{constructor(s={}){var a;super(s),(a=this.millisecond)!==null&&a!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(s){super.fromDate(s),this.millisecond=s.getUTCMilliseconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}fromString(s){let a=!1,et="",tt="",rt=0,nt,it=0,st=0;if(s[s.length-1]==="Z")et=s.substring(0,s.length-1),a=!0;else{const lt=new Number(s[s.length-1]);if(isNaN(lt.valueOf()))throw new Error("Wrong input string for conversion");et=s}if(a){if(et.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(et.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let lt=1,ct=et.indexOf("+"),ht="";if(ct===-1&&(ct=et.indexOf("-"),lt=-1),ct!==-1){if(ht=et.substring(ct+1),et=et.substring(0,ct),ht.length!==2&&ht.length!==4)throw new Error("Wrong input string for conversion");let ft=parseInt(ht.substring(0,2),10);if(isNaN(ft.valueOf()))throw new Error("Wrong input string for conversion");if(it=lt*ft,ht.length===4){if(ft=parseInt(ht.substring(2,4),10),isNaN(ft.valueOf()))throw new Error("Wrong input string for conversion");st=lt*ft}}}let ot=et.indexOf(".");if(ot===-1&&(ot=et.indexOf(",")),ot!==-1){const lt=new Number(`0${et.substring(ot)}`);if(isNaN(lt.valueOf()))throw new Error("Wrong input string for conversion");rt=lt.valueOf(),tt=et.substring(0,ot)}else tt=et;switch(!0){case tt.length===8:if(nt=/(\d{4})(\d{2})(\d{2})/ig,ot!==-1)throw new Error("Wrong input string for conversion");break;case tt.length===10:if(nt=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,ot!==-1){let lt=60*rt;this.minute=Math.floor(lt),lt=60*(lt-this.minute),this.second=Math.floor(lt),lt=1e3*(lt-this.second),this.millisecond=Math.floor(lt)}break;case tt.length===12:if(nt=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,ot!==-1){let lt=60*rt;this.second=Math.floor(lt),lt=1e3*(lt-this.second),this.millisecond=Math.floor(lt)}break;case tt.length===14:if(nt=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,ot!==-1){const lt=1e3*rt;this.millisecond=Math.floor(lt)}break;default:throw new Error("Wrong input string for conversion")}const at=nt.exec(tt);if(at===null)throw new Error("Wrong input string for conversion");for(let lt=1;lt<at.length;lt++)switch(lt){case 1:this.year=parseInt(at[lt],10);break;case 2:this.month=parseInt(at[lt],10);break;case 3:this.day=parseInt(at[lt],10);break;case 4:this.hour=parseInt(at[lt],10)+it;break;case 5:this.minute=parseInt(at[lt],10)+st;break;case 6:this.second=parseInt(at[lt],10);break;default:throw new Error("Wrong input string for conversion")}if(a===!1){const lt=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=lt.getUTCFullYear(),this.month=lt.getUTCMonth(),this.day=lt.getUTCDay(),this.hour=lt.getUTCHours(),this.minute=lt.getUTCMinutes(),this.second=lt.getUTCSeconds(),this.millisecond=lt.getUTCMilliseconds()}}toString(s="iso"){if(s==="iso"){const a=[];return a.push(padNumber(this.year,4)),a.push(padNumber(this.month,2)),a.push(padNumber(this.day,2)),a.push(padNumber(this.hour,2)),a.push(padNumber(this.minute,2)),a.push(padNumber(this.second,2)),this.millisecond!==0&&(a.push("."),a.push(padNumber(this.millisecond,3))),a.push("Z"),a.join("")}return super.toString(s)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}_a$5=GeneralizedTime;typeStore.GeneralizedTime=_a$5;GeneralizedTime.NAME="GeneralizedTime";var _a$4;class DATE extends Utf8String{constructor(s={}){super(s),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}_a$4=DATE;typeStore.DATE=_a$4;DATE.NAME="DATE";var _a$3;class TimeOfDay extends Utf8String{constructor(s={}){super(s),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}_a$3=TimeOfDay;typeStore.TimeOfDay=_a$3;TimeOfDay.NAME="TimeOfDay";var _a$2;class DateTime extends Utf8String{constructor(s={}){super(s),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}_a$2=DateTime;typeStore.DateTime=_a$2;DateTime.NAME="DateTime";var _a$1;class Duration extends Utf8String{constructor(s={}){super(s),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}_a$1=Duration;typeStore.Duration=_a$1;Duration.NAME="Duration";var _a;class TIME extends Utf8String{constructor(s={}){super(s),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}_a=TIME;typeStore.TIME=_a;TIME.NAME="TIME";function pkcs1ToJwk(o){const{result:s}=fromBER(o),a=s.valueBlock.value;return{n:toString$i(bnToBuf(a[1].toBigInt()),"base64url"),e:toString$i(bnToBuf(a[2].toBigInt()),"base64url"),d:toString$i(bnToBuf(a[3].toBigInt()),"base64url"),p:toString$i(bnToBuf(a[4].toBigInt()),"base64url"),q:toString$i(bnToBuf(a[5].toBigInt()),"base64url"),dp:toString$i(bnToBuf(a[6].toBigInt()),"base64url"),dq:toString$i(bnToBuf(a[7].toBigInt()),"base64url"),qi:toString$i(bnToBuf(a[8].toBigInt()),"base64url"),kty:"RSA",alg:"RS256"}}function jwkToPkcs1(o){if(o.n==null||o.e==null||o.d==null||o.p==null||o.q==null||o.dp==null||o.dq==null||o.qi==null)throw new CodeError$3("JWK was missing components","ERR_INVALID_PARAMETERS");const a=new Sequence({value:[new Integer({value:0}),Integer.fromBigInt(bufToBn(fromString$p(o.n,"base64url"))),Integer.fromBigInt(bufToBn(fromString$p(o.e,"base64url"))),Integer.fromBigInt(bufToBn(fromString$p(o.d,"base64url"))),Integer.fromBigInt(bufToBn(fromString$p(o.p,"base64url"))),Integer.fromBigInt(bufToBn(fromString$p(o.q,"base64url"))),Integer.fromBigInt(bufToBn(fromString$p(o.dp,"base64url"))),Integer.fromBigInt(bufToBn(fromString$p(o.dq,"base64url"))),Integer.fromBigInt(bufToBn(fromString$p(o.qi,"base64url")))]}).toBER();return new Uint8Array(a,0,a.byteLength)}function pkixToJwk(o){const{result:s}=fromBER(o),a=s.valueBlock.value[1].valueBlock.value[0].valueBlock.value;return{kty:"RSA",n:toString$i(bnToBuf(a[0].toBigInt()),"base64url"),e:toString$i(bnToBuf(a[1].toBigInt()),"base64url")}}function jwkToPkix(o){if(o.n==null||o.e==null)throw new CodeError$3("JWK was missing components","ERR_INVALID_PARAMETERS");const a=new Sequence({value:[new Sequence({value:[new ObjectIdentifier({value:"1.2.840.113549.1.1.1"}),new Null]}),new BitString({valueHex:new Sequence({value:[Integer.fromBigInt(bufToBn(fromString$p(o.n,"base64url"))),Integer.fromBigInt(bufToBn(fromString$p(o.e,"base64url")))]}).toBER()})]}).toBER();return new Uint8Array(a,0,a.byteLength)}function bnToBuf(o){let s=o.toString(16);s.length%2>0&&(s=`0${s}`);const a=s.length/2,et=new Uint8Array(a);let tt=0,rt=0;for(;tt<a;)et[tt]=parseInt(s.slice(rt,rt+2),16),tt+=1,rt+=2;return et}function bufToBn(o){const s=[];return o.forEach(function(a){let et=a.toString(16);et.length%2>0&&(et=`0${et}`),s.push(et)}),BigInt("0x"+s.join(""))}const SALT_LENGTH=16,KEY_SIZE=32,ITERATIONS=1e4;async function exportToPem(o,s){const a=webcrypto.get(),tt=new Sequence({value:[new Integer({value:0}),new Sequence({value:[new ObjectIdentifier({value:"1.2.840.113549.1.1.1"}),new Null]}),new OctetString({valueHex:o.marshal()})]}).toBER(),rt=new Uint8Array(tt,0,tt.byteLength),nt=randomBytes(SALT_LENGTH),it=await pbkdf2Async(sha512,s,nt,{c:ITERATIONS,dkLen:KEY_SIZE}),st=randomBytes(16),ot=await a.subtle.importKey("raw",it,"AES-CBC",!1,["encrypt"]),at=await a.subtle.encrypt({name:"AES-CBC",iv:st},ot,rt),lt=new Sequence({value:[new OctetString({valueHex:nt}),new Integer({value:ITERATIONS}),new Integer({value:KEY_SIZE}),new Sequence({value:[new ObjectIdentifier({value:"1.2.840.113549.2.11"}),new Null]})]}),ct=new Sequence({value:[new ObjectIdentifier({value:"1.2.840.113549.1.5.13"}),new Sequence({value:[new Sequence({value:[new ObjectIdentifier({value:"1.2.840.113549.1.5.12"}),lt]}),new Sequence({value:[new ObjectIdentifier({value:"2.16.840.1.101.3.4.1.42"}),new OctetString({valueHex:st})]})]})]}),ft=new Sequence({value:[ct,new OctetString({valueHex:at})]}).toBER(),dt=new Uint8Array(ft,0,ft.byteLength);return["-----BEGIN ENCRYPTED PRIVATE KEY-----",...toString$i(dt,"base64pad").split(/(.{64})/).filter(Boolean),"-----END ENCRYPTED PRIVATE KEY-----"].join(`
`)}async function importFromPem(o,s){const a=webcrypto.get();let et;if(o.includes("-----BEGIN ENCRYPTED PRIVATE KEY-----")){const tt=fromString$p(o.replace("-----BEGIN ENCRYPTED PRIVATE KEY-----","").replace("-----END ENCRYPTED PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad"),{result:rt}=fromBER(tt),{iv:nt,salt:it,iterations:st,keySize:ot,cipherText:at}=findEncryptedPEMData(rt),lt=await pbkdf2Async(sha512,s,it,{c:st,dkLen:ot}),ct=await a.subtle.importKey("raw",lt,"AES-CBC",!1,["decrypt"]),ht=toUint8Array(await a.subtle.decrypt({name:"AES-CBC",iv:nt},ct,at)),{result:ft}=fromBER(ht);et=findPEMData(ft)}else if(o.includes("-----BEGIN PRIVATE KEY-----")){const tt=fromString$p(o.replace("-----BEGIN PRIVATE KEY-----","").replace("-----END PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad"),{result:rt}=fromBER(tt);et=findPEMData(rt)}else throw new CodeError$3("Could not parse private key from PEM data","ERR_INVALID_PARAMETERS");return unmarshalRsaPrivateKey(et)}function findEncryptedPEMData(o){const s=o.valueBlock.value[0];if(s.valueBlock.value[0].toString()!=="OBJECT IDENTIFIER : 1.2.840.113549.1.5.13")throw new CodeError$3("Only pkcs5PBES2 encrypted private keys are supported","ERR_INVALID_PARAMS");const et=s.valueBlock.value[1].valueBlock.value[0];if(et.valueBlock.value[0].toString()!=="OBJECT IDENTIFIER : 1.2.840.113549.1.5.12")throw new CodeError$3("Only pkcs5PBKDF2 key derivation functions are supported","ERR_INVALID_PARAMS");const rt=et.valueBlock.value[1],nt=toUint8Array(rt.valueBlock.value[0].getValue());let it=ITERATIONS,st=KEY_SIZE;if(rt.valueBlock.value.length===3)it=Number(rt.valueBlock.value[1].toBigInt()),st=Number(rt.valueBlock.value[2].toBigInt());else if(rt.valueBlock.value.length===2)throw new CodeError$3("Could not derive key size and iterations from PEM file - please use @libp2p/rsa to re-import your key","ERR_INVALID_PARAMS");const ot=s.valueBlock.value[1].valueBlock.value[1],at=ot.valueBlock.value[0].toString();if(at!=="OBJECT IDENTIFIER : 1.2.840.113549.3.7"){if(at!=="OBJECT IDENTIFIER : 1.3.14.3.2.7"){if(at!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.2"){if(at!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.22"){if(at!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.42")throw new CodeError$3("Only AES-CBC encryption schemes are supported","ERR_INVALID_PARAMS")}}}}const lt=toUint8Array(ot.valueBlock.value[1].getValue());return{cipherText:toUint8Array(o.valueBlock.value[1].getValue()),salt:nt,iterations:it,keySize:st,iv:lt}}function findPEMData(o){return toUint8Array(o.valueBlock.value[2].getValue())}function toUint8Array(o){return new Uint8Array(o,0,o.byteLength)}async function generateKey$1(o){const s=await webcrypto.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:o,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),a=await exportKey(s);return{privateKey:a[0],publicKey:a[1]}}async function unmarshalPrivateKey$1(o){const a=[await webcrypto.get().subtle.importKey("jwk",o,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await derivePublicFromPrivate(o)],et=await exportKey({privateKey:a[0],publicKey:a[1]});return{privateKey:et[0],publicKey:et[1]}}async function hashAndSign$1(o,s){const a=await webcrypto.get().subtle.importKey("jwk",o,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),et=await webcrypto.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},a,s instanceof Uint8Array?s:s.subarray());return new Uint8Array(et,0,et.byteLength)}async function hashAndVerify$1(o,s,a){const et=await webcrypto.get().subtle.importKey("jwk",o,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return webcrypto.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},et,s,a instanceof Uint8Array?a:a.subarray())}async function exportKey(o){if(o.privateKey==null||o.publicKey==null)throw new CodeError$3("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([webcrypto.get().subtle.exportKey("jwk",o.privateKey),webcrypto.get().subtle.exportKey("jwk",o.publicKey)])}async function derivePublicFromPrivate(o){return webcrypto.get().subtle.importKey("jwk",{kty:o.kty,n:o.n,e:o.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function keySize(o){if(o.kty!=="RSA")throw new CodeError$3("invalid key type","ERR_INVALID_KEY_TYPE");if(o.n==null)throw new CodeError$3("invalid key modulus","ERR_INVALID_KEY_MODULUS");return fromString$p(o.n,"base64url").length*8}const MAX_RSA_KEY_SIZE=8192;class RsaPublicKey{_key;constructor(s){this._key=s}verify(s,a){return hashAndVerify$1(this._key,a,s)}marshal(){return jwkToPkix(this._key)}get bytes(){return PublicKey.encode({Type:KeyType.RSA,Data:this.marshal()}).subarray()}equals(s){return equals$e(this.bytes,s.bytes)}hash(){const s=sha256$1.digest(this.bytes);return isPromise$6(s)?s.then(({bytes:a})=>a):s.bytes}}class RsaPrivateKey{_key;_publicKey;constructor(s,a){this._key=s,this._publicKey=a}genSecret(){return randomBytes(16)}sign(s){return hashAndSign$1(this._key,s)}get public(){if(this._publicKey==null)throw new CodeError$3("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new RsaPublicKey(this._publicKey)}marshal(){return jwkToPkcs1(this._key)}get bytes(){return PrivateKey.encode({Type:KeyType.RSA,Data:this.marshal()}).subarray()}equals(s){return equals$e(this.bytes,s.bytes)}hash(){const s=sha256$1.digest(this.bytes);return isPromise$6(s)?s.then(({bytes:a})=>a):s.bytes}async id(){const s=await this.public.hash();return toString$i(s,"base58btc")}async export(s,a="pkcs-8"){if(a==="pkcs-8")return exportToPem(this,s);if(a==="libp2p-key")return exporter$1(this.bytes,s);throw new CodeError$3(`export format '${a}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}async function unmarshalRsaPrivateKey(o){const s=pkcs1ToJwk(o);if(keySize(s)>MAX_RSA_KEY_SIZE)throw new CodeError$3("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const a=await unmarshalPrivateKey$1(s);return new RsaPrivateKey(a.privateKey,a.publicKey)}function unmarshalRsaPublicKey(o){const s=pkixToJwk(o);if(keySize(s)>MAX_RSA_KEY_SIZE)throw new CodeError$3("key size is too large","ERR_KEY_SIZE_TOO_LARGE");return new RsaPublicKey(s)}async function fromJwk(o){if(keySize(o)>MAX_RSA_KEY_SIZE)throw new CodeError$3("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const s=await unmarshalPrivateKey$1(o);return new RsaPrivateKey(s.privateKey,s.publicKey)}async function generateKeyPair$2(o){if(o>MAX_RSA_KEY_SIZE)throw new CodeError$3("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const s=await generateKey$1(o);return new RsaPrivateKey(s.privateKey,s.publicKey)}const RSA=Object.freeze(Object.defineProperty({__proto__:null,MAX_RSA_KEY_SIZE,RsaPrivateKey,RsaPublicKey,fromJwk,generateKeyPair:generateKeyPair$2,unmarshalRsaPrivateKey,unmarshalRsaPublicKey},Symbol.toStringTag,{value:"Module"})),SHA256_K=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),SHA256_IV=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W=new Uint32Array(64);class SHA256 extends HashMD{constructor(){super(64,32,8,!1),this.A=SHA256_IV[0]|0,this.B=SHA256_IV[1]|0,this.C=SHA256_IV[2]|0,this.D=SHA256_IV[3]|0,this.E=SHA256_IV[4]|0,this.F=SHA256_IV[5]|0,this.G=SHA256_IV[6]|0,this.H=SHA256_IV[7]|0}get(){const{A:s,B:a,C:et,D:tt,E:rt,F:nt,G:it,H:st}=this;return[s,a,et,tt,rt,nt,it,st]}set(s,a,et,tt,rt,nt,it,st){this.A=s|0,this.B=a|0,this.C=et|0,this.D=tt|0,this.E=rt|0,this.F=nt|0,this.G=it|0,this.H=st|0}process(s,a){for(let lt=0;lt<16;lt++,a+=4)SHA256_W[lt]=s.getUint32(a,!1);for(let lt=16;lt<64;lt++){const ct=SHA256_W[lt-15],ht=SHA256_W[lt-2],ft=rotr(ct,7)^rotr(ct,18)^ct>>>3,dt=rotr(ht,17)^rotr(ht,19)^ht>>>10;SHA256_W[lt]=dt+SHA256_W[lt-7]+ft+SHA256_W[lt-16]|0}let{A:et,B:tt,C:rt,D:nt,E:it,F:st,G:ot,H:at}=this;for(let lt=0;lt<64;lt++){const ct=rotr(it,6)^rotr(it,11)^rotr(it,25),ht=at+ct+Chi(it,st,ot)+SHA256_K[lt]+SHA256_W[lt]|0,dt=(rotr(et,2)^rotr(et,13)^rotr(et,22))+Maj(et,tt,rt)|0;at=ot,ot=st,st=it,it=nt+ht|0,nt=rt,rt=tt,tt=et,et=ht+dt|0}et=et+this.A|0,tt=tt+this.B|0,rt=rt+this.C|0,nt=nt+this.D|0,it=it+this.E|0,st=st+this.F|0,ot=ot+this.G|0,at=at+this.H|0,this.set(et,tt,rt,nt,it,st,ot,at)}roundClean(){SHA256_W.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const sha256=wrapConstructor(()=>new SHA256);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function validatePointOpts(o){const s=validateBasic(o);validateObject(s,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:a,Fp:et,a:tt}=s;if(a){if(!et.eql(tt,et.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof a!="object"||typeof a.beta!="bigint"||typeof a.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...s})}const{bytesToNumberBE:b2n,hexToBytes:h2b}=ut,DER={Err:class extends Error{constructor(s=""){super(s)}},_parseInt(o){const{Err:s}=DER;if(o.length<2||o[0]!==2)throw new s("Invalid signature integer tag");const a=o[1],et=o.subarray(2,a+2);if(!a||et.length!==a)throw new s("Invalid signature integer: wrong length");if(et[0]&128)throw new s("Invalid signature integer: negative");if(et[0]===0&&!(et[1]&128))throw new s("Invalid signature integer: unnecessary leading zero");return{d:b2n(et),l:o.subarray(a+2)}},toSig(o){const{Err:s}=DER,a=typeof o=="string"?h2b(o):o;abytes(a);let et=a.length;if(et<2||a[0]!=48)throw new s("Invalid signature tag");if(a[1]!==et-2)throw new s("Invalid signature: incorrect length");const{d:tt,l:rt}=DER._parseInt(a.subarray(2)),{d:nt,l:it}=DER._parseInt(rt);if(it.length)throw new s("Invalid signature: left bytes after parsing");return{r:tt,s:nt}},hexFromSig(o){const s=ot=>Number.parseInt(ot[0],16)&8?"00"+ot:ot,a=ot=>{const at=ot.toString(16);return at.length&1?`0${at}`:at},et=s(a(o.s)),tt=s(a(o.r)),rt=et.length/2,nt=tt.length/2,it=a(rt),st=a(nt);return`30${a(nt+rt+4)}02${st}${tt}02${it}${et}`}},_0n=BigInt(0),_1n$1=BigInt(1);BigInt(2);const _3n=BigInt(3);BigInt(4);function weierstrassPoints(o){const s=validatePointOpts(o),{Fp:a}=s,et=s.toBytes||((ft,dt,pt)=>{const gt=dt.toAffine();return concatBytes(Uint8Array.from([4]),a.toBytes(gt.x),a.toBytes(gt.y))}),tt=s.fromBytes||(ft=>{const dt=ft.subarray(1),pt=a.fromBytes(dt.subarray(0,a.BYTES)),gt=a.fromBytes(dt.subarray(a.BYTES,2*a.BYTES));return{x:pt,y:gt}});function rt(ft){const{a:dt,b:pt}=s,gt=a.sqr(ft),mt=a.mul(gt,ft);return a.add(a.add(mt,a.mul(ft,dt)),pt)}if(!a.eql(a.sqr(s.Gy),rt(s.Gx)))throw new Error("bad generator point: equation left != right");function nt(ft){return typeof ft=="bigint"&&_0n<ft&&ft<s.n}function it(ft){if(!nt(ft))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function st(ft){const{allowedPrivateKeyLengths:dt,nByteLength:pt,wrapPrivateKey:gt,n:mt}=s;if(dt&&typeof ft!="bigint"){if(isBytes$2(ft)&&(ft=bytesToHex(ft)),typeof ft!="string"||!dt.includes(ft.length))throw new Error("Invalid key");ft=ft.padStart(pt*2,"0")}let yt;try{yt=typeof ft=="bigint"?ft:bytesToNumberBE(ensureBytes$1("private key",ft,pt))}catch{throw new Error(`private key must be ${pt} bytes, hex or bigint, not ${typeof ft}`)}return gt&&(yt=mod(yt,mt)),it(yt),yt}const ot=new Map;function at(ft){if(!(ft instanceof lt))throw new Error("ProjectivePoint expected")}class lt{constructor(dt,pt,gt){if(this.px=dt,this.py=pt,this.pz=gt,dt==null||!a.isValid(dt))throw new Error("x required");if(pt==null||!a.isValid(pt))throw new Error("y required");if(gt==null||!a.isValid(gt))throw new Error("z required")}static fromAffine(dt){const{x:pt,y:gt}=dt||{};if(!dt||!a.isValid(pt)||!a.isValid(gt))throw new Error("invalid affine point");if(dt instanceof lt)throw new Error("projective point not allowed");const mt=yt=>a.eql(yt,a.ZERO);return mt(pt)&&mt(gt)?lt.ZERO:new lt(pt,gt,a.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(dt){const pt=a.invertBatch(dt.map(gt=>gt.pz));return dt.map((gt,mt)=>gt.toAffine(pt[mt])).map(lt.fromAffine)}static fromHex(dt){const pt=lt.fromAffine(tt(ensureBytes$1("pointHex",dt)));return pt.assertValidity(),pt}static fromPrivateKey(dt){return lt.BASE.multiply(st(dt))}_setWindowSize(dt){this._WINDOW_SIZE=dt,ot.delete(this)}assertValidity(){if(this.is0()){if(s.allowInfinityPoint&&!a.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:dt,y:pt}=this.toAffine();if(!a.isValid(dt)||!a.isValid(pt))throw new Error("bad point: x or y not FE");const gt=a.sqr(pt),mt=rt(dt);if(!a.eql(gt,mt))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:dt}=this.toAffine();if(a.isOdd)return!a.isOdd(dt);throw new Error("Field doesn't support isOdd")}equals(dt){at(dt);const{px:pt,py:gt,pz:mt}=this,{px:yt,py:vt,pz:Et}=dt,xt=a.eql(a.mul(pt,Et),a.mul(yt,mt)),wt=a.eql(a.mul(gt,Et),a.mul(vt,mt));return xt&&wt}negate(){return new lt(this.px,a.neg(this.py),this.pz)}double(){const{a:dt,b:pt}=s,gt=a.mul(pt,_3n),{px:mt,py:yt,pz:vt}=this;let Et=a.ZERO,xt=a.ZERO,wt=a.ZERO,Rt=a.mul(mt,mt),Ct=a.mul(yt,yt),Ft=a.mul(vt,vt),zt=a.mul(mt,yt);return zt=a.add(zt,zt),wt=a.mul(mt,vt),wt=a.add(wt,wt),Et=a.mul(dt,wt),xt=a.mul(gt,Ft),xt=a.add(Et,xt),Et=a.sub(Ct,xt),xt=a.add(Ct,xt),xt=a.mul(Et,xt),Et=a.mul(zt,Et),wt=a.mul(gt,wt),Ft=a.mul(dt,Ft),zt=a.sub(Rt,Ft),zt=a.mul(dt,zt),zt=a.add(zt,wt),wt=a.add(Rt,Rt),Rt=a.add(wt,Rt),Rt=a.add(Rt,Ft),Rt=a.mul(Rt,zt),xt=a.add(xt,Rt),Ft=a.mul(yt,vt),Ft=a.add(Ft,Ft),Rt=a.mul(Ft,zt),Et=a.sub(Et,Rt),wt=a.mul(Ft,Ct),wt=a.add(wt,wt),wt=a.add(wt,wt),new lt(Et,xt,wt)}add(dt){at(dt);const{px:pt,py:gt,pz:mt}=this,{px:yt,py:vt,pz:Et}=dt;let xt=a.ZERO,wt=a.ZERO,Rt=a.ZERO;const Ct=s.a,Ft=a.mul(s.b,_3n);let zt=a.mul(pt,yt),Nt=a.mul(gt,vt),Kt=a.mul(mt,Et),Yt=a.add(pt,gt),Bt=a.add(yt,vt);Yt=a.mul(Yt,Bt),Bt=a.add(zt,Nt),Yt=a.sub(Yt,Bt),Bt=a.add(pt,mt);let Pt=a.add(yt,Et);return Bt=a.mul(Bt,Pt),Pt=a.add(zt,Kt),Bt=a.sub(Bt,Pt),Pt=a.add(gt,mt),xt=a.add(vt,Et),Pt=a.mul(Pt,xt),xt=a.add(Nt,Kt),Pt=a.sub(Pt,xt),Rt=a.mul(Ct,Bt),xt=a.mul(Ft,Kt),Rt=a.add(xt,Rt),xt=a.sub(Nt,Rt),Rt=a.add(Nt,Rt),wt=a.mul(xt,Rt),Nt=a.add(zt,zt),Nt=a.add(Nt,zt),Kt=a.mul(Ct,Kt),Bt=a.mul(Ft,Bt),Nt=a.add(Nt,Kt),Kt=a.sub(zt,Kt),Kt=a.mul(Ct,Kt),Bt=a.add(Bt,Kt),zt=a.mul(Nt,Bt),wt=a.add(wt,zt),zt=a.mul(Pt,Bt),xt=a.mul(Yt,xt),xt=a.sub(xt,zt),zt=a.mul(Yt,Nt),Rt=a.mul(Pt,Rt),Rt=a.add(Rt,zt),new lt(xt,wt,Rt)}subtract(dt){return this.add(dt.negate())}is0(){return this.equals(lt.ZERO)}wNAF(dt){return ht.wNAFCached(this,ot,dt,pt=>{const gt=a.invertBatch(pt.map(mt=>mt.pz));return pt.map((mt,yt)=>mt.toAffine(gt[yt])).map(lt.fromAffine)})}multiplyUnsafe(dt){const pt=lt.ZERO;if(dt===_0n)return pt;if(it(dt),dt===_1n$1)return this;const{endo:gt}=s;if(!gt)return ht.unsafeLadder(this,dt);let{k1neg:mt,k1:yt,k2neg:vt,k2:Et}=gt.splitScalar(dt),xt=pt,wt=pt,Rt=this;for(;yt>_0n||Et>_0n;)yt&_1n$1&&(xt=xt.add(Rt)),Et&_1n$1&&(wt=wt.add(Rt)),Rt=Rt.double(),yt>>=_1n$1,Et>>=_1n$1;return mt&&(xt=xt.negate()),vt&&(wt=wt.negate()),wt=new lt(a.mul(wt.px,gt.beta),wt.py,wt.pz),xt.add(wt)}multiply(dt){it(dt);let pt=dt,gt,mt;const{endo:yt}=s;if(yt){const{k1neg:vt,k1:Et,k2neg:xt,k2:wt}=yt.splitScalar(pt);let{p:Rt,f:Ct}=this.wNAF(Et),{p:Ft,f:zt}=this.wNAF(wt);Rt=ht.constTimeNegate(vt,Rt),Ft=ht.constTimeNegate(xt,Ft),Ft=new lt(a.mul(Ft.px,yt.beta),Ft.py,Ft.pz),gt=Rt.add(Ft),mt=Ct.add(zt)}else{const{p:vt,f:Et}=this.wNAF(pt);gt=vt,mt=Et}return lt.normalizeZ([gt,mt])[0]}multiplyAndAddUnsafe(dt,pt,gt){const mt=lt.BASE,yt=(Et,xt)=>xt===_0n||xt===_1n$1||!Et.equals(mt)?Et.multiplyUnsafe(xt):Et.multiply(xt),vt=yt(this,pt).add(yt(dt,gt));return vt.is0()?void 0:vt}toAffine(dt){const{px:pt,py:gt,pz:mt}=this,yt=this.is0();dt==null&&(dt=yt?a.ONE:a.inv(mt));const vt=a.mul(pt,dt),Et=a.mul(gt,dt),xt=a.mul(mt,dt);if(yt)return{x:a.ZERO,y:a.ZERO};if(!a.eql(xt,a.ONE))throw new Error("invZ was invalid");return{x:vt,y:Et}}isTorsionFree(){const{h:dt,isTorsionFree:pt}=s;if(dt===_1n$1)return!0;if(pt)return pt(lt,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:dt,clearCofactor:pt}=s;return dt===_1n$1?this:pt?pt(lt,this):this.multiplyUnsafe(s.h)}toRawBytes(dt=!0){return this.assertValidity(),et(lt,this,dt)}toHex(dt=!0){return bytesToHex(this.toRawBytes(dt))}}lt.BASE=new lt(s.Gx,s.Gy,a.ONE),lt.ZERO=new lt(a.ZERO,a.ONE,a.ZERO);const ct=s.nBitLength,ht=wNAF(lt,s.endo?Math.ceil(ct/2):ct);return{CURVE:s,ProjectivePoint:lt,normPrivateKeyToScalar:st,weierstrassEquation:rt,isWithinCurveOrder:nt}}function validateOpts(o){const s=validateBasic(o);return validateObject(s,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...s})}function weierstrass(o){const s=validateOpts(o),{Fp:a,n:et}=s,tt=a.BYTES+1,rt=2*a.BYTES+1;function nt(Bt){return _0n<Bt&&Bt<a.ORDER}function it(Bt){return mod(Bt,et)}function st(Bt){return invert(Bt,et)}const{ProjectivePoint:ot,normPrivateKeyToScalar:at,weierstrassEquation:lt,isWithinCurveOrder:ct}=weierstrassPoints({...s,toBytes(Bt,Pt,Dt){const Tt=Pt.toAffine(),St=a.toBytes(Tt.x),Mt=concatBytes;return Dt?Mt(Uint8Array.from([Pt.hasEvenY()?2:3]),St):Mt(Uint8Array.from([4]),St,a.toBytes(Tt.y))},fromBytes(Bt){const Pt=Bt.length,Dt=Bt[0],Tt=Bt.subarray(1);if(Pt===tt&&(Dt===2||Dt===3)){const St=bytesToNumberBE(Tt);if(!nt(St))throw new Error("Point is not on curve");const Mt=lt(St);let jt;try{jt=a.sqrt(Mt)}catch(At){const $t=At instanceof Error?": "+At.message:"";throw new Error("Point is not on curve"+$t)}const Gt=(jt&_1n$1)===_1n$1;return(Dt&1)===1!==Gt&&(jt=a.neg(jt)),{x:St,y:jt}}else if(Pt===rt&&Dt===4){const St=a.fromBytes(Tt.subarray(0,a.BYTES)),Mt=a.fromBytes(Tt.subarray(a.BYTES,2*a.BYTES));return{x:St,y:Mt}}else throw new Error(`Point of length ${Pt} was invalid. Expected ${tt} compressed bytes or ${rt} uncompressed bytes`)}}),ht=Bt=>bytesToHex(numberToBytesBE(Bt,s.nByteLength));function ft(Bt){const Pt=et>>_1n$1;return Bt>Pt}function dt(Bt){return ft(Bt)?it(-Bt):Bt}const pt=(Bt,Pt,Dt)=>bytesToNumberBE(Bt.slice(Pt,Dt));class gt{constructor(Pt,Dt,Tt){this.r=Pt,this.s=Dt,this.recovery=Tt,this.assertValidity()}static fromCompact(Pt){const Dt=s.nByteLength;return Pt=ensureBytes$1("compactSignature",Pt,Dt*2),new gt(pt(Pt,0,Dt),pt(Pt,Dt,2*Dt))}static fromDER(Pt){const{r:Dt,s:Tt}=DER.toSig(ensureBytes$1("DER",Pt));return new gt(Dt,Tt)}assertValidity(){if(!ct(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!ct(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(Pt){return new gt(this.r,this.s,Pt)}recoverPublicKey(Pt){const{r:Dt,s:Tt,recovery:St}=this,Mt=wt(ensureBytes$1("msgHash",Pt));if(St==null||![0,1,2,3].includes(St))throw new Error("recovery id invalid");const jt=St===2||St===3?Dt+s.n:Dt;if(jt>=a.ORDER)throw new Error("recovery id 2 or 3 invalid");const Gt=St&1?"03":"02",Ht=ot.fromHex(Gt+ht(jt)),At=st(jt),$t=it(-Mt*At),kt=it(Tt*At),Lt=ot.BASE.multiplyAndAddUnsafe(Ht,$t,kt);if(!Lt)throw new Error("point at infinify");return Lt.assertValidity(),Lt}hasHighS(){return ft(this.s)}normalizeS(){return this.hasHighS()?new gt(this.r,it(-this.s),this.recovery):this}toDERRawBytes(){return hexToBytes(this.toDERHex())}toDERHex(){return DER.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return hexToBytes(this.toCompactHex())}toCompactHex(){return ht(this.r)+ht(this.s)}}const mt={isValidPrivateKey(Bt){try{return at(Bt),!0}catch{return!1}},normPrivateKeyToScalar:at,randomPrivateKey:()=>{const Bt=getMinHashLength(s.n);return mapHashToField(s.randomBytes(Bt),s.n)},precompute(Bt=8,Pt=ot.BASE){return Pt._setWindowSize(Bt),Pt.multiply(BigInt(3)),Pt}};function yt(Bt,Pt=!0){return ot.fromPrivateKey(Bt).toRawBytes(Pt)}function vt(Bt){const Pt=isBytes$2(Bt),Dt=typeof Bt=="string",Tt=(Pt||Dt)&&Bt.length;return Pt?Tt===tt||Tt===rt:Dt?Tt===2*tt||Tt===2*rt:Bt instanceof ot}function Et(Bt,Pt,Dt=!0){if(vt(Bt))throw new Error("first arg must be private key");if(!vt(Pt))throw new Error("second arg must be public key");return ot.fromHex(Pt).multiply(at(Bt)).toRawBytes(Dt)}const xt=s.bits2int||function(Bt){const Pt=bytesToNumberBE(Bt),Dt=Bt.length*8-s.nBitLength;return Dt>0?Pt>>BigInt(Dt):Pt},wt=s.bits2int_modN||function(Bt){return it(xt(Bt))},Rt=bitMask(s.nBitLength);function Ct(Bt){if(typeof Bt!="bigint")throw new Error("bigint expected");if(!(_0n<=Bt&&Bt<Rt))throw new Error(`bigint expected < 2^${s.nBitLength}`);return numberToBytesBE(Bt,s.nByteLength)}function Ft(Bt,Pt,Dt=zt){if(["recovered","canonical"].some(It=>It in Dt))throw new Error("sign() legacy options not supported");const{hash:Tt,randomBytes:St}=s;let{lowS:Mt,prehash:jt,extraEntropy:Gt}=Dt;Mt==null&&(Mt=!0),Bt=ensureBytes$1("msgHash",Bt),jt&&(Bt=ensureBytes$1("prehashed msgHash",Tt(Bt)));const Ht=wt(Bt),At=at(Pt),$t=[Ct(At),Ct(Ht)];if(Gt!=null&&Gt!==!1){const It=Gt===!0?St(a.BYTES):Gt;$t.push(ensureBytes$1("extraEntropy",It))}const kt=concatBytes(...$t),Lt=Ht;function bt(It){const Ut=xt(It);if(!ct(Ut))return;const Wt=st(Ut),Xt=ot.BASE.multiply(Ut).toAffine(),Qt=it(Xt.x);if(Qt===_0n)return;const er=it(Wt*it(Lt+Qt*At));if(er===_0n)return;let lr=(Xt.x===Qt?0:2)|Number(Xt.y&_1n$1),pr=er;return Mt&&ft(er)&&(pr=dt(er),lr^=1),new gt(Qt,pr,lr)}return{seed:kt,k2sig:bt}}const zt={lowS:s.lowS,prehash:!1},Nt={lowS:s.lowS,prehash:!1};function Kt(Bt,Pt,Dt=zt){const{seed:Tt,k2sig:St}=Ft(Bt,Pt,Dt),Mt=s;return createHmacDrbg(Mt.hash.outputLen,Mt.nByteLength,Mt.hmac)(Tt,St)}ot.BASE._setWindowSize(8);function Yt(Bt,Pt,Dt,Tt=Nt){const St=Bt;if(Pt=ensureBytes$1("msgHash",Pt),Dt=ensureBytes$1("publicKey",Dt),"strict"in Tt)throw new Error("options.strict was renamed to lowS");const{lowS:Mt,prehash:jt}=Tt;let Gt,Ht;try{if(typeof St=="string"||isBytes$2(St))try{Gt=gt.fromDER(St)}catch(Xt){if(!(Xt instanceof DER.Err))throw Xt;Gt=gt.fromCompact(St)}else if(typeof St=="object"&&typeof St.r=="bigint"&&typeof St.s=="bigint"){const{r:Xt,s:Qt}=St;Gt=new gt(Xt,Qt)}else throw new Error("PARSE");Ht=ot.fromHex(Dt)}catch(Xt){if(Xt.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(Mt&&Gt.hasHighS())return!1;jt&&(Pt=s.hash(Pt));const{r:At,s:$t}=Gt,kt=wt(Pt),Lt=st($t),bt=it(kt*Lt),It=it(At*Lt),Ut=ot.BASE.multiplyAndAddUnsafe(Ht,bt,It)?.toAffine();return Ut?it(Ut.x)===At:!1}return{CURVE:s,getPublicKey:yt,getSharedSecret:Et,sign:Kt,verify:Yt,ProjectivePoint:ot,Signature:gt,utils:mt}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function getHash(o){return{hash:o,hmac:(s,...a)=>hmac(o,s,concatBytes$1(...a)),randomBytes:randomBytes$1}}function createCurve(o,s){const a=et=>weierstrass({...o,...getHash(et)});return Object.freeze({...a(s),create:a})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const secp256k1P=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),secp256k1N=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),_1n=BigInt(1),_2n=BigInt(2),divNearest=(o,s)=>(o+s/_2n)/s;function sqrtMod(o){const s=secp256k1P,a=BigInt(3),et=BigInt(6),tt=BigInt(11),rt=BigInt(22),nt=BigInt(23),it=BigInt(44),st=BigInt(88),ot=o*o*o%s,at=ot*ot*o%s,lt=pow2(at,a,s)*at%s,ct=pow2(lt,a,s)*at%s,ht=pow2(ct,_2n,s)*ot%s,ft=pow2(ht,tt,s)*ht%s,dt=pow2(ft,rt,s)*ft%s,pt=pow2(dt,it,s)*dt%s,gt=pow2(pt,st,s)*pt%s,mt=pow2(gt,it,s)*dt%s,yt=pow2(mt,a,s)*at%s,vt=pow2(yt,nt,s)*ft%s,Et=pow2(vt,et,s)*ot%s,xt=pow2(Et,_2n,s);if(!Fp.eql(Fp.sqr(xt),o))throw new Error("Cannot find square root");return xt}const Fp=Field(secp256k1P,void 0,void 0,{sqrt:sqrtMod}),secp256k1=createCurve({a:BigInt(0),b:BigInt(7),Fp,n:secp256k1N,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:o=>{const s=secp256k1N,a=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),et=-_1n*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),tt=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),rt=a,nt=BigInt("0x100000000000000000000000000000000"),it=divNearest(rt*o,s),st=divNearest(-et*o,s);let ot=mod(o-it*a-st*tt,s),at=mod(-it*et-st*rt,s);const lt=ot>nt,ct=at>nt;if(lt&&(ot=s-ot),ct&&(at=s-at),ot>nt||at>nt)throw new Error("splitScalar: Endomorphism failed, k="+o);return{k1neg:lt,k1:ot,k2neg:ct,k2:at}}}},sha256);BigInt(0);secp256k1.ProjectivePoint;function generateKey(){return secp256k1.utils.randomPrivateKey()}function hashAndSign(o,s){const a=sha256$1.digest(s instanceof Uint8Array?s:s.subarray());if(isPromise$6(a))return a.then(({digest:et})=>secp256k1.sign(et,o).toDERRawBytes()).catch(et=>{throw new CodeError$3(String(et),"ERR_INVALID_INPUT")});try{return secp256k1.sign(a.digest,o).toDERRawBytes()}catch(et){throw new CodeError$3(String(et),"ERR_INVALID_INPUT")}}function hashAndVerify(o,s,a){const et=sha256$1.digest(a instanceof Uint8Array?a:a.subarray());if(isPromise$6(et))return et.then(({digest:tt})=>secp256k1.verify(s,tt,o)).catch(tt=>{throw new CodeError$3(String(tt),"ERR_INVALID_INPUT")});try{return secp256k1.verify(s,et.digest,o)}catch(tt){throw new CodeError$3(String(tt),"ERR_INVALID_INPUT")}}function compressPublicKey(o){return secp256k1.ProjectivePoint.fromHex(o).toRawBytes(!0)}function validatePrivateKey(o){try{secp256k1.getPublicKey(o,!0)}catch(s){throw new CodeError$3(String(s),"ERR_INVALID_PRIVATE_KEY")}}function validatePublicKey(o){try{secp256k1.ProjectivePoint.fromHex(o)}catch(s){throw new CodeError$3(String(s),"ERR_INVALID_PUBLIC_KEY")}}function computePublicKey(o){try{return secp256k1.getPublicKey(o,!0)}catch(s){throw new CodeError$3(String(s),"ERR_INVALID_PRIVATE_KEY")}}class Secp256k1PublicKey{_key;constructor(s){validatePublicKey(s),this._key=s}verify(s,a){return hashAndVerify(this._key,a,s)}marshal(){return compressPublicKey(this._key)}get bytes(){return PublicKey.encode({Type:KeyType.Secp256k1,Data:this.marshal()}).subarray()}equals(s){return equals$e(this.bytes,s.bytes)}async hash(){const s=sha256$1.digest(this.bytes);let a;return isPromise$6(s)?{bytes:a}=await s:a=s.bytes,a}}class Secp256k1PrivateKey{_key;_publicKey;constructor(s,a){this._key=s,this._publicKey=a??computePublicKey(s),validatePrivateKey(this._key),validatePublicKey(this._publicKey)}sign(s){return hashAndSign(this._key,s)}get public(){return new Secp256k1PublicKey(this._publicKey)}marshal(){return this._key}get bytes(){return PrivateKey.encode({Type:KeyType.Secp256k1,Data:this.marshal()}).subarray()}equals(s){return equals$e(this.bytes,s.bytes)}hash(){const s=sha256$1.digest(this.bytes);return isPromise$6(s)?s.then(({bytes:a})=>a):s.bytes}async id(){const s=await this.public.hash();return toString$i(s,"base58btc")}async export(s,a="libp2p-key"){if(a==="libp2p-key")return exporter$1(this.bytes,s);throw new CodeError$3(`export format '${a}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function unmarshalSecp256k1PrivateKey(o){return new Secp256k1PrivateKey(o)}function unmarshalSecp256k1PublicKey(o){return new Secp256k1PublicKey(o)}async function generateKeyPair$1(){const o=generateKey();return new Secp256k1PrivateKey(o)}const Secp256k1=Object.freeze(Object.defineProperty({__proto__:null,Secp256k1PrivateKey,Secp256k1PublicKey,generateKeyPair:generateKeyPair$1,unmarshalSecp256k1PrivateKey,unmarshalSecp256k1PublicKey},Symbol.toStringTag,{value:"Module"})),supportedKeys={rsa:RSA,ed25519:Ed25519,secp256k1:Secp256k1};function unsupportedKey(o){const s=Object.keys(supportedKeys).join(" / ");return new CodeError$3(`invalid or unsupported key type ${o}. Must be ${s}`,"ERR_UNSUPPORTED_KEY_TYPE")}function typeToKey(o){if(o=o.toLowerCase(),o==="rsa"||o==="ed25519"||o==="secp256k1")return supportedKeys[o];throw unsupportedKey(o)}async function generateKeyPair(o,s){return typeToKey(o).generateKeyPair(s??2048)}function unmarshalPublicKey(o){const s=PublicKey.decode(o),a=s.Data??new Uint8Array;switch(s.Type){case KeyType.RSA:return supportedKeys.rsa.unmarshalRsaPublicKey(a);case KeyType.Ed25519:return supportedKeys.ed25519.unmarshalEd25519PublicKey(a);case KeyType.Secp256k1:return supportedKeys.secp256k1.unmarshalSecp256k1PublicKey(a);default:throw unsupportedKey(s.Type??"unknown")}}function marshalPublicKey(o,s){return s=(s??"rsa").toLowerCase(),typeToKey(s),o.bytes}async function unmarshalPrivateKey(o){const s=PrivateKey.decode(o),a=s.Data??new Uint8Array;switch(s.Type){case KeyType.RSA:return supportedKeys.rsa.unmarshalRsaPrivateKey(a);case KeyType.Ed25519:return supportedKeys.ed25519.unmarshalEd25519PrivateKey(a);case KeyType.Secp256k1:return supportedKeys.secp256k1.unmarshalSecp256k1PrivateKey(a);default:throw unsupportedKey(s.Type??"RSA")}}function marshalPrivateKey(o,s){return s=(s??"rsa").toLowerCase(),typeToKey(s),o.bytes}async function importKey(o,s){try{const a=await importer$1(o,s);return await unmarshalPrivateKey(a)}catch{}if(!o.includes("BEGIN"))throw new CodeError$3("Encrypted key was not a libp2p-key or a PEM file","ERR_INVALID_IMPORT_FORMAT");return importFromPem(o,s)}const SHA1_IV=new Uint32Array([1732584193,4023233417,2562383102,271733878,3285377520]),SHA1_W=new Uint32Array(80);class SHA1 extends HashMD{constructor(){super(64,20,8,!1),this.A=SHA1_IV[0]|0,this.B=SHA1_IV[1]|0,this.C=SHA1_IV[2]|0,this.D=SHA1_IV[3]|0,this.E=SHA1_IV[4]|0}get(){const{A:s,B:a,C:et,D:tt,E:rt}=this;return[s,a,et,tt,rt]}set(s,a,et,tt,rt){this.A=s|0,this.B=a|0,this.C=et|0,this.D=tt|0,this.E=rt|0}process(s,a){for(let st=0;st<16;st++,a+=4)SHA1_W[st]=s.getUint32(a,!1);for(let st=16;st<80;st++)SHA1_W[st]=rotl$1(SHA1_W[st-3]^SHA1_W[st-8]^SHA1_W[st-14]^SHA1_W[st-16],1);let{A:et,B:tt,C:rt,D:nt,E:it}=this;for(let st=0;st<80;st++){let ot,at;st<20?(ot=Chi(tt,rt,nt),at=1518500249):st<40?(ot=tt^rt^nt,at=1859775393):st<60?(ot=Maj(tt,rt,nt),at=2400959708):(ot=tt^rt^nt,at=3395469782);const lt=rotl$1(et,5)+ot+it+at+SHA1_W[st]|0;it=nt,nt=rt,rt=rotl$1(tt,30),tt=et,et=lt}et=et+this.A|0,tt=tt+this.B|0,rt=rt+this.C|0,nt=nt+this.D|0,it=it+this.E|0,this.set(et,tt,rt,nt,it)}roundClean(){SHA1_W.fill(0)}destroy(){this.set(0,0,0,0,0),this.buffer.fill(0)}}const sha1=wrapConstructor(()=>new SHA1),hashName={sha1,"sha2-256":sha256,"sha2-512":sha512};function pbkdf2(o,s,a,et,tt){if(tt!=="sha1"&&tt!=="sha2-256"&&tt!=="sha2-512"){const it=Object.keys(hashName).join(" / ");throw new CodeError$3(`Hash '${tt}' is unknown or not supported. Must be ${it}`,"ERR_UNSUPPORTED_HASH_TYPE")}const rt=hashName[tt],nt=pbkdf2$1(rt,o,s,{c:a,dkLen:et});return base64.encode(nt).substring(1)}var murmurHash3js={exports:{}};(function(o,s){(function(a,et){var tt={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function rt(dt){if(!Array.isArray(dt)&&!ArrayBuffer.isView(dt))return!1;for(var pt=0;pt<dt.length;pt++)if(!Number.isInteger(dt[pt])||dt[pt]<0||dt[pt]>255)return!1;return!0}function nt(dt,pt){return(dt&65535)*pt+(((dt>>>16)*pt&65535)<<16)}function it(dt,pt){return dt<<pt|dt>>>32-pt}function st(dt){return dt^=dt>>>16,dt=nt(dt,2246822507),dt^=dt>>>13,dt=nt(dt,3266489909),dt^=dt>>>16,dt}function ot(dt,pt){dt=[dt[0]>>>16,dt[0]&65535,dt[1]>>>16,dt[1]&65535],pt=[pt[0]>>>16,pt[0]&65535,pt[1]>>>16,pt[1]&65535];var gt=[0,0,0,0];return gt[3]+=dt[3]+pt[3],gt[2]+=gt[3]>>>16,gt[3]&=65535,gt[2]+=dt[2]+pt[2],gt[1]+=gt[2]>>>16,gt[2]&=65535,gt[1]+=dt[1]+pt[1],gt[0]+=gt[1]>>>16,gt[1]&=65535,gt[0]+=dt[0]+pt[0],gt[0]&=65535,[gt[0]<<16|gt[1],gt[2]<<16|gt[3]]}function at(dt,pt){dt=[dt[0]>>>16,dt[0]&65535,dt[1]>>>16,dt[1]&65535],pt=[pt[0]>>>16,pt[0]&65535,pt[1]>>>16,pt[1]&65535];var gt=[0,0,0,0];return gt[3]+=dt[3]*pt[3],gt[2]+=gt[3]>>>16,gt[3]&=65535,gt[2]+=dt[2]*pt[3],gt[1]+=gt[2]>>>16,gt[2]&=65535,gt[2]+=dt[3]*pt[2],gt[1]+=gt[2]>>>16,gt[2]&=65535,gt[1]+=dt[1]*pt[3],gt[0]+=gt[1]>>>16,gt[1]&=65535,gt[1]+=dt[2]*pt[2],gt[0]+=gt[1]>>>16,gt[1]&=65535,gt[1]+=dt[3]*pt[1],gt[0]+=gt[1]>>>16,gt[1]&=65535,gt[0]+=dt[0]*pt[3]+dt[1]*pt[2]+dt[2]*pt[1]+dt[3]*pt[0],gt[0]&=65535,[gt[0]<<16|gt[1],gt[2]<<16|gt[3]]}function lt(dt,pt){return pt%=64,pt===32?[dt[1],dt[0]]:pt<32?[dt[0]<<pt|dt[1]>>>32-pt,dt[1]<<pt|dt[0]>>>32-pt]:(pt-=32,[dt[1]<<pt|dt[0]>>>32-pt,dt[0]<<pt|dt[1]>>>32-pt])}function ct(dt,pt){return pt%=64,pt===0?dt:pt<32?[dt[0]<<pt|dt[1]>>>32-pt,dt[1]<<pt]:[dt[1]<<pt-32,0]}function ht(dt,pt){return[dt[0]^pt[0],dt[1]^pt[1]]}function ft(dt){return dt=ht(dt,[0,dt[0]>>>1]),dt=at(dt,[4283543511,3981806797]),dt=ht(dt,[0,dt[0]>>>1]),dt=at(dt,[3301882366,444984403]),dt=ht(dt,[0,dt[0]>>>1]),dt}tt.x86.hash32=function(dt,pt){if(tt.inputValidation&&!rt(dt))return et;pt=pt||0;for(var gt=dt.length%4,mt=dt.length-gt,yt=pt,vt=0,Et=3432918353,xt=461845907,wt=0;wt<mt;wt=wt+4)vt=dt[wt]|dt[wt+1]<<8|dt[wt+2]<<16|dt[wt+3]<<24,vt=nt(vt,Et),vt=it(vt,15),vt=nt(vt,xt),yt^=vt,yt=it(yt,13),yt=nt(yt,5)+3864292196;switch(vt=0,gt){case 3:vt^=dt[wt+2]<<16;case 2:vt^=dt[wt+1]<<8;case 1:vt^=dt[wt],vt=nt(vt,Et),vt=it(vt,15),vt=nt(vt,xt),yt^=vt}return yt^=dt.length,yt=st(yt),yt>>>0},tt.x86.hash128=function(dt,pt){if(tt.inputValidation&&!rt(dt))return et;pt=pt||0;for(var gt=dt.length%16,mt=dt.length-gt,yt=pt,vt=pt,Et=pt,xt=pt,wt=0,Rt=0,Ct=0,Ft=0,zt=597399067,Nt=2869860233,Kt=951274213,Yt=2716044179,Bt=0;Bt<mt;Bt=Bt+16)wt=dt[Bt]|dt[Bt+1]<<8|dt[Bt+2]<<16|dt[Bt+3]<<24,Rt=dt[Bt+4]|dt[Bt+5]<<8|dt[Bt+6]<<16|dt[Bt+7]<<24,Ct=dt[Bt+8]|dt[Bt+9]<<8|dt[Bt+10]<<16|dt[Bt+11]<<24,Ft=dt[Bt+12]|dt[Bt+13]<<8|dt[Bt+14]<<16|dt[Bt+15]<<24,wt=nt(wt,zt),wt=it(wt,15),wt=nt(wt,Nt),yt^=wt,yt=it(yt,19),yt+=vt,yt=nt(yt,5)+1444728091,Rt=nt(Rt,Nt),Rt=it(Rt,16),Rt=nt(Rt,Kt),vt^=Rt,vt=it(vt,17),vt+=Et,vt=nt(vt,5)+197830471,Ct=nt(Ct,Kt),Ct=it(Ct,17),Ct=nt(Ct,Yt),Et^=Ct,Et=it(Et,15),Et+=xt,Et=nt(Et,5)+2530024501,Ft=nt(Ft,Yt),Ft=it(Ft,18),Ft=nt(Ft,zt),xt^=Ft,xt=it(xt,13),xt+=yt,xt=nt(xt,5)+850148119;switch(wt=0,Rt=0,Ct=0,Ft=0,gt){case 15:Ft^=dt[Bt+14]<<16;case 14:Ft^=dt[Bt+13]<<8;case 13:Ft^=dt[Bt+12],Ft=nt(Ft,Yt),Ft=it(Ft,18),Ft=nt(Ft,zt),xt^=Ft;case 12:Ct^=dt[Bt+11]<<24;case 11:Ct^=dt[Bt+10]<<16;case 10:Ct^=dt[Bt+9]<<8;case 9:Ct^=dt[Bt+8],Ct=nt(Ct,Kt),Ct=it(Ct,17),Ct=nt(Ct,Yt),Et^=Ct;case 8:Rt^=dt[Bt+7]<<24;case 7:Rt^=dt[Bt+6]<<16;case 6:Rt^=dt[Bt+5]<<8;case 5:Rt^=dt[Bt+4],Rt=nt(Rt,Nt),Rt=it(Rt,16),Rt=nt(Rt,Kt),vt^=Rt;case 4:wt^=dt[Bt+3]<<24;case 3:wt^=dt[Bt+2]<<16;case 2:wt^=dt[Bt+1]<<8;case 1:wt^=dt[Bt],wt=nt(wt,zt),wt=it(wt,15),wt=nt(wt,Nt),yt^=wt}return yt^=dt.length,vt^=dt.length,Et^=dt.length,xt^=dt.length,yt+=vt,yt+=Et,yt+=xt,vt+=yt,Et+=yt,xt+=yt,yt=st(yt),vt=st(vt),Et=st(Et),xt=st(xt),yt+=vt,yt+=Et,yt+=xt,vt+=yt,Et+=yt,xt+=yt,("00000000"+(yt>>>0).toString(16)).slice(-8)+("00000000"+(vt>>>0).toString(16)).slice(-8)+("00000000"+(Et>>>0).toString(16)).slice(-8)+("00000000"+(xt>>>0).toString(16)).slice(-8)},tt.x64.hash128=function(dt,pt){if(tt.inputValidation&&!rt(dt))return et;pt=pt||0;for(var gt=dt.length%16,mt=dt.length-gt,yt=[0,pt],vt=[0,pt],Et=[0,0],xt=[0,0],wt=[2277735313,289559509],Rt=[1291169091,658871167],Ct=0;Ct<mt;Ct=Ct+16)Et=[dt[Ct+4]|dt[Ct+5]<<8|dt[Ct+6]<<16|dt[Ct+7]<<24,dt[Ct]|dt[Ct+1]<<8|dt[Ct+2]<<16|dt[Ct+3]<<24],xt=[dt[Ct+12]|dt[Ct+13]<<8|dt[Ct+14]<<16|dt[Ct+15]<<24,dt[Ct+8]|dt[Ct+9]<<8|dt[Ct+10]<<16|dt[Ct+11]<<24],Et=at(Et,wt),Et=lt(Et,31),Et=at(Et,Rt),yt=ht(yt,Et),yt=lt(yt,27),yt=ot(yt,vt),yt=ot(at(yt,[0,5]),[0,1390208809]),xt=at(xt,Rt),xt=lt(xt,33),xt=at(xt,wt),vt=ht(vt,xt),vt=lt(vt,31),vt=ot(vt,yt),vt=ot(at(vt,[0,5]),[0,944331445]);switch(Et=[0,0],xt=[0,0],gt){case 15:xt=ht(xt,ct([0,dt[Ct+14]],48));case 14:xt=ht(xt,ct([0,dt[Ct+13]],40));case 13:xt=ht(xt,ct([0,dt[Ct+12]],32));case 12:xt=ht(xt,ct([0,dt[Ct+11]],24));case 11:xt=ht(xt,ct([0,dt[Ct+10]],16));case 10:xt=ht(xt,ct([0,dt[Ct+9]],8));case 9:xt=ht(xt,[0,dt[Ct+8]]),xt=at(xt,Rt),xt=lt(xt,33),xt=at(xt,wt),vt=ht(vt,xt);case 8:Et=ht(Et,ct([0,dt[Ct+7]],56));case 7:Et=ht(Et,ct([0,dt[Ct+6]],48));case 6:Et=ht(Et,ct([0,dt[Ct+5]],40));case 5:Et=ht(Et,ct([0,dt[Ct+4]],32));case 4:Et=ht(Et,ct([0,dt[Ct+3]],24));case 3:Et=ht(Et,ct([0,dt[Ct+2]],16));case 2:Et=ht(Et,ct([0,dt[Ct+1]],8));case 1:Et=ht(Et,[0,dt[Ct]]),Et=at(Et,wt),Et=lt(Et,31),Et=at(Et,Rt),yt=ht(yt,Et)}return yt=ht(yt,[0,dt.length]),vt=ht(vt,[0,dt.length]),yt=ot(yt,vt),vt=ot(vt,yt),yt=ft(yt),vt=ft(vt),yt=ot(yt,vt),vt=ot(vt,yt),("00000000"+(yt[0]>>>0).toString(16)).slice(-8)+("00000000"+(yt[1]>>>0).toString(16)).slice(-8)+("00000000"+(vt[0]>>>0).toString(16)).slice(-8)+("00000000"+(vt[1]>>>0).toString(16)).slice(-8)},o.exports&&(s=o.exports=tt),s.murmurHash3=tt})()})(murmurHash3js,murmurHash3js.exports);var murmurHash3jsExports=murmurHash3js.exports,murmurhash3jsRevisited=murmurHash3jsExports;const mur=getDefaultExportFromCjs$2(murmurhash3jsRevisited);function alloc$8(o=0){return new Uint8Array(o)}function allocUnsafe$m(o=0){return new Uint8Array(o)}function createCodec$n(o,s,a,et){return{name:o,prefix:s,encoder:{name:o,prefix:s,encode:a},decoder:{decode:et}}}const string$o=createCodec$n("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),ascii$n=createCodec$n("ascii","a",o=>{let s="a";for(let a=0;a<o.length;a++)s+=String.fromCharCode(o[a]);return s},o=>{o=o.substring(1);const s=allocUnsafe$m(o.length);for(let a=0;a<o.length;a++)s[a]=o.charCodeAt(a);return s}),BASES$n={utf8:string$o,"utf-8":string$o,hex:bases.base16,latin1:ascii$n,ascii:ascii$n,binary:ascii$n,...bases};function fromString$o(o,s="utf8"){const a=BASES$n[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.decoder.decode(`${a.prefix}${o}`)}const LN2_SQUARED$1=Math.LN2*Math.LN2;let BloomFilter$1=class{seeds;bits;buffer;constructor(s={}){s.seeds!=null?this.seeds=s.seeds:this.seeds=generateSeeds$1(s.hashes??8),this.bits=s.bits??1024,this.buffer=alloc$8(Math.ceil(this.bits/8))}add(s){typeof s=="string"&&(s=fromString$o(s));for(let a=0;a<this.seeds.length;a++){const tt=mur.x86.hash32(s,this.seeds[a])%this.bits;this.setbit(tt)}}has(s){typeof s=="string"&&(s=fromString$o(s));for(let a=0;a<this.seeds.length;a++){const tt=mur.x86.hash32(s,this.seeds[a])%this.bits;if(!this.getbit(tt))return!1}return!0}clear(){this.buffer.fill(0)}setbit(s){let a=0,et=s;for(;et>7;)a++,et-=8;let tt=this.buffer[a];tt|=1<<et,this.buffer[a]=tt}getbit(s){let a=0,et=s;for(;et>7;)a++,et-=8;return(this.buffer[a]&1<<et)!==0}};function createBloomFilter(o,s=.005){const a=optimize$2(o,s);return new BloomFilter$1(a)}function optimize$2(o,s=.005){const a=Math.round(-1*o*Math.log(s)/LN2_SQUARED$1),et=Math.round(a/o*Math.LN2);return{bits:a,hashes:et}}function generateSeeds$1(o){let s,a;const et=[];for(let tt=0;tt<o;tt++)for(s=new Uint8ArrayList(randomBytes(4)),et[tt]=s.getUint32(0,!0),a=0;a<tt;a++)if(et[tt]===et[a]){tt--;break}return et}function equals$d(o,s){if(o===s)return!0;if(o.byteLength!==s.byteLength)return!1;for(let a=0;a<o.byteLength;a++)if(o[a]!==s[a])return!1;return!0}const MAX_FINGERPRINT_SIZE=64;class Fingerprint{fp;h;seed;constructor(s,a,et,tt=2){if(tt>MAX_FINGERPRINT_SIZE)throw new TypeError("Invalid Fingerprint Size");const rt=a.hashV(s,et),nt=alloc$8(tt);for(let it=0;it<nt.length;it++)nt[it]=rt[it];nt.length===0&&(nt[0]=7),this.fp=nt,this.h=a,this.seed=et}hash(){return this.h.hash(this.fp,this.seed)}equals(s){return s?.fp instanceof Uint8Array?equals$d(this.fp,s.fp):!1}}function getRandomInt(o,s){return Math.floor(Math.random()*(s-o))+o}let Bucket$1=class{contents;constructor(s){this.contents=new Array(s).fill(null)}has(s){if(!(s instanceof Fingerprint))throw new TypeError("Invalid Fingerprint");return this.contents.some(a=>s.equals(a))}add(s){if(!(s instanceof Fingerprint))throw new TypeError("Invalid Fingerprint");for(let a=0;a<this.contents.length;a++)if(this.contents[a]==null)return this.contents[a]=s,!0;return!0}swap(s){if(!(s instanceof Fingerprint))throw new TypeError("Invalid Fingerprint");const a=getRandomInt(0,this.contents.length-1),et=this.contents[a];return this.contents[a]=s,et}remove(s){if(!(s instanceof Fingerprint))throw new TypeError("Invalid Fingerprint");const a=this.contents.findIndex(et=>s.equals(et));return a>-1?(this.contents[a]=null,!0):!1}};const FNV_PRIMES={32:16777619n,64:1099511628211n,128:309485009821345068724781371n,256:374144419156711147060143317175368453031918731002211n,512:35835915874844867368919076489095108449946327955754392558399825615420669938882575126094039892345713852759n,1024:5016456510113118655434598811035278955030765345404790744303017523831112055108147451509157692220295382716162651878526895249385292291816524375083746691371804094271873160484737966720260389217684476157468082573n},FNV_OFFSETS={32:2166136261n,64:14695981039346656037n,128:144066263297769815596495629667062367629n,256:100029257958052580907070968620625704837092796014241193945225284501741471925557n,512:9659303129496669498009435400716310466090418745672637896108374329434462657994582932197716438449813051892206539805784495328239340083876191928701583869517785n,1024:14197795064947621068722070641403218320880622795441933960878474914617582723252296732303717722150864096521202355549365628174669108571814760471015076148029755969804077320157692458563003215304957150157403644460363550505412711285966361610267868082893823963790439336411086884584107735010676915n},cachedEncoder=new globalThis.TextEncoder;function fnv1aUint8Array(o,s){const a=FNV_PRIMES[s];let et=FNV_OFFSETS[s];for(let tt=0;tt<o.length;tt++)et^=BigInt(o[tt]),et=BigInt.asUintN(s,et*a);return et}function fnv1aEncodeInto(o,s,a){if(a.length===0)throw new Error("The `utf8Buffer` option must have a length greater than zero");const et=FNV_PRIMES[s];let tt=FNV_OFFSETS[s],rt=o;for(;rt.length>0;){const nt=cachedEncoder.encodeInto(rt,a);rt=rt.slice(nt.read);for(let it=0;it<nt.written;it++)tt^=BigInt(a[it]),tt=BigInt.asUintN(s,tt*et)}return tt}function fnv1a$1(o,{size:s=32,utf8Buffer:a}={}){if(!FNV_PRIMES[s])throw new Error("The `size` option must be one of 32, 64, 128, 256, 512, or 1024");if(typeof o=="string"){if(a)return fnv1aEncodeInto(o,s,a);o=cachedEncoder.encode(o)}return fnv1aUint8Array(o,s)}const fnv1a={hash:o=>Number(fnv1a$1(o,{size:32})),hashV:(o,s)=>numberToBuffer(fnv1a.hash(o,s))};function numberToBuffer(o){let s=o.toString(16);return s.length%2===1&&(s=`0${s}`),fromString$o(s,"base16")}const maxCuckooCount=500;class CuckooFilter{bucketSize;filterSize;fingerprintSize;buckets;count;hash;seed;constructor(s){this.filterSize=s.filterSize,this.bucketSize=s.bucketSize??4,this.fingerprintSize=s.fingerprintSize??2,this.count=0,this.buckets=[],this.hash=s.hash??fnv1a,this.seed=s.seed??getRandomInt(0,Math.pow(2,10))}add(s){typeof s=="string"&&(s=fromString$o(s));const a=new Fingerprint(s,this.hash,this.seed,this.fingerprintSize),et=this.hash.hash(s,this.seed)%this.filterSize,tt=(et^a.hash())%this.filterSize;if(this.buckets[et]==null&&(this.buckets[et]=new Bucket$1(this.bucketSize)),this.buckets[tt]==null&&(this.buckets[tt]=new Bucket$1(this.bucketSize)),this.buckets[et].add(a)||this.buckets[tt].add(a))return this.count++,!0;const rt=[et,tt];let nt=rt[getRandomInt(0,rt.length-1)];this.buckets[nt]==null&&(this.buckets[nt]=new Bucket$1(this.bucketSize));for(let it=0;it<maxCuckooCount;it++){const st=this.buckets[nt].swap(a);if(st!=null&&(nt=(nt^st.hash())%this.filterSize,this.buckets[nt]==null&&(this.buckets[nt]=new Bucket$1(this.bucketSize)),this.buckets[nt].add(st)))return this.count++,!0}return!1}has(s){typeof s=="string"&&(s=fromString$o(s));const a=new Fingerprint(s,this.hash,this.seed,this.fingerprintSize),et=this.hash.hash(s,this.seed)%this.filterSize,tt=this.buckets[et]?.has(a)??!1;if(tt)return tt;const rt=(et^a.hash())%this.filterSize;return this.buckets[rt]?.has(a)??!1}remove(s){typeof s=="string"&&(s=fromString$o(s));const a=new Fingerprint(s,this.hash,this.seed,this.fingerprintSize),et=this.hash.hash(s,this.seed)%this.filterSize,tt=this.buckets[et]?.remove(a)??!1;if(tt)return this.count--,tt;const rt=(et^a.hash())%this.filterSize,nt=this.buckets[rt]?.remove(a)??!1;return nt&&this.count--,nt}get reliable(){return Math.floor(100*(this.count/this.filterSize))<=95}}const MAX_LOAD={1:.5,2:.84,4:.95,8:.98};function calculateBucketSize(o=.001){return o>.002?2:o>1e-5?4:8}function optimize$1(o,s=.001){const a=calculateBucketSize(s),et=MAX_LOAD[a],tt=Math.round(o/et),rt=Math.min(Math.ceil(Math.log(tt/a))+2,MAX_FINGERPRINT_SIZE);return{filterSize:tt,bucketSize:a,fingerprintSize:rt}}class ScalableCuckooFilter{filterSize;bucketSize;fingerprintSize;scale;filterSeries;hash;seed;constructor(s){this.bucketSize=s.bucketSize??4,this.filterSize=s.filterSize??(1<<18)/this.bucketSize,this.fingerprintSize=s.fingerprintSize??2,this.scale=s.scale??2,this.hash=s.hash??fnv1a,this.seed=s.seed??getRandomInt(0,Math.pow(2,10)),this.filterSeries=[new CuckooFilter({filterSize:this.filterSize,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed})]}add(s){if(typeof s=="string"&&(s=fromString$o(s)),this.has(s))return!0;let a=this.filterSeries.find(et=>et.reliable);if(a==null){const et=this.filterSize*Math.pow(this.scale,this.filterSeries.length);a=new CuckooFilter({filterSize:et,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed}),this.filterSeries.push(a)}return a.add(s)}has(s){typeof s=="string"&&(s=fromString$o(s));for(let a=0;a<this.filterSeries.length;a++)if(this.filterSeries[a].has(s))return!0;return!1}remove(s){typeof s=="string"&&(s=fromString$o(s));for(let a=0;a<this.filterSeries.length;a++)if(this.filterSeries[a].remove(s))return!0;return!1}get count(){return this.filterSeries.reduce((s,a)=>s+a.count,0)}}function createScalableCuckooFilter(o,s=.001,a){return new ScalableCuckooFilter({...optimize$1(o,s)})}class PeerFilter{filter;constructor(s,a){this.filter=createScalableCuckooFilter(s,a)}has(s){return this.filter.has(s.toBytes())}add(s){this.filter.add(s.toBytes())}remove(s){this.filter.remove?.(s.toBytes())}}function peerFilter(o,s=.001){return new PeerFilter(o,s)}class TrackedPeerMap extends PeerMap{metric;constructor(s){super();const{name:a,metrics:et}=s;this.metric=et.registerMetric(a),this.updateComponentMetric()}set(s,a){return super.set(s,a),this.updateComponentMetric(),this}delete(s){const a=super.delete(s);return this.updateComponentMetric(),a}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function trackedPeerMap(o){const{name:s,metrics:a}=o;let et;return a!=null?et=new TrackedPeerMap({name:s,metrics:a}):et=new PeerMap,et}function createCodec$m(o,s,a,et){return{name:o,prefix:s,encoder:{name:o,prefix:s,encode:a},decoder:{decode:et}}}const string$n=createCodec$m("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),ascii$m=createCodec$m("ascii","a",o=>{let s="a";for(let a=0;a<o.length;a++)s+=String.fromCharCode(o[a]);return s},o=>{o=o.substring(1);const s=allocUnsafe$o(o.length);for(let a=0;a<o.length;a++)s[a]=o.charCodeAt(a);return s}),BASES$m={utf8:string$n,"utf-8":string$n,hex:bases.base16,latin1:ascii$m,ascii:ascii$m,binary:ascii$m,...bases};function toString$h(o,s="utf8"){const a=BASES$m[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.encoder.encode(o).substring(1)}class QueuedBitswapMessage{full;pendingBytes;wantlist;blocks;blockPresences;constructor(s=!1,a=0){this.full=s,this.wantlist=new Map,this.blocks=new Map,this.blockPresences=new Map,this.pendingBytes=0}addWantlistEntry(s,a){const et=base64.encode(s.multihash.bytes);this.wantlist.set(et,a)}addBlockPresence(s,a){const et=base64.encode(s.multihash.bytes);this.blockPresences.set(et,a)}addBlock(s,a){const et=base64.encode(s.multihash.bytes);this.blocks.set(et,a)}}function varintEncoder(o){let s=new Uint8Array(o.reduce((et,tt)=>et+encodingLength$1(tt),0)),a=0;for(const et of o)s=encode$c(et,s,a),a+=encodingLength$1(et);return s}function cidToPrefix(o){return varintEncoder([o.version,o.code,o.multihash.code,o.multihash.digest.byteLength])}class Ledger{peerId;blockstore;network;wants;exchangeCount;bytesSent;bytesReceived;lastExchange;maxSizeReplaceHasWithBlock;log;constructor(s,a){this.peerId=s.peerId,this.blockstore=s.blockstore,this.network=s.network,this.wants=new Map,this.log=s.logger.forComponent(`helia:bitswap:ledger:${s.peerId}`),this.exchangeCount=0,this.bytesSent=0,this.bytesReceived=0,this.maxSizeReplaceHasWithBlock=a.maxSizeReplaceHasWithBlock??DEFAULT_MAX_SIZE_REPLACE_HAS_WITH_BLOCK}sentBytes(s){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.bytesSent+=s}receivedBytes(s){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.bytesReceived+=s}debtRatio(){return this.bytesSent/(this.bytesReceived+1)}async sendBlocksToPeer(s){const a=new QueuedBitswapMessage,et=new Set;for(const[tt,rt]of this.wants.entries())try{const nt=await this.blockstore.get(rt.cid,s);rt.wantType===WantType.WantHave?nt.byteLength<this.maxSizeReplaceHasWithBlock?(this.log("sending have and block for %c",rt.cid),et.add(tt),a.addBlock(rt.cid,{data:nt,prefix:cidToPrefix(rt.cid)})):(this.log("sending have for %c",rt.cid),a.addBlockPresence(rt.cid,{cid:rt.cid.bytes,type:BlockPresenceType.HaveBlock})):(this.log("sending block for %c",rt.cid),et.add(tt),a.addBlock(rt.cid,{data:nt,prefix:cidToPrefix(rt.cid)}))}catch(nt){if(nt.code!=="ERR_NOT_FOUND")throw nt;if(this.log("do not have block for %c",rt.cid),!rt.sendDontHave||rt.sentDontHave===!0)continue;rt.sentDontHave=!0,a.addBlockPresence(rt.cid,{cid:rt.cid.bytes,type:BlockPresenceType.DontHaveBlock})}if(a.blocks.size>0||a.blockPresences.size>0){this.log("sending message"),await this.network.sendMessage(this.peerId,a,s),this.log("sent message"),this.sentBytes([...a.blocks.values()].reduce((tt,rt)=>tt+rt.data.byteLength,0));for(const tt of et)this.wants.delete(tt)}}}class PeerWantLists{blockstore;network;ledgerMap;maxSizeReplaceHasWithBlock;log;logger;constructor(s,a={}){this.blockstore=s.blockstore,this.network=s.network,this.maxSizeReplaceHasWithBlock=a.maxSizeReplaceHasWithBlock,this.log=s.logger.forComponent("helia:bitswap:peer-want-lists"),this.logger=s.logger,this.ledgerMap=trackedPeerMap({name:"helia_bitswap_ledger_map",metrics:s.metrics}),this.network.addEventListener("bitswap:message",et=>{this.receiveMessage(et.detail.peer,et.detail.message).catch(tt=>{this.log.error("error receiving bitswap message from %p",et.detail.peer,tt)})}),this.network.addEventListener("peer:disconnected",et=>{this.peerDisconnected(et.detail)})}ledgerForPeer(s){const a=this.ledgerMap.get(s);if(a!=null)return{peer:a.peerId,value:a.debtRatio(),sent:a.bytesSent,received:a.bytesReceived,exchanged:a.exchangeCount}}wantListForPeer(s){const a=this.ledgerMap.get(s);if(a!=null)return[...a.wants.values()]}peers(){return Array.from(this.ledgerMap.values()).map(s=>s.peerId)}async receiveMessage(s,a){let et=this.ledgerMap.get(s);if(et==null&&(et=new Ledger({peerId:s,blockstore:this.blockstore,network:this.network,logger:this.logger},{maxSizeReplaceHasWithBlock:this.maxSizeReplaceHasWithBlock}),this.ledgerMap.set(s,et)),et.receivedBytes(a.blocks?.reduce((tt,rt)=>tt+rt.data.byteLength,0)??0),a.wantlist!=null){a.wantlist.full===!0&&et.wants.clear();for(const tt of a.wantlist.entries){const rt=CID.decode(tt.cid),nt=toString$h(rt.multihash.bytes,"base64");tt.cancel===!0?(this.log("peer %p cancelled want of block for %c",s,rt),et.wants.delete(nt)):(tt.wantType===WantType.WantHave?this.log("peer %p wanted block presence for %c",s,rt):this.log("peer %p wanted block for %c",s,rt),et.wants.set(nt,{cid:rt,priority:tt.priority,wantType:tt.wantType??WantType.WantBlock,sendDontHave:tt.sendDontHave??!1}))}}this.log("send blocks to peer"),await et.sendBlocksToPeer()}async receivedBlock(s,a){const et=toString$h(s.multihash.bytes,"base64"),tt=[];for(const rt of this.ledgerMap.values())rt.wants.has(et)&&tt.push(rt);await Promise.all(tt.map(async rt=>rt.sendBlocksToPeer(a)))}peerDisconnected(s){this.ledgerMap.delete(s)}}var browser$4={exports:{}},ms,hasRequiredMs;function requireMs(){if(hasRequiredMs)return ms;hasRequiredMs=1;var o=1e3,s=o*60,a=s*60,et=a*24,tt=et*7,rt=et*365.25;ms=function(at,lt){lt=lt||{};var ct=typeof at;if(ct==="string"&&at.length>0)return nt(at);if(ct==="number"&&isFinite(at))return lt.long?st(at):it(at);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(at))};function nt(at){if(at=String(at),!(at.length>100)){var lt=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(at);if(lt){var ct=parseFloat(lt[1]),ht=(lt[2]||"ms").toLowerCase();switch(ht){case"years":case"year":case"yrs":case"yr":case"y":return ct*rt;case"weeks":case"week":case"w":return ct*tt;case"days":case"day":case"d":return ct*et;case"hours":case"hour":case"hrs":case"hr":case"h":return ct*a;case"minutes":case"minute":case"mins":case"min":case"m":return ct*s;case"seconds":case"second":case"secs":case"sec":case"s":return ct*o;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return ct;default:return}}}}function it(at){var lt=Math.abs(at);return lt>=et?Math.round(at/et)+"d":lt>=a?Math.round(at/a)+"h":lt>=s?Math.round(at/s)+"m":lt>=o?Math.round(at/o)+"s":at+"ms"}function st(at){var lt=Math.abs(at);return lt>=et?ot(at,lt,et,"day"):lt>=a?ot(at,lt,a,"hour"):lt>=s?ot(at,lt,s,"minute"):lt>=o?ot(at,lt,o,"second"):at+" ms"}function ot(at,lt,ct,ht){var ft=lt>=ct*1.5;return Math.round(at/ct)+" "+ht+(ft?"s":"")}return ms}function setup(o){a.debug=a,a.default=a,a.coerce=st,a.disable=rt,a.enable=tt,a.enabled=nt,a.humanize=requireMs(),a.destroy=ot,Object.keys(o).forEach(at=>{a[at]=o[at]}),a.names=[],a.skips=[],a.formatters={};function s(at){let lt=0;for(let ct=0;ct<at.length;ct++)lt=(lt<<5)-lt+at.charCodeAt(ct),lt|=0;return a.colors[Math.abs(lt)%a.colors.length]}a.selectColor=s;function a(at){let lt,ct=null,ht,ft;function dt(...pt){if(!dt.enabled)return;const gt=dt,mt=Number(new Date),yt=mt-(lt||mt);gt.diff=yt,gt.prev=lt,gt.curr=mt,lt=mt,pt[0]=a.coerce(pt[0]),typeof pt[0]!="string"&&pt.unshift("%O");let vt=0;pt[0]=pt[0].replace(/%([a-zA-Z%])/g,(xt,wt)=>{if(xt==="%%")return"%";vt++;const Rt=a.formatters[wt];if(typeof Rt=="function"){const Ct=pt[vt];xt=Rt.call(gt,Ct),pt.splice(vt,1),vt--}return xt}),a.formatArgs.call(gt,pt),(gt.log||a.log).apply(gt,pt)}return dt.namespace=at,dt.useColors=a.useColors(),dt.color=a.selectColor(at),dt.extend=et,dt.destroy=a.destroy,Object.defineProperty(dt,"enabled",{enumerable:!0,configurable:!1,get:()=>ct!==null?ct:(ht!==a.namespaces&&(ht=a.namespaces,ft=a.enabled(at)),ft),set:pt=>{ct=pt}}),typeof a.init=="function"&&a.init(dt),dt}function et(at,lt){const ct=a(this.namespace+(typeof lt>"u"?":":lt)+at);return ct.log=this.log,ct}function tt(at){a.save(at),a.namespaces=at,a.names=[],a.skips=[];let lt;const ct=(typeof at=="string"?at:"").split(/[\s,]+/),ht=ct.length;for(lt=0;lt<ht;lt++)ct[lt]&&(at=ct[lt].replace(/\*/g,".*?"),at[0]==="-"?a.skips.push(new RegExp("^"+at.slice(1)+"$")):a.names.push(new RegExp("^"+at+"$")))}function rt(){const at=[...a.names.map(it),...a.skips.map(it).map(lt=>"-"+lt)].join(",");return a.enable(""),at}function nt(at){if(at[at.length-1]==="*")return!0;let lt,ct;for(lt=0,ct=a.skips.length;lt<ct;lt++)if(a.skips[lt].test(at))return!1;for(lt=0,ct=a.names.length;lt<ct;lt++)if(a.names[lt].test(at))return!0;return!1}function it(at){return at.toString().substring(2,at.toString().length-2).replace(/\.\*\?$/,"*")}function st(at){return at instanceof Error?at.stack||at.message:at}function ot(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return a.enable(a.load()),a}var common$1=setup;(function(o,s){var a={};s.formatArgs=tt,s.save=rt,s.load=nt,s.useColors=et,s.storage=it(),s.destroy=(()=>{let ot=!1;return()=>{ot||(ot=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),s.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function et(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function tt(ot){if(ot[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+ot[0]+(this.useColors?"%c ":" ")+"+"+o.exports.humanize(this.diff),!this.useColors)return;const at="color: "+this.color;ot.splice(1,0,at,"color: inherit");let lt=0,ct=0;ot[0].replace(/%[a-zA-Z%]/g,ht=>{ht!=="%%"&&(lt++,ht==="%c"&&(ct=lt))}),ot.splice(ct,0,at)}s.log=console.debug||console.log||(()=>{});function rt(ot){try{ot?s.storage.setItem("debug",ot):s.storage.removeItem("debug")}catch{}}function nt(){let ot;try{ot=s.storage.getItem("debug")}catch{}return!ot&&typeof process$1<"u"&&"env"in process$1&&(ot=a.DEBUG),ot}function it(){try{return localStorage}catch{}}o.exports=common$1(s);const{formatters:st}=o.exports;st.j=function(ot){try{return JSON.stringify(ot)}catch(at){return"[UnexpectedJSONParseError]: "+at.message}}})(browser$4,browser$4.exports);var browserExports=browser$4.exports;const debug=getDefaultExportFromCjs$2(browserExports);debug.formatters.b=o=>o==null?"undefined":base58btc.baseEncode(o);debug.formatters.t=o=>o==null?"undefined":base32.baseEncode(o);debug.formatters.m=o=>o==null?"undefined":base64.baseEncode(o);debug.formatters.p=o=>o==null?"undefined":o.toString();debug.formatters.c=o=>o==null?"undefined":o.toString();debug.formatters.k=o=>o==null?"undefined":o.toString();debug.formatters.a=o=>o==null?"undefined":o.toString();function createDisabledLogger(o){const s=()=>{};return s.enabled=!1,s.color="",s.diff=0,s.log=()=>{},s.namespace=o,s.destroy=()=>!0,s.extend=()=>s,s}function defaultLogger(){return{forComponent(o){return logger$1(o)}}}function logger$1(o){let s=createDisabledLogger(`${o}:trace`);return debug.enabled(`${o}:trace`)&&debug.names.map(a=>a.toString()).find(a=>a.includes(":trace"))!=null&&(s=debug(`${o}:trace`)),Object.assign(debug(o),{error:debug(`${o}:error`),trace:s})}var eventemitter3$1={exports:{}};(function(o){var s=Object.prototype.hasOwnProperty,a="~";function et(){}Object.create&&(et.prototype=Object.create(null),new et().__proto__||(a=!1));function tt(st,ot,at){this.fn=st,this.context=ot,this.once=at||!1}function rt(st,ot,at,lt,ct){if(typeof at!="function")throw new TypeError("The listener must be a function");var ht=new tt(at,lt||st,ct),ft=a?a+ot:ot;return st._events[ft]?st._events[ft].fn?st._events[ft]=[st._events[ft],ht]:st._events[ft].push(ht):(st._events[ft]=ht,st._eventsCount++),st}function nt(st,ot){--st._eventsCount===0?st._events=new et:delete st._events[ot]}function it(){this._events=new et,this._eventsCount=0}it.prototype.eventNames=function(){var ot=[],at,lt;if(this._eventsCount===0)return ot;for(lt in at=this._events)s.call(at,lt)&&ot.push(a?lt.slice(1):lt);return Object.getOwnPropertySymbols?ot.concat(Object.getOwnPropertySymbols(at)):ot},it.prototype.listeners=function(ot){var at=a?a+ot:ot,lt=this._events[at];if(!lt)return[];if(lt.fn)return[lt.fn];for(var ct=0,ht=lt.length,ft=new Array(ht);ct<ht;ct++)ft[ct]=lt[ct].fn;return ft},it.prototype.listenerCount=function(ot){var at=a?a+ot:ot,lt=this._events[at];return lt?lt.fn?1:lt.length:0},it.prototype.emit=function(ot,at,lt,ct,ht,ft){var dt=a?a+ot:ot;if(!this._events[dt])return!1;var pt=this._events[dt],gt=arguments.length,mt,yt;if(pt.fn){switch(pt.once&&this.removeListener(ot,pt.fn,void 0,!0),gt){case 1:return pt.fn.call(pt.context),!0;case 2:return pt.fn.call(pt.context,at),!0;case 3:return pt.fn.call(pt.context,at,lt),!0;case 4:return pt.fn.call(pt.context,at,lt,ct),!0;case 5:return pt.fn.call(pt.context,at,lt,ct,ht),!0;case 6:return pt.fn.call(pt.context,at,lt,ct,ht,ft),!0}for(yt=1,mt=new Array(gt-1);yt<gt;yt++)mt[yt-1]=arguments[yt];pt.fn.apply(pt.context,mt)}else{var vt=pt.length,Et;for(yt=0;yt<vt;yt++)switch(pt[yt].once&&this.removeListener(ot,pt[yt].fn,void 0,!0),gt){case 1:pt[yt].fn.call(pt[yt].context);break;case 2:pt[yt].fn.call(pt[yt].context,at);break;case 3:pt[yt].fn.call(pt[yt].context,at,lt);break;case 4:pt[yt].fn.call(pt[yt].context,at,lt,ct);break;default:if(!mt)for(Et=1,mt=new Array(gt-1);Et<gt;Et++)mt[Et-1]=arguments[Et];pt[yt].fn.apply(pt[yt].context,mt)}}return!0},it.prototype.on=function(ot,at,lt){return rt(this,ot,at,lt,!1)},it.prototype.once=function(ot,at,lt){return rt(this,ot,at,lt,!0)},it.prototype.removeListener=function(ot,at,lt,ct){var ht=a?a+ot:ot;if(!this._events[ht])return this;if(!at)return nt(this,ht),this;var ft=this._events[ht];if(ft.fn)ft.fn===at&&(!ct||ft.once)&&(!lt||ft.context===lt)&&nt(this,ht);else{for(var dt=0,pt=[],gt=ft.length;dt<gt;dt++)(ft[dt].fn!==at||ct&&!ft[dt].once||lt&&ft[dt].context!==lt)&&pt.push(ft[dt]);pt.length?this._events[ht]=pt.length===1?pt[0]:pt:nt(this,ht)}return this},it.prototype.removeAllListeners=function(ot){var at;return ot?(at=a?a+ot:ot,this._events[at]&&nt(this,at)):(this._events=new et,this._eventsCount=0),this},it.prototype.off=it.prototype.removeListener,it.prototype.addListener=it.prototype.on,it.prefixed=a,it.EventEmitter=it,o.exports=it})(eventemitter3$1);var eventemitter3Exports$1=eventemitter3$1.exports;const EventEmitter$1=getDefaultExportFromCjs$2(eventemitter3Exports$1);class TimeoutError extends Error{constructor(s){super(s),this.name="TimeoutError"}}let AbortError$1=class extends Error{constructor(s){super(),this.name="AbortError",this.message=s}};const getDOMException=o=>globalThis.DOMException===void 0?new AbortError$1(o):new DOMException(o),getAbortedReason=o=>{const s=o.reason===void 0?getDOMException("This operation was aborted."):o.reason;return s instanceof Error?s:getDOMException(s)};function pTimeout(o,s){const{milliseconds:a,fallback:et,message:tt,customTimers:rt={setTimeout,clearTimeout}}=s;let nt;const st=new Promise((ot,at)=>{if(typeof a!="number"||Math.sign(a)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${a}\``);if(s.signal){const{signal:ct}=s;ct.aborted&&at(getAbortedReason(ct)),ct.addEventListener("abort",()=>{at(getAbortedReason(ct))})}if(a===Number.POSITIVE_INFINITY){o.then(ot,at);return}const lt=new TimeoutError;nt=rt.setTimeout.call(void 0,()=>{if(et){try{ot(et())}catch(ct){at(ct)}return}typeof o.cancel=="function"&&o.cancel(),tt===!1?ot():tt instanceof Error?at(tt):(lt.message=tt??`Promise timed out after ${a} milliseconds`,at(lt))},a),(async()=>{try{ot(await o)}catch(ct){at(ct)}})()}).finally(()=>{st.clear()});return st.clear=()=>{rt.clearTimeout.call(void 0,nt),nt=void 0},st}function lowerBound(o,s,a){let et=0,tt=o.length;for(;tt>0;){const rt=Math.trunc(tt/2);let nt=et+rt;a(o[nt],s)<=0?(et=++nt,tt-=rt+1):tt=rt}return et}let PriorityQueue$1=class{#e=[];enqueue(s,a){a={priority:0,...a};const et={priority:a.priority,run:s};if(this.size&&this.#e[this.size-1].priority>=a.priority){this.#e.push(et);return}const tt=lowerBound(this.#e,et,(rt,nt)=>nt.priority-rt.priority);this.#e.splice(tt,0,et)}dequeue(){return this.#e.shift()?.run}filter(s){return this.#e.filter(a=>a.priority===s.priority).map(a=>a.run)}get size(){return this.#e.length}};class PQueue extends EventEmitter$1{#e;#t;#r=0;#i;#a;#c=0;#s;#u;#n;#g;#o=0;#d;#l;#m;timeout;constructor(s){if(super(),s={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:PriorityQueue$1,...s},!(typeof s.intervalCap=="number"&&s.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${s.intervalCap?.toString()??""}\` (${typeof s.intervalCap})`);if(s.interval===void 0||!(Number.isFinite(s.interval)&&s.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${s.interval?.toString()??""}\` (${typeof s.interval})`);this.#e=s.carryoverConcurrencyCount,this.#t=s.intervalCap===Number.POSITIVE_INFINITY||s.interval===0,this.#i=s.intervalCap,this.#a=s.interval,this.#n=new s.queueClass,this.#g=s.queueClass,this.concurrency=s.concurrency,this.timeout=s.timeout,this.#m=s.throwOnTimeout===!0,this.#l=s.autoStart===!1}get#E(){return this.#t||this.#r<this.#i}get#b(){return this.#o<this.#d}#S(){this.#o--,this.#h(),this.emit("next")}#w(){this.#v(),this.#y(),this.#u=void 0}get#x(){const s=Date.now();if(this.#s===void 0){const a=this.#c-s;if(a<0)this.#r=this.#e?this.#o:0;else return this.#u===void 0&&(this.#u=setTimeout(()=>{this.#w()},a)),!0}return!1}#h(){if(this.#n.size===0)return this.#s&&clearInterval(this.#s),this.#s=void 0,this.emit("empty"),this.#o===0&&this.emit("idle"),!1;if(!this.#l){const s=!this.#x;if(this.#E&&this.#b){const a=this.#n.dequeue();return a?(this.emit("active"),a(),s&&this.#y(),!0):!1}}return!1}#y(){this.#t||this.#s!==void 0||(this.#s=setInterval(()=>{this.#v()},this.#a),this.#c=Date.now()+this.#a)}#v(){this.#r===0&&this.#o===0&&this.#s&&(clearInterval(this.#s),this.#s=void 0),this.#r=this.#e?this.#o:0,this.#f()}#f(){for(;this.#h(););}get concurrency(){return this.#d}set concurrency(s){if(!(typeof s=="number"&&s>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${s}\` (${typeof s})`);this.#d=s,this.#f()}async#_(s){return new Promise((a,et)=>{s.addEventListener("abort",()=>{et(s.reason)},{once:!0})})}async add(s,a={}){return a={timeout:this.timeout,throwOnTimeout:this.#m,...a},new Promise((et,tt)=>{this.#n.enqueue(async()=>{this.#o++,this.#r++;try{a.signal?.throwIfAborted();let rt=s({signal:a.signal});a.timeout&&(rt=pTimeout(Promise.resolve(rt),{milliseconds:a.timeout})),a.signal&&(rt=Promise.race([rt,this.#_(a.signal)]));const nt=await rt;et(nt),this.emit("completed",nt)}catch(rt){if(rt instanceof TimeoutError&&!a.throwOnTimeout){et();return}tt(rt),this.emit("error",rt)}finally{this.#S()}},a),this.emit("add"),this.#h()})}async addAll(s,a){return Promise.all(s.map(async et=>this.add(et,a)))}start(){return this.#l?(this.#l=!1,this.#f(),this):this}pause(){this.#l=!0}clear(){this.#n=new this.#g}async onEmpty(){this.#n.size!==0&&await this.#p("empty")}async onSizeLessThan(s){this.#n.size<s||await this.#p("next",()=>this.#n.size<s)}async onIdle(){this.#o===0&&this.#n.size===0||await this.#p("idle")}async#p(s,a){return new Promise(et=>{const tt=()=>{a&&!a()||(this.off(s,tt),et())};this.on(s,tt)})}get size(){return this.#n.size}sizeBy(s){return this.#n.filter(s).length}get pending(){return this.#o}get isPaused(){return this.#l}}function getTypes(o){const s=[RecordType.A];return o==null?s:Array.isArray(o)?o.length===0?s:o:[o]}function allocUnsafe$l(o=0){return new Uint8Array(o)}function createCodec$l(o,s,a,et){return{name:o,prefix:s,encoder:{name:o,prefix:s,encode:a},decoder:{decode:et}}}const string$m=createCodec$l("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),ascii$l=createCodec$l("ascii","a",o=>{let s="a";for(let a=0;a<o.length;a++)s+=String.fromCharCode(o[a]);return s},o=>{o=o.substring(1);const s=allocUnsafe$l(o.length);for(let a=0;a<o.length;a++)s[a]=o.charCodeAt(a);return s}),BASES$l={utf8:string$m,"utf-8":string$m,hex:bases.base16,latin1:ascii$l,ascii:ascii$l,binary:ascii$l,...bases};function toString$g(o,s="utf8"){const a=BASES$l[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.encoder.encode(o).substring(1)}const DEFAULT_TTL=60;function toDNSResponse(o){return{Status:o.Status??0,TC:o.TC??o.flag_tc??!1,RD:o.RD??o.flag_rd??!1,RA:o.RA??o.flag_ra??!1,AD:o.AD??o.flag_ad??!1,CD:o.CD??o.flag_cd??!1,Question:(o.Question??o.questions??[]).map(s=>({name:s.name,type:RecordType[s.type]})),Answer:(o.Answer??o.answers??[]).map(s=>({name:s.name,type:RecordType[s.type],TTL:s.TTL??s.ttl??DEFAULT_TTL,data:s.data instanceof Uint8Array?toString$g(s.data):s.data}))}}const DEFAULT_QUERY_CONCURRENCY=4;function dnsJsonOverHttps(o,s={}){const a=new PQueue({concurrency:s.queryConcurrency??DEFAULT_QUERY_CONCURRENCY});return async(et,tt={})=>{const rt=new URLSearchParams;rt.set("name",et),getTypes(tt.types).forEach(it=>{rt.append("type",RecordType[it])}),tt.onProgress?.(new CustomProgressEvent("dns:query",{detail:et}));const nt=await a.add(async()=>{const it=await fetch(`${o}?${rt}`,{headers:{accept:"application/dns-json"},signal:tt?.signal});if(it.status!==200)throw new Error(`Unexpected HTTP status: ${it.status} - ${it.statusText}`);const st=toDNSResponse(await it.json());return tt.onProgress?.(new CustomProgressEvent("dns:response",{detail:st})),st},{signal:tt.signal});if(nt==null)throw new Error("No DNS response received");return nt}}function defaultResolver(){return[dnsJsonOverHttps("https://cloudflare-dns.com/dns-query"),dnsJsonOverHttps("https://dns.google/resolve")]}var hashlru=function(o){if(!o)throw Error("hashlru must have a max value, of type number, greater than 0");var s=0,a=Object.create(null),et=Object.create(null);function tt(rt,nt){a[rt]=nt,s++,s>=o&&(s=0,et=a,a=Object.create(null))}return{has:function(rt){return a[rt]!==void 0||et[rt]!==void 0},remove:function(rt){a[rt]!==void 0&&(a[rt]=void 0),et[rt]!==void 0&&(et[rt]=void 0)},get:function(rt){var nt=a[rt];if(nt!==void 0)return nt;if((nt=et[rt])!==void 0)return tt(rt,nt),nt},set:function(rt,nt){a[rt]!==void 0?a[rt]=nt:tt(rt,nt)},clear:function(){a=Object.create(null),et=Object.create(null)}}};const cache$3=getDefaultExportFromCjs$2(hashlru);class CachedAnswers{lru;constructor(s){this.lru=cache$3(s)}get(s,a){let et=!0;const tt=[];for(const rt of a){const nt=this.getAnswers(s,rt);if(nt.length===0){et=!1;break}tt.push(...nt)}if(et)return toDNSResponse({answers:tt})}getAnswers(s,a){const et=`${s.toLowerCase()}-${a}`,tt=this.lru.get(et);if(tt!=null){const rt=tt.filter(nt=>nt.expires>Date.now()).map(({expires:nt,value:it})=>({...it,TTL:Math.round((nt-Date.now())/1e3),type:RecordType[it.type]}));return rt.length===0&&this.lru.remove(et),rt}return[]}add(s,a){const et=`${s.toLowerCase()}-${a.type}`,tt=this.lru.get(et)??[];tt.push({expires:Date.now()+(a.TTL??DEFAULT_TTL)*1e3,value:a}),this.lru.set(et,tt)}remove(s,a){const et=`${s.toLowerCase()}-${a}`;this.lru.remove(et)}clear(){this.lru.clear()}}function cache$2(o){return new CachedAnswers(o)}const DEFAULT_ANSWER_CACHE_SIZE=1e3;let DNS$2=class{resolvers;cache;constructor(s){this.resolvers={},this.cache=cache$2(s.cacheSize??DEFAULT_ANSWER_CACHE_SIZE),Object.entries(s.resolvers??{}).forEach(([a,et])=>{Array.isArray(et)||(et=[et]),a.endsWith(".")||(a=`${a}.`),this.resolvers[a]=et}),this.resolvers["."]==null&&(this.resolvers["."]=defaultResolver())}async query(s,a={}){const et=getTypes(a.types),tt=a.cached!==!1?this.cache.get(s,et):void 0;if(tt!=null)return a.onProgress?.(new CustomProgressEvent("dns:cache",{detail:tt})),tt;const rt=`${s.split(".").pop()}.`,nt=(this.resolvers[rt]??this.resolvers["."]).sort(()=>Math.random()>.5?-1:1),it=[];for(const st of nt){if(a.signal?.aborted===!0)break;try{const ot=await st(s,{...a,types:et});for(const at of ot.Answer)this.cache.add(s,at);return ot}catch(ot){it.push(ot),a.onProgress?.(new CustomProgressEvent("dns:error",{detail:ot}))}}throw it.length===1?it[0]:new AggregateError(it,`DNS lookup of ${s} ${et} failed`)}};var RecordType;(function(o){o[o.A=1]="A",o[o.CNAME=5]="CNAME",o[o.TXT=16]="TXT",o[o.AAAA=28]="AAAA"})(RecordType||(RecordType={}));function dns(o={}){return new DNS$2(o)}const typeofs=["string","number","bigint","symbol"],objectTypeNames=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function is$2(o){if(o===null)return"null";if(o===void 0)return"undefined";if(o===!0||o===!1)return"boolean";const s=typeof o;if(typeofs.includes(s))return s;if(s==="function")return"Function";if(Array.isArray(o))return"Array";if(isBuffer$1(o))return"Buffer";const a=getObjectType(o);return a||"Object"}function isBuffer$1(o){return o&&o.constructor&&o.constructor.isBuffer&&o.constructor.isBuffer.call(null,o)}function getObjectType(o){const s=Object.prototype.toString.call(o).slice(8,-1);if(objectTypeNames.includes(s))return s}class Type{constructor(s,a,et){this.major=s,this.majorEncoded=s<<5,this.name=a,this.terminal=et}toString(){return`Type[${this.major}].${this.name}`}compare(s){return this.major<s.major?-1:this.major>s.major?1:0}}Type.uint=new Type(0,"uint",!0);Type.negint=new Type(1,"negint",!0);Type.bytes=new Type(2,"bytes",!0);Type.string=new Type(3,"string",!0);Type.array=new Type(4,"array",!1);Type.map=new Type(5,"map",!1);Type.tag=new Type(6,"tag",!1);Type.float=new Type(7,"float",!0);Type.false=new Type(7,"false",!0);Type.true=new Type(7,"true",!0);Type.null=new Type(7,"null",!0);Type.undefined=new Type(7,"undefined",!0);Type.break=new Type(7,"break",!0);class Token{constructor(s,a,et){this.type=s,this.value=a,this.encodedLength=et,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const useBuffer=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",textDecoder$2=new TextDecoder,textEncoder$3=new TextEncoder;function isBuffer(o){return useBuffer&&globalThis.Buffer.isBuffer(o)}function asU8A(o){return o instanceof Uint8Array?isBuffer(o)?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):o:Uint8Array.from(o)}const toString$f=useBuffer?(o,s,a)=>a-s>64?globalThis.Buffer.from(o.subarray(s,a)).toString("utf8"):utf8Slice(o,s,a):(o,s,a)=>a-s>64?textDecoder$2.decode(o.subarray(s,a)):utf8Slice(o,s,a),fromString$n=useBuffer?o=>o.length>64?globalThis.Buffer.from(o):utf8ToBytes$1(o):o=>o.length>64?textEncoder$3.encode(o):utf8ToBytes$1(o),fromArray=o=>Uint8Array.from(o),slice$1=useBuffer?(o,s,a)=>isBuffer(o)?new Uint8Array(o.subarray(s,a)):o.slice(s,a):(o,s,a)=>o.slice(s,a),concat$a=useBuffer?(o,s)=>(o=o.map(a=>a instanceof Uint8Array?a:globalThis.Buffer.from(a)),asU8A(globalThis.Buffer.concat(o,s))):(o,s)=>{const a=new Uint8Array(s);let et=0;for(let tt of o)et+tt.length>a.length&&(tt=tt.subarray(0,a.length-et)),a.set(tt,et),et+=tt.length;return a},alloc$7=useBuffer?o=>globalThis.Buffer.allocUnsafe(o):o=>new Uint8Array(o);function compare(o,s){if(isBuffer(o)&&isBuffer(s))return o.compare(s);for(let a=0;a<o.length;a++)if(o[a]!==s[a])return o[a]<s[a]?-1:1;return 0}function utf8ToBytes$1(o){const s=[];let a=0;for(let et=0;et<o.length;et++){let tt=o.charCodeAt(et);tt<128?s[a++]=tt:tt<2048?(s[a++]=tt>>6|192,s[a++]=tt&63|128):(tt&64512)===55296&&et+1<o.length&&(o.charCodeAt(et+1)&64512)===56320?(tt=65536+((tt&1023)<<10)+(o.charCodeAt(++et)&1023),s[a++]=tt>>18|240,s[a++]=tt>>12&63|128,s[a++]=tt>>6&63|128,s[a++]=tt&63|128):(s[a++]=tt>>12|224,s[a++]=tt>>6&63|128,s[a++]=tt&63|128)}return s}function utf8Slice(o,s,a){const et=[];for(;s<a;){const tt=o[s];let rt=null,nt=tt>239?4:tt>223?3:tt>191?2:1;if(s+nt<=a){let it,st,ot,at;switch(nt){case 1:tt<128&&(rt=tt);break;case 2:it=o[s+1],(it&192)===128&&(at=(tt&31)<<6|it&63,at>127&&(rt=at));break;case 3:it=o[s+1],st=o[s+2],(it&192)===128&&(st&192)===128&&(at=(tt&15)<<12|(it&63)<<6|st&63,at>2047&&(at<55296||at>57343)&&(rt=at));break;case 4:it=o[s+1],st=o[s+2],ot=o[s+3],(it&192)===128&&(st&192)===128&&(ot&192)===128&&(at=(tt&15)<<18|(it&63)<<12|(st&63)<<6|ot&63,at>65535&&at<1114112&&(rt=at))}}rt===null?(rt=65533,nt=1):rt>65535&&(rt-=65536,et.push(rt>>>10&1023|55296),rt=56320|rt&1023),et.push(rt),s+=nt}return decodeCodePointsArray(et)}const MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(o){const s=o.length;if(s<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,o);let a="",et=0;for(;et<s;)a+=String.fromCharCode.apply(String,o.slice(et,et+=MAX_ARGUMENTS_LENGTH));return a}const defaultChunkSize=256;class Bl{constructor(s=defaultChunkSize){this.chunkSize=s,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(s){let a=this.chunks[this.chunks.length-1];if(this.cursor+s.length<=this.maxCursor+1){const tt=a.length-(this.maxCursor-this.cursor)-1;a.set(s,tt)}else{if(a){const tt=a.length-(this.maxCursor-this.cursor)-1;tt<a.length&&(this.chunks[this.chunks.length-1]=a.subarray(0,tt),this.maxCursor=this.cursor-1)}s.length<64&&s.length<this.chunkSize?(a=alloc$7(this.chunkSize),this.chunks.push(a),this.maxCursor+=a.length,this._initReuseChunk===null&&(this._initReuseChunk=a),a.set(s,0)):(this.chunks.push(s),this.maxCursor+=s.length)}this.cursor+=s.length}toBytes(s=!1){let a;if(this.chunks.length===1){const et=this.chunks[0];s&&this.cursor>et.length/2?(a=this.cursor===et.length?et:et.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):a=slice$1(et,0,this.cursor)}else a=concat$a(this.chunks,this.cursor);return s&&this.reset(),a}}const decodeErrPrefix="CBOR decode error:",encodeErrPrefix="CBOR encode error:";function assertEnoughData(o,s,a){if(o.length-s<a)throw new Error(`${decodeErrPrefix} not enough data for type`)}const uintBoundaries=[24,256,65536,4294967296,BigInt("18446744073709551616")];function readUint8(o,s,a){assertEnoughData(o,s,1);const et=o[s];if(a.strict===!0&&et<uintBoundaries[0])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);return et}function readUint16$1(o,s,a){assertEnoughData(o,s,2);const et=o[s]<<8|o[s+1];if(a.strict===!0&&et<uintBoundaries[1])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);return et}function readUint32$1(o,s,a){assertEnoughData(o,s,4);const et=o[s]*16777216+(o[s+1]<<16)+(o[s+2]<<8)+o[s+3];if(a.strict===!0&&et<uintBoundaries[2])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);return et}function readUint64$1(o,s,a){assertEnoughData(o,s,8);const et=o[s]*16777216+(o[s+1]<<16)+(o[s+2]<<8)+o[s+3],tt=o[s+4]*16777216+(o[s+5]<<16)+(o[s+6]<<8)+o[s+7],rt=(BigInt(et)<<BigInt(32))+BigInt(tt);if(a.strict===!0&&rt<uintBoundaries[3])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);if(rt<=Number.MAX_SAFE_INTEGER)return Number(rt);if(a.allowBigInt===!0)return rt;throw new Error(`${decodeErrPrefix} integers outside of the safe integer range are not supported`)}function decodeUint8(o,s,a,et){return new Token(Type.uint,readUint8(o,s+1,et),2)}function decodeUint16(o,s,a,et){return new Token(Type.uint,readUint16$1(o,s+1,et),3)}function decodeUint32(o,s,a,et){return new Token(Type.uint,readUint32$1(o,s+1,et),5)}function decodeUint64(o,s,a,et){return new Token(Type.uint,readUint64$1(o,s+1,et),9)}function encodeUint(o,s){return encodeUintValue(o,0,s.value)}function encodeUintValue(o,s,a){if(a<uintBoundaries[0]){const et=Number(a);o.push([s|et])}else if(a<uintBoundaries[1]){const et=Number(a);o.push([s|24,et])}else if(a<uintBoundaries[2]){const et=Number(a);o.push([s|25,et>>>8,et&255])}else if(a<uintBoundaries[3]){const et=Number(a);o.push([s|26,et>>>24&255,et>>>16&255,et>>>8&255,et&255])}else{const et=BigInt(a);if(et<uintBoundaries[4]){const tt=[s|27,0,0,0,0,0,0,0];let rt=Number(et&BigInt(4294967295)),nt=Number(et>>BigInt(32)&BigInt(4294967295));tt[8]=rt&255,rt=rt>>8,tt[7]=rt&255,rt=rt>>8,tt[6]=rt&255,rt=rt>>8,tt[5]=rt&255,tt[4]=nt&255,nt=nt>>8,tt[3]=nt&255,nt=nt>>8,tt[2]=nt&255,nt=nt>>8,tt[1]=nt&255,o.push(tt)}else throw new Error(`${decodeErrPrefix} encountered BigInt larger than allowable range`)}}encodeUint.encodedSize=function(s){return encodeUintValue.encodedSize(s.value)};encodeUintValue.encodedSize=function(s){return s<uintBoundaries[0]?1:s<uintBoundaries[1]?2:s<uintBoundaries[2]?3:s<uintBoundaries[3]?5:9};encodeUint.compareTokens=function(s,a){return s.value<a.value?-1:s.value>a.value?1:0};function decodeNegint8(o,s,a,et){return new Token(Type.negint,-1-readUint8(o,s+1,et),2)}function decodeNegint16(o,s,a,et){return new Token(Type.negint,-1-readUint16$1(o,s+1,et),3)}function decodeNegint32(o,s,a,et){return new Token(Type.negint,-1-readUint32$1(o,s+1,et),5)}const neg1b=BigInt(-1),pos1b=BigInt(1);function decodeNegint64(o,s,a,et){const tt=readUint64$1(o,s+1,et);if(typeof tt!="bigint"){const rt=-1-tt;if(rt>=Number.MIN_SAFE_INTEGER)return new Token(Type.negint,rt,9)}if(et.allowBigInt!==!0)throw new Error(`${decodeErrPrefix} integers outside of the safe integer range are not supported`);return new Token(Type.negint,neg1b-BigInt(tt),9)}function encodeNegint(o,s){const a=s.value,et=typeof a=="bigint"?a*neg1b-pos1b:a*-1-1;encodeUintValue(o,s.type.majorEncoded,et)}encodeNegint.encodedSize=function(s){const a=s.value,et=typeof a=="bigint"?a*neg1b-pos1b:a*-1-1;return et<uintBoundaries[0]?1:et<uintBoundaries[1]?2:et<uintBoundaries[2]?3:et<uintBoundaries[3]?5:9};encodeNegint.compareTokens=function(s,a){return s.value<a.value?1:s.value>a.value?-1:0};function toToken$3(o,s,a,et){assertEnoughData(o,s,a+et);const tt=slice$1(o,s+a,s+a+et);return new Token(Type.bytes,tt,a+et)}function decodeBytesCompact(o,s,a,et){return toToken$3(o,s,1,a)}function decodeBytes8(o,s,a,et){return toToken$3(o,s,2,readUint8(o,s+1,et))}function decodeBytes16(o,s,a,et){return toToken$3(o,s,3,readUint16$1(o,s+1,et))}function decodeBytes32(o,s,a,et){return toToken$3(o,s,5,readUint32$1(o,s+1,et))}function decodeBytes64(o,s,a,et){const tt=readUint64$1(o,s+1,et);if(typeof tt=="bigint")throw new Error(`${decodeErrPrefix} 64-bit integer bytes lengths not supported`);return toToken$3(o,s,9,tt)}function tokenBytes(o){return o.encodedBytes===void 0&&(o.encodedBytes=o.type===Type.string?fromString$n(o.value):o.value),o.encodedBytes}function encodeBytes(o,s){const a=tokenBytes(s);encodeUintValue(o,s.type.majorEncoded,a.length),o.push(a)}encodeBytes.encodedSize=function(s){const a=tokenBytes(s);return encodeUintValue.encodedSize(a.length)+a.length};encodeBytes.compareTokens=function(s,a){return compareBytes(tokenBytes(s),tokenBytes(a))};function compareBytes(o,s){return o.length<s.length?-1:o.length>s.length?1:compare(o,s)}function toToken$2(o,s,a,et,tt){const rt=a+et;assertEnoughData(o,s,rt);const nt=new Token(Type.string,toString$f(o,s+a,s+rt),rt);return tt.retainStringBytes===!0&&(nt.byteValue=slice$1(o,s+a,s+rt)),nt}function decodeStringCompact(o,s,a,et){return toToken$2(o,s,1,a,et)}function decodeString8(o,s,a,et){return toToken$2(o,s,2,readUint8(o,s+1,et),et)}function decodeString16(o,s,a,et){return toToken$2(o,s,3,readUint16$1(o,s+1,et),et)}function decodeString32(o,s,a,et){return toToken$2(o,s,5,readUint32$1(o,s+1,et),et)}function decodeString64(o,s,a,et){const tt=readUint64$1(o,s+1,et);if(typeof tt=="bigint")throw new Error(`${decodeErrPrefix} 64-bit integer string lengths not supported`);return toToken$2(o,s,9,tt,et)}const encodeString=encodeBytes;function toToken$1(o,s,a,et){return new Token(Type.array,et,a)}function decodeArrayCompact(o,s,a,et){return toToken$1(o,s,1,a)}function decodeArray8(o,s,a,et){return toToken$1(o,s,2,readUint8(o,s+1,et))}function decodeArray16(o,s,a,et){return toToken$1(o,s,3,readUint16$1(o,s+1,et))}function decodeArray32(o,s,a,et){return toToken$1(o,s,5,readUint32$1(o,s+1,et))}function decodeArray64(o,s,a,et){const tt=readUint64$1(o,s+1,et);if(typeof tt=="bigint")throw new Error(`${decodeErrPrefix} 64-bit integer array lengths not supported`);return toToken$1(o,s,9,tt)}function decodeArrayIndefinite(o,s,a,et){if(et.allowIndefinite===!1)throw new Error(`${decodeErrPrefix} indefinite length items not allowed`);return toToken$1(o,s,1,1/0)}function encodeArray(o,s){encodeUintValue(o,Type.array.majorEncoded,s.value)}encodeArray.compareTokens=encodeUint.compareTokens;encodeArray.encodedSize=function(s){return encodeUintValue.encodedSize(s.value)};function toToken(o,s,a,et){return new Token(Type.map,et,a)}function decodeMapCompact(o,s,a,et){return toToken(o,s,1,a)}function decodeMap8(o,s,a,et){return toToken(o,s,2,readUint8(o,s+1,et))}function decodeMap16(o,s,a,et){return toToken(o,s,3,readUint16$1(o,s+1,et))}function decodeMap32(o,s,a,et){return toToken(o,s,5,readUint32$1(o,s+1,et))}function decodeMap64(o,s,a,et){const tt=readUint64$1(o,s+1,et);if(typeof tt=="bigint")throw new Error(`${decodeErrPrefix} 64-bit integer map lengths not supported`);return toToken(o,s,9,tt)}function decodeMapIndefinite(o,s,a,et){if(et.allowIndefinite===!1)throw new Error(`${decodeErrPrefix} indefinite length items not allowed`);return toToken(o,s,1,1/0)}function encodeMap(o,s){encodeUintValue(o,Type.map.majorEncoded,s.value)}encodeMap.compareTokens=encodeUint.compareTokens;encodeMap.encodedSize=function(s){return encodeUintValue.encodedSize(s.value)};function decodeTagCompact(o,s,a,et){return new Token(Type.tag,a,1)}function decodeTag8(o,s,a,et){return new Token(Type.tag,readUint8(o,s+1,et),2)}function decodeTag16(o,s,a,et){return new Token(Type.tag,readUint16$1(o,s+1,et),3)}function decodeTag32(o,s,a,et){return new Token(Type.tag,readUint32$1(o,s+1,et),5)}function decodeTag64(o,s,a,et){return new Token(Type.tag,readUint64$1(o,s+1,et),9)}function encodeTag(o,s){encodeUintValue(o,Type.tag.majorEncoded,s.value)}encodeTag.compareTokens=encodeUint.compareTokens;encodeTag.encodedSize=function(s){return encodeUintValue.encodedSize(s.value)};const MINOR_FALSE=20,MINOR_TRUE=21,MINOR_NULL=22,MINOR_UNDEFINED=23;function decodeUndefined(o,s,a,et){if(et.allowUndefined===!1)throw new Error(`${decodeErrPrefix} undefined values are not supported`);return et.coerceUndefinedToNull===!0?new Token(Type.null,null,1):new Token(Type.undefined,void 0,1)}function decodeBreak(o,s,a,et){if(et.allowIndefinite===!1)throw new Error(`${decodeErrPrefix} indefinite length items not allowed`);return new Token(Type.break,void 0,1)}function createToken(o,s,a){if(a){if(a.allowNaN===!1&&Number.isNaN(o))throw new Error(`${decodeErrPrefix} NaN values are not supported`);if(a.allowInfinity===!1&&(o===1/0||o===-1/0))throw new Error(`${decodeErrPrefix} Infinity values are not supported`)}return new Token(Type.float,o,s)}function decodeFloat16(o,s,a,et){return createToken(readFloat16(o,s+1),3,et)}function decodeFloat32(o,s,a,et){return createToken(readFloat32(o,s+1),5,et)}function decodeFloat64(o,s,a,et){return createToken(readFloat64(o,s+1),9,et)}function encodeFloat(o,s,a){const et=s.value;if(et===!1)o.push([Type.float.majorEncoded|MINOR_FALSE]);else if(et===!0)o.push([Type.float.majorEncoded|MINOR_TRUE]);else if(et===null)o.push([Type.float.majorEncoded|MINOR_NULL]);else if(et===void 0)o.push([Type.float.majorEncoded|MINOR_UNDEFINED]);else{let tt,rt=!1;(!a||a.float64!==!0)&&(encodeFloat16(et),tt=readFloat16(ui8a,1),et===tt||Number.isNaN(et)?(ui8a[0]=249,o.push(ui8a.slice(0,3)),rt=!0):(encodeFloat32(et),tt=readFloat32(ui8a,1),et===tt&&(ui8a[0]=250,o.push(ui8a.slice(0,5)),rt=!0))),rt||(encodeFloat64(et),tt=readFloat64(ui8a,1),ui8a[0]=251,o.push(ui8a.slice(0,9)))}}encodeFloat.encodedSize=function(s,a){const et=s.value;if(et===!1||et===!0||et===null||et===void 0)return 1;if(!a||a.float64!==!0){encodeFloat16(et);let tt=readFloat16(ui8a,1);if(et===tt||Number.isNaN(et))return 3;if(encodeFloat32(et),tt=readFloat32(ui8a,1),et===tt)return 5}return 9};const buffer=new ArrayBuffer(9),dataView=new DataView(buffer,1),ui8a=new Uint8Array(buffer,0);function encodeFloat16(o){if(o===1/0)dataView.setUint16(0,31744,!1);else if(o===-1/0)dataView.setUint16(0,64512,!1);else if(Number.isNaN(o))dataView.setUint16(0,32256,!1);else{dataView.setFloat32(0,o);const s=dataView.getUint32(0),a=(s&2139095040)>>23,et=s&8388607;if(a===255)dataView.setUint16(0,31744,!1);else if(a===0)dataView.setUint16(0,(o&2147483648)>>16|et>>13,!1);else{const tt=a-127;tt<-24?dataView.setUint16(0,0):tt<-14?dataView.setUint16(0,(s&2147483648)>>16|1<<24+tt,!1):dataView.setUint16(0,(s&2147483648)>>16|tt+15<<10|et>>13,!1)}}}function readFloat16(o,s){if(o.length-s<2)throw new Error(`${decodeErrPrefix} not enough data for float16`);const a=(o[s]<<8)+o[s+1];if(a===31744)return 1/0;if(a===64512)return-1/0;if(a===32256)return NaN;const et=a>>10&31,tt=a&1023;let rt;return et===0?rt=tt*2**-24:et!==31?rt=(tt+1024)*2**(et-25):rt=tt===0?1/0:NaN,a&32768?-rt:rt}function encodeFloat32(o){dataView.setFloat32(0,o,!1)}function readFloat32(o,s){if(o.length-s<4)throw new Error(`${decodeErrPrefix} not enough data for float32`);const a=(o.byteOffset||0)+s;return new DataView(o.buffer,a,4).getFloat32(0,!1)}function encodeFloat64(o){dataView.setFloat64(0,o,!1)}function readFloat64(o,s){if(o.length-s<8)throw new Error(`${decodeErrPrefix} not enough data for float64`);const a=(o.byteOffset||0)+s;return new DataView(o.buffer,a,8).getFloat64(0,!1)}encodeFloat.compareTokens=encodeUint.compareTokens;function invalidMinor(o,s,a){throw new Error(`${decodeErrPrefix} encountered invalid minor (${a}) for major ${o[s]>>>5}`)}function errorer(o){return()=>{throw new Error(`${decodeErrPrefix} ${o}`)}}const jump=[];for(let o=0;o<=23;o++)jump[o]=invalidMinor;jump[24]=decodeUint8;jump[25]=decodeUint16;jump[26]=decodeUint32;jump[27]=decodeUint64;jump[28]=invalidMinor;jump[29]=invalidMinor;jump[30]=invalidMinor;jump[31]=invalidMinor;for(let o=32;o<=55;o++)jump[o]=invalidMinor;jump[56]=decodeNegint8;jump[57]=decodeNegint16;jump[58]=decodeNegint32;jump[59]=decodeNegint64;jump[60]=invalidMinor;jump[61]=invalidMinor;jump[62]=invalidMinor;jump[63]=invalidMinor;for(let o=64;o<=87;o++)jump[o]=decodeBytesCompact;jump[88]=decodeBytes8;jump[89]=decodeBytes16;jump[90]=decodeBytes32;jump[91]=decodeBytes64;jump[92]=invalidMinor;jump[93]=invalidMinor;jump[94]=invalidMinor;jump[95]=errorer("indefinite length bytes/strings are not supported");for(let o=96;o<=119;o++)jump[o]=decodeStringCompact;jump[120]=decodeString8;jump[121]=decodeString16;jump[122]=decodeString32;jump[123]=decodeString64;jump[124]=invalidMinor;jump[125]=invalidMinor;jump[126]=invalidMinor;jump[127]=errorer("indefinite length bytes/strings are not supported");for(let o=128;o<=151;o++)jump[o]=decodeArrayCompact;jump[152]=decodeArray8;jump[153]=decodeArray16;jump[154]=decodeArray32;jump[155]=decodeArray64;jump[156]=invalidMinor;jump[157]=invalidMinor;jump[158]=invalidMinor;jump[159]=decodeArrayIndefinite;for(let o=160;o<=183;o++)jump[o]=decodeMapCompact;jump[184]=decodeMap8;jump[185]=decodeMap16;jump[186]=decodeMap32;jump[187]=decodeMap64;jump[188]=invalidMinor;jump[189]=invalidMinor;jump[190]=invalidMinor;jump[191]=decodeMapIndefinite;for(let o=192;o<=215;o++)jump[o]=decodeTagCompact;jump[216]=decodeTag8;jump[217]=decodeTag16;jump[218]=decodeTag32;jump[219]=decodeTag64;jump[220]=invalidMinor;jump[221]=invalidMinor;jump[222]=invalidMinor;jump[223]=invalidMinor;for(let o=224;o<=243;o++)jump[o]=errorer("simple values are not supported");jump[244]=invalidMinor;jump[245]=invalidMinor;jump[246]=invalidMinor;jump[247]=decodeUndefined;jump[248]=errorer("simple values are not supported");jump[249]=decodeFloat16;jump[250]=decodeFloat32;jump[251]=decodeFloat64;jump[252]=invalidMinor;jump[253]=invalidMinor;jump[254]=invalidMinor;jump[255]=decodeBreak;const quick=[];for(let o=0;o<24;o++)quick[o]=new Token(Type.uint,o,1);for(let o=-1;o>=-24;o--)quick[31-o]=new Token(Type.negint,o,1);quick[64]=new Token(Type.bytes,new Uint8Array(0),1);quick[96]=new Token(Type.string,"",1);quick[128]=new Token(Type.array,0,1);quick[160]=new Token(Type.map,0,1);quick[244]=new Token(Type.false,!1,1);quick[245]=new Token(Type.true,!0,1);quick[246]=new Token(Type.null,null,1);function quickEncodeToken(o){switch(o.type){case Type.false:return fromArray([244]);case Type.true:return fromArray([245]);case Type.null:return fromArray([246]);case Type.bytes:return o.value.length?void 0:fromArray([64]);case Type.string:return o.value===""?fromArray([96]):void 0;case Type.array:return o.value===0?fromArray([128]):void 0;case Type.map:return o.value===0?fromArray([160]):void 0;case Type.uint:return o.value<24?fromArray([Number(o.value)]):void 0;case Type.negint:if(o.value>=-24)return fromArray([31-Number(o.value)])}}const defaultEncodeOptions={float64:!1,mapSorter,quickEncodeToken};function makeCborEncoders(){const o=[];return o[Type.uint.major]=encodeUint,o[Type.negint.major]=encodeNegint,o[Type.bytes.major]=encodeBytes,o[Type.string.major]=encodeString,o[Type.array.major]=encodeArray,o[Type.map.major]=encodeMap,o[Type.tag.major]=encodeTag,o[Type.float.major]=encodeFloat,o}const cborEncoders=makeCborEncoders(),buf=new Bl;class Ref{constructor(s,a){this.obj=s,this.parent=a}includes(s){let a=this;do if(a.obj===s)return!0;while(a=a.parent);return!1}static createCheck(s,a){if(s&&s.includes(a))throw new Error(`${encodeErrPrefix} object contains circular references`);return new Ref(a,s)}}const simpleTokens={null:new Token(Type.null,null),undefined:new Token(Type.undefined,void 0),true:new Token(Type.true,!0),false:new Token(Type.false,!1),emptyArray:new Token(Type.array,0),emptyMap:new Token(Type.map,0)},typeEncoders={number(o,s,a,et){return!Number.isInteger(o)||!Number.isSafeInteger(o)?new Token(Type.float,o):o>=0?new Token(Type.uint,o):new Token(Type.negint,o)},bigint(o,s,a,et){return o>=BigInt(0)?new Token(Type.uint,o):new Token(Type.negint,o)},Uint8Array(o,s,a,et){return new Token(Type.bytes,o)},string(o,s,a,et){return new Token(Type.string,o)},boolean(o,s,a,et){return o?simpleTokens.true:simpleTokens.false},null(o,s,a,et){return simpleTokens.null},undefined(o,s,a,et){return simpleTokens.undefined},ArrayBuffer(o,s,a,et){return new Token(Type.bytes,new Uint8Array(o))},DataView(o,s,a,et){return new Token(Type.bytes,new Uint8Array(o.buffer,o.byteOffset,o.byteLength))},Array(o,s,a,et){if(!o.length)return a.addBreakTokens===!0?[simpleTokens.emptyArray,new Token(Type.break)]:simpleTokens.emptyArray;et=Ref.createCheck(et,o);const tt=[];let rt=0;for(const nt of o)tt[rt++]=objectToTokens(nt,a,et);return a.addBreakTokens?[new Token(Type.array,o.length),tt,new Token(Type.break)]:[new Token(Type.array,o.length),tt]},Object(o,s,a,et){const tt=s!=="Object",rt=tt?o.keys():Object.keys(o),nt=tt?o.size:rt.length;if(!nt)return a.addBreakTokens===!0?[simpleTokens.emptyMap,new Token(Type.break)]:simpleTokens.emptyMap;et=Ref.createCheck(et,o);const it=[];let st=0;for(const ot of rt)it[st++]=[objectToTokens(ot,a,et),objectToTokens(tt?o.get(ot):o[ot],a,et)];return sortMapEntries(it,a),a.addBreakTokens?[new Token(Type.map,nt),it,new Token(Type.break)]:[new Token(Type.map,nt),it]}};typeEncoders.Map=typeEncoders.Object;typeEncoders.Buffer=typeEncoders.Uint8Array;for(const o of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))typeEncoders[`${o}Array`]=typeEncoders.DataView;function objectToTokens(o,s={},a){const et=is$2(o),tt=s&&s.typeEncoders&&s.typeEncoders[et]||typeEncoders[et];if(typeof tt=="function"){const nt=tt(o,et,s,a);if(nt!=null)return nt}const rt=typeEncoders[et];if(!rt)throw new Error(`${encodeErrPrefix} unsupported type: ${et}`);return rt(o,et,s,a)}function sortMapEntries(o,s){s.mapSorter&&o.sort(s.mapSorter)}function mapSorter(o,s){const a=Array.isArray(o[0])?o[0][0]:o[0],et=Array.isArray(s[0])?s[0][0]:s[0];if(a.type!==et.type)return a.type.compare(et.type);const tt=a.type.major,rt=cborEncoders[tt].compareTokens(a,et);return rt===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),rt}function tokensToEncoded(o,s,a,et){if(Array.isArray(s))for(const tt of s)tokensToEncoded(o,tt,a,et);else a[s.type.major](o,s,et)}function encodeCustom(o,s,a){const et=objectToTokens(o,a);if(!Array.isArray(et)&&a.quickEncodeToken){const tt=a.quickEncodeToken(et);if(tt)return tt;const rt=s[et.type.major];if(rt.encodedSize){const nt=rt.encodedSize(et,a),it=new Bl(nt);if(rt(it,et,a),it.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${et} was wrong`);return asU8A(it.chunks[0])}}return buf.reset(),tokensToEncoded(buf,et,s,a),buf.toBytes(!0)}function encode$5(o,s){return s=Object.assign({},defaultEncodeOptions,s),encodeCustom(o,cborEncoders,s)}const defaultDecodeOptions={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class Tokeniser{constructor(s,a={}){this._pos=0,this.data=s,this.options=a}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){const s=this.data[this._pos];let a=quick[s];if(a===void 0){const et=jump[s];if(!et)throw new Error(`${decodeErrPrefix} no decoder for major type ${s>>>5} (byte 0x${s.toString(16).padStart(2,"0")})`);const tt=s&31;a=et(this.data,this._pos,tt,this.options)}return this._pos+=a.encodedLength,a}}const DONE=Symbol.for("DONE"),BREAK=Symbol.for("BREAK");function tokenToArray(o,s,a){const et=[];for(let tt=0;tt<o.value;tt++){const rt=tokensToObject(s,a);if(rt===BREAK){if(o.value===1/0)break;throw new Error(`${decodeErrPrefix} got unexpected break to lengthed array`)}if(rt===DONE)throw new Error(`${decodeErrPrefix} found array but not enough entries (got ${tt}, expected ${o.value})`);et[tt]=rt}return et}function tokenToMap(o,s,a){const et=a.useMaps===!0,tt=et?void 0:{},rt=et?new Map:void 0;for(let nt=0;nt<o.value;nt++){const it=tokensToObject(s,a);if(it===BREAK){if(o.value===1/0)break;throw new Error(`${decodeErrPrefix} got unexpected break to lengthed map`)}if(it===DONE)throw new Error(`${decodeErrPrefix} found map but not enough entries (got ${nt} [no key], expected ${o.value})`);if(et!==!0&&typeof it!="string")throw new Error(`${decodeErrPrefix} non-string keys not supported (got ${typeof it})`);if(a.rejectDuplicateMapKeys===!0&&(et&&rt.has(it)||!et&&it in tt))throw new Error(`${decodeErrPrefix} found repeat map key "${it}"`);const st=tokensToObject(s,a);if(st===DONE)throw new Error(`${decodeErrPrefix} found map but not enough entries (got ${nt} [no value], expected ${o.value})`);et?rt.set(it,st):tt[it]=st}return et?rt:tt}function tokensToObject(o,s){if(o.done())return DONE;const a=o.next();if(a.type===Type.break)return BREAK;if(a.type.terminal)return a.value;if(a.type===Type.array)return tokenToArray(a,o,s);if(a.type===Type.map)return tokenToMap(a,o,s);if(a.type===Type.tag){if(s.tags&&typeof s.tags[a.value]=="function"){const et=tokensToObject(o,s);return s.tags[a.value](et)}throw new Error(`${decodeErrPrefix} tag not supported (${a.value})`)}throw new Error("unsupported")}function decodeFirst(o,s){if(!(o instanceof Uint8Array))throw new Error(`${decodeErrPrefix} data to decode must be a Uint8Array`);s=Object.assign({},defaultDecodeOptions,s);const a=s.tokenizer||new Tokeniser(o,s),et=tokensToObject(a,s);if(et===DONE)throw new Error(`${decodeErrPrefix} did not find any content to decode`);if(et===BREAK)throw new Error(`${decodeErrPrefix} got unexpected break`);return[et,o.subarray(a.pos())]}function decode$7(o,s){const[a,et]=decodeFirst(o,s);if(et.length>0)throw new Error(`${decodeErrPrefix} too many terminals, data makes no sense`);return a}function allocUnsafe$k(o=0){return new Uint8Array(o)}function createCodec$k(o,s,a,et){return{name:o,prefix:s,encoder:{name:o,prefix:s,encode:a},decoder:{decode:et}}}const string$l=createCodec$k("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),ascii$k=createCodec$k("ascii","a",o=>{let s="a";for(let a=0;a<o.length;a++)s+=String.fromCharCode(o[a]);return s},o=>{o=o.substring(1);const s=allocUnsafe$k(o.length);for(let a=0;a<o.length;a++)s[a]=o.charCodeAt(a);return s}),BASES$k={utf8:string$l,"utf-8":string$l,hex:bases.base16,latin1:ascii$k,ascii:ascii$k,binary:ascii$k,...bases};function fromString$m(o,s="utf8"){const a=BASES$k[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.decoder.decode(`${a.prefix}${o}`)}function toString$e(o,s="utf8"){const a=BASES$k[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.encoder.encode(o).substring(1)}const pathSepS="/",pathSepB=new TextEncoder().encode(pathSepS),pathSep=pathSepB[0];class Key{_buf;constructor(s,a){if(typeof s=="string")this._buf=fromString$m(s);else if(s instanceof Uint8Array)this._buf=s;else throw new Error("Invalid key, should be String of Uint8Array");if(a==null&&(a=!0),a&&this.clean(),this._buf.byteLength===0||this._buf[0]!==pathSep)throw new Error("Invalid key")}toString(s="utf8"){return toString$e(this._buf,s)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(s){return new Key(s.join(pathSepS))}static random(){return new Key(Math.random().toString().substring(2))}static asKey(s){return s instanceof Uint8Array||typeof s=="string"?new Key(s):typeof s.uint8Array=="function"?new Key(s.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=pathSepB),this._buf[0]!==pathSep){const s=new Uint8Array(this._buf.byteLength+1);s.fill(pathSep,0,1),s.set(this._buf,1),this._buf=s}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===pathSep;)this._buf=this._buf.subarray(0,-1)}less(s){const a=this.list(),et=s.list();for(let tt=0;tt<a.length;tt++){if(et.length<tt+1)return!1;const rt=a[tt],nt=et[tt];if(rt<nt)return!0;if(rt>nt)return!1}return a.length<et.length}reverse(){return Key.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const s=this.namespaces();return s[s.length-1]}list(){return this.toString().split(pathSepS).slice(1)}type(){return namespaceType(this.baseNamespace())}name(){return namespaceValue(this.baseNamespace())}instance(s){return new Key(this.toString()+":"+s)}path(){let s=this.parent().toString();return s.endsWith(pathSepS)||(s+=pathSepS),s+=this.type(),new Key(s)}parent(){const s=this.list();return s.length===1?new Key(pathSepS):new Key(s.slice(0,-1).join(pathSepS))}child(s){return this.toString()===pathSepS?s:s.toString()===pathSepS?this:new Key(this.toString()+s.toString(),!1)}isAncestorOf(s){return s.toString()===this.toString()?!1:s.toString().startsWith(this.toString())}isDecendantOf(s){return s.toString()===this.toString()?!1:this.toString().startsWith(s.toString())}isTopLevel(){return this.list().length===1}concat(...s){return Key.withNamespaces([...this.namespaces(),...flatten(s.map(a=>a.namespaces()))])}}function namespaceType(o){const s=o.split(":");return s.length<2?"":s.slice(0,-1).join(":")}function namespaceValue(o){const s=o.split(":");return s[s.length-1]}function flatten(o){return[].concat(...o)}function equals$c(o,s){if(o===s)return!0;if(o.byteLength!==s.byteLength)return!1;for(let a=0;a<o.byteLength;a++)if(o[a]!==s[a])return!1;return!0}const DATASTORE_PIN_PREFIX="/pin/",DATASTORE_BLOCK_PREFIX="/pinned-block/",DATASTORE_ENCODING=base36,DAG_WALK_QUEUE_CONCURRENCY=1;function toDSKey(o){return o.version===0&&(o=o.toV1()),new Key(`${DATASTORE_PIN_PREFIX}${o.toString(DATASTORE_ENCODING)}`)}class PinsImpl{datastore;blockstore;dagWalkers;constructor(s,a,et){this.datastore=s,this.blockstore=a,this.dagWalkers=et}async*add(s,a={}){const et=toDSKey(s);if(await this.datastore.has(et))throw new Error("Already pinned");const tt=Math.round(a.depth??1/0);if(tt<0)throw new Error("Depth must be greater than or equal to 0");const rt=new Queue({concurrency:DAG_WALK_QUEUE_CONCURRENCY});for await(const it of this.#e(s,rt,{...a,depth:tt}))await this.#t(it,st=>st.pinnedBy.find(ot=>equals$c(ot,s.bytes))!=null?!1:(st.pinCount++,st.pinnedBy.push(s.bytes),!0),a),yield it;const nt={depth:tt,metadata:a.metadata??{}};await this.datastore.put(et,encode$5(nt),a)}async*#e(s,a,et){if(et.depth===-1)return;const tt=this.dagWalkers[s.code];if(tt==null)throw new Error(`No dag walker found for cid codec ${s.code}`);const rt=await this.blockstore.get(s,et);yield s;for await(const nt of tt.walk(rt))yield*await a.add(async()=>this.#e(nt,a,{...et,depth:et.depth-1}))}async#t(s,a,et){const tt=new Key(`${DATASTORE_BLOCK_PREFIX}${DATASTORE_ENCODING.encode(s.multihash.bytes)}`);let rt={pinCount:0,pinnedBy:[]};try{rt=decode$7(await this.datastore.get(tt,et))}catch(it){if(it.code!=="ERR_NOT_FOUND")throw it}if(a(rt)){if(rt.pinCount===0&&await this.datastore.has(tt)){await this.datastore.delete(tt);return}await this.datastore.put(tt,encode$5(rt),et),et.onProgress?.(new CustomProgressEvent("helia:pin:add",s))}}async*rm(s,a={}){const et=toDSKey(s),tt=await this.datastore.get(et,a),rt=decode$7(tt);await this.datastore.delete(et,a);const nt=new Queue({concurrency:DAG_WALK_QUEUE_CONCURRENCY});for await(const it of this.#e(s,nt,{...a,depth:rt.depth}))await this.#t(it,st=>(st.pinCount--,st.pinnedBy=st.pinnedBy.filter(ot=>equals$c(ot,s.bytes)),!0),{...a,depth:rt.depth}),yield it}async*ls(s={}){for await(const{key:a,value:et}of this.datastore.query({prefix:DATASTORE_PIN_PREFIX+(s.cid!=null?`${s.cid.toString(base36)}`:"")},s)){const tt=CID.parse(a.toString().substring(5),base36),rt=decode$7(et);yield{cid:tt,...rt}}}async isPinned(s,a={}){const et=new Key(`${DATASTORE_BLOCK_PREFIX}${DATASTORE_ENCODING.encode(s.multihash.bytes)}`);return this.datastore.has(et,a)}}const DEFAULT_PROVIDER_LOOKUP_CONCURRENCY=5;class Routing{log;routers;providerLookupConcurrency;constructor(s,a){this.log=s.logger.forComponent("helia:routing"),this.routers=a.routers??[],this.providerLookupConcurrency=a.providerLookupConcurrency??DEFAULT_PROVIDER_LOOKUP_CONCURRENCY}async start(){await start(...this.routers)}async stop(){await stop(...this.routers)}async*findProviders(s,a={}){if(this.routers.length===0)throw new CodeError$3("No content routers available","ERR_NO_ROUTERS_AVAILABLE");const et=new PeerQueue({concurrency:this.providerLookupConcurrency});et.addEventListener("error",()=>{});for await(const tt of merge$2(et.toGenerator(),...supports(this.routers,"findProviders").map(rt=>rt.findProviders(s,a))))if(tt!=null){if(tt.multiaddrs.length===0){if(et.find(tt.id)!=null)continue;et.add(async()=>{try{const rt=await this.findPeer(tt.id,a);return rt.multiaddrs.length===0?null:rt}catch(rt){return this.log.error("could not load multiaddrs for peer %p",tt.id,rt),null}},{peerId:tt.id,signal:a.signal}).catch(rt=>{this.log.error("could not load multiaddrs for peer %p",tt.id,rt)})}yield tt}}async provide(s,a={}){if(this.routers.length===0)throw new CodeError$3("No content routers available","ERR_NO_ROUTERS_AVAILABLE");await Promise.all(supports(this.routers,"provide").map(async et=>{await et.provide(s,a)}))}async put(s,a,et){await Promise.all(supports(this.routers,"put").map(async tt=>{await tt.put(s,a,et)}))}async get(s,a){return Promise.any(supports(this.routers,"get").map(async et=>et.get(s,a)))}async findPeer(s,a){if(this.routers.length===0)throw new CodeError$3("No peer routers available","ERR_NO_ROUTERS_AVAILABLE");const et=this,tt=merge$2(...supports(this.routers,"findPeer").map(rt=>async function*(){try{yield await rt.findPeer(s,a)}catch(nt){et.log.error(nt)}}()));for await(const rt of tt)if(rt!=null)return rt;throw new CodeError$3("Could not find peer in routing","ERR_NOT_FOUND")}async*getClosestPeers(s,a={}){if(this.routers.length===0)throw new CodeError$3("No peer routers available","ERR_NO_ROUTERS_AVAILABLE");for await(const et of merge$2(...supports(this.routers,"getClosestPeers").map(tt=>tt.getClosestPeers(s,a))))et!=null&&(yield et)}}function supports(o,s){return o.filter(a=>a[s]!=null)}const events={},observable=o=>{o.addEventListener("message",s=>{observable.dispatchEvent("message",o,s)}),o.port!=null&&o.port.addEventListener("message",s=>{observable.dispatchEvent("message",o,s)})};observable.addEventListener=(o,s)=>{events[o]==null&&(events[o]=[]),events[o].push(s)};observable.removeEventListener=(o,s)=>{events[o]!=null&&(events[o]=events[o].filter(a=>a===s))};observable.dispatchEvent=function(o,s,a){events[o]!=null&&events[o].forEach(et=>et(s,a))};const WORKER_REQUEST_READ_LOCK="lock:worker:request-read",WORKER_RELEASE_READ_LOCK="lock:worker:release-read",MASTER_GRANT_READ_LOCK="lock:master:grant-read",WORKER_REQUEST_WRITE_LOCK="lock:worker:request-write",WORKER_RELEASE_WRITE_LOCK="lock:worker:release-write",MASTER_GRANT_WRITE_LOCK="lock:master:grant-write",nanoid=(o=21)=>Math.random().toString().substring(2),handleWorkerLockRequest=(o,s,a,et,tt)=>(rt,nt)=>{if(nt.data.type!==a)return;const it={type:nt.data.type,name:nt.data.name,identifier:nt.data.identifier};o.dispatchEvent(new MessageEvent(s,{data:{name:it.name,handler:async()=>{rt.postMessage({type:tt,name:it.name,identifier:it.identifier}),await new Promise(st=>{const ot=at=>{if(at==null||at.data==null)return;const lt={type:at.data.type,name:at.data.name,identifier:at.data.identifier};lt.type===et&&lt.identifier===it.identifier&&(rt.removeEventListener("message",ot),st())};rt.addEventListener("message",ot)})}}}))},makeWorkerLockRequest=(o,s,a,et)=>async()=>{const tt=nanoid();return globalThis.postMessage({type:s,identifier:tt,name:o}),new Promise(rt=>{const nt=it=>{if(it==null||it.data==null)return;const st={type:it.data.type,identifier:it.data.identifier};st.type===a&&st.identifier===tt&&(globalThis.removeEventListener("message",nt),rt(()=>{globalThis.postMessage({type:et,identifier:tt,name:o})}))};globalThis.addEventListener("message",nt)})},defaultOptions$e={singleProcess:!1},impl=o=>{if(o=Object.assign({},defaultOptions$e,o),!!globalThis.document||o.singleProcess){const a=new EventTarget;return observable.addEventListener("message",handleWorkerLockRequest(a,"requestReadLock",WORKER_REQUEST_READ_LOCK,WORKER_RELEASE_READ_LOCK,MASTER_GRANT_READ_LOCK)),observable.addEventListener("message",handleWorkerLockRequest(a,"requestWriteLock",WORKER_REQUEST_WRITE_LOCK,WORKER_RELEASE_WRITE_LOCK,MASTER_GRANT_WRITE_LOCK)),a}return{isWorker:!0,readLock:a=>makeWorkerLockRequest(a,WORKER_REQUEST_READ_LOCK,MASTER_GRANT_READ_LOCK,WORKER_RELEASE_READ_LOCK),writeLock:a=>makeWorkerLockRequest(a,WORKER_REQUEST_WRITE_LOCK,MASTER_GRANT_WRITE_LOCK,WORKER_RELEASE_WRITE_LOCK)}},mutexes={};let implementation;async function createReleaseable(o,s){let a;const et=new Promise(tt=>{a=tt});return o.add(async()=>pTimeout((async()=>{await new Promise(tt=>{a(()=>{tt()})})})(),{milliseconds:s.timeout})),et}const createMutex=(o,s)=>{if(implementation.isWorker===!0)return{readLock:implementation.readLock(o,s),writeLock:implementation.writeLock(o,s)};const a=new PQueue({concurrency:1});let et;return{async readLock(){if(et!=null)return createReleaseable(et,s);et=new PQueue({concurrency:s.concurrency,autoStart:!1});const tt=et,rt=createReleaseable(et,s);return a.add(async()=>{tt.start(),await tt.onIdle().then(()=>{et===tt&&(et=null)})}),rt},async writeLock(){return et=null,createReleaseable(a,s)}}},defaultOptions$d={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function createMortice(o){const s=Object.assign({},defaultOptions$d,o);return implementation==null&&(implementation=impl(s),implementation.isWorker!==!0&&(implementation.addEventListener("requestReadLock",a=>{mutexes[a.data.name]!=null&&mutexes[a.data.name].readLock().then(async et=>a.data.handler().finally(()=>{et()}))}),implementation.addEventListener("requestWriteLock",async a=>{mutexes[a.data.name]!=null&&mutexes[a.data.name].writeLock().then(async et=>a.data.handler().finally(()=>{et()}))}))),mutexes[s.name]==null&&(mutexes[s.name]=createMutex(s.name,s)),mutexes[s.name]}class BlockStorage{lock;child;pins;started;constructor(s,a,et={}){this.child=s,this.pins=a,this.lock=createMortice({singleProcess:et.holdGcLock}),this.started=!1}isStarted(){return this.started}async start(){await start(this.child),this.started=!0}async stop(){await stop(this.child),this.started=!1}unwrap(){return this.child}async put(s,a,et={}){et?.signal?.throwIfAborted();const tt=await this.lock.readLock();try{return await this.child.put(s,a,et)}finally{tt()}}async*putMany(s,a={}){a?.signal?.throwIfAborted();const et=await this.lock.readLock();try{yield*this.child.putMany(s,a)}finally{et()}}async get(s,a={}){a?.signal?.throwIfAborted();const et=await this.lock.readLock();try{return await this.child.get(s,a)}finally{et()}}async*getMany(s,a={}){a?.signal?.throwIfAborted();const et=await this.lock.readLock();try{yield*this.child.getMany(s,a)}finally{et()}}async delete(s,a={}){a?.signal?.throwIfAborted();const et=await this.lock.writeLock();try{if(await this.pins.isPinned(s))throw new Error("CID was pinned");await this.child.delete(s,a)}finally{et()}}async*deleteMany(s,a={}){a?.signal?.throwIfAborted();const et=await this.lock.writeLock();try{const tt=this;yield*this.child.deleteMany(async function*(){for await(const rt of s){if(await tt.pins.isPinned(rt))throw new Error("CID was pinned");yield rt}}(),a)}finally{et()}}async has(s,a={}){a?.signal?.throwIfAborted();const et=await this.lock.readLock();try{return await this.child.has(s,a)}finally{et()}}async*getAll(s={}){s?.signal?.throwIfAborted();const a=await this.lock.readLock();try{yield*this.child.getAll(s)}finally{a()}}createSession(s,a){return a?.signal?.throwIfAborted(),this.child.createSession(s,a)}}const CID_CBOR_TAG=42;function toByteView$2(o){return o instanceof ArrayBuffer?new Uint8Array(o,0,o.byteLength):o}function cidEncoder(o){if(o.asCID!==o&&o["/"]!==o.bytes)return null;const s=CID.asCID(o);if(!s)return null;const a=new Uint8Array(s.bytes.byteLength+1);return a.set(s.bytes,1),[new Token(Type.tag,CID_CBOR_TAG),new Token(Type.bytes,a)]}function undefinedEncoder(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function numberEncoder(o){if(Number.isNaN(o))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(o===1/0||o===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const _encodeOptions={float64:!0,typeEncoders:{Object:cidEncoder,undefined:undefinedEncoder,number:numberEncoder}};({..._encodeOptions,typeEncoders:{..._encodeOptions.typeEncoders}});function cidDecoder(o){if(o[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return CID.decode(o.subarray(1))}const _decodeOptions={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};_decodeOptions.tags[CID_CBOR_TAG]=cidDecoder;({..._decodeOptions,tags:_decodeOptions.tags.slice()});const code$2=113,decode$6=o=>decode$7(toByteView$2(o),_decodeOptions);class JSONEncoder extends Array{constructor(){super(),this.inRecursive=[]}prefix(s){const a=this.inRecursive[this.inRecursive.length-1];a&&(a.type===Type.array&&(a.elements++,a.elements!==1&&s.push([44])),a.type===Type.map&&(a.elements++,a.elements!==1&&(a.elements%2===1?s.push([44]):s.push([58]))))}[Type.uint.major](s,a){this.prefix(s);const et=String(a.value),tt=[];for(let rt=0;rt<et.length;rt++)tt[rt]=et.charCodeAt(rt);s.push(tt)}[Type.negint.major](s,a){this[Type.uint.major](s,a)}[Type.bytes.major](s,a){throw new Error(`${encodeErrPrefix} unsupported type: Uint8Array`)}[Type.string.major](s,a){this.prefix(s);const et=fromString$n(JSON.stringify(a.value));s.push(et.length>32?asU8A(et):et)}[Type.array.major](s,a){this.prefix(s),this.inRecursive.push({type:Type.array,elements:0}),s.push([91])}[Type.map.major](s,a){this.prefix(s),this.inRecursive.push({type:Type.map,elements:0}),s.push([123])}[Type.tag.major](s,a){}[Type.float.major](s,a){if(a.type.name==="break"){const nt=this.inRecursive.pop();if(nt){if(nt.type===Type.array)s.push([93]);else if(nt.type===Type.map)s.push([125]);else throw new Error("Unexpected recursive type; this should not happen!");return}throw new Error("Unexpected break; this should not happen!")}if(a.value===void 0)throw new Error(`${encodeErrPrefix} unsupported type: undefined`);if(this.prefix(s),a.type.name==="true"){s.push([116,114,117,101]);return}else if(a.type.name==="false"){s.push([102,97,108,115,101]);return}else if(a.type.name==="null"){s.push([110,117,108,108]);return}const et=String(a.value),tt=[];let rt=!1;for(let nt=0;nt<et.length;nt++)tt[nt]=et.charCodeAt(nt),!rt&&(tt[nt]===46||tt[nt]===101||tt[nt]===69)&&(rt=!0);rt||(tt.push(46),tt.push(48)),s.push(tt)}}class Tokenizer{constructor(s,a={}){this._pos=0,this.data=s,this.options=a,this.modeStack=["value"],this.lastToken=""}pos(){return this._pos}done(){return this._pos>=this.data.length}ch(){return this.data[this._pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let s=this.ch();for(;s===32||s===9||s===13||s===10;)s=this.data[++this._pos]}expect(s){if(this.data.length-this._pos<s.length)throw new Error(`${decodeErrPrefix} unexpected end of input at position ${this._pos}`);for(let a=0;a<s.length;a++)if(this.data[this._pos++]!==s[a])throw new Error(`${decodeErrPrefix} unexpected token at position ${this._pos}, expected to find '${String.fromCharCode(...s)}'`)}parseNumber(){const s=this._pos;let a=!1,et=!1;const tt=it=>{for(;!this.done();){const st=this.ch();if(it.includes(st))this._pos++;else break}};if(this.ch()===45&&(a=!0,this._pos++),this.ch()===48)if(this._pos++,this.ch()===46)this._pos++,et=!0;else return new Token(Type.uint,0,this._pos-s);if(tt([48,49,50,51,52,53,54,55,56,57]),a&&this._pos===s+1)throw new Error(`${decodeErrPrefix} unexpected token at position ${this._pos}`);if(!this.done()&&this.ch()===46){if(et)throw new Error(`${decodeErrPrefix} unexpected token at position ${this._pos}`);et=!0,this._pos++,tt([48,49,50,51,52,53,54,55,56,57])}!this.done()&&(this.ch()===101||this.ch()===69)&&(et=!0,this._pos++,!this.done()&&(this.ch()===43||this.ch()===45)&&this._pos++,tt([48,49,50,51,52,53,54,55,56,57]));const rt=String.fromCharCode.apply(null,this.data.subarray(s,this._pos)),nt=parseFloat(rt);return et?new Token(Type.float,nt,this._pos-s):this.options.allowBigInt!==!0||Number.isSafeInteger(nt)?new Token(nt>=0?Type.uint:Type.negint,nt,this._pos-s):new Token(nt>=0?Type.uint:Type.negint,BigInt(rt),this._pos-s)}parseString(){if(this.ch()!==34)throw new Error(`${decodeErrPrefix} unexpected character at position ${this._pos}; this shouldn't happen`);this._pos++;for(let rt=this._pos,nt=0;rt<this.data.length&&nt<65536;rt++,nt++){const it=this.data[rt];if(it===92||it<32||it>=128)break;if(it===34){const st=String.fromCharCode.apply(null,this.data.subarray(this._pos,rt));return this._pos=rt+1,new Token(Type.string,st,nt)}}const s=this._pos,a=[],et=()=>{if(this._pos+4>=this.data.length)throw new Error(`${decodeErrPrefix} unexpected end of unicode escape sequence at position ${this._pos}`);let rt=0;for(let nt=0;nt<4;nt++){let it=this.ch();if(it>=48&&it<=57)it-=48;else if(it>=97&&it<=102)it=it-97+10;else if(it>=65&&it<=70)it=it-65+10;else throw new Error(`${decodeErrPrefix} unexpected unicode escape character at position ${this._pos}`);rt=rt*16+it,this._pos++}return rt},tt=()=>{const rt=this.ch();let nt=null,it=rt>239?4:rt>223?3:rt>191?2:1;if(this._pos+it>this.data.length)throw new Error(`${decodeErrPrefix} unexpected unicode sequence at position ${this._pos}`);let st,ot,at,lt;switch(it){case 1:rt<128&&(nt=rt);break;case 2:st=this.data[this._pos+1],(st&192)===128&&(lt=(rt&31)<<6|st&63,lt>127&&(nt=lt));break;case 3:st=this.data[this._pos+1],ot=this.data[this._pos+2],(st&192)===128&&(ot&192)===128&&(lt=(rt&15)<<12|(st&63)<<6|ot&63,lt>2047&&(lt<55296||lt>57343)&&(nt=lt));break;case 4:st=this.data[this._pos+1],ot=this.data[this._pos+2],at=this.data[this._pos+3],(st&192)===128&&(ot&192)===128&&(at&192)===128&&(lt=(rt&15)<<18|(st&63)<<12|(ot&63)<<6|at&63,lt>65535&&lt<1114112&&(nt=lt))}nt===null?(nt=65533,it=1):nt>65535&&(nt-=65536,a.push(nt>>>10&1023|55296),nt=56320|nt&1023),a.push(nt),this._pos+=it};for(;!this.done();){const rt=this.ch();let nt;switch(rt){case 92:if(this._pos++,this.done())throw new Error(`${decodeErrPrefix} unexpected string termination at position ${this._pos}`);switch(nt=this.ch(),this._pos++,nt){case 34:case 39:case 92:case 47:a.push(nt);break;case 98:a.push(8);break;case 116:a.push(9);break;case 110:a.push(10);break;case 102:a.push(12);break;case 114:a.push(13);break;case 117:a.push(et());break;default:throw new Error(`${decodeErrPrefix} unexpected string escape character at position ${this._pos}`)}break;case 34:return this._pos++,new Token(Type.string,decodeCodePointsArray(a),this._pos-s);default:if(rt<32)throw new Error(`${decodeErrPrefix} invalid control character at position ${this._pos}`);rt<128?(a.push(rt),this._pos++):tt()}}throw new Error(`${decodeErrPrefix} unexpected end of string at position ${this._pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this._pos++,new Token(Type.map,1/0,1);case 91:return this.modeStack.push("array-start"),this._pos++,new Token(Type.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new Token(Type.null,null,4);case 102:return this.expect([102,97,108,115,101]),new Token(Type.false,!1,5);case 116:return this.expect([116,114,117,101]),new Token(Type.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${decodeErrPrefix} unexpected character at position ${this._pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":{if(this.modeStack.pop(),this.ch()===93)return this._pos++,this.skipWhitespace(),new Token(Type.break,void 0,1);if(this.ch()!==44)throw new Error(`${decodeErrPrefix} unexpected character at position ${this._pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue()}case"array-start":return this.modeStack.pop(),this.ch()===93?(this._pos++,this.skipWhitespace(),new Token(Type.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(this.ch()===125)return this.modeStack.pop(),this._pos++,this.skipWhitespace(),new Token(Type.break,void 0,1);if(this.ch()!==44)throw new Error(`${decodeErrPrefix} unexpected character at position ${this._pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this._pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),this.ch()===125)return this._pos++,this.skipWhitespace(),new Token(Type.break,void 0,1);const s=this.parseString();if(this.skipWhitespace(),this.ch()!==58)throw new Error(`${decodeErrPrefix} unexpected character at position ${this._pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("obj-value"),s}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${decodeErrPrefix} unexpected parse state at position ${this._pos}; this shouldn't happen`)}}}function decode$5(o,s){return s=Object.assign({tokenizer:new Tokenizer(o,s)},s),decode$7(o,s)}function toByteView$1(o){return o instanceof ArrayBuffer?new Uint8Array(o,0,o.byteLength):o}let DagJsonTokenizer$1=class extends Tokenizer{constructor(s,a){super(s,a),this.tokenBuffer=[]}done(){return this.tokenBuffer.length===0&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){const s=this._next();if(s.type===Type.map){const a=this._next();if(a.type===Type.string&&a.value==="/"){const et=this._next();if(et.type===Type.string){if(this._next().type!==Type.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(et),new Token(Type.tag,42,0)}if(et.type===Type.map){const tt=this._next();if(tt.type===Type.string&&tt.value==="bytes"){const rt=this._next();if(rt.type===Type.string){for(let it=0;it<2;it++)if(this._next().type!==Type.break)throw new Error("Invalid encoded Bytes form");const nt=base64.decode(`m${rt.value}`);return new Token(Type.bytes,nt,rt.value.length)}this.tokenBuffer.push(rt)}this.tokenBuffer.push(tt)}this.tokenBuffer.push(et)}this.tokenBuffer.push(a)}return s}};const decodeOptions={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};decodeOptions.tags[42]=CID.parse;const code$1=297,decode$4=o=>{const s=toByteView$1(o),a=Object.assign(decodeOptions,{tokenizer:new DagJsonTokenizer$1(s,decodeOptions)});return decode$5(s,a)};new TextDecoder;new TextEncoder;const textDecoder$1=new TextDecoder;function decodeVarint(o,s){let a=0;for(let et=0;;et+=7){if(et>=64)throw new Error("protobuf: varint overflow");if(s>=o.length)throw new Error("protobuf: unexpected end of data");const tt=o[s++];if(a+=et<28?(tt&127)<<et:(tt&127)*2**et,tt<128)break}return[a,s]}function decodeBytes(o,s){let a;[a,s]=decodeVarint(o,s);const et=s+a;if(a<0||et<0)throw new Error("protobuf: invalid length");if(et>o.length)throw new Error("protobuf: unexpected end of data");return[o.subarray(s,et),et]}function decodeKey(o,s){let a;return[a,s]=decodeVarint(o,s),[a&7,a>>3,s]}function decodeLink(o){const s={},a=o.length;let et=0;for(;et<a;){let tt,rt;if([tt,rt,et]=decodeKey(o,et),rt===1){if(s.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(tt!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${tt}) for Hash`);if(s.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(s.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[s.Hash,et]=decodeBytes(o,et)}else if(rt===2){if(s.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(tt!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${tt}) for Name`);if(s.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let nt;[nt,et]=decodeBytes(o,et),s.Name=textDecoder$1.decode(nt)}else if(rt===3){if(s.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(tt!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${tt}) for Tsize`);[s.Tsize,et]=decodeVarint(o,et)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${rt}`)}if(et>a)throw new Error("protobuf: (PBLink) unexpected end of data");return s}function decodeNode(o){const s=o.length;let a=0,et,tt=!1,rt;for(;a<s;){let it,st;if([it,st,a]=decodeKey(o,a),it!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${it}`);if(st===1){if(rt)throw new Error("protobuf: (PBNode) duplicate Data section");[rt,a]=decodeBytes(o,a),et&&(tt=!0)}else if(st===2){if(tt)throw new Error("protobuf: (PBNode) duplicate Links section");et||(et=[]);let ot;[ot,a]=decodeBytes(o,a),et.push(decodeLink(ot))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${st}`)}if(a>s)throw new Error("protobuf: (PBNode) unexpected end of data");const nt={};return rt&&(nt.Data=rt),nt.Links=et||[],nt}const textEncoder$2=new TextEncoder,maxInt32=2**32,maxUInt32=2**31;function encodeLink(o,s){let a=s.length;if(typeof o.Tsize=="number"){if(o.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(o.Tsize))throw new Error("Tsize too large for encoding");a=encodeVarint(s,a,o.Tsize)-1,s[a]=24}if(typeof o.Name=="string"){const et=textEncoder$2.encode(o.Name);a-=et.length,s.set(et,a),a=encodeVarint(s,a,et.length)-1,s[a]=18}return o.Hash&&(a-=o.Hash.length,s.set(o.Hash,a),a=encodeVarint(s,a,o.Hash.length)-1,s[a]=10),s.length-a}function encodeNode(o){const s=sizeNode(o),a=new Uint8Array(s);let et=s;if(o.Data&&(et-=o.Data.length,a.set(o.Data,et),et=encodeVarint(a,et,o.Data.length)-1,a[et]=10),o.Links)for(let tt=o.Links.length-1;tt>=0;tt--){const rt=encodeLink(o.Links[tt],a.subarray(0,et));et-=rt,et=encodeVarint(a,et,rt)-1,a[et]=18}return a}function sizeLink(o){let s=0;if(o.Hash){const a=o.Hash.length;s+=1+a+sov(a)}if(typeof o.Name=="string"){const a=textEncoder$2.encode(o.Name).length;s+=1+a+sov(a)}return typeof o.Tsize=="number"&&(s+=1+sov(o.Tsize)),s}function sizeNode(o){let s=0;if(o.Data){const a=o.Data.length;s+=1+a+sov(a)}if(o.Links)for(const a of o.Links){const et=sizeLink(a);s+=1+et+sov(et)}return s}function encodeVarint(o,s,a){s-=sov(a);const et=s;for(;a>=maxUInt32;)o[s++]=a&127|128,a/=128;for(;a>=128;)o[s++]=a&127|128,a>>>=7;return o[s]=a,et}function sov(o){return o%2===0&&o++,Math.floor((len64(o)+6)/7)}function len64(o){let s=0;return o>=maxInt32&&(o=Math.floor(o/maxInt32),s=32),o>=65536&&(o>>>=16,s+=16),o>=256&&(o>>>=8,s+=8),s+len8tab[o]}const len8tab=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],pbNodeProperties=["Data","Links"],pbLinkProperties=["Hash","Name","Tsize"],textEncoder$1=new TextEncoder;function linkComparator(o,s){if(o===s)return 0;const a=o.Name?textEncoder$1.encode(o.Name):[],et=s.Name?textEncoder$1.encode(s.Name):[];let tt=a.length,rt=et.length;for(let nt=0,it=Math.min(tt,rt);nt<it;++nt)if(a[nt]!==et[nt]){tt=a[nt],rt=et[nt];break}return tt<rt?-1:rt<tt?1:0}function hasOnlyProperties(o,s){return!Object.keys(o).some(a=>!s.includes(a))}function asLink(o){if(typeof o.asCID=="object"){const a=CID.asCID(o);if(!a)throw new TypeError("Invalid DAG-PB form");return{Hash:a}}if(typeof o!="object"||Array.isArray(o))throw new TypeError("Invalid DAG-PB form");const s={};if(o.Hash){let a=CID.asCID(o.Hash);try{a||(typeof o.Hash=="string"?a=CID.parse(o.Hash):o.Hash instanceof Uint8Array&&(a=CID.decode(o.Hash)))}catch(et){throw new TypeError(`Invalid DAG-PB form: ${et.message}`)}a&&(s.Hash=a)}if(!s.Hash)throw new TypeError("Invalid DAG-PB form");return typeof o.Name=="string"&&(s.Name=o.Name),typeof o.Tsize=="number"&&(s.Tsize=o.Tsize),s}function prepare$1(o){if((o instanceof Uint8Array||typeof o=="string")&&(o={Data:o}),typeof o!="object"||Array.isArray(o))throw new TypeError("Invalid DAG-PB form");const s={};if(o.Data!==void 0)if(typeof o.Data=="string")s.Data=textEncoder$1.encode(o.Data);else if(o.Data instanceof Uint8Array)s.Data=o.Data;else throw new TypeError("Invalid DAG-PB form");if(o.Links!==void 0)if(Array.isArray(o.Links))s.Links=o.Links.map(asLink),s.Links.sort(linkComparator);else throw new TypeError("Invalid DAG-PB form");else s.Links=[];return s}function validate$2(o){if(!o||typeof o!="object"||Array.isArray(o)||o instanceof Uint8Array||o["/"]&&o["/"]===o.bytes)throw new TypeError("Invalid DAG-PB form");if(!hasOnlyProperties(o,pbNodeProperties))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(o.Data!==void 0&&!(o.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(o.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let s=0;s<o.Links.length;s++){const a=o.Links[s];if(!a||typeof a!="object"||Array.isArray(a)||a instanceof Uint8Array||a["/"]&&a["/"]===a.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!hasOnlyProperties(a,pbLinkProperties))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(a.Hash===void 0)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(a.Hash==null||!a.Hash["/"]||a.Hash["/"]!==a.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(a.Name!==void 0&&typeof a.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(a.Tsize!==void 0){if(typeof a.Tsize!="number"||a.Tsize%1!==0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(a.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(s>0&&linkComparator(a,o.Links[s-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function createNode(o,s=[]){return prepare$1({Data:o,Links:s})}function createLink(o,s,a){return asLink({Hash:a,Name:o,Tsize:s})}function toByteView(o){return o instanceof ArrayBuffer?new Uint8Array(o,0,o.byteLength):o}const name$3="dag-pb",code=112;function encode$4(o){validate$2(o);const s={};return o.Links&&(s.Links=o.Links.map(a=>{const et={};return a.Hash&&(et.Hash=a.Hash.bytes),a.Name!==void 0&&(et.Name=a.Name),a.Tsize!==void 0&&(et.Tsize=a.Tsize),et})),o.Data&&(s.Data=o.Data),encodeNode(s)}function decode$3(o){const s=toByteView(o),a=decodeNode(s),et={};return a.Data&&(et.Data=a.Data),a.Links&&(et.Links=a.Links.map(tt=>{const rt={};try{rt.Hash=CID.decode(tt.Hash)}catch{}if(!rt.Hash)throw new Error("Invalid Hash field found in link, expected CID");return tt.Name!==void 0&&(rt.Name=tt.Name),tt.Tsize!==void 0&&(rt.Tsize=tt.Tsize),rt})),et}const dagPB=Object.freeze(Object.defineProperty({__proto__:null,code,createLink,createNode,decode:decode$3,encode:encode$4,name:name$3,prepare:prepare$1,validate:validate$2},Symbol.toStringTag,{value:"Module"})),dagPbWalker={codec:code,*walk(o){yield*decode$3(o).Links.map(a=>a.Hash)}},rawWalker={codec:code$4,*walk(){}},CID_TAG=42,dagCborWalker={codec:code$2,*walk(o){const s=[],a=[];a[CID_TAG]=et=>{if(et[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");const tt=CID.decode(et.subarray(1));return s.push(tt),tt},decode$7(o,{tags:a}),yield*s}};class DagJsonTokenizer extends Tokenizer{tokenBuffer;constructor(s,a){super(s,a),this.tokenBuffer=[]}done(){return this.tokenBuffer.length===0&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){const s=this._next();if(s.type===Type.map){const a=this._next();if(a.type===Type.string&&a.value==="/"){const et=this._next();if(et.type===Type.string){if(this._next().type!==Type.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(et),new Token(Type.tag,42,0)}if(et.type===Type.map){const tt=this._next();if(tt.type===Type.string&&tt.value==="bytes"){const rt=this._next();if(rt.type===Type.string){for(let it=0;it<2;it++)if(this._next().type!==Type.break)throw new Error("Invalid encoded Bytes form");const nt=base64.decode(`m${rt.value}`);return new Token(Type.bytes,nt,rt.value.length)}this.tokenBuffer.push(rt)}this.tokenBuffer.push(tt)}this.tokenBuffer.push(et)}this.tokenBuffer.push(a)}return s}}const dagJsonWalker={codec:code$1,*walk(o){const s=[],a=[];a[CID_TAG]=et=>{const tt=CID.parse(et);return s.push(tt),tt},decode$5(o,{tags:a,tokenizer:new DagJsonTokenizer(o,{tags:a,allowIndefinite:!0,allowUndefined:!0,allowNaN:!0,allowInfinity:!0,allowBigInt:!0,strict:!1,rejectDuplicateMapKeys:!1})}),yield*s}},jsonWalker={codec:code$5,*walk(){}};function defaultDagWalkers(o=[]){const s={};return[dagPbWalker,rawWalker,dagCborWalker,dagJsonWalker,jsonWalker,...o].forEach(a=>{s[a.codec]=a}),s}function alloc$6(o=0){return new Uint8Array(o)}function allocUnsafe$j(o=0){return new Uint8Array(o)}function createCodec$j(o,s,a,et){return{name:o,prefix:s,encoder:{name:o,prefix:s,encode:a},decoder:{decode:et}}}const string$k=createCodec$j("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),ascii$j=createCodec$j("ascii","a",o=>{let s="a";for(let a=0;a<o.length;a++)s+=String.fromCharCode(o[a]);return s},o=>{o=o.substring(1);const s=allocUnsafe$j(o.length);for(let a=0;a<o.length;a++)s[a]=o.charCodeAt(a);return s}),BASES$j={utf8:string$k,"utf-8":string$k,hex:bases.base16,latin1:ascii$j,ascii:ascii$j,binary:ascii$j,...bases};function fromString$l(o,s="utf8"){const a=BASES$j[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.decoder.decode(`${a.prefix}${o}`)}function toString$d(o,s="utf8"){const a=BASES$j[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.encoder.encode(o).substring(1)}const DS_VERSION_KEY=new Key("/version"),CURRENT_VERSION=1;async function assertDatastoreVersionIsCurrent(o){if(!await o.has(DS_VERSION_KEY)){await o.put(DS_VERSION_KEY,fromString$l(`${CURRENT_VERSION}`));return}const s=await o.get(DS_VERSION_KEY),a=toString$d(s);if(parseInt(a,10)!==CURRENT_VERSION)throw new Error("Unknown datastore version, a datastore migration may be required")}function defaultHashers(o=[]){const s={};return[sha256$1,sha512$1,identity$1,...o].forEach(a=>{s[a.code]=a}),s}class BaseBlockstore{has(s,a){return Promise.reject(new Error(".has is not implemented"))}put(s,a,et){return Promise.reject(new Error(".put is not implemented"))}async*putMany(s,a){for await(const{cid:et,block:tt}of s)await this.put(et,tt,a),yield et}get(s,a){return Promise.reject(new Error(".get is not implemented"))}async*getMany(s,a){for await(const et of s)yield{cid:et,block:await this.get(et,a)}}delete(s,a){return Promise.reject(new Error(".delete is not implemented"))}async*deleteMany(s,a){for await(const et of s)await this.delete(et,a),yield et}async*getAll(s){throw new Error(".getAll is not implemented")}}function openFailedError(o){return o=o??new Error("Open failed"),errCode$1(o,"ERR_OPEN_FAILED")}function closeFailedError(o){return o=o??new Error("Close failed"),errCode$1(o,"ERR_CLOSE_FAILED")}function putFailedError(o){return o=o??new Error("Put failed"),errCode$1(o,"ERR_PUT_FAILED")}function getFailedError(o){return o=o??new Error("Get failed"),errCode$1(o,"ERR_GET_FAILED")}function deleteFailedError(o){return o=o??new Error("Delete failed"),errCode$1(o,"ERR_DELETE_FAILED")}function hasFailedError(o){return o=o??new Error("Has failed"),errCode$1(o,"ERR_HAS_FAILED")}function notFoundError$1(o){return o=o??new Error("Not Found"),errCode$1(o,"ERR_NOT_FOUND")}function abortedError(o){return o=o??new Error("Aborted"),errCode$1(o,"ERR_ABORTED")}const ErrorsImport=Object.freeze(Object.defineProperty({__proto__:null,abortedError,closeFailedError,deleteFailedError,getFailedError,hasFailedError,notFoundError:notFoundError$1,openFailedError,putFailedError},Symbol.toStringTag,{value:"Module"}));class MemoryBlockstore extends BaseBlockstore{data;constructor(){super(),this.data=new Map}put(s,a){return this.data.set(base32.encode(s.multihash.bytes),a),s}get(s){const a=this.data.get(base32.encode(s.multihash.bytes));if(a==null)throw notFoundError$1();return a}has(s){return this.data.has(base32.encode(s.multihash.bytes))}async delete(s){this.data.delete(base32.encode(s.multihash.bytes))}async*getAll(){for(const[s,a]of this.data.entries())yield{cid:CID.createV1(code$4,decode$8(base32.decode(s))),block:a}}}function isAsyncIterable$a(o){return o[Symbol.asyncIterator]!=null}function filter(o,s){let a=0;if(isAsyncIterable$a(o))return async function*(){for await(const st of o)await s(st,a++)&&(yield st)}();const et=peekable(o),{value:tt,done:rt}=et.next();if(rt===!0)return function*(){}();const nt=s(tt,a++);if(typeof nt.then=="function")return async function*(){await nt&&(yield tt);for await(const st of et)await s(st,a++)&&(yield st)}();const it=s;return function*(){nt===!0&&(yield tt);for(const st of et)it(st,a++)&&(yield st)}()}logger$1("blockstore:core:tiered");const Errors$1={...ErrorsImport},IDENTITY_CODEC=0;class IdentityBlockstore extends BaseBlockstore{child;constructor(s){super(),this.child=s}put(s,a){return s.multihash.code===IDENTITY_CODEC||this.child==null?s:this.child.put(s,a)}get(s){if(s.multihash.code===IDENTITY_CODEC)return s.multihash.digest;if(this.child==null)throw Errors$1.notFoundError();return this.child.get(s)}has(s){return s.multihash.code===IDENTITY_CODEC?!0:this.child==null?!1:this.child.has(s)}delete(s){if(s.code!==IDENTITY_CODEC&&this.child!=null)return this.child.delete(s)}getAll(s){return this.child!=null?this.child.getAll(s):[]}}function isAsyncIterable$9(o){return o[Symbol.asyncIterator]!=null}function isPromise$5(o){return o?.then!=null}function forEach(o,s){let a=0;if(isAsyncIterable$9(o))return async function*(){for await(const st of o){const ot=s(st,a++);isPromise$5(ot)&&await ot,yield st}}();const et=peekable(o),{value:tt,done:rt}=et.next();if(rt===!0)return function*(){}();if(typeof s(tt,a++)?.then=="function")return async function*(){yield tt;for await(const st of et){const ot=s(st,a++);isPromise$5(ot)&&await ot,yield st}}();const it=s;return function*(){yield tt;for(const st of et)it(st,a++),yield st}()}let Storage$1=class{child;hashers;log;logger;components;constructor(s){this.log=s.logger.forComponent("helia:networked-storage"),this.logger=s.logger,this.components=s,this.child=new IdentityBlockstore(s.blockstore),this.hashers=s.hashers??{}}async put(s,a,et={}){return await this.child.has(s,et)?(et.onProgress?.(new CustomProgressEvent("blocks:put:duplicate",s)),s):(et.onProgress?.(new CustomProgressEvent("blocks:put:providers:notify",s)),await Promise.all(this.components.blockBrokers.map(async tt=>tt.announce?.(s,a,et))),et.onProgress?.(new CustomProgressEvent("blocks:put:blockstore:put",s)),this.child.put(s,a,et))}async*putMany(s,a={}){const et=filter(s,async({cid:rt})=>{const nt=await this.child.has(rt,a);return nt&&a.onProgress?.(new CustomProgressEvent("blocks:put-many:duplicate",rt)),!nt}),tt=forEach(et,async({cid:rt,block:nt})=>{a.onProgress?.(new CustomProgressEvent("blocks:put-many:providers:notify",rt)),await Promise.all(this.components.blockBrokers.map(async it=>it.announce?.(rt,nt,a)))});a.onProgress?.(new CustomProgressEvent("blocks:put-many:blockstore:put-many")),yield*this.child.putMany(tt,a)}async get(s,a={}){if(a.offline!==!0&&!await this.child.has(s,a)){a.onProgress?.(new CustomProgressEvent("blocks:get:providers:get",s));const et=await raceBlockRetrievers(s,this.components.blockBrokers,this.hashers[s.multihash.code],{...a,log:this.log});return a.onProgress?.(new CustomProgressEvent("blocks:get:blockstore:put",s)),await this.child.put(s,et,a),a.onProgress?.(new CustomProgressEvent("blocks:get:providers:notify",s)),await Promise.all(this.components.blockBrokers.map(async tt=>tt.announce?.(s,et,a))),et}return a.onProgress?.(new CustomProgressEvent("blocks:get:blockstore:get",s)),this.child.get(s,a)}async*getMany(s,a={}){a.onProgress?.(new CustomProgressEvent("blocks:get-many:blockstore:get-many")),yield*this.child.getMany(forEach(s,async et=>{if(a.offline!==!0&&!await this.child.has(et,a)){a.onProgress?.(new CustomProgressEvent("blocks:get-many:providers:get",et));const tt=await raceBlockRetrievers(et,this.components.blockBrokers,this.hashers[et.multihash.code],{...a,log:this.log});a.onProgress?.(new CustomProgressEvent("blocks:get-many:blockstore:put",et)),await this.child.put(et,tt,a),a.onProgress?.(new CustomProgressEvent("blocks:get-many:providers:notify",et)),await Promise.all(this.components.blockBrokers.map(async rt=>rt.announce?.(et,tt,a)))}}))}async delete(s,a={}){a.onProgress?.(new CustomProgressEvent("blocks:delete:blockstore:delete",s)),await this.child.delete(s,a)}async*deleteMany(s,a={}){a.onProgress?.(new CustomProgressEvent("blocks:delete-many:blockstore:delete-many")),yield*this.child.deleteMany(async function*(){for await(const et of s)yield et}(),a)}async has(s,a={}){return this.child.has(s,a)}async*getAll(s={}){s.onProgress?.(new CustomProgressEvent("blocks:get-all:blockstore:get-many")),yield*this.child.getAll(s)}};class NetworkedStorage extends Storage$1{started;constructor(s){super(s),this.started=!1}isStarted(){return this.started}async start(){await start(this.child,...this.components.blockBrokers),this.started=!0}async stop(){await stop(this.child,...this.components.blockBrokers),this.started=!1}unwrap(){return this.child}createSession(s,a){const et=this.components.blockBrokers.map(tt=>tt.createSession==null?tt:tt.createSession(a));return new SessionStorage({blockstore:this.child,blockBrokers:et,hashers:this.hashers,logger:this.logger},{root:s})}}class SessionStorage extends Storage$1{closeController;constructor(s,a){super(s),this.closeController=new AbortController,setMaxListeners(1/0,this.closeController.signal),this.log=s.logger.forComponent(`helia:session-storage:${a.root}`)}close(){this.closeController.abort()}async put(s,a,et={}){const tt=anySignal([this.closeController.signal,et.signal]);setMaxListeners(1/0,tt);try{return await super.put(s,a,{...et,signal:tt})}finally{tt.clear()}}async*putMany(s,a={}){const et=anySignal([this.closeController.signal,a.signal]);setMaxListeners(1/0,et);try{yield*super.putMany(s,{...a,signal:et})}finally{et.clear()}}async get(s,a={}){const et=anySignal([this.closeController.signal,a.signal]);setMaxListeners(1/0,et);try{return await super.get(s,{...a,signal:et})}finally{et.clear()}}async*getMany(s,a={}){const et=anySignal([this.closeController.signal,a.signal]);setMaxListeners(1/0,et);try{yield*super.getMany(s,{...a,signal:et})}finally{et.clear()}}async delete(s,a={}){const et=anySignal([this.closeController.signal,a.signal]);setMaxListeners(1/0,et);try{await super.delete(s,{...a,signal:et})}finally{et.clear()}}async*deleteMany(s,a={}){const et=anySignal([this.closeController.signal,a.signal]);setMaxListeners(1/0,et);try{yield*super.deleteMany(s,{...a,signal:et})}finally{et.clear()}}async has(s,a={}){const et=anySignal([this.closeController.signal,a.signal]);setMaxListeners(1/0,et);try{return await super.has(s,{...a,signal:et})}finally{et.clear()}}async*getAll(s={}){const a=anySignal([this.closeController.signal,s.signal]);setMaxListeners(1/0,a);try{yield*super.getAll({...s,signal:a})}finally{a.clear()}}}function isRetrievingBlockBroker(o){return typeof o.retrieve=="function"}const getCidBlockVerifierFunction=(o,s)=>{if(s==null)throw new CodeError$3(`No hasher configured for multihash code 0x${o.multihash.code.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`,"ERR_UNKNOWN_HASH_ALG");return async a=>{const et=await s.digest(a);if(!equals$c(et.digest,o.multihash.digest))throw new CodeError$3("Hash of downloaded block did not match multihash from passed CID","ERR_HASH_MISMATCH")}};async function raceBlockRetrievers(o,s,a,et){const tt=getCidBlockVerifierFunction(o,a),rt=new AbortController,nt=anySignal([rt.signal,et.signal]);setMaxListeners(1/0,rt.signal,nt);const it=[];for(const st of s)isRetrievingBlockBroker(st)&&it.push(st);try{return await Promise.any(it.map(async st=>{try{let ot=!1;const at=await st.retrieve(o,{...et,signal:nt,validateFn:async lt=>{await tt(lt),ot=!0}});return ot||await tt(at),at}catch(ot){throw et.log.error("could not retrieve verified block for %c",o,ot),ot}}))}finally{rt.abort(),nt.clear()}}const DEFAULT_SESSION_MIN_PROVIDERS=1,DEFAULT_SESSION_MAX_PROVIDERS=5,LN2_SQUARED=Math.LN2*Math.LN2;class BloomFilter{static create(s,a=.005){const et=optimize(s,a);return new BloomFilter(et)}seeds;bits;buffer;constructor(s={}){s.seeds!=null?this.seeds=s.seeds:this.seeds=generateSeeds(s.hashes??8),this.bits=s.bits??1024,this.buffer=alloc$6(Math.ceil(this.bits/8))}add(s){typeof s=="string"&&(s=fromString$l(s));for(let a=0;a<this.seeds.length;a++){const tt=mur.x86.hash32(s,this.seeds[a])%this.bits;this.setbit(tt)}}has(s){typeof s=="string"&&(s=fromString$l(s));for(let a=0;a<this.seeds.length;a++){const tt=mur.x86.hash32(s,this.seeds[a])%this.bits;if(!this.getbit(tt))return!1}return!0}clear(){this.buffer.fill(0)}setbit(s){let a=0,et=s;for(;et>7;)a++,et-=8;let tt=this.buffer[a];tt|=1<<et,this.buffer[a]=tt}getbit(s){let a=0,et=s;for(;et>7;)a++,et-=8;return(this.buffer[a]&1<<et)!==0}}function optimize(o,s=.005){const a=Math.round(-1*o*Math.log(s)/LN2_SQUARED),et=Math.round(a/o*Math.LN2);return{bits:a,hashes:et}}function generateSeeds(o){let s,a;const et=[];for(let tt=0;tt<o;tt++)for(s=new Uint8ArrayList(randomBytes(4)),et[tt]=s.getUint32(0,!0),a=0;a<tt;a++)if(et[tt]===et[a]){tt--;break}return et}class AbstractSession extends TypedEventEmitter{intialPeerSearchComplete;requests;name;log;logger;minProviders;maxProviders;providers;evictionFilter;constructor(s,a){super(),setMaxListeners(1/0,this),this.name=a.name,this.logger=s.logger,this.log=s.logger.forComponent(this.name),this.requests=new Map,this.minProviders=a.minProviders??DEFAULT_SESSION_MIN_PROVIDERS,this.maxProviders=a.maxProviders??DEFAULT_SESSION_MAX_PROVIDERS,this.providers=[],this.evictionFilter=BloomFilter.create(this.maxProviders)}async retrieve(s,a={}){const et=base64.encode(s.multihash.bytes),tt=this.requests.get(et);if(tt!=null)return this.log("join existing request for %c",s),tt;const rt=pDefer();if(this.requests.set(et,rt.promise),this.providers.length===0){let ot=!1;this.intialPeerSearchComplete==null&&(ot=!0,this.log=this.logger.forComponent(`${this.name}:${s}`),this.intialPeerSearchComplete=this.findProviders(s,this.minProviders,a)),await this.intialPeerSearchComplete,ot&&this.log("found initial session peers for %c",s)}let nt=!1;const it=new Queue({concurrency:this.maxProviders});it.addEventListener("error",()=>{}),it.addEventListener("failure",ot=>{this.log.error("error querying provider %o, evicting from session",ot.detail.job.options.provider,ot.detail.error),this.evict(ot.detail.job.options.provider)}),it.addEventListener("success",ot=>{nt=!0,rt.resolve(ot.detail.result)}),it.addEventListener("idle",()=>{nt||a.signal?.aborted===!0||Promise.resolve().then(async()=>{this.log("no session peers had block for for %c, finding new providers",s);for(let ot=0;ot<this.minProviders&&this.providers.length!==0;ot++){const at=this.providers[Math.floor(Math.random()*this.providers.length)];this.evict(at)}await this.findProviders(s,this.minProviders,a),this.log("found new providers re-retrieving %c",s),this.requests.delete(et),rt.resolve(await this.retrieve(s,a))}).catch(ot=>{this.log.error("could not find new providers for %c",s,ot),rt.reject(ot)})});const st=ot=>{it.add(async()=>this.queryProvider(s,ot.detail,a),{provider:ot.detail}).catch(at=>{a.signal?.aborted!==!0&&this.log.error("error retrieving session block for %c",s,at)})};this.addEventListener("provider",st),Promise.all([...this.providers].map(async ot=>it.add(async()=>this.queryProvider(s,ot,a),{provider:ot}))).catch(ot=>{a.signal?.aborted!==!0&&this.log.error("error retrieving session block for %c",s,ot)});try{return await rt.promise}finally{this.removeEventListener("provider",st),it.clear(),this.requests.delete(et)}}evict(s){this.evictionFilter.add(this.toEvictionKey(s));const a=this.providers.findIndex(et=>this.equals(et,s));a!==-1&&this.providers.splice(a,1)}isEvicted(s){return this.evictionFilter.has(this.toEvictionKey(s))}hasProvider(s){return!!(this.providers.find(a=>this.equals(a,s))!=null||this.isEvicted(s))}async findProviders(s,a,et){const tt=pDefer();let rt=0;return Promise.resolve().then(async()=>{this.log("finding %d-%d new provider(s) for %c",a,this.maxProviders,s);for await(const nt of this.findNewProviders(s,et)){if(rt===this.maxProviders||et.signal?.aborted===!0)break;if(!this.hasProvider(nt)&&(this.log("found %d/%d new providers",rt,this.maxProviders),this.providers.push(nt),this.safeDispatchEvent("provider",{detail:nt}),rt++,rt===a&&(this.log("session is ready"),tt.resolve()),this.providers.length===this.maxProviders)){this.log("found max session peers",rt);break}}if(this.log("found %d/%d new session peers",rt,this.maxProviders),rt<a)throw new CodeError$3(`Found ${rt} of ${a} ${this.name} providers for ${s}`,"ERR_INSUFFICIENT_PROVIDERS_FOUND")}).catch(nt=>{this.log.error("error searching routing for potential session peers for %c",s,nt.errors??nt),tt.reject(nt)}),tt.promise}}let Helia$1=class{blockstore;datastore;pins;logger;routing;dagWalkers;hashers;dns;metrics;log;constructor(s){this.logger=s.logger??defaultLogger(),this.log=this.logger.forComponent("helia"),this.hashers=defaultHashers(s.hashers),this.dagWalkers=defaultDagWalkers(s.dagWalkers),this.dns=s.dns??dns(),this.metrics=s.metrics;const a={blockstore:s.blockstore,datastore:s.datastore,hashers:this.hashers,dagWalkers:this.dagWalkers,logger:this.logger,blockBrokers:[],dns:this.dns,metrics:this.metrics,...s.components??{}};this.routing=a.routing=new Routing(a,{routers:(s.routers??[]).flatMap(tt=>{const rt=[tt];return tt[contentRoutingSymbol]!=null&&rt.push(tt[contentRoutingSymbol]),tt[peerRoutingSymbol]!=null&&rt.push(tt[peerRoutingSymbol]),rt}),providerLookupConcurrency:s.providerLookupConcurrency});const et=new NetworkedStorage(a);this.pins=new PinsImpl(s.datastore,et,this.dagWalkers),this.blockstore=new BlockStorage(et,this.pins,{holdGcLock:s.holdGcLock??!0}),this.datastore=s.datastore,a.blockBrokers=s.blockBrokers.map(tt=>tt(a))}async start(){await assertDatastoreVersionIsCurrent(this.datastore),await start(this.blockstore,this.datastore,this.routing)}async stop(){await stop(this.blockstore,this.datastore,this.routing)}async gc(s={}){const a=await this.blockstore.lock.writeLock();try{const et=this,tt=this.blockstore.unwrap();this.log("gc start"),await drain(tt.deleteMany(async function*(){for await(const{cid:rt}of tt.getAll())try{if(await et.pins.isPinned(rt,s))continue;yield rt,s.onProgress?.(new CustomProgressEvent("helia:gc:deleted",rt))}catch(nt){et.log.error("Error during gc",nt),s.onProgress?.(new CustomProgressEvent("helia:gc:error",nt))}}()))}finally{a()}this.log("gc finished")}};class BitswapSession extends AbstractSession{wantList;network;constructor(s,a){super(s,{...a,name:"helia:bitswap:session"}),this.wantList=s.wantList,this.network=s.network}async queryProvider(s,a,et){this.log("sending WANT-BLOCK for %c to %p",s,a);const tt=await this.wantList.wantSessionBlock(s,a,et);if(this.log("%p %s %c",a,tt.has?"has":"does not have",s),tt.has&&tt.block!=null)return tt.block;throw new Error("Provider did not have block")}async*findNewProviders(s,a={}){for await(const et of this.network.findProviders(s,a))yield et.id}toEvictionKey(s){return s.toBytes()}equals(s,a){return s.equals(a)}}function createBitswapSession(o,s){return new BitswapSession(o,s)}let Stats$2=class{blocksReceived;duplicateBlocksReceived;dataReceived;duplicateDataReceived;constructor(s){this.blocksReceived=s.metrics?.registerMetricGroup("helia_bitswap_received_blocks"),this.duplicateBlocksReceived=s.metrics?.registerMetricGroup("helia_bitswap_duplicate_received_blocks"),this.dataReceived=s.metrics?.registerMetricGroup("helia_bitswap_data_received_bytes"),this.duplicateDataReceived=s.metrics?.registerMetricGroup("helia_bitswap_duplicate_data_received_bytes")}updateBlocksReceived(s=1,a){const et={global:s};a!=null&&(et[a.toString()]=s),this.blocksReceived?.increment(et)}updateDuplicateBlocksReceived(s=1,a){const et={global:s};a!=null&&(et[a.toString()]=s),this.duplicateBlocksReceived?.increment(et)}updateDataReceived(s,a){const et={global:s};a!=null&&(et[a.toString()]=s),this.dataReceived?.increment(et)}updateDuplicateDataReceived(s,a){const et={global:s};a!=null&&(et[a.toString()]=s),this.duplicateDataReceived?.increment(et)}};class TrackedMap extends Map{metric;constructor(s){super();const{name:a,metrics:et}=s;this.metric=et.registerMetric(a),this.updateComponentMetric()}set(s,a){return super.set(s,a),this.updateComponentMetric(),this}delete(s){const a=super.delete(s);return this.updateComponentMetric(),a}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function trackedMap(o){const{name:s,metrics:a}=o;let et;return a!=null?et=new TrackedMap({name:s,metrics:a}):et=new Map,et}function equals$b(o,s){if(o===s)return!0;if(o.byteLength!==s.byteLength)return!1;for(let a=0;a<o.byteLength;a++)if(o[a]!==s[a])return!1;return!0}function varintDecoder(o){if(!(o instanceof Uint8Array))throw new Error("arg needs to be a Uint8Array");const s=[];for(;o.length>0;){const a=decode$g(o);s.push(a),o=o.slice(encodingLength$1(a))}return s}class WantList extends TypedEventEmitter{peers;wants;network;log;sendMessagesDelay;sendMessagesTimeout;hashLoader;sendingMessages;constructor(s,a={}){super(),setMaxListeners(1/0,this),this.peers=trackedPeerMap({name:"helia_bitswap_peers",metrics:s.metrics}),this.wants=trackedMap({name:"helia_bitswap_wantlist",metrics:s.metrics}),this.network=s.network,this.sendMessagesDelay=a.sendMessagesDelay??DEFAULT_MESSAGE_SEND_DELAY,this.log=s.logger.forComponent("helia:bitswap:wantlist"),this.hashLoader=a.hashLoader,this.network.addEventListener("bitswap:message",et=>{this.receiveMessage(et.detail.peer,et.detail.message).catch(tt=>{this.log.error("error receiving bitswap message from %p",et.detail.peer,tt)})}),this.network.addEventListener("peer:connected",et=>{this.peerConnected(et.detail).catch(tt=>{this.log.error("error processing newly connected bitswap peer %p",et.detail,tt)})}),this.network.addEventListener("peer:disconnected",et=>{this.peerDisconnected(et.detail)})}async addEntry(s,a){const et=toString$h(s.multihash.bytes,"base64");let tt=this.wants.get(et);tt==null&&(tt={cid:s,priority:a.priority??1,wantType:a.wantType??WantType.WantBlock,cancel:!1,sendDontHave:!0},this.wants.set(et,tt)),tt.wantType===WantType.WantHave&&a.wantType===WantType.WantBlock&&(tt.wantType=WantType.WantBlock),await this.sendMessagesDebounced();try{return a.wantType===WantType.WantBlock?(await raceEvent(this,"block",a?.signal,{filter:it=>equals$b(s.multihash.digest,it.detail.cid.multihash.digest),errorMessage:"Want was aborted"})).detail:(await raceEvent(this,"presence",a?.signal,{filter:nt=>equals$b(s.multihash.digest,nt.detail.cid.multihash.digest),errorMessage:"Want was aborted"})).detail}finally{a.signal?.aborted===!0&&(this.log("want for %c was aborted, cancelling want",s),tt.cancel=!0,await this.sendMessagesDebounced())}}async sendMessagesDebounced(){await this.sendingMessages?.promise,clearTimeout(this.sendMessagesTimeout),this.sendMessagesTimeout=setTimeout(()=>{this.sendMessages().catch(s=>{this.log("error sending messages to peers",s)})},this.sendMessagesDelay)}async sendMessages(){this.sendingMessages=pDefer(),await Promise.all([...this.peers.entries()].map(async([s,a])=>{const et=new Set,tt=new QueuedBitswapMessage;for(const[rt,nt]of this.wants.entries())a.has(rt)||nt.cancel||(et.add(rt),tt.addWantlistEntry(nt.cid,{cid:nt.cid.bytes,priority:nt.priority,wantType:nt.wantType,cancel:nt.cancel,sendDontHave:nt.sendDontHave}));if(tt.wantlist.size!==0)try{await this.network.sendMessage(s,tt);for(const rt of et)a.add(rt)}catch(rt){this.log.error("error sending full wantlist to new peer",rt)}})).catch(s=>{this.log.error("error sending messages",s)});for(const[s,a]of this.wants)if(a.cancel){this.wants.delete(s);for(const et of this.peers.values())et.delete(s)}this.sendingMessages.resolve()}has(s){const a=toString$h(s.multihash.bytes,"base64");return this.wants.has(a)}async wantSessionPresence(s,a,et={}){const tt=new QueuedBitswapMessage;return tt.addWantlistEntry(s,{cid:s.bytes,sendDontHave:!0,wantType:WantType.WantHave,priority:1}),await this.network.sendMessage(a,tt),(await raceEvent(this,"presence",et.signal,{filter:nt=>a.equals(nt.detail.sender)&&equals$b(s.multihash.digest,nt.detail.cid.multihash.digest)})).detail}async wantBlock(s,a={}){return this.addEntry(s,{...a,wantType:WantType.WantBlock})}async wantSessionBlock(s,a,et={}){const tt=new QueuedBitswapMessage;return tt.addWantlistEntry(s,{cid:s.bytes,sendDontHave:!0,wantType:WantType.WantBlock,priority:1}),await this.network.sendMessage(a,tt),(await raceEvent(this,"presence",et.signal,{filter:nt=>a.equals(nt.detail.sender)&&equals$b(s.multihash.digest,nt.detail.cid.multihash.digest)})).detail}async receivedBlock(s,a){const et=toString$h(s.multihash.bytes,"base64"),tt=this.wants.get(et);tt!=null&&(tt.cancel=!0,await this.sendMessagesDebounced())}async receiveMessage(s,a){this.log("received message from %p with %d blocks",s,a.blocks.length);let et=!1;for(const tt of a.blocks){if(tt.prefix==null||tt.data==null)continue;const rt=varintDecoder(tt.prefix),nt=rt[0],it=rt[1],st=rt[2],ot=st===sha256$1.code?sha256$1:await this.hashLoader?.getHasher(st);if(ot==null){this.log.error("unknown hash algorithm",st);continue}let at=ot.digest(tt.data);at.then!=null&&(at=await at);const lt=CID.create(nt===0?0:1,it,at);this.log("received block from %p for %c",s,lt),this.safeDispatchEvent("block",{detail:{sender:s,cid:lt,block:tt.data}}),this.safeDispatchEvent("presence",{detail:{sender:s,cid:lt,has:!0,block:tt.data}});const ct=toString$h(lt.multihash.bytes,"base64"),ht=this.wants.get(ct);ht!=null&&(ht.cancel=!0,et=!0)}for(const{cid:tt,type:rt}of a.blockPresences){const nt=CID.decode(tt);this.log("received %s from %p for %c",rt,s,nt),this.safeDispatchEvent("presence",{detail:{sender:s,cid:nt,has:rt===BlockPresenceType.HaveBlock}})}et&&await this.sendMessagesDebounced()}async peerConnected(s){const a=new Set,et=new QueuedBitswapMessage(!0);for(const[tt,rt]of this.wants.entries())rt.cancel||(a.add(tt),et.addWantlistEntry(rt.cid,{cid:rt.cid.bytes,priority:1,wantType:WantType.WantBlock,cancel:!1,sendDontHave:!1}));if(et.wantlist.size===0){this.peers.set(s,a);return}try{await this.network.sendMessage(s,et),this.peers.set(s,a)}catch(tt){this.log.error("error sending full wantlist to new peer %p",s,tt)}}peerDisconnected(s){this.peers.delete(s)}start(){}stop(){this.peers.clear(),clearTimeout(this.sendMessagesTimeout)}}class Bitswap{log;logger;stats;network;blockstore;peerWantLists;wantList;constructor(s,a={}){this.logger=s.logger,this.log=s.logger.forComponent("helia:bitswap"),this.blockstore=s.blockstore,this.stats=new Stats$2(s),this.network=new Network$1(s,a),this.peerWantLists=new PeerWantLists({...s,network:this.network},a),this.wantList=new WantList({...s,network:this.network},a)}createSession(s={}){return createBitswapSession({wantList:this.wantList,network:this.network,logger:this.logger},s)}async want(s,a={}){const et=new AbortController,tt=anySignal([et.signal,a.signal]);setMaxListeners(1/0,et.signal,tt),this.network.findAndConnect(s,{...a,signal:tt}).catch(rt=>{et.signal.aborted||this.log.error("error during finding and connect for cid %c",s,rt)});try{return(await this.wantList.wantBlock(s,{...a,signal:tt})).block}finally{et.abort(),tt.clear()}}async notify(s,a,et={}){await Promise.all([this.peerWantLists.receivedBlock(s,et),this.wantList.receivedBlock(s,et)])}getWantlist(){return[...this.wantList.wants.values()].filter(s=>!s.cancel).map(s=>({cid:s.cid,priority:s.priority,wantType:s.wantType}))}getPeerWantlist(s){return this.peerWantLists.wantListForPeer(s)}async start(){this.wantList.start(),await this.network.start()}async stop(){this.wantList.stop(),await this.network.stop()}}const createBitswap=(o,s={})=>new Bitswap(o,s);class BitswapBlockBroker{bitswap;started;constructor(s,a={}){const{hashers:et}=s;this.bitswap=createBitswap(s,{hashLoader:{getHasher:async tt=>{let rt;if(typeof tt=="string"?rt=Object.values(et).find(nt=>nt.name===tt):rt=et[tt],rt!=null)return rt;throw new Error(`Could not load hasher for code/name "${tt}"`)}},...a}),this.started=!1}isStarted(){return this.started}async start(){await this.bitswap.start(),this.started=!0}async stop(){await this.bitswap.stop(),this.started=!1}async announce(s,a,et){await this.bitswap.notify(s,a,et)}async retrieve(s,a={}){return this.bitswap.want(s,a)}createSession(s){const a=this.bitswap.createSession(s);return{announce:async(et,tt,rt)=>{await this.bitswap.notify(et,tt,rt)},retrieve:async(et,tt)=>a.retrieve(et,tt)}}}function bitswap(o={}){return s=>new BitswapBlockBroker(s,o)}class Parser{index=0;input="";new(s){return this.index=0,this.input=s,this}readAtomically(s){const a=this.index,et=s();return et===void 0&&(this.index=a),et}parseWith(s){const a=s();if(this.index===this.input.length)return a}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(s){return this.readAtomically(()=>{const a=this.readChar();if(a===s)return a})}readSeparator(s,a,et){return this.readAtomically(()=>{if(!(a>0&&this.readGivenChar(s)===void 0))return et()})}readNumber(s,a,et,tt){return this.readAtomically(()=>{let rt=0,nt=0;const it=this.peekChar();if(it===void 0)return;const st=it==="0",ot=2**(8*tt)-1;for(;;){const at=this.readAtomically(()=>{const lt=this.readChar();if(lt===void 0)return;const ct=Number.parseInt(lt,s);if(!Number.isNaN(ct))return ct});if(at===void 0)break;if(rt*=s,rt+=at,rt>ot||(nt+=1,a!==void 0&&nt>a))return}if(nt!==0)return!et&&st&&nt>1?void 0:rt})}readIPv4Addr(){return this.readAtomically(()=>{const s=new Uint8Array(4);for(let a=0;a<s.length;a++){const et=this.readSeparator(".",a,()=>this.readNumber(10,3,!1,1));if(et===void 0)return;s[a]=et}return s})}readIPv6Addr(){const s=a=>{for(let et=0;et<a.length/2;et++){const tt=et*2;if(et<a.length-3){const nt=this.readSeparator(":",et,()=>this.readIPv4Addr());if(nt!==void 0)return a[tt]=nt[0],a[tt+1]=nt[1],a[tt+2]=nt[2],a[tt+3]=nt[3],[tt+4,!0]}const rt=this.readSeparator(":",et,()=>this.readNumber(16,4,!0,2));if(rt===void 0)return[tt,!1];a[tt]=rt>>8,a[tt+1]=rt&255}return[a.length,!1]};return this.readAtomically(()=>{const a=new Uint8Array(16),[et,tt]=s(a);if(et===16)return a;if(tt||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;const rt=new Uint8Array(14),nt=16-(et+2),[it]=s(rt.subarray(0,nt));return a.set(rt.subarray(0,it),16-it),a})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}}const MAX_IPV6_LENGTH=45,MAX_IPV4_LENGTH=15,parser=new Parser;function parseIPv4(o){if(!(o.length>MAX_IPV4_LENGTH))return parser.new(o).parseWith(()=>parser.readIPv4Addr())}function parseIPv6(o){if(o.includes("%")&&(o=o.split("%")[0]),!(o.length>MAX_IPV6_LENGTH))return parser.new(o).parseWith(()=>parser.readIPv6Addr())}function parseIP(o){if(o.includes("%")&&(o=o.split("%")[0]),!(o.length>MAX_IPV6_LENGTH))return parser.new(o).parseWith(()=>parser.readIPAddr())}function isIPv4$1(o){return!!parseIPv4(o)}function isIPv6$1(o){return!!parseIPv6(o)}function isIP(o){return!!parseIP(o)}var Netmask_1;(function(){var o,s,a,et,tt,rt,nt,it;it=function(st){var ot,at,lt,ct;return ot=(st&255<<24)>>>24,at=(st&255<<16)>>>16,lt=(st&65280)>>>8,ct=st&255,[ot,at,lt,ct].join(".")},nt=function(st){var ot,at,lt,ct,ht,ft;for(ot=[],lt=ct=0;ct<=3&&st.length!==0;lt=++ct){if(lt>0){if(st[0]!==".")throw new Error("Invalid IP");st=st.substring(1)}ft=s(st),ht=ft[0],at=ft[1],st=st.substring(at),ot.push(ht)}if(st.length!==0)throw new Error("Invalid IP");switch(ot.length){case 1:if(ot[0]>4294967295)throw new Error("Invalid IP");return ot[0]>>>0;case 2:if(ot[0]>255||ot[1]>16777215)throw new Error("Invalid IP");return(ot[0]<<24|ot[1])>>>0;case 3:if(ot[0]>255||ot[1]>255||ot[2]>65535)throw new Error("Invalid IP");return(ot[0]<<24|ot[1]<<16|ot[2])>>>0;case 4:if(ot[0]>255||ot[1]>255||ot[2]>255||ot[3]>255)throw new Error("Invalid IP");return(ot[0]<<24|ot[1]<<16|ot[2]<<8|ot[3])>>>0;default:throw new Error("Invalid IP")}},a=function(st){return st.charCodeAt(0)},et=a("0"),rt=a("a"),tt=a("A"),s=function(st){var ot,at,lt,ct,ht;for(ct=0,ot=10,at="9",lt=0,st.length>1&&st[lt]==="0"&&(st[lt+1]==="x"||st[lt+1]==="X"?(lt+=2,ot=16):"0"<=st[lt+1]&&st[lt+1]<="9"&&(lt++,ot=8,at="7")),ht=lt;lt<st.length;){if("0"<=st[lt]&&st[lt]<=at)ct=ct*ot+(a(st[lt])-et)>>>0;else if(ot===16)if("a"<=st[lt]&&st[lt]<="f")ct=ct*ot+(10+a(st[lt])-rt)>>>0;else if("A"<=st[lt]&&st[lt]<="F")ct=ct*ot+(10+a(st[lt])-tt)>>>0;else break;else break;if(ct>4294967295)throw new Error("too large");lt++}if(lt===ht)throw new Error("empty octet");return[ct,lt]},o=function(){function st(ot,at){var lt,ct,ht;if(typeof ot!="string")throw new Error("Missing `net' parameter");if(at||(ht=ot.split("/",2),ot=ht[0],at=ht[1]),at||(at=32),typeof at=="string"&&at.indexOf(".")>-1){try{this.maskLong=nt(at)}catch{throw new Error("Invalid mask: "+at)}for(lt=ct=32;ct>=0;lt=--ct)if(this.maskLong===4294967295<<32-lt>>>0){this.bitmask=lt;break}}else if(at||at===0)this.bitmask=parseInt(at,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(nt(ot)&this.maskLong)>>>0}catch{throw new Error("Invalid net address: "+ot)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+at);this.size=Math.pow(2,32-this.bitmask),this.base=it(this.netLong),this.mask=it(this.maskLong),this.hostmask=it(~this.maskLong),this.first=this.bitmask<=30?it(this.netLong+1):this.base,this.last=this.bitmask<=30?it(this.netLong+this.size-2):it(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?it(this.netLong+this.size-1):void 0}return st.prototype.contains=function(ot){return typeof ot=="string"&&(ot.indexOf("/")>0||ot.split(".").length!==4)&&(ot=new st(ot)),ot instanceof st?this.contains(ot.base)&&this.contains(ot.broadcast||ot.last):(nt(ot)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},st.prototype.next=function(ot){return ot==null&&(ot=1),new st(it(this.netLong+this.size*ot),this.mask)},st.prototype.forEach=function(ot){var at,lt,ct;for(ct=nt(this.first),lt=nt(this.last),at=0;ct<=lt;)ot(it(ct),ct,at),at++,ct++},st.prototype.toString=function(){return this.base+"/"+this.bitmask},st}(),Netmask_1=o}).call(commonjsGlobal);const PRIVATE_IP_RANGES=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],NETMASK_RANGES=PRIVATE_IP_RANGES.map(o=>new Netmask_1(o));function ipv4Check(o){for(const s of NETMASK_RANGES)if(s.contains(o))return!0;return!1}function ipv6Check(o){return/^::$/.test(o)||/^::1$/.test(o)||/^::f{4}:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(o)||/^::f{4}:0.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(o)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(o)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(o)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(o)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(o)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(o)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(o)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(o)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(o)||/^ff([0-9a-fA-F]{2,2}):/i.test(o)}function isPrivateIp(o){return isIPv4$1(o)?ipv4Check(o):isIPv6$1(o)?ipv6Check(o):void 0}function equals$a(o,s){if(o===s)return!0;if(o.byteLength!==s.byteLength)return!1;for(let a=0;a<o.byteLength;a++)if(o[a]!==s[a])return!1;return!0}function allocUnsafe$i(o=0){return new Uint8Array(o)}function createCodec$i(o,s,a,et){return{name:o,prefix:s,encoder:{name:o,prefix:s,encode:a},decoder:{decode:et}}}const string$j=createCodec$i("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),ascii$i=createCodec$i("ascii","a",o=>{let s="a";for(let a=0;a<o.length;a++)s+=String.fromCharCode(o[a]);return s},o=>{o=o.substring(1);const s=allocUnsafe$i(o.length);for(let a=0;a<o.length;a++)s[a]=o.charCodeAt(a);return s}),BASES$i={utf8:string$j,"utf-8":string$j,hex:bases.base16,latin1:ascii$i,ascii:ascii$i,binary:ascii$i,...bases};function toString$c(o,s="utf8"){const a=BASES$i[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.encoder.encode(o).substring(1)}function asUint8Array$9(o){return o}function concat$9(o,s){s==null&&(s=o.reduce((tt,rt)=>tt+rt.length,0));const a=allocUnsafe$i(s);let et=0;for(const tt of o)a.set(tt,et),et+=tt.length;return a}function fromString$k(o,s="utf8"){const a=BASES$i[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.decoder.decode(`${a.prefix}${o}`)}const isV4=isIPv4$1,isV6=isIPv6$1,toBytes$1=function(o){let s=0;if(o=o.toString().trim(),isV4(o)){const a=new Uint8Array(s+4);return o.split(/\./g).forEach(et=>{a[s++]=parseInt(et,10)&255}),a}if(isV6(o)){const a=o.split(":",8);let et;for(et=0;et<a.length;et++){const rt=isV4(a[et]);let nt;rt&&(nt=toBytes$1(a[et]),a[et]=toString$c(nt.slice(0,2),"base16")),nt!=null&&++et<8&&a.splice(et,0,toString$c(nt.slice(2,4),"base16"))}if(a[0]==="")for(;a.length<8;)a.unshift("0");else if(a[a.length-1]==="")for(;a.length<8;)a.push("0");else if(a.length<8){for(et=0;et<a.length&&a[et]!=="";et++);const rt=[et,1];for(et=9-a.length;et>0;et--)rt.push("0");a.splice.apply(a,rt)}const tt=new Uint8Array(s+16);for(et=0;et<a.length;et++){const rt=parseInt(a[et],16);tt[s++]=rt>>8&255,tt[s++]=rt&255}return tt}throw new Error("invalid ip address")},toString$b=function(o,s=0,a){s=~~s,a=a??o.length-s;const et=new DataView(o.buffer);if(a===4){const tt=[];for(let rt=0;rt<a;rt++)tt.push(o[s+rt]);return tt.join(".")}if(a===16){const tt=[];for(let rt=0;rt<a;rt+=2)tt.push(et.getUint16(s+rt).toString(16));return tt.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},V$1=-1,names$3={},codes$7={},table=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,V$1,"ip6zone"],[43,8,"ipcidr"],[53,V$1,"dns",!0],[54,V$1,"dns4",!0],[55,V$1,"dns6",!0],[56,V$1,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,V$1,"unix",!1,!0],[421,V$1,"ipfs"],[421,V$1,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,V$1,"garlic64"],[448,0,"tls"],[449,V$1,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,V$1,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[481,V$1,"http-path"],[777,V$1,"memory"]];table.forEach(o=>{const s=createProtocol(...o);codes$7[s.code]=s,names$3[s.name]=s});function createProtocol(o,s,a,et,tt){return{code:o,size:s,name:a,resolvable:!!et,path:!!tt}}function getProtocol(o){if(typeof o=="number"){if(codes$7[o]!=null)return codes$7[o];throw new Error(`no protocol with code: ${o}`)}else if(typeof o=="string"){if(names$3[o]!=null)return names$3[o];throw new Error(`no protocol with name: ${o}`)}throw new Error(`invalid protocol id type: ${typeof o}`)}getProtocol("ip4");getProtocol("ip6");getProtocol("ipcidr");function convertToString(o,s){switch(getProtocol(o).code){case 4:case 41:return bytes2ip(s);case 42:return bytes2str(s);case 6:case 273:case 33:case 132:return bytes2port(s).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return bytes2str(s);case 421:return bytes2mh(s);case 444:return bytes2onion(s);case 445:return bytes2onion(s);case 466:return bytes2mb(s);case 481:return globalThis.encodeURIComponent(bytes2str(s));default:return toString$c(s,"base16")}}function convertToBytes(o,s){switch(getProtocol(o).code){case 4:return ip2bytes(s);case 41:return ip2bytes(s);case 42:return str2bytes(s);case 6:case 273:case 33:case 132:return port2bytes(parseInt(s,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return str2bytes(s);case 421:return mh2bytes(s);case 444:return onion2bytes(s);case 445:return onion32bytes(s);case 466:return mb2bytes(s);case 481:return str2bytes(globalThis.decodeURIComponent(s));default:return fromString$k(s,"base16")}}const decoders=Object.values(bases).map(o=>o.decoder),anybaseDecoder=function(){let o=decoders[0].or(decoders[1]);return decoders.slice(2).forEach(s=>o=o.or(s)),o}();function ip2bytes(o){if(!isIP(o))throw new Error("invalid ip address");return toBytes$1(o)}function bytes2ip(o){const s=toString$b(o,0,o.length);if(s==null)throw new Error("ipBuff is required");if(!isIP(s))throw new Error("invalid ip address");return s}function port2bytes(o){const s=new ArrayBuffer(2);return new DataView(s).setUint16(0,o),new Uint8Array(s)}function bytes2port(o){return new DataView(o.buffer).getUint16(o.byteOffset)}function str2bytes(o){const s=fromString$k(o),a=Uint8Array.from(encode$c(s.length));return concat$9([a,s],a.length+s.length)}function bytes2str(o){const s=decode$g(o);if(o=o.slice(encodingLength$1(s)),o.length!==s)throw new Error("inconsistent lengths");return toString$c(o)}function mh2bytes(o){let s;o[0]==="Q"||o[0]==="1"?s=decode$8(base58btc.decode(`z${o}`)).bytes:s=CID.parse(o).multihash.bytes;const a=Uint8Array.from(encode$c(s.length));return concat$9([a,s],a.length+s.length)}function mb2bytes(o){const s=anybaseDecoder.decode(o),a=Uint8Array.from(encode$c(s.length));return concat$9([a,s],a.length+s.length)}function bytes2mb(o){const s=decode$g(o),a=o.slice(encodingLength$1(s));if(a.length!==s)throw new Error("inconsistent lengths");return"u"+toString$c(a,"base64url")}function bytes2mh(o){const s=decode$g(o),a=o.slice(encodingLength$1(s));if(a.length!==s)throw new Error("inconsistent lengths");return toString$c(a,"base58btc")}function onion2bytes(o){const s=o.split(":");if(s.length!==2)throw new Error(`failed to parse onion addr: ["'${s.join('", "')}'"]' does not contain a port number`);if(s[0].length!==16)throw new Error(`failed to parse onion addr: ${s[0]} not a Tor onion address.`);const a=base32.decode("b"+s[0]),et=parseInt(s[1],10);if(et<1||et>65536)throw new Error("Port number is not in range(1, 65536)");const tt=port2bytes(et);return concat$9([a,tt],a.length+tt.length)}function onion32bytes(o){const s=o.split(":");if(s.length!==2)throw new Error(`failed to parse onion addr: ["'${s.join('", "')}'"]' does not contain a port number`);if(s[0].length!==56)throw new Error(`failed to parse onion addr: ${s[0]} not a Tor onion3 address.`);const a=base32.decode(`b${s[0]}`),et=parseInt(s[1],10);if(et<1||et>65536)throw new Error("Port number is not in range(1, 65536)");const tt=port2bytes(et);return concat$9([a,tt],a.length+tt.length)}function bytes2onion(o){const s=o.slice(0,o.length-2),a=o.slice(o.length-2),et=toString$c(s,"base32"),tt=bytes2port(a);return`${et}:${tt}`}function stringToMultiaddrParts(o){o=cleanPath(o);const s=[],a=[];let et=null;const tt=o.split("/").slice(1);if(tt.length===1&&tt[0]==="")return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let rt=0;rt<tt.length;rt++){const nt=tt[rt],it=getProtocol(nt);if(it.size===0){s.push([it.code]),a.push([it.code]);continue}if(rt++,rt>=tt.length)throw ParseError("invalid address: "+o);if(it.path===!0){et=cleanPath(tt.slice(rt).join("/")),s.push([it.code,convertToBytes(it.code,et)]),a.push([it.code,et]);break}const st=convertToBytes(it.code,tt[rt]);s.push([it.code,st]),a.push([it.code,convertToString(it.code,st)])}return{string:stringTuplesToString(a),bytes:tuplesToBytes(s),tuples:s,stringTuples:a,path:et}}function bytesToMultiaddrParts(o){const s=[],a=[];let et=null,tt=0;for(;tt<o.length;){const rt=decode$g(o,tt),nt=encodingLength$1(rt),it=getProtocol(rt),st=sizeForAddr(it,o.slice(tt+nt));if(st===0){s.push([rt]),a.push([rt]),tt+=nt;continue}const ot=o.slice(tt+nt,tt+nt+st);if(tt+=st+nt,tt>o.length)throw ParseError("Invalid address Uint8Array: "+toString$c(o,"base16"));s.push([rt,ot]);const at=convertToString(rt,ot);if(a.push([rt,at]),it.path===!0){et=at;break}}return{bytes:Uint8Array.from(o),string:stringTuplesToString(a),tuples:s,stringTuples:a,path:et}}function stringTuplesToString(o){const s=[];return o.map(a=>{const et=getProtocol(a[0]);return s.push(et.name),a.length>1&&a[1]!=null&&s.push(a[1]),null}),cleanPath(s.join("/"))}function tuplesToBytes(o){return concat$9(o.map(s=>{const a=getProtocol(s[0]);let et=Uint8Array.from(encode$c(a.code));return s.length>1&&s[1]!=null&&(et=concat$9([et,s[1]])),et}))}function sizeForAddr(o,s){if(o.size>0)return o.size/8;if(o.size===0)return 0;{const a=decode$g(s instanceof Uint8Array?s:Uint8Array.from(s));return a+encodingLength$1(a)}}function cleanPath(o){return"/"+o.trim().split("/").filter(s=>s).join("/")}function ParseError(o){return new Error("Error parsing address: "+o)}const inspect$1=Symbol.for("nodejs.util.inspect.custom"),symbol=Symbol.for("@multiformats/js-multiaddr/multiaddr"),DNS_CODES=[getProtocol("dns").code,getProtocol("dns4").code,getProtocol("dns6").code,getProtocol("dnsaddr").code];class Multiaddr{bytes;#e;#t;#r;#i;[symbol]=!0;constructor(s){s==null&&(s="");let a;if(s instanceof Uint8Array)a=bytesToMultiaddrParts(s);else if(typeof s=="string"){if(s.length>0&&s.charAt(0)!=="/")throw new Error(`multiaddr "${s}" must start with a "/"`);a=stringToMultiaddrParts(s)}else if(isMultiaddr(s))a=bytesToMultiaddrParts(s.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=a.bytes,this.#e=a.string,this.#t=a.tuples,this.#r=a.stringTuples,this.#i=a.path}toString(){return this.#e}toJSON(){return this.toString()}toOptions(){let s,a,et,tt,rt="";const nt=getProtocol("tcp"),it=getProtocol("udp"),st=getProtocol("ip4"),ot=getProtocol("ip6"),at=getProtocol("dns6"),lt=getProtocol("ip6zone");for(const[ht,ft]of this.stringTuples())ht===lt.code&&(rt=`%${ft??""}`),DNS_CODES.includes(ht)&&(a=nt.name,tt=443,et=`${ft??""}${rt}`,s=ht===at.code?6:4),(ht===nt.code||ht===it.code)&&(a=getProtocol(ht).name,tt=parseInt(ft??"")),(ht===st.code||ht===ot.code)&&(a=getProtocol(ht).name,et=`${ft??""}${rt}`,s=ht===ot.code?6:4);if(s==null||a==null||et==null||tt==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:s,host:et,transport:a,port:tt}}protos(){return this.#t.map(([s])=>Object.assign({},getProtocol(s)))}protoCodes(){return this.#t.map(([s])=>s)}protoNames(){return this.#t.map(([s])=>getProtocol(s).name)}tuples(){return this.#t}stringTuples(){return this.#r}encapsulate(s){return s=new Multiaddr(s),new Multiaddr(this.toString()+s.toString())}decapsulate(s){const a=s.toString(),et=this.toString(),tt=et.lastIndexOf(a);if(tt<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${s.toString()}`);return new Multiaddr(et.slice(0,tt))}decapsulateCode(s){const a=this.tuples();for(let et=a.length-1;et>=0;et--)if(a[et][0]===s)return new Multiaddr(tuplesToBytes(a.slice(0,et)));return this}getPeerId(){try{let s=[];this.stringTuples().forEach(([et,tt])=>{et===names$3.p2p.code&&s.push([et,tt]),et===names$3["p2p-circuit"].code&&(s=[])});const a=s.pop();if(a?.[1]!=null){const et=a[1];return et[0]==="Q"||et[0]==="1"?toString$c(base58btc.decode(`z${et}`),"base58btc"):toString$c(CID.parse(et).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){return this.#i}equals(s){return equals$a(this.bytes,s.bytes)}async resolve(s){const a=this.protos().find(rt=>rt.resolvable);if(a==null)return[this];const et=resolvers$1.get(a.name);if(et==null)throw new CodeError$3(`no available resolver for ${a.name}`,"ERR_NO_AVAILABLE_RESOLVER");return(await et(this,s)).map(rt=>multiaddr(rt))}nodeAddress(){const s=this.toOptions();if(s.transport!=="tcp"&&s.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${s.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:s.family,address:s.host,port:s.port}}isThinWaistAddress(s){const a=(s??this).protos();return!(a.length!==2||a[0].code!==4&&a[0].code!==41||a[1].code!==6&&a[1].code!==273)}[inspect$1](){return`Multiaddr(${this.#e})`}}const resolvers$1=new Map;function isMultiaddr(o){return!!o?.[symbol]}function multiaddr(o){return new Multiaddr(o)}const toParts=o=>o.toString().split("/").slice(1),func=o=>({match:s=>s.length<1?!1:o(s[0])?s.slice(1):!1,pattern:"fn"}),literal=o=>({match:s=>func(a=>a===o).match(s),pattern:o}),string$i=()=>({match:o=>func(s=>typeof s=="string").match(o),pattern:"{string}"}),number$1=()=>({match:o=>func(s=>!isNaN(parseInt(s))).match(o),pattern:"{number}"}),peerId=()=>({match:o=>{if(o.length<2||o[0]!=="p2p"&&o[0]!=="ipfs")return!1;if(o[1].startsWith("Q")||o[1].startsWith("1"))try{base58btc.decode(`z${o[1]}`)}catch{return!1}else return!1;return o.slice(2)},pattern:"/p2p/{peerid}"}),certhash$1=()=>({match:o=>{if(o.length<2||o[0]!=="certhash")return!1;try{base64url.decode(o[1])}catch{return!1}return o.slice(2)},pattern:"/certhash/{certhash}"}),optional=o=>({match:s=>{const a=o.match(s);return a===!1?s:a},pattern:`optional(${o.pattern})`}),or$1=(...o)=>({match:s=>{let a;for(const et of o){const tt=et.match(s);tt!==!1&&(a==null||tt.length<a.length)&&(a=tt)}return a??!1},pattern:`or(${o.map(s=>s.pattern).join(", ")})`}),and$1=(...o)=>({match:s=>{for(const a of o){const et=a.match(s);if(et===!1)return!1;s=et}return s},pattern:`and(${o.map(s=>s.pattern).join(", ")})`});function fmt(...o){function s(tt){let rt=toParts(tt);for(const nt of o){const it=nt.match(rt);if(it===!1)return!1;rt=it}return rt}function a(tt){return s(tt)!==!1}function et(tt){const rt=s(tt);return rt===!1?!1:rt.length===0}return{matches:a,exactMatch:et}}const _DNS4=and$1(literal("dns4"),string$i()),_DNS6=and$1(literal("dns6"),string$i()),_DNSADDR=and$1(literal("dnsaddr"),string$i()),_DNS=and$1(literal("dns"),string$i()),DNS$1=fmt(or$1(_DNS,_DNSADDR,_DNS4,_DNS6)),_IP4=and$1(literal("ip4"),func(isIPv4$1)),_IP6=and$1(literal("ip6"),func(isIPv6$1)),_IP=or$1(_IP4,_IP6),_IP_OR_DOMAIN=or$1(_IP,_DNS,_DNS4,_DNS6,_DNSADDR),IP_OR_DOMAIN=fmt(_IP_OR_DOMAIN),IP$1=fmt(_IP),_TCP=and$1(_IP_OR_DOMAIN,literal("tcp"),number$1()),_UDP=and$1(_IP_OR_DOMAIN,literal("udp"),number$1()),_QUIC=and$1(_UDP,literal("quic")),_QUICV1=and$1(_UDP,literal("quic-v1")),QUIC_V0_OR_V1=or$1(_QUIC,_QUICV1),_WEB=or$1(_IP_OR_DOMAIN,_TCP,_UDP,_QUIC,_QUICV1),_WebSockets$1=or$1(and$1(_WEB,literal("ws"),optional(peerId()))),_WebSocketsSecure$1=or$1(and$1(_WEB,literal("wss"),optional(peerId())),and$1(_WEB,literal("tls"),literal("ws"),optional(peerId()))),_WebRTCDirect$1=and$1(_UDP,literal("webrtc-direct"),optional(certhash$1()),optional(certhash$1()),optional(peerId())),WebRTCDirect$1=fmt(_WebRTCDirect$1),_WebTransport$1=and$1(_QUICV1,literal("webtransport"),optional(certhash$1()),optional(certhash$1()),optional(peerId())),WebTransport$3=fmt(_WebTransport$1),_P2P$1=or$1(_WebSockets$1,_WebSocketsSecure$1,and$1(_TCP,optional(peerId())),and$1(QUIC_V0_OR_V1,optional(peerId())),and$1(_IP_OR_DOMAIN,optional(peerId())),_WebRTCDirect$1,_WebTransport$1,peerId()),_Circuit$1=and$1(_P2P$1,literal("p2p-circuit"),peerId()),Circuit$1=fmt(_Circuit$1),_WebRTC=or$1(and$1(_P2P$1,literal("p2p-circuit"),literal("webrtc"),optional(peerId())),and$1(_P2P$1,literal("webrtc"),optional(peerId())),literal("webrtc")),WebRTC=fmt(_WebRTC),_HTTP=or$1(and$1(_IP_OR_DOMAIN,literal("tcp"),number$1(),literal("http"),optional(peerId())),and$1(_IP_OR_DOMAIN,literal("http"),optional(peerId()))),HTTP$1=fmt(_HTTP),_HTTPS=or$1(and$1(_IP_OR_DOMAIN,literal("tcp"),or$1(and$1(literal("443"),literal("http")),and$1(number$1(),literal("https"))),optional(peerId())),and$1(_IP_OR_DOMAIN,literal("tls"),literal("http"),optional(peerId())),and$1(_IP_OR_DOMAIN,literal("https"),optional(peerId()))),HTTPS$1=fmt(_HTTPS),ASSUME_HTTP_CODES=[getProtocol("tcp").code,getProtocol("dns").code,getProtocol("dnsaddr").code,getProtocol("dns4").code,getProtocol("dns6").code];function extractSNI(o){let s;try{s=getProtocol("sni").code}catch{return null}for(const[a,et]of o)if(a===s&&et!==void 0)return et;return null}function hasTLS(o){return o.some(([s,a])=>s===getProtocol("tls").code)}function interpretNext(o,s,a){const et=interpreters[getProtocol(o).name];if(et===void 0)throw new Error(`Can't interpret protocol ${getProtocol(o).name}`);const tt=et(s,a);return o===getProtocol("ip6").code?`[${tt}]`:tt}const interpreters={ip4:(o,s)=>o,ip6:(o,s)=>s.length===0?o:`[${o}]`,tcp:(o,s)=>{const a=s.pop();if(a===void 0)throw new Error("Unexpected end of multiaddr");return`tcp://${interpretNext(a[0],a[1]??"",s)}:${o}`},udp:(o,s)=>{const a=s.pop();if(a===void 0)throw new Error("Unexpected end of multiaddr");return`udp://${interpretNext(a[0],a[1]??"",s)}:${o}`},dnsaddr:(o,s)=>o,dns4:(o,s)=>o,dns6:(o,s)=>o,dns:(o,s)=>o,ipfs:(o,s)=>{const a=s.pop();if(a===void 0)throw new Error("Unexpected end of multiaddr");return`${interpretNext(a[0],a[1]??"",s)}/ipfs/${o}`},p2p:(o,s)=>{const a=s.pop();if(a===void 0)throw new Error("Unexpected end of multiaddr");return`${interpretNext(a[0],a[1]??"",s)}/p2p/${o}`},http:(o,s)=>{const a=hasTLS(s),et=extractSNI(s);if(a&&et!==null)return`https://${et}`;const tt=a?"https://":"http://",rt=s.pop();if(rt===void 0)throw new Error("Unexpected end of multiaddr");let nt=interpretNext(rt[0],rt[1]??"",s);return nt=nt.replace("tcp://",""),`${tt}${nt}`},"http-path":(o,s)=>{const a=s.pop();if(a===void 0)throw new Error("Unexpected end of multiaddr");const et=interpretNext(a[0],a[1]??"",s),tt=decodeURIComponent(o);return`${et}/${tt}`},tls:(o,s)=>{const a=s.pop();if(a===void 0)throw new Error("Unexpected end of multiaddr");return interpretNext(a[0],a[1]??"",s)},sni:(o,s)=>{const a=s.pop();if(a===void 0)throw new Error("Unexpected end of multiaddr");return interpretNext(a[0],a[1]??"",s)},https:(o,s)=>{const a=s.pop();if(a===void 0)throw new Error("Unexpected end of multiaddr");let et=interpretNext(a[0],a[1]??"",s);return et=et.replace("tcp://",""),`https://${et}`},ws:(o,s)=>{const a=hasTLS(s),et=extractSNI(s);if(a&&et!==null)return`wss://${et}`;const tt=a?"wss://":"ws://",rt=s.pop();if(rt===void 0)throw new Error("Unexpected end of multiaddr");let nt=interpretNext(rt[0],rt[1]??"",s);return nt=nt.replace("tcp://",""),`${tt}${nt}`},wss:(o,s)=>{const a=s.pop();if(a===void 0)throw new Error("Unexpected end of multiaddr");let et=interpretNext(a[0],a[1]??"",s);return et=et.replace("tcp://",""),`wss://${et}`},"p2p-websocket-star":(o,s)=>{const a=s.pop();if(a===void 0)throw new Error("Unexpected end of multiaddr");return`${interpretNext(a[0],a[1]??"",s)}/p2p-websocket-star`},"p2p-webrtc-star":(o,s)=>{const a=s.pop();if(a===void 0)throw new Error("Unexpected end of multiaddr");return`${interpretNext(a[0],a[1]??"",s)}/p2p-webrtc-star`},"p2p-webrtc-direct":(o,s)=>{const a=s.pop();if(a===void 0)throw new Error("Unexpected end of multiaddr");return`${interpretNext(a[0],a[1]??"",s)}/p2p-webrtc-direct`}};function multiaddrToUri(o,s){const et=multiaddr(o).stringTuples(),tt=et.pop();if(tt===void 0)throw new Error("Unexpected end of multiaddr");const rt=getProtocol(tt[0]),nt=interpreters[rt.name];if(nt==null)throw new Error(`No interpreter found for ${rt.name}`);let it=nt(tt[1]??"",et);return ASSUME_HTTP_CODES.includes(tt[0])&&(it=it.replace(/^.*:\/\//,""),tt[1]==="443"?it=`https://${it}`:it=`http://${it}`),(it.startsWith("http://")||it.startsWith("https://"))&&(it=new URL(it).toString(),it.endsWith("/")&&(it=it.substring(0,it.length-1))),it}class TrustlessGateway{url;#e=0;#t=0;#r=0;#i=0;#a=new Map;log;constructor(s,a){this.url=s instanceof URL?s:new URL(s),this.log=a.forComponent(`helia:trustless-gateway-block-broker:${this.url.hostname}`)}#c(s){const a=s.multihash.bytes;return base64.encode(a)}async getRawBlock(s,a){const et=new URL(this.url.toString());if(et.pathname=`/ipfs/${s.toString()}`,et.search="?format=raw",a?.aborted===!0)throw new Error(`Signal to fetch raw block for CID ${s} from gateway ${this.url} was aborted prior to fetch`);const tt=this.#c(s),rt=new AbortController,nt=()=>{rt.abort()};a?.addEventListener("abort",nt);try{let it=this.#a.get(tt);return it==null&&(this.#e++,it=fetch(et.toString(),{signal:rt.signal,headers:{Accept:"application/vnd.ipld.raw"},cache:"force-cache"}).then(async st=>{if(this.log("GET %s %d",et,st.status),!st.ok)throw this.#t++,new Error(`unable to fetch raw block for CID ${s} from gateway ${this.url}`);return this.#i++,new Uint8Array(await st.arrayBuffer())}),this.#a.set(tt,it)),await it}catch{throw a?.aborted===!0?new Error(`fetching raw block for CID ${s} from gateway ${this.url} was aborted`):(this.#t++,new Error(`unable to fetch raw block for CID ${s}`))}finally{a?.removeEventListener("abort",nt),this.#a.delete(tt)}}reliability(){return this.#e===0?1:this.#r>0?-1/0:this.#i/(this.#e+this.#t*3)}incrementInvalidBlocks(){this.#r++}getStats(){return{attempts:this.#e,errors:this.#t,invalidBlocks:this.#r,successes:this.#i,pendingResponses:this.#a.size}}}function filterNonHTTPMultiaddrs(o,s,a){return o.filter(et=>HTTPS$1.matches(et)||s&&HTTP$1.matches(et)?a||DNS$1.matches(et)?!0:isPrivateIp(et.toOptions().host)===!1:!1)}async function*findHttpGatewayProviders(o,s,a,et,tt,rt){for await(const nt of s.findProviders(o,rt)){const it=filterNonHTTPMultiaddrs(nt.multiaddrs,et,tt);if(it.length===0)continue;const st=multiaddrToUri(it[0]);yield new TrustlessGateway(st,a)}}class TrustlessGatewaySession extends AbstractSession{routing;allowInsecure;allowLocal;constructor(s,a){super(s,{...a,name:"helia:trustless-gateway:session"}),this.routing=s.routing,this.allowInsecure=a.allowInsecure??DEFAULT_ALLOW_INSECURE,this.allowLocal=a.allowLocal??DEFAULT_ALLOW_LOCAL}async queryProvider(s,a,et){this.log("fetching BLOCK for %c from %s",s,a.url);const tt=await a.getRawBlock(s,et.signal);return this.log.trace("got block for %c from %s",s,a.url),await et.validateFn?.(tt),tt}async*findNewProviders(s,a={}){yield*findHttpGatewayProviders(s,this.routing,this.logger,this.allowInsecure,this.allowLocal,a)}toEvictionKey(s){return s.url.toString()}equals(s,a){return s.url.toString()===a.url.toString()}}function createTrustlessGatewaySession(o,s){return new TrustlessGatewaySession(o,s)}class TrustlessGatewayBlockBroker{allowInsecure;allowLocal;routing;log;logger;constructor(s,a={}){this.log=s.logger.forComponent("helia:trustless-gateway-block-broker"),this.logger=s.logger,this.routing=s.routing,this.allowInsecure=a.allowInsecure??DEFAULT_ALLOW_INSECURE,this.allowLocal=a.allowLocal??DEFAULT_ALLOW_LOCAL}async retrieve(s,a={}){const et=[];for await(const tt of findHttpGatewayProviders(s,this.routing,this.logger,this.allowInsecure,this.allowLocal,a)){this.log("getting block for %c from %s",s,tt.url);try{const rt=await tt.getRawBlock(s,a.signal);this.log.trace("got block for %c from %s",s,tt.url);try{await a.validateFn?.(rt)}catch(nt){this.log.error("failed to validate block for %c from %s",s,tt.url,nt);continue}return rt}catch(rt){if(this.log.error("failed to get block for %c from %s",s,tt.url,rt),rt instanceof Error?et.push(rt):et.push(new Error(`Unable to fetch raw block for CID ${s} from gateway ${tt.url}`)),a.signal?.aborted===!0){this.log.trace("request aborted while fetching raw block for CID %c from gateway %s",s,tt.url);break}}}throw et.length>0?new AggregateError(et,`Unable to fetch raw block for CID ${s} from any gateway`):new Error(`Unable to fetch raw block for CID ${s} from any gateway`)}createSession(s={}){return createTrustlessGatewaySession({logger:this.logger,routing:this.routing},s)}}const DEFAULT_ALLOW_INSECURE=!1,DEFAULT_ALLOW_LOCAL=!1;function trustlessGateway(o={}){return s=>new TrustlessGatewayBlockBroker(s,o)}async function*browserReadableStreamToIt(o,s={}){const a=o.getReader();try{for(;;){const et=await a.read();if(et.done)return;yield et.value}}finally{s.preventCancel!==!0&&await a.cancel(),a.releaseLock()}}var timestamp_min={exports:{}};(function(o){(function(){o.exports=pt;var s=86400,a=3200,et=146097*a/400,tt=s*et,rt=1e3*tt,nt=864e13,it=4294967296,st=1e6,ot="000000000",at=Math.trunc||function(Ct){var Ft=Ct-Ct%1;return Ft==0&&(Ct<0||Ct===0&&1/Ct!=1/0)?-0:Ft},lt=pt.prototype,ct=(pt.fromDate=function(Ct){return new pt(+Ct)},pt.fromInt64BE=Et(0,1,2,3,0,4),pt.fromInt64LE=Et(3,2,1,0,4,0),pt.fromString=function(Nt){var Ft,zt=new pt,Nt=(Nt+="").replace(/^\s*[+\-]?\d+/,function(Yt){var Yt=+Yt,Bt=1970+(Yt-1970)%400;return zt.year=Yt-Bt,Bt}).replace(/(?:Z|([+\-]\d{2}):?(\d{2}))$/,function(Kt,Yt,Bt){return Yt<0&&(Bt*=-1),Ft=6e4*(60*+Yt+ +Bt),""}).replace(/\.\d+$/,function(Kt){return zt.nano=+(Kt+ot).substr(1,9),""}).split(/\D+/);if(1<Nt.length?Nt[1]--:Nt[1]=0,zt.time=Ft=Date.UTC.apply(Date,Nt)-(Ft||0),isNaN(Ft))throw new TypeError("Invalid Date");return gt(zt)},pt.fromTimeT=function(Ct){return yt(Ct,0)},lt.year=0,lt.time=0,lt.nano=0,lt.addNano=function(Ct){return this.nano+=+Ct||0,this},lt.getNano=function(){var Ct=gt(this);return(Ct.time%1e3*st+ +Ct.nano+1e9)%1e9},lt.getTimeT=function(){var Ft=gt(this),Ct=Math.floor(Ft.time/1e3),Ft=Ft.year;return Ft&&(Ct+=Ft*et*s/a),Ct},lt.getYear=function(){return this.toDate().getUTCFullYear()+this.year},lt.toDate=function(){return mt(gt(this).time)},lt.toJSON=function(){return this.toString().replace(/0{1,6}Z$/,"Z")},lt.toString=function(Ct){var Ft=this,zt=Ft.toDate(),Nt={H:function(){return wt(zt.getUTCHours())},L:function(){return Rt(zt.getUTCMilliseconds(),3)},M:function(){return wt(zt.getUTCMinutes())},N:function(){return Rt(Ft.getNano(),9)},S:function(){return wt(zt.getUTCSeconds())},Y:function(){var Kt=Ft.getYear();return 999999<Kt?"+"+Kt:9999<Kt?"+"+Rt(Kt,6):0<=Kt?Rt(Kt,4):-999999<=Kt?"-"+Rt(-Kt,6):Kt},a:function(){return ft[zt.getUTCDay()]},b:function(){return ht[zt.getUTCMonth()]},d:function(){return wt(zt.getUTCDate())},e:function(){return function(Kt){return(9<Kt?"":" ")+(0|Kt)}(zt.getUTCDate())},m:function(){return wt(zt.getUTCMonth()+1)}};return function Kt(Yt){return Yt.replace(/%./g,function(Bt){var Dt=Bt[1],Pt=dt[Dt],Dt=Nt[Dt];return Pt?Kt(Pt):Dt?Dt():Bt})}(Ct||ct)},lt.writeInt64BE=vt(0,1,2,3,0,4),lt.writeInt64LE=vt(3,2,1,0,4,0),"%Y-%m-%dT%H:%M:%S.%NZ"),ht=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],ft=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dt={"%":"%",F:"%Y-%m-%d",n:`
`,R:"%H:%M",T:"%H:%M:%S",t:"	",X:"%T",Z:"GMT",z:"+0000"};return pt;function pt(Ct,Ft,zt){var Nt=this;if(!(Nt instanceof pt))return new pt(Ct,Ft,zt);Nt.time=+Ct||0,Nt.nano=+Ft||0,Nt.year=+zt||0,gt(Nt)}function gt(Ct){var Ft,zt,Nt,Kt=Ct.year,Yt=Ct.time,Bt=Ct.nano,Pt=((Bt<0||st<=Bt)&&(Bt-=(zt=Math.floor(Bt/st))*st,Yt+=zt,zt=1),Kt%a);return(Yt<-nt||nt<Yt||Pt)&&((Ft=at(Yt/rt))&&(Kt+=Ft*a,Yt-=Ft*rt),(Nt=mt(Yt)).setUTCFullYear(Pt+Nt.getUTCFullYear()),Nt=(Yt=+Nt)+(Ft=at((Kt-=Pt)/a))*rt,Ft&&-nt<=Nt&&Nt<=nt&&(Kt-=Ft*a,Yt=Nt),zt=1),zt&&(Ct.year=Kt,Ct.time=Yt,Ct.nano=Bt),Ct}function mt(Ct){var Ft=new Date(0);return Ft.setTime(Ct),Ft}function yt(Kt,Nt){Kt=+Kt||0;var zt=at((Nt=(Nt|0)*it)/tt)+at(Kt/tt),Nt=Nt%tt+Kt%tt,Kt=at(Nt/tt);return Kt&&(zt+=Kt,Nt-=Kt*tt),new pt(1e3*Nt,0,zt*a)}function vt(Ct,Ft,zt,Nt,Kt,Yt){return function(Pt,Dt){var St=gt(this);Pt=Pt||new Array(8),xt(Pt,Dt|=0);var Mt=Math.floor(St.time/1e3),St=St.year*(et*s/a),Tt=at(St/it)+at(Mt/it),St=St%it+Mt%it,Mt=Math.floor(St/it);return Mt&&(Tt+=Mt,St-=Mt*it),Bt(Pt,Dt+Kt,Tt),Bt(Pt,Dt+Yt,St),Pt};function Bt(Pt,Dt,Tt){Pt[Dt+Ct]=Tt>>24&255,Pt[Dt+Ft]=Tt>>16&255,Pt[Dt+zt]=Tt>>8&255,Pt[Dt+Nt]=255&Tt}}function Et(Ct,Ft,zt,Nt,Kt,Yt){return function(Pt,Dt){xt(Pt,Dt|=0);var Tt=Bt(Pt,Dt+Kt);return yt(Bt(Pt,Dt+Yt),Tt)};function Bt(Pt,Dt){return 16777216*Pt[Dt+Ct]+(Pt[Dt+Ft]<<16|Pt[Dt+zt]<<8|Pt[Dt+Nt])}}function xt(Ct,Ft){if(Ct=Ct&&Ct.length,Ct==null)throw new TypeError("Invalid Buffer");if(Ct<Ft+8)throw new RangeError("Out of range")}function wt(Ct){return(9<Ct?"":"0")+(0|Ct)}function Rt(Ct,Ft){return(ot+(0|Ct)).substr(-Ft)}})()})(timestamp_min);var timestamp_minExports=timestamp_min.exports;const NanoDate=getDefaultExportFromCjs$2(timestamp_minExports);function equals$9(o,s){if(o===s)return!0;if(o.byteLength!==s.byteLength)return!1;for(let a=0;a<o.byteLength;a++)if(o[a]!==s[a])return!1;return!0}function allocUnsafe$h(o=0){return new Uint8Array(o)}function createCodec$h(o,s,a,et){return{name:o,prefix:s,encoder:{name:o,prefix:s,encode:a},decoder:{decode:et}}}const string$h=createCodec$h("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),ascii$h=createCodec$h("ascii","a",o=>{let s="a";for(let a=0;a<o.length;a++)s+=String.fromCharCode(o[a]);return s},o=>{o=o.substring(1);const s=allocUnsafe$h(o.length);for(let a=0;a<o.length;a++)s[a]=o.charCodeAt(a);return s}),BASES$h={utf8:string$h,"utf-8":string$h,hex:bases.base16,latin1:ascii$h,ascii:ascii$h,binary:ascii$h,...bases};function fromString$j(o,s="utf8"){const a=BASES$h[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.decoder.decode(`${a.prefix}${o}`)}const ERR_IPNS_EXPIRED_RECORD="ERR_IPNS_EXPIRED_RECORD",ERR_UNRECOGNIZED_VALIDITY="ERR_UNRECOGNIZED_VALIDITY",ERR_SIGNATURE_VERIFICATION="ERR_SIGNATURE_VERIFICATION",ERR_UNDEFINED_PARAMETER="ERR_UNDEFINED_PARAMETER",ERR_INVALID_RECORD_DATA="ERR_INVALID_RECORD_DATA",ERR_INVALID_VALUE="ERR_INVALID_VALUE",ERR_INVALID_EMBEDDED_KEY="ERR_INVALID_EMBEDDED_KEY",ERR_RECORD_TOO_LARGE="ERR_RECORD_TOO_LARGE";var IpnsEntry;(function(o){(function(et){et.EOL="EOL"})(o.ValidityType||(o.ValidityType={}));let s;(function(et){et[et.EOL=0]="EOL"})(s||(s={})),function(et){et.codec=()=>enumeration(s)}(o.ValidityType||(o.ValidityType={}));let a;o.codec=()=>(a==null&&(a=message((et,tt,rt={})=>{rt.lengthDelimited!==!1&&tt.fork(),et.value!=null&&(tt.uint32(10),tt.bytes(et.value)),et.signatureV1!=null&&(tt.uint32(18),tt.bytes(et.signatureV1)),et.validityType!=null&&(tt.uint32(24),o.ValidityType.codec().encode(et.validityType,tt)),et.validity!=null&&(tt.uint32(34),tt.bytes(et.validity)),et.sequence!=null&&(tt.uint32(40),tt.uint64(et.sequence)),et.ttl!=null&&(tt.uint32(48),tt.uint64(et.ttl)),et.pubKey!=null&&(tt.uint32(58),tt.bytes(et.pubKey)),et.signatureV2!=null&&(tt.uint32(66),tt.bytes(et.signatureV2)),et.data!=null&&(tt.uint32(74),tt.bytes(et.data)),rt.lengthDelimited!==!1&&tt.ldelim()},(et,tt)=>{const rt={},nt=tt==null?et.len:et.pos+tt;for(;et.pos<nt;){const it=et.uint32();switch(it>>>3){case 1:rt.value=et.bytes();break;case 2:rt.signatureV1=et.bytes();break;case 3:rt.validityType=o.ValidityType.codec().decode(et);break;case 4:rt.validity=et.bytes();break;case 5:rt.sequence=et.uint64();break;case 6:rt.ttl=et.uint64();break;case 7:rt.pubKey=et.bytes();break;case 8:rt.signatureV2=et.bytes();break;case 9:rt.data=et.bytes();break;default:et.skipType(it&7);break}}return rt})),a),o.encode=et=>encodeMessage(et,o.codec()),o.decode=et=>decodeMessage(et,o.codec())})(IpnsEntry||(IpnsEntry={}));function asUint8Array$8(o){return o}function concat$8(o,s){s==null&&(s=o.reduce((tt,rt)=>tt+rt.length,0));const a=allocUnsafe$h(s);let et=0;for(const tt of o)a.set(tt,et),et+=tt.length;return a}function toString$a(o,s="utf8"){const a=BASES$h[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.encoder.encode(o).substring(1)}const log$c=logger$1("ipns:utils"),IPNS_PREFIX$1=fromString$j("/ipns/"),LIBP2P_CID_CODEC=114,extractPublicKey=async(o,s)=>{if(s==null||o==null){const et=new Error("one or more of the provided parameters are not defined");throw log$c.error(et),errCode$1(et,ERR_UNDEFINED_PARAMETER)}let a;if(s.pubKey!=null){try{a=unmarshalPublicKey(s.pubKey)}catch(tt){throw log$c.error(tt),tt}if(!(await peerIdFromKeys(s.pubKey)).equals(o))throw errCode$1(new Error("Embedded public key did not match PeerID"),ERR_INVALID_EMBEDDED_KEY)}else o.publicKey!=null&&(a=unmarshalPublicKey(o.publicKey));if(a!=null)return a;throw errCode$1(new Error("no public key is available"),ERR_UNDEFINED_PARAMETER)},ipnsRecordDataForV2Sig=o=>{const s=fromString$j("ipns-signature:");return concat$8([s,o])},marshal=o=>"signatureV1"in o?IpnsEntry.encode({value:fromString$j(o.value),signatureV1:o.signatureV1,validityType:o.validityType,validity:fromString$j(o.validity),sequence:o.sequence,ttl:o.ttl,pubKey:o.pubKey,signatureV2:o.signatureV2,data:o.data}):IpnsEntry.encode({pubKey:o.pubKey,signatureV2:o.signatureV2,data:o.data});function unmarshal(o){const s=IpnsEntry.decode(o);if(s.sequence!=null&&(s.sequence=BigInt(s.sequence)),s.ttl!=null&&(s.ttl=BigInt(s.ttl)),s.signatureV2==null||s.data==null)throw errCode$1(new Error("missing data or signatureV2"),ERR_SIGNATURE_VERIFICATION);const a=parseCborData(s.data),et=normalizeValue(a.Value),tt=toString$a(a.Validity);if(s.value!=null&&s.signatureV1!=null)return validateCborDataMatchesPbData(s),{value:et,validityType:IpnsEntry.ValidityType.EOL,validity:tt,sequence:a.Sequence,ttl:a.TTL,pubKey:s.pubKey,signatureV1:s.signatureV1,signatureV2:s.signatureV2,data:s.data};if(s.signatureV2!=null)return{value:et,validityType:IpnsEntry.ValidityType.EOL,validity:tt,sequence:a.Sequence,ttl:a.TTL,pubKey:s.pubKey,signatureV2:s.signatureV2,data:s.data};throw new Error("invalid record: does not include signatureV1 or signatureV2")}const peerIdToRoutingKey=o=>concat$8([IPNS_PREFIX$1,o.toBytes()]),peerIdFromRoutingKey$1=o=>peerIdFromBytes(o.slice(IPNS_PREFIX$1.length)),parseCborData=o=>{const s=decode$7(o);if(s.ValidityType===0)s.ValidityType=IpnsEntry.ValidityType.EOL;else throw errCode$1(new Error("Unknown validity type"),ERR_UNRECOGNIZED_VALIDITY);return Number.isInteger(s.Sequence)&&(s.Sequence=BigInt(s.Sequence)),Number.isInteger(s.TTL)&&(s.TTL=BigInt(s.TTL)),s},normalizeValue=o=>{if(o!=null){if(isPeerId(o))return`/ipns/${o.toCID().toString(base36)}`;if(o instanceof Uint8Array){const et=toString$a(o);et.startsWith("/")&&(o=et)}const s=o.toString().trim();if(s.startsWith("/")&&s.length>1)return s;const a=CID.asCID(o);if(a!=null)return a.code===LIBP2P_CID_CODEC?`/ipns/${a.toString(base36)}`:`/ipfs/${a.toV1().toString()}`;try{return o instanceof Uint8Array?`/ipfs/${CID.decode(o).toV1().toString()}`:`/ipfs/${CID.parse(s).toV1().toString()}`}catch{}}throw errCode$1(new Error("Value must be a valid content path starting with /"),ERR_INVALID_VALUE)},validateCborDataMatchesPbData=o=>{if(o.data==null)throw errCode$1(new Error("Record data is missing"),ERR_INVALID_RECORD_DATA);const s=parseCborData(o.data);if(!equals$9(s.Value,o.value??new Uint8Array(0)))throw errCode$1(new Error('Field "value" did not match between protobuf and CBOR'),ERR_SIGNATURE_VERIFICATION);if(!equals$9(s.Validity,o.validity??new Uint8Array(0)))throw errCode$1(new Error('Field "validity" did not match between protobuf and CBOR'),ERR_SIGNATURE_VERIFICATION);if(s.ValidityType!==o.validityType)throw errCode$1(new Error('Field "validityType" did not match between protobuf and CBOR'),ERR_SIGNATURE_VERIFICATION);if(s.Sequence!==o.sequence)throw errCode$1(new Error('Field "sequence" did not match between protobuf and CBOR'),ERR_SIGNATURE_VERIFICATION);if(s.TTL!==o.ttl)throw errCode$1(new Error('Field "ttl" did not match between protobuf and CBOR'),ERR_SIGNATURE_VERIFICATION)},log$b=logger$1("ipns:validator"),MAX_RECORD_SIZE=1024*10,validate$1=async(o,s)=>{const a=unmarshal(s);let et;try{const tt=ipnsRecordDataForV2Sig(a.data);et=await o.verify(tt,a.signatureV2)}catch{et=!1}if(!et)throw log$b.error("record signature verification failed"),errCode$1(new Error("record signature verification failed"),ERR_SIGNATURE_VERIFICATION);if(a.validityType===IpnsEntry.ValidityType.EOL){if(NanoDate.fromString(a.validity).toDate().getTime()<Date.now())throw log$b.error("record has expired"),errCode$1(new Error("record has expired"),ERR_IPNS_EXPIRED_RECORD)}else if(a.validityType!=null)throw log$b.error("unrecognized validity type"),errCode$1(new Error("unrecognized validity type"),ERR_UNRECOGNIZED_VALIDITY);log$b("ipns record for %s is valid",a.value)};async function ipnsValidator(o,s){if(s.byteLength>MAX_RECORD_SIZE)throw errCode$1(new Error("record too large"),ERR_RECORD_TOO_LARGE);const a=peerIdFromRoutingKey$1(o),et=unmarshal(s),tt=await extractPublicKey(a,et);await validate$1(tt,s)}async function*parse$1(o){const s=/\r?\n/,a=new TextDecoder("utf8");let et="";for await(let tt of o){typeof tt=="string"&&(tt=new TextEncoder().encode(tt)),et+=a.decode(tt,{stream:!0});const rt=et.split(s);et=rt.pop()??"";for(let nt=0;nt<rt.length;nt++)yield JSON.parse(rt[nt])}et+=a.decode(),et!==""&&(yield JSON.parse(et))}function isAsyncIterable$8(o){return o[Symbol.asyncIterator]!=null}function first(o){if(isAsyncIterable$8(o))return(async()=>{for await(const s of o)return s})();for(const s of o)return s}function equals$8(o,s){if(o===s)return!0;if(o.byteLength!==s.byteLength)return!1;for(let a=0;a<o.byteLength;a++)if(o[a]!==s[a])return!1;return!0}function allocUnsafe$g(o=0){return new Uint8Array(o)}function createCodec$g(o,s,a,et){return{name:o,prefix:s,encoder:{name:o,prefix:s,encode:a},decoder:{decode:et}}}const string$g=createCodec$g("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),ascii$g=createCodec$g("ascii","a",o=>{let s="a";for(let a=0;a<o.length;a++)s+=String.fromCharCode(o[a]);return s},o=>{o=o.substring(1);const s=allocUnsafe$g(o.length);for(let a=0;a<o.length;a++)s[a]=o.charCodeAt(a);return s}),BASES$g={utf8:string$g,"utf-8":string$g,hex:bases.base16,latin1:ascii$g,ascii:ascii$g,binary:ascii$g,...bases};function fromString$i(o,s="utf8"){const a=BASES$g[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.decoder.decode(`${a.prefix}${o}`)}const IPNS_PREFIX=fromString$i("/ipns/");function isIPNSKey(o){return equals$8(o.subarray(0,IPNS_PREFIX.byteLength),IPNS_PREFIX)}const peerIdFromRoutingKey=o=>peerIdFromBytes(o.slice(IPNS_PREFIX.length));class DelegatedRoutingV1HttpApiClientContentRouting{client;constructor(s){this.client=s}async*findProviders(s,a={}){yield*map$1(this.client.getProviders(s,a),et=>({id:et.ID,multiaddrs:et.Addrs??[]}))}async provide(){}async put(s,a,et){if(!isIPNSKey(s))return;const tt=peerIdFromRoutingKey(s),rt=unmarshal(a);await this.client.putIPNS(tt,rt,et)}async get(s,a){if(!isIPNSKey(s))throw new CodeError$3("Not found","ERR_NOT_FOUND");const et=peerIdFromRoutingKey(s);try{const tt=await this.client.getIPNS(et,a);return marshal(tt)}catch(tt){throw tt.code==="ERR_BAD_RESPONSE"?new CodeError$3("Not found","ERR_NOT_FOUND"):tt}}}class DelegatedRoutingV1HttpApiClientPeerRouting{client;constructor(s){this.client=s}async findPeer(s,a={}){const et=await first(this.client.getPeers(s,a));if(et!=null)return{id:et.ID,multiaddrs:et.Addrs??[]};throw new CodeError$3("Not found","ERR_NOT_FOUND")}async*getClosestPeers(s,a={}){}}const log$a=logger$1("delegated-routing-v1-http-api-client"),defaultValues$2={concurrentRequests:4,timeout:3e4};class DefaultDelegatedRoutingV1HttpApiClient{started;httpQueue;shutDownController;clientUrl;timeout;contentRouting;peerRouting;constructor(s,a={}){this.started=!1,this.shutDownController=new AbortController,setMaxListeners(1/0,this.shutDownController.signal),this.httpQueue=new PQueue({concurrency:a.concurrentRequests??defaultValues$2.concurrentRequests}),this.clientUrl=s instanceof URL?s:new URL(s),this.timeout=a.timeout??defaultValues$2.timeout,this.contentRouting=new DelegatedRoutingV1HttpApiClientContentRouting(this),this.peerRouting=new DelegatedRoutingV1HttpApiClientPeerRouting(this)}get[contentRoutingSymbol](){return this.contentRouting}get[peerRoutingSymbol](){return this.peerRouting}isStarted(){return this.started}start(){this.started=!0}stop(){this.httpQueue.clear(),this.shutDownController.abort(),this.started=!1}async*getProviders(s,a={}){log$a("getProviders starts: %c",s);const et=AbortSignal.timeout(this.timeout),tt=anySignal([this.shutDownController.signal,et,a.signal]);setMaxListeners(1/0,et,tt);const rt=pDefer(),nt=pDefer();this.httpQueue.add(async()=>(rt.resolve(),nt.promise));try{await rt.promise;const it=`${this.clientUrl}routing/v1/providers/${s.toString()}`,ot=await fetch(it,{headers:{Accept:"application/x-ndjson"},signal:tt});if(ot.status===404)throw new CodeError$3("No matching records found.","ERR_NOT_FOUND");if(ot.status===422)throw new CodeError$3("Request does not conform to schema or semantic constraints.","ERR_INVALID_REQUEST");if(ot.body==null)throw new CodeError$3("Routing response had no body","ERR_BAD_RESPONSE");if(ot.headers.get("Content-Type")==="application/json"){const lt=await ot.json();for(const ct of lt.Providers){const ht=this.#e(ct);ht!=null&&(yield ht)}}else for await(const lt of parse$1(browserReadableStreamToIt(ot.body))){const ct=this.#e(lt);ct!=null&&(yield ct)}}catch(it){log$a.error("getProviders errored:",it)}finally{tt.clear(),nt.resolve(),log$a("getProviders finished: %c",s)}}async*getPeers(s,a={}){log$a("getPeers starts: %c",s);const et=AbortSignal.timeout(this.timeout),tt=anySignal([this.shutDownController.signal,et,a.signal]);setMaxListeners(1/0,et,tt);const rt=pDefer(),nt=pDefer();this.httpQueue.add(async()=>(rt.resolve(),nt.promise));try{await rt.promise;const it=`${this.clientUrl}routing/v1/peers/${s.toCID().toString()}`,ot=await fetch(it,{headers:{Accept:"application/x-ndjson"},signal:tt});if(ot.status===404)throw new CodeError$3("No matching records found.","ERR_NOT_FOUND");if(ot.status===422)throw new CodeError$3("Request does not conform to schema or semantic constraints.","ERR_INVALID_REQUEST");if(ot.body==null)throw new CodeError$3("Routing response had no body","ERR_BAD_RESPONSE");if(ot.headers.get("Content-Type")==="application/json"){const lt=await ot.json();for(const ct of lt.Peers){const ht=this.#e(ct);ht!=null&&(yield ht)}}else for await(const lt of parse$1(browserReadableStreamToIt(ot.body))){const ct=this.#e(lt);ct!=null&&(yield ct)}}catch(it){log$a.error("getPeers errored:",it)}finally{tt.clear(),nt.resolve(),log$a("getPeers finished: %c",s)}}async getIPNS(s,a={}){log$a("getIPNS starts: %c",s);const et=AbortSignal.timeout(this.timeout),tt=anySignal([this.shutDownController.signal,et,a.signal]);setMaxListeners(1/0,et,tt);const rt=pDefer(),nt=pDefer();this.httpQueue.add(async()=>(rt.resolve(),nt.promise));const it=`${this.clientUrl}routing/v1/ipns/${s.toCID().toString()}`;try{await rt.promise;const ot=await fetch(it,{headers:{Accept:"application/vnd.ipfs.ipns-record"},signal:tt});if(log$a("getIPNS GET %s %d",it,ot.status),ot.status===404)throw new CodeError$3("No matching records found.","ERR_NOT_FOUND");if(ot.status===422)throw new CodeError$3("Request does not conform to schema or semantic constraints.","ERR_INVALID_REQUEST");if(ot.body==null)throw new CodeError$3("GET ipns response had no body","ERR_BAD_RESPONSE");const at=await ot.arrayBuffer(),lt=new Uint8Array(at,0,at.byteLength);return a.validate!==!1&&await ipnsValidator(peerIdToRoutingKey(s),lt),unmarshal(lt)}catch(st){throw log$a.error("getIPNS GET %s error:",it,st),st}finally{tt.clear(),nt.resolve(),log$a("getIPNS finished: %c",s)}}async putIPNS(s,a,et={}){log$a("putIPNS starts: %c",s);const tt=AbortSignal.timeout(this.timeout),rt=anySignal([this.shutDownController.signal,tt,et.signal]);setMaxListeners(1/0,tt,rt);const nt=pDefer(),it=pDefer();this.httpQueue.add(async()=>(nt.resolve(),it.promise));const st=`${this.clientUrl}routing/v1/ipns/${s.toCID().toString()}`;try{await nt.promise;const ot=marshal(a),lt=await fetch(st,{method:"PUT",headers:{"Content-Type":"application/vnd.ipfs.ipns-record"},body:ot,signal:rt});if(log$a("putIPNS PUT %s %d",st,lt.status),lt.status!==200)throw new CodeError$3("PUT ipns response had status other than 200","ERR_BAD_RESPONSE")}catch(ot){throw log$a.error("putIPNS PUT %s error:",st,ot.stack),ot}finally{rt.clear(),it.resolve(),log$a("putIPNS finished: %c",s)}}#e(s){const a=[],et=s.Addrs?.map(multiaddr)??[];return s.Protocols!=null&&a.push(...s.Protocols),s.Protocol!=null&&(a.push(s.Protocol),delete s.Protocol),{...s,Schema:"peer",ID:peerIdFromString(s.ID),Addrs:et,Protocols:a}}}function createDelegatedRoutingV1HttpApiClient(o,s={}){return new DefaultDelegatedRoutingV1HttpApiClient(new URL(o),s)}function allocUnsafe$f(o=0){return new Uint8Array(o)}function createCodec$f(o,s,a,et){return{name:o,prefix:s,encoder:{name:o,prefix:s,encode:a},decoder:{decode:et}}}const string$f=createCodec$f("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),ascii$f=createCodec$f("ascii","a",o=>{let s="a";for(let a=0;a<o.length;a++)s+=String.fromCharCode(o[a]);return s},o=>{o=o.substring(1);const s=allocUnsafe$f(o.length);for(let a=0;a<o.length;a++)s[a]=o.charCodeAt(a);return s}),BASES$f={utf8:string$f,"utf-8":string$f,hex:bases.base16,latin1:ascii$f,ascii:ascii$f,binary:ascii$f,...bases};function fromString$h(o,s="utf8"){const a=BASES$f[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.decoder.decode(`${a.prefix}${o}`)}const word="[a-fA-F\\d:]",boundry=o=>o&&o.includeBoundaries?`(?:(?<=\\s|^)(?=${word})|(?<=${word})(?=\\s|$))`:"",v4="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",v6segment="[a-fA-F\\d]{1,4}",v6=`
(?:
(?:${v6segment}:){7}(?:${v6segment}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${v6segment}:){6}(?:${v4}|:${v6segment}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${v6segment}:){5}(?::${v4}|(?::${v6segment}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${v6segment}:){4}(?:(?::${v6segment}){0,1}:${v4}|(?::${v6segment}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${v6segment}:){3}(?:(?::${v6segment}){0,2}:${v4}|(?::${v6segment}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${v6segment}:){2}(?:(?::${v6segment}){0,3}:${v4}|(?::${v6segment}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${v6segment}:){1}(?:(?::${v6segment}){0,4}:${v4}|(?::${v6segment}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${v6segment}){0,5}:${v4}|(?::${v6segment}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),v46Exact=new RegExp(`(?:^${v4}$)|(?:^${v6}$)`),v4exact=new RegExp(`^${v4}$`),v6exact=new RegExp(`^${v6}$`),ipRegex=o=>o&&o.exact?v46Exact:new RegExp(`(?:${boundry(o)}${v4}${boundry(o)})|(?:${boundry(o)}${v6}${boundry(o)})`,"g");ipRegex.v4=o=>o&&o.exact?v4exact:new RegExp(`${boundry(o)}${v4}${boundry(o)}`,"g");ipRegex.v6=o=>o&&o.exact?v6exact:new RegExp(`${boundry(o)}${v6}${boundry(o)}`,"g");function functionTimeout(o){const s=(...a)=>o(...a);return Object.defineProperty(s,"name",{value:`functionTimeout(${o.name||"<anonymous>"})`,configurable:!0}),s}const{toString:toString$9}=Object.prototype;function isRegexp(o){return toString$9.call(o)==="[object RegExp]"}const flagMap={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"};function clonedRegexp(o,s={}){if(!isRegexp(o))throw new TypeError("Expected a RegExp instance");const a=Object.keys(flagMap).map(tt=>(typeof s[tt]=="boolean"?s[tt]:o[tt])?flagMap[tt]:"").join(""),et=new RegExp(s.source||o.source,a);return et.lastIndex=typeof s.lastIndex=="number"?s.lastIndex:o.lastIndex,et}function isMatch(o,s,{timeout:a}={}){try{return functionTimeout(()=>clonedRegexp(o).test(s),{timeout:a})()}catch(et){throw et}}const maxIPv4Length=15,maxIPv6Length=45,options={timeout:400};function isIPv6(o){return o.length>maxIPv6Length?!1:isMatch(ipRegex.v6({exact:!0}),o,options)}function isIPv4(o){return o.length>maxIPv4Length?!1:isMatch(ipRegex.v4({exact:!0}),o,options)}const portFor={http:"80",https:"443",ws:"80",wss:"443"},BROWSER_SCHEMES=["http","https","ws","wss"];function uriToMultiaddr(o,s){s=s??{};const a=s.defaultDnsType??"dns4",{scheme:et,hostname:tt,port:rt}=parseUri(o),it="/"+[tupleForHostname(tt,a),tupleForPort(rt,et),tupleForScheme(et)].filter(st=>!!st).reduce((st,ot)=>st.concat(ot),[]).join("/");return multiaddr(it)}function parseUri(o){const[s]=o.split(":");BROWSER_SCHEMES.includes(s)||(o="http"+o.substring(s.length));let{protocol:a,hostname:et,port:tt}=new URL(o);if(tt==null||tt===""){const rt=portForProtocol(s);rt!=null&&(tt=rt),rt==null&&a==="http:"&&(tt="80")}return{scheme:s,hostname:et,port:tt}}function tupleForHostname(o,s){if(!(o==null||o==="")){if(isIPv4(o))return["ip4",o];if(isIPv6(o))return["ip6",o];if(o[0]==="["){const a=o.substring(1,o.length-1);if(isIPv6(a))return["ip6",a]}return[s,o]}}function tupleForPort(o,s){if(!(o==null||o===""))return s==="udp"?["udp",o]:["tcp",o]}function tupleForScheme(o){if(o.match(/^tcp$|^udp$/)==null)return[o]}function portForProtocol(o){if(!(o==null||o===""||portFor[o]==null))return portFor[o]}function toString$8(o,s="utf8"){const a=BASES$f[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.encoder.encode(o).substring(1)}const DEFAULT_TRUSTLESS_GATEWAYS=["https://trustless-gateway.link","https://4everland.io"],TRANSPORT_IPFS_GATEWAY_HTTP_CODE=2336,inspect=Symbol.for("nodejs.util.inspect.custom");class URLPeerId{type="url";multihash;privateKey;publicKey;url;constructor(s){this.url=s.toString(),this.multihash=identity$1.digest(fromString$h(this.url))}[inspect](){return`PeerId(${this.url})`}[peerIdSymbol]=!0;toString(){return this.toCID().toString()}toCID(){return CID.createV1(TRANSPORT_IPFS_GATEWAY_HTTP_CODE,this.multihash)}toBytes(){return this.toCID().bytes}equals(s){return s==null?!1:(s instanceof Uint8Array&&(s=toString$8(s)),s.toString()===this.toString())}}function toPeerInfo(o){return o=o.toString(),{id:new URLPeerId(new URL(o)),multiaddrs:[uriToMultiaddr(o)]}}class HTTPGatwayRouter{gateways;constructor(s={}){this.gateways=(s.gateways??DEFAULT_TRUSTLESS_GATEWAYS).map(a=>toPeerInfo(a))}async*findProviders(s,a){yield*this.gateways.toSorted(()=>Math.random()>.5?1:-1).map(et=>({...et,protocols:["transport-ipfs-gateway-http"]}))}}function httpGatewayRouting(o={}){return new HTTPGatwayRouter(o)}class Libp2pRouter{libp2p;constructor(s){this.libp2p=s}async provide(s,a){await this.libp2p.contentRouting.provide(s,a)}async*findProviders(s,a){yield*this.libp2p.contentRouting.findProviders(s,a)}async put(s,a,et){await this.libp2p.contentRouting.put(s,a,et)}async get(s,a){return this.libp2p.contentRouting.get(s,a)}async findPeer(s,a){return this.libp2p.peerRouting.findPeer(s,a)}async*getClosestPeers(s,a){yield*this.libp2p.peerRouting.getClosestPeers(s,a)}}function libp2pRouting(o){return new Libp2pRouter(o)}function notFoundError(o){return o=o??new Error("Not Found"),errCode$1(o,"ERR_NOT_FOUND")}const SHARDING_FN="SHARDING";function isAsyncIterable$7(o){return o[Symbol.asyncIterator]!=null}function all$3(o){if(isAsyncIterable$7(o))return(async()=>{const a=[];for await(const et of o)a.push(et);return a})();const s=[];for(const a of o)s.push(a);return s}function isAsyncIterable$6(o){return o[Symbol.asyncIterator]!=null}function sort(o,s){return isAsyncIterable$6(o)?async function*(){yield*(await all$3(o)).sort(s)}():function*(){yield*all$3(o).sort(s)}()}class BaseDatastore{put(s,a,et){return Promise.reject(new Error(".put is not implemented"))}get(s,a){return Promise.reject(new Error(".get is not implemented"))}has(s,a){return Promise.reject(new Error(".has is not implemented"))}delete(s,a){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(s,a={}){for await(const{key:et,value:tt}of s)await this.put(et,tt,a),yield et}async*getMany(s,a={}){for await(const et of s)yield{key:et,value:await this.get(et,a)}}async*deleteMany(s,a={}){for await(const et of s)await this.delete(et,a),yield et}batch(){let s=[],a=[];return{put(et,tt){s.push({key:et,value:tt})},delete(et){a.push(et)},commit:async et=>{await drain(this.putMany(s,et)),s=[],await drain(this.deleteMany(a,et)),a=[]}}}async*_all(s,a){throw new Error("._all is not implemented")}async*_allKeys(s,a){throw new Error("._allKeys is not implemented")}query(s,a){let et=this._all(s,a);if(s.prefix!=null){const tt=s.prefix;et=filter(et,rt=>rt.key.toString().startsWith(tt))}if(Array.isArray(s.filters)&&(et=s.filters.reduce((tt,rt)=>filter(tt,rt),et)),Array.isArray(s.orders)&&(et=s.orders.reduce((tt,rt)=>sort(tt,rt),et)),s.offset!=null){let tt=0;const rt=s.offset;et=filter(et,()=>tt++>=rt)}return s.limit!=null&&(et=take(et,s.limit)),et}queryKeys(s,a){let et=this._allKeys(s,a);if(s.prefix!=null){const tt=s.prefix;et=filter(et,rt=>rt.toString().startsWith(tt))}if(Array.isArray(s.filters)&&(et=s.filters.reduce((tt,rt)=>filter(tt,rt),et)),Array.isArray(s.orders)&&(et=s.orders.reduce((tt,rt)=>sort(tt,rt),et)),s.offset!=null){const tt=s.offset;let rt=0;et=filter(et,()=>rt++>=tt)}return s.limit!=null&&(et=take(et,s.limit)),et}}class MemoryDatastore extends BaseDatastore{data;constructor(){super(),this.data=new Map}put(s,a){return this.data.set(s.toString(),a),s}get(s){const a=this.data.get(s.toString());if(a==null)throw notFoundError();return a}has(s){return this.data.has(s.toString())}delete(s){this.data.delete(s.toString())}*_all(){for(const[s,a]of this.data.entries())yield{key:new Key(s),value:a}}*_allKeys(){for(const s of this.data.keys())yield new Key(s)}}new Key(SHARDING_FN);logger$1("datastore:core:tiered");class HeliaP2P extends Helia$1{libp2p;constructor(s){super({...s,components:{libp2p:s.libp2p}}),this.libp2p=s.libp2p}async start(){await super.start(),await this.libp2p.start()}async stop(){await super.stop(),await this.libp2p.stop()}}class QueuelessPushable{readNext;haveNext;ended;nextResult;constructor(){this.ended=!1,this.readNext=pDefer(),this.haveNext=pDefer()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const s=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=pDefer(),s}async throw(s){return this.ended=!0,s!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(s)),{done:!0,value:void 0}}async return(){const s={done:!0,value:void 0};return await this._push(void 0),s}async push(s,a){await this._push(s,a)}async end(s,a){s!=null?await this.throw(s):await this._push(void 0,a)}async _push(s,a){if(s!=null&&this.ended)throw new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;s!=null?this.nextResult={done:!1,value:s}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=pDefer(),await raceSignal(this.readNext.promise,a?.signal,a)}}function queuelessPushable(){return new QueuelessPushable}let CodeError$1=class extends Error{code;constructor(s,a){super(s),this.code=a}};class AbortError extends CodeError$1{type;constructor(s){super(s,"ABORT_ERR"),this.type="aborted"}}function byteStream(o,s){const a=queuelessPushable();o.sink(a).catch(async nt=>{await a.end(nt)}),o.sink=async nt=>{for await(const it of nt)await a.push(it);await a.end()};let et=o.source;o.source[Symbol.iterator]!=null?et=o.source[Symbol.iterator]():o.source[Symbol.asyncIterator]!=null&&(et=o.source[Symbol.asyncIterator]());const tt=new Uint8ArrayList;return{read:async(nt,it)=>{it?.signal?.throwIfAborted();let st;const ot=new Promise((at,lt)=>{st=()=>{lt(new AbortError("Read aborted"))},it?.signal?.addEventListener("abort",st)});try{if(nt==null){const{done:lt,value:ct}=await Promise.race([et.next(),ot]);return lt===!0?new Uint8ArrayList:ct}for(;tt.byteLength<nt;){const{value:lt,done:ct}=await Promise.race([et.next(),ot]);if(ct===!0)throw new CodeError$1("unexpected end of input","ERR_UNEXPECTED_EOF");tt.append(lt)}const at=tt.sublist(0,nt);return tt.consume(nt),at}finally{st!=null&&it?.signal?.removeEventListener("abort",st)}},write:async(nt,it)=>{it?.signal?.throwIfAborted(),nt instanceof Uint8Array?await a.push(nt,it):await a.push(nt.subarray(),it)},unwrap:()=>{if(tt.byteLength>0){const nt=o.source;o.source=async function*(){s?.yieldBytes===!1?yield tt:yield*tt,yield*nt}()}return o}}}class CodeError extends Error{code;constructor(s,a){super(s),this.code=a}}function lpStream(o,s={}){const a=byteStream(o,s);s.maxDataLength!=null&&s.maxLengthLength==null&&(s.maxLengthLength=encodingLength$1(s.maxDataLength));const et=s?.lengthDecoder??decode$g,tt=s?.lengthEncoder??encode$c;return{read:async nt=>{let it=-1;const st=new Uint8ArrayList;for(;;){st.append(await a.read(1,nt));try{it=et(st)}catch(ot){if(ot instanceof RangeError)continue;throw ot}if(s?.maxLengthLength!=null&&st.byteLength>s.maxLengthLength)throw new CodeError("message length length too long","ERR_MSG_LENGTH_TOO_LONG");if(it>-1)break}if(s?.maxDataLength!=null&&it>s.maxDataLength)throw new CodeError("message length too long","ERR_MSG_DATA_TOO_LONG");return a.read(it,nt)},write:async(nt,it)=>{await a.write(new Uint8ArrayList(tt(nt.byteLength),nt),it)},writeV:async(nt,it)=>{const st=new Uint8ArrayList(...nt.flatMap(ot=>[tt(ot.byteLength),ot]));await a.write(st,it)},unwrap:()=>a.unwrap()}}function pair(){const o=pDefer();let s=!1;return{sink:async a=>{if(s)throw new Error("already piped");s=!0,o.resolve(a)},source:async function*(){yield*await o.promise}()}}function duplexPair(){const o=pair(),s=pair();return[{source:o.source,sink:s.sink},{source:s.source,sink:o.sink}]}function alloc$5(o=0){return new Uint8Array(o)}function allocUnsafe$e(o=0){return new Uint8Array(o)}const NOISE_MSG_MAX_LENGTH_BYTES=65535,NOISE_MSG_MAX_LENGTH_BYTES_WITHOUT_TAG=NOISE_MSG_MAX_LENGTH_BYTES-16,DUMP_SESSION_KEYS=!!globalThis.process?.env?.DUMP_SESSION_KEYS;/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const u32=o=>new Uint32Array(o.buffer,o.byteOffset,Math.floor(o.byteLength/4));function isBytes$1(o){return o instanceof Uint8Array||o!=null&&typeof o=="object"&&o.constructor.name==="Uint8Array"}const createView=o=>new DataView(o.buffer,o.byteOffset,o.byteLength),isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE)throw new Error("Non little-endian hardware is not supported");function utf8ToBytes(o){if(typeof o!="string")throw new Error(`utf8ToBytes expected string, got ${typeof o}`);return new Uint8Array(new TextEncoder().encode(o))}function toBytes(o){if(typeof o=="string")o=utf8ToBytes(o);else if(isBytes$1(o))o=o.slice();else throw new Error(`expected Uint8Array, got ${typeof o}`);return o}const isPlainObject$1=o=>Object.prototype.toString.call(o)==="[object Object]"&&o.constructor===Object;function checkOpts(o,s){if(s!==void 0&&(typeof s!="object"||!isPlainObject$1(s)))throw new Error("options must be object or undefined");return Object.assign(o,s)}function ensureBytes(o,s){if(!isBytes$1(o))throw new Error("Uint8Array expected");if(typeof s=="number"&&o.length!==s)throw new Error(`Uint8Array length ${s} expected`)}function equalBytes(o,s){if(o.length!==s.length)return!1;let a=0;for(let et=0;et<o.length;et++)a|=o[et]^s[et];return a===0}const wrapCipher=(o,s)=>(Object.assign(s,o),s);function setBigUint64(o,s,a,et){if(typeof o.setBigUint64=="function")return o.setBigUint64(s,a,et);const tt=BigInt(32),rt=BigInt(4294967295),nt=Number(a>>tt&rt),it=Number(a&rt),st=4,ot=0;o.setUint32(s+st,nt,et),o.setUint32(s+ot,it,et)}function number(o){if(!Number.isSafeInteger(o)||o<0)throw new Error(`wrong positive integer: ${o}`)}function bool(o){if(typeof o!="boolean")throw new Error(`boolean expected, not ${o}`)}function isBytes(o){return o!=null&&typeof o=="object"&&(o instanceof Uint8Array||o.constructor.name==="Uint8Array")}function bytes(o,...s){if(!isBytes(o))throw new Error("Uint8Array expected");if(s.length>0&&!s.includes(o.length))throw new Error(`Uint8Array expected of length ${s}, not of length=${o.length}`)}function exists$1(o,s=!0){if(o.destroyed)throw new Error("Hash instance has been destroyed");if(s&&o.finished)throw new Error("Hash#digest() has already been called")}function output(o,s){bytes(o);const a=s.outputLen;if(o.length<a)throw new Error(`digestInto() expects output buffer of length at least ${a}`)}const u8to16=(o,s)=>o[s++]&255|(o[s++]&255)<<8;class Poly1305{constructor(s){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,s=toBytes(s),ensureBytes(s,32);const a=u8to16(s,0),et=u8to16(s,2),tt=u8to16(s,4),rt=u8to16(s,6),nt=u8to16(s,8),it=u8to16(s,10),st=u8to16(s,12),ot=u8to16(s,14);this.r[0]=a&8191,this.r[1]=(a>>>13|et<<3)&8191,this.r[2]=(et>>>10|tt<<6)&7939,this.r[3]=(tt>>>7|rt<<9)&8191,this.r[4]=(rt>>>4|nt<<12)&255,this.r[5]=nt>>>1&8190,this.r[6]=(nt>>>14|it<<2)&8191,this.r[7]=(it>>>11|st<<5)&8065,this.r[8]=(st>>>8|ot<<8)&8191,this.r[9]=ot>>>5&127;for(let at=0;at<8;at++)this.pad[at]=u8to16(s,16+2*at)}process(s,a,et=!1){const tt=et?0:2048,{h:rt,r:nt}=this,it=nt[0],st=nt[1],ot=nt[2],at=nt[3],lt=nt[4],ct=nt[5],ht=nt[6],ft=nt[7],dt=nt[8],pt=nt[9],gt=u8to16(s,a+0),mt=u8to16(s,a+2),yt=u8to16(s,a+4),vt=u8to16(s,a+6),Et=u8to16(s,a+8),xt=u8to16(s,a+10),wt=u8to16(s,a+12),Rt=u8to16(s,a+14);let Ct=rt[0]+(gt&8191),Ft=rt[1]+((gt>>>13|mt<<3)&8191),zt=rt[2]+((mt>>>10|yt<<6)&8191),Nt=rt[3]+((yt>>>7|vt<<9)&8191),Kt=rt[4]+((vt>>>4|Et<<12)&8191),Yt=rt[5]+(Et>>>1&8191),Bt=rt[6]+((Et>>>14|xt<<2)&8191),Pt=rt[7]+((xt>>>11|wt<<5)&8191),Dt=rt[8]+((wt>>>8|Rt<<8)&8191),Tt=rt[9]+(Rt>>>5|tt),St=0,Mt=St+Ct*it+Ft*(5*pt)+zt*(5*dt)+Nt*(5*ft)+Kt*(5*ht);St=Mt>>>13,Mt&=8191,Mt+=Yt*(5*ct)+Bt*(5*lt)+Pt*(5*at)+Dt*(5*ot)+Tt*(5*st),St+=Mt>>>13,Mt&=8191;let jt=St+Ct*st+Ft*it+zt*(5*pt)+Nt*(5*dt)+Kt*(5*ft);St=jt>>>13,jt&=8191,jt+=Yt*(5*ht)+Bt*(5*ct)+Pt*(5*lt)+Dt*(5*at)+Tt*(5*ot),St+=jt>>>13,jt&=8191;let Gt=St+Ct*ot+Ft*st+zt*it+Nt*(5*pt)+Kt*(5*dt);St=Gt>>>13,Gt&=8191,Gt+=Yt*(5*ft)+Bt*(5*ht)+Pt*(5*ct)+Dt*(5*lt)+Tt*(5*at),St+=Gt>>>13,Gt&=8191;let Ht=St+Ct*at+Ft*ot+zt*st+Nt*it+Kt*(5*pt);St=Ht>>>13,Ht&=8191,Ht+=Yt*(5*dt)+Bt*(5*ft)+Pt*(5*ht)+Dt*(5*ct)+Tt*(5*lt),St+=Ht>>>13,Ht&=8191;let At=St+Ct*lt+Ft*at+zt*ot+Nt*st+Kt*it;St=At>>>13,At&=8191,At+=Yt*(5*pt)+Bt*(5*dt)+Pt*(5*ft)+Dt*(5*ht)+Tt*(5*ct),St+=At>>>13,At&=8191;let $t=St+Ct*ct+Ft*lt+zt*at+Nt*ot+Kt*st;St=$t>>>13,$t&=8191,$t+=Yt*it+Bt*(5*pt)+Pt*(5*dt)+Dt*(5*ft)+Tt*(5*ht),St+=$t>>>13,$t&=8191;let kt=St+Ct*ht+Ft*ct+zt*lt+Nt*at+Kt*ot;St=kt>>>13,kt&=8191,kt+=Yt*st+Bt*it+Pt*(5*pt)+Dt*(5*dt)+Tt*(5*ft),St+=kt>>>13,kt&=8191;let Lt=St+Ct*ft+Ft*ht+zt*ct+Nt*lt+Kt*at;St=Lt>>>13,Lt&=8191,Lt+=Yt*ot+Bt*st+Pt*it+Dt*(5*pt)+Tt*(5*dt),St+=Lt>>>13,Lt&=8191;let bt=St+Ct*dt+Ft*ft+zt*ht+Nt*ct+Kt*lt;St=bt>>>13,bt&=8191,bt+=Yt*at+Bt*ot+Pt*st+Dt*it+Tt*(5*pt),St+=bt>>>13,bt&=8191;let It=St+Ct*pt+Ft*dt+zt*ft+Nt*ht+Kt*ct;St=It>>>13,It&=8191,It+=Yt*lt+Bt*at+Pt*ot+Dt*st+Tt*it,St+=It>>>13,It&=8191,St=(St<<2)+St|0,St=St+Mt|0,Mt=St&8191,St=St>>>13,jt+=St,rt[0]=Mt,rt[1]=jt,rt[2]=Gt,rt[3]=Ht,rt[4]=At,rt[5]=$t,rt[6]=kt,rt[7]=Lt,rt[8]=bt,rt[9]=It}finalize(){const{h:s,pad:a}=this,et=new Uint16Array(10);let tt=s[1]>>>13;s[1]&=8191;for(let it=2;it<10;it++)s[it]+=tt,tt=s[it]>>>13,s[it]&=8191;s[0]+=tt*5,tt=s[0]>>>13,s[0]&=8191,s[1]+=tt,tt=s[1]>>>13,s[1]&=8191,s[2]+=tt,et[0]=s[0]+5,tt=et[0]>>>13,et[0]&=8191;for(let it=1;it<10;it++)et[it]=s[it]+tt,tt=et[it]>>>13,et[it]&=8191;et[9]-=8192;let rt=(tt^1)-1;for(let it=0;it<10;it++)et[it]&=rt;rt=~rt;for(let it=0;it<10;it++)s[it]=s[it]&rt|et[it];s[0]=(s[0]|s[1]<<13)&65535,s[1]=(s[1]>>>3|s[2]<<10)&65535,s[2]=(s[2]>>>6|s[3]<<7)&65535,s[3]=(s[3]>>>9|s[4]<<4)&65535,s[4]=(s[4]>>>12|s[5]<<1|s[6]<<14)&65535,s[5]=(s[6]>>>2|s[7]<<11)&65535,s[6]=(s[7]>>>5|s[8]<<8)&65535,s[7]=(s[8]>>>8|s[9]<<5)&65535;let nt=s[0]+a[0];s[0]=nt&65535;for(let it=1;it<8;it++)nt=(s[it]+a[it]|0)+(nt>>>16)|0,s[it]=nt&65535}update(s){exists$1(this);const{buffer:a,blockLen:et}=this;s=toBytes(s);const tt=s.length;for(let rt=0;rt<tt;){const nt=Math.min(et-this.pos,tt-rt);if(nt===et){for(;et<=tt-rt;rt+=et)this.process(s,rt);continue}a.set(s.subarray(rt,rt+nt),this.pos),this.pos+=nt,rt+=nt,this.pos===et&&(this.process(a,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(s){exists$1(this),output(s,this),this.finished=!0;const{buffer:a,h:et}=this;let{pos:tt}=this;if(tt){for(a[tt++]=1;tt<16;tt++)a[tt]=0;this.process(a,0,!0)}this.finalize();let rt=0;for(let nt=0;nt<8;nt++)s[rt++]=et[nt]>>>0,s[rt++]=et[nt]>>>8;return s}digest(){const{buffer:s,outputLen:a}=this;this.digestInto(s);const et=s.slice(0,a);return this.destroy(),et}}function wrapConstructorWithKey(o){const s=(et,tt)=>o(tt).update(toBytes(et)).digest(),a=o(new Uint8Array(32));return s.outputLen=a.outputLen,s.blockLen=a.blockLen,s.create=et=>o(et),s}const poly1305=wrapConstructorWithKey(o=>new Poly1305(o)),sigma16=utf8ToBytes("expand 16-byte k"),sigma32=utf8ToBytes("expand 32-byte k"),sigma16_32=u32(sigma16),sigma32_32=u32(sigma32);function rotl(o,s){return o<<s|o>>>32-s}function isAligned32(o){return o.byteOffset%4===0}const BLOCK_LEN=64,BLOCK_LEN32=16,MAX_COUNTER=2**32-1,U32_EMPTY=new Uint32Array;function runCipher(o,s,a,et,tt,rt,nt,it){const st=tt.length,ot=new Uint8Array(BLOCK_LEN),at=u32(ot),lt=isAligned32(tt)&&isAligned32(rt),ct=lt?u32(tt):U32_EMPTY,ht=lt?u32(rt):U32_EMPTY;for(let ft=0;ft<st;nt++){if(o(s,a,et,at,nt,it),nt>=MAX_COUNTER)throw new Error("arx: counter overflow");const dt=Math.min(BLOCK_LEN,st-ft);if(lt&&dt===BLOCK_LEN){const pt=ft/4;if(ft%4!==0)throw new Error("arx: invalid block position");for(let gt=0,mt;gt<BLOCK_LEN32;gt++)mt=pt+gt,ht[mt]=ct[mt]^at[gt];ft+=BLOCK_LEN;continue}for(let pt=0,gt;pt<dt;pt++)gt=ft+pt,rt[gt]=tt[gt]^ot[pt];ft+=dt}}function createCipher(o,s){const{allowShortKeys:a,extendNonceFn:et,counterLength:tt,counterRight:rt,rounds:nt}=checkOpts({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},s);if(typeof o!="function")throw new Error("core must be a function");return number(tt),number(nt),bool(rt),bool(a),(it,st,ot,at,lt=0)=>{bytes(it),bytes(st),bytes(ot);const ct=ot.length;if(at||(at=new Uint8Array(ct)),bytes(at),number(lt),lt<0||lt>=MAX_COUNTER)throw new Error("arx: counter overflow");if(at.length<ct)throw new Error(`arx: output (${at.length}) is shorter than data (${ct})`);const ht=[];let ft=it.length,dt,pt;if(ft===32)dt=it.slice(),ht.push(dt),pt=sigma32_32;else if(ft===16&&a)dt=new Uint8Array(32),dt.set(it),dt.set(it,16),pt=sigma16_32,ht.push(dt);else throw new Error(`arx: invalid 32-byte key, got length=${ft}`);isAligned32(st)||(st=st.slice(),ht.push(st));const gt=u32(dt);if(et){if(st.length!==24)throw new Error("arx: extended nonce must be 24 bytes");et(pt,gt,u32(st.subarray(0,16)),gt),st=st.subarray(16)}const mt=16-tt;if(mt!==st.length)throw new Error(`arx: nonce must be ${mt} or 16 bytes`);if(mt!==12){const vt=new Uint8Array(12);vt.set(st,rt?0:12-st.length),st=vt,ht.push(st)}const yt=u32(st);for(runCipher(o,pt,gt,yt,ot,at,lt,nt);ht.length>0;)ht.pop().fill(0);return at}}function chachaCore(o,s,a,et,tt,rt=20){let nt=o[0],it=o[1],st=o[2],ot=o[3],at=s[0],lt=s[1],ct=s[2],ht=s[3],ft=s[4],dt=s[5],pt=s[6],gt=s[7],mt=tt,yt=a[0],vt=a[1],Et=a[2],xt=nt,wt=it,Rt=st,Ct=ot,Ft=at,zt=lt,Nt=ct,Kt=ht,Yt=ft,Bt=dt,Pt=pt,Dt=gt,Tt=mt,St=yt,Mt=vt,jt=Et;for(let Ht=0;Ht<rt;Ht+=2)xt=xt+Ft|0,Tt=rotl(Tt^xt,16),Yt=Yt+Tt|0,Ft=rotl(Ft^Yt,12),xt=xt+Ft|0,Tt=rotl(Tt^xt,8),Yt=Yt+Tt|0,Ft=rotl(Ft^Yt,7),wt=wt+zt|0,St=rotl(St^wt,16),Bt=Bt+St|0,zt=rotl(zt^Bt,12),wt=wt+zt|0,St=rotl(St^wt,8),Bt=Bt+St|0,zt=rotl(zt^Bt,7),Rt=Rt+Nt|0,Mt=rotl(Mt^Rt,16),Pt=Pt+Mt|0,Nt=rotl(Nt^Pt,12),Rt=Rt+Nt|0,Mt=rotl(Mt^Rt,8),Pt=Pt+Mt|0,Nt=rotl(Nt^Pt,7),Ct=Ct+Kt|0,jt=rotl(jt^Ct,16),Dt=Dt+jt|0,Kt=rotl(Kt^Dt,12),Ct=Ct+Kt|0,jt=rotl(jt^Ct,8),Dt=Dt+jt|0,Kt=rotl(Kt^Dt,7),xt=xt+zt|0,jt=rotl(jt^xt,16),Pt=Pt+jt|0,zt=rotl(zt^Pt,12),xt=xt+zt|0,jt=rotl(jt^xt,8),Pt=Pt+jt|0,zt=rotl(zt^Pt,7),wt=wt+Nt|0,Tt=rotl(Tt^wt,16),Dt=Dt+Tt|0,Nt=rotl(Nt^Dt,12),wt=wt+Nt|0,Tt=rotl(Tt^wt,8),Dt=Dt+Tt|0,Nt=rotl(Nt^Dt,7),Rt=Rt+Kt|0,St=rotl(St^Rt,16),Yt=Yt+St|0,Kt=rotl(Kt^Yt,12),Rt=Rt+Kt|0,St=rotl(St^Rt,8),Yt=Yt+St|0,Kt=rotl(Kt^Yt,7),Ct=Ct+Ft|0,Mt=rotl(Mt^Ct,16),Bt=Bt+Mt|0,Ft=rotl(Ft^Bt,12),Ct=Ct+Ft|0,Mt=rotl(Mt^Ct,8),Bt=Bt+Mt|0,Ft=rotl(Ft^Bt,7);let Gt=0;et[Gt++]=nt+xt|0,et[Gt++]=it+wt|0,et[Gt++]=st+Rt|0,et[Gt++]=ot+Ct|0,et[Gt++]=at+Ft|0,et[Gt++]=lt+zt|0,et[Gt++]=ct+Nt|0,et[Gt++]=ht+Kt|0,et[Gt++]=ft+Yt|0,et[Gt++]=dt+Bt|0,et[Gt++]=pt+Pt|0,et[Gt++]=gt+Dt|0,et[Gt++]=mt+Tt|0,et[Gt++]=yt+St|0,et[Gt++]=vt+Mt|0,et[Gt++]=Et+jt|0}const chacha20=createCipher(chachaCore,{counterRight:!1,counterLength:4,allowShortKeys:!1}),ZEROS16=new Uint8Array(16),updatePadded=(o,s)=>{o.update(s);const a=s.length%16;a&&o.update(ZEROS16.subarray(a))},ZEROS32=new Uint8Array(32);function computeTag(o,s,a,et,tt){const rt=o(s,a,ZEROS32),nt=poly1305.create(rt);tt&&updatePadded(nt,tt),updatePadded(nt,et);const it=new Uint8Array(16),st=createView(it);setBigUint64(st,0,BigInt(tt?tt.length:0),!0),setBigUint64(st,8,BigInt(et.length),!0),nt.update(it);const ot=nt.digest();return rt.fill(0),ot}const _poly1305_aead=o=>(s,a,et)=>(ensureBytes(s,32),ensureBytes(a),{encrypt:(rt,nt)=>{const it=rt.length,st=it+16;nt?ensureBytes(nt,st):nt=new Uint8Array(st),o(s,a,rt,nt,1);const ot=computeTag(o,s,a,nt.subarray(0,-16),et);return nt.set(ot,it),nt},decrypt:(rt,nt)=>{const it=rt.length,st=it-16;if(it<16)throw new Error("encrypted data must be at least 16 bytes");nt?ensureBytes(nt,st):nt=new Uint8Array(st);const ot=rt.subarray(0,-16),at=rt.subarray(-16),lt=computeTag(o,s,a,ot,et);if(!equalBytes(at,lt))throw new Error("invalid tag");return o(s,a,ot,nt,1),nt}}),chacha20poly1305=wrapCipher({blockSize:64,nonceLength:12,tagLength:16},_poly1305_aead(chacha20));function extract(o,s,a){return hash$2(o),a===void 0&&(a=new Uint8Array(o.outputLen)),hmac(o,toBytes$2(a),toBytes$2(s))}const HKDF_COUNTER=new Uint8Array([0]),EMPTY_BUFFER=new Uint8Array;function expand(o,s,a,et=32){if(hash$2(o),number$2(et),et>255*o.outputLen)throw new Error("Length should be <= 255*HashLen");const tt=Math.ceil(et/o.outputLen);a===void 0&&(a=EMPTY_BUFFER);const rt=new Uint8Array(tt*o.outputLen),nt=hmac.create(o,s),it=nt._cloneInto(),st=new Uint8Array(nt.outputLen);for(let ot=0;ot<tt;ot++)HKDF_COUNTER[0]=ot+1,it.update(ot===0?EMPTY_BUFFER:st).update(a).update(HKDF_COUNTER).digestInto(st),rt.set(st,o.outputLen*ot),nt._cloneInto(it);return nt.destroy(),it.destroy(),st.fill(0),HKDF_COUNTER.fill(0),rt.slice(0,et)}const pureJsCrypto={hashSHA256(o){return sha256(o.subarray())},getHKDF(o,s){const a=extract(sha256,s,o),tt=expand(sha256,a,void 0,96),rt=tt.subarray(0,32),nt=tt.subarray(32,64),it=tt.subarray(64,96);return[rt,nt,it]},generateX25519KeyPair(){const o=x25519.utils.randomPrivateKey();return{publicKey:x25519.getPublicKey(o),privateKey:o}},generateX25519KeyPairFromSeed(o){return{publicKey:x25519.getPublicKey(o),privateKey:o}},generateX25519SharedKey(o,s){return x25519.getSharedSecret(o.subarray(),s.subarray())},chaCha20Poly1305Encrypt(o,s,a,et){return chacha20poly1305(et,s,a).encrypt(o.subarray())},chaCha20Poly1305Decrypt(o,s,a,et,tt){return chacha20poly1305(et,s,a).decrypt(o.subarray(),tt)}},defaultCrypto=pureJsCrypto;function wrapCrypto(o){return{generateKeypair:o.generateX25519KeyPair,dh:(s,a)=>o.generateX25519SharedKey(s.privateKey,a).subarray(0,32),encrypt:o.chaCha20Poly1305Encrypt,decrypt:o.chaCha20Poly1305Decrypt,hash:o.hashSHA256,hkdf:o.getHKDF}}const uint16BEEncode=o=>{const s=allocUnsafe$e(2);return s[0]=o>>8,s[1]=o,s};uint16BEEncode.bytes=2;const uint16BEDecode=o=>{if(o.length<2)throw RangeError("Could not decode int16BE");if(o instanceof Uint8Array){let s=0;return s+=o[0]<<8,s+=o[1],s}return o.getUint16(0)};uint16BEDecode.bytes=2;function registerMetrics(o){return{xxHandshakeSuccesses:o.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:o.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:o.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:o.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:o.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}function createCodec$e(o,s,a,et){return{name:o,prefix:s,encoder:{name:o,prefix:s,encode:a},decoder:{decode:et}}}const string$e=createCodec$e("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),ascii$e=createCodec$e("ascii","a",o=>{let s="a";for(let a=0;a<o.length;a++)s+=String.fromCharCode(o[a]);return s},o=>{o=o.substring(1);const s=allocUnsafe$e(o.length);for(let a=0;a<o.length;a++)s[a]=o.charCodeAt(a);return s}),BASES$e={utf8:string$e,"utf-8":string$e,hex:bases.base16,latin1:ascii$e,ascii:ascii$e,binary:ascii$e,...bases};function toString$7(o,s="utf8"){const a=BASES$e[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.encoder.encode(o).substring(1)}function logLocalStaticKeys(o,s){!s.enabled||!DUMP_SESSION_KEYS||(o?(s(`LOCAL_STATIC_PUBLIC_KEY ${toString$7(o.publicKey,"hex")}`),s(`LOCAL_STATIC_PRIVATE_KEY ${toString$7(o.privateKey,"hex")}`)):s("Missing local static keys."))}function logLocalEphemeralKeys(o,s){!s.enabled||!DUMP_SESSION_KEYS||(o?(s(`LOCAL_PUBLIC_EPHEMERAL_KEY ${toString$7(o.publicKey,"hex")}`),s(`LOCAL_PRIVATE_EPHEMERAL_KEY ${toString$7(o.privateKey,"hex")}`)):s("Missing local ephemeral keys."))}function logRemoteStaticKey(o,s){!s.enabled||!DUMP_SESSION_KEYS||s(o?`REMOTE_STATIC_PUBLIC_KEY ${toString$7(o.subarray(),"hex")}`:"Missing remote static public key.")}function logRemoteEphemeralKey(o,s){!s.enabled||!DUMP_SESSION_KEYS||s(o?`REMOTE_EPHEMERAL_PUBLIC_KEY ${toString$7(o.subarray(),"hex")}`:"Missing remote ephemeral keys.")}function logCipherState(o,s,a){!a.enabled||!DUMP_SESSION_KEYS||(a(`CIPHER_STATE_1 ${o.n.getUint64()} ${o.k&&toString$7(o.k,"hex")}`),a(`CIPHER_STATE_2 ${s.n.getUint64()} ${s.k&&toString$7(s.k,"hex")}`))}function equals$7(o,s){if(o===s)return!0;if(o.byteLength!==s.byteLength)return!1;for(let a=0;a<o.byteLength;a++)if(o[a]!==s[a])return!1;return!0}function asUint8Array$7(o){return o}function concat$7(o,s){s==null&&(s=o.reduce((tt,rt)=>tt+rt.length,0));const a=allocUnsafe$e(s);let et=0;for(const tt of o)a.set(tt,et),et+=tt.length;return a}function fromString$g(o,s="utf8"){const a=BASES$e[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.decoder.decode(`${a.prefix}${o}`)}class UnexpectedPeerError extends Error{code;constructor(s="Unexpected Peer"){super(s),this.code=UnexpectedPeerError.code}static code="ERR_UNEXPECTED_PEER"}class InvalidCryptoExchangeError extends Error{code;constructor(s="Invalid crypto exchange"){super(s),this.code=InvalidCryptoExchangeError.code}static code="ERR_INVALID_CRYPTO_EXCHANGE"}const MIN_NONCE=0,MAX_NONCE=4294967295,ERR_MAX_NONCE="Cipherstate has reached maximum n, a new handshake must be performed";class Nonce{n;bytes;view;constructor(s=MIN_NONCE){this.n=s,this.bytes=alloc$5(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,s,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>MAX_NONCE)throw new Error(ERR_MAX_NONCE)}}const ZEROLEN=alloc$5(0);class CipherState{k;n;crypto;constructor(s,a=void 0,et=0){this.crypto=s,this.k=a,this.n=new Nonce(et)}hasKey(){return!!this.k}encryptWithAd(s,a){if(!this.hasKey())return a;this.n.assertValue();const et=this.crypto.encrypt(a,this.n.getBytes(),s,this.k);return this.n.increment(),et}decryptWithAd(s,a,et){if(!this.hasKey())return a;this.n.assertValue();const tt=this.crypto.decrypt(a,this.n.getBytes(),s,this.k,et);return this.n.increment(),tt}}class SymmetricState{cs;ck;h;crypto;constructor(s,a){this.crypto=s;const et=fromString$g(a,"utf-8");this.h=hashProtocolName(s,et),this.ck=this.h,this.cs=new CipherState(s)}mixKey(s){const[a,et]=this.crypto.hkdf(this.ck,s);this.ck=a,this.cs=new CipherState(this.crypto,et)}mixHash(s){this.h=this.crypto.hash(new Uint8ArrayList(this.h,s))}encryptAndHash(s){const a=this.cs.encryptWithAd(this.h,s);return this.mixHash(a),a}decryptAndHash(s){const a=this.cs.decryptWithAd(this.h,s);return this.mixHash(s),a}split(){const[s,a]=this.crypto.hkdf(this.ck,ZEROLEN);return[new CipherState(this.crypto,s),new CipherState(this.crypto,a)]}}class AbstractHandshakeState{ss;s;e;rs;re;initiator;crypto;constructor(s){const{crypto:a,protocolName:et,prologue:tt,initiator:rt,s:nt,e:it,rs:st,re:ot}=s;this.crypto=a,this.ss=new SymmetricState(a,et),this.ss.mixHash(tt),this.initiator=rt,this.s=nt,this.e=it,this.rs=st,this.re=ot}writeE(){if(this.e)throw new Error("ephemeral keypair is already set");const s=this.crypto.generateKeypair();return this.ss.mixHash(s.publicKey),this.e=s,s.publicKey}writeS(){if(!this.s)throw new Error("static keypair is not set");return this.ss.encryptAndHash(this.s.publicKey)}writeEE(){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.re))}writeES(){if(this.initiator){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}else{if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}}writeSE(){if(this.initiator){if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}else{if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}}readE(s,a=0){if(this.re)throw new Error("remote ephemeral public key is already set");if(s.byteLength<a+32)throw new Error("message is not long enough");this.re=s.sublist(a,a+32),this.ss.mixHash(this.re)}readS(s,a=0){if(this.rs)throw new Error("remote static public key is already set");const et=32+(this.ss.cs.hasKey()?16:0);if(s.byteLength<a+et)throw new Error("message is not long enough");const tt=s.sublist(a,a+et);return this.rs=this.ss.decryptAndHash(tt),et}readEE(){this.writeEE()}readES(){this.writeES()}readSE(){this.writeSE()}}class XXHandshakeState extends AbstractHandshakeState{writeMessageA(s){return new Uint8ArrayList(this.writeE(),this.ss.encryptAndHash(s))}writeMessageB(s){const a=this.writeE();this.writeEE();const et=this.writeS();return this.writeES(),new Uint8ArrayList(a,et,this.ss.encryptAndHash(s))}writeMessageC(s){const a=this.writeS();return this.writeSE(),new Uint8ArrayList(a,this.ss.encryptAndHash(s))}readMessageA(s){try{return this.readE(s),this.ss.decryptAndHash(s.sublist(32))}catch(a){throw new InvalidCryptoExchangeError(`handshake stage 0 validation fail: ${a.message}`)}}readMessageB(s){try{this.readE(s),this.readEE();const a=this.readS(s,32);return this.readES(),this.ss.decryptAndHash(s.sublist(32+a))}catch(a){throw new InvalidCryptoExchangeError(`handshake stage 1 validation fail: ${a.message}`)}}readMessageC(s){try{const a=this.readS(s);return this.readSE(),this.ss.decryptAndHash(s.sublist(a))}catch(a){throw new InvalidCryptoExchangeError(`handshake stage 2 validation fail: ${a.message}`)}}}function hashProtocolName(o,s){if(s.length<=32){const a=alloc$5(32);return a.set(s),a}else return o.hash(s)}var NoiseExtensions;(function(o){let s;o.codec=()=>(s==null&&(s=message((a,et,tt={})=>{if(tt.lengthDelimited!==!1&&et.fork(),a.webtransportCerthashes!=null)for(const rt of a.webtransportCerthashes)et.uint32(10),et.bytes(rt);tt.lengthDelimited!==!1&&et.ldelim()},(a,et)=>{const tt={webtransportCerthashes:[]},rt=et==null?a.len:a.pos+et;for(;a.pos<rt;){const nt=a.uint32();switch(nt>>>3){case 1:{tt.webtransportCerthashes.push(a.bytes());break}default:{a.skipType(nt&7);break}}}return tt})),s),o.encode=a=>encodeMessage(a,o.codec()),o.decode=a=>decodeMessage(a,o.codec())})(NoiseExtensions||(NoiseExtensions={}));var NoiseHandshakePayload;(function(o){let s;o.codec=()=>(s==null&&(s=message((a,et,tt={})=>{tt.lengthDelimited!==!1&&et.fork(),a.identityKey!=null&&a.identityKey.byteLength>0&&(et.uint32(10),et.bytes(a.identityKey)),a.identitySig!=null&&a.identitySig.byteLength>0&&(et.uint32(18),et.bytes(a.identitySig)),a.extensions!=null&&(et.uint32(34),NoiseExtensions.codec().encode(a.extensions,et)),tt.lengthDelimited!==!1&&et.ldelim()},(a,et)=>{const tt={identityKey:alloc$5(0),identitySig:alloc$5(0)},rt=et==null?a.len:a.pos+et;for(;a.pos<rt;){const nt=a.uint32();switch(nt>>>3){case 1:{tt.identityKey=a.bytes();break}case 2:{tt.identitySig=a.bytes();break}case 4:{tt.extensions=NoiseExtensions.codec().decode(a,a.uint32());break}default:{a.skipType(nt&7);break}}}return tt})),s),o.encode=a=>encodeMessage(a,o.codec()),o.decode=a=>decodeMessage(a,o.codec())})(NoiseHandshakePayload||(NoiseHandshakePayload={}));async function createHandshakePayload(o,s,a){const et=await o.sign(getSignaturePayload(s));return NoiseHandshakePayload.encode({identityKey:o.public.bytes,identitySig:et,extensions:a})}async function decodeHandshakePayload(o,s,a){try{const et=NoiseHandshakePayload.decode(o);if(a){const nt=a.subarray();if(!equals$7(nt,et.identityKey))throw new Error(`Payload identity key ${toString$7(et.identityKey,"hex")} does not match expected remote identity key ${toString$7(nt,"hex")}`)}if(!s)throw new Error("Remote static does not exist");const tt=getSignaturePayload(s);if(!await unmarshalPublicKey(et.identityKey).verify(tt,et.identitySig))throw new Error("Invalid payload signature");return et}catch(et){throw new UnexpectedPeerError(et.message)}}function getSignaturePayload(o){const s=fromString$g("noise-libp2p-static-key:");return o instanceof Uint8Array?concat$7([s,o],s.length+o.length):(o.prepend(s),o)}async function performHandshakeInitiator(o){const{log:s,connection:a,crypto:et,privateKey:tt,prologue:rt,s:nt,remoteIdentityKey:it,extensions:st}=o,ot=await createHandshakePayload(tt,nt.publicKey,st),at=new XXHandshakeState({crypto:et,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!0,prologue:rt,s:nt});logLocalStaticKeys(at.s,s),s.trace("Stage 0 - Initiator starting to send first message."),await a.write(at.writeMessageA(ZEROLEN)),s.trace("Stage 0 - Initiator finished sending first message."),logLocalEphemeralKeys(at.e,s),s.trace("Stage 1 - Initiator waiting to receive first message from responder...");const lt=at.readMessageB(await a.read());s.trace("Stage 1 - Initiator received the message."),logRemoteEphemeralKey(at.re,s),logRemoteStaticKey(at.rs,s),s.trace("Initiator going to check remote's signature...");const ct=await decodeHandshakePayload(lt,at.rs,it);s.trace("All good with the signature!"),s.trace("Stage 2 - Initiator sending third handshake message."),await a.write(at.writeMessageC(ot)),s.trace("Stage 2 - Initiator sent message with signed payload.");const[ht,ft]=at.ss.split();return logCipherState(ht,ft,s),{payload:ct,encrypt:dt=>ht.encryptWithAd(ZEROLEN,dt),decrypt:(dt,pt)=>ft.decryptWithAd(ZEROLEN,dt,pt)}}async function performHandshakeResponder(o){const{log:s,connection:a,crypto:et,privateKey:tt,prologue:rt,s:nt,remoteIdentityKey:it,extensions:st}=o,ot=await createHandshakePayload(tt,nt.publicKey,st),at=new XXHandshakeState({crypto:et,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!1,prologue:rt,s:nt});logLocalStaticKeys(at.s,s),s.trace("Stage 0 - Responder waiting to receive first message."),at.readMessageA(await a.read()),s.trace("Stage 0 - Responder received first message."),logRemoteEphemeralKey(at.re,s),s.trace("Stage 1 - Responder sending out first message with signed payload and static key."),await a.write(at.writeMessageB(ot)),s.trace("Stage 1 - Responder sent the second handshake message with signed payload."),logLocalEphemeralKeys(at.e,s),s.trace("Stage 2 - Responder waiting for third handshake message...");const lt=at.readMessageC(await a.read());s.trace("Stage 2 - Responder received the message, finished handshake.");const ct=await decodeHandshakePayload(lt,at.rs,it),[ht,ft]=at.ss.split();return logCipherState(ht,ft,s),{payload:ct,encrypt:dt=>ft.encryptWithAd(ZEROLEN,dt),decrypt:(dt,pt)=>ht.decryptWithAd(ZEROLEN,dt,pt)}}const CHACHA_TAG_LENGTH=16;function encryptStream(o,s){return async function*(a){for await(const et of a)for(let tt=0;tt<et.length;tt+=NOISE_MSG_MAX_LENGTH_BYTES_WITHOUT_TAG){let rt=tt+NOISE_MSG_MAX_LENGTH_BYTES_WITHOUT_TAG;rt>et.length&&(rt=et.length);let nt;et instanceof Uint8Array?nt=o.encrypt(et.subarray(tt,rt)):nt=o.encrypt(et.sublist(tt,rt)),s?.encryptedPackets.increment(),yield new Uint8ArrayList(uint16BEEncode(nt.byteLength),nt)}}}function decryptStream(o,s){return async function*(a){for await(const et of a)for(let tt=0;tt<et.length;tt+=NOISE_MSG_MAX_LENGTH_BYTES){let rt=tt+NOISE_MSG_MAX_LENGTH_BYTES;if(rt>et.length&&(rt=et.length),rt-CHACHA_TAG_LENGTH<tt)throw new Error("Invalid chunk");const nt=et.sublist(tt,rt),it=et.subarray(tt,rt-CHACHA_TAG_LENGTH);try{const st=o.decrypt(nt,it);s?.decryptedPackets.increment(),yield st}catch(st){throw s?.decryptErrors.increment(),st}}}}class Noise{protocol="/noise";crypto;prologue;staticKey;extensions;metrics;components;constructor(s,a={}){const{staticNoiseKey:et,extensions:tt,crypto:rt,prologueBytes:nt}=a,{metrics:it}=s;this.components=s;const st=rt??defaultCrypto;this.crypto=wrapCrypto(st),this.extensions=tt,this.metrics=it?registerMetrics(it):void 0,et?this.staticKey=st.generateX25519KeyPairFromSeed(et):this.staticKey=st.generateX25519KeyPair(),this.prologue=nt??alloc$5(0)}async secureOutbound(s,a,et){const tt=lpStream(a,{lengthEncoder:uint16BEEncode,lengthDecoder:uint16BEDecode,maxDataLength:NOISE_MSG_MAX_LENGTH_BYTES});if(!s.privateKey)throw new CodeError$3("local peerId does not contain private key","ERR_NO_PRIVATE_KEY");const rt=await unmarshalPrivateKey(s.privateKey),nt=et?.publicKey,it=await this.performHandshakeInitiator(tt,rt,nt),st=await this.createSecureConnection(tt,it);return a.source=st.source,a.sink=st.sink,{conn:a,remoteExtensions:it.payload.extensions,remotePeer:await peerIdFromKeys(it.payload.identityKey)}}async secureInbound(s,a,et){const tt=lpStream(a,{lengthEncoder:uint16BEEncode,lengthDecoder:uint16BEDecode,maxDataLength:NOISE_MSG_MAX_LENGTH_BYTES});if(!s.privateKey)throw new CodeError$3("local peerId does not contain private key","ERR_NO_PRIVATE_KEY");const rt=await unmarshalPrivateKey(s.privateKey),nt=et?.publicKey,it=await this.performHandshakeResponder(tt,rt,nt),st=await this.createSecureConnection(tt,it);return a.source=st.source,a.sink=st.sink,{conn:a,remoteExtensions:it.payload.extensions,remotePeer:await peerIdFromKeys(it.payload.identityKey)}}async performHandshakeInitiator(s,a,et){let tt;try{tt=await performHandshakeInitiator({connection:s,privateKey:a,remoteIdentityKey:et,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:this.extensions}),this.metrics?.xxHandshakeSuccesses.increment()}catch(rt){throw this.metrics?.xxHandshakeErrors.increment(),rt}return tt}async performHandshakeResponder(s,a,et){let tt;try{tt=await performHandshakeResponder({connection:s,privateKey:a,remoteIdentityKey:et,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:this.extensions}),this.metrics?.xxHandshakeSuccesses.increment()}catch(rt){throw this.metrics?.xxHandshakeErrors.increment(),rt}return tt}async createSecureConnection(s,a){const[et,tt]=duplexPair(),rt=s.unwrap();return await pipe(et,encryptStream(a,this.metrics),rt,nt=>decode$f(nt,{lengthDecoder:uint16BEDecode}),decryptStream(a,this.metrics),et),tt}}function noise(o={}){return s=>new Noise(s,o)}function getIterator(o){if(o!=null){if(typeof o[Symbol.iterator]=="function")return o[Symbol.iterator]();if(typeof o[Symbol.asyncIterator]=="function")return o[Symbol.asyncIterator]();if(typeof o.next=="function")return o}throw new Error("argument is not an iterator or iterable")}const ERR_INVALID_FRAME="ERR_INVALID_FRAME",ERR_UNREQUESTED_PING="ERR_UNREQUESTED_PING",ERR_NOT_MATCHING_PING="ERR_NOT_MATCHING_PING",ERR_STREAM_ALREADY_EXISTS="ERR_STREAM_ALREADY_EXISTS",ERR_DECODE_INVALID_VERSION="ERR_DECODE_INVALID_VERSION",ERR_BOTH_CLIENTS="ERR_BOTH_CLIENTS",ERR_RECV_WINDOW_EXCEEDED="ERR_RECV_WINDOW_EXCEEDED",PROTOCOL_ERRORS=new Set([ERR_INVALID_FRAME,ERR_UNREQUESTED_PING,ERR_NOT_MATCHING_PING,ERR_STREAM_ALREADY_EXISTS,ERR_DECODE_INVALID_VERSION,ERR_BOTH_CLIENTS,ERR_RECV_WINDOW_EXCEEDED]),ERR_INVALID_CONFIG="ERR_INVALID_CONFIG",ERR_MUXER_LOCAL_CLOSED="ERR_MUXER_LOCAL_CLOSED",ERR_MUXER_REMOTE_CLOSED="ERR_MUXER_REMOTE_CLOSED",ERR_STREAM_ABORT="ERR_STREAM_ABORT",ERR_MAX_OUTBOUND_STREAMS_EXCEEDED="ERROR_MAX_OUTBOUND_STREAMS_EXCEEDED",ERR_DECODE_IN_PROGRESS="ERR_DECODE_IN_PROGRESS",INITIAL_STREAM_WINDOW=256*1024,MAX_STREAM_WINDOW=16*1024*1024,defaultConfig={enableKeepAlive:!0,keepAliveInterval:3e4,maxInboundStreams:1e3,maxOutboundStreams:1e3,initialStreamWindowSize:INITIAL_STREAM_WINDOW,maxStreamWindowSize:MAX_STREAM_WINDOW,maxMessageSize:64*1024};function verifyConfig(o){if(o.keepAliveInterval<=0)throw new CodeError$3("keep-alive interval must be positive",ERR_INVALID_CONFIG);if(o.maxInboundStreams<0)throw new CodeError$3("max inbound streams must be larger or equal 0",ERR_INVALID_CONFIG);if(o.maxOutboundStreams<0)throw new CodeError$3("max outbound streams must be larger or equal 0",ERR_INVALID_CONFIG);if(o.initialStreamWindowSize<INITIAL_STREAM_WINDOW)throw new CodeError$3("InitialStreamWindowSize must be larger or equal 256 kB",ERR_INVALID_CONFIG);if(o.maxStreamWindowSize<o.initialStreamWindowSize)throw new CodeError$3("MaxStreamWindowSize must be larger than the InitialStreamWindowSize",ERR_INVALID_CONFIG);if(o.maxStreamWindowSize>2**32-1)throw new CodeError$3("MaxStreamWindowSize must be less than equal MAX_UINT32",ERR_INVALID_CONFIG);if(o.maxMessageSize<1024)throw new CodeError$3("MaxMessageSize must be greater than a kilobyte",ERR_INVALID_CONFIG)}var FrameType;(function(o){o[o.Data=0]="Data",o[o.WindowUpdate=1]="WindowUpdate",o[o.Ping=2]="Ping",o[o.GoAway=3]="GoAway"})(FrameType||(FrameType={}));var Flag;(function(o){o[o.SYN=1]="SYN",o[o.ACK=2]="ACK",o[o.FIN=4]="FIN",o[o.RST=8]="RST"})(Flag||(Flag={}));Object.values(Flag).filter(o=>typeof o!="string");const YAMUX_VERSION=0;var GoAwayCode;(function(o){o[o.NormalTermination=0]="NormalTermination",o[o.ProtocolError=1]="ProtocolError",o[o.InternalError=2]="InternalError"})(GoAwayCode||(GoAwayCode={}));const HEADER_LENGTH=12,twoPow24=2**24;function decodeHeader(o){if(o[0]!==YAMUX_VERSION)throw new CodeError$3("Invalid frame version",ERR_DECODE_INVALID_VERSION);return{type:o[1],flag:(o[2]<<8)+o[3],streamID:o[4]*twoPow24+(o[5]<<16)+(o[6]<<8)+o[7],length:o[8]*twoPow24+(o[9]<<16)+(o[10]<<8)+o[11]}}let Decoder$1=class{source;buffer;frameInProgress;constructor(s){this.source=returnlessSource(s),this.buffer=new Uint8ArrayList,this.frameInProgress=!1}async*emitFrames(){for await(const s of this.source)for(this.buffer.append(s);;){const a=this.readHeader();if(a===void 0)break;const{type:et,length:tt}=a;et===FrameType.Data?(this.frameInProgress=!0,yield{header:a,readData:this.readBytes.bind(this,tt)}):yield{header:a}}}readHeader(){if(this.frameInProgress)throw new CodeError$3("decoding frame already in progress",ERR_DECODE_IN_PROGRESS);if(this.buffer.length<HEADER_LENGTH)return;const s=decodeHeader(this.buffer.subarray(0,HEADER_LENGTH));return this.buffer.consume(HEADER_LENGTH),s}async readBytes(s){if(this.buffer.length<s){for await(const et of this.source)if(this.buffer.append(et),this.buffer.length>=s)break}const a=this.buffer.sublist(0,s);return this.buffer.consume(s),this.frameInProgress=!1,a}};function returnlessSource(o){if(o[Symbol.iterator]!==void 0){const s=o[Symbol.iterator]();return s.return=void 0,{[Symbol.iterator](){return s}}}else if(o[Symbol.asyncIterator]!==void 0){const s=o[Symbol.asyncIterator]();return s.return=void 0,{[Symbol.asyncIterator](){return s}}}else throw new Error("a source must be either an iterable or an async iterable")}function encodeHeader(o){const s=new Uint8Array(HEADER_LENGTH);return s[1]=o.type,s[2]=o.flag>>>8,s[3]=o.flag,s[4]=o.streamID>>>24,s[5]=o.streamID>>>16,s[6]=o.streamID>>>8,s[7]=o.streamID,s[8]=o.length>>>24,s[9]=o.length>>>16,s[10]=o.length>>>8,s[11]=o.length,s}function isPromise$4(o){return o==null?!1:typeof o.then=="function"&&typeof o.catch=="function"&&typeof o.finally=="function"}function closeSource(o,s){const a=getIterator(o).return?.();isPromise$4(a)&&a.catch(et=>{s.error("could not cause iterator to return",et)})}const ERR_STREAM_RESET="ERR_STREAM_RESET",ERR_SINK_INVALID_STATE="ERR_SINK_INVALID_STATE",DEFAULT_SEND_CLOSE_WRITE_TIMEOUT=5e3;function isPromise$3(o){return o==null?!1:typeof o.then=="function"&&typeof o.catch=="function"&&typeof o.finally=="function"}class AbstractStream{id;direction;timeline;protocol;metadata;source;status;readStatus;writeStatus;log;sinkController;sinkEnd;closed;endErr;streamSource;onEnd;onCloseRead;onCloseWrite;onReset;onAbort;sendCloseWriteTimeout;sendingData;constructor(s){this.sinkController=new AbortController,this.sinkEnd=pDefer(),this.closed=pDefer(),this.log=s.log,this.status="open",this.readStatus="ready",this.writeStatus="ready",this.id=s.id,this.metadata=s.metadata??{},this.direction=s.direction,this.timeline={open:Date.now()},this.sendCloseWriteTimeout=s.sendCloseWriteTimeout??DEFAULT_SEND_CLOSE_WRITE_TIMEOUT,this.onEnd=s.onEnd,this.onCloseRead=s?.onCloseRead,this.onCloseWrite=s?.onCloseWrite,this.onReset=s?.onReset,this.onAbort=s?.onAbort,this.source=this.streamSource=pushable({onEnd:a=>{a!=null?this.log.trace("source ended with error",a):this.log.trace("source ended"),this.onSourceEnd(a)}}),this.sink=this.sink.bind(this)}async sink(s){if(this.writeStatus!=="ready")throw new CodeError$3(`writable end state is "${this.writeStatus}" not "ready"`,ERR_SINK_INVALID_STATE);try{this.writeStatus="writing";const a={signal:this.sinkController.signal};if(this.direction==="outbound"){const tt=this.sendNewStream(a);isPromise$3(tt)&&await tt}const et=()=>{closeSource(s,this.log)};try{this.sinkController.signal.addEventListener("abort",et),this.log.trace("sink reading from source");for await(let tt of s){tt=tt instanceof Uint8Array?new Uint8ArrayList(tt):tt;const rt=this.sendData(tt,a);isPromise$3(rt)&&(this.sendingData=pDefer(),await rt,this.sendingData.resolve(),this.sendingData=void 0)}}finally{this.sinkController.signal.removeEventListener("abort",et)}this.log.trace('sink finished reading from source, write status is "%s"',this.writeStatus),this.writeStatus==="writing"&&(this.writeStatus="closing",this.log.trace("send close write to remote"),await this.sendCloseWrite({signal:AbortSignal.timeout(this.sendCloseWriteTimeout)}),this.writeStatus="closed"),this.onSinkEnd()}catch(a){throw this.log.trace("sink ended with error, calling abort with error",a),this.abort(a),a}finally{this.log.trace("resolve sink end"),this.sinkEnd.resolve()}}onSourceEnd(s){this.timeline.closeRead==null&&(this.timeline.closeRead=Date.now(),this.readStatus="closed",s!=null&&this.endErr==null&&(this.endErr=s),this.onCloseRead?.(),this.timeline.closeWrite!=null?(this.log.trace("source and sink ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("source ended, waiting for sink to end"))}onSinkEnd(s){this.timeline.closeWrite==null&&(this.timeline.closeWrite=Date.now(),this.writeStatus="closed",s!=null&&this.endErr==null&&(this.endErr=s),this.onCloseWrite?.(),this.timeline.closeRead!=null?(this.log.trace("sink and source ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("sink ended, waiting for source to end"))}async close(s){this.log.trace("closing gracefully"),this.status="closing",await raceSignal(Promise.all([this.closeWrite(s),this.closeRead(s),this.closed.promise]),s?.signal),this.status="closed",this.log.trace("closed gracefully")}async closeRead(s={}){if(this.readStatus==="closing"||this.readStatus==="closed")return;this.log.trace('closing readable end of stream with starting read status "%s"',this.readStatus);const a=this.readStatus;this.readStatus="closing",this.status!=="reset"&&this.status!=="aborted"&&this.timeline.closeRead==null&&(this.log.trace("send close read to remote"),await this.sendCloseRead(s)),a==="ready"&&(this.log.trace("ending internal source queue with %d queued bytes",this.streamSource.readableLength),this.streamSource.end()),this.log.trace("closed readable end of stream")}async closeWrite(s={}){this.writeStatus==="closing"||this.writeStatus==="closed"||(this.log.trace('closing writable end of stream with starting write status "%s"',this.writeStatus),this.writeStatus==="ready"&&(this.log.trace("sink was never sunk, sink an empty array"),await raceSignal(this.sink([]),s.signal)),this.writeStatus==="writing"&&(this.sendingData!=null&&await raceSignal(this.sendingData.promise,s.signal),this.log.trace("aborting source passed to .sink"),this.sinkController.abort(),await raceSignal(this.sinkEnd.promise,s.signal)),this.writeStatus="closed",this.log.trace("closed writable end of stream"))}abort(s){if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;this.log("abort with error",s),this.log("try to send reset to remote");const a=this.sendReset();isPromise$3(a)&&a.catch(et=>{this.log.error("error sending reset message",et)}),this.status="aborted",this.timeline.abort=Date.now(),this._closeSinkAndSource(s),this.onAbort?.(s)}reset(){if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;const s=new CodeError$3("stream reset",ERR_STREAM_RESET);this.status="reset",this.timeline.reset=Date.now(),this._closeSinkAndSource(s),this.onReset?.()}_closeSinkAndSource(s){this._closeSink(s),this._closeSource(s)}_closeSink(s){this.writeStatus==="writing"&&(this.log.trace("end sink source"),this.sinkController.abort()),this.onSinkEnd(s)}_closeSource(s){this.readStatus!=="closing"&&this.readStatus!=="closed"&&(this.log.trace("ending source with %d bytes to be read by consumer",this.streamSource.readableLength),this.readStatus="closing",this.streamSource.end(s))}remoteCloseWrite(){if(this.readStatus==="closing"||this.readStatus==="closed"){this.log("received remote close write but local source is already closed");return}this.log.trace("remote close write"),this._closeSource()}remoteCloseRead(){if(this.writeStatus==="closing"||this.writeStatus==="closed"){this.log("received remote close read but local sink is already closed");return}this.log.trace("remote close read"),this._closeSink()}destroy(){if(this.status==="closed"||this.status==="aborted"||this.status==="reset"){this.log("received destroy but we are already closed");return}this.log.trace("stream destroyed"),this._closeSinkAndSource()}sourcePush(s){this.streamSource.push(s)}sourceReadableLength(){return this.streamSource.readableLength}}var StreamState;(function(o){o[o.Init=0]="Init",o[o.SYNSent=1]="SYNSent",o[o.SYNReceived=2]="SYNReceived",o[o.Established=3]="Established",o[o.Finished=4]="Finished"})(StreamState||(StreamState={}));class YamuxStream extends AbstractStream{name;state;config;_id;sendWindowCapacity;sendWindowCapacityUpdate;recvWindow;recvWindowCapacity;epochStart;getRTT;sendFrame;constructor(s){super({...s,onEnd:a=>{this.state=StreamState.Finished,s.onEnd?.(a)}}),this.config=s.config,this._id=parseInt(s.id,10),this.name=s.name,this.state=s.state,this.sendWindowCapacity=INITIAL_STREAM_WINDOW,this.recvWindow=this.config.initialStreamWindowSize,this.recvWindowCapacity=this.recvWindow,this.epochStart=Date.now(),this.getRTT=s.getRTT,this.sendFrame=s.sendFrame,this.source=forEach(this.source,()=>{this.sendWindowUpdate()})}async sendNewStream(){}async sendData(s,a={}){for(s=s.sublist();s.byteLength!==0;){if(this.sendWindowCapacity===0&&(this.log?.trace("wait for send window capacity, status %s",this.status),await this.waitForSendWindowCapacity(a),this.status==="closed"||this.status==="aborted"||this.status==="reset")){this.log?.trace("%s while waiting for send window capacity",this.status);return}const et=Math.min(this.sendWindowCapacity,this.config.maxMessageSize-HEADER_LENGTH,s.length),tt=this.getSendFlags();this.sendFrame({type:FrameType.Data,flag:tt,streamID:this._id,length:et},s.sublist(0,et)),this.sendWindowCapacity-=et,s.consume(et)}}async sendReset(){this.sendFrame({type:FrameType.WindowUpdate,flag:Flag.RST,streamID:this._id,length:0})}async sendCloseWrite(){const s=this.getSendFlags()|Flag.FIN;this.sendFrame({type:FrameType.WindowUpdate,flag:s,streamID:this._id,length:0})}async sendCloseRead(){}async waitForSendWindowCapacity(s={}){if(this.sendWindowCapacity>0)return;let a,et;const tt=()=>{this.status==="open"||this.status==="closing"?et(new CodeError$3("stream aborted",ERR_STREAM_ABORT)):a()};s.signal?.addEventListener("abort",tt);try{await new Promise((rt,nt)=>{this.sendWindowCapacityUpdate=()=>{rt()},et=nt,a=rt})}finally{s.signal?.removeEventListener("abort",tt)}}handleWindowUpdate(s){this.log?.trace("stream received window update id=%s",this._id),this.processFlags(s.flag);const a=this.sendWindowCapacity;this.sendWindowCapacity+=s.length,a===0&&s.length>0&&this.sendWindowCapacityUpdate?.()}async handleData(s,a){if(this.log?.trace("stream received data id=%s",this._id),this.processFlags(s.flag),this.recvWindowCapacity<s.length)throw new CodeError$3("receive window exceeded",ERR_RECV_WINDOW_EXCEEDED,{available:this.recvWindowCapacity,recv:s.length});const et=await a();this.recvWindowCapacity-=s.length,this.sourcePush(et)}processFlags(s){(s&Flag.ACK)===Flag.ACK&&this.state===StreamState.SYNSent&&(this.state=StreamState.Established),(s&Flag.FIN)===Flag.FIN&&this.remoteCloseWrite(),(s&Flag.RST)===Flag.RST&&this.reset()}getSendFlags(){switch(this.state){case StreamState.Init:return this.state=StreamState.SYNSent,Flag.SYN;case StreamState.SYNReceived:return this.state=StreamState.Established,Flag.ACK;default:return 0}}sendWindowUpdate(){const s=this.getSendFlags(),a=Date.now(),et=this.getRTT();if(s===0&&et>-1&&a-this.epochStart<et*4&&(this.recvWindow=Math.min(this.recvWindow*2,this.config.maxStreamWindowSize)),this.recvWindowCapacity>=this.recvWindow&&s===0)return;const tt=this.recvWindow-this.recvWindowCapacity;this.recvWindowCapacity=this.recvWindow,this.epochStart=a,this.sendFrame({type:FrameType.WindowUpdate,flag:s,streamID:this._id,length:tt})}}const YAMUX_PROTOCOL_ID="/yamux/1.0.0",CLOSE_TIMEOUT$4=500;class Yamux{protocol=YAMUX_PROTOCOL_ID;_components;_init;constructor(s,a={}){this._components=s,this._init=a}createStreamMuxer(s){return new YamuxMuxer(this._components,{...this._init,...s})}}class YamuxMuxer{protocol=YAMUX_PROTOCOL_ID;source;sink;config;log;logger;closeController;nextStreamID;_streams;nextPingID;activePing;rtt;client;localGoAway;remoteGoAway;numInboundStreams;numOutboundStreams;onIncomingStream;onStreamEnd;constructor(s,a){this.client=a.direction==="outbound",this.config={...defaultConfig,...a},this.logger=s.logger,this.log=this.logger.forComponent("libp2p:yamux"),verifyConfig(this.config),this.closeController=new AbortController,setMaxListeners(1/0,this.closeController.signal),this.onIncomingStream=a.onIncomingStream,this.onStreamEnd=a.onStreamEnd,this._streams=new Map,this.source=pushable({onEnd:()=>{this.log?.trace("muxer source ended"),this._streams.forEach(et=>{et.destroy()})}}),this.sink=async et=>{const tt=()=>{const it=getIterator(et);if(it.return!=null){const st=it.return();isPromise$2(st)&&st.catch(ot=>{this.log?.("could not cause sink source to return",ot)})}};let rt,nt;try{const it=new Decoder$1(et);try{this.closeController.signal.addEventListener("abort",tt);for await(const st of it.emitFrames())await this.handleFrame(st.header,st.readData)}finally{this.closeController.signal.removeEventListener("abort",tt)}rt=GoAwayCode.NormalTermination}catch(it){const st=it.code;PROTOCOL_ERRORS.has(st)?(this.log?.error("protocol error in sink",it),rt=GoAwayCode.ProtocolError):(this.log?.error("internal error in sink",it),rt=GoAwayCode.InternalError),nt=it}this.log?.trace("muxer sink ended"),nt!=null?this.abort(nt,rt):await this.close({reason:rt})},this.numInboundStreams=0,this.numOutboundStreams=0,this.nextStreamID=this.client?1:2,this.nextPingID=0,this.rtt=-1,this.log?.trace("muxer created"),this.config.enableKeepAlive&&this.keepAliveLoop().catch(et=>this.log?.error("keepalive error: %s",et)),this.ping().catch(et=>this.log?.error("ping error: %s",et))}get streams(){return Array.from(this._streams.values())}newStream(s){if(this.remoteGoAway!==void 0)throw new CodeError$3("muxer closed remotely",ERR_MUXER_REMOTE_CLOSED);if(this.localGoAway!==void 0)throw new CodeError$3("muxer closed locally",ERR_MUXER_LOCAL_CLOSED);const a=this.nextStreamID;if(this.nextStreamID+=2,this.numOutboundStreams>=this.config.maxOutboundStreams)throw new CodeError$3("max outbound streams exceeded",ERR_MAX_OUTBOUND_STREAMS_EXCEEDED);this.log?.trace("new outgoing stream id=%s",a);const et=this._newStream(a,s,StreamState.Init,"outbound");return this._streams.set(a,et),this.numOutboundStreams++,et.sendWindowUpdate(),et}async ping(){if(this.remoteGoAway!==void 0)throw new CodeError$3("muxer closed remotely",ERR_MUXER_REMOTE_CLOSED);if(this.localGoAway!==void 0)throw new CodeError$3("muxer closed locally",ERR_MUXER_LOCAL_CLOSED);if(this.activePing===void 0){let s=()=>{};this.activePing={id:this.nextPingID++,promise:new Promise((tt,rt)=>{const nt=()=>{rt(new CodeError$3("muxer closed locally",ERR_MUXER_LOCAL_CLOSED))};this.closeController.signal.addEventListener("abort",nt,{once:!0}),s=()=>{this.closeController.signal.removeEventListener("abort",nt),tt()}}),resolve:s};const a=Date.now();this.sendPing(this.activePing.id);try{await this.activePing.promise}finally{delete this.activePing}const et=Date.now();this.rtt=et-a}else await this.activePing.promise;return this.rtt}getRTT(){return this.rtt}async close(s={}){if(this.closeController.signal.aborted)return;const a=s?.reason??GoAwayCode.NormalTermination;if(this.log?.trace("muxer close reason=%s",a),s.signal==null){const et=AbortSignal.timeout(CLOSE_TIMEOUT$4);setMaxListeners(1/0,et),s={...s,signal:et}}try{await Promise.all([...this._streams.values()].map(async et=>et.close(s))),this.sendGoAway(a),this._closeMuxer()}catch(et){this.abort(et)}}abort(s,a){if(!this.closeController.signal.aborted){a=a??GoAwayCode.InternalError,this.log?.error("muxer abort reason=%s error=%s",a,s);for(const et of this._streams.values())et.abort(s);this.sendGoAway(a),this._closeMuxer()}}isClosed(){return this.closeController.signal.aborted}_closeMuxer(){this.closeController.abort(),this.source.end()}_newStream(s,a,et,tt){if(this._streams.get(s)!=null)throw new CodeError$3("Stream already exists",ERR_STREAM_ALREADY_EXISTS,{id:s});const rt=new YamuxStream({id:s.toString(),name:a,state:et,direction:tt,sendFrame:this.sendFrame.bind(this),onEnd:()=>{this.closeStream(s),this.onStreamEnd?.(rt)},log:this.logger.forComponent(`libp2p:yamux:${tt}:${s}`),config:this.config,getRTT:this.getRTT.bind(this)});return rt}closeStream(s){this.client===(s%2===0)?this.numInboundStreams--:this.numOutboundStreams--,this._streams.delete(s)}async keepAliveLoop(){const s=new Promise((a,et)=>{this.closeController.signal.addEventListener("abort",et,{once:!0})});for(this.log?.trace("muxer keepalive enabled interval=%s",this.config.keepAliveInterval);;){let a;try{await Promise.race([s,new Promise(et=>{a=setTimeout(et,this.config.keepAliveInterval)})]),this.ping().catch(et=>this.log?.error("ping error: %s",et))}catch{clearInterval(a);return}}}async handleFrame(s,a){const{streamID:et,type:tt,length:rt}=s;if(this.log?.trace("received frame %o",s),et===0)switch(tt){case FrameType.Ping:{this.handlePing(s);return}case FrameType.GoAway:{this.handleGoAway(rt);return}default:throw new CodeError$3("Invalid frame type",ERR_INVALID_FRAME,{header:s})}else switch(s.type){case FrameType.Data:case FrameType.WindowUpdate:{await this.handleStreamMessage(s,a);return}default:throw new CodeError$3("Invalid frame type",ERR_INVALID_FRAME,{header:s})}}handlePing(s){if(s.flag===Flag.SYN)this.log?.trace("received ping request pingId=%s",s.length),this.sendPing(s.length,Flag.ACK);else if(s.flag===Flag.ACK)this.log?.trace("received ping response pingId=%s",s.length),this.handlePingResponse(s.length);else throw new CodeError$3("Invalid frame flag",ERR_INVALID_FRAME,{header:s})}handlePingResponse(s){if(this.activePing===void 0)throw new CodeError$3("ping not requested",ERR_UNREQUESTED_PING);if(this.activePing.id!==s)throw new CodeError$3("ping doesn't match our id",ERR_NOT_MATCHING_PING);this.activePing.resolve()}handleGoAway(s){this.log?.trace("received GoAway reason=%s",GoAwayCode[s]??"unknown"),this.remoteGoAway=s;for(const a of this._streams.values())a.reset();this._closeMuxer()}async handleStreamMessage(s,a){const{streamID:et,flag:tt,type:rt}=s;(tt&Flag.SYN)===Flag.SYN&&this.incomingStream(et);const nt=this._streams.get(et);if(nt===void 0){if(rt===FrameType.Data){if(this.log?.("discarding data for stream id=%s",et),a===void 0)throw new Error("unreachable");await a()}else this.log?.("frame for missing stream id=%s",et);return}switch(rt){case FrameType.WindowUpdate:{nt.handleWindowUpdate(s);return}case FrameType.Data:{if(a===void 0)throw new Error("unreachable");await nt.handleData(s,a);return}default:throw new Error("unreachable")}}incomingStream(s){if(this.client!==(s%2===0))throw new CodeError$3("both endpoints are clients",ERR_BOTH_CLIENTS);if(this._streams.has(s))return;if(this.log?.trace("new incoming stream id=%s",s),this.localGoAway!==void 0){this.sendFrame({type:FrameType.WindowUpdate,flag:Flag.RST,streamID:s,length:0});return}if(this.numInboundStreams>=this.config.maxInboundStreams){this.log?.("maxIncomingStreams exceeded, forcing stream reset"),this.sendFrame({type:FrameType.WindowUpdate,flag:Flag.RST,streamID:s,length:0});return}const a=this._newStream(s,void 0,StreamState.SYNReceived,"inbound");this.numInboundStreams++,this._streams.set(s,a),this.onIncomingStream?.(a)}sendFrame(s,a){if(this.log?.trace("sending frame %o",s),s.type===FrameType.Data){if(a===void 0)throw new CodeError$3("invalid frame",ERR_INVALID_FRAME);this.source.push(new Uint8ArrayList(encodeHeader(s),a))}else this.source.push(encodeHeader(s))}sendPing(s,a=Flag.SYN){a===Flag.SYN?this.log?.trace("sending ping request pingId=%s",s):this.log?.trace("sending ping response pingId=%s",s),this.sendFrame({type:FrameType.Ping,flag:a,streamID:0,length:s})}sendGoAway(s=GoAwayCode.NormalTermination){this.log?.("sending GoAway reason=%s",GoAwayCode[s]),this.localGoAway=s,this.sendFrame({type:FrameType.GoAway,flag:0,streamID:0,length:s})}}function isPromise$2(o){return o!=null&&typeof o.then=="function"}function yamux(o={}){return s=>new Yamux(s,o)}const CustomEvent$1=globalThis.CustomEvent??Event;async function*parallel(o,s={}){let a=s.concurrency??1/0;a<1&&(a=1/0);const et=s.ordered==null?!1:s.ordered,tt=new EventTarget,rt=[];let nt=pDefer(),it=pDefer(),st=!1,ot,at=!1;tt.addEventListener("task-complete",()=>{it.resolve()}),Promise.resolve().then(async()=>{try{for await(const ft of o){if(rt.length===a&&(nt=pDefer(),await nt.promise),at)break;const dt={done:!1};rt.push(dt),ft().then(pt=>{dt.done=!0,dt.ok=!0,dt.value=pt,tt.dispatchEvent(new CustomEvent$1("task-complete"))},pt=>{dt.done=!0,dt.err=pt,tt.dispatchEvent(new CustomEvent$1("task-complete"))})}st=!0,tt.dispatchEvent(new CustomEvent$1("task-complete"))}catch(ft){ot=ft,tt.dispatchEvent(new CustomEvent$1("task-complete"))}});function lt(){return et?rt[0]?.done:!!rt.find(ft=>ft.done)}function*ct(){for(;rt.length>0&&rt[0].done;){const ft=rt[0];if(rt.shift(),ft.ok)yield ft.value;else throw at=!0,nt.resolve(),ft.err;nt.resolve()}}function*ht(){for(;lt();)for(let ft=0;ft<rt.length;ft++)if(rt[ft].done){const dt=rt[ft];if(rt.splice(ft,1),ft--,dt.ok)yield dt.value;else throw at=!0,nt.resolve(),dt.err;nt.resolve()}}for(;;){if(lt()||(it=pDefer(),await it.promise),ot!=null)throw ot;if(et?yield*ct():yield*ht(),st&&rt.length===0)break}}const PROTOCOL_PREFIX$1="libp2p",PROTOCOL_NAME$1="autonat",PROTOCOL_VERSION$1="1.0.0",TIMEOUT$1=3e4,STARTUP_DELAY=5e3,REFRESH_INTERVAL=6e4,MAX_INBOUND_STREAMS$1=1,MAX_OUTBOUND_STREAMS$1=1;var Message$3;(function(o){(function(tt){tt.DIAL="DIAL",tt.DIAL_RESPONSE="DIAL_RESPONSE"})(o.MessageType||(o.MessageType={}));let s;(function(tt){tt[tt.DIAL=0]="DIAL",tt[tt.DIAL_RESPONSE=1]="DIAL_RESPONSE"})(s||(s={})),function(tt){tt.codec=()=>enumeration(s)}(o.MessageType||(o.MessageType={})),function(tt){tt.OK="OK",tt.E_DIAL_ERROR="E_DIAL_ERROR",tt.E_DIAL_REFUSED="E_DIAL_REFUSED",tt.E_BAD_REQUEST="E_BAD_REQUEST",tt.E_INTERNAL_ERROR="E_INTERNAL_ERROR"}(o.ResponseStatus||(o.ResponseStatus={}));let a;(function(tt){tt[tt.OK=0]="OK",tt[tt.E_DIAL_ERROR=100]="E_DIAL_ERROR",tt[tt.E_DIAL_REFUSED=101]="E_DIAL_REFUSED",tt[tt.E_BAD_REQUEST=200]="E_BAD_REQUEST",tt[tt.E_INTERNAL_ERROR=300]="E_INTERNAL_ERROR"})(a||(a={})),function(tt){tt.codec=()=>enumeration(a)}(o.ResponseStatus||(o.ResponseStatus={})),function(tt){let rt;tt.codec=()=>(rt==null&&(rt=message((nt,it,st={})=>{if(st.lengthDelimited!==!1&&it.fork(),nt.id!=null&&(it.uint32(10),it.bytes(nt.id)),nt.addrs!=null)for(const ot of nt.addrs)it.uint32(18),it.bytes(ot);st.lengthDelimited!==!1&&it.ldelim()},(nt,it)=>{const st={addrs:[]},ot=it==null?nt.len:nt.pos+it;for(;nt.pos<ot;){const at=nt.uint32();switch(at>>>3){case 1:st.id=nt.bytes();break;case 2:st.addrs.push(nt.bytes());break;default:nt.skipType(at&7);break}}return st})),rt),tt.encode=nt=>encodeMessage(nt,tt.codec()),tt.decode=nt=>decodeMessage(nt,tt.codec())}(o.PeerInfo||(o.PeerInfo={})),function(tt){let rt;tt.codec=()=>(rt==null&&(rt=message((nt,it,st={})=>{st.lengthDelimited!==!1&&it.fork(),nt.peer!=null&&(it.uint32(10),o.PeerInfo.codec().encode(nt.peer,it)),st.lengthDelimited!==!1&&it.ldelim()},(nt,it)=>{const st={},ot=it==null?nt.len:nt.pos+it;for(;nt.pos<ot;){const at=nt.uint32();switch(at>>>3){case 1:st.peer=o.PeerInfo.codec().decode(nt,nt.uint32());break;default:nt.skipType(at&7);break}}return st})),rt),tt.encode=nt=>encodeMessage(nt,tt.codec()),tt.decode=nt=>decodeMessage(nt,tt.codec())}(o.Dial||(o.Dial={})),function(tt){let rt;tt.codec=()=>(rt==null&&(rt=message((nt,it,st={})=>{st.lengthDelimited!==!1&&it.fork(),nt.status!=null&&(it.uint32(8),o.ResponseStatus.codec().encode(nt.status,it)),nt.statusText!=null&&(it.uint32(18),it.string(nt.statusText)),nt.addr!=null&&(it.uint32(26),it.bytes(nt.addr)),st.lengthDelimited!==!1&&it.ldelim()},(nt,it)=>{const st={},ot=it==null?nt.len:nt.pos+it;for(;nt.pos<ot;){const at=nt.uint32();switch(at>>>3){case 1:st.status=o.ResponseStatus.codec().decode(nt);break;case 2:st.statusText=nt.string();break;case 3:st.addr=nt.bytes();break;default:nt.skipType(at&7);break}}return st})),rt),tt.encode=nt=>encodeMessage(nt,tt.codec()),tt.decode=nt=>decodeMessage(nt,tt.codec())}(o.DialResponse||(o.DialResponse={}));let et;o.codec=()=>(et==null&&(et=message((tt,rt,nt={})=>{nt.lengthDelimited!==!1&&rt.fork(),tt.type!=null&&(rt.uint32(8),o.MessageType.codec().encode(tt.type,rt)),tt.dial!=null&&(rt.uint32(18),o.Dial.codec().encode(tt.dial,rt)),tt.dialResponse!=null&&(rt.uint32(26),o.DialResponse.codec().encode(tt.dialResponse,rt)),nt.lengthDelimited!==!1&&rt.ldelim()},(tt,rt)=>{const nt={},it=rt==null?tt.len:tt.pos+rt;for(;tt.pos<it;){const st=tt.uint32();switch(st>>>3){case 1:nt.type=o.MessageType.codec().decode(tt);break;case 2:nt.dial=o.Dial.codec().decode(tt,tt.uint32());break;case 3:nt.dialResponse=o.DialResponse.codec().decode(tt,tt.uint32());break;default:tt.skipType(st&7);break}}return nt})),et),o.encode=tt=>encodeMessage(tt,o.codec()),o.decode=tt=>decodeMessage(tt,o.codec())})(Message$3||(Message$3={}));const REQUIRED_SUCCESSFUL_DIALS=4;class AutoNATService{components;startupDelay;refreshInterval;protocol;timeout;maxInboundStreams;maxOutboundStreams;verifyAddressTimeout;started;log;constructor(s,a){this.components=s,this.log=s.logger.forComponent("libp2p:autonat"),this.started=!1,this.protocol=`/${a.protocolPrefix??PROTOCOL_PREFIX$1}/${PROTOCOL_NAME$1}/${PROTOCOL_VERSION$1}`,this.timeout=a.timeout??TIMEOUT$1,this.maxInboundStreams=a.maxInboundStreams??MAX_INBOUND_STREAMS$1,this.maxOutboundStreams=a.maxOutboundStreams??MAX_OUTBOUND_STREAMS$1,this.startupDelay=a.startupDelay??STARTUP_DELAY,this.refreshInterval=a.refreshInterval??REFRESH_INTERVAL,this._verifyExternalAddresses=this._verifyExternalAddresses.bind(this)}[Symbol.toStringTag]="@libp2p/autonat";isStarted(){return this.started}async start(){this.started||(await this.components.registrar.handle(this.protocol,s=>{this.handleIncomingAutonatStream(s).catch(a=>{this.log.error("error handling incoming autonat stream",a)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}),this.verifyAddressTimeout=setTimeout(this._verifyExternalAddresses,this.startupDelay),this.started=!0)}async stop(){await this.components.registrar.unhandle(this.protocol),clearTimeout(this.verifyAddressTimeout),this.started=!1}async handleIncomingAutonatStream(s){const a=AbortSignal.timeout(this.timeout),et=()=>{s.stream.abort(new CodeError$3("handleIncomingAutonatStream timeout",ERR_TIMEOUT))};a.addEventListener("abort",et,{once:!0}),setMaxListeners(1/0,a);try{const tt=this;await pipe(s.stream,rt=>decode$f(rt),async function*(rt){const nt=await first(rt);if(nt==null){tt.log("no message received"),yield Message$3.encode({type:Message$3.MessageType.DIAL_RESPONSE,dialResponse:{status:Message$3.ResponseStatus.E_BAD_REQUEST,statusText:"No message was sent"}});return}let it;try{it=Message$3.decode(nt)}catch(st){tt.log.error("could not decode message",st),yield Message$3.encode({type:Message$3.MessageType.DIAL_RESPONSE,dialResponse:{status:Message$3.ResponseStatus.E_BAD_REQUEST,statusText:"Could not decode message"}});return}yield Message$3.encode(await tt.handleAutonatMessage(it,s.connection,{signal:a}))},rt=>encode$b(rt),s.stream)}catch(tt){this.log.error("error handling incoming autonat stream",tt)}finally{a.removeEventListener("abort",et)}}_verifyExternalAddresses(){this.verifyExternalAddresses().catch(s=>{this.log.error("error verifying external address",s)})}async handleAutonatMessage(s,a,et){const tt=this.components.addressManager.getAddresses().map(lt=>lt.toOptions().host),rt=s.dial;if(rt==null)return this.log.error("dial was missing from message"),{type:Message$3.MessageType.DIAL_RESPONSE,dialResponse:{status:Message$3.ResponseStatus.E_BAD_REQUEST,statusText:"No Dial message found in message"}};let nt;const it=rt.peer;if(it==null||it.id==null)return this.log.error("PeerId missing from message"),{type:Message$3.MessageType.DIAL_RESPONSE,dialResponse:{status:Message$3.ResponseStatus.E_BAD_REQUEST,statusText:"missing peer info"}};try{nt=peerIdFromBytes(it.id)}catch(lt){return this.log.error("invalid PeerId",lt),{type:Message$3.MessageType.DIAL_RESPONSE,dialResponse:{status:Message$3.ResponseStatus.E_BAD_REQUEST,statusText:"bad peer id"}}}if(this.log("incoming request from %p",nt),!a.remotePeer.equals(nt))return this.log("target peer %p did not equal sending peer %p",nt,a.remotePeer),{type:Message$3.MessageType.DIAL_RESPONSE,dialResponse:{status:Message$3.ResponseStatus.E_BAD_REQUEST,statusText:"peer id mismatch"}};const st=it.addrs.map(lt=>multiaddr(lt)).filter(lt=>{const ct=lt.toOptions().host===a.remoteAddr.toOptions().host;return this.log.trace("request to dial %a was sent from %a is same host %s",lt,a.remoteAddr,ct),ct}).filter(lt=>{const ct=lt.toOptions().host,ht=!(isPrivateIp(ct)??!1);return this.log.trace("host %s was public %s",ct,ht),ht}).filter(lt=>{const ct=lt.toOptions().host,ht=!tt.includes(ct);return this.log.trace("host %s was not our host %s",ct,ht),ht}).filter(lt=>{const ct=!!this.components.transportManager.dialTransportForMultiaddr(lt);return this.log.trace("transport for %a is supported %s",lt,ct),ct}).map(lt=>(lt.getPeerId()==null&&(lt=lt.encapsulate(`/p2p/${nt.toString()}`)),lt));if(st.length===0)return this.log("no valid multiaddrs for %p in message",nt),{type:Message$3.MessageType.DIAL_RESPONSE,dialResponse:{status:Message$3.ResponseStatus.E_DIAL_REFUSED,statusText:"no dialable addresses"}};this.log("dial multiaddrs %s for peer %p",st.map(lt=>lt.toString()).join(", "),nt);let ot="",at=st[0];for await(const lt of st){let ct;at=lt;try{if(ct=await this.components.connectionManager.openConnection(lt,et),!ct.remoteAddr.equals(lt))throw this.log.error("tried to dial %a but dialed %a",lt,ct.remoteAddr),new Error("Unexpected remote address");return this.log("Success %p",nt),{type:Message$3.MessageType.DIAL_RESPONSE,dialResponse:{status:Message$3.ResponseStatus.OK,addr:ct.remoteAddr.decapsulateCode(getProtocol("p2p").code).bytes}}}catch(ht){this.log("could not dial %p",nt,ht),ot=ht.message}finally{ct!=null&&await ct.close()}}return{type:Message$3.MessageType.DIAL_RESPONSE,dialResponse:{status:Message$3.ResponseStatus.E_DIAL_ERROR,statusText:ot,addr:at.bytes}}}async verifyExternalAddresses(){if(clearTimeout(this.verifyAddressTimeout),!this.isStarted())return;const s=this.components.addressManager,a=s.getObservedAddrs().filter(rt=>{const nt=rt.toOptions();return!(isPrivateIp(nt.host)??!1)});if(a.length===0){this.log("no public addresses found, not requesting verification"),this.verifyAddressTimeout=setTimeout(this._verifyExternalAddresses,this.refreshInterval);return}const et=AbortSignal.timeout(this.timeout);setMaxListeners(1/0,et);const tt=this;try{this.log("verify multiaddrs %s",a.map(ot=>ot.toString()).join(", "));const rt=Message$3.encode({type:Message$3.MessageType.DIAL,dial:{peer:{id:this.components.peerId.toBytes(),addrs:a.map(ot=>ot.bytes)}}}),nt={},it=[],st=async ot=>{let at=()=>{};try{this.log("asking %p to verify multiaddr",ot.id);const lt=await tt.components.connectionManager.openConnection(ot.id,{signal:et}),ct=await lt.newStream(this.protocol,{signal:et});at=()=>{ct.abort(new CodeError$3("verifyAddress timeout",ERR_TIMEOUT))},et.addEventListener("abort",at,{once:!0});const ht=await pipe([rt],dt=>encode$b(dt),ct,dt=>decode$f(dt),async dt=>first(dt));if(ht==null){this.log("no response received from %p",lt.remotePeer);return}const ft=Message$3.decode(ht);if(ft.type!==Message$3.MessageType.DIAL_RESPONSE||ft.dialResponse==null){this.log("invalid autonat response from %p",lt.remotePeer);return}if(ft.dialResponse.status===Message$3.ResponseStatus.OK){const dt=lt.remoteAddr.toOptions();let pt;if(dt.family===4)pt=dt.host.split(".")[0];else if(dt.family===6)pt=dt.host.split(":")[0];else{this.log('remote address "%s" was not IP4 or IP6?',dt.host);return}if(it.includes(pt)){this.log("already have response from network segment %d - %s",pt,dt.host);return}it.push(pt)}return ft.dialResponse}catch(lt){this.log.error("error asking remote to verify multiaddr",lt)}finally{et.removeEventListener("abort",at)}};for await(const ot of parallel(map$1(this.components.randomWalk.walk({signal:et}),at=>async()=>st(at)),{concurrency:REQUIRED_SUCCESSFUL_DIALS}))try{if(ot==null)continue;const at=ot.addr==null?a[0]:multiaddr(ot.addr);if(this.log("autonat response for %a is %s",at,ot.status),ot.status===Message$3.ResponseStatus.E_BAD_REQUEST||ot.status===Message$3.ResponseStatus.E_DIAL_REFUSED||ot.addr==null&&a.length>1)continue;if(!a.some(ct=>ct.equals(at))){this.log("peer reported %a as %s but it was not in our observed address list",at,ot.status);continue}const lt=at.toString();if(nt[lt]==null&&(nt[lt]={success:0,failure:0}),ot.status===Message$3.ResponseStatus.OK?nt[lt].success++:ot.status===Message$3.ResponseStatus.E_DIAL_ERROR&&nt[lt].failure++,nt[lt].success===REQUIRED_SUCCESSFUL_DIALS){this.log("%a is externally dialable",at),s.confirmObservedAddr(at);return}if(nt[lt].failure===REQUIRED_SUCCESSFUL_DIALS){this.log("%a is not externally dialable",at),s.removeObservedAddr(at);return}}catch(at){this.log.error("could not verify external address",at)}}finally{this.verifyAddressTimeout=setTimeout(this._verifyExternalAddresses,this.refreshInterval)}}}function autoNAT(o={}){return s=>new AutoNATService(s,o)}const DNS4=base$2("dns4"),DNS6=base$2("dns6"),DNSADDR=base$2("dnsaddr"),DNS=or(base$2("dns"),DNSADDR,DNS4,DNS6),IP=or(base$2("ip4"),base$2("ip6")),TCP$1=or(and(IP,base$2("tcp")),and(DNS,base$2("tcp"))),UDP=and(IP,base$2("udp")),UTP=and(UDP,base$2("utp")),QUIC=and(UDP,base$2("quic")),QUICV1=and(UDP,base$2("quic-v1")),_WebSockets=or(and(TCP$1,base$2("ws")),and(DNS,base$2("ws"))),WebSockets$1=or(and(_WebSockets,base$2("p2p")),_WebSockets),_WebSocketsSecure=or(and(TCP$1,base$2("wss")),and(DNS,base$2("wss")),and(TCP$1,base$2("tls"),base$2("ws")),and(DNS,base$2("tls"),base$2("ws"))),WebSocketsSecure=or(and(_WebSocketsSecure,base$2("p2p")),_WebSocketsSecure),HTTP=or(and(TCP$1,base$2("http")),and(IP,base$2("http")),and(DNS,base$2("http"))),HTTPS=or(and(TCP$1,base$2("https")),and(IP,base$2("https")),and(DNS,base$2("https"))),_WebRTCDirect=and(UDP,base$2("webrtc-direct"),base$2("certhash")),WebRTCDirect=or(and(_WebRTCDirect,base$2("p2p")),_WebRTCDirect),_WebTransport=and(QUICV1,base$2("webtransport"),base$2("certhash"),base$2("certhash")),WebTransport$2=or(and(_WebTransport,base$2("p2p")),_WebTransport),P2PWebRTCStar=or(and(WebSockets$1,base$2("p2p-webrtc-star"),base$2("p2p")),and(WebSocketsSecure,base$2("p2p-webrtc-star"),base$2("p2p")),and(WebSockets$1,base$2("p2p-webrtc-star")),and(WebSocketsSecure,base$2("p2p-webrtc-star"))),P2PWebRTCDirect=or(and(HTTP,base$2("p2p-webrtc-direct"),base$2("p2p")),and(HTTPS,base$2("p2p-webrtc-direct"),base$2("p2p")),and(HTTP,base$2("p2p-webrtc-direct")),and(HTTPS,base$2("p2p-webrtc-direct"))),Reliable=or(_WebSockets,_WebSocketsSecure,HTTP,HTTPS,P2PWebRTCStar,P2PWebRTCDirect,TCP$1,UTP,QUIC,DNS,WebRTCDirect,WebTransport$2),_P2P=or(and(Reliable,base$2("p2p")),P2PWebRTCStar,P2PWebRTCDirect,WebRTCDirect,WebTransport$2,base$2("p2p")),_Circuit=or(and(_P2P,base$2("p2p-circuit"),_P2P),and(_P2P,base$2("p2p-circuit")),and(base$2("p2p-circuit"),_P2P),and(Reliable,base$2("p2p-circuit")),and(base$2("p2p-circuit"),Reliable),base$2("p2p-circuit")),CircuitRecursive=()=>or(and(_Circuit,CircuitRecursive),_Circuit),Circuit=CircuitRecursive(),P2P=or(and(Circuit,_P2P,Circuit),and(_P2P,Circuit),and(Circuit,_P2P),Circuit,_P2P);function makeMatchesFunction(o){function s(a){let et;try{et=multiaddr(a)}catch{return!1}const tt=o(et.protoNames());return tt===null?!1:tt===!0||tt===!1?tt:tt.length===0}return s}function and(...o){function s(a){if(a.length<o.length)return null;let et=a;return o.some(tt=>(et=typeof tt=="function"?tt().partialMatch(a):tt.partialMatch(a),Array.isArray(et)&&(a=et),et===null)),et}return{toString:function(){return"{ "+o.join(" ")+" }"},input:o,matches:makeMatchesFunction(s),partialMatch:s}}function or(...o){function s(et){let tt=null;return o.some(rt=>{const nt=typeof rt=="function"?rt().partialMatch(et):rt.partialMatch(et);return nt!=null?(tt=nt,!0):!1}),tt}return{toString:function(){return"{ "+o.join(" ")+" }"},input:o,matches:makeMatchesFunction(s),partialMatch:s}}function base$2(o){const s=o;function a(tt){let rt;try{rt=multiaddr(tt)}catch{return!1}const nt=rt.protoNames();return nt.length===1&&nt[0]===s}function et(tt){return tt.length===0?null:tt[0]===s?tt.slice(1):null}return{toString:function(){return s},matches:a,partialMatch:et}}const DEFAULT_BOOTSTRAP_TAG_NAME="bootstrap",DEFAULT_BOOTSTRAP_TAG_VALUE=50,DEFAULT_BOOTSTRAP_TAG_TTL=12e4,DEFAULT_BOOTSTRAP_DISCOVERY_TIMEOUT=1e3;class Bootstrap extends TypedEventEmitter{static tag="bootstrap";log;timer;list;timeout;components;_init;constructor(s,a={list:[]}){if(a.list==null||a.list.length===0)throw new Error("Bootstrap requires a list of peer addresses");super(),this.components=s,this.log=s.logger.forComponent("libp2p:bootstrap"),this.timeout=a.timeout??DEFAULT_BOOTSTRAP_DISCOVERY_TIMEOUT,this.list=[];for(const et of a.list){if(!P2P.matches(et)){this.log.error("Invalid multiaddr");continue}const tt=multiaddr(et),rt=tt.getPeerId();if(rt==null){this.log.error("Invalid bootstrap multiaddr without peer id");continue}const nt={id:peerIdFromString(rt),multiaddrs:[tt]};this.list.push(nt)}this._init=a}[peerDiscoverySymbol]=this;[Symbol.toStringTag]="@libp2p/bootstrap";[serviceCapabilities]=["@libp2p/peer-discovery"];isStarted(){return!!this.timer}start(){this.isStarted()||(this.log("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout(()=>{this._discoverBootstrapPeers().catch(s=>{this.log.error(s)})},this.timeout))}async _discoverBootstrapPeers(){if(this.timer!=null)for(const s of this.list){if(await this.components.peerStore.merge(s.id,{tags:{[this._init.tagName??DEFAULT_BOOTSTRAP_TAG_NAME]:{value:this._init.tagValue??DEFAULT_BOOTSTRAP_TAG_VALUE,ttl:this._init.tagTTL??DEFAULT_BOOTSTRAP_TAG_TTL}}}),this.timer==null)return;this.safeDispatchEvent("peer",{detail:s})}}stop(){this.timer!=null&&clearTimeout(this.timer),this.timer=void 0}}function bootstrap(o){return s=>new Bootstrap(s,o)}function equals$6(o,s){if(o===s)return!0;if(o.byteLength!==s.byteLength)return!1;for(let a=0;a<o.byteLength;a++)if(o[a]!==s[a])return!1;return!0}function allocUnsafe$d(o=0){return new Uint8Array(o)}function createCodec$d(o,s,a,et){return{name:o,prefix:s,encoder:{name:o,prefix:s,encode:a},decoder:{decode:et}}}const string$d=createCodec$d("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),ascii$d=createCodec$d("ascii","a",o=>{let s="a";for(let a=0;a<o.length;a++)s+=String.fromCharCode(o[a]);return s},o=>{o=o.substring(1);const s=allocUnsafe$d(o.length);for(let a=0;a<o.length;a++)s[a]=o.charCodeAt(a);return s}),BASES$d={utf8:string$d,"utf-8":string$d,hex:bases.base16,latin1:ascii$d,ascii:ascii$d,binary:ascii$d,...bases};function fromString$f(o,s="utf8"){const a=BASES$d[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.decoder.decode(`${a.prefix}${o}`)}const codes$6={ERR_SIGNATURE_NOT_VALID:"ERR_SIGNATURE_NOT_VALID"};var Envelope;(function(o){let s;o.codec=()=>(s==null&&(s=message((a,et,tt={})=>{tt.lengthDelimited!==!1&&et.fork(),a.publicKey!=null&&a.publicKey.byteLength>0&&(et.uint32(10),et.bytes(a.publicKey)),a.payloadType!=null&&a.payloadType.byteLength>0&&(et.uint32(18),et.bytes(a.payloadType)),a.payload!=null&&a.payload.byteLength>0&&(et.uint32(26),et.bytes(a.payload)),a.signature!=null&&a.signature.byteLength>0&&(et.uint32(42),et.bytes(a.signature)),tt.lengthDelimited!==!1&&et.ldelim()},(a,et)=>{const tt={publicKey:new Uint8Array(0),payloadType:new Uint8Array(0),payload:new Uint8Array(0),signature:new Uint8Array(0)},rt=et==null?a.len:a.pos+et;for(;a.pos<rt;){const nt=a.uint32();switch(nt>>>3){case 1:tt.publicKey=a.bytes();break;case 2:tt.payloadType=a.bytes();break;case 3:tt.payload=a.bytes();break;case 5:tt.signature=a.bytes();break;default:a.skipType(nt&7);break}}return tt})),s),o.encode=a=>encodeMessage(a,o.codec()),o.decode=a=>decodeMessage(a,o.codec())})(Envelope||(Envelope={}));class RecordEnvelope{static createFromProtobuf=async s=>{const a=Envelope.decode(s),et=await peerIdFromKeys(a.publicKey);return new RecordEnvelope({peerId:et,payloadType:a.payloadType,payload:a.payload,signature:a.signature})};static seal=async(s,a)=>{if(a.privateKey==null)throw new Error("Missing private key");const et=s.domain,tt=s.codec,rt=s.marshal(),nt=formatSignaturePayload(et,tt,rt),st=await(await unmarshalPrivateKey(a.privateKey)).sign(nt.subarray());return new RecordEnvelope({peerId:a,payloadType:tt,payload:rt,signature:st})};static openAndCertify=async(s,a)=>{const et=await RecordEnvelope.createFromProtobuf(s);if(!await et.validate(a))throw new CodeError$3("envelope signature is not valid for the given domain",codes$6.ERR_SIGNATURE_NOT_VALID);return et};peerId;payloadType;payload;signature;marshaled;constructor(s){const{peerId:a,payloadType:et,payload:tt,signature:rt}=s;this.peerId=a,this.payloadType=et,this.payload=tt,this.signature=rt}marshal(){if(this.peerId.publicKey==null)throw new Error("Missing public key");return this.marshaled==null&&(this.marshaled=Envelope.encode({publicKey:this.peerId.publicKey,payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(s){return equals$6(this.marshal(),s.marshal())}async validate(s){const a=formatSignaturePayload(s,this.payloadType,this.payload);if(this.peerId.publicKey==null)throw new Error("Missing public key");return unmarshalPublicKey(this.peerId.publicKey).verify(a.subarray(),this.signature)}}const formatSignaturePayload=(o,s,a)=>{const et=fromString$f(o),tt=encode$c(et.byteLength),rt=encode$c(s.length),nt=encode$c(a.length);return new Uint8ArrayList(tt,et,rt,s,nt,a)};function arrayEquals$1(o,s){const a=(et,tt)=>et.toString().localeCompare(tt.toString());return o.length!==s.length?!1:(s.sort(a),o.sort(a).every((et,tt)=>s[tt].equals(et)))}const ENVELOPE_DOMAIN_PEER_RECORD="libp2p-peer-record",ENVELOPE_PAYLOAD_TYPE_PEER_RECORD=Uint8Array.from([3,1]);var PeerRecord$1;(function(o){(function(a){let et;a.codec=()=>(et==null&&(et=message((tt,rt,nt={})=>{nt.lengthDelimited!==!1&&rt.fork(),tt.multiaddr!=null&&tt.multiaddr.byteLength>0&&(rt.uint32(10),rt.bytes(tt.multiaddr)),nt.lengthDelimited!==!1&&rt.ldelim()},(tt,rt)=>{const nt={multiaddr:new Uint8Array(0)},it=rt==null?tt.len:tt.pos+rt;for(;tt.pos<it;){const st=tt.uint32();switch(st>>>3){case 1:nt.multiaddr=tt.bytes();break;default:tt.skipType(st&7);break}}return nt})),et),a.encode=tt=>encodeMessage(tt,a.codec()),a.decode=tt=>decodeMessage(tt,a.codec())})(o.AddressInfo||(o.AddressInfo={}));let s;o.codec=()=>(s==null&&(s=message((a,et,tt={})=>{if(tt.lengthDelimited!==!1&&et.fork(),a.peerId!=null&&a.peerId.byteLength>0&&(et.uint32(10),et.bytes(a.peerId)),a.seq!=null&&a.seq!==0n&&(et.uint32(16),et.uint64(a.seq)),a.addresses!=null)for(const rt of a.addresses)et.uint32(26),o.AddressInfo.codec().encode(rt,et);tt.lengthDelimited!==!1&&et.ldelim()},(a,et)=>{const tt={peerId:new Uint8Array(0),seq:0n,addresses:[]},rt=et==null?a.len:a.pos+et;for(;a.pos<rt;){const nt=a.uint32();switch(nt>>>3){case 1:tt.peerId=a.bytes();break;case 2:tt.seq=a.uint64();break;case 3:tt.addresses.push(o.AddressInfo.codec().decode(a,a.uint32()));break;default:a.skipType(nt&7);break}}return tt})),s),o.encode=a=>encodeMessage(a,o.codec()),o.decode=a=>decodeMessage(a,o.codec())})(PeerRecord$1||(PeerRecord$1={}));class PeerRecord{static createFromProtobuf=s=>{const a=PeerRecord$1.decode(s),et=peerIdFromBytes(a.peerId),tt=(a.addresses??[]).map(nt=>multiaddr(nt.multiaddr)),rt=a.seq;return new PeerRecord({peerId:et,multiaddrs:tt,seqNumber:rt})};static DOMAIN=ENVELOPE_DOMAIN_PEER_RECORD;static CODEC=ENVELOPE_PAYLOAD_TYPE_PEER_RECORD;peerId;multiaddrs;seqNumber;domain=PeerRecord.DOMAIN;codec=PeerRecord.CODEC;marshaled;constructor(s){const{peerId:a,multiaddrs:et,seqNumber:tt}=s;this.peerId=a,this.multiaddrs=et??[],this.seqNumber=tt??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=PeerRecord$1.encode({peerId:this.peerId.toBytes(),seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(s=>({multiaddr:s.bytes}))})),this.marshaled}equals(s){return!(!(s instanceof PeerRecord)||!this.peerId.equals(s.peerId)||this.seqNumber!==s.seqNumber||!arrayEquals$1(this.multiaddrs,s.multiaddrs))}}function pbStream(o,s){const a=lpStream(o,s),et={read:async(tt,rt)=>{const nt=await a.read(rt);return tt.decode(nt)},write:async(tt,rt,nt)=>{await a.write(rt.encode(tt),nt)},writeV:async(tt,rt,nt)=>{await a.writeV(tt.map(it=>rt.encode(it)),nt)},pb:tt=>({read:async rt=>et.read(tt,rt),write:async(rt,nt)=>et.write(rt,tt,nt),writeV:async(rt,nt)=>et.writeV(rt,tt,nt),unwrap:()=>et}),unwrap:()=>a.unwrap()};return et}const CIRCUIT_PROTO_CODE=290,DEFAULT_RESERVATION_CONCURRENCY=1,DEFAULT_RESERVATION_COMPLETION_TIMEOUT=1e3,DEFAULT_MAX_RESERVATION_QUEUE_LENGTH=100,RELAY_TAG="circuit-relay-relay";BigInt(1<<17);const RELAY_V2_HOP_CODEC="/libp2p/circuit/relay/0.2.0/hop",RELAY_V2_STOP_CODEC="/libp2p/circuit/relay/0.2.0/stop",MAX_CONNECTIONS$1=300,ERR_RELAYED_DIAL="ERR_RELAYED_DIAL",ERR_HOP_REQUEST_FAILED="ERR_HOP_REQUEST_FAILED",DEFAULT_DISCOVERY_FILTER_SIZE=4096,DEFAULT_DISCOVERY_FILTER_ERROR_RATE=.001;function alloc$4(o=0){return new Uint8Array(o)}var HopMessage;(function(o){(function(et){et.RESERVE="RESERVE",et.CONNECT="CONNECT",et.STATUS="STATUS"})(o.Type||(o.Type={}));let s;(function(et){et[et.RESERVE=0]="RESERVE",et[et.CONNECT=1]="CONNECT",et[et.STATUS=2]="STATUS"})(s||(s={})),function(et){et.codec=()=>enumeration(s)}(o.Type||(o.Type={}));let a;o.codec=()=>(a==null&&(a=message((et,tt,rt={})=>{rt.lengthDelimited!==!1&&tt.fork(),et.type!=null&&(tt.uint32(8),o.Type.codec().encode(et.type,tt)),et.peer!=null&&(tt.uint32(18),Peer$2.codec().encode(et.peer,tt)),et.reservation!=null&&(tt.uint32(26),Reservation.codec().encode(et.reservation,tt)),et.limit!=null&&(tt.uint32(34),Limit.codec().encode(et.limit,tt)),et.status!=null&&(tt.uint32(40),Status.codec().encode(et.status,tt)),rt.lengthDelimited!==!1&&tt.ldelim()},(et,tt,rt={})=>{const nt={},it=tt==null?et.len:et.pos+tt;for(;et.pos<it;){const st=et.uint32();switch(st>>>3){case 1:{nt.type=o.Type.codec().decode(et);break}case 2:{nt.peer=Peer$2.codec().decode(et,et.uint32(),{limits:rt.limits?.peer});break}case 3:{nt.reservation=Reservation.codec().decode(et,et.uint32(),{limits:rt.limits?.reservation});break}case 4:{nt.limit=Limit.codec().decode(et,et.uint32(),{limits:rt.limits?.limit});break}case 5:{nt.status=Status.codec().decode(et);break}default:{et.skipType(st&7);break}}}return nt})),a),o.encode=et=>encodeMessage(et,o.codec()),o.decode=(et,tt)=>decodeMessage(et,o.codec(),tt)})(HopMessage||(HopMessage={}));var StopMessage;(function(o){(function(et){et.CONNECT="CONNECT",et.STATUS="STATUS"})(o.Type||(o.Type={}));let s;(function(et){et[et.CONNECT=0]="CONNECT",et[et.STATUS=1]="STATUS"})(s||(s={})),function(et){et.codec=()=>enumeration(s)}(o.Type||(o.Type={}));let a;o.codec=()=>(a==null&&(a=message((et,tt,rt={})=>{rt.lengthDelimited!==!1&&tt.fork(),et.type!=null&&(tt.uint32(8),o.Type.codec().encode(et.type,tt)),et.peer!=null&&(tt.uint32(18),Peer$2.codec().encode(et.peer,tt)),et.limit!=null&&(tt.uint32(26),Limit.codec().encode(et.limit,tt)),et.status!=null&&(tt.uint32(32),Status.codec().encode(et.status,tt)),rt.lengthDelimited!==!1&&tt.ldelim()},(et,tt,rt={})=>{const nt={},it=tt==null?et.len:et.pos+tt;for(;et.pos<it;){const st=et.uint32();switch(st>>>3){case 1:{nt.type=o.Type.codec().decode(et);break}case 2:{nt.peer=Peer$2.codec().decode(et,et.uint32(),{limits:rt.limits?.peer});break}case 3:{nt.limit=Limit.codec().decode(et,et.uint32(),{limits:rt.limits?.limit});break}case 4:{nt.status=Status.codec().decode(et);break}default:{et.skipType(st&7);break}}}return nt})),a),o.encode=et=>encodeMessage(et,o.codec()),o.decode=(et,tt)=>decodeMessage(et,o.codec(),tt)})(StopMessage||(StopMessage={}));var Peer$2;(function(o){let s;o.codec=()=>(s==null&&(s=message((a,et,tt={})=>{if(tt.lengthDelimited!==!1&&et.fork(),a.id!=null&&a.id.byteLength>0&&(et.uint32(10),et.bytes(a.id)),a.addrs!=null)for(const rt of a.addrs)et.uint32(18),et.bytes(rt);tt.lengthDelimited!==!1&&et.ldelim()},(a,et,tt={})=>{const rt={id:alloc$4(0),addrs:[]},nt=et==null?a.len:a.pos+et;for(;a.pos<nt;){const it=a.uint32();switch(it>>>3){case 1:{rt.id=a.bytes();break}case 2:{if(tt.limits?.addrs!=null&&rt.addrs.length===tt.limits.addrs)throw new CodeError$2('decode error - map field "addrs" had too many elements',"ERR_MAX_LENGTH");rt.addrs.push(a.bytes());break}default:{a.skipType(it&7);break}}}return rt})),s),o.encode=a=>encodeMessage(a,o.codec()),o.decode=(a,et)=>decodeMessage(a,o.codec(),et)})(Peer$2||(Peer$2={}));var Reservation;(function(o){let s;o.codec=()=>(s==null&&(s=message((a,et,tt={})=>{if(tt.lengthDelimited!==!1&&et.fork(),a.expire!=null&&a.expire!==0n&&(et.uint32(8),et.uint64(a.expire)),a.addrs!=null)for(const rt of a.addrs)et.uint32(18),et.bytes(rt);a.voucher!=null&&(et.uint32(26),et.bytes(a.voucher)),tt.lengthDelimited!==!1&&et.ldelim()},(a,et,tt={})=>{const rt={expire:0n,addrs:[]},nt=et==null?a.len:a.pos+et;for(;a.pos<nt;){const it=a.uint32();switch(it>>>3){case 1:{rt.expire=a.uint64();break}case 2:{if(tt.limits?.addrs!=null&&rt.addrs.length===tt.limits.addrs)throw new CodeError$2('decode error - map field "addrs" had too many elements',"ERR_MAX_LENGTH");rt.addrs.push(a.bytes());break}case 3:{rt.voucher=a.bytes();break}default:{a.skipType(it&7);break}}}return rt})),s),o.encode=a=>encodeMessage(a,o.codec()),o.decode=(a,et)=>decodeMessage(a,o.codec(),et)})(Reservation||(Reservation={}));var Limit;(function(o){let s;o.codec=()=>(s==null&&(s=message((a,et,tt={})=>{tt.lengthDelimited!==!1&&et.fork(),a.duration!=null&&(et.uint32(8),et.uint32(a.duration)),a.data!=null&&(et.uint32(16),et.uint64(a.data)),tt.lengthDelimited!==!1&&et.ldelim()},(a,et,tt={})=>{const rt={},nt=et==null?a.len:a.pos+et;for(;a.pos<nt;){const it=a.uint32();switch(it>>>3){case 1:{rt.duration=a.uint32();break}case 2:{rt.data=a.uint64();break}default:{a.skipType(it&7);break}}}return rt})),s),o.encode=a=>encodeMessage(a,o.codec()),o.decode=(a,et)=>decodeMessage(a,o.codec(),et)})(Limit||(Limit={}));var Status;(function(o){o.UNUSED="UNUSED",o.OK="OK",o.RESERVATION_REFUSED="RESERVATION_REFUSED",o.RESOURCE_LIMIT_EXCEEDED="RESOURCE_LIMIT_EXCEEDED",o.PERMISSION_DENIED="PERMISSION_DENIED",o.CONNECTION_FAILED="CONNECTION_FAILED",o.NO_RESERVATION="NO_RESERVATION",o.MALFORMED_MESSAGE="MALFORMED_MESSAGE",o.UNEXPECTED_MESSAGE="UNEXPECTED_MESSAGE"})(Status||(Status={}));var __StatusValues;(function(o){o[o.UNUSED=0]="UNUSED",o[o.OK=100]="OK",o[o.RESERVATION_REFUSED=200]="RESERVATION_REFUSED",o[o.RESOURCE_LIMIT_EXCEEDED=201]="RESOURCE_LIMIT_EXCEEDED",o[o.PERMISSION_DENIED=202]="PERMISSION_DENIED",o[o.CONNECTION_FAILED=203]="CONNECTION_FAILED",o[o.NO_RESERVATION=204]="NO_RESERVATION",o[o.MALFORMED_MESSAGE=400]="MALFORMED_MESSAGE",o[o.UNEXPECTED_MESSAGE=401]="UNEXPECTED_MESSAGE"})(__StatusValues||(__StatusValues={}));(function(o){o.codec=()=>enumeration(__StatusValues)})(Status||(Status={}));var ReservationVoucher;(function(o){let s;o.codec=()=>(s==null&&(s=message((a,et,tt={})=>{tt.lengthDelimited!==!1&&et.fork(),a.relay!=null&&a.relay.byteLength>0&&(et.uint32(10),et.bytes(a.relay)),a.peer!=null&&a.peer.byteLength>0&&(et.uint32(18),et.bytes(a.peer)),a.expiration!=null&&a.expiration!==0n&&(et.uint32(24),et.uint64(a.expiration)),tt.lengthDelimited!==!1&&et.ldelim()},(a,et,tt={})=>{const rt={relay:alloc$4(0),peer:alloc$4(0),expiration:0n},nt=et==null?a.len:a.pos+et;for(;a.pos<nt;){const it=a.uint32();switch(it>>>3){case 1:{rt.relay=a.bytes();break}case 2:{rt.peer=a.bytes();break}case 3:{rt.expiration=a.uint64();break}default:{a.skipType(it&7);break}}}return rt})),s),o.encode=a=>encodeMessage(a,o.codec()),o.decode=(a,et)=>decodeMessage(a,o.codec(),et)})(ReservationVoucher||(ReservationVoucher={}));function getExpirationMilliseconds(o){const s=o*BigInt(1e3),a=new Date().getTime();return Number(s-BigInt(a))}function streamToMaConnection(o){const{stream:s,remoteAddr:a,logger:et}=o,tt=et.forComponent("libp2p:stream:converter");let rt=!1,nt=!1;const it=s.close.bind(s);s.close=async ct=>{await it(ct),lt(!0)};const st=s.abort.bind(s);s.abort=ct=>{st(ct),lt(!0)};const ot=s.sink.bind(s);s.sink=async ct=>{try{await ot(ct)}catch(ht){ht.type!=="aborted"&&tt.error("%s error in sink",a,ht)}finally{nt=!0,lt()}};const at={log:tt,sink:s.sink,source:async function*(){try{for await(const ct of s.source)ct instanceof Uint8Array?yield ct:yield*ct}finally{rt=!0,lt()}}(),remoteAddr:a,timeline:{open:Date.now(),close:void 0},close:s.close,abort:s.abort};function lt(ct){ct===!0&&(rt=!0,nt=!0),rt&&nt&&at.timeline.close==null&&(at.timeline.close=Date.now())}return at}class RelayDiscovery extends TypedEventEmitter{peerStore;registrar;connectionManager;randomWalk;started;running;topologyId;log;discoveryController;filter;constructor(s,a={}){super(),this.log=s.logger.forComponent("libp2p:circuit-relay:discover-relays"),this.started=!1,this.running=!1,this.peerStore=s.peerStore,this.registrar=s.registrar,this.connectionManager=s.connectionManager,this.randomWalk=s.randomWalk,this.filter=a.filter,this.discoveryController=new AbortController,setMaxListeners(1/0,this.discoveryController.signal)}isStarted(){return this.started}async start(){this.topologyId=await this.registrar.register(RELAY_V2_HOP_CODEC,{filter:this.filter,onConnect:s=>{this.log("discovered relay %p",s),this.safeDispatchEvent("relay:discover",{detail:s})}}),this.started=!0}stop(){this.topologyId!=null&&this.registrar.unregister(this.topologyId),this.discoveryController?.abort(),this.started=!1}startDiscovery(){this.running||(this.log("start discovery"),this.running=!0,this.discoveryController=new AbortController,setMaxListeners(1/0,this.discoveryController.signal),Promise.resolve().then(async()=>{this.log("searching peer store for relays");const s=await this.peerStore.all({filters:[et=>et.protocols.includes(RELAY_V2_HOP_CODEC)],orders:[()=>Math.random()<.5?1:-1]});for(const et of s)this.log.trace("found relay peer %p in peer store",et.id),this.safeDispatchEvent("relay:discover",{detail:et.id});this.log("found %d relay peers in peer store",s.length);const a=new PeerQueue({concurrency:5});this.log("start random walk");for await(const et of this.randomWalk.walk({signal:this.discoveryController.signal})){if(this.log.trace("found random peer %p",et.id),a.has(et.id)){this.log.trace("random peer %p was already in queue",et.id);continue}if(this.connectionManager.getConnections(et.id)?.length>0){this.log.trace("random peer %p was already connected",et.id);continue}if(!await this.connectionManager.isDialable(et.multiaddrs)){this.log.trace("random peer %p was not dialable",et.id,et.multiaddrs.map(tt=>tt.toString()));continue}this.log.trace("wait for space in queue for %p",et.id),await raceSignal(a.onSizeLessThan(10),this.discoveryController.signal),this.log("adding random peer %p to dial queue (length: %d)",et.id,a.size),a.add(async()=>{const tt=anySignal([this.discoveryController.signal,AbortSignal.timeout(5e3)]);setMaxListeners(1/0,tt);try{await this.connectionManager.openConnection(et.id,{signal:tt})}finally{tt.clear()}},{peerId:et.id,signal:this.discoveryController.signal}).catch(tt=>{this.log.error("error opening connection to random peer %p",et.id,tt)})}await a.onIdle()}).catch(s=>{this.discoveryController.signal.aborted||this.log.error("failed when finding relays on the network",s)}))}stopDiscovery(){this.log("stop discovery"),this.running=!1,this.discoveryController?.abort()}}class CircuitRelayTransportListener extends TypedEventEmitter{connectionManager;relayStore;listeningAddrs;log;constructor(s){super(),this.log=s.logger.forComponent("libp2p:circuit-relay:transport:listener"),this.connectionManager=s.connectionManager,this.relayStore=s.relayStore,this.listeningAddrs=new PeerMap,this.relayStore.addEventListener("relay:removed",this._onRemoveRelayPeer)}_onRemoveRelayPeer=s=>{this.#e(s.detail)};async listen(s){this.log("listen on %a",s);const a=s.decapsulate("/p2p-circuit"),et=await this.connectionManager.openConnection(a);if(!this.relayStore.hasReservation(et.remotePeer)){this.log("making reservation on peer %p",et.remotePeer),await this.relayStore.addRelay(et.remotePeer,"configured");return}const tt=this.relayStore.getReservation(et.remotePeer);if(tt==null)throw new CodeError$3("Did not have reservation after making reservation","ERR_NO_RESERVATION");if(this.listeningAddrs.has(et.remotePeer)){this.log("already listening on relay %p",et.remotePeer);return}this.listeningAddrs.set(et.remotePeer,tt.addrs.map(rt=>multiaddr(rt).encapsulate("/p2p-circuit"))),this.safeDispatchEvent("listening",{})}getAddrs(){return[...this.listeningAddrs.values()].flat()}async close(){}#e(s){const a=this.listeningAddrs.has(s);this.log("relay peer removed %p - had reservation",s,a),this.listeningAddrs.delete(s),a&&(this.log.trace("removing relay event listener for peer %p",s),this.relayStore.removeEventListener("relay:removed",this._onRemoveRelayPeer),this.safeDispatchEvent("close",{}))}}function createListener$2(o){return new CircuitRelayTransportListener(o)}function equals$5(o,s){if(o===s)return!0;if(o.byteLength!==s.byteLength)return!1;for(let a=0;a<o.byteLength;a++)if(o[a]!==s[a])return!1;return!0}const REFRESH_WINDOW=60*1e3*10,REFRESH_TIMEOUT=60*1e3*5,REFRESH_TIMEOUT_MIN=30*1e3;class ReservationStore extends TypedEventEmitter{peerId;connectionManager;transportManager;peerStore;events;reserveQueue;reservations;maxDiscoveredRelays;maxReservationQueueLength;reservationCompletionTimeout;started;log;relayFilter;constructor(s,a){super(),this.log=s.logger.forComponent("libp2p:circuit-relay:transport:reservation-store"),this.peerId=s.peerId,this.connectionManager=s.connectionManager,this.transportManager=s.transportManager,this.peerStore=s.peerStore,this.events=s.events,this.reservations=new PeerMap,this.maxDiscoveredRelays=a?.discoverRelays??0,this.maxReservationQueueLength=a?.maxReservationQueueLength??DEFAULT_MAX_RESERVATION_QUEUE_LENGTH,this.reservationCompletionTimeout=a?.reservationCompletionTimeout??DEFAULT_RESERVATION_COMPLETION_TIMEOUT,this.started=!1,this.relayFilter=createBloomFilter(100),this.reserveQueue=new PeerQueue({concurrency:a?.reservationConcurrency??DEFAULT_RESERVATION_CONCURRENCY,metricName:"libp2p_relay_reservation_queue",metrics:s.metrics}),this.events.addEventListener("peer:disconnect",et=>{this.#t(et.detail)})}isStarted(){return this.started}start(){this.started=!0}afterStart(){this.reservations.size<this.maxDiscoveredRelays&&(this.log("not enough relays %d/%d",this.reservations.size,this.maxDiscoveredRelays),this.safeDispatchEvent("relay:not-enough-relays",{}))}stop(){this.reserveQueue.clear(),this.reservations.forEach(({timeout:s})=>{clearTimeout(s)}),this.reservations.clear(),this.started=!1}async addRelay(s,a){if(this.peerId.equals(s)){this.log("not trying to use self as relay");return}if(this.reserveQueue.size>this.maxReservationQueueLength){this.log("not adding potential relay peer %p as the queue is full",s);return}if(this.reserveQueue.has(s)){this.log("potential relay peer %p is already in the reservation queue",s);return}if(this.relayFilter.has(s.toBytes())){this.log("potential relay peer %p has failed previously, not trying again",s);return}this.log("try to reserve relay slot with %p",s),await this.reserveQueue.add(async()=>{const et=Date.now();try{const tt=this.reservations.get(s);if(tt!=null){if(getExpirationMilliseconds(tt.reservation.expire)>REFRESH_WINDOW){this.log("already have reservation on relay peer %p and it expires in more than 10 minutes",s);return}clearTimeout(tt.timeout),this.reservations.delete(s)}if(a==="discovered"&&[...this.reservations.values()].reduce((lt,ct)=>(ct.type==="discovered"&&lt++,lt),0)>=this.maxDiscoveredRelays){this.log("already have enough discovered relays");return}const rt=AbortSignal.timeout(this.reservationCompletionTimeout);setMaxListeners(1/0,rt);const nt=await this.connectionManager.openConnection(s,{signal:rt});if(nt.remoteAddr.protoNames().includes("p2p-circuit")){this.log("not creating reservation over relayed connection");return}const it=await this.#e(nt,{signal:rt});this.log("created reservation on relay peer %p",s);const st=getExpirationMilliseconds(it.expire),ot=Math.min(Math.max(st-REFRESH_TIMEOUT,REFRESH_TIMEOUT_MIN),Math.pow(2,31)-1),at=setTimeout(()=>{this.addRelay(s,a).catch(lt=>{this.log.error("could not refresh reservation to relay %p",s,lt)})},ot);this.reservations.set(s,{timeout:at,reservation:it,type:a}),await this.peerStore.merge(s,{tags:{[RELAY_TAG]:{value:1,ttl:st}}}),await this.transportManager.listen([multiaddr(`/p2p/${s.toString()}/p2p-circuit`)]),this.safeDispatchEvent("relay:created-reservation",{detail:s})}catch(tt){this.log.error("could not reserve slot on %p after %dms",s,Date.now()-et,tt);const rt=this.reservations.get(s);rt!=null&&clearTimeout(rt.timeout),this.reservations.delete(s),this.relayFilter.add(s.toBytes())}},{peerId:s})}hasReservation(s){return this.reservations.has(s)}getReservation(s){return this.reservations.get(s)?.reservation}reservationCount(){return this.reservations.size}async#e(s,a){a.signal?.throwIfAborted(),this.log("requesting reservation from %p",s.remotePeer);const et=await s.newStream(RELAY_V2_HOP_CODEC,a),rt=pbStream(et).pb(HopMessage);await rt.write({type:HopMessage.Type.RESERVE},a);let nt;try{nt=await rt.read(a)}catch(st){throw et.abort(st),st}finally{et.status!=="closed"&&await et.close(a)}if(nt.status===Status.OK&&nt.reservation!=null){let st=!1;const ot=s.remoteAddr.bytes;for(const at of nt.reservation.addrs)if(equals$5(ot,at)){st=!0;break}return st||nt.reservation.addrs.push(ot),nt.reservation}const it=`reservation failed with status ${nt.status??"undefined"}`;throw this.log.error(it),new Error(it)}#t(s){const a=this.reservations.get(s);a!=null&&(this.log("connection to relay %p closed, removing reservation from local store",s),clearTimeout(a.timeout),this.reservations.delete(s),this.safeDispatchEvent("relay:removed",{detail:s}),this.reservations.size<this.maxDiscoveredRelays&&(this.log("not enough relays %d/%d",this.reservations.size,this.maxDiscoveredRelays),this.safeDispatchEvent("relay:not-enough-relays",{})))}}const isValidStop=o=>{if(o.peer==null)return!1;try{o.peer.addrs.forEach(multiaddr)}catch{return!1}return!0},defaults$3={maxInboundStopStreams:MAX_CONNECTIONS$1,maxOutboundStopStreams:MAX_CONNECTIONS$1,stopTimeout:3e4};class CircuitRelayTransport{discovery;registrar;peerStore;connectionManager;transportManager;peerId;upgrader;addressManager;connectionGater;reservationStore;logger;maxInboundStopStreams;maxOutboundStopStreams;stopTimeout;started;log;constructor(s,a){this.log=s.logger.forComponent("libp2p:circuit-relay:transport"),this.registrar=s.registrar,this.peerStore=s.peerStore,this.connectionManager=s.connectionManager,this.transportManager=s.transportManager,this.logger=s.logger,this.peerId=s.peerId,this.upgrader=s.upgrader,this.addressManager=s.addressManager,this.connectionGater=s.connectionGater,this.maxInboundStopStreams=a.maxInboundStopStreams??defaults$3.maxInboundStopStreams,this.maxOutboundStopStreams=a.maxOutboundStopStreams??defaults$3.maxOutboundStopStreams,this.stopTimeout=a.stopTimeout??defaults$3.stopTimeout;const et=a.discoverRelays??0;et>0&&(this.discovery=new RelayDiscovery(s,{filter:a.discoveryFilter??peerFilter(DEFAULT_DISCOVERY_FILTER_SIZE,DEFAULT_DISCOVERY_FILTER_ERROR_RATE)}),this.discovery.addEventListener("relay:discover",tt=>{this.reservationStore.addRelay(tt.detail,"discovered").catch(rt=>{this.log.error("could not add discovered relay %p",tt.detail,rt)})})),this.reservationStore=new ReservationStore(s,a),this.reservationStore.addEventListener("relay:not-enough-relays",()=>{this.discovery?.startDiscovery()}),this.reservationStore.addEventListener("relay:created-reservation",()=>{this.reservationStore.reservationCount()>=et&&this.discovery?.stopDiscovery()}),this.started=!1}[Symbol.toStringTag]="@libp2p/circuit-relay-v2-transport";[serviceCapabilities]=["@libp2p/transport","@libp2p/circuit-relay-v2-transport"];get[serviceDependencies](){return this.discovery!=null?["@libp2p/identify"]:[]}[transportSymbol]=!0;isStarted(){return this.started}async start(){await this.registrar.handle(RELAY_V2_STOP_CODEC,s=>{this.onStop(s).catch(a=>{this.log.error("error while handling STOP protocol",a),s.stream.abort(a)})},{maxInboundStreams:this.maxInboundStopStreams,maxOutboundStreams:this.maxOutboundStopStreams,runOnTransientConnection:!0}),await start(this.discovery,this.reservationStore),this.started=!0}async stop(){await stop(this.discovery,this.reservationStore),await this.registrar.unhandle(RELAY_V2_STOP_CODEC),this.started=!1}async dial(s,a={}){if(s.protoCodes().filter(ft=>ft===CIRCUIT_PROTO_CODE).length!==1){const ft="Invalid circuit relay address";throw this.log.error(ft,s),new CodeError$3(ft,ERR_RELAYED_DIAL)}const et=s.toString().split("/p2p-circuit"),tt=multiaddr(et[0]),rt=multiaddr(et[et.length-1]),nt=tt.getPeerId(),it=rt.getPeerId();if(nt==null||it==null){const ft=`Circuit relay dial to ${s.toString()} failed as address did not have peer ids`;throw this.log.error(ft),new CodeError$3(ft,ERR_RELAYED_DIAL)}const st=peerIdFromString(nt),ot=peerIdFromString(it);let at=!1,ct=this.connectionManager.getConnections(st)[0];ct==null&&(await this.peerStore.merge(st,{multiaddrs:[tt]}),ct=await this.connectionManager.openConnection(st,a),at=!0);let ht;try{return ht=await ct.newStream(RELAY_V2_HOP_CODEC),await this.connectV2({stream:ht,connection:ct,destinationPeer:ot,destinationAddr:rt,relayAddr:tt,ma:s,disconnectOnFailure:at})}catch(ft){throw this.log.error("circuit relay dial to destination %p via relay %p failed",ot,st,ft),ht?.abort(ft),at&&await ct.close(),ft}}async connectV2({stream:s,connection:a,destinationPeer:et,destinationAddr:tt,relayAddr:rt,ma:nt,disconnectOnFailure:it}){try{const st=pbStream(s),ot=st.pb(HopMessage);await ot.write({type:HopMessage.Type.CONNECT,peer:{id:et.toBytes(),addrs:[multiaddr(tt).bytes]}});const at=await ot.read();if(at.status!==Status.OK)throw new CodeError$3(`failed to connect via relay with status ${at?.status?.toString()??"undefined"}`,ERR_HOP_REQUEST_FAILED);const lt=streamToMaConnection({stream:st.unwrap(),remoteAddr:nt,localAddr:rt.encapsulate(`/p2p-circuit/p2p/${this.peerId.toString()}`),logger:this.logger});return this.log("new outbound relayed connection %a",lt.remoteAddr),await this.upgrader.upgradeOutbound(lt,{transient:at.limit!=null})}catch(st){throw this.log.error(`Circuit relay dial to destination ${et.toString()} via relay ${a.remotePeer.toString()} failed`,st),it&&await a.close(),st}}createListener(s){return createListener$2({connectionManager:this.connectionManager,relayStore:this.reservationStore,logger:this.logger})}listenFilter(s){return s=Array.isArray(s)?s:[s],s.filter(a=>Circuit.matches(a))}dialFilter(s){return this.listenFilter(s)}async onStop({connection:s,stream:a}){if(!this.reservationStore.hasReservation(s.remotePeer))try{this.log("dialed via relay we did not have a reservation on, start listening on that relay address"),await this.transportManager.listen([s.remoteAddr.encapsulate("/p2p-circuit")])}catch(at){this.log.error("failed to listen on a relay peer we were dialed via but did not have a reservation on",at)}const et=AbortSignal.timeout(this.stopTimeout),tt=pbStream(a).pb(StopMessage),rt=await tt.read({signal:et});if(this.log("new circuit relay v2 stop stream from %p with type %s",s.remotePeer,rt.type),rt?.type===void 0){this.log.error("type was missing from circuit v2 stop protocol request from %s",s.remotePeer),await tt.write({type:StopMessage.Type.STATUS,status:Status.MALFORMED_MESSAGE},{signal:et}),await a.close();return}if(rt.type!==StopMessage.Type.CONNECT){this.log.error("invalid stop connect request via peer %p",s.remotePeer),await tt.write({type:StopMessage.Type.STATUS,status:Status.UNEXPECTED_MESSAGE},{signal:et}),await a.close();return}if(!isValidStop(rt)){this.log.error("invalid stop connect request via peer %p",s.remotePeer),await tt.write({type:StopMessage.Type.STATUS,status:Status.MALFORMED_MESSAGE},{signal:et}),await a.close();return}const nt=peerIdFromBytes(rt.peer.id);if(await this.connectionGater.denyInboundRelayedConnection?.(s.remotePeer,nt)===!0){this.log.error("connection gater denied inbound relayed connection from %p",s.remotePeer),await tt.write({type:StopMessage.Type.STATUS,status:Status.PERMISSION_DENIED},{signal:et}),await a.close();return}this.log.trace("sending success response to %p",s.remotePeer),await tt.write({type:StopMessage.Type.STATUS,status:Status.OK},{signal:et});const it=s.remoteAddr.encapsulate(`/p2p-circuit/p2p/${nt.toString()}`),st=this.addressManager.getAddresses()[0],ot=streamToMaConnection({stream:tt.unwrap().unwrap(),remoteAddr:it,localAddr:st,logger:this.logger});this.log("new inbound relayed connection %a",ot.remoteAddr),await this.upgrader.upgradeInbound(ot,{transient:rt.limit!=null}),this.log("%s connection %a upgraded","inbound",ot.remoteAddr)}}function circuitRelayTransport(o={}){return s=>new CircuitRelayTransport(s,o)}const createAbortError=()=>{const o=new Error("Delay aborted");return o.name="AbortError",o},clearMethods=new WeakMap;function createDelay({clearTimeout:o,setTimeout:s}={}){return(a,{value:et,signal:tt}={})=>{if(tt?.aborted)return Promise.reject(createAbortError());let rt,nt,it;const st=o??clearTimeout,ot=()=>{st(rt),it(createAbortError())},at=()=>{tt&&tt.removeEventListener("abort",ot)},lt=new Promise((ct,ht)=>{nt=()=>{at(),ct(et)},it=ht,rt=(s??setTimeout)(nt,a)});return tt&&tt.addEventListener("abort",ot,{once:!0}),clearMethods.set(lt,()=>{st(rt),rt=null,nt()}),lt}}const delay=createDelay();var HolePunch;(function(o){(function(et){et.UNUSED="UNUSED",et.CONNECT="CONNECT",et.SYNC="SYNC"})(o.Type||(o.Type={}));let s;(function(et){et[et.UNUSED=0]="UNUSED",et[et.CONNECT=100]="CONNECT",et[et.SYNC=300]="SYNC"})(s||(s={})),function(et){et.codec=()=>enumeration(s)}(o.Type||(o.Type={}));let a;o.codec=()=>(a==null&&(a=message((et,tt,rt={})=>{if(rt.lengthDelimited!==!1&&tt.fork(),et.type!=null&&(tt.uint32(8),o.Type.codec().encode(et.type,tt)),et.observedAddresses!=null)for(const nt of et.observedAddresses)tt.uint32(18),tt.bytes(nt);rt.lengthDelimited!==!1&&tt.ldelim()},(et,tt)=>{const rt={observedAddresses:[]},nt=tt==null?et.len:et.pos+tt;for(;et.pos<nt;){const it=et.uint32();switch(it>>>3){case 1:rt.type=o.Type.codec().decode(et);break;case 2:rt.observedAddresses.push(et.bytes());break;default:et.skipType(it&7);break}}return rt})),a),o.encode=et=>encodeMessage(et,o.codec()),o.decode=et=>decodeMessage(et,o.codec())})(HolePunch||(HolePunch={}));function isPublicAndDialable(o,s){return Circuit$1.matches(o)||s.dialTransportForMultiaddr(o)==null?!1:DNS$1.matches(o)?!0:IP$1.matches(o)?isPrivateIp(o.toOptions().host)===!1:!1}const MAX_DCUTR_MESSAGE_SIZE=1024*4,DCUTR_DIAL_PRIORITY=100,defaultValues$1={timeout:5e3,retries:3,maxInboundStreams:1,maxOutboundStreams:1};class DefaultDCUtRService{started;timeout;retries;maxInboundStreams;maxOutboundStreams;peerStore;registrar;connectionManager;addressManager;transportManager;topologyId;log;constructor(s,a){this.log=s.logger.forComponent("libp2p:dcutr"),this.started=!1,this.peerStore=s.peerStore,this.registrar=s.registrar,this.addressManager=s.addressManager,this.connectionManager=s.connectionManager,this.transportManager=s.transportManager,this.timeout=a.timeout??defaultValues$1.timeout,this.retries=a.retries??defaultValues$1.retries,this.maxInboundStreams=a.maxInboundStreams??defaultValues$1.maxInboundStreams,this.maxOutboundStreams=a.maxOutboundStreams??defaultValues$1.maxOutboundStreams}[Symbol.toStringTag]="@libp2p/dcutr";[serviceDependencies]=["@libp2p/identify"];isStarted(){return this.started}async start(){this.started||(this.topologyId=await this.registrar.register(multicodec,{notifyOnTransient:!0,onConnect:(s,a)=>{a.transient&&a.direction==="inbound"&&this.upgradeInbound(a).catch(et=>{this.log.error("error during outgoing DCUtR attempt",et)})}}),await this.registrar.handle(multicodec,s=>{this.handleIncomingUpgrade(s.stream,s.connection).catch(a=>{this.log.error("error during incoming DCUtR attempt",a),s.stream.abort(a)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnTransientConnection:!0}),this.started=!0)}async stop(){await this.registrar.unhandle(multicodec),this.topologyId!=null&&this.registrar.unregister(this.topologyId),this.started=!1}async upgradeInbound(s){if(await this.attemptUnilateralConnectionUpgrade(s))return;let a;for(let et=0;et<this.retries;et++){const tt={signal:AbortSignal.timeout(this.timeout)};try{a=await s.newStream([multicodec],{signal:tt.signal,runOnTransientConnection:!0});const rt=pbStream(a,{maxDataLength:MAX_DCUTR_MESSAGE_SIZE}).pb(HolePunch);this.log("B sending connect to %p",s.remotePeer);const nt=Date.now();await rt.write({type:HolePunch.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map(lt=>lt.bytes)},tt),this.log("B receiving connect from %p",s.remotePeer);const it=await rt.read(tt);if(it.type!==HolePunch.Type.CONNECT)throw this.log("A sent wrong message type"),new CodeError$3("DCUtR message type was incorrect",ERR_INVALID_MESSAGE);const st=this.getDialableMultiaddrs(it.observedAddresses);if(st.length===0)throw this.log("A did not have any dialable multiaddrs"),new CodeError$3("DCUtR connect message had no multiaddrs",ERR_INVALID_MESSAGE);const ot=Date.now()-nt;this.log("A sending sync, rtt %dms",ot),await rt.write({type:HolePunch.Type.SYNC,observedAddresses:[]},tt),this.log("A waiting for half RTT"),await delay(ot/2),this.log("B dialing",st);const at=await this.connectionManager.openConnection(st,{signal:tt.signal,priority:DCUTR_DIAL_PRIORITY});this.log("DCUtR to %p succeeded to address %a, closing relayed connection",s.remotePeer,at.remoteAddr),await s.close(tt);break}catch(rt){if(this.log.error("error while attempting DCUtR on attempt %d of %d",et+1,this.retries,rt),a?.abort(rt),et===this.retries)throw rt}finally{a!=null&&await a.close(tt)}}}async attemptUnilateralConnectionUpgrade(s){const et=(await this.peerStore.get(s.remotePeer)).addresses.map(tt=>{const rt=tt.multiaddr;return rt.getPeerId()==null?rt.encapsulate(`/p2p/${s.remotePeer}`):rt}).filter(tt=>isPublicAndDialable(tt,this.transportManager));if(et.length>0){const tt=AbortSignal.timeout(this.timeout);try{this.log("attempting unilateral connection upgrade to %a",et);const rt=await this.connectionManager.openConnection(et,{signal:tt,force:!0});if(rt.transient)throw new Error("Could not open a new, non-transient, connection");return this.log("unilateral connection upgrade to %p succeeded via %a, closing relayed connection",s.remotePeer,rt.remoteAddr),await s.close({signal:tt}),!0}catch(rt){this.log.error("unilateral connection upgrade to %p on addresses %a failed",s.remotePeer,et,rt)}}else this.log("peer %p has no public addresses, not attempting unilateral connection upgrade",s.remotePeer);return!1}async handleIncomingUpgrade(s,a){const et={signal:AbortSignal.timeout(this.timeout)};try{const tt=pbStream(s,{maxDataLength:MAX_DCUTR_MESSAGE_SIZE}).pb(HolePunch);this.log("A receiving connect");const rt=await tt.read(et);if(rt.type!==HolePunch.Type.CONNECT)throw this.log("B sent wrong message type"),new CodeError$3("DCUtR message type was incorrect",ERR_INVALID_MESSAGE);if(rt.observedAddresses.length===0)throw this.log("B sent no multiaddrs"),new CodeError$3("DCUtR connect message had no multiaddrs",ERR_INVALID_MESSAGE);const nt=this.getDialableMultiaddrs(rt.observedAddresses);if(nt.length===0)throw this.log("B had no dialable multiaddrs"),new CodeError$3("DCUtR connect message had no dialable multiaddrs",ERR_INVALID_MESSAGE);if(this.log("A sending connect"),await tt.write({type:HolePunch.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map(ot=>ot.bytes)}),this.log("A receiving sync"),(await tt.read(et)).type!==HolePunch.Type.SYNC)throw new CodeError$3("DCUtR message type was incorrect",ERR_INVALID_MESSAGE);this.log("A dialing",nt);const st=await this.connectionManager.openConnection(nt,{signal:et.signal,priority:DCUTR_DIAL_PRIORITY,force:!0});this.log("DCUtR to %p succeeded via %a, closing relayed connection",a.remotePeer,st.remoteAddr),await a.close(et)}catch(tt){this.log.error("incoming DCUtR from %p failed",a.remotePeer,tt),s.abort(tt)}finally{await s.close(et)}}getDialableMultiaddrs(s){const a=[];for(const et of s)if(!(et==null||et.length===0))try{const tt=multiaddr(et);if(!isPublicAndDialable(tt,this.transportManager))continue;a.push(tt)}catch{}return a}}const multicodec="/libp2p/dcutr";function dcutr(o={}){return s=>new DefaultDCUtRService(s,o)}function allocUnsafe$c(o=0){return new Uint8Array(o)}function createCodec$c(o,s,a,et){return{name:o,prefix:s,encoder:{name:o,prefix:s,encode:a},decoder:{decode:et}}}const string$c=createCodec$c("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),ascii$c=createCodec$c("ascii","a",o=>{let s="a";for(let a=0;a<o.length;a++)s+=String.fromCharCode(o[a]);return s},o=>{o=o.substring(1);const s=allocUnsafe$c(o.length);for(let a=0;a<o.length;a++)s[a]=o.charCodeAt(a);return s}),BASES$c={utf8:string$c,"utf-8":string$c,hex:bases.base16,latin1:ascii$c,ascii:ascii$c,binary:ascii$c,...bases};function fromString$e(o,s="utf8"){const a=BASES$c[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.decoder.decode(`${a.prefix}${o}`)}function toString$6(o,s="utf8"){const a=BASES$c[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.encoder.encode(o).substring(1)}const IDENTIFY_PROTOCOL_VERSION="0.1.0",MULTICODEC_IDENTIFY_PROTOCOL_NAME="id",MULTICODEC_IDENTIFY_PUSH_PROTOCOL_NAME="id/push",MULTICODEC_IDENTIFY_PROTOCOL_VERSION="1.0.0",MULTICODEC_IDENTIFY_PUSH_PROTOCOL_VERSION="1.0.0",MAX_IDENTIFY_MESSAGE_SIZE=1024*8,MAX_PUSH_CONCURRENCY=32;var Identify$1;(function(o){let s;o.codec=()=>(s==null&&(s=message((a,et,tt={})=>{if(tt.lengthDelimited!==!1&&et.fork(),a.protocolVersion!=null&&(et.uint32(42),et.string(a.protocolVersion)),a.agentVersion!=null&&(et.uint32(50),et.string(a.agentVersion)),a.publicKey!=null&&(et.uint32(10),et.bytes(a.publicKey)),a.listenAddrs!=null)for(const rt of a.listenAddrs)et.uint32(18),et.bytes(rt);if(a.observedAddr!=null&&(et.uint32(34),et.bytes(a.observedAddr)),a.protocols!=null)for(const rt of a.protocols)et.uint32(26),et.string(rt);a.signedPeerRecord!=null&&(et.uint32(66),et.bytes(a.signedPeerRecord)),tt.lengthDelimited!==!1&&et.ldelim()},(a,et)=>{const tt={listenAddrs:[],protocols:[]},rt=et==null?a.len:a.pos+et;for(;a.pos<rt;){const nt=a.uint32();switch(nt>>>3){case 5:tt.protocolVersion=a.string();break;case 6:tt.agentVersion=a.string();break;case 1:tt.publicKey=a.bytes();break;case 2:tt.listenAddrs.push(a.bytes());break;case 4:tt.observedAddr=a.bytes();break;case 3:tt.protocols.push(a.string());break;case 8:tt.signedPeerRecord=a.bytes();break;default:a.skipType(nt&7);break}}return tt})),s),o.encode=a=>encodeMessage(a,o.codec()),o.decode=a=>decodeMessage(a,o.codec())})(Identify$1||(Identify$1={}));function isElectron$1(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process$1<"u"&&typeof process$1.versions=="object"&&process$1.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}var isElectron_1=isElectron$1;const detectElectron=getDefaultExportFromCjs$2(isElectron_1),isEnvWithDom=typeof window=="object"&&typeof document=="object"&&document.nodeType===9,isElectron=detectElectron(),isBrowser$1=isEnvWithDom&&!isElectron,isElectronMain=isElectron&&!isEnvWithDom,isElectronRenderer=isElectron&&isEnvWithDom,isNode=typeof globalThis.process<"u"&&typeof globalThis.process.release<"u"&&globalThis.process.release.name==="node"&&!isElectron,isWebWorker=typeof importScripts=="function"&&typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,isReactNative=typeof navigator<"u"&&navigator.product==="ReactNative",defaultValues={protocolPrefix:"ipfs",timeout:5e3,maxInboundStreams:1,maxOutboundStreams:1,maxObservedAddresses:10,maxMessageSize:MAX_IDENTIFY_MESSAGE_SIZE,runOnConnectionOpen:!0,runOnSelfUpdate:!0,runOnTransientConnection:!0,concurrency:MAX_PUSH_CONCURRENCY};function getCleanMultiaddr(o){if(o!=null&&o.length>0)try{return multiaddr(o)}catch{}}function getAgentVersion(o,s){return s!=null||(s=`${o.name}/${o.version}`,isNode||isElectronMain?s+=` UserAgent=${globalThis.process.version}`:(isBrowser$1||isWebWorker||isElectronRenderer||isReactNative)&&(s+=` UserAgent=${globalThis.navigator.userAgent}`)),s}async function consumeIdentifyMessage(o,s,a,et,tt){if(a("received identify from %p",et.remotePeer),tt==null)throw new CodeError$3("message was null or undefined","ERR_INVALID_MESSAGE");const rt={};if(tt.listenAddrs.length>0&&(rt.addresses=tt.listenAddrs.map(st=>({isCertified:!1,multiaddr:multiaddr(st)}))),tt.protocols.length>0&&(rt.protocols=tt.protocols),tt.publicKey!=null&&(rt.publicKey=tt.publicKey,!(await peerIdFromKeys(tt.publicKey)).equals(et.remotePeer)))throw new CodeError$3("public key did not match remote PeerId","ERR_INVALID_PUBLIC_KEY");let nt;if(tt.signedPeerRecord!=null){a("received signedPeerRecord from %p",et.remotePeer);let st=tt.signedPeerRecord;const ot=await RecordEnvelope.openAndCertify(st,PeerRecord.DOMAIN);let at=PeerRecord.createFromProtobuf(ot.payload);if(!at.peerId.equals(ot.peerId))throw new CodeError$3("signing key does not match PeerId in the PeerRecord","ERR_INVALID_SIGNING_KEY");if(!et.remotePeer.equals(at.peerId))throw new CodeError$3("signing key does not match remote PeerId","ERR_INVALID_PEER_RECORD_KEY");let lt;try{lt=await o.get(at.peerId)}catch(ct){if(ct.code!=="ERR_NOT_FOUND")throw ct}if(lt!=null&&(rt.metadata=lt.metadata,lt.peerRecordEnvelope!=null)){const ct=await RecordEnvelope.createFromProtobuf(lt.peerRecordEnvelope),ht=PeerRecord.createFromProtobuf(ct.payload);ht.seqNumber>=at.seqNumber&&(a("sequence number was lower or equal to existing sequence number - stored: %d received: %d",ht.seqNumber,at.seqNumber),at=ht,st=lt.peerRecordEnvelope)}rt.peerRecordEnvelope=st,rt.addresses=at.multiaddrs.map(ct=>({isCertified:!0,multiaddr:ct})),nt={seq:at.seqNumber,addresses:at.multiaddrs}}else a("%p did not send a signed peer record",et.remotePeer);if(a("patching %p with",et.remotePeer,rt),await o.patch(et.remotePeer,rt),tt.agentVersion!=null||tt.protocolVersion!=null){const st={};tt.agentVersion!=null&&(st.AgentVersion=fromString$e(tt.agentVersion)),tt.protocolVersion!=null&&(st.ProtocolVersion=fromString$e(tt.protocolVersion)),a("merging %p metadata",et.remotePeer,st),await o.merge(et.remotePeer,{metadata:st})}const it={peerId:et.remotePeer,protocolVersion:tt.protocolVersion,agentVersion:tt.agentVersion,publicKey:tt.publicKey,listenAddrs:tt.listenAddrs.map(st=>multiaddr(st)),observedAddr:tt.observedAddr==null?void 0:multiaddr(tt.observedAddr),protocols:tt.protocols,signedPeerRecord:nt,connection:et};return s.safeDispatchEvent("peer:identify",{detail:it}),it}class AbstractIdentify{host;protocol;started;timeout;peerId;peerStore;registrar;addressManager;maxInboundStreams;maxOutboundStreams;maxMessageSize;maxObservedAddresses;events;runOnTransientConnection;log;constructor(s,a){this.protocol=a.protocol,this.started=!1,this.peerId=s.peerId,this.peerStore=s.peerStore,this.registrar=s.registrar,this.addressManager=s.addressManager,this.events=s.events,this.log=a.log,this.timeout=a.timeout??defaultValues.timeout,this.maxInboundStreams=a.maxInboundStreams??defaultValues.maxInboundStreams,this.maxOutboundStreams=a.maxOutboundStreams??defaultValues.maxOutboundStreams,this.maxMessageSize=a.maxMessageSize??defaultValues.maxMessageSize,this.maxObservedAddresses=a.maxObservedAddresses??defaultValues.maxObservedAddresses,this.runOnTransientConnection=a.runOnTransientConnection??defaultValues.runOnTransientConnection,this.host={protocolVersion:`${a.protocolPrefix??defaultValues.protocolPrefix}/${IDENTIFY_PROTOCOL_VERSION}`,agentVersion:getAgentVersion(s.nodeInfo,a.agentVersion)}}isStarted(){return this.started}async start(){this.started||(await this.peerStore.merge(this.peerId,{metadata:{AgentVersion:fromString$e(this.host.agentVersion),ProtocolVersion:fromString$e(this.host.protocolVersion)}}),await this.registrar.handle(this.protocol,s=>{this.handleProtocol(s).catch(a=>{this.log.error(a)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnTransientConnection:this.runOnTransientConnection}),this.started=!0)}async stop(){await this.registrar.unhandle(this.protocol),this.started=!1}}class IdentifyPush extends AbstractIdentify{connectionManager;concurrency;constructor(s,a={}){super(s,{...a,protocol:`/${a.protocolPrefix??defaultValues.protocolPrefix}/${MULTICODEC_IDENTIFY_PUSH_PROTOCOL_NAME}/${MULTICODEC_IDENTIFY_PUSH_PROTOCOL_VERSION}`,log:s.logger.forComponent("libp2p:identify-push")}),this.connectionManager=s.connectionManager,this.concurrency=a.concurrency??defaultValues.concurrency,(a.runOnSelfUpdate??defaultValues.runOnSelfUpdate)&&s.events.addEventListener("self:peer:update",et=>{this.push().catch(tt=>{this.log.error(tt)})})}[serviceCapabilities]=["@libp2p/identify-push"];async push(){if(!this.isStarted())return;const s=this.addressManager.getAddresses().map(at=>at.decapsulateCode(getProtocol("p2p").code)),a=new PeerRecord({peerId:this.peerId,multiaddrs:s}),et=await RecordEnvelope.seal(a,this.peerId),tt=this.registrar.getProtocols(),rt=await this.peerStore.get(this.peerId),nt=toString$6(rt.metadata.get("AgentVersion")??fromString$e(this.host.agentVersion)),it=toString$6(rt.metadata.get("ProtocolVersion")??fromString$e(this.host.protocolVersion)),st=this;async function*ot(){for(const at of st.connectionManager.getConnections())(await st.peerStore.get(at.remotePeer)).protocols.includes(st.protocol)&&(yield async()=>{let ct;const ht=AbortSignal.timeout(st.timeout);setMaxListeners(1/0,ht);try{ct=await at.newStream(st.protocol,{signal:ht,runOnTransientConnection:st.runOnTransientConnection}),await pbStream(ct,{maxDataLength:st.maxMessageSize}).pb(Identify$1).write({listenAddrs:s.map(dt=>dt.bytes),signedPeerRecord:et.marshal(),protocols:tt,agentVersion:nt,protocolVersion:it},{signal:ht}),await ct.close({signal:ht})}catch(ft){st.log.error("could not push identify update to peer",ft),ct?.abort(ft)}})}await drain(parallel(ot(),{concurrency:this.concurrency}))}async handleProtocol(s){const{connection:a,stream:et}=s;try{if(this.peerId.equals(a.remotePeer))throw new Error("received push from ourselves?");const tt={signal:AbortSignal.timeout(this.timeout)},nt=await pbStream(et,{maxDataLength:this.maxMessageSize}).pb(Identify$1).read(tt);await et.close(tt),await consumeIdentifyMessage(this.peerStore,this.events,this.log,a,nt)}catch(tt){this.log.error("received invalid message",tt),et.abort(tt);return}this.log("handled push from %p",a.remotePeer)}}class Identify extends AbstractIdentify{constructor(s,a={}){super(s,{...a,protocol:`/${a.protocolPrefix??defaultValues.protocolPrefix}/${MULTICODEC_IDENTIFY_PROTOCOL_NAME}/${MULTICODEC_IDENTIFY_PROTOCOL_VERSION}`,log:s.logger.forComponent("libp2p:identify")}),(a.runOnConnectionOpen??defaultValues.runOnConnectionOpen)&&s.events.addEventListener("connection:open",et=>{const tt=et.detail;this.identify(tt).catch(rt=>{this.log.error("error during identify trigged by connection:open",rt)})})}[serviceCapabilities]=["@libp2p/identify"];async _identify(s,a={}){let et;if(a.signal==null){const tt=AbortSignal.timeout(this.timeout);setMaxListeners(1/0,tt),a={...a,signal:tt}}try{et=await s.newStream(this.protocol,{...a,runOnTransientConnection:this.runOnTransientConnection});const rt=await pbStream(et,{maxDataLength:this.maxMessageSize}).pb(Identify$1).read(a);return await et.close(a),rt}catch(tt){throw this.log.error("error while reading identify message",tt),et?.abort(tt),tt}}async identify(s,a={}){const et=await this._identify(s,a),{publicKey:tt,protocols:rt,observedAddr:nt}=et;if(tt==null)throw new CodeError$3("public key was missing from identify message","ERR_MISSING_PUBLIC_KEY");const it=await peerIdFromKeys(tt);if(!s.remotePeer.equals(it))throw new CodeError$3("identified peer does not match the expected peer","ERR_INVALID_PEER");if(this.peerId.equals(it))throw new CodeError$3("identified peer is our own peer id?","ERR_INVALID_PEER");const st=getCleanMultiaddr(nt);return this.log("identify completed for peer %p and protocols %o",it,rt),this.log("our observed address is %a",st),st!=null&&this.addressManager.getObservedAddrs().length<(this.maxObservedAddresses??1/0)&&(this.log("storing our observed address %a",st),this.addressManager.addObservedAddr(st)),consumeIdentifyMessage(this.peerStore,this.events,this.log,s,et)}async handleProtocol(s){const{connection:a,stream:et}=s,tt=AbortSignal.timeout(this.timeout);setMaxListeners(1/0,tt);try{const rt=this.peerId.publicKey??new Uint8Array(0),nt=await this.peerStore.get(this.peerId),it=this.addressManager.getAddresses().map(lt=>lt.decapsulateCode(getProtocol("p2p").code));let st=nt.peerRecordEnvelope;if(it.length>0&&st==null){const lt=new PeerRecord({peerId:this.peerId,multiaddrs:it});st=(await RecordEnvelope.seal(lt,this.peerId)).marshal().subarray()}let ot=a.remoteAddr.bytes;IP_OR_DOMAIN.matches(a.remoteAddr)||(ot=void 0),await pbStream(et).pb(Identify$1).write({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:rt,listenAddrs:it.map(lt=>lt.bytes),signedPeerRecord:st,observedAddr:ot,protocols:nt.protocols},{signal:tt}),await et.close({signal:tt})}catch(rt){this.log.error("could not respond to identify request",rt),et.abort(rt)}}}function identify(o={}){return s=>new Identify(s,o)}function identifyPush(o={}){return s=>new IdentifyPush(s,o)}const second$1=1e3,minute$1=60*second$1,hour=60*minute$1,MAX_RECORD_AGE=36*hour,PROTOCOL$1="/ipfs/kad/1.0.0",RECORD_KEY_PREFIX="/dht/record",PROVIDER_KEY_PREFIX="/dht/provider",PROVIDERS_LRU_CACHE_SIZE=256,PROVIDERS_VALIDITY=24*hour,PROVIDERS_CLEANUP_INTERVAL=hour,K$1=20,ALPHA=3,QUERY_SELF_INTERVAL=5*minute$1,QUERY_SELF_INITIAL_INTERVAL=second$1,QUERY_SELF_TIMEOUT=5*second$1,TABLE_REFRESH_INTERVAL=5*minute$1,TABLE_REFRESH_QUERY_TIMEOUT=30*second$1,DEFAULT_QUERY_TIMEOUT=180*second$1;function alloc$3(o=0){return new Uint8Array(o)}var Record$1;(function(o){let s;o.codec=()=>(s==null&&(s=message((a,et,tt={})=>{tt.lengthDelimited!==!1&&et.fork(),a.key!=null&&a.key.byteLength>0&&(et.uint32(10),et.bytes(a.key)),a.value!=null&&a.value.byteLength>0&&(et.uint32(18),et.bytes(a.value)),a.timeReceived!=null&&a.timeReceived!==""&&(et.uint32(42),et.string(a.timeReceived)),tt.lengthDelimited!==!1&&et.ldelim()},(a,et,tt={})=>{const rt={key:alloc$3(0),value:alloc$3(0),timeReceived:""},nt=et==null?a.len:a.pos+et;for(;a.pos<nt;){const it=a.uint32();switch(it>>>3){case 1:{rt.key=a.bytes();break}case 2:{rt.value=a.bytes();break}case 5:{rt.timeReceived=a.string();break}default:{a.skipType(it&7);break}}}return rt})),s),o.encode=a=>encodeMessage(a,o.codec()),o.decode=(a,et)=>decodeMessage(a,o.codec(),et)})(Record$1||(Record$1={}));function toRFC3339(o){const s=o.getUTCFullYear(),a=String(o.getUTCMonth()+1).padStart(2,"0"),et=String(o.getUTCDate()).padStart(2,"0"),tt=String(o.getUTCHours()).padStart(2,"0"),rt=String(o.getUTCMinutes()).padStart(2,"0"),nt=String(o.getUTCSeconds()).padStart(2,"0"),it=o.getUTCMilliseconds(),st=String(it*1e3*1e3).padStart(9,"0");return`${s}-${a}-${et}T${tt}:${rt}:${nt}.${st}Z`}function parseRFC3339(o){const s=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),a=String(o).trim().match(s);if(a==null)throw new Error("Invalid format");const et=parseInt(a[1],10),tt=parseInt(a[2],10)-1,rt=parseInt(a[3],10),nt=parseInt(a[4],10),it=parseInt(a[5],10),st=parseInt(a[6],10),ot=parseInt(a[7].slice(0,-6),10);return new Date(Date.UTC(et,tt,rt,nt,it,st,ot))}class Libp2pRecord{key;value;timeReceived;constructor(s,a,et){if(!(s instanceof Uint8Array))throw new Error("key must be a Uint8Array");if(!(a instanceof Uint8Array))throw new Error("value must be a Uint8Array");this.key=s,this.value=a,this.timeReceived=et}serialize(){return Record$1.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:toRFC3339(this.timeReceived)}}static deserialize(s){const a=Record$1.decode(s);return new Libp2pRecord(a.key,a.value,new Date(a.timeReceived))}static fromDeserialized(s){const a=parseRFC3339(s.timeReceived);if(s.key==null)throw new Error("key missing from deserialized object");if(s.value==null)throw new Error("value missing from deserialized object");return new Libp2pRecord(s.key,s.value,a)}}function equals$4(o,s){if(o===s)return!0;if(o.byteLength!==s.byteLength)return!1;for(let a=0;a<o.byteLength;a++)if(o[a]!==s[a])return!1;return!0}function alloc$2(o=0){return new Uint8Array(o)}function allocUnsafe$b(o=0){return new Uint8Array(o)}var Record;(function(o){let s;o.codec=()=>(s==null&&(s=message((a,et,tt={})=>{tt.lengthDelimited!==!1&&et.fork(),a.key!=null&&(et.uint32(10),et.bytes(a.key)),a.value!=null&&(et.uint32(18),et.bytes(a.value)),a.author!=null&&(et.uint32(26),et.bytes(a.author)),a.signature!=null&&(et.uint32(34),et.bytes(a.signature)),a.timeReceived!=null&&(et.uint32(42),et.string(a.timeReceived)),tt.lengthDelimited!==!1&&et.ldelim()},(a,et)=>{const tt={},rt=et==null?a.len:a.pos+et;for(;a.pos<rt;){const nt=a.uint32();switch(nt>>>3){case 1:{tt.key=a.bytes();break}case 2:{tt.value=a.bytes();break}case 3:{tt.author=a.bytes();break}case 4:{tt.signature=a.bytes();break}case 5:{tt.timeReceived=a.string();break}default:{a.skipType(nt&7);break}}}return tt})),s),o.encode=a=>encodeMessage(a,o.codec()),o.decode=a=>decodeMessage(a,o.codec())})(Record||(Record={}));var MessageType;(function(o){o.PUT_VALUE="PUT_VALUE",o.GET_VALUE="GET_VALUE",o.ADD_PROVIDER="ADD_PROVIDER",o.GET_PROVIDERS="GET_PROVIDERS",o.FIND_NODE="FIND_NODE",o.PING="PING"})(MessageType||(MessageType={}));var __MessageTypeValues;(function(o){o[o.PUT_VALUE=0]="PUT_VALUE",o[o.GET_VALUE=1]="GET_VALUE",o[o.ADD_PROVIDER=2]="ADD_PROVIDER",o[o.GET_PROVIDERS=3]="GET_PROVIDERS",o[o.FIND_NODE=4]="FIND_NODE",o[o.PING=5]="PING"})(__MessageTypeValues||(__MessageTypeValues={}));(function(o){o.codec=()=>enumeration(__MessageTypeValues)})(MessageType||(MessageType={}));var ConnectionType;(function(o){o.NOT_CONNECTED="NOT_CONNECTED",o.CONNECTED="CONNECTED",o.CAN_CONNECT="CAN_CONNECT",o.CANNOT_CONNECT="CANNOT_CONNECT"})(ConnectionType||(ConnectionType={}));var __ConnectionTypeValues;(function(o){o[o.NOT_CONNECTED=0]="NOT_CONNECTED",o[o.CONNECTED=1]="CONNECTED",o[o.CAN_CONNECT=2]="CAN_CONNECT",o[o.CANNOT_CONNECT=3]="CANNOT_CONNECT"})(__ConnectionTypeValues||(__ConnectionTypeValues={}));(function(o){o.codec=()=>enumeration(__ConnectionTypeValues)})(ConnectionType||(ConnectionType={}));var PeerInfo;(function(o){let s;o.codec=()=>(s==null&&(s=message((a,et,tt={})=>{if(tt.lengthDelimited!==!1&&et.fork(),a.id!=null&&a.id.byteLength>0&&(et.uint32(10),et.bytes(a.id)),a.multiaddrs!=null)for(const rt of a.multiaddrs)et.uint32(18),et.bytes(rt);a.connection!=null&&(et.uint32(24),ConnectionType.codec().encode(a.connection,et)),tt.lengthDelimited!==!1&&et.ldelim()},(a,et)=>{const tt={id:alloc$2(0),multiaddrs:[]},rt=et==null?a.len:a.pos+et;for(;a.pos<rt;){const nt=a.uint32();switch(nt>>>3){case 1:{tt.id=a.bytes();break}case 2:{tt.multiaddrs.push(a.bytes());break}case 3:{tt.connection=ConnectionType.codec().decode(a);break}default:{a.skipType(nt&7);break}}}return tt})),s),o.encode=a=>encodeMessage(a,o.codec()),o.decode=a=>decodeMessage(a,o.codec())})(PeerInfo||(PeerInfo={}));var Message$2;(function(o){let s;o.codec=()=>(s==null&&(s=message((a,et,tt={})=>{if(tt.lengthDelimited!==!1&&et.fork(),a.type!=null&&__MessageTypeValues[a.type]!==0&&(et.uint32(8),MessageType.codec().encode(a.type,et)),a.clusterLevel!=null&&(et.uint32(80),et.int32(a.clusterLevel)),a.key!=null&&(et.uint32(18),et.bytes(a.key)),a.record!=null&&(et.uint32(26),et.bytes(a.record)),a.closer!=null)for(const rt of a.closer)et.uint32(66),PeerInfo.codec().encode(rt,et);if(a.providers!=null)for(const rt of a.providers)et.uint32(74),PeerInfo.codec().encode(rt,et);tt.lengthDelimited!==!1&&et.ldelim()},(a,et)=>{const tt={type:MessageType.PUT_VALUE,closer:[],providers:[]},rt=et==null?a.len:a.pos+et;for(;a.pos<rt;){const nt=a.uint32();switch(nt>>>3){case 1:{tt.type=MessageType.codec().decode(a);break}case 10:{tt.clusterLevel=a.int32();break}case 2:{tt.key=a.bytes();break}case 3:{tt.record=a.bytes();break}case 8:{tt.closer.push(PeerInfo.codec().decode(a,a.uint32()));break}case 9:{tt.providers.push(PeerInfo.codec().decode(a,a.uint32()));break}default:{a.skipType(nt&7);break}}}return tt})),s),o.encode=a=>encodeMessage(a,o.codec()),o.decode=a=>decodeMessage(a,o.codec())})(Message$2||(Message$2={}));function sendQueryEvent(o,s={}){const a={...o,name:"SEND_QUERY",type:0,messageName:o.type,messageType:o.type};return s.onProgress?.(new CustomEvent$2("kad-dht:query:send-query",{detail:a})),a}function peerResponseEvent(o,s={}){const a={...o,name:"PEER_RESPONSE",type:1,messageName:o.messageType,closer:o.closer!=null?o.closer:[],providers:o.providers!=null?o.providers:[]};return s.onProgress?.(new CustomEvent$2("kad-dht:query:peer-response",{detail:a})),a}function finalPeerEvent(o,s={}){const a={...o,name:"FINAL_PEER",type:2};return s.onProgress?.(new CustomEvent$2("kad-dht:query:final-peer",{detail:a})),a}function queryErrorEvent(o,s={}){const a={...o,name:"QUERY_ERROR",type:3};return s.onProgress?.(new CustomEvent$2("kad-dht:query:query-error",{detail:a})),a}function providerEvent(o,s={}){const a={...o,name:"PROVIDER",type:4};return s.onProgress?.(new CustomEvent$2("kad-dht:query:provider",{detail:a})),a}function valueEvent(o,s={}){const a={...o,name:"VALUE",type:5};return s.onProgress?.(new CustomEvent$2("kad-dht:query:value",{detail:a})),a}function dialPeerEvent(o,s={}){const a={...o,name:"DIAL_PEER",type:7};return s.onProgress?.(new CustomEvent$2("kad-dht:query:dial-peer",{detail:a})),a}function createCodec$b(o,s,a,et){return{name:o,prefix:s,encoder:{name:o,prefix:s,encode:a},decoder:{decode:et}}}const string$b=createCodec$b("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),ascii$b=createCodec$b("ascii","a",o=>{let s="a";for(let a=0;a<o.length;a++)s+=String.fromCharCode(o[a]);return s},o=>{o=o.substring(1);const s=allocUnsafe$b(o.length);for(let a=0;a<o.length;a++)s[a]=o.charCodeAt(a);return s}),BASES$b={utf8:string$b,"utf-8":string$b,hex:bases.base16,latin1:ascii$b,ascii:ascii$b,binary:ascii$b,...bases};function toString$5(o,s="utf8"){const a=BASES$b[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.encoder.encode(o).substring(1)}function bestRecord(o,s,a){if(a.length===0){const nt="No records given";throw new CodeError$3(nt,"ERR_NO_RECORDS_RECEIVED")}const tt=toString$5(s).split("/");if(tt.length<3){const nt="Record key does not have a selector function";throw new CodeError$3(nt,"ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY")}const rt=o[tt[1].toString()];if(rt==null){const nt=`No selector function configured for key type "${tt[1]}"`;throw new CodeError$3(nt,"ERR_UNRECOGNIZED_KEY_PREFIX")}return a.length===1?0:rt(s,a)}function publickKey(o,s){return 0}const selectors={pk:publickKey};async function verifyRecord(o,s){const a=s.key,tt=toString$5(a).split("/");if(tt.length<3)return;const rt=o[tt[1].toString()];if(rt==null){const nt=`No validator available for key type "${tt[1]}"`;throw new CodeError$3(nt,"ERR_INVALID_RECORD_KEY_TYPE")}await rt(a,s.value)}const validatePublicKeyRecord=async(o,s)=>{if(!(o instanceof Uint8Array))throw new CodeError$3('"key" must be a Uint8Array',"ERR_INVALID_RECORD_KEY_NOT_BUFFER");if(o.byteLength<5)throw new CodeError$3("invalid public key record","ERR_INVALID_RECORD_KEY_TOO_SHORT");if(toString$5(o.subarray(0,4))!=="/pk/")throw new CodeError$3("key was not prefixed with /pk/","ERR_INVALID_RECORD_KEY_BAD_PREFIX");const et=o.slice(4),tt=await sha256$1.digest(s);if(!equals$4(et,tt.bytes))throw new CodeError$3("public key does not match passed in key","ERR_INVALID_RECORD_HASH_MISMATCH")},validators={pk:validatePublicKeyRecord};function asUint8Array$6(o){return o}function concat$6(o,s){s==null&&(s=o.reduce((tt,rt)=>tt+rt.length,0));const a=allocUnsafe$b(s);let et=0;for(const tt of o)a.set(tt,et),et+=tt.length;return a}function fromString$d(o,s="utf8"){const a=BASES$b[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.decoder.decode(`${a.prefix}${o}`)}const PK_PREFIX=fromString$d("/pk/");function removePrivateAddressesMapper(o){return{...o,multiaddrs:o.multiaddrs.filter(s=>{const[[a,et]]=s.stringTuples();if(a===53||a===54||a===55)return et!=="localhost";if(a!==4&&a!==6||et==null)return!1;const tt=isPrivateIp(et);return tt==null?!0:!tt})}}async function convertBuffer(o){return(await sha256$1.digest(o)).digest}async function convertPeerId(o){return convertBuffer(o.toBytes())}function bufferToRecordKey(o){return new Key(`${RECORD_KEY_PREFIX}/${toString$5(o,"base32")}`,!1)}function keyForPublicKey(o){return concat$6([PK_PREFIX,o.toBytes()])}function isPublicKeyKey(o){return toString$5(o.subarray(0,4))==="/pk/"}function fromPublicKeyKey(o){return peerIdFromBytes(o.subarray(4))}function createPutRecord(o,s){const a=new Date;return new Libp2pRecord(o,s,a).serialize()}function debounce$2(o,s=100){let a;return()=>{clearTimeout(a),a=setTimeout(()=>{o()},s)}}const P2P_CIRCUIT_CODE=290,DNS4_CODE=54,DNS6_CODE=55,DNSADDR_CODE=56,IP4_CODE=4,IP6_CODE=41;function multiaddrIsPublic(o){const s=o.stringTuples();for(const a of s)if(a[0]===P2P_CIRCUIT_CODE)return!1;if(s[0][0]===DNS4_CODE||s[0][0]===DNS6_CODE||s[0][0]===DNSADDR_CODE)return!0;if(s[0][0]===IP4_CODE||s[0][0]===IP6_CODE){const a=isPrivateIp(`${s[0][1]}`);return a==null||!a}return!1}class ContentFetching{log;components;validators;selectors;peerRouting;queryManager;network;constructor(s,a){const{validators:et,selectors:tt,peerRouting:rt,queryManager:nt,network:it,logPrefix:st}=a;this.components=s,this.log=s.logger.forComponent(`${st}:content-fetching`),this.validators=et,this.selectors=tt,this.peerRouting=rt,this.queryManager=nt,this.network=it}async getLocal(s){this.log("getLocal %b",s);const a=bufferToRecordKey(s);this.log("fetching record for key %k",a);const et=await this.components.datastore.get(a);this.log("found %k in local datastore",a);const tt=Libp2pRecord.deserialize(et);return await verifyRecord(this.validators,tt),tt}async*sendCorrectionRecord(s,a,et,tt={}){this.log("sendCorrection for %b",s);const rt=createPutRecord(s,et);for(const{value:nt,from:it}of a){if(equals$4(nt,et)){this.log("record was ok");continue}if(this.components.peerId.equals(it)){try{const at=bufferToRecordKey(s);this.log(`Storing corrected record for key ${at.toString()}`),await this.components.datastore.put(at,rt.subarray())}catch(at){this.log.error("Failed error correcting self",at)}continue}let st=!1;const ot={type:MessageType.PUT_VALUE,key:s,record:rt};for await(const at of this.network.sendRequest(it,ot,tt))at.name==="PEER_RESPONSE"&&at.record!=null&&equals$4(at.record.value,Libp2pRecord.deserialize(rt).value)&&(st=!0),yield at;st||(yield queryErrorEvent({from:it,error:new CodeError$3("value not put correctly","ERR_PUT_VALUE_INVALID")},tt)),this.log.error("Failed error correcting entry")}}async*put(s,a,et={}){this.log("put key %b value %b",s,a);const tt=createPutRecord(s,a),rt=bufferToRecordKey(s);this.log(`storing record for key ${rt.toString()}`),await this.components.datastore.put(rt,tt.subarray()),yield*pipe(this.peerRouting.getClosestPeers(s,{signal:et.signal}),nt=>map$1(nt,it=>async()=>{if(it.name!=="FINAL_PEER")return[it];const st=[],ot={type:MessageType.PUT_VALUE,key:s,record:tt};this.log("send put to %p",it.peer.id);for await(const at of this.network.sendRequest(it.peer.id,ot,et))st.push(at),at.name==="PEER_RESPONSE"&&(at.record!=null&&equals$4(at.record.value,Libp2pRecord.deserialize(tt).value)||st.push(queryErrorEvent({from:it.peer.id,error:new CodeError$3("value not put correctly","ERR_PUT_VALUE_INVALID")},et)));return st}),nt=>parallel(nt,{ordered:!1,concurrency:ALPHA}),async function*(nt){for await(const it of nt)yield*it})}async*get(s,a={}){this.log("get %b",s);const et=[];for await(const it of this.getMany(s,a))it.name==="VALUE"&&et.push(it),yield it;if(et.length===0)return;const tt=et.map(it=>it.value);let rt=0;try{rt=bestRecord(this.selectors,s,tt)}catch(it){if(it.code!=="ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY")throw it}const nt=tt[rt];if(this.log("GetValue %b %b",s,nt),nt==null)throw new CodeError$3("best value was not found","ERR_NOT_FOUND");yield*this.sendCorrectionRecord(s,et,nt,a),yield et[rt]}async*getMany(s,a={}){this.log("getMany values for %b",s);try{const rt=await this.getLocal(s);yield valueEvent({value:rt.value,from:this.components.peerId},a)}catch(rt){this.log("error getting local value for %b",s,rt)}const et=this,tt=async function*({peer:rt,signal:nt}){for await(const it of et.peerRouting.getValueOrPeers(rt,s,{signal:nt}))yield it,it.name==="PEER_RESPONSE"&&it.record!=null&&(yield valueEvent({from:rt,value:it.record.value},a))};yield*this.queryManager.run(s,tt,a)}}function toPbPeerInfo(o,s){return{id:o.id.toBytes(),multiaddrs:(o.multiaddrs??[]).map(et=>et.bytes),connection:s}}function fromPbPeerInfo(o){if(o.id==null)throw new Error("Invalid peer in message");return{id:peerIdFromBytes(o.id),multiaddrs:(o.multiaddrs??[]).map(s=>multiaddr(s))}}class ContentRouting{log;components;network;peerRouting;queryManager;routingTable;providers;constructor(s,a){const{network:et,peerRouting:tt,queryManager:rt,routingTable:nt,providers:it,logPrefix:st}=a;this.components=s,this.log=s.logger.forComponent(`${st}:content-routing`),this.network=et,this.peerRouting=tt,this.queryManager=rt,this.routingTable=nt,this.providers=it}async*provide(s,a,et={}){this.log("provide %s",s);const tt=s.multihash.bytes;await this.providers.addProvider(s,this.components.peerId);const rt={type:MessageType.ADD_PROVIDER,key:tt,providers:[toPbPeerInfo({id:this.components.peerId,multiaddrs:a})]};let nt=0;const it=st=>async()=>{if(st.name!=="FINAL_PEER")return[st];const ot=[];this.log("putProvider %s to %p",s,st.peer.id);try{this.log("sending provider record for %s to %p",s,st.peer.id);for await(const at of this.network.sendMessage(st.peer.id,rt,et))at.name==="PEER_RESPONSE"&&(this.log("sent provider record for %s to %p",s,st.peer.id),nt++),ot.push(at)}catch(at){this.log.error("error sending provide record to peer %p",st.peer.id,at),ot.push(queryErrorEvent({from:st.peer.id,error:at},et))}return ot};yield*pipe(this.peerRouting.getClosestPeers(tt,et),st=>map$1(st,ot=>it(ot)),st=>parallel(st,{ordered:!1,concurrency:ALPHA}),async function*(st){for await(const ot of st)yield*ot}),this.log("sent provider records to %d peers",nt)}async*findProviders(s,a){const et=this.routingTable.kBucketSize;let tt=0;const rt=s.multihash.bytes,nt=this;this.log("findProviders %c",s);const it=await this.providers.getProviders(s);if(it.length>0){const at=[];for(const lt of it.slice(0,et))try{const ct=await this.components.peerStore.get(lt);at.push({id:lt,multiaddrs:ct.addresses.map(({multiaddr:ht})=>ht)})}catch(ct){if(ct.code!=="ERR_NOT_FOUND")throw ct;this.log("no peer store entry for %p",lt)}if(yield peerResponseEvent({from:this.components.peerId,messageType:MessageType.GET_PROVIDERS,providers:at},a),yield providerEvent({from:this.components.peerId,providers:at},a),tt+=at.length,tt>=et)return}const st=async function*({peer:at,signal:lt}){const ct={type:MessageType.GET_PROVIDERS,key:rt};yield*nt.network.sendRequest(at,ct,{...a,signal:lt})},ot=new PeerSet(it);for await(const at of this.queryManager.run(rt,st,a))if(yield at,at.name==="PEER_RESPONSE"){this.log("Found %d provider entries for %c and %d closer peers",at.providers.length,s,at.closer.length);const lt=[];for(const ct of at.providers)ot.has(ct.id)||(ot.add(ct.id),lt.push(ct));if(lt.length>0&&(yield providerEvent({from:at.from,providers:lt},a),tt+=lt.length,tt>=et))return}}}class MovingAverage{movingAverage;variance;deviation;forecast;timespan;previousTime;constructor(s){this.timespan=s,this.movingAverage=0,this.variance=0,this.deviation=0,this.forecast=0}alpha(s,a){return 1-Math.exp(-(s-a)/this.timespan)}push(s,a=Date.now()){if(this.previousTime!=null){const et=this.alpha(a,this.previousTime),tt=s-this.movingAverage,rt=et*tt;this.movingAverage=et*s+(1-et)*this.movingAverage,this.variance=(1-et)*(this.variance+tt*rt),this.deviation=Math.sqrt(this.variance),this.forecast=this.movingAverage+et*tt}else this.movingAverage=s;this.previousTime=a}}const DEFAULT_TIMEOUT_MULTIPLIER=1.2,DEFAULT_FAILURE_MULTIPLIER=2,DEFAULT_MIN_TIMEOUT=2e3;class AdaptiveTimeout{success;failure;next;metric;timeoutMultiplier;failureMultiplier;minTimeout;constructor(s={}){this.success=new MovingAverage(s.interval??5e3),this.failure=new MovingAverage(s.interval??5e3),this.next=new MovingAverage(s.interval??5e3),this.failureMultiplier=s.failureMultiplier??DEFAULT_FAILURE_MULTIPLIER,this.timeoutMultiplier=s.timeoutMultiplier??DEFAULT_TIMEOUT_MULTIPLIER,this.minTimeout=s.minTimeout??DEFAULT_MIN_TIMEOUT,s.metricName!=null&&(this.metric=s.metrics?.registerMetricGroup(s.metricName))}getTimeoutSignal(s={}){const a=Math.max(Math.round(this.next.movingAverage*(s.timeoutFactor??this.timeoutMultiplier)),this.minTimeout),et=AbortSignal.timeout(a),tt=anySignal([s.signal,et]);return setMaxListeners(1/0,tt,et),tt.start=Date.now(),tt.timeout=a,tt}cleanUp(s){const a=Date.now()-s.start;s.aborted?(this.failure.push(a),this.next.push(a*this.failureMultiplier),this.metric?.update({failureMovingAverage:this.failure.movingAverage,failureDeviation:this.failure.deviation,failureForecast:this.failure.forecast,failureVariance:this.failure.variance,failure:a})):(this.success.push(a),this.next.push(a),this.metric?.update({successMovingAverage:this.success.movingAverage,successDeviation:this.success.deviation,successForecast:this.success.forecast,successVariance:this.success.variance,success:a}))}}class Network extends TypedEventEmitter{log;protocol;running;components;timeout;constructor(s,a){super();const{protocol:et}=a;this.components=s,this.log=s.logger.forComponent(`${a.logPrefix}:network`),this.running=!1,this.protocol=et,this.timeout=new AdaptiveTimeout({...a.timeout??{},metrics:s.metrics,metricName:`${a.logPrefix.replaceAll(":","_")}_network_message_send_times_milliseconds`})}async start(){this.running||(this.running=!0)}async stop(){this.running=!1}isStarted(){return this.running}async*sendRequest(s,a,et={}){if(!this.running)return;const tt=a.type;if(tt==null)throw new CodeError$2("Message type was missing","ERR_INVALID_PARAMETERS");this.log("sending %s to %p",a.type,s),yield dialPeerEvent({peer:s},et),yield sendQueryEvent({to:s,type:tt},et);let rt;const nt=this.timeout.getTimeoutSignal(et);et={...et,signal:nt};try{rt=await(await this.components.connectionManager.openConnection(s,et)).newStream(this.protocol,et);const st=await this._writeReadMessage(rt,a,et);rt.close(et).catch(ot=>{this.log.error("error closing stream to %p",s,ot),rt?.abort(ot)}),yield peerResponseEvent({from:s,messageType:st.type,closer:st.closer.map(fromPbPeerInfo),providers:st.providers.map(fromPbPeerInfo),record:st.record==null?void 0:Libp2pRecord.deserialize(st.record)},et)}catch(it){rt?.abort(it),this.log.error("could not send %s to %p",a.type,s,it),yield queryErrorEvent({from:s,error:it},et)}finally{this.timeout.cleanUp(nt)}}async*sendMessage(s,a,et={}){if(!this.running)return;const tt=a.type;if(tt==null)throw new CodeError$2("Message type was missing","ERR_INVALID_PARAMETERS");this.log("sending %s to %p",a.type,s),yield dialPeerEvent({peer:s},et),yield sendQueryEvent({to:s,type:tt},et);let rt;const nt=this.timeout.getTimeoutSignal(et);et={...et,signal:nt};try{rt=await(await this.components.connectionManager.openConnection(s,et)).newStream(this.protocol,et),await this._writeMessage(rt,a,et),rt.close(et).catch(st=>{this.log.error("error closing stream to %p",s,st),rt?.abort(st)}),yield peerResponseEvent({from:s,messageType:tt},et)}catch(it){rt?.abort(it),yield queryErrorEvent({from:s,error:it},et)}finally{this.timeout.cleanUp(nt)}}async _writeMessage(s,a,et){const tt=pbStream(s);await tt.write(a,Message$2,et),await tt.unwrap().close(et)}async _writeReadMessage(s,a,et){const tt=pbStream(s);await tt.write(a,Message$2,et);const rt=await tt.read(Message$2,et);return await tt.unwrap().close(et),rt.closer.forEach(nt=>{this.safeDispatchEvent("peer",{detail:fromPbPeerInfo(nt)})}),rt.providers.forEach(nt=>{this.safeDispatchEvent("peer",{detail:fromPbPeerInfo(nt)})}),rt}}function xor(o,s){if(o.length!==s.length)throw new Error("Inputs should have the same length");const a=allocUnsafe$b(o.length);for(let et=0;et<o.length;et++)a[et]=o[et]^s[et];return a}function xorCompare(o,s){if(o.byteLength!==s.byteLength)throw new Error("Inputs should have the same length");for(let a=0;a<o.byteLength;a++)if(o[a]!==s[a])return o[a]<s[a]?-1:1;return 0}class PeerDistanceList{originDhtKey;capacity;peerDistances;constructor(s,a){this.originDhtKey=s,this.capacity=a,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return this.peerDistances.map(s=>s.peer)}async add(s){const a=await convertPeerId(s.id);this.addWitKadId(s,a)}addWitKadId(s,a){if(this.peerDistances.find(tt=>tt.peer.id.equals(s.id))!=null)return;const et={peer:s,distance:xor(this.originDhtKey,a)};this.peerDistances.push(et),this.peerDistances.sort((tt,rt)=>xorCompare(tt.distance,rt.distance)),this.peerDistances=this.peerDistances.slice(0,this.capacity)}async isCloser(s){if(this.length===0)return!0;const a=await convertPeerId(s),et=xor(a,this.originDhtKey),tt=this.peerDistances[this.peerDistances.length-1].distance;return xorCompare(et,tt)===-1}async anyCloser(s){return s.length===0?!1:Promise.any(s.map(async a=>this.isCloser(a)))}}class PeerRouting{log;routingTable;network;validators;queryManager;peerStore;peerId;constructor(s,a){const{routingTable:et,network:tt,validators:rt,queryManager:nt,logPrefix:it}=a;this.routingTable=et,this.network=tt,this.validators=rt,this.queryManager=nt,this.peerStore=s.peerStore,this.peerId=s.peerId,this.log=s.logger.forComponent(`${it}:peer-routing`)}async findPeerLocal(s){let a;const et=await this.routingTable.find(s);if(et!=null){this.log("findPeerLocal found %p in routing table",s);try{a=await this.peerStore.get(et)}catch(tt){if(tt.code!=="ERR_NOT_FOUND")throw tt}}if(a==null)try{a=await this.peerStore.get(s)}catch(tt){if(tt.code!=="ERR_NOT_FOUND")throw tt}if(a!=null)return this.log("findPeerLocal found %p in peer store",s),{id:a.id,multiaddrs:a.addresses.map(tt=>tt.multiaddr)}}async*_getValueSingle(s,a,et={}){const tt={type:MessageType.GET_VALUE,key:a};yield*this.network.sendRequest(s,tt,et)}async*getPublicKeyFromNode(s,a={}){const et=keyForPublicKey(s);for await(const tt of this._getValueSingle(s,et,a))if(yield tt,tt.name==="PEER_RESPONSE"&&tt.record!=null){const rt=await peerIdFromKeys(marshalPublicKey({bytes:tt.record.value}));if(!rt.equals(s))throw new CodeError$3("public key does not match id","ERR_PUBLIC_KEY_DOES_NOT_MATCH_ID");if(rt.publicKey==null)throw new CodeError$3("public key missing","ERR_PUBLIC_KEY_MISSING");yield valueEvent({from:s,value:rt.publicKey},a)}throw new CodeError$3(`Node not responding with its public key: ${s.toString()}`,"ERR_INVALID_RECORD")}async*findPeer(s,a={}){if(this.log("findPeer %p",s),a.useCache!==!1){const tt=await this.findPeerLocal(s);if(tt!=null){this.log("found local"),yield finalPeerEvent({from:this.peerId,peer:tt},a);return}}let et=!1;if(a.useNetwork!==!1){const tt=this,rt=async function*({peer:nt,signal:it}){const st={type:MessageType.FIND_NODE,key:s.toBytes()};for await(const ot of tt.network.sendRequest(nt,st,{...a,signal:it}))if(yield ot,ot.name==="PEER_RESPONSE"){const at=ot.closer.find(lt=>lt.id.equals(s));at!=null&&(yield finalPeerEvent({from:ot.from,peer:at},a))}};for await(const nt of this.queryManager.run(s.toBytes(),rt,a))nt.name==="FINAL_PEER"&&(et=!0),yield nt}et||(yield queryErrorEvent({from:this.peerId,error:new CodeError$3("Not found","ERR_NOT_FOUND")},a))}async*getClosestPeers(s,a={}){this.log("getClosestPeers to %b",s);const et=await convertBuffer(s),tt=this.routingTable.closestPeers(et),rt=this,nt=new PeerDistanceList(et,this.routingTable.kBucketSize);await Promise.all(tt.map(async st=>{await nt.add({id:st,multiaddrs:[]})}));const it=async function*({peer:st,signal:ot}){rt.log("closerPeersSingle %s from %p",toString$5(s,"base32"),st);const at={type:MessageType.FIND_NODE,key:s};yield*rt.network.sendRequest(st,at,{...a,signal:ot})};for await(const st of this.queryManager.run(s,it,a))st.name==="PEER_RESPONSE"&&await Promise.all(st.closer.map(async ot=>{await nt.add(ot)})),yield st;this.log("found %d peers close to %b",nt.length,s);for(const st of nt.peers)yield finalPeerEvent({from:this.peerId,peer:st},a)}async*getValueOrPeers(s,a,et={}){for await(const tt of this._getValueSingle(s,a,et)){if(tt.name==="PEER_RESPONSE"&&tt.record!=null)try{await this._verifyRecordOnline(tt.record)}catch{const nt="invalid record received, discarded";this.log(nt),yield queryErrorEvent({from:tt.from,error:new CodeError$3(nt,"ERR_INVALID_RECORD")},et);continue}yield tt}}async _verifyRecordOnline(s){if(s.timeReceived==null)throw new CodeError$3("invalid record received","ERR_INVALID_RECORD");await verifyRecord(this.validators,new Libp2pRecord(s.key,s.value,s.timeReceived))}async getCloserPeersOffline(s,a){const et=await convertBuffer(s),tt=this.routingTable.closestPeers(et),rt=[];for(const nt of tt)if(!nt.equals(a))try{const it=await this.peerStore.get(nt);rt.push({id:nt,multiaddrs:it.addresses.map(({multiaddr:st})=>st)})}catch(it){if(it.code!=="ERR_NOT_FOUND")throw it}return rt.length>0?this.log("getCloserPeersOffline found %d peer(s) closer to %b than %p",rt.length,s,a):this.log("getCloserPeersOffline could not find peer closer to %b than %p with %d peers in the routing table",s,a,this.routingTable.size),rt}}class Providers{log;datastore;cache;cleanupInterval;provideValidity;syncQueue;started;cleaner;constructor(s,a={}){const{cacheSize:et,cleanupInterval:tt,provideValidity:rt}=a;this.log=s.logger.forComponent("libp2p:kad-dht:providers"),this.datastore=s.datastore,this.cleanupInterval=tt??PROVIDERS_CLEANUP_INTERVAL,this.provideValidity=rt??PROVIDERS_VALIDITY,this.cache=cache$3(et??PROVIDERS_LRU_CACHE_SIZE),this.syncQueue=new PQueue({concurrency:1}),this.started=!1}isStarted(){return this.started}async start(){this.started||(this.started=!0,this.cleaner=setInterval(()=>{this._cleanup().catch(s=>{this.log.error(s)})},this.cleanupInterval))}async stop(){this.started=!1,this.cleaner!=null&&(clearInterval(this.cleaner),this.cleaner=void 0)}async _cleanup(){await this.syncQueue.add(async()=>{const s=Date.now();let a=0,et=0;const tt=new Map,rt=this.datastore.batch(),nt=this.datastore.query({prefix:PROVIDER_KEY_PREFIX});for await(const it of nt)try{const{cid:st,peerId:ot}=parseProviderKey(it.key),at=readTime(it.value).getTime(),lt=Date.now(),ct=lt-at,ht=ct>this.provideValidity;if(this.log("comparing: %d - %d = %d > %d %s",lt,at,ct,this.provideValidity,ht?"(expired)":""),ht){et++,rt.delete(it.key);const ft=tt.get(st)??new Set;ft.add(ot),tt.set(st,ft)}a++}catch(st){this.log.error(st.message)}tt.size>0?(this.log("deleting %d / %d entries",et,a),await rt.commit()):this.log("nothing to delete");for(const[it,st]of tt){const ot=makeProviderKey(it),at=this.cache.get(ot);if(at!=null){for(const lt of st)at.delete(lt);at.size===0?this.cache.remove(ot):this.cache.set(ot,at)}}this.log("Cleanup successful (%dms)",Date.now()-s)})}async _getProvidersMap(s){const a=makeProviderKey(s);let et=this.cache.get(a);return et==null&&(et=await loadProviders(this.datastore,s),this.cache.set(a,et)),et}async addProvider(s,a){await this.syncQueue.add(async()=>{this.log("%p provides %s",a,s);const et=await this._getProvidersMap(s);this.log("loaded %s provs",et.size);const tt=new Date;et.set(a.toString(),tt);const rt=makeProviderKey(s);this.cache.set(rt,et),await writeProviderEntry(this.datastore,s,a,tt)})}async getProviders(s){return this.syncQueue.add(async()=>(this.log("get providers for %s",s),[...(await this._getProvidersMap(s)).keys()].map(et=>peerIdFromString(et))),{throwOnTimeout:!0})}}function makeProviderKey(o){const s=typeof o=="string"?o:toString$5(o.multihash.bytes,"base32");return`${PROVIDER_KEY_PREFIX}/${s}`}async function writeProviderEntry(o,s,a,et){const tt=[makeProviderKey(s),"/",a.toString()].join(""),rt=new Key(tt),nt=encode$c(et.getTime());await o.put(rt,nt)}function parseProviderKey(o){const s=o.toString().split("/");if(s.length!==5)throw new Error(`incorrectly formatted provider entry key in datastore: ${o.toString()}`);return{cid:s[3],peerId:s[4]}}async function loadProviders(o,s){const a=new Map,et=o.query({prefix:makeProviderKey(s)});for await(const tt of et){const{peerId:rt}=parseProviderKey(tt.key);a.set(rt,readTime(tt.value))}return a}function readTime(o){return new Date(decode$g(o))}async function*queryPath(o){const{key:s,startingPeer:a,ourPeerId:et,signal:tt,query:rt,alpha:nt,pathIndex:it,numPaths:st,queryFuncTimeout:ot,log:at,peersSeen:lt,connectionManager:ct}=o,ht=new Queue({concurrency:nt,sort:(pt,gt)=>xorCompare(pt.options.distance,gt.options.distance)}),ft=await convertBuffer(s);function dt(pt,gt){if(pt==null)return;lt.add(pt);const mt=xor(gt,ft);ht.add(async()=>{const yt=[tt];ot!=null&&yt.push(AbortSignal.timeout(ot));const vt=anySignal(yt);setMaxListeners(1/0,vt);try{for await(const Et of rt({key:s,peer:pt,signal:vt,pathIndex:it,numPaths:st})){if(vt.aborted)return;if(Et.name==="PEER_RESPONSE")for(const xt of Et.closer){if(lt.has(xt.id)){at("already seen %p in query",xt.id);continue}if(et.equals(xt.id)){at("not querying ourselves");continue}if(!await ct.isDialable(xt.multiaddrs)){at("not querying undialable peer");continue}const wt=await convertPeerId(xt.id),Rt=xor(wt,ft);if(xorCompare(Rt,mt)!==-1){at("skipping %p as they are not closer to %b than %p",xt.id,s,pt);continue}at("querying closer peer %p",xt.id),dt(xt.id,wt)}ht.safeDispatchEvent("completed",{detail:Et})}}catch(Et){if(!tt.aborted)return queryErrorEvent({from:pt,error:Et},o)}finally{vt.clear()}},{distance:mt}).catch(yt=>{at.error(yt)})}dt(a,await convertPeerId(a));try{for await(const pt of ht.toGenerator({signal:tt}))pt!=null&&(yield pt)}catch(pt){throw tt.aborted?new CodeError$3("Query aborted","ERR_QUERY_ABORTED"):pt}}class QueryManager{disjointPaths;alpha;shutDownController;running;queries;logger;peerId;connectionManager;routingTable;initialQuerySelfHasRun;logPrefix;metrics;constructor(s,a){const{disjointPaths:et=K$1,alpha:tt=ALPHA,logPrefix:rt}=a;this.logPrefix=rt,this.disjointPaths=et??K$1,this.running=!1,this.alpha=tt??ALPHA,this.queries=0,this.initialQuerySelfHasRun=a.initialQuerySelfHasRun,this.routingTable=a.routingTable,this.logger=s.logger,this.peerId=s.peerId,this.connectionManager=s.connectionManager,s.metrics!=null&&(this.metrics={runningQueries:s.metrics.registerMetric(`${rt.replaceAll(":","_")}_running_queries`),queryTime:s.metrics.registerMetric(`${rt.replaceAll(":","_")}_query_time_seconds`)}),this.shutDownController=new AbortController,setMaxListeners(1/0,this.shutDownController.signal)}isStarted(){return this.running}async start(){this.running=!0,this.shutDownController=new AbortController,setMaxListeners(1/0,this.shutDownController.signal)}async stop(){this.running=!1,this.shutDownController.abort()}async*run(s,a,et={}){if(!this.running)throw new Error("QueryManager not started");const tt=this.metrics?.queryTime.timer();if(et.signal==null){const at=AbortSignal.timeout(DEFAULT_QUERY_TIMEOUT);setMaxListeners(1/0,at),et={...et,signal:at}}const rt=new AbortController,nt=anySignal([this.shutDownController.signal,rt.signal,et.signal]);setMaxListeners(1/0,nt,rt.signal);const it=this.logger.forComponent(`${this.logPrefix}:query:`+toString$5(s,"base58btc")),st=Date.now();let ot=!1;try{et.isSelfQuery!==!0&&this.initialQuerySelfHasRun!=null&&(it("waiting for initial query-self query before continuing"),await raceSignal(this.initialQuerySelfHasRun.promise,nt),this.initialQuerySelfHasRun=void 0),it("query:start"),this.queries++,this.metrics?.runningQueries.update(this.queries);const at=await convertBuffer(s),lt=this.routingTable.closestPeers(at),ct=lt.slice(0,Math.min(this.disjointPaths,lt.length));if(lt.length===0){it.error("Running query with no peers");return}const ht=new PeerSet,ft=ct.map((dt,pt)=>queryPath({key:s,startingPeer:dt,ourPeerId:this.peerId,signal:nt,query:a,pathIndex:pt,numPaths:ct.length,alpha:this.alpha,queryFuncTimeout:et.queryFuncTimeout,log:it,peersSeen:ht,onProgress:et.onProgress,connectionManager:this.connectionManager}));for await(const dt of merge$2(...ft)){if(dt.name==="QUERY_ERROR"&&it.error("query error",dt.error),dt.name==="PEER_RESPONSE")for(const pt of[...dt.closer,...dt.providers])await this.connectionManager.isDialable(pt.multiaddrs)&&await this.routingTable.add(pt.id);yield dt}ot=!0}catch(at){if(!(!this.running&&at.code==="ERR_QUERY_ABORTED"))throw at}finally{ot||(it("query exited early"),rt.abort()),nt.clear(),this.queries--,this.metrics?.runningQueries.update(this.queries),tt?.(),it("query:done in %dms",Date.now()-st)}}}function isAsyncIterable$5(o){return o[Symbol.asyncIterator]!=null}function length$2(o){if(isAsyncIterable$5(o))return(async()=>{let s=0;for await(const a of o)s++;return s})();{let s=0;for(const a of o)s++;return s}}const normalizeEmitter=o=>{const s=o.addEventListener||o.on||o.addListener,a=o.removeEventListener||o.off||o.removeListener;if(!s||!a)throw new TypeError("Emitter is not compatible");return{addListener:s.bind(o),removeListener:a.bind(o)}};function pEventMultiple(o,s,a){let et;const tt=new Promise((rt,nt)=>{if(a={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...a},!(a.count>=0&&(a.count===Number.POSITIVE_INFINITY||Number.isInteger(a.count))))throw new TypeError("The `count` option should be at least 0 or more");a.signal?.throwIfAborted();const it=[s].flat(),st=[],{addListener:ot,removeListener:at}=normalizeEmitter(o),lt=(...ht)=>{const ft=a.multiArgs?ht:ht[0];a.filter&&!a.filter(ft)||(st.push(ft),a.count===st.length&&(et(),rt(st)))},ct=ht=>{et(),nt(ht)};et=()=>{for(const ht of it)at(ht,lt);for(const ht of a.rejectionEvents)at(ht,ct)};for(const ht of it)ot(ht,lt);for(const ht of a.rejectionEvents)ot(ht,ct);a.signal&&a.signal.addEventListener("abort",()=>{ct(a.signal.reason)},{once:!0}),a.resolveImmediately&&rt(st)});if(tt.cancel=et,typeof a.timeout=="number"){const rt=pTimeout(tt,{milliseconds:a.timeout});return rt.cancel=et,rt}return tt}function pEvent(o,s,a){typeof a=="function"&&(a={filter:a}),a={...a,count:1,resolveImmediately:!1};const et=pEventMultiple(o,s,a),tt=et.then(rt=>rt[0]);return tt.cancel=et.cancel,tt}class QuerySelf{log;peerId;peerRouting;routingTable;count;interval;initialInterval;queryTimeout;started;timeoutId;controller;initialQuerySelfHasRun;querySelfPromise;constructor(s,a){const{peerRouting:et,logPrefix:tt,count:rt,interval:nt,queryTimeout:it,routingTable:st}=a;this.peerId=s.peerId,this.log=s.logger.forComponent(`${tt}:query-self`),this.started=!1,this.peerRouting=et,this.routingTable=st,this.count=rt??K$1,this.interval=nt??QUERY_SELF_INTERVAL,this.initialInterval=a.initialInterval??QUERY_SELF_INITIAL_INTERVAL,this.queryTimeout=it??QUERY_SELF_TIMEOUT,this.initialQuerySelfHasRun=a.initialQuerySelfHasRun}isStarted(){return this.started}start(){this.started||(this.started=!0,clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.querySelf().catch(s=>{this.log.error("error running self-query",s)})},this.initialInterval))}stop(){this.started=!1,this.timeoutId!=null&&clearTimeout(this.timeoutId),this.controller!=null&&this.controller.abort()}async querySelf(){if(!this.started){this.log("skip self-query because we are not started");return}if(this.querySelfPromise!=null)return this.log("joining existing self query"),this.querySelfPromise.promise;if(this.querySelfPromise=pDefer(),this.started){this.controller=new AbortController;const s=AbortSignal.timeout(this.queryTimeout),a=anySignal([this.controller.signal,s]);setMaxListeners(1/0,a,this.controller.signal,s);try{this.routingTable.size===0&&(this.log("routing table was empty, waiting for some peers before running query"),await pEvent(this.routingTable,"peer:add",{signal:a})),this.log("run self-query, look for %d peers timing out after %dms",this.count,this.queryTimeout);const et=Date.now(),tt=await pipe(this.peerRouting.getClosestPeers(this.peerId.toBytes(),{signal:a,isSelfQuery:!0}),rt=>take(rt,this.count),async rt=>length$2(rt));this.log("self-query found %d peers in %dms",tt,Date.now()-et)}catch(et){this.log.error("self-query error",et)}finally{a.clear(),this.initialQuerySelfHasRun!=null&&(this.initialQuerySelfHasRun.resolve(),this.initialQuerySelfHasRun=void 0)}}this.querySelfPromise.resolve(),this.querySelfPromise=void 0,this.started&&(this.timeoutId=setTimeout(()=>{this.querySelf().catch(s=>{this.log.error("error running self-query",s)})},this.interval))}}function arrayEquals(o,s){if(o===s)return!0;if(o.length!==s.length)return!1;for(let a=0,et=o.length;a<et;++a)if(o[a]!==s[a])return!1;return!0}function ensureInt8(o,s){if(!(s instanceof Uint8Array))throw new TypeError(o+" is not a Uint8Array");if(s.byteLength!==32)throw new TypeError(o+" had incorrect length")}function isLeafBucket(o){return Array.isArray(o?.peers)}class KBucket extends TypedEventEmitter{root;localPeer;prefixLength;splitThreshold;kBucketSize;numberOfNodesToPing;constructor(s){super(),this.localPeer=s.localPeer,this.prefixLength=s.prefixLength,this.kBucketSize=s.kBucketSize??KBUCKET_SIZE,this.splitThreshold=s.splitThreshold??this.kBucketSize,this.numberOfNodesToPing=s.numberOfNodesToPing??3,ensureInt8("options.localPeer.kadId",s.localPeer.kadId),this.root={prefix:"",depth:0,peers:[]}}add(s){ensureInt8("peer.kadId",s?.kadId);const a=this._determineBucket(s.kadId);if(!(this._indexOf(a,s.kadId)>-1)){if(a.peers.length===this.splitThreshold&&a.depth<this.prefixLength){this._split(a),this.add(s);return}if(a.peers.length<this.kBucketSize){a.peers.push(s),this.safeDispatchEvent("added",{detail:s});return}this.safeDispatchEvent("ping",{detail:{oldContacts:a.peers.slice(0,this.numberOfNodesToPing),newContact:s}})}}*closest(s,a=this.kBucketSize){const et=new PeerDistanceList(s,a);for(const tt of this.toIterable())et.addWitKadId({id:tt.peerId,multiaddrs:[]},tt.kadId);yield*map$1(et.peers,tt=>tt.id)}count(){function s(a){if(isLeafBucket(a))return a.peers.length;let et=0;return a.left!=null&&(et+=s(a.left)),a.right!=null&&(et+=s(a.right)),et}return s(this.root)}get(s){const a=this._determineBucket(s),et=this._indexOf(a,s);return a.peers[et]}remove(s){const a=this._determineBucket(s),et=this._indexOf(a,s);if(et>-1){const tt=a.peers.splice(et,1)[0];this.safeDispatchEvent("removed",{detail:tt})}}*toIterable(){function*s(a){if(isLeafBucket(a)){yield*a.peers;return}yield*s(a.left),yield*s(a.right)}yield*s(this.root)}distance(s,a){return BigInt("0x"+toString$5(xor(s,a),"base16"))}_determineBucket(s){const et=toString$5(s,"base2").substring(0,this.prefixLength);function tt(rt,nt=0){return isLeafBucket(rt)?rt:et[nt]==="0"?tt(rt.left,nt+1):tt(rt.right,nt+1)}return tt(this.root)}_indexOf(s,a){return s.peers.findIndex(et=>arrayEquals(et.kadId,a))}_split(s){const a=s.depth+1,et={prefix:"0",depth:a,peers:[]},tt={prefix:"1",depth:a,peers:[]};for(const rt of s.peers)toString$5(rt.kadId,"base2")[a]==="0"?et.peers.push(rt):tt.peers.push(rt);delete s.peers,s.left=et,s.right=tt}}const KAD_CLOSE_TAG_NAME="kad-close",KAD_CLOSE_TAG_VALUE=50,KBUCKET_SIZE=20,PREFIX_LENGTH=32,PING_TIMEOUT=1e4,PING_CONCURRENCY=10;class RoutingTable extends TypedEventEmitter{kBucketSize;kb;pingQueue;log;components;prefixLength;splitThreshold;pingTimeout;pingConcurrency;running;protocol;tagName;tagValue;metrics;constructor(s,a){super(),this.components=s,this.log=s.logger.forComponent(`${a.logPrefix}:routing-table`),this.kBucketSize=a.kBucketSize??KBUCKET_SIZE,this.pingTimeout=a.pingTimeout??PING_TIMEOUT,this.pingConcurrency=a.pingConcurrency??PING_CONCURRENCY,this.running=!1,this.protocol=a.protocol,this.tagName=a.tagName??KAD_CLOSE_TAG_NAME,this.tagValue=a.tagValue??KAD_CLOSE_TAG_VALUE,this.prefixLength=a.prefixLength??PREFIX_LENGTH,this.splitThreshold=a.splitThreshold??KBUCKET_SIZE,this.pingQueue=new PeerQueue({concurrency:this.pingConcurrency,metricName:`${a.logPrefix.replaceAll(":","_")}_ping_queue`,metrics:this.components.metrics}),this.pingQueue.addEventListener("error",et=>{this.log.error("error pinging peer",et.detail)}),this.components.metrics!=null&&(this.metrics={routingTableSize:this.components.metrics.registerMetric(`${a.logPrefix.replaceAll(":","_")}_routing_table_size`),routingTableKadBucketTotal:this.components.metrics.registerMetric(`${a.logPrefix.replaceAll(":","_")}_routing_table_kad_bucket_total`),routingTableKadBucketAverageOccupancy:this.components.metrics.registerMetric(`${a.logPrefix.replaceAll(":","_")}_routing_table_kad_bucket_average_occupancy`),routingTableKadBucketMaxDepth:this.components.metrics.registerMetric(`${a.logPrefix.replaceAll(":","_")}_routing_table_kad_bucket_max_depth`)})}isStarted(){return this.running}async start(){this.running=!0;const s=new KBucket({localPeer:{kadId:await convertPeerId(this.components.peerId),peerId:this.components.peerId},kBucketSize:this.kBucketSize,prefixLength:this.prefixLength,splitThreshold:this.splitThreshold,numberOfNodesToPing:1});this.kb=s,s.addEventListener("ping",et=>{this._onPing(et).catch(tt=>{this.log.error("could not process k-bucket ping event",tt)})});let a=0;for(const et of await this.components.peerStore.all())if(et.protocols.includes(this.protocol)){const tt=await convertPeerId(et.id);this.kb.add({kadId:tt,peerId:et.id}),a++}this.log("added %d peer store peers to the routing table",a),this._tagPeers(s)}async stop(){this.running=!1,this.pingQueue.clear(),this.kb=void 0}_tagPeers(s){let a=new PeerSet;const et=debounce$2(()=>{const tt=new PeerSet(s.closest(s.localPeer.kadId,KBUCKET_SIZE)),rt=tt.difference(a),nt=a.difference(tt);Promise.resolve().then(async()=>{for(const it of rt)await this.components.peerStore.merge(it,{tags:{[this.tagName]:{value:this.tagValue}}});for(const it of nt)await this.components.peerStore.merge(it,{tags:{[this.tagName]:void 0}})}).catch(it=>{this.log.error("Could not update peer tags",it)}),a=tt});s.addEventListener("added",tt=>{et(),this.safeDispatchEvent("peer:add",{detail:tt.detail.peerId})}),s.addEventListener("removed",tt=>{et(),this.safeDispatchEvent("peer:remove",{detail:tt.detail.peerId})})}async _onPing(s){if(!this.running)return;const{oldContacts:a,newContact:et}=s.detail,rt=(await Promise.all(a.map(async nt=>{const it=this.pingQueue.find(nt.peerId);return it!=null?it.join():this.pingQueue.add(async()=>{let st;try{const ot={signal:AbortSignal.timeout(this.pingTimeout)};this.log("pinging old contact %p",nt.peerId),st=await(await this.components.connectionManager.openConnection(nt.peerId,ot)).newStream(this.protocol,ot);const lt=pbStream(st);await lt.write({type:MessageType.PING},Message$2,ot);const ct=await lt.read(Message$2,ot);if(await lt.unwrap().close(),ct.type!==MessageType.PING)throw new CodeError$3(`Incorrect message type received, expected PING got ${ct.type}`,"ERR_BAD_PING_RESPONSE");return!0}catch(ot){return this.running&&this.kb!=null&&(this.log.error("could not ping peer %p",nt.peerId,ot),this.log("evicting old contact after ping failed %p",nt.peerId),this.kb.remove(nt.kadId)),st?.abort(ot),!1}finally{this.metrics?.routingTableSize.update(this.size)}},{peerId:nt.peerId})}))).filter(nt=>nt).length;this.running&&rt<a.length&&this.kb!=null&&(this.log("adding new contact %p",et.peerId),this.kb.add(et))}get size(){return this.kb==null?0:this.kb.count()}async find(s){const a=await convertPeerId(s);return this.kb?.get(a)?.peerId}closestPeer(s){const a=this.closestPeers(s,1);if(a.length>0)return a[0]}closestPeers(s,a=this.kBucketSize){return this.kb==null?[]:[...this.kb.closest(s,a)]}async add(s){if(this.kb==null)throw new Error("RoutingTable is not started");const a=await convertPeerId(s);this.kb.add({kadId:a,peerId:s}),this.log("added %p with kad id %b",s,a),this.updateMetrics()}async remove(s){if(this.kb==null)throw new Error("RoutingTable is not started");const a=await convertPeerId(s);this.kb.remove(a),this.updateMetrics()}updateMetrics(){if(this.metrics==null||this.kb==null)return;let s=0,a=0,et=0;function tt(rt){if(isLeafBucket(rt)){rt.depth>et&&(et=rt.depth),a++,s+=rt.peers.length;return}tt(rt.left),tt(rt.right)}tt(this.kb.root),this.metrics.routingTableSize.update(s),this.metrics.routingTableKadBucketTotal.update(a),this.metrics.routingTableKadBucketAverageOccupancy.update(Math.round(s/a)),this.metrics.routingTableKadBucketMaxDepth.update(et)}}const GENERATED_PREFIXES=[77591,22417,43971,28421,740,29829,71467,228973,196661,78537,27689,36431,44415,14362,19456,106025,96308,2882,49509,21149,87173,131409,75844,23676,121838,30291,17492,2953,7564,110620,129477,127283,53113,72417,165166,109690,21200,102125,24049,71504,90342,25307,72039,26812,26715,32264,133800,71161,88956,171987,51779,24425,16671,30251,186294,247761,14202,2121,8465,35024,4876,85917,169730,3638,256836,96184,943,18678,6583,52907,35807,112254,214097,18796,11595,9243,23554,887,268203,382004,24590,111335,11625,16619,29039,102425,69006,97976,92362,32552,63717,41433,128974,137630,59943,10019,13986,35430,33665,108037,43799,43280,38195,29078,58629,18265,14425,46832,235538,40830,77881,110717,58937,3463,325358,51300,47623,117252,19007,10170,20540,91237,294813,4951,79841,56232,36270,128547,69209,66275,100156,32063,73531,34439,80937,28892,44466,88595,216307,32583,49620,16605,82127,45807,21630,78726,20235,40163,111007,96926,5567,72083,21665,58844,39419,179767,48328,42662,51550,5251,37811,49608,81056,50854,55513,20922,18891,197409,164656,32593,71449,220474,58919,85682,67854,13758,35066,3565,61905,214793,119572,141419,21504,10302,27354,67003,46131,32668,15165,64871,34450,17821,2757,11452,34189,5160,12257,85523,560,53385,65887,119549,135620,312353,115979,122356,10867,193231,124537,54783,90675,120791,4715,142253,50943,17271,43358,25331,4917,120566,34580,12878,33786,160528,32523,4869,301307,104817,81491,23276,8832,97911,31265,52065,7998,49622,9715,43998,34091,84587,20664,69041,29419,53205,10838,58288,116145,6185,5154,141795,35924,21307,144738,43730,12085,8279,10002,119,133779,199668,72938,31768,39176,67875,38453,9700,44144,4121,116048,41733,12868,82669,92308,128,34262,11332,7712,90764,36141,13553,71312,77470,117314,96549,49135,23602,54468,28605,6327,62308,17171,67531,21319,14105,894,107722,46157,8503,51069,100472,45138,15246,14577,35609,191464,1757,13364,161349,32067,91705,81144,52339,5408,91066,21983,14157,100545,4372,26630,129112,1423,29676,213626,4397,88436,99190,6877,49958,26122,114348,60661,29818,293118,50042,179738,16400,163423,89627,31040,43973,36638,45952,5153,1894,109322,1898,134021,12402,112077,68309,190269,69866,31938,107383,11522,105232,11248,14868,39852,71707,186525,16530,38162,106212,11700,5130,16608,26998,59586,108399,230033,43683,48135,82179,2073,5015,196684,189293,16378,23452,8301,35640,11632,214551,29240,57644,33137,91949,55157,52384,117313,5090,17717,89668,49363,82238,241035,66216,29066,184088,97206,62820,26595,4241,135635,173672,8202,459,71355,146294,29587,3008,135385,141203,14803,6634,45094,69362,50925,546,51884,62011,83296,234584,44515,56050,89476,87751,19373,12691,149923,19794,13833,35846,87557,58339,2884,19145,25647,12224,11024,77338,64608,122297,53025,7205,36189,36294,170779,21750,7739,173883,75192,35664,224240,113121,30181,26267,27036,117827,92015,106516,55628,203549,67949,60462,60844,35911,20457,1820,920,19773,8738,73173,181993,38521,98254,76257,46008,92796,5384,26868,151566,22124,2411,15919,186872,180021,28099,152961,78811,80237,62352,102653,74259,184890,16792,123702,224945,29940,19512,75283,14059,112691,92811,233329,20411,138569,53341,109802,50600,134528,66747,5529,166531,31578,64732,67189,1596,126357,967,167999,206598,109752,119431,207825,78791,91938,10301,27311,24233,252343,28831,32812,66002,112267,90895,8786,8095,16824,22866,21813,60507,174833,19549,130985,117051,52110,6938,81923,123864,38061,919,18680,53534,46739,112893,161529,85429,26761,11900,81121,91968,15390,217947,56524,1713,6654,37089,85630,138866,61850,16491,75577,16884,98296,73523,6140,44645,6062,36366,29844,57946,37932,42472,5266,20834,19309,33753,127182,134259,35810,41805,45878,312001,14881,47757,49251,120050,44252,3708,25856,107864,120347,1228,36550,41682,34496,47025,8393,173365,246526,12894,161607,35670,90785,126572,2095,124731,157033,58694,554,12786,9642,4817,16136,47864,174698,66992,4639,69284,10625,40710,27763,51738,30404,264105,137904,109882,52487,42824,57514,2740,10479,146799,107390,16586,88038,174951,9410,16185,44158,5568,40658,46108,12763,97385,26175,108859,664,230732,67470,46663,14395,50750,141320,93140,15361,47997,55784,6791,307840,118569,107326,18056,58281,260415,54691,8790,73332,45633,7511,45674,143373,14031,11799,94491,35646,96544,14560,26049,32983,25791,83814,42094,231370,63955,139212,2359,169908,3108,183486,105867,28197,32941,124968,26402,88267,149768,23053,3078,19091,52924,25383,19209,111548,97361,3959,24880,235061,9099,24921,161254,151405,20508,7159,34381,20133,11434,74036,19974,34769,36585,1076,22454,17354,38727,235160,111547,96454,117448,156940,91330,37299,7310,26915,117060,51369,22620,61861,322264,106850,111694,15091,2624,40345,300446,177064,1707,27389,54792,327783,132669,183543,59003,17744,20603,151134,106923,53084,71803,279424,319816,11579,21946,16728,38274,72711,5085,83391,88646,40159,25027,34680,10752,12988,54126,30365,18338,100445,230674,44874,84974,143877,123253,139372,28082,91477,144002,13096,219729,46016,50029,42377,14601,6660,58244,58978,23918,88206,113611,64452,17541,41032,10942,12021,49189,10978,40175,37156,10947,71709,106894,112538,57007,137486,150608,152719,40615,7746,279716,13101,19524,28708,40578,72320,1096,182051,94527,51275,22833,45164,81917,77519,48508,5421,140302,37845,149830,5587,27579,5357,428725,248187,6326,206760,39814,32585,89923,44341,288753,284443,96368,31201,94189,119504,20359,52073,103216,179,27934,32801,96035,34111,34309,101326,18198,20704,210266,37643,27880,141873,106e3,19414,56614,167714,66483,107885,86602,4379,20796,75467,4987,5017,118857,26003,34308,114428,29198,6686,29697,73632,3739,69795,16798,41504,7207,30722,21436,36735,28067,28545,3239,11221,36031,41889,100010,19247,317673,29495,174554,6424,129725,53845,94986,7955,59676,2604,191497,19735,102214,62954,23844,11872,179525,261436,34492,428,78404,142035,16747,17246,27578,37021,33672,57944,26056,135760,2369,61674,122066,31327,19374,157065,40553,130982,69619,71290,38855,72100,92903,95940,51422,165999,65713,57873,50726,7288,20272,2081,42326,22624,81120,57914,79352,19447,1684,72302,11774,302559,161481,96396,13692,414988,3721,79066,56627,46883,21150,11747,12184,5856,113458,176117,84416,52079,27933,3354,59765,141359,2212,216309,2555,23458,196722,142463,45701,44548,28798,19418,215,29916,9396,10574,114226,84475,13520,18694,34056,4524,90302,62930,13539,19407,77209,7728,38088,9535,2263,23875,183945,17750,26274,67172,10585,28042,22199,7478,51331,66030,26774,192929,31434,25850,50197,52926,178158,4679,181256,70184,229600,9959,105594,72158,73974,2726,35085,78087,23284,35568,51713,155676,5401,27254,11966,17569,223253,71993,103357,111477,55722,30504,26034,46774,35392,36285,214814,41143,163465,1051,16094,81044,6636,76489,179102,20712,39178,35683,125177,54219,30617,52994,25324,50123,2543,87529,58995,10688,125199,12388,60158,125481,131646,7642,133350,65874,3438,97277,101450,10075,56344,116821,50778,60547,98016,106135,13859,14255,16300,77373,173521,8285,45932,37426,4054,114295,55947,7703,39114,52,51119,128135,19714,60715,9554,50492,88180,2823,118271,52993,122625,97919,23859,37895,25040,33614,32102,20431,3577,9275,15686,43031,157741,110358,1884,40291,125391,13736,5008,64881,87336,77381,70711,43032,49155,118587,70494,4318,10168,30126,12580,10524,280104,104001,145413,2862,84140,6603,106005,13566,12780,11251,42830,571,179910,82443,13146,469,42714,32591,265217,424024,92553,54721,134100,6007,15242,114681,59030,16718,85465,200214,85982,55174,165013,23493,56964,82529,109150,32706,27568,82442,5350,14976,13165,44890,60021,21343,33978,17264,4655,22328,27819,75730,16567,55483,14510,17926,45827,150609,3704,7385,272531,161543,76904,122163,52405,2039,19165,41623,14423,228354,3369,176360,85491,7122,35789,303724,4465,13628,2233,55311,118771,20713,10006,221519,45115,71021,35650,29775,7337,10864,20665,21142,1746,15080,1624,32449,10905,105743,229797,7701,3940,22997,178467,57208,389057,39683,59403,63344,63125,54847,69691,18336,56448,3362,37202,18282,29648,138224,35867,10495,5911,28814,26653,31514,176702,26550,45621,11734,4525,40543,73944,121080,27858,155561,14887,44670,30742,8796,107455,113472,56369,75581,183777,240095,133699,153299,8768,160464,26058,49078,103971,21875,71486,44888,17156,9678,89541,123019,102337,3972,83930,21245,87852,109660,287918,183019,686,10100,39177,283941,11274,24736,26793,26214,25995,77011,141580,4070,23742,46285,46632,30700,26669,19056,35951,115575,174034,56097,35463,87425,24575,44245,38701,82317,85922,281616,100333,147697,61503,7730,84330,8530,59917,61597,17173,9092,32658,90288,193136,39023,20381,56654,31132,7779,1919,1375,117128,30819,11169,40938,23935,115201,101155,151034,4835,11231,74550,89388,59951,91704,107312,167882,115062,12732,72738,88703,464019,158267,57995,60496,737,14371,123867,4174,243339,159946,7568,16025,134556,110916,38103,191,80226,88794,29688,27230,10454,76308,57647,77409,113483,66864,14745,19808,12023,46583,84805,16015,17102,2231,20611,3547,95740,250131,34559,108894,8498,15853,159169,148920,20942,2813,93160,45188,210613,45531,52587,149062,39782,28194,57849,60965,84954,89766,84453,100927,16501,27658,165311,103841,54192,207341,19558,20084,319622,5672,205467,98462,61849,36279,13609,147177,24726,165015,209489,59591,31157,6551,117580,75060,141146,277310,21072,22023,106474,63041,137443,122965,68371,5383,42146,98961,113467,30863,23794,4843,99630,30392,82679,13699,241612,33601,93146,24319,18643,32155,95669,40440,15333,34089,67799,142144,58245,38633,114531,117400,77861,188726,5507,2568,8853,10987,107222,2663,2421,11530,13345,30075,41785,118661,104786,17459,12490,16281,71936,193555,17431,5944,71758,26485,77317,20803,367167,158,7362,93430,11735,172445,46002,11532,54482,930,62911,2235,23004,179236,4764,101859,208113,22477,55163,95579,14098,67320,162556,90709,156949,3826,57492,4025,34092,87442,104565,6718,186015,28214,14209,10039,107186,233912,58877,81637,55265,39828,6194,145813,50831,105849,4974,88319,122296,10272,197216,95714,51540,72418,23324,91555,8743,140452,250249,51666,34124,7229,38592,129641,78169,174242,22464,149964,51450,14034,10026,95376,26190,120062,14401,8700,265,31386,143573,7203,229889,61567,4227,140981,2466,72052,10787,10062,30958,6099,38471,30103,23202,208101,70847,467,58934,32271,32984,36637,24107,30771,17109,73353,13650,2098,157040,67366,66904,106018,265380,107238,18535,44025,32681,144983,62505,91295,56120,3082,77508,10322,63023,36700,81885,224127,16721,45023,239261,111272,13852,7866,149243,204199,32309,22084,42029,38316,126644,104973,14406,43454,67322,61310,15789,40285,24026,181047,6301,70927,23319,115823,27248,66693,115875,278566,63007,146844,56841,59007,87368,180001,22370,42114,80605,12022,10374,308,25079,14689,12618,63368,7936,264973,212291,136713,95999,105801,18965,32075,48700,52230,35119,96912,32992,8586,16606,101333,101812,14969,39930,759,193090,27387,42914,12937,5058,62646,64528,38624,25743,37502,3716,4435,30352,178687,26461,132611,42002,138442,35833,59582,16345,8048,60319,49349,309,47800,49739,90482,26405,34470,63786,32479,85028,39866,47846,11649,23934,29466,2816,42864,31828,7410,74885,49632,47629,111801,90749,19536,18767,105764,59606,21223,10746,76298,22220,39408,7190,79654,64856,11602,82156,272765,17079,70089,245473,51813,184407,384678,1576,122249,5064,27481,6188,25790,74361,27541,318284,45430,31488,620,93579,45723,192118,22670,51913,4162,70244,35966,26397,16199,50899,209613,121702,287507,2993,36101,132229,67345,33062,76295,118628,78705,52316,34375,107083,107454,44863,127561,33964,3073,154010,190914,55967,39074,6272,31047,5550,41123,26154,98638,47110,19998,148091,50229,31329,59900,195442,19106,61347,73497,70015,682,45850,25776,38022,148951,6288,37411,232526,109277,27286,32342,9262,5220,16651,23175,46740,129438,78614,121925,66914,88710,127952,5563,21500,34521,10739,14863,191006,62956,17359,16749,67027,56284,69134,43301,35039,58883,54466,60823,404451,75743,59856,86979,7923,34273,83785,32142,7693,268986,197428,282681,17049,22346,22990,92245,107180,3357,37104,96724,49153,7683,31197,43267,82231,164276,23696,20848,188364,22309,24821,158707,1018,22514,70922,27792,45589,59709,10765,736,35218,63479,51987,24275,63588,55361,92929,81964,4658,20122,12330,44058,13065,311456,72224,8337,211229,38979,22590,138478,52757,32595,133600,8838,31549,94412,43391,90056,1585,94802,127271,6223,31889,137038,132910,2165,57616,230152,6080,10748,36737,74579,134062,50525,180532,119270,34556,76155,82394,52595,29258,31435,87820,67996,26943,183878,38007,2410,13526,180297,69856,3503,187396,167700,7838,16701,9199,56267,3661,37407,65994,23767,5708,62508,221700,67088,86978,46776,84434,32088,5612,9149,88244,21685,95151,46750,189612,2979,506311,2594,3628,40074,105039,78243,28523,6651,38058,71999,30992,12764,68261,108991,6165,26450,61961,13400,22426,7490,60890,109623,2070,12958,50355,67979,257096,7213,42578,52121,35716,65461,7516,124758,39268,302,64712,14977,1467,219452,2840,34229,11121,21602,19270,63574,8024,1532,17331,79839,78885,52029,180767,57957,6069,91265,61380,55767,8927,32881,287603,22149,35029,68876,6428,199567,46926,13412,104132,21434,366616,45060,110046,81924,128910,45886,52821,130416,29416,77342,21762,67329,121432,79924,11724,38625,81006,102033,28338,13326,3250,82056,82526,38212,21112,12382,111495,3263,7414,86274,93490,40844,30224,45212,24019,48411,71367,24941,76729,57776,3769,38114,202019,197745,31953,237533,33270,201580,255648,100798,44741,32241,98468,106931,10085,15090,170358,33154,66787,18819,69760,25061,234005,82660,6295,131975,16874,9076,4094,25005,17740,40908,19533,220019,44330,99792,50040,19619,13950,55228,24423,31253,95308,103177,184795,28590,82285,5059,3210,75525,49894,70007,56178,10580,36051,139681,21617,98736,3555,106306,164189,37352,63915,47824,24883,145530,61904,28444,11483,19837,145446,30420,112972,85939,11835,191233,2262,20705,58630,1753,148334,1197,144714,6887,11223,107667,60879,77914,4151,57417,81594,96681,169430,1784,20444,95138,254041,27038,596,7117,72808,13759,3353,126776,21074,55322,27081,36942,39547,139830,179275,4453,713,8722,71399,19204,25785,22794,23923,104114,11291,25458,102309,88396,75288,230440,206396,104551,58447,130857,37247,94734,31548,176529,226077,65159,20104,10096,66881,94191,237909,27109,37404,1520,27421,25220,113003,23423,24884,50585,6286,231877,150800,11789,3226,90004,60642,5053,202400,61442,132531,175329,57138,30116,103847,9973,75367,16452,32360,59119,21246,10191,164804,23305,61051,37348,154530,13214,5468,50403,66754,130976,50559,80515,14436,155492,84017,5472,43107,41240,2890,90431,70188,382,76234,48040,50211,281038,237007,32115,142178,1536,22761,96429,1811,31243,1679,49143,55209,17402,235054,61494,7462,77030,34925,87609,78002,9499,9027,73289,201078,101379,63544,27666,5469,10642,30029,49816,132979,95620,58086,351930,116300,2110,2043,30845,6154,11279,16727,4122,2277,27281,4971,3650,39060,61970,65951,39674,75686,38151,11370,130809,177895,32665,63725,122267,7857,39618,118483,44792,157755,178624,136994,24260,41308,22471,12404,21707,12486,30473,52781,50246,20247,39065,909,56825,103158,128603,31542,1089,41935,32744,12428,37963,84420,33134,72921,208449,42622,168151,127335,147107,46699,38216,12591,94342,85814,31423,24944,2605,87542,67473,192551,4496,56321,91819,17630,6300,256183,114569,202090,33209,35289,34897,24967,40520,43470,5344,10199,34810,14283,10381,10017,62923,49924,23233,64539,13051,35686,19698,11570,135555,120868,44924,87065,52318,52335,47586,140906,245885,109834,78668,9065,46990,25258,72022,61243,40838,4545,146387,10537,11557,17470,36930,68104,46711,24264,79401,81043,18225,120488,24746,84338,81652,28266,13776,21878,46973,1047,230465,73357,95777,24973,210160,62210,58404,110633,169651,6937,41870,9909,26822,191062,76553,27519,96256,239070,2478,205678,67955,58532,20601,50120,19148,78501,195724,110740,8249,109665,27446,30568,57631,31425,49752,32820,65504,50079,3663,102256,219898,23849,211315,14645,4359,91767,9528,12449,49366,7941,49763,107848,8930,27086,50686,9744,10447,81935,39513,46514,1670,29229,6172,22312,137280,97759,9806,14445,22976,56458,73391,34983,93760,174219,52573,33149,59747,2429,136277,75123,165263,91040,7446,57632,48633,97140,246081,84766,151684,79918,93268,120346,54059,54875,77858,32996,103590,45276,11968,19600,25849,17159,132907,42828,16817,4913,99462,103303,27395,5737,74184,20749,21160,14377,77062,131403,158735,10999,27799,77785,9320,34366,51593,61070,33746,47048,29268,36675,30262,53297,9832,82e3,20188,122292,39917,7331,18160,68301,185935,134830,15031,4935,10004,165845,185534,46923,30109,44134,122631,18874,22903,112790,26561,18549,348902,82871,140345,255565,135390,63556,103747,145055,179600,145662,296111,61661,211987,23952,52342,126343,48450,32919,44277,82185,9591,62139,205363,376969,394874,108461,18040,120885,14798,39863,16571,16794,58271,81025,55206,14640,118656,6361,44092,85970,6262,153863,108244,180200,72264,79947,38044,10050,5735,61221,80712,5471,115689,11391,11661,184257,20010,60116,30320,19327,134598,45455,27542,18004,125092,452272,1549,91523,46567,180063,156026,2608,11174,58848,37788,65907,80194,30490,5786,40775,119519,106241,11323,156297,8425,61495,2617,29675,2425,59886,112582,49142,59618,4863,50597,86710,50650,168632,27693,85641,83643,18993,25768,84284,28090,93592,36627,312804,43381,9887,9402,100931,97165,3311,173330,66805,28935,4963,184460,3201,78102,19126,21607,37496,24938,22615,16153,32862,134792,153318,61120,6067,2812,12826,12792,23825,37559,64662,202250,102694,155488,85881,149193,46233,65383,15521,106982,11358,176786,25752,39717,34208,24510,32464,77742,39371,72028,138229,60688,71386,102834,132477,2208,11548,63670,271279,28351,30338,38620,32491,99845,143885,152266,13252,2825,178663,108097,1775,78201,14897,113573,163346,62292,171129,22183,96598,38733,64971,166776,117445,9968,146393,44677,74867,20908,97328,12761,25656,26785,9148,112344,26115,99176,110121,22437,49547,6180,79320,5835,31392,43328,33377,75870,119860,69497,80273,7325,155219,43167,111173,28347,20222,3763,71752,55041,47252,14618,28088,15012,97805,194698,54636,2036,41349,6173,96604,61530,51859,43782,13361,24334,22668,24792,7070,23441,16789,3209,36211,208475,26242,32880,122181,182407,21444,31060,88459,29929,77907,12716,10934,97005,20599,31690,8403,58445,30303,22700,10336,86731,103115,337709,72556,46788,112566,47684,67089,53548,36874,56487,41387,125985,26893,40071,106683,73712,18787,40105,72992,67246,137276,50802,36790,70328,138827,22466,39263,183295,29858,50975,9322,57397,10654,24364,30383,55799,41600,23584,127295,296610,129078,143558,244131,86397,36049,1085,80677,3820,108139,5476,34767,24683,7758,13060,7239,131671,250593,59556,103392,29810,4188,252323,39404,116877,7651,43600,40338,13554,157253,39196,25978,144387,61211,234,50104,6129,10449,93777,9240,356378,274148,4439,72970,3724,147770,78680,62570,115877,40027,40547,36817,224392,64609,34795,165027,67440,2477,37206,23431,50754,164797,46018,94995,170982,27051,7957,22767,3674,27900,56419,18930,60701,41302,2692,84749,339721,61996,111094,80221,50129,1045,8153,62945,19202,8250,37208,37418,32560,79477,41106,88569,33963,36693,5892,30570,1581,66471,49647,11922,160717,29442,5643,114865,82962,95982,132098,22633,22838,94726,54556,28566,205039,162340,33216,16849,35847,221339,94851,26533,71469,1805,3804,12935,45483,71020,36310,65381,192960,34240,35165,59773,1248,46954,155332,96864,4246,388800,16129,57133,74592,44807,442014,38203,42574,80818,91592,26377,36424,65760,977,77387,22628,147610,28018,30561,98454,6969,119628,63648,18170,36854,26601,64018,22027,37279,51395,152934,21153,9430,58760,194742,5330,55115,34158,28917,174111,13171,122326,1526,43896,66094,25325,4234,148354,11450,275,18999,112191,44365,22723,68409,8733,57746,96565,75007,14196,108844,29475,88599,177563,100792,106156,86323,93726,14248,135341,194131,40126,47099,14779,8272,39597,95983,171398,65882,28052,10393,47213,40689,22120,72212,106829,34964,109146,753,648,21660,30047,17527,181025,5619,145357,4085,216883,9359,186951,24779,53931,24545,36197,223296,62628,168101,4243,107313,30321,26642,13049,51059,31027,107912,807,73550,26551,84369,122422,165872,49754,74213,234264,33151,52014,33100,87183,22365,52500,40013,23302,5652,72723,21404,26107,48434,587,94049,168493,96418,32871,70860,31709,25128,443,71597,166253,15670,70994,26341,133675,28280,75491,54756,47955,56028,26182,11952,113272,472197,64640,110753,17919,337,50642,22576,142,87371,53391,93210,126694,15285,19642,85667,14148,1506,42092,52962,33243,11970,20734,135843,57044,58880,13002,219134,22876,64754,232519,4257,43120,321573,24799,64526,124728,52579,81472,70831,276848,17403,74359,23021,182101,74597,23744,148267,12055,7976,5349,11772,67540,167347,65318,18720,127832,108238,22828,90233,9987,259080,118185,73209,79270,13775,90100,137742,90799,70569,15699,19961,9087,67475,57872,39731,8810,134897,131868,146849,19898,3334,2281,167061,91073,60356,467742,74712,188,53179,137679,92769,29241,9537,132595,80119,1041,88962,5976,40171,44911,102859,139059,104558,98987,47761,19272,71472,113864,175377,73338,10857,23402,23758,1591,139864,5644,4076,118760,16427,134198,18853,20291,100849,37423,22038,36677,19071,195521,57445,11069,31869,55718,66882,148490,44,41296,75242,49704,166810,9906,20943,122258,49112,105667,15969,10344,6408,187694,21399,72742,58970,14867,14376,81889,41856,23225,15042,56993,16074,131389,74276,72407,53875,383108,53597,37363,68993,44854,122548,430927,198279,38430,80409,12245,2981,628,2818,17760,37437,238229,7968,46892,2200,3730,34190,65983,37959,112291,87850,70827,6522,20750,73913,111621,41652,19587,2780,58668,25916,85259,18200,168962,95781,42445,102050,7776,57662,103313,47742,96358,41964,66174,100396,29069,204735,19679,27978,7479,40264,22534,61183,36081,107436,58223,14680,23002,101311,24716,124108,12908,5646,31750,40380,14215,232799,102772,14122,96775,61398,50917,12096,149880,67833,598749,124194,155871,49216,790,14677,65319,56917,7440,145744,95701,12206,49405,129269,76199,45732,9767,11058,9047,210885,11051,7392,26307,2130,8132,147526,20802,232698,115660,50060,59789,57344,107623,80343,112676,23291,9866,160971,34032,118291,15719,59730,164911,28975,2659,58046,78480,21854,66209,53863,109085,116045,29021,46481,107552,22130,18764,70254,31272,11300,52460,43933,84738,20721,53869,190840,79673,105300,7561,321817,66924,13940,33281,101046,183181,32176,71878,5678,62924,79535,56646,40303,19559,27703,93042,73368,42187,3670,37376,46440,7023,36816,109628,20680,5940,276440,275233,170848,112093,136996,14984,20226,111441,77693,112960,48577,39370,55707,50314,123404,26570,54281,61372,123391,4857,35928,246740,132507,106646,44241,7196,92258,9825,37688,51197,303141,5590,15476,132986,10955,85782,34486,26696,7991,28813,18858,39546,11703,11365,38185,5716,93555,11925,40121,60002,6985,10976,171384,3887,43394,13337,56346,6381,252336,39573,75042,53711,1028,31781,44295,95925,131713,7214,68125,43571,70954,213234,1628,8760,13391,65485,17320,56038,1710,25248,60803,57399,19839,3870,326,281556,50945,72400,21460,316244,75619,56246,98775,481,13513,55765,50427,7388,123519,32929,57908,27124,61316,101097,57467,30228,48792,10788,20402,37318,50526,155730,34456,158065,145305,17832,43733,64052,4506,35072,205355,177028,184004,187081,68616,35938,83703,10367,36892,93186,260137,51934,89970,4985,23445,26755,21558,7948,78741,23376,124405,85594,68596,57536,49351,12619,56593,132668,99924,109728,71844,71935,196018,65464,17617,14987,89701,143773,33997,8687,22701,33258,2914,4436,72108,85610,9671,49067,2327,82988,1361,1672,44033,35777,30269,24057,10605,82236,616,15793,13919,47249,112086,116698,9484,80207,90574,33304,68624,93127,56101,42210,160929,4827,38995,38095,4701,125119,5027,33680,9236,231236,14135,87837,23318,70261,78893,30151,81482,14332,1084,74256,27532,46644,79185,3148,62615,6981,55672,31668,36825,1849,14536,37446,14738,23779,43058,162749,72199,1168,21346,5592,85932,85302,9668,18351,57135,150360,2080,228015,77953,34670,119302,151751,31009,106725,84265,45214,59289,74178,113071,263206,111009,4021,44449,188119,192629,123592,392506,292847,114487,12831,205858,9852,20780,79648,75767,357014,97721,18166,21005,67950,33226,204009,16536,2987,11335,66717,144910,47950,17262,55060,15063,2934,51038,26775,178497,66008,3427,49433,128592,20036,157553,63861,3089,23015,51210,28696,35933,49942,71135,231518,99620,17248,21835,176536,20676,16944,38700,165831,233253,295625,36723,13023,52745,10907,19423,67972,125868,95473,82875,1183,108455,52685,33417,64095,21433,52438,33191,127809,44505,211823,7810,2752,95548,162031,7185,91196,47563,61721,33359,17897,23682,42806,178101,22874,49707,199897,75419,82456,8618,11171,79712,116847,18783,44190,46564,5346,59046,95032,7893,14916,3214,26800,24172,121453,34362,10250,17408,18888,4840,68696,22831,13162,36005,32512,14800,62357,41723,45046,27247,37486,5372,2564,34261,298500,66509,133920,89138,31305,117697,19097,108304,81386,84106,23802,46411,63304,946,51417,41777,41041,19501,115864,60743,294354,37955,94165,18116,1156,17937,20645,57114,90804,58042,48643,92288,9861,2557,88546,61333,101008,12853,5148,87856,4152,144503,73841,18718,9789,147565,10846,42085,12789,30223,8993,56352,67203,2448,28215,6052,23540,126319,75933,36689,80235,23231,23561,21383,38800,77548,102798,21234,31468,158608,46188,63960,191679,8051,67014,11185,170078,42186,28827,34777,41930,212079,12421,34750,24111,110344,73918,45171,70826,141949,40063,23979,24254,37309,26724,27179,24718,83648,54938,14591,17425,29525,102675,48975,48654,12316,8929,60640,41709,50168,63264,89812,50716,48632,38755,138583,160123,55579,71829,24230,233277,46322,39650,166388,34718,24108,98252,7031,106695,62498,18258,35062,217827,78731,34824,33354,19520,60852,2432,60224,8587,2836,62955,702,20227,42285,40560,95592,62486,11094,53035,143291,18842,46177,77994,1770,9657,107422,172915,32655,128716,25886,25164,156740,119928,165875,85817,11007,89110,33956,12652,65156,180266,8494,36889,19958,20955,96,1264,118288,135769,44754,86671,5632,19026,168220,289120,33569,93821,66144,70635,7687,5642,2714,55445,56636,71545,184182,93133,7332,37389,12643,52315,22729,11014,158742,17050,152889,50178,34601,41945,52136,9948,26914,63548,95721,115951,40759,8960,158258,38938,49232,48325,42234,81523,253019,66128,40978,20048,238048,38760,62928,122560,118532,43687,137472,163689,26680,9878,17448,51035,16211,60834,36749,29178,14241,59868,150086,2305,26477,42422,34342,165341,83279,33894,14257,29928,12743,13957,125571,89134,66712,10952,16507,147839,30146,7249,16565,45399,39874,114565,215780,31990,230881,171477,102,196546,44538,10880,84948,281705,86651,10617,31395,2342,453658,43569,60561,132901,21845,17727,58556,258242,22262,58728,4008,77997,11806,37431,30599,81375,109137,185787,114085,217292,97453,169085,30593,60212,11544,102056,65580,2384,91655,4855,95725,7295,157994,16228,20669,53276,141590,105246,17334,25440,76067,17967,39321,38911,11362,28559,63807,21627,26468,85816,40120,1025,15234,58319,69516,66512,124548,75845,78873,22137,46681,51242,85683,32909,76747,35555,43396,101465,1765,73094,1077,2962,39028,66777,57831,42048,15828,13962,36041,63657,52412,5242,58846,2141,5506,219012,134451,3936,182230,17558,17153,152237,22621,49377,170216,35257,68233,65374,6510,11126,212151,7184,2480,22517,3437,33073,30156,16557,3768,55067,86829,91e3,12350,148650,66017,79424,70885,49066,28250,21369,51213,34533,11510,3258,18176,18465,84413,6315,36411,163765,4346,356,107618,598,13727,285026,162695,8749,14583,7132,63521,184253,32378,25991,5604,30961,53675,4874,84693,5086,34811,26978,56564,7904,33519,51221,113942,69253,6664,125563,22055,220680,102008,742,51930,19494,176108,44424,35123,13025,75685,11759,74335,22250,181453,131147,16984,132115,154311,11991,76452,52609,85351,196,30969,9198,74919,2529,56838,71779,29187,116304,3504,62330,41190,86153,28393,254926,104228,105189,13264,84359,3574,12415,8534,57147,10175,188174,59504,60932,66318,16407,107921,17638,99103,49278,28403,39786,145865,8462,3558,43406,142271,29139,21989,36552,93955,72365,7176,13556,106185,37957,321774,17782,129017,51154,27938,24952,1935,39366,2791,33489,41582,56078,24558,9311,5449,218786,27808,190429,68013,36020,86003,29735,3404,87348,119357,115714,2324,86796,81973,40992,43376,93621,28784,16808,36367,2517,2909,191926,24978,55303,53308,205724,60068,3098,21375,64784,23949,26579,63121,12319,80145,39967,97861,6757,70143,67642,37082,34698,69140,122883,46151,62187,80934,429,19437,135071,137885,222647,13331,154065,327,61778,74257,40116,37493,14855,85079,237641,42342,102164,199965,71204,4662,29368,5042,113914,122214,8955,13149,102503,43173,5659,163787,69003,307084,63392,171080,21390,81918,86666,36622,24126,28887,5736,28054,207170,163428,79891,346467,95363,38980,111806,80828,9200,19288,294896,114468,87405,111715,141705,7015,72754,68463,48738,243147,33397,101210,37051,98801,82847,20397,4940,185559,18716,54718,83491,11725,40803,1128,12128,23060,5174,7745,67007,46701,1571,27807,180186,256996,18975,16837,7877,212758,250379,15440,87954,57755,24719,124057,83461,258,50864,8874,29038,71289,31627,15429,9005,4061,113851,107716,82819,13651,79656,117851,17539,111446,12938,39724,190787,4352,15402,21070,62708,8539,23777,73853,13552,38810,86117,16285,56400,1718,75342,142863,29033,378,110113,180321,32586,23606,26393,160984,207987,23783,8406,16904,24596,47274,11693,46539,60524,78595,48423,31718,20170,9009,146268,15183,191060,172765,1349,138436,37365,10970,40509,225817,20021,70394,152138,21541,66559,66544,89352,2725,17258,91345,7313,3815,115868,8660,40362,4071,103524,39388,118275,21950,6549,38226,32754,209574,29201,43495,18028,20296,40597,18370,47520,202450,24134,2219,8195,69545,38041,136934,46374,19041,159811,84865,58620,846,98749,13569,30714,97246,32186,4479,27355,92973,35214,151491,75963,37631,1561,27200,238083,23182,60756,12291,25766,39355,102333,87362,65741,59906,19538,201575,48772,102938,24438,292580,39964,66366,9004,61379,50548,37622,38732,28379,68180,76622,17488,69849,5963,7219,48143,43413,55358,540,58691,29506,19245,52193,48621,5518,13048,118625,44755,191081,42061,89197,2259,60665,66994,71210,51232,3585,142096,55024,7892,8345,58653,463307,65658,64319,137941,136323,53499,12746,43492,6978,95163,29925,60175,5128,7352,41463,184756,121146,20473,18426,4598,5309,54580,14277,121151,10691,56711,43880,63409,76682,11830,172218,264898,32632,66536,81062,31649,25788,92774,60222,11100,63159,9432,224657,25240,53613,152,138620,163829,2397,85345,12501,37507,64932,38575,43522,65789,80198,78796,35226,3851,108891,73311,3060,28391,93671,39663,46142,30982,66041,37281,68157,26553,71872,81142,211527,39747,118119,22695,2859,11066,20232,168911,7933,197005,17066,111071,44434,133994,120798,12766,227798,45756,132852,29917,36076,55352,65281,129800,41958,18944,84678,18580,168093,132621,39997,54092,27740,32354,3770,114118,103242,43918,15899,18574,145944,3190,123469,219903,24169,100571,62403,16776,92779,14535,17168,16475,14304,37231,1712,28218,242754,61688,28980,1318,51359,222657,99200,67989,31772,23932,35351,201251,49041,27306,19128,40135,3986,77333,19649,120683,151927,21081,7076,78375,77501,101599,8011,89585,96715,58179,5378,102138,106793,26051,217276,4197,16297,27014,46721,13322,22806,5278,29629,70632,9647,71519,58818,40603,128530,8903,36770,56900,31483,26935,43845,34265,34920,87658,6114,84767,64250,47318,50720,19264,162514,33357,13117,6705,46696,75032,71054,87004,42035,69138,11903,99854,102328,19611,34525,69312,6431,49842,101600,133178,108751,41829,89939,225664,48916,99556,9195,130387,5960,36857,116724,53518,94002,39077,53996,6945,22261,64291,8314,152785,57588,16522,9091,5048,87671,35441,39509,1945,12423,158923,178413,37549,14095,1475,73188,62878,4819,24012,68534,42606,4010,120809,57497,59564,101758,103718,32701,80116,12345,95834,46918,21468,53213,15665,31200,3867,5140,96013,250744,21016,10069,13968,35449,180829,27683,39704,59956,22893,3115,26293,32785,75934,62445,141162,62720,2018,83638,19949,114012,95006,3330,99829,130935,309272,9565,55874,121727,37017,23586,319858,40970,27602,8625,112329,61060,100088,118525,25922,16232,1907,60671,51583,44553,80993,5262,94679,8676,940,20736,11823,3020,16476,12340,152600,97416,3703,25744,66826,16245,16876,46446,84798,74227,176020,45192,61955,75496,23946,23626,40372,26036,6149,11822,30582,16541,41914,82385,232823,40921,80773,14930,3631,7517,39619,4348,36180,126106,138939,62611,1477,113512,47321,25052,14546,118881,29060,23589,128322,36795,18401,137921,104699,267929,36194,172791,18113,4766,188215,30083,332586,94089,5805,77909,22194,68234,154976,43220,40660,70001,184893,138095,11128,103010,22663,5108,212615,8485,5565,49222,54614,26530,42639,16319,55062,152662,105595,21114,22216,10294,68158,10436,86950,7206,62115,3977,3657,59874,456,118617,18156,106663,112229,80992,17442,8217,55551,5133,34344,251927,51153,39364,201321,7816,66803,23057,156724,145664,14276,95705,979,2796,6875,13429,212525,50602,26276,28284,3424,19465,52397,46963,31420,51399,206476,92317,48851,637,100820,83349,10317,60227,21972,6908,282439,32857,224767,95629,83882,42106,87338,69757,29840,68709,37665,45244,114577,49188,175943,54009,186746,106158,70168,3358,234002,50555,9221,129338,9562,20118,32923,78479,118280,65752,4977,10474,102174,60947,129006,10570,83451,8598,8078,159367,123785,80438,16742,5905,5281,181513,42402,6977,163136,93179,42191,14968,50421,112401,105440,33456,57347,121611,4221,94954,36517,24046,27796,6255,33394,72990,135408,116627,1233,57874,25654,95419,68156,401399,313338,55208,45573,93124,119251,47200,38196,11909,130667,45391,73904,64964,167846,4137,115606,52036,62214,7969,160925,7187,1132,134835,40309,73195,64494,80472,444841,61111,26500,45323,40743,53625,52797,22659,15631,29739,36706,28841,39147,102836,26794,10536,14845,87305,45874,12241,127587,83833,57183,79722,30844,41304,84655,20825,92500,3722,25655,27811,10157,81634,31362,34088,92487,70123,22190,185100,72658,139035,192523,88241,2078,230490,44528,85638,100198,22088,29982,291233,241062,13865,4445,137791,37835,107218,31726,19718,38234,72528,23046,19177,66695,5109,17251,28077,5617,21554,47839,72425,133825,1486,73065,181275,141508,21768,62971,63082,2512,34200,9904,120309,6392,91243,68416,268253,41199,116757,138551,185526,41246,28986,4093,19057,17295,4148,245766,122360,35356,112075,20301,75441,10998,7977,19769,62922,937,63547,100196,26427,157820,20983,236696,22935,8140,90315,156004,47204,140973,7726,45097,52725,22636,23436,257282,105247,522,88389,216031,202204,46812,211666,19693,68828,81691,45925,11256,30292,372,5236,167826,88328,232776,151611,5360,82104,18841,80393,25465,18285,20320,72377,31730,33160,45803,38715,27705,37379,24163,18360,103586,4015,32305,269494,91252,20080,36567,54650,7797,57073,12650,31164,42209,6375,261663,105528,81661,106002,2800,5375,17247,43151,4442,15727,194619,100855,144898,62320,78465,39929,16454,1967,28311,61363,17219,9395,8745,121445,76939,80385,162380,22009,54191,44248,16299,122830,48151,74429,78291,64755,14238,44966,2511,17712,67954,93583,829,105899,49935,84750,11591,33185,85447,42717,27409,208542,28965,62052,52525,5597,25694,65594,16343,63224,276188,12475,9331,127507,38522,57287,24128,133161,79723,105548,133695,48917,27558,43278,46520,13778,141954,110785,83366,17715,46317,105763,66298,147013,41086,94180,16478,220447,44611,730,19722,78975,117889,125643,26254,16574,18480,65006,15806,38549,246418,46052,36056,8440,34984,30170,3163,59800,4458,115442,4283,41970,33507,104078,1653,22,121158,276486,3655,6338,24048,133421,23641,2161,24422,36006,8086,10675,181474,12307,29514,59143,14729,52509,87128,122470,19446,80852,33314,24573,119864,14237,9652,57779,6612,51851,15284,98871,90581,124466,156831,21190,22015,71380,161906,87247,69201,18392,17908,108470,72962,40719,14338,17911,95260,43339,20610,78916,20710,72451,11315,31448,17263,58853,178878,48111,116002,45497,80506,82605,85880,36300,121755,25215,36118,301929,88728,405223,276136,553,34704,212438,49970,78329,922,20711,25036,257130,38295,145369,18128,15385,30829,55656,48345,8012,3561,28004,122041,192900,58338,112508,41085,29976,87040,47117,23905,4336,92061,138880,97407,42083,172121,6256,25192,172671,5,93568,1420,12677,31605,56743,40620,6015,78415,231077,31298,80026,13902,19048,24924,170586,32955,176119,87859,36731,6773,27711,24658,26475,115216,133207,93250,95820,88522,8317,5714,124047,55219,86860,19677,23961,22928,162209,8904,225992,359835,56084,96201,29392,96558,86071,93643,55114,13347,8183,95129,82012,2017,123336,34219,115554,157159,47747,101684,41008,18735,193781,104151,226906,7552,179874,124113,31159,21162,44010,14771,51268,166128,31382,73124,77438,92830,205709,12113,1292,38937,13114,1334,2118,15597,69581,14449,21934,76618,48728,67038,14967,51495,24243,87736,147249,26720,11119,46063,43749,5843,44147,152629,133428,65703,14269,45604,57982,28672,55616,45957,8438,95433,37698,220862,132034,39456,61870,4161,26501,73560,56418,9845,4654,20916,10456,88920,119358,9015,65931,96507,48029,38534,21676,109081,43078,34943,25089,6131,28766,23665,5477,10255,16695,67,45778,42443,42770,29534,23733,100513,62617,42630,48746,14191,43753,50295,26007,8792,57243,43119,54725,164253,58250,112304,131796,25165,4651,3188,24831,47748,3705,19540,13211,102095,5593,18699,23666,32005,117571,33541,60584,74573,86311,99443,25172,27222,168938,7143,11853,53560,18834,19960,86522,28217,53266,117700,72989,34323,18721,66450,34346,74056,47217,202002,46269,9429,68582,75458,37823,82843,96652,32549,145144,27958,19820,158086,31955,201406,135379,31207,192545,12950,51704,9094,248263,76147,64028,110009,79407,89345,99284,223492,47966,26848,15359,201137,2861,110507,71231,72297,31851,118777,71039,151051,240855,16333,50766,14727,7939,4149,80908,418780,88378,59276,1327,7284,38576,79814,65820,42199,84860,49574,62596,12396,70598,40117,8648,7994,16836,7630,14047,359699,106878,525,29037,28064,13380,11675,50669,74216,103539,180314,27449,56299,172344,19274,7301,246099,32043,19422,36506,129317,6806,30140,4614,46639,66926,932,86600,6322,27847,233103,10541,39025,34887,3517,12972,26220,2031,66561,115015,48658,47596,12714,33845,3893,16165,35237,89983,14769,11962,147224,47018,29977,27979,5552,82338,86023,131368,1218,24853,237840,132193,15455,40873,3668,65351,53388,15229,59889,272245,47934,11858,34347,18038,90853,86981,300602,19343,114181,29362,84921,6095,106059,79472,38015,1206,48741,6208,8e4,21916,17423,6002,108083,24479,34931,56661,9511,26995,100694,163853,35997,81254,58321,18919,171890,86877,91341,74503,70477,53412,7027,59281,39892,131302,5864,15947,61301,67466,162369,47956,27874,35624,282324,21270,111847,102548,41482,30955,116737,28264,8592,55458,22301,75090,29821,30697,51709,3041,19208,8038,24634,30467,87509,126428,19389,18814,152686,20701,83474,45832,80891,105808,11378,153223,120770,98186,150633,49838,9141,12755,30962,5260,74490,21256,31678,65062,33326,289838,187831,20595,89768,2805,58535,10844,70085,12090,2451,138068,98544,24461,4511,6754,41684,28203,3383,65355,82833,30161,83924,234361,128424,28921,222594,33975,125491,34069,11508,67464,144226,41850,98703,34371,7901,21254,38398,65651,23549,53883,213340,123269,12028,71764,177701,28758,2623,68395,11549,15232,68603,9660,63116,36079,57093,31198,20475,48467,89984,35619,186847,107469,31389,43631,73867,41949,68841,114250,1605,30564,63403,17588,27680,99533,12641,70325,50428,73426,78379,11855,91651,72081,91720,60198,15743,12065,83398,140046,6761,46598,45900,5068,886,62448,148968,37347,19405,9680,15819,43496,63370,75667,163700,37639,3633,22774,34341,183131,134335,37200,23915,7054,14194,12970,26438,13350,285521,25594,8219,104410,91039,168804,138480,149734,15907,33818,61132,60082,4622,110187,56736,13551,73571,3945,73463,65498,17758,263266,17593,2710,27585,54469,38200,45367,63754,28881,3473,12791,98287,31895,65787,4463,94536,24951,36332,59901,28803,52130,86403,7668,181822,74831,18977,9850,177206,145485,109798,7292,31421,26280,77211,58511,12507,127004,11113,147,8729,56208,43066,79926,129937,31345,83947,39915,46146,98763,42566,1337,13192,18323,105163,80570,117753,16555,72883,11077,159438,40764,70933,83329,26066,12276,72059,21655,173836,126713,69454,153482,91585,70644,102558,110483,6764,127864,190133,3961,101798,20945,71138,82402,90884,69669,44753,923,16939,59700,164258,25969,27082,31399,43846,6306,246093,51342,6153,151581,202801,182731,56475,162188,89426,141356,14355,121815,27536,28023,65257,77523,106668,127314,24947,12790,38796,169698,23555,10725,44573,183083,42088,62716,43265,105958,32050,44067,50118,1668,3874,6243,318411,16599,1691,94999,52378,28671,216728,123258,2059,34969,69225,5913,136280,171443,141515,91662,22175,135282,80020,92270,1663,4808,4482,3495,34691,5226,109830,108512,17342,107488,11606,123190,100247,29666,146527,113014,15794,30894,13224,39585,243192,22351,9903,7836,47699,11078,25468,122291,48821,26780,122679,75521,81450,630,4895,92900,55074,74293,17441,3563,111657,103102,51613,12318,52370,36191,68245,34269,40445,41354,122901,168604,182500,62012,42557,11259,24428,115113,86345,12362,3909,78430,86852,134602,20459,47853,93879,22577,7659,3688,38555,13349,17381,56715,91639,12493,10895,92438,3142,37057,28928,2004,36427,32268,34222,209974,10432,67436,41989,173518,107930,27079,62729,30908,55558,5828,45031,14902,53546,8204,144263,60255,14520,88212,86582,109589,69356,8064,47449,8505,66558,16886,4844,52817,111260,215129,12941,91118,650,20770,6273,73089,40618,62790,2873,35002,14023,97208,19386,102646,36993,143736,135457,35385,113601,17893,32627,84439,100619,56016,6581,57264,172160,45452,111710,203627,70131,24100,322787,1996,35665,70078,22358,90922,83658,4097,63200,58499,14542,99153,52159,6615,12414,63415,31986,16823,1579,65405,137809,8841,16898,48082,259,33014,42375,12260,179850,73667,91389,98882,29532,17311,326251,41092,5928,20742,44964,48019,43505,9317,49265,6643,192712,48424,163487,19861,20113,70848,31928,105333,23685,78563,14638,54755,7158,24142,44018,20774,125255,20331,24280,10163,1285,2336,39851,4299,117269,46714,63816,87779,159624,11731,9971,990,137317,108831,50994,74554,162680,23640,131597,146962,170620,34829,91205,21184,1913,63616,18427,93136,156592,17519,67565,115882,138220,78622,88535,18115,2711,33554,109492,54298,971,24914,25863,36363,45715,27099,194995,14299,178181,111488,72395,322385,157719,130787,11897,81843,83999,11369,49280,118604,40922,61332,110343,53407,75639,40582,300440,54722,25637,13694,48248,48278,194521,56203,52779,48783,72627,10953,376,16733,280238,26351,230789,15132,25168,137270,3588,63704,73376,94031,74284,19443,159557,9697,39901,13351,119050,15406,146455,3460,29556,75195,37673,102524,92329,47289,98413,15311,100684,56345,7116,95480,11590,7200,167,23610,58426,17730,136656,27944,53151,2701,8824,103124,3017,90744,113588,53216,79736,65940,26931,498,29568,80540,143543,21292,1740,59268,16561,180816,42323,50174,40890,52866,10703,57169,4700,17191,4424,93511,49698,166650,26972,48631,165169,82879,69326,202970,4007,2376,231325,139592,22119,62851,37504,68816,58345,67398,186643,43331,277416,53749,15746,23102,17432,4793,151138,48822,54265,48203,198688,14305,54287,2291,18018,113378,123260,7180,97549,87027,120085,2920,76080,8190,102005,5641,64580,14955,59802,54028,58884,19367,81779,412567,85957,97053,103637,78871,29364,27637,141728,4767,30686,112738,130146,42745,12730,105040,14844,232,210944,36581,152317,135543,29744,3129,55647,58149,46319,27265,17499,28005,59948,7170,34138,5702,293047,110892,408,91760,218674,18469,46095,81403,14389,4610,35672,73060,11006,74848,104820,118143,190357,20043,105358,141735,5115,27093,45924,123073,52599,29433,9616,238350,78610,24851,58858,26769,31969,24613,18294,4982,32735,39639,143563,112073,202205,12567,4873,88601,44897,81503,101648,81362,34662,85277,17574,48173,21435,221188,40215,39576,80786,26544,64668,81841,10731,37733,247986,149188,127703,495,18382,54388,72446,43071,30974,198723,89608,41360,190,33045,8386,31658,19992,237838,119015,137622,50890,100913,6460,116233,267230,26621,104129,65114,14190,41542,14888,85962,23342,23041,26453,43725,71809,45186,4770,46452,53894,56616,221286,18973,9038,109299,55365,19366,26863,18808,60909,69353,41738,83463,12100,68561,72860,3980,13796,49340,12332,31311,27418,4255,53430,18976,45523,510,14224,30477,26581,4530,3651,101663,139840,22709,150861,31996,63923,120623,262522,3076,10528,2929,14672,130238,18087,9816,121894,100308,25085,55111,14565,18952,53293,2042,369988,23674,61789,133529,28783,108293,35477,47119,36448,71049,40015,33055,78598,198442,1833,159937,40654,77444,189245,113153,8621,18599,38553,35223,166072,2375,11659,21786,89523,6032,12116,63046,159398,18454,3678,32521,47626,11411,103527,38896,42946,15696,26370,10185,8413,37080,165583,4331,63555,14907,72220,50056,6623,62236,36565,49783,10049,17503,100581,55951,146244,24724,9626,17969,25524,109300,173965,99994,101056,46459,43647,53737,277968,8347,123521,74858,33829,44762,77574,877,81377,222525,123532,30602,43881,53145,2973,16284,81940,61281,127044,63620,9875,14756,114829,19032,9202,52759,119141,23928,120551,19607,3599,33401,76821,73233,117430,39968,36539,7071,5446,121735,194059,15206,45283,6706,15603,65615,1207,165723,92275,34773,104447,8396,32353,205240,164323,13600,60555,79205,25532,22907,33410,57480,107111,69630,32137,47832,70913,33161,20321,2371,117348,10714,86246,1625,11763,17900,268,78457,99175,97940,101092,86660,32221,14041,128504,125080,53744,124263,31017,13897,403,31859,21964,5633,111630,5547,77329,17961,18241,84995,25984,12983,67491,62168,47262,5241,297,51191,7351,8967,147212,82060,16821,782,11033,82431,62957,5026,43459,77963,203477,53528,6247,191852,87774,74164,215654,13467,1522,219964,28589,244104,16242,117821,67725,72570,156792,17186,15979,26990,44128,193014,35276,57125,16212,166451,68017,6905,77608,16364,53777,75921,76426,37975,26203,269296,64099,84122,12077,38533,830,4407,20139,963,43028,38902,42911,37503,83343,85045,16979,1165,60835,137387,58380,86990,110066,134540,56331,193845,81238,17922,163093,38744,110641,12502,56404,34862,26865,125964,12965,111648,25547,7771,27196,136980,9555,29551,107158,57885,18831,37705,35505,101742,13970,102109,62548,124657,23328,11124,89592,146376,248050,6241,22033,18337,80685,29898,11908,216623,67721,106162,146610,21377,15085,91552,42041,62560,122532,125336,102365,121537,142559,29693,223919,11515,110495,18776,22494,5895,185059,103592,229351,51220,100102,37027,257855,29359,54123,36066,106493,12244,79258,32002,432,56205,94836,90182,6726,14762,29391,48938,26864,38083,60364,3310,60192,14766,205567,57504,110760,22649,24666,46333,21517,3430,13135,28873,27052,158809,11597,20529,6695,23138,22960,37137,45574,6545,305877,43423,26153,24769,59844,14501,10430,134352,56169,13213,103432,49523,35181,13435,12408,129475,64620,230854,77390,51990,15653,83248,33466,44571,117828,51481,2187,10559,68019,18021,54895,48247,18354,33737,4554,108595,37288,39767,116707,9175,3726,108877,21616,83684,49862,1938,8543,276466,20134,108498,48770,102254,31914,131520,185291,100559,51890,209,19526,76471,50544,71814,99351,8172,198526,28816,20419,9109,98389,136777,76479,75596,30635,165417,48216,120220,25955,211071,39314,24308,32164,2559,146280,43403,9233,17947,90585,1786,86920,125662,2457,64741,32152,32918,122882,78538,44001,31723,56426,23375,103172,88177,145697,52506,49319,68016,31664,41488,18486,110400,7030,28241,986,109199,19900,42147,56864,65287,49183,7858,24e3,30453,840,16673,25907,68916,89927,6309,158335,36407,199737,130464,13137,59603,201778,195292,21015,42466,179062,172561,89492,11075,180407,31868,72493,20998,60217,9865,19530,39274,130266,54539,21623,12535,13505,40641,73375,4087,85633,2153,3117,70680,55788,92096,47509,98493,37490,271936,151475,3032,16171,96642,34106,78425,125761,19591,3366,19316,54508,24183,50786,194248,91528,33253,34622,108355,41741,705,3814,3883,108929,13203,67831,10142,59754,68208,29128,84820,56880,38794,24972,48571,40821,40476,18137,164254,24064,236309,79181,11282,395,39169,2013,51587,28551,9645,701,109513,115899,113566,12762,62045,58322,103726,41343,40866,244102,143816,2490,70346,40973,52618,15412,30720,104315,38917,42027,93676,17513,107418,20706,123890,13399,97727,24044,87962,65606,44250,98044,65276,74790,101473,19350,91570,1326,87790,172042,7577,100813,86896,85891,41512,108130,27794,14875,71431,12835,156250,58135,3759,22476,42176,115873,34686,56523,73643,108505,51491,20838,12721,32863,45700,29496,13700,34294,55360,29206,155942,123812,7706,163234,203,132720,49358,144431,8130,175788,35818,3270,76832,25710,54095,97274,28779,94621,74396,19092,128242,58067,20885,14670,93255,15107,63291,23654,126900,129421,59294,262659,9798,3251,67344,28600,44629,50672,29072,26999,31526,23183,49175,165843,175455,17282,175411,32022,45989,30298,90690,78118,83156,23749,35636,31317,7069,80381,94561,133756,14960,97404,6138,41065,78041,32843,16601,34123,9559,146529,123377,96395,54441,42012,84257,123541,10745,22139,106459,11720,150883,172651,154996,110538,4728,53447,25704,2009,71152,119354,21166,66604,1429,216162,8637,122250,63520,27180,29172,36124,276428,107787,77184,4680,14952,104903,24418,14793,51561,52931,8371,26342,48526,7118,92066,67280,40653,8847,34597,105438,14198,50163,61188,146286,50315,41205,170829,161496,585,197359,95056,1687,365794,91349,48507,5804,49263,5146,104902,96365,117343,132222,46084,96919,16875,8073,262381,79982,52663,13928,16056,153908,15145,109256,132308,18763,24904,167644,13618,40750,18686,147124,114709,150038,52849,2938,12568,48617,8778,5459,44202,44591,74914,17183,248689,13878,7822,80060,23116,194037,18487,2067,7798,43077,33678,244028,31320,74273,2794,19466,8218,36280,183997,48124,19416,29656,19280,98734,7715,18311,30701,133602,150307,126956,7378,2933,79903,13178,12593,86571,26604,92446,13574,44205,65699,427599,21118,8245,14407,27877,47936,33542,7916,26460,117762,21596,37818,2249,127359,209394,60044,47677,308089,36791,154971,31417,6998,150042,174360,12255,43009,29335,48739,3912,101398,53340,2580,146939,151295,45360,125275,15273,45383,27456,48761,23314,8750,60801,85823,104759,27894,123685,66968,39480,26917,55290,83305,2696,98390,57569,145853,340733,4919,20024,52268,30884,7413,203685,70989,112855,4129,50536,349518,68205,332641,159581,135361,236026,37563,176404,64899,6578,122033,63871,1850,85234,82089,66124,74145,121098,107351,12687,36881,117334,13136,14698,85933,93866,18047,32620,310,15094,46e3,88451,23632,36645,27940,87618,80520,58892,20976,27702,140090,96075,67841,103292,238964,87778,107338,17019,83427,67522,7302,8261,47570,116787,8730,80484,61772,174422,56005,131193,52875,14588,28471,59817,9586,15720,158155,51307,109734,15196,11025,59331,3884,52626,102602,84797,25158,27314,4437,20488,76214,189248,35023,114952,157376,2827,62439,102878,129749,36405,10329,109339,108633,36662,1254,13267,5470,87105,58004,15397,10434,159667,21864,52022,179464,3013,32147,31496,116832,18494,105502,129227,107267,50033,13481,9954,24267,22141,16257,116154,36185,950,115685,11305,176708,2048,178671,112573,287867,162328,497663,95170,50979,193861,50987,30368,136257,31830,46549,15119,169876,23788,17462,249887,57377,1949,35448,14791,43769,210091,3783,34612,282103,88380,245190,5457,20491,98908,11402,86899,117916,16028,162584,60644,320177,156096,31065,55876,22e3,77655,9992,23397,13757,317623,63978,215255,2443,17648,93231,27388,104529,93807,55505,140477,12046,112040,70887,40152,94365,112353,25063,114679,266061,71248,119555,15589,2244,617,14129,211431,70110,100652,7777,4383,85911,89221,21010,120615,58357,86405,37554,41647,18,15143,69662,60491,14714,186134,148344,42347,5410,168175,44535,42449,343894,129417,99682,20659,27272,140483,63455,222159,17536,13722,42637,62324,11976,114691,148109,2283,32057,182393,4295,147364,33705,2075,44303,30274,28331,63740,69740,29148,10346,44862,33716,73937,153333,12930,38784,247159,2515,41053,20256,83368,256189,54639,115240,5096,24661,175419,153552,26516,141,138176,63885,34115,47222,55709,2765,28479,38875,236608,12229,22921,77291,54426,45388,2860,57787,114579,295139,105782,17826,71066,19119,54364,69385,16568,12323,28057,33346,34919,124763,155533,101386,31644,8627,49001,303600,29868,63213,9103,77280,71333,9696,138789,37059,24823,5057,21352,32368,114208,56803,19424,10445,58514,8661,209508,26187,171838,10460,63454,14016,122504,41328,21329,46618,32493,38225,7855,31763,7945,29876,8734,6438,24205,97490,139977,130740,47323,33195,85390,57194,13813,60600,21313,96251,7699,27584,170521,139271,1363,4402,336738,129223,84983,69150,13147,3590,163929,207225,155260,55916,20288,4503,8398,98490,11773,27512,37113,84976,86558,28365,11756,116005,182148,13733,115313,47644,67208,85069,9347,14995,226141,14704,101835,41159,35314,13113,63526,214039,29978,50446,83339,17440,129441,72522,118641,97816,24907,73844,15717,118884,167255,96509,162793,30847,36849,51297,78974,77793,10427,1873,2972,9999,35074,28190,64297,146836,46298,60038,163007,108919,61219,2403,75022,127339,4233,110389,69022,9833,128097,88016,79390,222936,22570,94657,28462,56956,38803,81536,30474,152794,19566,16481,147408,74574,81895,20731,1918,1366,76367,187321,54494,24366,21690,61696,33283,107477,77499,31112,414383,74362,18463,218441,120929,59848,258629,201924,69269,454,19989,13054,59894,3623,58908,20681,35723,78523,102680,38988,184112,108087,50944,132704,52966,21699,18860,96349,201411,82697,85395,95658,5093,6427,177894,44191,32755,26961,155739,6249,31310,81030,26574,84311,120155,86730,113535,7424,48888,13516,45747,98098,20077,183995,81945,43210,26704,40420,75831,45648,11180,6855,57927,65528,124096,34851,2598,156633,107572,127352,38169,123845,60142,62722,105584,232364,23211,68120,1601,22169,89299,747,258039,80572,7258,152249,11862,101204,8834,121434,33761,19175,133142,46343,40178,48723,3589,41977,30210,38868,62257,10087,82658,87827,90646,16415,47552,351723,28298,72225,91146,272760,1701,11295,1652,109651,300747,51863,198800,29446,11794,32345,37538,22356,33102,37590,113544,37970,11478,179743,25454,103417,59905,221970,105196,145604,7817,164809,102360,16974,75840,255333,56902,6659,1954,645,59400,67769,7689,18675,5215,13793,20536,27852,3387,29523,259718,16860,94625,43143,29245,15848,233581,22685,63631,78557,22836,133302,84513,1348,51826,47129,98836,58284,1830,1749,94642,10933,6145,12506,10975,13879,103781,144434,10268,28409,32346,52968,121567,107374,77268,23686,35097,10501,155275,15303,47136,21102,168741,55332,90385,15996,84817,681,137803,25054,142275,6163,38175,8056,124296,240642,65621,4934,178205,16101,62803,60964,18230,100622,76465,44689,14545,9543,47514,16852,93380,28048,12047,107106,37575,101485,77047,57326,34819,96137,76916,6469,46264,115983,75768,87668,69942,13027,165,8373,114231,26434,52844,42799,182044,23580,146254,38081,43236,33883,146220,382894,14606,46035,36481,166621,35417,95382,2957,59384,60428,36358,66343,75378,22267,22950,83528,17577,56474,25285,4619,179691,75355,95836,53295,34588,171410,4487,14679,84208,44015,18562,109133,54101,11531,86052,174479,303157,28095,9953,35642,14564,39802,16145,77606,117406,53038,121117,53624,22062,1212,7632,127157,237292,189087,10478,127345,102515,181997,86752,87623,10966,121602,68783,68681,83042,114380,138349,191305,67176,50085,39016,1427,42384,1412,67118,122616,72389,25260,2237,13576,137346,19938,20304,2191,68759,5373,61364,238507,75814,23931,69565,38993,131741,38364,12528,87762,5679,129853,5310,186831,32653,90338,260176,389531,108118,26843,43985,50175,30563,25106,56965,18130,140428,4542,165503,117991,24219,229605,1819,129663,1240,3797,76093,18398,71339,51919,93043,27175,47060,216257,6483,35051,1217,16512,80798,129064,13225,69339,8548,237079,72298,2575,34280,51379,117910,55671,53345,247552,29486,39328,140821,34681,57045,60177,5004,90269,78522,2479,322607,48474,61296,13057,31558,4678,59271,6699,27044,31988,35944,12503,83480,4389,136508,3781,114121,70279,4488,155829,42214,2898,68191,75695,305850,45041,74344,106509,30087,17429,93292,12477,290,23080,114802,35714,18751,26554,105424,17775,2144,2412,100610,65192,113975,52975,180272,135050,129815,76238,106483,21440,63186,4260,46189,9711,28249,4169,23429,23390,8324,141585,63809,67668,38457,38063,39226,59972,1189,203916,62368,14403,16949,61767,85801,1739,40147,35049,76757,33124,62102,15780,103593,103009,53484,22952,67973,114645,6566,5245,50462,7601,8288,3513,194571,80276,1908,54592,5124,58571,2513,6800,273997,193904,1119,17991,117245,2508,129156,82366,26278,71465,63341,56943,39662,106116,94966,156875,9736,2204,122308,94418,27134,1280,24539,49022,45314,3764,50904,46424,30699,28087,293839,9400,33646,40165,822,147499,50263,116179,29085,11863,31314,5578,17797,5104,12454,1604,15342,219206,10232,67800,94261,25872,13565,90339,78971,75377,26649,41184,47695,11514,35369,20767,14227,41953,309396,148270,147938,33074,14453,27499,109019,39018,25738,240196,158931,52820,8612,95853,21524,137010,84901,70869,70021,116794,48404,38771,6732,1070,70990,187297,49140,5238,576,3564,253975,16027,16483,2811,37775,19034,25259,4053,2e3,70083,95774,19713,33431,92703,91314,42381,288770,48194,95985,3991,77418,13406,241328,245086,56533,35275,62725,9246,51924,70181,95331,16163,31410,79016,39312,120878,119371,275987,80124,27712,9186,220,23598,146167,85209,68238,282190,57048,31273,30555,80913,17594,75779,59160,135002,101219,189377,29225,96735,60126,62522,104e3,27620,86814,17240,147533,11001,5425,43682,410,49460,87270,69480,46315,59448,1816,76201,9431,11788,87960,29063,65539,47347,11678,33846,7008,196704,9895,6753,8633,120892,59970,572824,115934,6646,202559,892,48351,37611,251282,57823,67263,57750,26527,34485,90747,7685,88370,6144,64182,1709,41969,21458,62327,181657,49247,225330,122600,114574,107124,85361,111833,63243,71420,15655,191178,72430,18063,51425,54002,12364,53225,86557,18193,97580,41232,138398,67821,128724,8944,233212,101353,52099,42127,14006,120107,32789,32132,3498,18123,33758,56058,5779,128760,59888,98869,18445,84702,51911,13234,218379,20093,39031,8074,70195,20708,23462,24355,131384,60189,26390,10403,41060,7140,10781,49410,42261,87202,82566,41663,43105,60276,2768,5733,74176,28329,2297,145430,131632,83615,122915,105441,655,224102,5284,136426,67763,16294,188511,32538,61049,27893,3394,13951,159099,28542,17930,145360,9492,190122,32285,78855,26440,13570,58648,73908,4239,124561,2444,74172,53131,11468,10794,73566,11623,35343,64710,30481,4163,10328,38309,29901,10538,154377,76132,92405,24839,11679,3465,13449,11637,7824,2337,57754,1260,14458,41118,19878,38661,13416,159180,37074,163164,54137,28627,52134,184900,8520,40385,29546,30502,22386,66527,107458,6850,24022,47983,30603,35083,8934,304066,39500,9,28261,33026,77251,9374,44833,116312,34990,29236,63563,125639,135405,165398,159055,55690,88141,69643,236964,31983,25572,20436,36746,60896,31850,16179,11828,5888,3043,66368,9750,31167,7915,53111,36430,1333,64344,93659,20061,60596,180191,51630,6792,30244,43509,101058,22409,420,44210,109783,43223,27030,72477,72831,32679,29235,7675,47556,12258,39907,149412,84926,118247,24692,71717,105038,86009,45941,41189,89453,29856,52543,30627,226798,67303,59230,67415,34408,1367,99685,16867,128419,52147,4111,125381,117881,16173,44093,102224,31575,23234,24870,83790,127407,239098,3200,994,1255,100903,242275,117266,55116,38205,16140,29662,11307,40414,208793,123355,56470,4862,75600,30119,58218,70828,24075,26974,7802,192353,4851,5475,78720,66596,3409,28573,64396,30381,30690,59859,88256,5406,99945,103064,34463,37727,24238,86643,60088,4057,23741,5967,162904,38240,28356,93858,25510,122879,6897,3278,7057,11971,4400,35461,211413,21395,59615,39471,87233,55795,128426,3051,22470,41950,14705,3974,180108,80476,78442,204996,91987,15634,67610,139015,142373,35611,51134,10387,4353,153456,57749,181039,14183,68447,151532,21107,36452,20551,3186,46247,46383,129666,88736,140662,146243,2066,8360,7978,64818,106963,17896,47801,10723,114821,223295,74192,3293,3393,16987,74064,11277,91622,4270,29828,27951,387869,103235,1374,61988,120083,477,145892,128378,11779,211263,61354,18221,17869,46530,83061,108538,157981,90608,67199,95080,49064,195814,12302,66307,10348,231346,160732,112859,63633,146558,21271,31037,198802,47622,12862,95710,3910,77850,73961,85585,34752,61e3,4082,24595,103679,71107,8208,79568,150019,16615,24961,139857,32664,197366,4559,54735,32696,4126,162019,75698,13916,70108,159638,19834,9349,24675,175560,49643,18206,52459,27992,10809,88865,401975,133172,29e3,34558,30915,3658,25834,42430,36562,125265,18182,10155,40149,97082,208980,19575,60853,90529,66545,9600,789,46420,2317,88593,55595,98980,115302,5742,169155,1073,177901,3472,11189,63711,78643,65472,50459,127979,93,42202,67053,21720,157650,11145,141378,42033,22824,85705,79114,35584,15974,1510,54172,28562,12451,104226,19190,97151,73024,20948,5151,81741,21499,29006,84183,198074,54003,45120,170125,26240,35177,28389,64863,79974,60778,176915,232183,45342,2038,80253,41564,40703,32689,5430,100689,5366,23007,134279,14266,26712,73993,24934,64242,52113,102887,61801,46415,201049,54251,62133,122757,164883,30815,139966,2319,30842,766,13362,10287,134518,86111,81665,82440,28333,43019,18963,8804,161944,23439,102144,101145,80029,39052,248708,30350,117340,11878,128467,974,138625,63961,5237,74778,61834,67040,43814,13690,65947,33809,232476,115258,181745,28824,94013,9510,10246,93722,81976,7217,114383,3493,16014,69045,72692,12145,80981,9507,6692,1620,60820,330444,35474,33962,4797,7053,295463,46445,27026,12491,77988,49524,35675,90947,29114,166705,101385,133782,32704,6186,84595,176031,185623,45966,151302,63069,1699,107491,947,15458,74452,196212,6046,10498,12163,10239,35191,243951,9277,9090,29539,54460,22820,26514,112549,60372,51753,48756,21812,70861,260326,41,44222,10441,16961,48148,138771,216194,5914,52153,53400,212036,56519,26245,10117,45888,15294,138019,90913,26368,43842,42111,23348,6082,194845,161089,156206,51546,11647,30759,302912,262094,8635,78876,26535,35283,54183,31183,85484,147873,12989,5197,6356,72894,65347,20150,27370,73787,1493,45918,12366,190217,20724,13858,10981,67449,81213,7553,14115,72242,271517,11842,48310,88743,143726,22177,3290,243231,58452,62937,12592,1654,40066,33477,13751,9921,128442,15868,7106,75236,83773,10775,36938,10482,170465,17368,17469,161508,32752,98340,800,19824,264456,3901,87319,2867,26782,9630,113102,185815,24197,44584,86366,40224,3636,140916,31731,267731,9567,53678,72984,29389,27963,17106,50282,284911,60170,8322,12608,23374,89652,5268,39044,229766,8869,151350,31436,177342,12269,183212,120418,116270,2843,78888,69192,7865,184099,1086,129897,18383,70508,20242,18508,229924,124569,35749,50589,55626,9884,83115,40971,30671,18135,14452,38861,17844,201826,5549,26413,17189,13561,38539,10679,143331,3314,36785,171194,49685,187713,67506,4618,104039,17060,195080,50648,33159,19238,67559,134840,28599,157523,17130,38064,117398,94355,31918,13575,34538,40326,13997,3494,348283,62481,26862,3603,104426,244363,153709,112487,304612,199674,41239,35545,54869,293005,28223,26277,26899,4533,18518,15492,38587,80488,70485,160395,263,60162,11382,222152,4696,250751,51921,182609,10707,48463,46243,1227,49111,111564,46502,33342,56846,68541,63559,858,139927,16654,229375,76759,26478,33205,95828,23399,92945,2637,35630,28470,143992,50214,14174,21456,166191,65665,1711,21594,78019,97599,111701,36,147151,110246,189022,43021,30397,40757,131935,42065,73335,48039,26596,28984,15102,2361,7421,202167,69744,43766,52826,3642,83304,33873,75140,63169,192389,36551,92748,13039,123959,233220,21738,84447,77230,20228,187852,19095,25799,92136,108774,29237,53947,2299,118106,2687,8830,42331,202924,33667,2023,73763,30704,19363,19779,16737,35629,48081,24068,101013,162338,291912,13749,24745,328289,167679,70086,48299,23306,16732,17801,43322,54589,3586,63653,43624,53474,925,109177,251316,43805,13082,19511,86565,142182,92461,17117,101033,103319,64589,4022,4351,235897,5352,82705,107142,46391,156084,5860,61365,10558,13045,7717,18357,33922,12590,33065,6928,46993,783,46937,67846,8952,26295,6107,119656,18799,17458,50747,4229,179559,112727,118080,20683,41464,125468,51560,49749,44231,7359,35339,62988,136487,67015,5208,29150,24956,105186,48858,6143,18097,6972,16404,73489,58742,97196,36357,164616,5834,32267,13746,147733,15113,132091,34127,106298,39729,106426,22294,9780,15602,36213,71502,42808,66802,599,60755,5851,39120,67363,108623,126368,72770,91263,32486,30596,151717,7951,52002,43103,11768,68942,40901,39344,24037,127500,116890,48403,16926,86750,17745,48648,159545,34460,58419,5634,114317,67865,31462,23352,24010,98185,125708,69686,68337,13610,26271,70691,2980,4768,27225,102402,75453,28106,8104,6931,1176,6274,6475,112635,22498,6176,238686,26832,28893,90319,14441,15682,15087,39517,45270,109134,104440,45965,47645,81772,7876,52683,87720,12898,4505,185665,2769,113401,15664,57592,105229,137381,97059,119268,6876,43309,33886,128363,35476,144249,67013,143587,83367,25703,91436,59347,53236,2289,16519,19844,46309,58558,99834,23313,218816,231303,36388,51333,183535,109792,139277,54306,90139,18235,8275,32710,37677,82464,86025,92204,88842,117723,37570,128723,234242,76350,73795,34896,148247,58424,11105,11744,45746,63372,17118,49772,199520,81902,38004,22911,33752,3125,1995,53792,4689,26909,108150,146062,69674,41811,161444,84855,8999,28561,16731,93937,3189,21967,24890,22943,1356,145300,51569,28802,517,118679,31703,40607,48098,108854,25003,10233,73969,177495,5248,24516,215347,146192,48712,60626,69188,40735,5866,586,101541,6509,47590,52129,5969,222045,110933,25733,24223,65339,62812,2414,155418,35819,16022,78423,43138,20995,128255,240673,46745,236093,72176,57085,97841,61248,107,36068,193177,105427,55726,215229,20446,47228,100420,87091,14429,121708,23605,21157,187721,21880,2997,203976,99166,95068,25877,7724,98925,83401,4829,13182,18229,13718,239662,38653,116505,153497,30589,89029,38962,181302,43853,78872,180301,4786,248240,7401,106136,112590,77745,19731,60880,77789,125748,135487,5975,48627,34084,12419,215770,47557,254582,10364,106495,21856,67539,88981,38805,21428,48732,42316,12149,16078,52808,25327,51322,33850,51147,12253,122354,46077,56483,254553,115417,81834,150991,94662,86668,7381,12841,100650,18218,15741,22372,68294,50705,15535,84660,61887,22553,72299,31361,24824,17743,46820,64288,31582,77006,111674,116384,30760,80920,86149,77192,51979,79691,60342,122805,103800,240873,160744,233114,78962,54920,8608,3484,316104,72548,24337,5088,230040,21926,10172,36838,26,86221,83458,102176,12062,17571,41929,41170,28428,68239,41750,103930,2634,18313,53019,34825,97837,63115,24606,73157,152474,14715,91439,37033,109806,140259,30668,174760,380,135597,95673,136073,65073,134249,13829,17279,122305,4420,46444,10237,64848,203623,70728,10349,182885,65075,24519,25783,40318,34139,22222,63394,55266,102764,41422,20126,65100,90408,53640,35128,48932,11192,38935,96839,34782,39492,19396,41332,6250,5511,19492,51304,25936,104466,54099,73771,86115,5080,7669,30891,111700,13931,25276,72289,135447,14820,258641,25265,31005,281179,75286,393,95359,14623,13584,6680,101227,80173,44933,76666,54542,13244,39348,458,25379,109451,134348,81143,6959,65554,12027,51311,8716,57589,140731,28467,23316,17272,30458,25980,55229,77197,83798,28302,114784,7428,34548,26241,14712,39336,103304,18928,54080,12870,334,87722,15208,16895,142098,114262,39820,83913,57817,28682,7721,14900,108672,11250,62246,42849,415188,1724,26555,24549,25505,26443,107450,145899,61035,43528,6901,60726,65906,267741,21338,147590,42079,18924,73017,135236,15393,5206,4026,84185,1531,5988,113890,82647,303391,7386,69844,71611,189865,76523,31877,13315,19314,198575,32821,1928,67641,25913,104475,103489,3297,70391,18406,15446,113347,19295,93790,27856,1792,167471,116449,8541,4408,41757,63233,25765,86680,64501,27034,24816,34975,6079,4486,49693,36229,16917,21581,62426,27862,11612,54284,35702,194034,355,24277,48262,87411,70504,310164,118018,12516,47559,43502,57433,107139,9290,66533,80863,14634,34312,91725,28606,21342,67241,72355,43244,375789,37402,174015,105070,8342,44167,67494,1890,16365,11723,271002,1865,47918,8350,45564,27742,25110,125803,8553,49504,81925,62211,4534,15491,19011,80373,206920,667,102405,128623,245524,5553,113309,192739,65766,19567,22832,261958,29679,21293,71134,20962,105123,24721,860,21752,33448,18372,157167,94822,35770,173224,232737,75729,28937,46828,28062,25453,5207,140366,36665,30652,6169,67920,150458,92040,23186,184604,92330,20891,176492,49427,27828,38305,42495,143982,49560,25503,90043,29747,65328,47830,12932,11068,77721,9003,25213,94205,140426,46090,89945,138173,192691,33329,112232,129905,35709,27514,1841,19957,31411,127476,53572,17497,173549,55063,175135,19841,69314,5192,237921,117660,150697,4060,273045,50414,98940,65348,153665,164423,58804,156695,48994,213928,86036,28608,8355,39574,34540,16927,135680,18374,151587,10830,53805,16878,16623,4282,48030,8537,14986,46102,13062,72897,72,33050,108227,39451,45935,651,113320,40535,95176,57450,48843,5003,19019,10407,211163,3848,1068,4988,32091,30095,41692,15099,43602,107434,50744,7627,171349,16313,150832,352665,207750,33937,38256,51091,156e3,87889,90663,84175,24908,114900,50365,31494,83829,5398,169342,47521,54818,18935,8356,43094,41212,174536,10082,92550,6678,60614,23355,69721,14796,34149,128830,58187,3179,208,40325,28399,225029,401412,51150,31580,207268,6657,10993,69818,64282,289845,23308,12961,38447,6681,52944,31855,2572,47646,120728,179148,37240,45196,218274,4816,3695,21961,50084,35209,18073,51452,27004,6100,33941,1377,84831,171214,85,141510,9078,99227,32610,6417,11718,49868,65579,87902,73018,49062,46280,61742,21512,40862,107733,15941,29168,157765,144919,14487,5767,158014,140070,7241,573,71584,16921,223566,40331,179473,35081,47926,140885,41508,52104,59180,42310,32811,29048,123517,102413,80208,10104,14746,12649,153641,126022,37965,113017,4171,83,142592,2809,6362,50416,71323,116894,260776,16204,1524,5760,30351,12658,20703,54403,36083,45408,74772,4946,14485,50759,111222,10890,2195,167147,92962,130534,16283,177256,35016,15472,210156,151187,73922,117691,43250,52051,37392,24811,24358,30830,5775,818,21969,1476,127322,151783,58392,31021,106913,65215,89407,90802,28531,11690,20234,95249,44602,37256,18707,11928,5161,4410,26571,51903,49768,22008,25252,65780,209499,68769,203726,13249,137363,48845,86823,6658,5674,31881,1083,1823,108676,34518,166752,13791,14287,91576,91429,8665,11529,26401,16191,91972,30964,5254,28486,54697,79613,66520,18447,22870,45203,194466,22822,51703,12278,76716,44595,73455,33546,12235,144843,36154,51247,11116,33040,3180,225753,60864,1972,28469,12891,28879,10338,144157,56294,353058,38302,41447,87532,110616,27065,168438,6557,1213,50804,144643,24817,2390,136531,38174,247513,16190,4059,122791,131994,137430,39506,57650,16305,5188,54309,106128,20628,88071,67394,395446,250285,66176,91254,1399,114196,43915,60230,44853,27206,106353,43013,18733,345105,226453,51202,16607,57106,117175,35492,10476,89598,127439,15187,39624,13688,61570,10615,31111,59370,6238,175252,32143,224492,41388,95408,34384,148238,78307,38959,9340,160091,61443,15737,11216,41244,170,38299,102443,113097,26382,14027,33707,3957,76300,66160,19431,18900,6952,1717,108656,82206,188021,257335,27295,43999,41210,31777,46956,57457,12657,11489,15697,48060,204748,53583,82422,284790,30503,137341,8120,19615,220311,15991,10217,63424,9808,67431,70976,98221,4491,15177,28535,144789,751,13230,2394,1504,33977,132104,30316,22230,931,97193,185240,24826,22687,174322,15307,22988,1390,188745,180325,29580,59068,74903,18994,29195,79,15436,7622,38462,11566,138710,44828,45774,37768,99236,68137,84083,19282,22698,17134,74807,126662,173497,46248,16938,119735,3212,28292,213652,49013,9975,32180,45660,86250,4801,68788,95490,77482,113751,11994,44624,94452,46839,128497,100316,5798,58588,73184,202987,65417,37790,88524,1606,43156,97964,105717,34947,11203,100060,37742,130074,93653,107799,94311,196106,41347,8035,10780,16390,27883,118236,167395,1979,25006,19375,31628,18916,144723,78502,114047,103107,86492,107686,5844,20934,206963,23556,22591,16562,146333,20167,10471,117434,33085,2863,9740,36669,41849,37271,22790,18209,28979,8231,12952,54408,21731,25130,45208,55748,138120,75826,414,29593,9925,292865,25999,683,123149,7036,92159,86055,61827,103680,23176,54918,58466,57578,13305,5709,86479,16697,31064,17660,200919,10770,49793,33423,32370,52047,16488,62555,6459,8426,83493,7763,59725,82812,18628,67760,79405,68557,9612,7673,28102,56517,69620,171797,32458,29541,15870,81109,32080,207644,71495,21202,11039,91036,61230,2810,130800,32260,4613,60590,37112,75214,33979,126402,155062,30642,63875,12810,194463,82799,47664,16725,36685,43367,61099,449,172150,102867,21691,301838,36745,7130,18671,57316,34852,38034,54182,35578,65900,99486,19771,3456,2658,16914,99866,28390,28109,8262,21147,34353,20006,4228,137085,1675,203023,283196,198286,214375,163329,290603,152574,40471,83506,30068,14730,23177,131539,34759,27668,32178,71896,104799,116305,85430,119262,42860,25160,8911,23428,49437,105322,6519,16203,6349,74711,1230,38045,8540,75165,44736,25909,51026,317034,4984,32281,91312,27060,44431,17817,45363,155937,239085,35697,59784,91993,29531,126740,213757,76560,167776,285273,24262,8237,65030,41160,74437,48804,118916,13159,37842,1031,75349,1478,11655,108777,23435,277425,101734,67469,70231,124711,43532,28514,65526,54956,1e3,21882,17728,25302,40952,52214,149632,1999,2111,3259,63362,89961,220561,39777,26335,9063,10572,12416,34551,34623,38604,24723,5947,15588,69927,66252,119177,69173,46629,28714,70715,212408,20521,406913,74380,11716,50659,50862,37009,88460,130101,7210,53853,538,65120,151950,55806,163748,52837,13153,21100,16674,64536,6091,138201,44837,58547,3723,163,2177,32288,85454,34033,8497,14282,25742,10535,10741,79559,117493,243787,49337,100718,79495,40139,42956,7551,55433,15421,31509,23034,45081,547,61176,53434,328001,8470,36263,30145,4519,74173,53935,11845,73774,60211,78025,3,4102,73782,109293,315332,48412,26683,13714,6865,20128,18490,104141,325,39470,171970,115860,15707,7268,73301,74336,31370,2368,111827,107757,136231,142844,97138,96638,84053,38691,23801,1588,10573,122098,77039,240,186135,146101,11996,18143,112963,46171,155836,348769,47795,121213,116266,132515,3344,144804,31286,99187,255838,129694,35894,48779,55235,148582,71967,65282,15174,13920,47080,6147,108242,157593,125025,7136,1286,28957,127956,28402,98813,20805,7532,109417,40610,5041,32958,15142,18408,108596,33543,50517,27748,80114,233434,91447,487,37094,100048,30541,43477,10639,89862,155868,37667,8726,60684,237903,73408,99589,12190,38739,97348,3914,13594,2680,149016,13907,30171,28343,23530,115225,61104,35821,147679,14337,4297,244282,24085,326976,56428,7851,21303,131620,71446,83253,68692,111870,5224,15813,38197,49026,45057,13660,3306,76345,40671,27905,91072,996,68527,62085,91351,122634,55109,168209,2024,27560,112707,17352,8306,167115,169921,166958,5031,46020,11844,67284,19130,76185,6920,32849,5450,14610,22451,21002,17392,31872,66682,84796,13709,40210,59898,12029,8719,53564,21462,91884,21647,88379,194428,12754,37797,132826,160016,22567,54383,53186,77611,31107,8339,4694,19185,90355,23597,17222,140675,28442,23668,55977,9128,61555,28774,155229,17658,9390,24379,69357,15752,127381,239631,62460,93181,55913,45133,140155,18676,25249,33164,29581,82837,67223,22362,29975,7317,52813,1943,29613,20012,207130,49617,49651,5636,15334,36313,29226,28084,95247,72072,19e3,224932,15811,114,32127,38097,37508,88507,37225,27359,91626,12193,69279,20608,11055,88156,92808,2152,57259,55275,72789,24475,104414,1708,9882,3818,48661,66897,1631,34806,227930,85815,87753,18321,250664,72733,25107,206797,50891,8082,196411,92596,96764,152823,65514,22819,387277,62176,51225,40329,15563,189,3659,73670,64357,51793,275136,33482,86653,74615,67058,11318,125720,15388,22388,8267,1730,102663,170910,40784,7144,85373,13040,7088,94309,583,44224,140424,77439,18496,164026,36578,4722,9151,5824,63365,26510,35199,40500,79277,32495,44614,35233,9566,203293,152144,7097,2330,183480,98629,13423,330887,44130,68600,30939,97829,31012,345465,56747,94879,4939,160027,149761,99423,46099,32251,15332,8761,96094,128555,5763,235318,222223,55729,30241,55420,201746,3987,81382,8259,49325,23287,7719,24633,251100,92311,18591,110533,64759,170260,393860,7175,21144,132887,3593,75346,101277,91109,16387,259187,11627,57459,173829,44694,55780,49797,89192,120443,62622,3904,14814,23887,1027,112258,64955,99800,11132,66353,36202,48624,18158,88481,96882,43059,11040,2455,7077,21651,181159,99126,100434,61388,68186,19161,110468,120052,8819,55324,41494,7014,37689,3618,87729,92615,207943,9823,128657,12587,15857,6379,67628,51216,71775,157617,63244,1503,3864,218754,110864,5769,21492,7243,1192,87921,85529,31512,18537,42698,35350,73510,84474,34301,8991,21013,35034,566,38832,19838,35586,37216,39413,55006,12178,59742,856,84563,6900,25632,17437,49786,30723,13847,70845,4044,7843,23944,235976,55530,48942,6518,20939,73769,192653,52936,95207,23895,132542,142982,22632,87452,48042,54018,178468,10728,26230,23559,363,81269,142012,5718,346258,31456,84333,246476,51018,66692,101804,120570,39962,30373,70593,2864,60541,19425,54209,104092,7201,31545,48018,25865,15442,46257,40443,8328,6451,111782,47527,97754,33046,470,245116,31095,39,91934,87208,73470,36708,36521,12801,70624,36272,8892,79768,12427,55454,103756,5908,52390,62962,22720,141138,94634,41689,128402,126390,6628,106394,35527,134394,82727,254651,194502,148064,89549,3202,28359,957,21954,27906,49840,142747,8307,24206,48978,1186,71728,133038,71474,91306,6333,110959,74600,70387,18983,62609,56057,22970,1147,135850,1321,28834,3578,59715,102227,32827,81415,99952,55636,257598,390,22702,35701,85872,402916,39216,189795,14929,19467,10112,144422,61514,5279,63421,134686,41436,8424,51925,10598,132295,124416,4604,194739,210929,57866,31829,51626,50007,9976,91878,61906,56168,81906,60918,61859,40017,23059,16887,40927,62064,12785,32893,32913,21782,93965,20169,44387,79084,38463,11457,93950,27127,157050,2697,337088,5116,54128,48255,33279,8821,27352,25515,124022,65710,28906,38557,33390,1722,104435,72215,38551,12094,30978,25113,6671,37355,175109,42862,98024,65406,221276,59624,118012,64637,78760,86697,21426,1639,40350,12584,67193,84144,31396,7863,143011,69629,63112,9454,28666,65798,46372,134721,6314,51402,30837,151922,2847,38676,38008,92823,136245,17540,5504,109295,205242,37606,5211,214892,1586,20670,208711,137743,19328,40652,16995,20023,14657,154919,34422,12996,13918,38221,47690,16398,2959,37680,89122,6721,198469,91876,172043,83898,101992,26084,94570,3635,76958,22853,76497,38266,176590,168403,44464,142840,79180,184594,1984,41806,83147,11985,6546,366068,59732,24533,271505,8736,39084,222992,93429,28962,58985,86665,8432,30028,14548,32439,54424,165029,55175,27458,69046,121277,46168,33732,20661,24581,135574,123110,37556,79260,72611,16957,12939,46162,58238,44907,72936,253758,41324,32518,96480,11949,124438,65280,43256,34107,53533,43531,37037,28366,45970,32741,173438,6121,194202,62969,26355,30314,58370,28455,1848,50519,82830,90393,21761,295490,10936,256940,133568,44050,20269,4089,27457,21610,219460,36743,14821,101388,52005,13124,30979,140816,167362,26054,18458,60789,34917,40447,26606,33422,9066,3452,83614,5761,20263,137238,25038,91310,101,52322,74548,42572,38084,214054,186568,31802,17665,30620,141936,37730,14420,4265,187218,49640,188208,51441,55388,96452,66659,40869,42039,60967,221027,19234,178581,29105,96050,9165,196118,157335,3738,40354,117436,2965,34136,59659,15570,50843,230035,31444,71260,43886,18316,5387,38500,168508,17406,32174,8828,103373,143806,90367,3560,18719,122310,16508,26719,2541,105429,6645,37998,73190,10591,235916,49737,87112,233941,53188,32193,79154,4544,52905,126477,7580,63501,57314,3216,31337,6541,103083,60846,49,9756,15481,1355,43840,14319,13743,27486,10222,73114,230718,418644,16706,6674,279748,23058,45273,295831,86306,2743,5535,88773,21829,35253,120938,31153,3169,16839,42847,8751,80974,33942,36867,35514,16485,26474,77775,56877,5391,48346,3882,108713,31403,27804,55248,26235,43821,136104,40118,175507,28034,203908,18732,1788,34030,106427,36958,54359,7251,44936,15356,69139,455,157915,22173,140291,50348,43275,82066,49621,54952,15216,36226,96695,66855,6936,1987,8227,196087,4631,68827,99004,47541,110265,17953,147605,110242,58520,31312,38724,329975,642,3155,34497,75937,6207,73843,6120,17249,51429,117746,3218,910,68961,319671,14938,29555,34700,1649,66673,72268,9655,76800,153087,6941,210168,27130,35398,1780,73242,3135,56689,19556,165307,8765,35967,121458,13333,70453,17350,117253,22265,13340,44265,39869,441,3742,135025,23581,33309,16543,17731,13291,157637,283005,21408,101360,63887,52312,83873,5338,233779,23759,186949,34531,177320,38069,156465,91004,19353,59852,68160,14891,1338,1072,29823,1950,28901,81407,313445,73038,84807,162348,240257,37162,138934,16111,58013,41253,102951,16457,96056,19541,56402,67217,41638,94381,89674,29481,37456,80815,151579,13937,13683,132537,19699,134545,67020,29816,222341,141235,427578,48868,129557,233342,23077,87871,16213,18728,16184,9469,37913,19680,2798,171356,178328,13216,50049,72690,71904,124644,55455,7504,29052,41036,266546,19899,30391,188755,8659,59469,16,104298,112943,53865,76203,138226,68857,139953,14125,107625,119795,173133,4398,50273,48808,54390,16466,122086,31835,67035,50971,48859,7508,46427,66477,73021,84615,39985,83076,46779,201569,53336,36443,60865,168164,143810,51393,25548,169307,32896,24485,38424,21837,29087,275813,51674,6714,64883,46169,187369,55186,76192,12852,12018,62134,31067,118303,16542,12125,10579,4928,26291,43854,7091,10946,253716,109062,39283,17261,113012,258512,47764,125126,32646,55892,80279,201623,149872,3192,385,1208,48750,5376,58738,22335,5427,82416,47811,32435,143086,38930,94128,59975,156037,37977,38224,62485,7698,50405,71027,16462,21559,136153,34131,107506,162069,63703,3101,215029,40407,4178,3774,9187,80019,17880,97926,67579,2600,18405,8351,47924,86638,70820,92206,86453,29610,42241,119200,3198,15466,67813,57863,35454,4779,99518,4649,104641,144269,33730,38073,65864,6838,109456,193298,154007,5623,45741,30846,182578,25573,157224,1543,58575,138703,146140,44971,49356,18275,59064,20300,13122,11848,24453,11973,9797,86843,2919,25530,49210,1130,161220,76788,75373,85604,34926,36014,17777,17255,51533,11676,92226,51845,119859,21525,5936,18507,28050,1140,31418,14857,34207,47859,10750,36382,32079,106909,59426,87757,38393,110042,15965,97104,33757,35344,97993,53979,33651,45407,41884,82515,173089,7177,58371,35365,47543,51927,35587,10670,23544,29306,84233,39976,76076,62097,9007,8668,28119,78281,120790,19835,143020,54968,18670,64959,20649,34469,42570,33001,136570,87796,120044,1106,58700,63951,127623,12805,83057,40212,31773,49850,7361,54336,347524,101314,23751,19569,48791,29174,49369,20467,7465,75842,38281,623,112457,60210,28849,51003,94720,6426,90047,85560,43761,3579,85105,34607,90410,118528,7224,42907,111163,18168,6960,161135,191298,5247,100584,127552,171568,20121,91173,12636,54615,20199,63730,98105,2396,40387,14438,125012,4765,33235,12865,45299,37728,82098,77872,114037,59253,19675,24838,398016,102561,11446,17069,57508,178277,65836,99941,26114,2585,271882,136866,50126,11027,155648,118367,14585,8910,123015,335383,40434,41016,53021,14439,87098,176860,201543,121888,2358,9286,5739,22666,54270,37884,169381,33984,93859,16124,89364,72207,51639,76366,99029,65812,2198,12147,174891,194289,6986,30252,88822,21284,11445,288337,160821,33034,100869,43852,25761,52882,1144,103809,1924,84458,86079,43411,13542,139276,18141,34978,41298,7276,26481,173800,33210,17951,142652,33616,33677,2210,19941,98568,2486,192414,80136,12058,235883,50963,249638,29572,27221,47034,6124,72107,63346,97620,158513,299699,40388,23235,37176,224244,198386,121323,67992,23827,63170,17838,106622,158590,26807,5345,23489,91891,55474,74834,37981,13058,5977,72552,34706,26828,145172,19904,21367,34043,960,77092,91381,4733,47446,7680,41697,5170,16960,14741,46101,13656,473,51842,37433,11103,11551,121951,13191,97536,165932,50397,51628,129028,9069,44885,6590,59195,47045,32940,225472,90345,21833,13303,29407,96615,141951,5198,6028,18395,7181,3861,14966,156358,167182,36529,55253,25942,173153,30959,27261,50691,150176,162201,38467,48462,80602,42163,118482,168,108756,26011,17166,54149,456538,22512,91374,13816,90358,131615,18132,226707,1824,28139,26860,42253,93877,77351,65575,8980,80574,22020,27948,40422,91324,76376,13528,39281,91685,82215,122541,144066,1983,193851,17283,26320,2739,194978,4790,26845,42627,61300,65815,174612,55133,4200,191130,79771,158321,52280,166796,221620,62461,11278,4067,88152,83409,31717,121367,13522,47325,37945,10406,174348,249321,154101,64912,29938,51775,17220,15776,166138,78890,84425,54121,42861,16368,24572,291647,10197,32073,22651,11677,97509,26952,35787,18424,41910,71614,94977,72318,41594,70024,275419,37702,60199,7335,39107,61315,18271,18394,33768,87884,104277,123724,7277,56288,71981,189803,49320,3352,6798,14240,8954,69220,94433,57372,28620,68863,193727,85575,42309,41667,67689,42081,22543,44824,12719,28540,114236,101553,27638,27296,4300,5353,4663,19379,94098,3758,95888,95144,80344,87320,28447,259518,12718,71391,152731,37063,24132,31911,104896,15672,103782,1521,4945,72541,23717,122632,15619,87175,206120,29428,189780,61416,28350,44457,972,1175,47233,198738,95789,41907,21953,97034,59341,22864,53713,16873,32971,20693,20954,31336,21477,16169,38370,16412,9019,3841,24599,21938,17085,6484,81198,76413,5849,72514,12320,65247,276175,37234,59796,52642,16312,57349,198507,94148,46134,18958,125552,1747,18725,151873,14901,5490,68287,29470,3689,64794,40814,26018,25692,54450,2703,88278,124886,173087,174e3,24159,179477,24276,46004,201876,209202,445,52876,31948,30206,157610,39180,18439,44124,50469,5774,96278,222758,200216,50290,45486,20435,46986,46276,140133,142326,15569,13363,47522,92583,2182,7135,16853,22998,30272,4952,63263,35623,39096,53789,44864,20053,110392,124213,4630,16087,28221,127787,25839,77481,44693,13464,113146,6983,27069,55717,50102,4760,7107,26186,66507,59145,36032,104182,71328,29425,64317,50781,47465,94298,69706,74899,22754,120756,25108,93077,56834,73286,39928,16218,41699,176763,7555,70819,50083,26895,23315,26014,16773,123079,41712,5719,31516,90427,158540,85051,183128,40864,27505,55392,9058,45224,96857,30901,136622,96557,56304,120061,11501,151448,5773,89743,7769,86069,2935,18471,41628,10114,33660,110170,49479,26745,92846,33221,26731,18795,87076,8550,2100,29972,120289,3077,72490,33784,2630,208722,50861,63483,79029,6419,39467,14302,45286,64207,9686,67513,44170,1050,77246,59266,17055,53801,7150,11111,42432,4278,94579,362117,36175,42902,41933,39002,98489,22913,74161,84773,57036,17556,162288,74485,178760,93867,73635,128860,50362,261,67455,80001,46080,35662,4368,25247,19230,74393,22588,1822,27682,235324,13798,85998,13194,235067,23514,71669,147632,23191,134748,214683,105101,1518,25489,247114,7380,54842,26922,3971,26361,20844,68642,170517,77339,123255,8963,77818,150998,48466,36806,2732,23261,11741,236162,18243,126216,28690,50546,16385,92760,197383,246558,201295,88255,67588,71687,176076,172653,169058,33906,63747,24835,157621,43338,30050,46152,132741,2770,51371,94835,6614,15112,11749,56936,1250,19027,399017,58036,100215,23388,55815,308768,124152,94803,9521,64186,8971,28,30427,62163,7616,103838,35079,29203,131235,7743,17389,10882,37420,61460,228512,85363,41581,131077,62822,119647,10130,54445,26925,19968,29016,24446,74028,24176,61448,67185,9254,8563,119129,9771,99184,37716,39514,10532,221512,258753,218630,55980,23394,32141,61924,66749,32411,3741,36475,26678,77010,44946,91203,128749,116953,20476,49625,53116,13735,102335,29376,51946,83407,67892,59212,34685,21083,1546,112982,32972,74397,1078,190545,16082,86140,58591,89611,101531,10061,105104,76319,20035,17551,52611,169061,190842,100780,23907,90413,115619,9675,34710,193435,49443,129734,11183,258877,16318,136182,126808,44635,27304,192375,2599,125648,47051,12091,23814,721,58800,40137,66726,97930,60877,74487,7942,54326,9841,41428,13762,8211,85383,6950,99177,79806,201786,296464,124087,13144,29741,41721,47634,55088,254286,106408,17041,99064,12942,64086,45233,14005,2612,55827,255,7984,13980,38574,12776,46654,73499,249951,2101,26676,25996,132326,116415,119062,50449,31033,23038,11589,179252,20007,14860,129270,21143,17796,144715,60106,70758,69842,34674,282133,44014,16774,57268,38528,24053,46373,201667,28327,471023,51889,102667,21193,114909,84132,69317,96723,67969,16134,68145,15058,28765,32035,2524,101089,98664,25045,76571,14957,86040,118506,262428,154764,81573,39681,283900,73287,127825,544,80448,52347,38512,175971,15180,45467,33086,46552,48894,81107,43213,36672,54025,76703,8053,7608,13299,56619,20752,238099,54164,105133,1444,32942,953,37564,8e3,66316,119463,106817,404,13667,149108,128597,31267,10269,49836,106150,1484,52330,76965,160486,171648,38456,31263,22424,37738,66245,67467,143369,60471,75610,20895,115528,86070,60854,40796,49347,18989,15030,11371,37578,15779,79867,10187,86462,46402,155626,93200,40229,7090,57547,108053,99598,11088,47505,41218,206017,2173,20988,30219,22919,80563,57566,42369,93141,41675,2407,182519,120495,27154,16702,29456,14349,7958,16688,117177,140375,42467,261919,74916,153569,10836,34742,49526,7621,105997,12212,2270,392377,7755,17959,25086,232152,138791,33847,13860,35316,5811,1344,71259,50452,207539,92635,50359,5821,33674,30255,2086,2587,96264,17543,42,6029,9580,43007,139248,82831,12917,29607,25786,51467,42137,85161,100698,31561,88989,121990,278500,3602,109344,37982,15279,116442,28936,30880,87894,58079,128661,126731,67392,28051,146885,4861,16216,97344,42827,147561,153948,22684,21335,47685,1853,43349,15185,59642,10229,25520,187921,108972,5579,98037,24945,6697,19193,63734,137934,75056,89740,19767,224268,56138,63643,151661,39313,70618,84031,89723,84074,13703,85626,35460,8867,64845,3439,57906,99776,63968,49270,81130,34356,16210,23547,36446,34090,140028,72439,2221,22163,57058,363492,113754,18913,95451,48663,54464,54037,176097,68425,3023,34906,29482,117389,341780,80431,58330,16753,92616,60907,94846,147486,4498,48646,7773,46801,7778,18946,464978,47558,33223,177444,7328,15626,63337,94700,11743,9351,255024,39098,16447,42647,96230,39769,58840,10068,63439,35800,65843,58823,413844,9156,51258,7434,61791,85018,6872,3692,28096,7121,33024,6009,75532,31997,192535,9661,3304,9547,14753,31987,25314,55689,15896,20430,39472,31340,99744,25398,115569,54883,28719,205423,23071,57855,64638,149867,25671,82403,37616,20668,39989,77996,74948,140555,175248,64810,36515,46595,4958,248773,24045,28728,136673,168704,20804,114833,100325,27135,21205,96151,153134,45992,7093,13992,76047,1980,19432,145001,75159,87462,17710,1013,45556,34297,144882,20648,26061,11319,129567,108555,18872,464580,33386,22717,65948,167189,5603,135042,79542,8801,202632,18114,91882,5973,5239,67315,4431,60916,47819,71693,32597,32606,18183,45072,80329,76385,24749,51305,40314,156514,14693,130345,13168,66214,18029,12858,34801,27628,14544,10823,40522,40185,33739,148694,23548,9923,61012,28859,17933,19442,34364,99849,164107,141167,30629,21054,6744,36491,8096,42474,41706,155060,30650,10600,163442,1143,96655,61390,52359,7559,51568,64256,203854,4467,22453,14504,436398,7878,6980,8293,63610,293747,16167,35763,19627,147603,15419,18032,110744,51346,33681,54571,40472,48615,39073,21604,13754,173027,92560,11083,47299,63062,11813,52007,29883,9734,139722,15953,1550,20651,13616,49306,16113,90089,92326,7584,30712,72424,164858,6831,152871,55746,197721,34167,196442,6022,112107,55215,7538,123381,4920,43539,77165,8939,50392,34192,20225,79762,22505,58667,40770,29788,97180,82835,4568,8579,13273,363569,35898,49983,436,36598,3237,131691,62418,35591,8101,4073,379438,65218,76072,33887,2968,27573,212619,288680,68278,72851,150504,217896,6913,121339,22017,35340,51072,43616,75043,31437,10833,81487,4364,22968,41454,106687,85446,19863,109625,149241,524,141850,214404,54376,657,237023,9401,108137,53800,32474,49712,53334,126876,27337,45552,177696,8269,15036,12097,42240,2328,125374,119295,99715,2500,19624,39441,27220,102691,60957,94543,39101,18566,67362,13975,78230,25017,34017,239007,90027,39351,41681,35354,43822,1043,916,58587,141983,94818,38799,75459,41114,67432,16195,36606,59568,22272,126769,31424,68659,12287,134302,257977,5756,207285,95637,47248,117689,19583,77451,22373,12200,54993,117118,34244,29386,34562,53819,71267,64172,77665,49368,7716,59301,25749,45426,194789,17297,2650,1766,32501,45198,20403,20984,6600,14171,94604,19037,5402,29896,9938,59935,109708,88081,145182,44844,39167,352626,164173,35374,45982,6122,154,73419,220487,53834,53601,17992,8609,229321,5610,68098,66815,71012,95069,140968,27396,8957,134489,24656,86659,56598,134852,17316,123838,255436,6613,41610,138033,81452,32023,32396,123687,63398,8693,29712,30407,19296,121188,3551,36099,20032,111948,56624,16547,27453,35916,15378,52039,56849,13489,22214,73177,53097,277349,2157,14029,187886,10260,141743,246460,91880,50869,3788,49486,133566,54950,33120,129337,53768,18333,9525,26902,312251,10297,9020,70759,16647,112432,59260,84609,9818,82766,73569,468,46001,75780,55028,52106,11498,43645,108069,17150,17753,29417,16705,31799,9606,289,122254,115975,8620,6133,255357,56908,14456,133464,43554,79224,11247,29630,160,12756,25464,65960,350428,62521,321796,100359,67358,35169,46172,113128,48988,88868,31094,33266,6847,60887,98188,49659,69117,92977,220228,13947,80181,35103,62170,97351,13475,2440,199768,19498,36597,46971,25234,67806,62881,84717,73648,181966,10488,94149,21550,26655,63436,48375,14405,165650,9621,24439,28043,42735,4490,29963,56674,45373,1934,262446,50855,67098,26898,5261,52696,40644,33900,9440,180286,87162,22940,19704,26936,69769,10254,101759,27406,12243,48e3,73926,113215,54935,5726,192787,4312,106216,9366,11550,52949,23457,212271,277152,133895,108374,6191,96477,29980,218916,58024,54696,40853,91124,65894,91170,65908,252552,6793,29212,15389,44516,122515,52617,35058,9017,103536,39510,49136,19242,130652,662077,74699,47024,31422,8517,73351,24399,13867,128360,4810,4434,61779,111983,61036,17798,110240,59722,102960,39688,10001,23803,23039,176498,56659,44814,134295,17188,77577,74466,226175,102472,154333,63900,111747,18062,41171,79669,32773,408933,42562,28931,30907,107388,43487,2946,240310,23938,24354,319,184983,7927,6488,1422,10790,68809,68209,64775,4361,202,17123,59634,51200,44391,18188,17843,2619,74278,3230,9540,47187,21702,36274,56894,43907,16310,34790,16866,6150,5561,13587,107545,108873,126867,86986,28640,33427,19017,5762,80637,17430,46903,2047,131055,25958,13558,5444,47152,13900,44563,122857,45348,70863,39593,54332,38068,33637,318,40310,143467,18502,24520,11377,62013,28942,27246,28269,83545,17999,59015,90707,30065,15161,34720,1263,37008,2012,6060,98575,92933,5721,299,199555,24578,29223,2985,743,115825,109523,136657,47454,26378,53586,3733,174945,93340,244456,5693,37386,28782,89767,27545,23573,18798,136425,34320,84778,20041,48453,38215,7477,71958,40621,8773,5874,187927,105965,51100,43533,18083,8443,10180,43597,2003,183999,69689,12216,129696,146188,62389,34044,68410,12765,43273,26949,266807,3345,34477,79197,5688,47539,213110,21634,22257,50092,32222,42346,39530,63668,98,134978,74022,5152,59088,174145,37220,9934,9545,118937,5724,87240,19875,15784,40143,23263,87513,181654,285152,37881,263241,4966,43934,10433,186657,6470,74416,225854,25908,142677,246262,32280,6192,75890,45546,143264,135305,29742,47013,77787,11732,126658,8763,37950,21806,57557,113464,89465,108995,164574,23894,22996,23169,15369,23117,17642,130607,40503,36239,280990,44666,9981,40427,147487,26869,168452,32886,32991,46798,240839,15111,70502,65697,88548,44145,28701,48767,31139,206777,35659,181164,166262,14554,171445,31786,66523,76607,17956,6507,31279,90476,116611,167918,6560,1243,115324,80128,41867,55897,187323,37069,32596,189444,145931,13390,105530,65709,26805,6999,55714,41300,22915,68951,22138,21120,22264,10058,19945,33635,56123,99085,10032,5818,6016,46649,57476,35264,94413,112522,262288,93686,83038,14341,23204,28807,66084,77987,6101,126673,7133,38126,5923,122091,170240,97772,46874,215746,43948,41622,3272,55596,8332,146411,251315,13533,8561,81521,115449,48616,175175,2063,186556,3036,134537,75772,29728,82360,22973,186559,86348,89100,38388,82297,45610,2613,87082,9986,177812,57884,23591,47485,42543,33582,44713,74439,257444,252451,31825,35631,38540,33066,5147,13973,4343,51830,70378,22827,26448,95560,36896,241741,48067,203953,298860,61620,20450,3220,67272,6586,107662,100160,108684,6929,57226,4762,7457,1320,40404,77204,99309,62750,208653,59977,44e3,74315,34332,5819,172217,64904,114077,18147,84012,1791,98456,90930,21446,116669,103938,7422,85140,59713,5768,326211,16239,75411,13229,29398,10758,236107,1539,112472,95979,152154,151294,306,21196,38146,10700,6891,84282,109646,56492,40539,6589,119491,51354,30685,140209,136906,29622,73617,49553,70525,51671,166869,139616,74395,37439,49595,45678,11959,33211,86560,52434,9282,62690,112155,130810,5243,108261,99970,265613,72551,80049,6391,33365,90721,66737,69872,87011,1860,9032,112544,60905,37371,89015,140351,19076,850,373531,2802,36725,218795,72062,28990,16550,24614,7815,6187,26336,33373,32162,42791,73555,32062,23386,10244,56392,49442,27076,136262,12412,14883,1134,33675,97153,199281,15608,100152,74072,47942,254301,36451,16026,10687,65067,56708,254030,30290,50490,13864,57941,259331,35588,23485,43486,24869,21620,92971,22072,88645,1048,182050,13343,32452,14825,19509,3325,216938,45740,99716,189082,53740,78245,25609,24311,176777,47340,308354,40669,66085,14102,125339,9225,128709,97207,1271,200933,78439,113451,88975,18324,46521,11819,18570,141756,72512,170020,52754,63550,118515,103073,93330,32736,50499,14722,31600,68452,398867,29316,172786,18417,104924,2606,5670,84818,16288,67106,59580,82929,607401,291,85829,359,15897,35830,50696,65630,52672,22115,356968,29895,40837,231192,34024,38957,26722,406,23335,124952,72068,68804,13268,147101,164740,276569,162596,66943,11569,26654,66358,4777,23229,102127,5848,978,2921,59666,5371,28212,90108,42938,39320,2499,4271,108792,33510,125072,71653,65239,38250,66357,38577,13964,86251,35708,50755,36010,29448,12209,3844,38222,206337,100876,67827,137088,14167,252225,84163,195270,1306,5703,54198,779,46802,22028,51124,86759,70560,113164,35685,162145,45471,34561,422,2611,6464,47486,19223,38246,9191,18331,89942,243642,212364,15893,17518,22617,6409,30046,126182,59716,36560,104428,18846,26592,19458,50793,147333,30826,1388,27647,10922,14495,33545,19269,135828,39727,41601,46931,233379,49169,131130,182112,16276,82381,118209,142445,128310,19672,28740,82907,33436,3118,102206,28723,24819,41937,38854,5157,3881,111491,1142,9776,421673,152241,29309,14961,87854,6054,15424,3796,82656,54996,2108,55367,239450,154525,9643,118103,106041,64601,68549,48707,30266,25772,18740,9462,229669,91798,112152,191327,14493,72828,8175,66636,236474,25817,87351,129027,76653,20422,22983,71240,27846,44661,12399,46158,77704,53101,35032,11072,17300,109294,33638,24408,1895,11241,760,17584,82479,125877,63150,141075,34259,23274,81698,15732,43577,48340,91584,14688,16379,24481,150280,96420,262050,48635,43727,61819,56268,72003,88178,17281,79912,13218,122519,125295,166396,11811,2171,118930,67746,17636,178278,174656,95661,173039,83845,79689,17473,98555,127696,203415,54730,22925,232239,9309,12136,175026,20740,180188,10747,39816,314017,266131,10040,175732,112550,220651,31974,37393,888,23008,86799,4303,64905,148467,75337,251,3284,370102,50264,9835,5438,23655,4481,29851,329,12855,7162,64931,78141,12804,42372,296771,83547,18624,34874,86271,3360,48665,77735,88767,11463,63527,28889,22258,29140,194315,113924,25499,6406,31334,1845,4802,49184,43455,35469,127594,92970,61038,115005,38840,87761,106838,8811,20572,55637,11162,96721,132425,108925,2948,125457,36356,3502,75270,27622,127192,2561,123095,49394,61155,16897,110064,9699,89448,53356,19628,220310,21622,83036,9885,112214,6087,26713,17901,161912,91492,3440,68594,9266,92238,8087,6866,150194,72175,80701,13459,31836,43243,239700,95846,44749,50647,21945,230538,120612,132371,244604,5193,105637,34661,41341,68775,85393,1874,8771,33718,49672,77403,595452,99507,6490,58895,128742,7704,39239,73217,43816,62824,37804,199976,22361,80005,87514,94832,14089,4574,139975,59142,75523,100268,43906,53442,15152,2547,186002,17011,19513,204282,3343,60568,128318,119250,4298,51871,41336,71759,21921,45074,98169,145889,99427,11350,1237,5520,28799,7803,53702,21026,136352,38293,128690,12158,90132,44600,10184,26957,39459,126025,78904,82999,59373,39301,150198,120529,153042,20177,50089,14764,271571,30530,123161,38975,101562,22941,5648,124654,109243,69817,71675,49162,106884,21241,107795,30258,16572,188262,141456,7688,60718,8271,11044,32440,104608,103419,236109,93156,43293,128929,42107,67180,25201,115254,185488,130954,72813,167547,20537,39969,38432,22582,184022,1139,27199,5655,17767,97412,122606,209377,27070,35871,326617,188954,42680,73512,80911,22629,3011,95021,315242,157737,383,41821,41808,19335,27950,15674,25677,110950,35375,76835,59108,57370,35262,16569,160415,37706,78086,32041,49691,137143,9782,172080,50148,77917,6323,10110,69172,17711,21795,59511,76184,135114,31046,132319,59105,157578,20549,80778,57649,158421,65143,4575,72235,21899,10797,92745,34035,106079,80159,4508,78304,25350,75457,46458,32937,25623,47,8531,104751,84953,8138,36508,187199,66310,115274,13253,32461,38536,1916,42007,187160,35055,26325,84394,35963,94216,45590,97782],MAX_COMMON_PREFIX_LENGTH=15;class RoutingTableRefresh{log;peerRouting;routingTable;refreshInterval;refreshQueryTimeout;commonPrefixLengthRefreshedAt;refreshTimeoutId;constructor(s,a){const{peerRouting:et,routingTable:tt,refreshInterval:rt,refreshQueryTimeout:nt,logPrefix:it}=a;this.log=s.logger.forComponent(`${it}:routing-table:refresh`),this.peerRouting=et,this.routingTable=tt,this.refreshInterval=rt??TABLE_REFRESH_INTERVAL,this.refreshQueryTimeout=nt??TABLE_REFRESH_QUERY_TIMEOUT,this.commonPrefixLengthRefreshedAt=[],this.refreshTable=this.refreshTable.bind(this)}async afterStart(){this.log(`refreshing routing table every ${this.refreshInterval}ms`),this.refreshTable(!0)}async stop(){this.refreshTimeoutId!=null&&clearTimeout(this.refreshTimeoutId)}refreshTable(s=!1){this.log("refreshing routing table");const a=this._maxCommonPrefix(),et=this._getTrackedCommonPrefixLengthsForRefresh(a);this.log(`max common prefix length ${a}`),this.log(`tracked CPLs [ ${et.map(tt=>tt.toISOString()).join(", ")} ]`),Promise.all(et.map(async(tt,rt)=>{try{if(await this._refreshCommonPrefixLength(rt,tt,s),this._numPeersForCpl(a)===0){const nt=Math.min(2*(rt+1),et.length-1);for(let it=rt+1;it<nt+1;it++)try{await this._refreshCommonPrefixLength(it,tt,s)}catch(st){this.log.error(st)}}}catch(nt){this.log.error(nt)}})).catch(tt=>{this.log.error(tt)}).then(()=>{this.refreshTimeoutId=setTimeout(this.refreshTable,this.refreshInterval),this.refreshTimeoutId.unref!=null&&this.refreshTimeoutId.unref()}).catch(tt=>{this.log.error(tt)})}async _refreshCommonPrefixLength(s,a,et){if(!et&&a.getTime()>Date.now()-this.refreshInterval){this.log("not running refresh for cpl %s as time since last refresh not above interval",s);return}const tt=await this._generateRandomPeerId(s);this.log("starting refreshing cpl %s with key %p (routing table size was %s)",s,tt,this.routingTable.size);const rt=AbortSignal.timeout(this.refreshQueryTimeout);setMaxListeners(1/0,rt);const nt=await length$2(this.peerRouting.getClosestPeers(tt.toBytes(),{signal:rt}));this.log(`found ${nt} peers that were close to imaginary peer %p`,tt),this.log("finished refreshing cpl %s with key %p (routing table size is now %s)",s,tt,this.routingTable.size)}_getTrackedCommonPrefixLengthsForRefresh(s){s>MAX_COMMON_PREFIX_LENGTH&&(s=MAX_COMMON_PREFIX_LENGTH);const a=[];for(let et=0;et<=s;et++)a[et]=this.commonPrefixLengthRefreshedAt[et]??new Date;return a}async _generateRandomPeerId(s){if(this.routingTable.kb==null)throw new Error("Routing table not started");const a=randomBytes(2),et=(a[1]<<8)+a[0],tt=await this._makePeerId(this.routingTable.kb.localPeer.kadId,et,s);return peerIdFromBytes(tt)}async _makePeerId(s,a,et){if(et>MAX_COMMON_PREFIX_LENGTH)throw new Error(`Cannot generate peer ID for common prefix length greater than ${MAX_COMMON_PREFIX_LENGTH}`);const nt=new DataView(s.buffer,s.byteOffset,s.byteLength).getUint16(0,!1)^32768>>et,it=65535<<16-(et+1),st=nt&it|a&~it,ot=GENERATED_PREFIXES[st],at=new ArrayBuffer(34),lt=new DataView(at,0,at.byteLength);return lt.setUint8(0,sha256$1.code),lt.setUint8(1,32),lt.setUint32(2,ot,!1),new Uint8Array(lt.buffer,lt.byteOffset,lt.byteLength)}_maxCommonPrefix(){let s=0;for(const a of this._prefixLengths())a>s&&(s=a);return s}_numPeersForCpl(s){let a=0;for(const et of this._prefixLengths())et===s&&a++;return a}*_prefixLengths(){if(this.routingTable.kb!=null)for(const{kadId:s}of this.routingTable.kb.toIterable()){const a=xor(this.routingTable.kb.localPeer.kadId,s);let et=0;for(const tt of a)if(tt===0)et++;else break;yield et}}}class AddProviderHandler{providers;log;constructor(s,a){this.log=s.logger.forComponent(`${a.logPrefix}:rpc:handlers:add-provider`),this.providers=a.providers}async handle(s,a){if(this.log("start"),a.key==null||a.key.length===0)throw new CodeError$3("Missing key","ERR_MISSING_KEY");let et;try{et=CID.decode(a.key)}catch{throw new CodeError$3("Invalid CID","ERR_INVALID_CID")}(a.providers==null||a.providers.length===0)&&this.log.error("no providers found in message"),await Promise.all(a.providers.map(async tt=>{if(!s.equals(tt.id)){this.log("invalid provider peer %p from %p",tt.id,s);return}if(tt.multiaddrs.length<1){this.log("no valid addresses for provider %p. Ignore",s);return}this.log("received provider %p for %s (addrs %s)",s,et,tt.multiaddrs.map(rt=>multiaddr(rt).toString())),await this.providers.addProvider(et,peerIdFromBytes(tt.id))}))}}class FindNodeHandler{peerRouting;peerInfoMapper;peerId;addressManager;log;constructor(s,a){const{peerRouting:et,logPrefix:tt}=a;this.log=s.logger.forComponent(`${tt}:rpc:handlers:find-node`),this.peerId=s.peerId,this.addressManager=s.addressManager,this.peerRouting=et,this.peerInfoMapper=a.peerInfoMapper}async handle(s,a){if(this.log("incoming request from %p for peers closer to %b",s,a.key),a.key==null)throw new CodeError$3("Invalid FIND_NODE message received - key was missing","ERR_INVALID_MESSAGE");const et=await this.peerRouting.getCloserPeersOffline(a.key,s);equals$4(this.peerId.toBytes(),a.key)&&et.push({id:this.peerId,multiaddrs:this.addressManager.getAddresses().map(rt=>rt.decapsulateCode(getProtocol("p2p").code))});const tt={type:MessageType.FIND_NODE,clusterLevel:a.clusterLevel,closer:et.map(this.peerInfoMapper).filter(({multiaddrs:rt})=>rt.length).map(rt=>({id:rt.id.toBytes(),multiaddrs:rt.multiaddrs.map(nt=>nt.bytes)})),providers:[]};return tt.closer.length===0&&this.log("could not find any peers closer to %b than %p",a.key,s),tt}}class GetProvidersHandler{peerRouting;providers;peerStore;peerInfoMapper;log;constructor(s,a){const{peerRouting:et,providers:tt,logPrefix:rt}=a;this.log=s.logger.forComponent(`${rt}:rpc:handlers:get-providers`),this.peerStore=s.peerStore,this.peerRouting=et,this.providers=tt,this.peerInfoMapper=a.peerInfoMapper}async handle(s,a){if(a.key==null)throw new CodeError$3("Invalid GET_PROVIDERS message received - key was missing","ERR_INVALID_MESSAGE");let et;try{et=CID.decode(a.key)}catch{throw new CodeError$3("Invalid CID","ERR_INVALID_CID")}this.log("%p asking for providers for %s",s,et);const[tt,rt]=await Promise.all([this.providers.getProviders(et),this.peerRouting.getCloserPeersOffline(a.key,s)]),nt=await this._getPeers(tt),it=await this._getPeers(rt.map(({id:ot})=>ot)),st={type:MessageType.GET_PROVIDERS,key:a.key,clusterLevel:a.clusterLevel,closer:it.map(this.peerInfoMapper).filter(({multiaddrs:ot})=>ot.length).map(ot=>({id:ot.id.toBytes(),multiaddrs:ot.multiaddrs.map(at=>at.bytes)})),providers:nt.map(this.peerInfoMapper).filter(({multiaddrs:ot})=>ot.length).map(ot=>({id:ot.id.toBytes(),multiaddrs:ot.multiaddrs.map(at=>at.bytes)}))};return this.log("got %s providers %s closerPeers",st.providers.length,st.closer.length),st}async _getAddresses(s){return[]}async _getPeers(s){const a=[];for(const et of s)try{const tt=await this.peerStore.get(et),rt=this.peerInfoMapper({id:et,multiaddrs:tt.addresses.map(({multiaddr:nt})=>nt)});rt.multiaddrs.length>0&&a.push(rt)}catch(tt){if(tt.code!=="ERR_NOT_FOUND")throw tt}return a}}class GetValueHandler{peerStore;datastore;peerRouting;log;constructor(s,a){this.log=s.logger.forComponent(`${a.logPrefix}:rpc:handlers:get-value`),this.peerStore=s.peerStore,this.datastore=s.datastore,this.peerRouting=a.peerRouting}async handle(s,a){const et=a.key;if(this.log("%p asked for key %b",s,et),et==null||et.length===0)throw new CodeError$3("Invalid key","ERR_INVALID_KEY");const tt={type:MessageType.GET_VALUE,key:et,clusterLevel:a.clusterLevel,closer:[],providers:[]};if(isPublicKeyKey(et)){this.log("is public key");const it=fromPublicKeyKey(et);let st;try{const ot=await this.peerStore.get(it);if(ot.id.publicKey==null)throw new CodeError$3("No public key found in key book","ERR_NOT_FOUND");st=ot.id.publicKey}catch(ot){if(ot.code!=="ERR_NOT_FOUND")throw ot}if(st!=null)return this.log("returning found public key"),tt.record=new Libp2pRecord(et,st,new Date).serialize(),tt}const[rt,nt]=await Promise.all([this._checkLocalDatastore(et),this.peerRouting.getCloserPeersOffline(et,s)]);return rt!=null&&(this.log("had record for %b in local datastore",et),tt.record=rt.serialize()),nt.length>0&&(this.log("had %s closer peers in routing table",nt.length),tt.closer=nt.map(it=>({id:it.id.toBytes(),multiaddrs:it.multiaddrs.map(st=>st.bytes)}))),tt}async _checkLocalDatastore(s){this.log("checkLocalDatastore looking for %b",s);const a=bufferToRecordKey(s);let et;try{et=await this.datastore.get(a)}catch(rt){if(rt.code==="ERR_NOT_FOUND")return;throw rt}const tt=Libp2pRecord.deserialize(et);if(tt==null)throw new CodeError$3("Invalid record","ERR_INVALID_RECORD");if(tt.timeReceived==null||Date.now()-tt.timeReceived.getTime()>MAX_RECORD_AGE){await this.datastore.delete(a);return}return tt}}class PingHandler{log;constructor(s,a){this.log=s.logger.forComponent(`${a.logPrefix}:rpc:handlers:ping`)}async handle(s,a){return this.log("ping from %p",s),a}}class PutValueHandler{components;validators;log;constructor(s,a){const{validators:et}=a;this.components=s,this.log=s.logger.forComponent(`${a.logPrefix}:rpc:handlers:put-value`),this.validators=et}async handle(s,a){const et=a.key;if(this.log("%p asked us to store value for key %b",s,et),a.record==null){const tt=`Empty record from: ${s.toString()}`;throw this.log.error(tt),new CodeError$3(tt,"ERR_EMPTY_RECORD")}try{const tt=Libp2pRecord.deserialize(a.record);await verifyRecord(this.validators,tt),tt.timeReceived=new Date;const rt=bufferToRecordKey(tt.key);await this.components.datastore.put(rt,tt.serialize().subarray()),this.log("put record for %b into datastore under key %k",et,rt)}catch(tt){this.log("did not put record for key %b into datastore %o",et,tt)}return a}}let RPC$1=class{handlers;routingTable;log;constructor(s,a){const{providers:et,peerRouting:tt,validators:rt,logPrefix:nt,peerInfoMapper:it}=a;this.log=s.logger.forComponent(`${nt}:rpc`),this.routingTable=a.routingTable,this.handlers={[MessageType.GET_VALUE.toString()]:new GetValueHandler(s,{peerRouting:tt,logPrefix:nt}),[MessageType.PUT_VALUE.toString()]:new PutValueHandler(s,{validators:rt,logPrefix:nt}),[MessageType.FIND_NODE.toString()]:new FindNodeHandler(s,{peerRouting:tt,logPrefix:nt,peerInfoMapper:it}),[MessageType.ADD_PROVIDER.toString()]:new AddProviderHandler(s,{providers:et,logPrefix:nt}),[MessageType.GET_PROVIDERS.toString()]:new GetProvidersHandler(s,{peerRouting:tt,providers:et,logPrefix:nt,peerInfoMapper:it}),[MessageType.PING.toString()]:new PingHandler(s,{logPrefix:nt})}}async handleMessage(s,a){try{await this.routingTable.add(s)}catch(tt){this.log.error("Failed to update the kbucket store",tt)}const et=this.handlers[a.type];if(et==null){this.log.error(`no handler found for message type: ${a.type}`);return}return et.handle(s,a)}onIncomingStream(s){Promise.resolve().then(async()=>{const{stream:a,connection:et}=s,tt=et.remotePeer;try{await this.routingTable.add(tt)}catch(nt){this.log.error(nt)}const rt=this;await pipe(a,nt=>decode$f(nt),async function*(nt){for await(const it of nt){const st=Message$2.decode(it);rt.log("incoming %s from %p",st.type,tt);const ot=await rt.handleMessage(tt,st);ot!=null&&(yield Message$2.encode(ot))}},nt=>encode$b(nt),a)}).catch(a=>{this.log.error(a)})}};class TopologyListener extends TypedEventEmitter{log;components;protocol;running;registrarId;constructor(s,a){super();const{protocol:et,logPrefix:tt}=a;this.components=s,this.log=s.logger.forComponent(`${tt}:topology-listener`),this.running=!1,this.protocol=et}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.registrarId=await this.components.registrar.register(this.protocol,{onConnect:s=>{this.log("observed peer %p with protocol %s",s,this.protocol),this.dispatchEvent(new CustomEvent$2("peer",{detail:s}))}}))}async stop(){this.running=!1,this.registrarId!=null&&(this.components.registrar.unregister(this.registrarId),this.registrarId=void 0)}}class DHTContentRouting{dht;constructor(s){this.dht=s}async provide(s,a={}){await drain(this.dht.provide(s,a))}async*findProviders(s,a={}){for await(const et of this.dht.findProviders(s,a))et.name==="PROVIDER"&&(yield*et.providers)}async put(s,a,et){await drain(this.dht.put(s,a,et))}async get(s,a){for await(const et of this.dht.get(s,a))if(et.name==="VALUE")return et.value;throw new CodeError$3("Not found","ERR_NOT_FOUND")}}class DHTPeerRouting{dht;constructor(s){this.dht=s}async findPeer(s,a={}){for await(const et of this.dht.findPeer(s,a))if(et.name==="FINAL_PEER")return et.peer;throw new CodeError$3("Not found","ERR_NOT_FOUND")}async*getClosestPeers(s,a={}){for await(const et of this.dht.getClosestPeers(s,a))et.name==="FINAL_PEER"&&(yield et.peer)}}const DEFAULT_MAX_INBOUND_STREAMS$1=32,DEFAULT_MAX_OUTBOUND_STREAMS$1=64;class KadDHT extends TypedEventEmitter{protocol;routingTable;providers;network;peerRouting;components;log;running;kBucketSize;clientMode;validators;selectors;queryManager;contentFetching;contentRouting;routingTableRefresh;rpc;topologyListener;querySelf;maxInboundStreams;maxOutboundStreams;dhtContentRouting;dhtPeerRouting;peerInfoMapper;constructor(s,a){super();const{kBucketSize:et,clientMode:tt,validators:rt,selectors:nt,querySelfInterval:it,protocol:st,logPrefix:ot,pingTimeout:at,pingConcurrency:lt,maxInboundStreams:ct,maxOutboundStreams:ht,providers:ft}=a,dt=ot??"libp2p:kad-dht";this.running=!1,this.components=s,this.log=s.logger.forComponent(dt),this.protocol=st??PROTOCOL$1,this.kBucketSize=et??20,this.clientMode=tt??!0,this.maxInboundStreams=ct??DEFAULT_MAX_INBOUND_STREAMS$1,this.maxOutboundStreams=ht??DEFAULT_MAX_OUTBOUND_STREAMS$1,this.peerInfoMapper=a.peerInfoMapper??removePrivateAddressesMapper,this.routingTable=new RoutingTable(s,{kBucketSize:et,pingTimeout:at,pingConcurrency:lt,protocol:this.protocol,logPrefix:dt}),this.providers=new Providers(s,ft??{}),this.validators={...validators,...rt},this.selectors={...selectors,...nt},this.network=new Network(s,{protocol:this.protocol,logPrefix:dt});const pt=pDefer();a.allowQueryWithZeroPeers===!0&&pt.resolve(),this.queryManager=new QueryManager(s,{disjointPaths:Math.ceil(this.kBucketSize/2),logPrefix:dt,initialQuerySelfHasRun:pt,routingTable:this.routingTable}),this.peerRouting=new PeerRouting(s,{routingTable:this.routingTable,network:this.network,validators:this.validators,queryManager:this.queryManager,logPrefix:dt}),this.contentFetching=new ContentFetching(s,{validators:this.validators,selectors:this.selectors,peerRouting:this.peerRouting,queryManager:this.queryManager,network:this.network,logPrefix:dt}),this.contentRouting=new ContentRouting(s,{network:this.network,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,providers:this.providers,logPrefix:dt}),this.routingTableRefresh=new RoutingTableRefresh(s,{peerRouting:this.peerRouting,routingTable:this.routingTable,logPrefix:dt}),this.rpc=new RPC$1(s,{routingTable:this.routingTable,providers:this.providers,peerRouting:this.peerRouting,validators:this.validators,logPrefix:dt,peerInfoMapper:this.peerInfoMapper}),this.topologyListener=new TopologyListener(s,{protocol:this.protocol,logPrefix:dt}),this.querySelf=new QuerySelf(s,{peerRouting:this.peerRouting,interval:it,initialInterval:a.initialQuerySelfInterval,logPrefix:dt,initialQuerySelfHasRun:pt,routingTable:this.routingTable}),this.network.addEventListener("peer",gt=>{const mt=gt.detail;this.onPeerConnect(mt).catch(yt=>{this.log.error("could not add %p to routing table",mt.id,yt)}),this.dispatchEvent(new CustomEvent$2("peer",{detail:mt}))}),this.topologyListener.addEventListener("peer",gt=>{const mt=gt.detail;Promise.resolve().then(async()=>{const yt=await this.components.peerStore.get(mt),vt={id:mt,multiaddrs:yt.addresses.map(({multiaddr:Et})=>Et),protocols:yt.protocols};await this.onPeerConnect(vt)}).catch(yt=>{this.log.error("could not add %p to routing table",mt,yt)})}),this.dhtPeerRouting=new DHTPeerRouting(this),this.dhtContentRouting=new DHTContentRouting(this),a.clientMode==null&&s.events.addEventListener("self:peer:update",gt=>{this.log("received update of self-peer info"),Promise.resolve().then(async()=>{const mt=gt.detail.peer.addresses.some(({multiaddr:vt})=>multiaddrIsPublic(vt)),yt=this.getMode();mt&&yt==="client"?await this.setMode("server"):yt==="server"&&!mt&&await this.setMode("client")}).catch(mt=>{this.log.error("error setting dht server mode",mt)})})}[Symbol.toStringTag]="@libp2p/kad-dht";[serviceCapabilities]=["@libp2p/content-routing","@libp2p/peer-routing","@libp2p/peer-discovery"];[serviceDependencies]=["@libp2p/identify"];get[contentRoutingSymbol](){return this.dhtContentRouting}get[peerRoutingSymbol](){return this.dhtPeerRouting}get[peerDiscoverySymbol](){return this}async onPeerConnect(s){if(this.log("peer %p connected",s.id),s=this.peerInfoMapper(s),s.multiaddrs.length===0){this.log("ignoring %p as there were no valid addresses in %s after filtering",s.id,s.multiaddrs.map(a=>a.toString()));return}try{await this.routingTable.add(s.id)}catch(a){this.log.error("could not add %p to routing table",s.id,a)}}isStarted(){return this.running}getMode(){return this.clientMode?"client":"server"}async setMode(s){await this.components.registrar.unhandle(this.protocol),s==="client"?(this.log("enabling client mode"),this.clientMode=!0):(this.log("enabling server mode"),this.clientMode=!1,await this.components.registrar.handle(this.protocol,this.rpc.onIncomingStream.bind(this.rpc),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))}async start(){this.running=!0,await this.setMode(this.clientMode?"client":"server"),await start(this.querySelf,this.providers,this.queryManager,this.network,this.routingTable,this.topologyListener,this.routingTableRefresh)}async stop(){this.running=!1,await stop(this.querySelf,this.providers,this.queryManager,this.network,this.routingTable,this.routingTableRefresh,this.topologyListener)}async*put(s,a,et={}){yield*this.contentFetching.put(s,a,et)}async*get(s,a={}){yield*this.contentFetching.get(s,a)}async*provide(s,a={}){yield*this.contentRouting.provide(s,this.components.addressManager.getAddresses(),a)}async*findProviders(s,a={}){yield*this.contentRouting.findProviders(s,a)}async*findPeer(s,a={}){yield*this.peerRouting.findPeer(s,a)}async*getClosestPeers(s,a={}){yield*this.peerRouting.getClosestPeers(s,a)}async refreshRoutingTable(){this.routingTableRefresh.refreshTable(!0)}}var EventTypes;(function(o){o[o.SEND_QUERY=0]="SEND_QUERY",o[o.PEER_RESPONSE=1]="PEER_RESPONSE",o[o.FINAL_PEER=2]="FINAL_PEER",o[o.QUERY_ERROR=3]="QUERY_ERROR",o[o.PROVIDER=4]="PROVIDER",o[o.VALUE=5]="VALUE",o[o.ADD_PEER=6]="ADD_PEER",o[o.DIAL_PEER=7]="DIAL_PEER"})(EventTypes||(EventTypes={}));function kadDHT(o){return s=>new KadDHT(s,o)}var isPlainObj=o=>{if(Object.prototype.toString.call(o)!=="[object Object]")return!1;const s=Object.getPrototypeOf(o);return s===null||s===Object.prototype};const isOptionObject=isPlainObj,{hasOwnProperty}=Object.prototype,{propertyIsEnumerable}=Object,defineProperty$1=(o,s,a)=>Object.defineProperty(o,s,{value:a,writable:!0,enumerable:!0,configurable:!0}),globalThis$1=commonjsGlobal,defaultMergeOptions={concatArrays:!1,ignoreUndefined:!1},getEnumerableOwnPropertyKeys=o=>{const s=[];for(const a in o)hasOwnProperty.call(o,a)&&s.push(a);if(Object.getOwnPropertySymbols){const a=Object.getOwnPropertySymbols(o);for(const et of a)propertyIsEnumerable.call(o,et)&&s.push(et)}return s};function clone(o){return Array.isArray(o)?cloneArray(o):isOptionObject(o)?cloneOptionObject(o):o}function cloneArray(o){const s=o.slice(0,0);return getEnumerableOwnPropertyKeys(o).forEach(a=>{defineProperty$1(s,a,clone(o[a]))}),s}function cloneOptionObject(o){const s=Object.getPrototypeOf(o)===null?Object.create(null):{};return getEnumerableOwnPropertyKeys(o).forEach(a=>{defineProperty$1(s,a,clone(o[a]))}),s}const mergeKeys=(o,s,a,et)=>(a.forEach(tt=>{typeof s[tt]>"u"&&et.ignoreUndefined||(tt in o&&o[tt]!==Object.getPrototypeOf(o)?defineProperty$1(o,tt,merge$1(o[tt],s[tt],et)):defineProperty$1(o,tt,clone(s[tt])))}),o),concatArrays=(o,s,a)=>{let et=o.slice(0,0),tt=0;return[o,s].forEach(rt=>{const nt=[];for(let it=0;it<rt.length;it++)hasOwnProperty.call(rt,it)&&(nt.push(String(it)),rt===o?defineProperty$1(et,tt++,rt[it]):defineProperty$1(et,tt++,clone(rt[it])));et=mergeKeys(et,rt,getEnumerableOwnPropertyKeys(rt).filter(it=>!nt.includes(it)),a)}),et};function merge$1(o,s,a){return a.concatArrays&&Array.isArray(o)&&Array.isArray(s)?concatArrays(o,s,a):!isOptionObject(s)||!isOptionObject(o)?clone(s):mergeKeys(o,s,getEnumerableOwnPropertyKeys(s),a)}var mergeOptions$8=function(...o){const s=merge$1(clone(defaultMergeOptions),this!==globalThis$1&&this||{},defaultMergeOptions);let a={_:{}};for(const et of o)if(et!==void 0){if(!isOptionObject(et))throw new TypeError("`"+et+"` is not an Option Object");a=merge$1(a,{_:et},s)}return a._};const mergeOptions$9=getDefaultExportFromCjs$2(mergeOptions$8);function isHighSurrogate$1(o){return o>=55296&&o<=56319}function isLowSurrogate$1(o){return o>=56320&&o<=57343}var truncate$2=function(s,a,et){if(typeof a!="string")throw new Error("Input must be string");for(var tt=a.length,rt=0,nt,it,st=0;st<tt;st+=1){if(nt=a.charCodeAt(st),it=a[st],isHighSurrogate$1(nt)&&isLowSurrogate$1(a.charCodeAt(st+1))&&(st+=1,it+=a[st]),rt+=s(it),rt===et)return a.slice(0,st+1);if(rt>et)return a.slice(0,st-it.length+1)}return a};function isHighSurrogate(o){return o>=55296&&o<=56319}function isLowSurrogate(o){return o>=56320&&o<=57343}var browser$3=function(s){if(typeof s!="string")throw new Error("Input must be string");for(var a=s.length,et=0,tt=null,rt=null,nt=0;nt<a;nt++)tt=s.charCodeAt(nt),isLowSurrogate(tt)?rt!=null&&isHighSurrogate(rt)?et+=1:et+=3:tt<=127?et+=1:tt>=128&&tt<=2047?et+=2:tt>=2048&&tt<=65535&&(et+=3),rt=tt;return et},truncate$1=truncate$2,getLength=browser$3,browser$2=truncate$1.bind(null,getLength),truncate=browser$2,illegalRe=/[\/\?<>\\:\*\|"]/g,controlRe=/[\x00-\x1f\x80-\x9f]/g,reservedRe=/^\.+$/,windowsReservedRe=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,windowsTrailingRe=/[\. ]+$/;function sanitize(o,s){if(typeof o!="string")throw new Error("Input must be string");var a=o.replace(illegalRe,s).replace(controlRe,s).replace(reservedRe,s).replace(windowsReservedRe,s).replace(windowsTrailingRe,s);return truncate(a,255)}var sanitizeFilename=function(o,s){var a=s&&s.replacement||"",et=sanitize(o,a);return a===""?et:sanitize(et,"")};const sanitize$1=getDefaultExportFromCjs$2(sanitizeFilename);function allocUnsafe$a(o=0){return new Uint8Array(o)}function createCodec$a(o,s,a,et){return{name:o,prefix:s,encoder:{name:o,prefix:s,encode:a},decoder:{decode:et}}}const string$a=createCodec$a("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),ascii$a=createCodec$a("ascii","a",o=>{let s="a";for(let a=0;a<o.length;a++)s+=String.fromCharCode(o[a]);return s},o=>{o=o.substring(1);const s=allocUnsafe$a(o.length);for(let a=0;a<o.length;a++)s[a]=o.charCodeAt(a);return s}),BASES$a={utf8:string$a,"utf-8":string$a,hex:bases.base16,latin1:ascii$a,ascii:ascii$a,binary:ascii$a,...bases};function fromString$c(o,s="utf8"){const a=BASES$a[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.decoder.decode(`${a.prefix}${o}`)}function toString$4(o,s="utf8"){const a=BASES$a[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.encoder.encode(o).substring(1)}var codes$5;(function(o){o.ERR_INVALID_PARAMETERS="ERR_INVALID_PARAMETERS",o.ERR_INVALID_KEY_NAME="ERR_INVALID_KEY_NAME",o.ERR_INVALID_KEY_TYPE="ERR_INVALID_KEY_TYPE",o.ERR_KEY_ALREADY_EXISTS="ERR_KEY_ALREADY_EXISTS",o.ERR_INVALID_KEY_SIZE="ERR_INVALID_KEY_SIZE",o.ERR_KEY_NOT_FOUND="ERR_KEY_NOT_FOUND",o.ERR_OLD_KEY_NAME_INVALID="ERR_OLD_KEY_NAME_INVALID",o.ERR_NEW_KEY_NAME_INVALID="ERR_NEW_KEY_NAME_INVALID",o.ERR_PASSWORD_REQUIRED="ERR_PASSWORD_REQUIRED",o.ERR_PEM_REQUIRED="ERR_PEM_REQUIRED",o.ERR_CANNOT_READ_KEY="ERR_CANNOT_READ_KEY",o.ERR_MISSING_PRIVATE_KEY="ERR_MISSING_PRIVATE_KEY",o.ERR_INVALID_OLD_PASS_TYPE="ERR_INVALID_OLD_PASS_TYPE",o.ERR_INVALID_NEW_PASS_TYPE="ERR_INVALID_NEW_PASS_TYPE",o.ERR_INVALID_PASS_LENGTH="ERR_INVALID_PASS_LENGTH"})(codes$5||(codes$5={}));const keyPrefix="/pkcs8/",infoPrefix="/info/",privates=new WeakMap,NIST={minKeyLength:112/8,minSaltLength:128/8,minIterationCount:1e3},defaultOptions$c={dek:{keyLength:512/8,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function validateKeyName(o){return o==null||typeof o!="string"?!1:o===sanitize$1(o.trim())&&o.length>0}async function randomDelay(){const a=Math.random()*800+200;await new Promise(et=>setTimeout(et,a))}function DsName(o){return new Key(keyPrefix+o)}function DsInfoName(o){return new Key(infoPrefix+o)}class DefaultKeychain{components;init;log;constructor(s,a){if(this.components=s,this.log=s.logger.forComponent("libp2p:keychain"),this.init=mergeOptions$9(defaultOptions$c,a),this.init.pass!=null&&this.init.pass?.length<20)throw new Error("pass must be least 20 characters");if(this.init.dek?.keyLength!=null&&this.init.dek.keyLength<NIST.minKeyLength)throw new Error(`dek.keyLength must be least ${NIST.minKeyLength} bytes`);if(this.init.dek?.salt?.length!=null&&this.init.dek.salt.length<NIST.minSaltLength)throw new Error(`dek.saltLength must be least ${NIST.minSaltLength} bytes`);if(this.init.dek?.iterationCount!=null&&this.init.dek.iterationCount<NIST.minIterationCount)throw new Error(`dek.iterationCount must be least ${NIST.minIterationCount}`);const et=this.init.pass!=null&&this.init.dek?.salt!=null?pbkdf2(this.init.pass,this.init.dek?.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";privates.set(this,{dek:et})}[Symbol.toStringTag]="@libp2p/keychain";[serviceCapabilities]=["@libp2p/keychain"];static generateOptions(){const s=Object.assign({},defaultOptions$c),a=Math.ceil(NIST.minSaltLength/3)*3;return s.dek.salt=toString$4(randomBytes(a),"base64"),s}static get options(){return defaultOptions$c}async createKey(s,a,et=2048){if(!validateKeyName(s)||s==="self")throw await randomDelay(),new CodeError$3("Invalid key name",codes$5.ERR_INVALID_KEY_NAME);if(typeof a!="string")throw await randomDelay(),new CodeError$3("Invalid key type",codes$5.ERR_INVALID_KEY_TYPE);const tt=DsName(s);if(await this.components.datastore.has(tt))throw await randomDelay(),new CodeError$3("Key name already exists",codes$5.ERR_KEY_ALREADY_EXISTS);switch(a.toLowerCase()){case"rsa":if(!Number.isSafeInteger(et)||et<2048)throw await randomDelay(),new CodeError$3("Invalid RSA key size",codes$5.ERR_INVALID_KEY_SIZE);break}let nt;try{const it=await generateKeyPair(a,et),st=await it.id(),ot=privates.get(this);if(ot==null)throw new CodeError$3("dek missing",codes$5.ERR_INVALID_PARAMETERS);const at=ot.dek,lt=await it.export(at);nt={name:s,id:st};const ct=this.components.datastore.batch();ct.put(tt,fromString$c(lt)),ct.put(DsInfoName(s),fromString$c(JSON.stringify(nt))),await ct.commit()}catch(it){throw await randomDelay(),it}return nt}async listKeys(){const s={prefix:infoPrefix},a=[];for await(const et of this.components.datastore.query(s))a.push(JSON.parse(toString$4(et.value)));return a}async findKeyById(s){try{const et=(await this.listKeys()).find(tt=>tt.id===s);if(et==null)throw new CodeError$3(`Key with id '${s}' does not exist.`,codes$5.ERR_KEY_NOT_FOUND);return et}catch(a){throw await randomDelay(),a}}async findKeyByName(s){if(!validateKeyName(s))throw await randomDelay(),new CodeError$3(`Invalid key name '${s}'`,codes$5.ERR_INVALID_KEY_NAME);const a=DsInfoName(s);try{const et=await this.components.datastore.get(a);return JSON.parse(toString$4(et))}catch(et){throw await randomDelay(),this.log.error(et),new CodeError$3(`Key '${s}' does not exist.`,codes$5.ERR_KEY_NOT_FOUND)}}async removeKey(s){if(!validateKeyName(s)||s==="self")throw await randomDelay(),new CodeError$3(`Invalid key name '${s}'`,codes$5.ERR_INVALID_KEY_NAME);const a=DsName(s),et=await this.findKeyByName(s),tt=this.components.datastore.batch();return tt.delete(a),tt.delete(DsInfoName(s)),await tt.commit(),et}async renameKey(s,a){if(!validateKeyName(s)||s==="self")throw await randomDelay(),new CodeError$3(`Invalid old key name '${s}'`,codes$5.ERR_OLD_KEY_NAME_INVALID);if(!validateKeyName(a)||a==="self")throw await randomDelay(),new CodeError$3(`Invalid new key name '${a}'`,codes$5.ERR_NEW_KEY_NAME_INVALID);const et=DsName(s),tt=DsName(a),rt=DsInfoName(s),nt=DsInfoName(a);if(await this.components.datastore.has(tt))throw await randomDelay(),new CodeError$3(`Key '${a}' already exists`,codes$5.ERR_KEY_ALREADY_EXISTS);try{const st=await this.components.datastore.get(et),ot=await this.components.datastore.get(rt),at=JSON.parse(toString$4(ot));at.name=a;const lt=this.components.datastore.batch();return lt.put(tt,st),lt.put(nt,fromString$c(JSON.stringify(at))),lt.delete(et),lt.delete(rt),await lt.commit(),at}catch(st){throw await randomDelay(),st}}async exportKey(s,a){if(!validateKeyName(s))throw await randomDelay(),new CodeError$3(`Invalid key name '${s}'`,codes$5.ERR_INVALID_KEY_NAME);if(a==null)throw await randomDelay(),new CodeError$3("Password is required",codes$5.ERR_PASSWORD_REQUIRED);const et=DsName(s);try{const tt=await this.components.datastore.get(et),rt=toString$4(tt),nt=privates.get(this);if(nt==null)throw new CodeError$3("dek missing",codes$5.ERR_INVALID_PARAMETERS);const it=nt.dek;return await(await importKey(rt,it)).export(a)}catch(tt){throw await randomDelay(),tt}}async exportPeerId(s){const a="temporary-password",et=await this.exportKey(s,a),tt=await importKey(et,a);return peerIdFromKeys(tt.public.bytes,tt.bytes)}async importKey(s,a,et){if(!validateKeyName(s)||s==="self")throw await randomDelay(),new CodeError$3(`Invalid key name '${s}'`,codes$5.ERR_INVALID_KEY_NAME);if(a==null)throw await randomDelay(),new CodeError$3("PEM encoded key is required",codes$5.ERR_PEM_REQUIRED);const tt=DsName(s);if(await this.components.datastore.has(tt))throw await randomDelay(),new CodeError$3(`Key '${s}' already exists`,codes$5.ERR_KEY_ALREADY_EXISTS);let nt;try{nt=await importKey(a,et)}catch{throw await randomDelay(),new CodeError$3("Cannot read the key, most likely the password is wrong",codes$5.ERR_CANNOT_READ_KEY)}let it;try{it=await nt.id();const at=privates.get(this);if(at==null)throw new CodeError$3("dek missing",codes$5.ERR_INVALID_PARAMETERS);const lt=at.dek;a=await nt.export(lt)}catch(at){throw await randomDelay(),at}const st={name:s,id:it},ot=this.components.datastore.batch();return ot.put(tt,fromString$c(a)),ot.put(DsInfoName(s),fromString$c(JSON.stringify(st))),await ot.commit(),st}async importPeer(s,a){try{if(!validateKeyName(s))throw new CodeError$3(`Invalid key name '${s}'`,codes$5.ERR_INVALID_KEY_NAME);if(a==null)throw new CodeError$3("PeerId is required",codes$5.ERR_MISSING_PRIVATE_KEY);if(a.privateKey==null)throw new CodeError$3("PeerId.privKey is required",codes$5.ERR_MISSING_PRIVATE_KEY);const et=await unmarshalPrivateKey(a.privateKey),tt=DsName(s);if(await this.components.datastore.has(tt))throw await randomDelay(),new CodeError$3(`Key '${s}' already exists`,codes$5.ERR_KEY_ALREADY_EXISTS);const nt=privates.get(this);if(nt==null)throw new CodeError$3("dek missing",codes$5.ERR_INVALID_PARAMETERS);const it=nt.dek,st=await et.export(it),ot={name:s,id:a.toString()},at=this.components.datastore.batch();return at.put(tt,fromString$c(st)),at.put(DsInfoName(s),fromString$c(JSON.stringify(ot))),await at.commit(),ot}catch(et){throw await randomDelay(),et}}async getPrivateKey(s){if(!validateKeyName(s))throw await randomDelay(),new CodeError$3(`Invalid key name '${s}'`,codes$5.ERR_INVALID_KEY_NAME);try{const a=DsName(s),et=await this.components.datastore.get(a);return toString$4(et)}catch(a){throw await randomDelay(),this.log.error(a),new CodeError$3(`Key '${s}' does not exist.`,codes$5.ERR_KEY_NOT_FOUND)}}async rotateKeychainPass(s,a){if(typeof s!="string")throw await randomDelay(),new CodeError$3(`Invalid old pass type '${typeof s}'`,codes$5.ERR_INVALID_OLD_PASS_TYPE);if(typeof a!="string")throw await randomDelay(),new CodeError$3(`Invalid new pass type '${typeof a}'`,codes$5.ERR_INVALID_NEW_PASS_TYPE);if(a.length<20)throw await randomDelay(),new CodeError$3(`Invalid pass length ${a.length}`,codes$5.ERR_INVALID_PASS_LENGTH);this.log("recreating keychain");const et=privates.get(this);if(et==null)throw new CodeError$3("dek missing",codes$5.ERR_INVALID_PARAMETERS);const tt=et.dek;this.init.pass=a;const rt=a!=null&&this.init.dek?.salt!=null?pbkdf2(a,this.init.dek.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";privates.set(this,{dek:rt});const nt=await this.listKeys();for(const it of nt){const st=await this.components.datastore.get(DsName(it.name)),ot=toString$4(st),at=await importKey(ot,tt),lt=rt.toString(),ct=await at.export(lt),ht=this.components.datastore.batch(),ft={name:it.name,id:it.id};ht.put(DsName(it.name),fromString$c(ct)),ht.put(DsInfoName(it.name),fromString$c(JSON.stringify(ft))),await ht.commit()}this.log("keychain reconstructed")}}function keychain(o={}){return s=>new DefaultKeychain(s,o)}class RateLimiter{memoryStorage;points;duration;blockDuration;execEvenly;execEvenlyMinDelayMs;keyPrefix;constructor(s={}){this.points=s.points??4,this.duration=s.duration??1,this.blockDuration=s.blockDuration??0,this.execEvenly=s.execEvenly??!1,this.execEvenlyMinDelayMs=s.execEvenlyMinDelayMs??this.duration*1e3/this.points,this.keyPrefix=s.keyPrefix??"rlflx",this.memoryStorage=new MemoryStorage}async consume(s,a=1,et={}){const tt=this.getKey(s),rt=this._getKeySecDuration(et);let nt=this.memoryStorage.incrby(tt,a,rt);if(nt.remainingPoints=Math.max(this.points-nt.consumedPoints,0),nt.consumedPoints>this.points)throw this.blockDuration>0&&nt.consumedPoints<=this.points+a&&(nt=this.memoryStorage.set(tt,nt.consumedPoints,this.blockDuration)),new CodeError$3("Rate limit exceeded","ERR_RATE_LIMIT_EXCEEDED",nt);if(this.execEvenly&&nt.msBeforeNext>0&&!nt.isFirstInDuration){let it=Math.ceil(nt.msBeforeNext/(nt.remainingPoints+2));it<this.execEvenlyMinDelayMs&&(it=nt.consumedPoints*this.execEvenlyMinDelayMs),await delay(it)}return nt}penalty(s,a=1,et={}){const tt=this.getKey(s),rt=this._getKeySecDuration(et),nt=this.memoryStorage.incrby(tt,a,rt);return nt.remainingPoints=Math.max(this.points-nt.consumedPoints,0),nt}reward(s,a=1,et={}){const tt=this.getKey(s),rt=this._getKeySecDuration(et),nt=this.memoryStorage.incrby(tt,-a,rt);return nt.remainingPoints=Math.max(this.points-nt.consumedPoints,0),nt}block(s,a){const et=a*1e3,tt=this.points+1;return this.memoryStorage.set(this.getKey(s),tt,a),{remainingPoints:0,msBeforeNext:et===0?-1:et,consumedPoints:tt,isFirstInDuration:!1}}set(s,a,et=0){const tt=(et>=0?et:this.duration)*1e3;return this.memoryStorage.set(this.getKey(s),a,et),{remainingPoints:0,msBeforeNext:tt===0?-1:tt,consumedPoints:a,isFirstInDuration:!1}}get(s){const a=this.memoryStorage.get(this.getKey(s));return a!=null&&(a.remainingPoints=Math.max(this.points-a.consumedPoints,0)),a}delete(s){this.memoryStorage.delete(this.getKey(s))}_getKeySecDuration(s){return s?.customDuration!=null&&s.customDuration>=0?s.customDuration:this.duration}getKey(s){return this.keyPrefix.length>0?`${this.keyPrefix}:${s}`:s}parseKey(s){return s.substring(this.keyPrefix.length)}}class MemoryStorage{storage;constructor(){this.storage=new Map}incrby(s,a,et){const tt=this.storage.get(s);if(tt!=null){const rt=tt.expiresAt!=null?tt.expiresAt.getTime()-new Date().getTime():-1;return tt.expiresAt==null||rt>0?(tt.value+=a,{remainingPoints:0,msBeforeNext:rt,consumedPoints:tt.value,isFirstInDuration:!1}):this.set(s,a,et)}return this.set(s,a,et)}set(s,a,et){const tt=et*1e3,rt=this.storage.get(s);rt!=null&&clearTimeout(rt.timeoutId);const nt={value:a,expiresAt:tt>0?new Date(Date.now()+tt):void 0};return this.storage.set(s,nt),tt>0&&(nt.timeoutId=setTimeout(()=>{this.storage.delete(s)},tt),nt.timeoutId.unref!=null&&nt.timeoutId.unref()),{remainingPoints:0,msBeforeNext:tt===0?-1:tt,consumedPoints:nt.value,isFirstInDuration:!0}}get(s){const a=this.storage.get(s);if(a!=null)return{remainingPoints:0,msBeforeNext:a.expiresAt!=null?a.expiresAt.getTime()-new Date().getTime():-1,consumedPoints:a.value,isFirstInDuration:!1}}delete(s){const a=this.storage.get(s);return a!=null?(a.timeoutId!=null&&clearTimeout(a.timeoutId),this.storage.delete(s),!0):!1}}function allocUnsafe$9(o=0){return new Uint8Array(o)}function createCodec$9(o,s,a,et){return{name:o,prefix:s,encoder:{name:o,prefix:s,encode:a},decoder:{decode:et}}}const string$9=createCodec$9("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),ascii$9=createCodec$9("ascii","a",o=>{let s="a";for(let a=0;a<o.length;a++)s+=String.fromCharCode(o[a]);return s},o=>{o=o.substring(1);const s=allocUnsafe$9(o.length);for(let a=0;a<o.length;a++)s[a]=o.charCodeAt(a);return s}),BASES$9={utf8:string$9,"utf-8":string$9,hex:bases.base16,latin1:ascii$9,ascii:ascii$9,binary:ascii$9,...bases};function fromString$b(o,s="utf8"){const a=BASES$9[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.decoder.decode(`${a.prefix}${o}`)}function toString$3(o,s="utf8"){const a=BASES$9[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.encoder.encode(o).substring(1)}var MessageTypes;(function(o){o[o.NEW_STREAM=0]="NEW_STREAM",o[o.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",o[o.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",o[o.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",o[o.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",o[o.RESET_RECEIVER=5]="RESET_RECEIVER",o[o.RESET_INITIATOR=6]="RESET_INITIATOR"})(MessageTypes||(MessageTypes={}));const MessageTypeNames=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),InitiatorMessageTypes=Object.freeze({NEW_STREAM:MessageTypes.NEW_STREAM,MESSAGE:MessageTypes.MESSAGE_INITIATOR,CLOSE:MessageTypes.CLOSE_INITIATOR,RESET:MessageTypes.RESET_INITIATOR}),ReceiverMessageTypes=Object.freeze({MESSAGE:MessageTypes.MESSAGE_RECEIVER,CLOSE:MessageTypes.CLOSE_RECEIVER,RESET:MessageTypes.RESET_RECEIVER}),MAX_MSG_SIZE=1<<20,MAX_MSG_QUEUE_SIZE=4<<20;class Decoder{_buffer;_headerInfo;_maxMessageSize;_maxUnprocessedMessageQueueSize;constructor(s=MAX_MSG_SIZE,a=MAX_MSG_QUEUE_SIZE){this._buffer=new Uint8ArrayList,this._headerInfo=null,this._maxMessageSize=s,this._maxUnprocessedMessageQueueSize=a}write(s){if(s==null||s.length===0)return[];if(this._buffer.append(s),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw Object.assign(new Error("unprocessed message queue size too large!"),{code:"ERR_MSG_QUEUE_TOO_BIG"});const a=[];for(;this._buffer.length!==0;){if(this._headerInfo==null)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(ot){if(ot.code==="ERR_MSG_TOO_BIG")throw ot;break}const{id:et,type:tt,length:rt,offset:nt}=this._headerInfo;if(this._buffer.length-nt<rt)break;const st={id:et,type:tt};(tt===MessageTypes.NEW_STREAM||tt===MessageTypes.MESSAGE_INITIATOR||tt===MessageTypes.MESSAGE_RECEIVER)&&(st.data=this._buffer.sublist(nt,nt+rt)),a.push(st),this._buffer.consume(nt+rt),this._headerInfo=null}return a}_decodeHeader(s){const{value:a,offset:et}=readVarInt(s),{value:tt,offset:rt}=readVarInt(s,et),nt=a&7;if(MessageTypeNames[nt]==null)throw new Error(`Invalid type received: ${nt}`);if(tt>this._maxMessageSize)throw Object.assign(new Error("message size too large!"),{code:"ERR_MSG_TOO_BIG"});return{id:a>>3,type:nt,offset:et+rt,length:tt}}}const MSB$2=128,REST$2=127;function readVarInt(o,s=0){let a=0,et=0,tt=s,rt;const nt=o.length;do{if(tt>=nt||et>49)throw s=0,new RangeError("Could not decode varint");rt=o.get(tt++),a+=et<28?(rt&REST$2)<<et:(rt&REST$2)*Math.pow(2,et),et+=7}while(rt>=MSB$2);return s=tt-s,{value:a,offset:s}}const POOL_SIZE=10*1024;class Encoder{_pool;_poolOffset;constructor(){this._pool=allocUnsafe$9(POOL_SIZE),this._poolOffset=0}write(s,a){const et=this._pool;let tt=this._poolOffset;encode$c(s.id<<3|s.type,et,tt),tt+=encodingLength$1(s.id<<3|s.type),(s.type===MessageTypes.NEW_STREAM||s.type===MessageTypes.MESSAGE_INITIATOR||s.type===MessageTypes.MESSAGE_RECEIVER)&&s.data!=null?(encode$c(s.data.length,et,tt),tt+=encodingLength$1(s.data.length)):(encode$c(0,et,tt),tt+=encodingLength$1(0));const rt=et.subarray(this._poolOffset,tt);POOL_SIZE-tt<100?(this._pool=allocUnsafe$9(POOL_SIZE),this._poolOffset=0):this._poolOffset=tt,a.append(rt),(s.type===MessageTypes.NEW_STREAM||s.type===MessageTypes.MESSAGE_INITIATOR||s.type===MessageTypes.MESSAGE_RECEIVER)&&s.data!=null&&a.append(s.data)}}const encoder=new Encoder;async function*encode$3(o){for await(const s of o){const a=new Uint8ArrayList;encoder.write(s,a),yield a}}class MplexStream extends AbstractStream{name;streamId;send;types;maxDataSize;constructor(s){super(s),this.types=s.direction==="outbound"?InitiatorMessageTypes:ReceiverMessageTypes,this.send=s.send,this.name=s.name,this.streamId=s.streamId,this.maxDataSize=s.maxDataSize}async sendNewStream(){await this.send({id:this.streamId,type:InitiatorMessageTypes.NEW_STREAM,data:new Uint8ArrayList(fromString$b(this.name))})}async sendData(s){for(s=s.sublist();s.byteLength>0;){const a=Math.min(s.byteLength,this.maxDataSize);await this.send({id:this.streamId,type:this.types.MESSAGE,data:s.sublist(0,a)}),s.consume(a)}}async sendReset(){await this.send({id:this.streamId,type:this.types.RESET})}async sendCloseWrite(){await this.send({id:this.streamId,type:this.types.CLOSE})}async sendCloseRead(){}}function createStream$1(o){const{id:s,name:a,send:et,onEnd:tt,type:rt="initiator",maxMsgSize:nt=MAX_MSG_SIZE}=o;return new MplexStream({id:rt==="initiator"?`i${s}`:`r${s}`,streamId:s,name:`${a??s}`,direction:rt==="initiator"?"outbound":"inbound",maxDataSize:nt,onEnd:tt,send:et,log:o.logger.forComponent(`libp2p:mplex:stream:${rt}:${s}`)})}const MAX_STREAMS_INBOUND_STREAMS_PER_CONNECTION=1024,MAX_STREAMS_OUTBOUND_STREAMS_PER_CONNECTION=1024,MAX_STREAM_BUFFER_SIZE=1024*1024*4,DISCONNECT_THRESHOLD=5,CLOSE_TIMEOUT$3=500;function printMessage(o){const s={...o,type:`${MessageTypeNames[o.type]} (${o.type})`};return o.type===MessageTypes.NEW_STREAM&&(s.data=toString$3(o.data instanceof Uint8Array?o.data:o.data.subarray())),(o.type===MessageTypes.MESSAGE_INITIATOR||o.type===MessageTypes.MESSAGE_RECEIVER)&&(s.data=toString$3(o.data instanceof Uint8Array?o.data:o.data.subarray(),"base16")),s}class MplexStreamMuxer{protocol="/mplex/6.7.0";sink;source;log;_streamId;_streams;_init;_source;closeController;rateLimiter;closeTimeout;logger;constructor(s,a){a=a??{},this.log=s.logger.forComponent("libp2p:mplex"),this.logger=s.logger,this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=a,this.closeTimeout=a.closeTimeout??CLOSE_TIMEOUT$3,this.sink=this._createSink(),this._source=pushable({objectMode:!0,onEnd:()=>{for(const et of this._streams.initiators.values())et.destroy();for(const et of this._streams.receivers.values())et.destroy()}}),this.source=pipe(this._source,et=>encode$3(et)),this.closeController=new AbortController,this.rateLimiter=new RateLimiter({points:a.disconnectThreshold??DISCONNECT_THRESHOLD,duration:1})}[Symbol.toStringTag]="@libp2p/mplex";[serviceCapabilities]=["@libp2p/stream-multiplexing"];get streams(){const s=[];for(const a of this._streams.initiators.values())s.push(a);for(const a of this._streams.receivers.values())s.push(a);return s}newStream(s){if(this.closeController.signal.aborted)throw new Error("Muxer already closed");const a=this._streamId++;s=s==null?a.toString():s.toString();const et=this._streams.initiators;return this._newStream({id:a,name:s,type:"initiator",registry:et})}async close(s){if(this.closeController.signal.aborted)return;const a=s?.signal??AbortSignal.timeout(this.closeTimeout);try{await Promise.all(this.streams.map(async et=>et.close({signal:a}))),this._source.end(),await this._source.onEmpty({signal:a}),this.closeController.abort()}catch(et){this.abort(et)}}abort(s){this.closeController.signal.aborted||(this.streams.forEach(a=>{a.abort(s)}),this.closeController.abort(s))}_newReceiverStream(s){const{id:a,name:et}=s,tt=this._streams.receivers;return this._newStream({id:a,name:et,type:"receiver",registry:tt})}_newStream(s){const{id:a,name:et,type:tt,registry:rt}=s;if(this.log("new %s stream %s",tt,a),tt==="initiator"&&this._streams.initiators.size===(this._init.maxOutboundStreams??MAX_STREAMS_OUTBOUND_STREAMS_PER_CONNECTION))throw new CodeError$3("Too many outbound streams open","ERR_TOO_MANY_OUTBOUND_STREAMS");if(rt.has(a))throw new Error(`${tt} stream ${a} already exists!`);const st=createStream$1({id:a,name:et,send:async ot=>{this.log.enabled&&this.log.trace("%s stream %s send",tt,a,printMessage(ot)),this._source.push(ot)},type:tt,onEnd:()=>{this.log("%s stream with id %s and protocol %s ended",tt,a,st.protocol),rt.delete(a),this._init.onStreamEnd!=null&&this._init.onStreamEnd(st)},maxMsgSize:this._init.maxMsgSize,logger:this.logger});return rt.set(a,st),st}_createSink(){return async a=>{const et=()=>{closeSource(a,this.log)};this.closeController.signal.addEventListener("abort",et);try{const tt=new Decoder(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);for await(const rt of a)for(const nt of tt.write(rt))await this._handleIncoming(nt);this._source.end()}catch(tt){this.log("error in sink",tt),this._source.end(tt)}finally{this.closeController.signal.removeEventListener("abort",et)}}}async _handleIncoming(s){const{id:a,type:et}=s;if(this.log.enabled&&this.log.trace("incoming message",printMessage(s)),s.type===MessageTypes.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??MAX_STREAMS_INBOUND_STREAMS_PER_CONNECTION)){this.log("too many inbound streams open"),this._source.push({id:a,type:MessageTypes.RESET_RECEIVER});try{await this.rateLimiter.consume("new-stream",1)}catch{this.log("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),this.abort(new Error("Too many open streams"));return}return}const it=this._newReceiverStream({id:a,name:toString$3(s.data instanceof Uint8Array?s.data:s.data.subarray())});this._init.onIncomingStream!=null&&this._init.onIncomingStream(it);return}const rt=((et&1)===1?this._streams.initiators:this._streams.receivers).get(a);if(rt==null){this.log("missing stream %s for message type %s",a,MessageTypeNames[et]);try{await this.rateLimiter.consume("missing-stream",1)}catch{this.log("rate limit hit when receiving messages for streams that do not exist - closing remote connection"),this.abort(new Error("Too many messages for missing streams"));return}return}const nt=this._init.maxStreamBufferSize??MAX_STREAM_BUFFER_SIZE;try{switch(et){case MessageTypes.MESSAGE_INITIATOR:case MessageTypes.MESSAGE_RECEIVER:if(rt.sourceReadableLength()>nt)throw this._source.push({id:s.id,type:et===MessageTypes.MESSAGE_INITIATOR?MessageTypes.RESET_RECEIVER:MessageTypes.RESET_INITIATOR}),new CodeError$3("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers","ERR_STREAM_INPUT_BUFFER_FULL");rt.sourcePush(s.data);break;case MessageTypes.CLOSE_INITIATOR:case MessageTypes.CLOSE_RECEIVER:rt.remoteCloseWrite();break;case MessageTypes.RESET_INITIATOR:case MessageTypes.RESET_RECEIVER:rt.reset();break;default:this.log("unknown message type %s",et)}}catch(it){this.log.error("error while processing message",it),rt.abort(it)}}}class Mplex{protocol="/mplex/6.7.0";_init;components;constructor(s,a={}){this.components=s,this._init=a}createStreamMuxer(s={}){return new MplexStreamMuxer(this.components,{...s,...this._init})}}function mplex(o={}){return s=>new Mplex(s,o)}function equals$3(o,s){if(o===s)return!0;if(o.byteLength!==s.byteLength)return!1;for(let a=0;a<o.byteLength;a++)if(o[a]!==s[a])return!1;return!0}const PING_LENGTH=32,PROTOCOL_VERSION="1.0.0",PROTOCOL_NAME="ping",PROTOCOL_PREFIX="ipfs",TIMEOUT=1e4,MAX_INBOUND_STREAMS=2,MAX_OUTBOUND_STREAMS=1,ERR_WRONG_PING_ACK="ERR_WRONG_PING_ACK";class PingService{protocol;components;started;timeout;maxInboundStreams;maxOutboundStreams;runOnTransientConnection;log;constructor(s,a={}){this.components=s,this.log=s.logger.forComponent("libp2p:ping"),this.started=!1,this.protocol=`/${a.protocolPrefix??PROTOCOL_PREFIX}/${PROTOCOL_NAME}/${PROTOCOL_VERSION}`,this.timeout=a.timeout??TIMEOUT,this.maxInboundStreams=a.maxInboundStreams??MAX_INBOUND_STREAMS,this.maxOutboundStreams=a.maxOutboundStreams??MAX_OUTBOUND_STREAMS,this.runOnTransientConnection=a.runOnTransientConnection??!0,this.handleMessage=this.handleMessage.bind(this)}[Symbol.toStringTag]="@libp2p/ping";async start(){await this.components.registrar.handle(this.protocol,this.handleMessage,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnTransientConnection:this.runOnTransientConnection}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}handleMessage(s){this.log("incoming ping from %p",s.connection.remotePeer);const{stream:a}=s,et=Date.now();pipe(a,a).catch(tt=>{this.log.error("incoming ping from %p failed with error",s.connection.remotePeer,tt)}).finally(()=>{const tt=Date.now()-et;this.log("incoming ping from %p complete in %dms",s.connection.remotePeer,tt)})}async ping(s,a={}){this.log("pinging %p",s);const et=Date.now(),tt=randomBytes(PING_LENGTH),rt=await this.components.connectionManager.openConnection(s,a);let nt,it=()=>{};if(a.signal==null){const st=AbortSignal.timeout(this.timeout);a={...a,signal:st}}try{nt=await rt.newStream(this.protocol,{...a,runOnTransientConnection:this.runOnTransientConnection}),it=()=>{nt?.abort(new CodeError$3("ping timeout",ERR_TIMEOUT))},a.signal?.addEventListener("abort",it,{once:!0});const st=await pipe([tt],nt,async at=>first(at)),ot=Date.now()-et;if(st==null)throw new CodeError$3(`Did not receive a ping ack after ${ot}ms`,ERR_WRONG_PING_ACK);if(!equals$3(tt,st.subarray()))throw new CodeError$3(`Received wrong ping ack after ${ot}ms`,ERR_WRONG_PING_ACK);return this.log("ping %p complete in %dms",rt.remotePeer,ot),ot}catch(st){throw this.log.error("error while pinging %p",rt.remotePeer,st),nt?.abort(st),st}finally{a.signal?.removeEventListener("abort",it),nt!=null&&await nt.close()}}}function ping(o={}){return s=>new PingService(s,o)}var codes$4;(function(o){o.ERR_ALREADY_ABORTED="ERR_ALREADY_ABORTED",o.ERR_DATA_CHANNEL="ERR_DATA_CHANNEL",o.ERR_CONNECTION_CLOSED="ERR_CONNECTION_CLOSED",o.ERR_HASH_NOT_SUPPORTED="ERR_HASH_NOT_SUPPORTED",o.ERR_INVALID_MULTIADDR="ERR_INVALID_MULTIADDR",o.ERR_INVALID_FINGERPRINT="ERR_INVALID_FINGERPRINT",o.ERR_INVALID_PARAMETERS="ERR_INVALID_PARAMETERS",o.ERR_NOT_IMPLEMENTED="ERR_NOT_IMPLEMENTED",o.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS",o.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS"})(codes$4||(codes$4={}));class WebRTCTransportError extends CodeError$3{constructor(s,a){super(`WebRTC transport error: ${s}`,a??""),this.name="WebRTCTransportError"}}class DataChannelError extends WebRTCTransportError{constructor(s,a){super(`[stream: ${s}] data channel error: ${a}`,codes$4.ERR_DATA_CHANNEL),this.name="WebRTC/DataChannelError"}}function dataChannelError(o,s){return new DataChannelError(o,s)}class InappropriateMultiaddrError extends WebRTCTransportError{constructor(s){super(`There was a problem with the Multiaddr which was passed in: ${s}`,codes$4.ERR_INVALID_MULTIADDR),this.name="WebRTC/InappropriateMultiaddrError"}}function inappropriateMultiaddr(o){return new InappropriateMultiaddrError(o)}class InvalidArgumentError extends WebRTCTransportError{constructor(s){super(`There was a problem with a provided argument: ${s}`,codes$4.ERR_INVALID_PARAMETERS),this.name="WebRTC/InvalidArgumentError"}}function invalidArgument(o){return new InvalidArgumentError(o)}class InvalidFingerprintError extends WebRTCTransportError{constructor(s,a){super(`Invalid fingerprint "${s}" within ${a}`,codes$4.ERR_INVALID_FINGERPRINT),this.name="WebRTC/InvalidFingerprintError"}}function invalidFingerprint(o,s){return new InvalidFingerprintError(o,s)}class UnimplementedError extends WebRTCTransportError{constructor(s){super(`A method (${s}) was called though it has been intentionally left unimplemented.`,codes$4.ERR_NOT_IMPLEMENTED),this.name="WebRTC/UnimplementedError"}}function unimplemented(o){return new UnimplementedError(o)}class UnsupportedHashAlgorithmError extends WebRTCTransportError{constructor(s){super(`unsupported hash algorithm: ${s}`,codes$4.ERR_HASH_NOT_SUPPORTED),this.name="WebRTC/UnsupportedHashAlgorithmError"}}function unsupportedHashAlgorithm(o){return new UnsupportedHashAlgorithmError(o)}var __spreadArray=function(o,s,a){if(a||arguments.length===2)for(var et=0,tt=s.length,rt;et<tt;et++)(rt||!(et in s))&&(rt||(rt=Array.prototype.slice.call(s,0,et)),rt[et]=s[et]);return o.concat(rt||Array.prototype.slice.call(s))},BrowserInfo=function(){function o(s,a,et){this.name=s,this.version=a,this.os=et,this.type="browser"}return o}(),NodeInfo=function(){function o(s){this.version=s,this.type="node",this.name="node",this.os=process$1.platform}return o}(),SearchBotDeviceInfo=function(){function o(s,a,et,tt){this.name=s,this.version=a,this.os=et,this.bot=tt,this.type="bot-device"}return o}(),BotInfo=function(){function o(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return o}(),ReactNativeInfo=function(){function o(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return o}(),SEARCHBOX_UA_REGEX=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,SEARCHBOT_OS_REGEX=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,REQUIRED_VERSION_PARTS=3,userAgentRules=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",SEARCHBOX_UA_REGEX]],operatingSystemRules=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function detect$1(o){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new ReactNativeInfo:typeof navigator<"u"?parseUserAgent(navigator.userAgent):getNodeVersion()}function matchUserAgent(o){return o!==""&&userAgentRules.reduce(function(s,a){var et=a[0],tt=a[1];if(s)return s;var rt=tt.exec(o);return!!rt&&[et,rt]},!1)}function parseUserAgent(o){var s=matchUserAgent(o);if(!s)return null;var a=s[0],et=s[1];if(a==="searchbot")return new BotInfo;var tt=et[1]&&et[1].split(".").join("_").split("_").slice(0,3);tt?tt.length<REQUIRED_VERSION_PARTS&&(tt=__spreadArray(__spreadArray([],tt,!0),createVersionParts(REQUIRED_VERSION_PARTS-tt.length),!0)):tt=[];var rt=tt.join("."),nt=detectOS(o),it=SEARCHBOT_OS_REGEX.exec(o);return it&&it[1]?new SearchBotDeviceInfo(a,rt,nt,it[1]):new BrowserInfo(a,rt,nt)}function detectOS(o){for(var s=0,a=operatingSystemRules.length;s<a;s++){var et=operatingSystemRules[s],tt=et[0],rt=et[1],nt=rt.exec(o);if(nt)return tt}return null}function getNodeVersion(){var o=typeof process$1<"u"&&process$1.version;return o?new NodeInfo(process$1.version.slice(1)):null}function createVersionParts(o){for(var s=[],a=0;a<o;a++)s.push("0");return s}const browser$1=detect$1(),isFirefox=browser$1!=null&&browser$1.name==="firefox",nopSource=async function*(){},nopSink=async o=>{},DATA_CHANNEL_DRAIN_TIMEOUT=30*1e3;function drainAndClose(o,s,a=DATA_CHANNEL_DRAIN_TIMEOUT,et){o.readyState==="open"&&Promise.resolve().then(async()=>{if(o.bufferedAmount>0){et.log("%s drain channel with %d buffered bytes",s,o.bufferedAmount);const tt=pDefer();let rt=!1;o.bufferedAmountLowThreshold=0;const nt=()=>{rt||(et.log("%s drain channel closed before drain",s),tt.resolve())};o.addEventListener("close",nt,{once:!0}),o.addEventListener("bufferedamountlow",()=>{rt=!0,o.removeEventListener("close",nt),tt.resolve()}),await pTimeout(tt.promise,{milliseconds:a})}}).then(async()=>{o.readyState==="open"&&o.close()}).catch(tt=>{et.log.error("error closing outbound stream",tt)})}class WebRTCMultiaddrConnection{log;peerConnection;remoteAddr;timeline;metrics;source=nopSource();sink=nopSink;constructor(s,a){this.log=s.logger.forComponent("libp2p:webrtc:maconn"),this.remoteAddr=a.remoteAddr,this.timeline=a.timeline,this.peerConnection=a.peerConnection;const et=this.peerConnection.connectionState;this.peerConnection.onconnectionstatechange=()=>{this.log.trace("peer connection state change",this.peerConnection.connectionState,"initial state",et),(this.peerConnection.connectionState==="disconnected"||this.peerConnection.connectionState==="failed"||this.peerConnection.connectionState==="closed")&&(this.timeline.close=Date.now())}}async close(s){this.log.trace("closing connection"),this.peerConnection.close(),this.timeline.close=Date.now(),this.metrics?.increment({close:!0})}abort(s){this.log.error("closing connection due to error",s),this.peerConnection.close(),this.timeline.close=Date.now(),this.metrics?.increment({abort:!0})}}var Message$1;(function(o){(function(et){et.FIN="FIN",et.STOP_SENDING="STOP_SENDING",et.RESET="RESET",et.FIN_ACK="FIN_ACK"})(o.Flag||(o.Flag={}));let s;(function(et){et[et.FIN=0]="FIN",et[et.STOP_SENDING=1]="STOP_SENDING",et[et.RESET=2]="RESET",et[et.FIN_ACK=3]="FIN_ACK"})(s||(s={})),function(et){et.codec=()=>enumeration(s)}(o.Flag||(o.Flag={}));let a;o.codec=()=>(a==null&&(a=message((et,tt,rt={})=>{rt.lengthDelimited!==!1&&tt.fork(),et.flag!=null&&(tt.uint32(8),o.Flag.codec().encode(et.flag,tt)),et.message!=null&&(tt.uint32(18),tt.bytes(et.message)),rt.lengthDelimited!==!1&&tt.ldelim()},(et,tt)=>{const rt={},nt=tt==null?et.len:et.pos+tt;for(;et.pos<nt;){const it=et.uint32();switch(it>>>3){case 1:rt.flag=o.Flag.codec().decode(et);break;case 2:rt.message=et.bytes();break;default:et.skipType(it&7);break}}return rt})),a),o.encode=et=>encodeMessage(et,o.codec()),o.decode=et=>decodeMessage(et,o.codec())})(Message$1||(Message$1={}));const MAX_BUFFERED_AMOUNT=16*1024*1024,BUFFERED_AMOUNT_LOW_TIMEOUT=30*1e3,PROTOBUF_OVERHEAD=5,VARINT_LENGTH=2,MAX_MESSAGE_SIZE=16*1024,FIN_ACK_TIMEOUT=5e3,OPEN_TIMEOUT=5e3;class WebRTCStream extends AbstractStream{channel;incomingData;maxBufferedAmount;bufferedAmountLowEventTimeout;maxMessageSize;receiveFinAck;finAckTimeout;openTimeout;constructor(s){const a=s.onEnd;switch(s.onEnd=tt=>{this.log.trace("readable and writeable ends closed",this.status),Promise.resolve(async()=>{if(!(this.timeline.abort!=null||this.timeline.reset!==null))try{await pTimeout(this.receiveFinAck.promise,{milliseconds:this.finAckTimeout})}catch(rt){this.log.error("error receiving FIN_ACK",rt)}}).then(()=>{this.incomingData.end(),a?.(tt)}).catch(rt=>{this.log.error("error ending stream",rt)})},super(s),this.channel=s.channel,this.channel.binaryType="arraybuffer",this.incomingData=pushable(),this.bufferedAmountLowEventTimeout=s.bufferedAmountLowEventTimeout??BUFFERED_AMOUNT_LOW_TIMEOUT,this.maxBufferedAmount=s.maxBufferedAmount??MAX_BUFFERED_AMOUNT,this.maxMessageSize=(s.maxMessageSize??MAX_MESSAGE_SIZE)-PROTOBUF_OVERHEAD-VARINT_LENGTH,this.receiveFinAck=pDefer(),this.finAckTimeout=s.closeTimeout??FIN_ACK_TIMEOUT,this.openTimeout=s.openTimeout??OPEN_TIMEOUT,this.channel.readyState){case"open":this.timeline.open=new Date().getTime();break;case"closed":case"closing":(this.timeline.close===void 0||this.timeline.close===0)&&(this.timeline.close=Date.now());break;case"connecting":break;default:throw this.log.error("unknown datachannel state %s",this.channel.readyState),new CodeError$3("Unknown datachannel state","ERR_INVALID_STATE")}this.channel.onopen=tt=>{this.timeline.open=new Date().getTime()},this.channel.onclose=tt=>{this.receiveFinAck.resolve(),this.close().catch(rt=>{this.log.error("error closing stream after channel closed",rt)})},this.channel.onerror=tt=>{const rt=tt.error;this.abort(rt)},this.channel.onmessage=async tt=>{const{data:rt}=tt;rt===null||rt.byteLength===0||this.incomingData.push(new Uint8Array(rt,0,rt.byteLength))};const et=this;Promise.resolve().then(async()=>{for await(const tt of decode$f(this.incomingData)){const rt=et.processIncomingProtobuf(tt);rt!=null&&et.sourcePush(new Uint8ArrayList(rt))}}).catch(tt=>{this.log.error("error processing incoming data channel messages",tt)})}sendNewStream(){}async _sendMessage(s,a=!0){if(a&&this.channel.bufferedAmount>this.maxBufferedAmount)try{this.log('channel buffer is %d, wait for "bufferedamountlow" event',this.channel.bufferedAmount),await pEvent(this.channel,"bufferedamountlow",{timeout:this.bufferedAmountLowEventTimeout})}catch(et){throw et instanceof TimeoutError?new CodeError$3(`Timed out waiting for DataChannel buffer to clear after ${this.bufferedAmountLowEventTimeout}ms`,"ERR_BUFFER_CLEAR_TIMEOUT"):et}if(this.channel.readyState==="closed"||this.channel.readyState==="closing")throw new CodeError$3(`Invalid datachannel state - ${this.channel.readyState}`,"ERR_INVALID_STATE");this.channel.readyState!=="open"&&(this.log('channel state is "%s" and not "open", waiting for "open" event before sending data',this.channel.readyState),await pEvent(this.channel,"open",{timeout:this.openTimeout}),this.log('channel state is now "%s", sending data',this.channel.readyState)),this.channel.send(s.subarray())}async sendData(s){for(s=s.sublist();s.byteLength>0;){const a=Math.min(s.byteLength,this.maxMessageSize),et=s.subarray(0,a),tt=Message$1.encode({message:et}),rt=encode$b.single(tt);await this._sendMessage(rt),s.consume(a)}}async sendReset(){await this._sendFlag(Message$1.Flag.RESET)}async sendCloseWrite(s){if(await this._sendFlag(Message$1.Flag.FIN)){this.log.trace("awaiting FIN_ACK");try{await raceSignal(this.receiveFinAck.promise,s?.signal,{errorMessage:"sending close-write was aborted before FIN_ACK was received",errorCode:"ERR_FIN_ACK_NOT_RECEIVED"})}catch(et){this.log.error("failed to await FIN_ACK",et)}}else this.log.trace("sending FIN failed, not awaiting FIN_ACK");this.receiveFinAck.resolve()}async sendCloseRead(){await this._sendFlag(Message$1.Flag.STOP_SENDING)}processIncomingProtobuf(s){const a=Message$1.decode(s);if(a.flag!==void 0&&(this.log.trace('incoming flag %s, write status "%s", read status "%s"',a.flag,this.writeStatus,this.readStatus),a.flag===Message$1.Flag.FIN&&(this.remoteCloseWrite(),this.log.trace("sending FIN_ACK"),this._sendFlag(Message$1.Flag.FIN_ACK).catch(et=>{this.log.error("error sending FIN_ACK immediately",et)})),a.flag===Message$1.Flag.RESET&&this.reset(),a.flag===Message$1.Flag.STOP_SENDING&&this.remoteCloseRead(),a.flag===Message$1.Flag.FIN_ACK&&(this.log.trace("received FIN_ACK"),this.receiveFinAck.resolve())),this.readStatus==="ready")return a.message}async _sendFlag(s){if(this.channel.readyState!=="open")return this.log.trace('not sending flag %s because channel is "%s" and not "open"',this.channel.readyState,s.toString()),!1;this.log.trace("sending flag %s",s.toString());const a=Message$1.encode({flag:s}),et=encode$b.single(a);try{return await this._sendMessage(et,!1),!0}catch(tt){this.log.error("could not send flag %s",s.toString(),tt)}return!1}}function createStream(o){const{channel:s,direction:a}=o;return new WebRTCStream({id:a==="inbound"?`i${s.id}`:`r${s.id}`,log:o.logger.forComponent(`libp2p:webrtc:stream:${a}:${s.id}`),...o})}const PROTOCOL="/webrtc";class DataChannelMuxerFactory{protocol;peerConnection;bufferedStreams=[];metrics;dataChannelOptions;components;log;constructor(s,a){this.components=s,this.peerConnection=a.peerConnection,this.metrics=a.metrics,this.protocol=a.protocol??PROTOCOL,this.dataChannelOptions=a.dataChannelOptions??{},this.log=s.logger.forComponent("libp2p:webrtc:datachannelmuxerfactory"),this.peerConnection.ondatachannel=({channel:et})=>{if(this.log.trace('incoming early datachannel with channel id %d and label "%s"',et.id),et.label==="init"){this.log.trace("closing early init channel"),et.close();return}const tt={},rt=createStream({channel:et,direction:"inbound",onEnd:nt=>{tt.onEnd(nt)},logger:s.logger,...this.dataChannelOptions});tt.stream=rt,tt.channel=et,tt.onEnd=()=>{this.bufferedStreams=this.bufferedStreams.filter(nt=>nt.stream.id!==rt.id)},this.bufferedStreams.push(tt)}}createStreamMuxer(s){return new DataChannelMuxer(this.components,{...s,peerConnection:this.peerConnection,dataChannelOptions:this.dataChannelOptions,metrics:this.metrics,streams:this.bufferedStreams,protocol:this.protocol})}}class DataChannelMuxer{init;streams;protocol;log;peerConnection;dataChannelOptions;metrics;logger;constructor(s,a){this.init=a,this.log=s.logger.forComponent("libp2p:webrtc:muxer"),this.logger=s.logger,this.streams=a.streams.map(et=>et.stream),this.peerConnection=a.peerConnection,this.protocol=a.protocol??PROTOCOL,this.metrics=a.metrics,this.dataChannelOptions=a.dataChannelOptions??{},this.peerConnection.ondatachannel=({channel:et})=>{if(this.log.trace("incoming datachannel with channel id %d",et.id),et.label==="init"){this.log.trace("closing init channel"),et.close();return}const tt=createStream({channel:et,direction:"inbound",onEnd:()=>{this.log("incoming channel %s ended with state %s",et.id,et.readyState),this.#e(tt,et)},logger:this.logger,...this.dataChannelOptions});this.streams.push(tt),this.metrics?.increment({incoming_stream:!0}),a?.onIncomingStream?.(tt)},this.init.streams.length>0&&queueMicrotask(()=>{this.init.streams.forEach(et=>{et.onEnd=()=>{this.log("incoming early channel %s ended with state %s",et.channel.id,et.channel.readyState),this.#e(et.stream,et.channel)},this.metrics?.increment({incoming_stream:!0}),this.init?.onIncomingStream?.(et.stream)})})}#e(s,a){this.log.trace("stream %s %s %s onEnd",s.direction,s.id,s.protocol),drainAndClose(a,`${s.direction} ${s.id} ${s.protocol}`,this.dataChannelOptions.drainTimeout,{log:this.log}),this.streams=this.streams.filter(et=>et.id!==s.id),this.metrics?.increment({stream_end:!0}),this.init?.onStreamEnd?.(s)}async close(s){try{await Promise.all(this.streams.map(async a=>a.close(s)))}catch(a){this.abort(a)}}abort(s){for(const a of this.streams)a.abort(s)}source=nopSource();sink=nopSink;newStream(){const s=this.peerConnection.createDataChannel("");this.log.trace("opened outgoing datachannel with channel id %s",s.id);const a=createStream({channel:s,direction:"outbound",onEnd:()=>{this.log("outgoing channel %s ended with state %s",s.id,s.readyState),this.#e(a,s)},logger:this.logger,...this.dataChannelOptions});return this.streams.push(a),this.metrics?.increment({outgoing_stream:!0}),a}}const RTCPeerConnection=globalThis.RTCPeerConnection,RTCSessionDescription=globalThis.RTCSessionDescription,RTCIceCandidate=globalThis.RTCIceCandidate;var Message;(function(o){(function(et){et.SDP_OFFER="SDP_OFFER",et.SDP_ANSWER="SDP_ANSWER",et.ICE_CANDIDATE="ICE_CANDIDATE"})(o.Type||(o.Type={}));let s;(function(et){et[et.SDP_OFFER=0]="SDP_OFFER",et[et.SDP_ANSWER=1]="SDP_ANSWER",et[et.ICE_CANDIDATE=2]="ICE_CANDIDATE"})(s||(s={})),function(et){et.codec=()=>enumeration(s)}(o.Type||(o.Type={}));let a;o.codec=()=>(a==null&&(a=message((et,tt,rt={})=>{rt.lengthDelimited!==!1&&tt.fork(),et.type!=null&&(tt.uint32(8),o.Type.codec().encode(et.type,tt)),et.data!=null&&(tt.uint32(18),tt.string(et.data)),rt.lengthDelimited!==!1&&tt.ldelim()},(et,tt)=>{const rt={},nt=tt==null?et.len:et.pos+tt;for(;et.pos<nt;){const it=et.uint32();switch(it>>>3){case 1:rt.type=o.Type.codec().decode(et);break;case 2:rt.data=et.string();break;default:et.skipType(it&7);break}}return rt})),a),o.encode=et=>encodeMessage(et,o.codec()),o.decode=et=>decodeMessage(et,o.codec())})(Message||(Message={}));const readCandidatesUntilConnected=async(o,s,a)=>{try{const et=pDefer();for(resolveOnConnected(o,et);;){const tt=await Promise.race([et.promise,s.read({signal:a.signal}).catch(()=>{})]);if(tt==null){a.signal?.throwIfAborted();break}if(tt.type!==Message.Type.ICE_CANDIDATE)throw new CodeError$3("ICE candidate message expected","ERR_NOT_ICE_CANDIDATE");const rt=JSON.parse(tt.data??"null");if(rt===""||rt===null){a.log.trace("end-of-candidates received");continue}const nt=new RTCIceCandidate(rt);a.log.trace("%s received new ICE candidate %o",a.direction,rt);try{await o.addIceCandidate(nt)}catch(it){a.log.error("%s bad candidate received",a.direction,rt,it)}}}catch(et){if(a.log.error("%s error parsing ICE candidate",a.direction,et),a.signal?.aborted===!0)throw et}};function getConnectionState(o){return isFirefox?o.iceConnectionState:o.connectionState}function resolveOnConnected(o,s){o[isFirefox?"oniceconnectionstatechange":"onconnectionstatechange"]=a=>{switch(getConnectionState(o)){case"connected":s.resolve();break;case"failed":case"disconnected":case"closed":s.reject(new CodeError$3("RTCPeerConnection was closed","ERR_CONNECTION_CLOSED_BEFORE_CONNECTED"));break}}}async function initiateConnection({rtcConfiguration:o,dataChannel:s,signal:a,metrics:et,multiaddr:tt,connectionManager:rt,transportManager:nt,log:it,logger:st}){const{baseAddr:ot}=splitAddr(tt);et?.dialerEvents.increment({open:!0}),it.trace("dialing base address: %a",ot);const at=ot.getPeerId();if(at==null)throw new CodeError$3("Relay peer was missing","ERR_INVALID_ADDRESS");const lt=rt.getConnections(peerIdFromString(at));let ct,ht=!1;lt.length===0?(ct=await nt.dial(ot,{signal:a}),ht=!0):ct=lt[0];try{const ft=await ct.newStream(SIGNALING_PROTO_ID,{signal:a,runOnTransientConnection:!0}),dt=pbStream(ft).pb(Message),pt=new RTCPeerConnection(o),gt=new DataChannelMuxerFactory({logger:st},{peerConnection:pt,dataChannelOptions:s});try{const mt=pt.createDataChannel("init");pt.onicecandidate=({candidate:xt})=>{const wt=JSON.stringify(xt?.toJSON()??null);it.trace("initiator sending ICE candidate %o",xt),dt.write({type:Message.Type.ICE_CANDIDATE,data:wt},{signal:a}).catch(Rt=>{it.error("error sending ICE candidate",Rt)})},pt.onicecandidateerror=xt=>{it.error("initiator ICE candidate error",xt)};const yt=await pt.createOffer().catch(xt=>{throw it.error("could not execute createOffer",xt),new CodeError$3("Failed to set createOffer","ERR_SDP_HANDSHAKE_FAILED")});it.trace("initiator send SDP offer %s",yt.sdp),await dt.write({type:Message.Type.SDP_OFFER,data:yt.sdp},{signal:a}),await pt.setLocalDescription(yt).catch(xt=>{throw it.error("could not execute setLocalDescription",xt),new CodeError$3("Failed to set localDescription","ERR_SDP_HANDSHAKE_FAILED")});const vt=await dt.read({signal:a});if(vt.type!==Message.Type.SDP_ANSWER)throw new CodeError$3("Remote should send an SDP answer","ERR_SDP_HANDSHAKE_FAILED");it.trace("initiator receive SDP answer %s",vt.data);const Et=new RTCSessionDescription({type:"answer",sdp:vt.data});return await pt.setRemoteDescription(Et).catch(xt=>{throw it.error("could not execute setRemoteDescription",xt),new CodeError$3("Failed to set remoteDescription","ERR_SDP_HANDSHAKE_FAILED")}),it.trace("initiator read candidates until connected"),await readCandidatesUntilConnected(pt,dt,{direction:"initiator",signal:a,log:it}),it.trace("initiator connected, closing init channel"),mt.close(),it.trace("closing signalling channel"),await ft.close({signal:a}),it.trace("initiator connected to remote address %s",tt),{remoteAddress:tt,peerConnection:pt,muxerFactory:gt}}catch(mt){throw it.error("outgoing signalling error",mt),pt.close(),ft.abort(mt),mt}finally{pt.onicecandidate=null,pt.onicecandidateerror=null}}finally{if(ht)try{await ct.close({signal:a})}catch(ft){ct.abort(ft)}}}class WebRTCPeerListener extends TypedEventEmitter{peerId;transportManager;shutdownController;constructor(s,a){super(),this.peerId=s.peerId,this.transportManager=s.transportManager,this.shutdownController=a.shutdownController}async listen(){this.safeDispatchEvent("listening",{})}getAddrs(){return this.transportManager.getListeners().filter(s=>s!==this).map(s=>s.getAddrs().filter(a=>Circuit.matches(a)).map(a=>a.encapsulate(`/webrtc/p2p/${this.peerId}`))).flat()}async close(){this.shutdownController.abort(),this.safeDispatchEvent("close",{})}}async function handleIncomingStream({peerConnection:o,stream:s,signal:a,connection:et,log:tt}){tt.trace("new inbound signaling stream");const rt=pbStream(s).pb(Message);try{o.onicecandidate=({candidate:at})=>{const lt=JSON.stringify(at?.toJSON()??null);tt.trace("recipient sending ICE candidate %s",lt),rt.write({type:Message.Type.ICE_CANDIDATE,data:lt},{signal:a}).catch(ct=>{tt.error("error sending ICE candidate",ct)})};const it=await rt.read({signal:a});if(it.type!==Message.Type.SDP_OFFER)throw new CodeError$3(`expected message type SDP_OFFER, received: ${it.type??"undefined"} `,"ERR_SDP_HANDSHAKE_FAILED");tt.trace("recipient receive SDP offer %s",it.data);const st=new RTCSessionDescription({type:"offer",sdp:it.data});await o.setRemoteDescription(st).catch(at=>{throw tt.error("could not execute setRemoteDescription",at),new CodeError$3("Failed to set remoteDescription","ERR_SDP_HANDSHAKE_FAILED")});const ot=await o.createAnswer().catch(at=>{throw tt.error("could not execute createAnswer",at),new CodeError$3("Failed to create answer","ERR_SDP_HANDSHAKE_FAILED")});tt.trace("recipient send SDP answer %s",ot.sdp),await rt.write({type:Message.Type.SDP_ANSWER,data:ot.sdp},{signal:a}),await o.setLocalDescription(ot).catch(at=>{throw tt.error("could not execute setLocalDescription",at),new CodeError$3("Failed to set localDescription","ERR_SDP_HANDSHAKE_FAILED")}),tt.trace("recipient read candidates until connected"),await readCandidatesUntilConnected(o,rt,{direction:"recipient",signal:a,log:tt})}catch(it){if(o.connectionState!=="connected")throw tt.error("error while handling signaling stream from peer %a",et.remoteAddr,it),o.close(),it;tt("error while handling signaling stream from peer %a, ignoring as the RTCPeerConnection is already connected",et.remoteAddr,it)}const nt=multiaddr(`/webrtc/p2p/${et.remoteAddr.getPeerId()}`);return tt.trace("recipient connected to remote address %s",nt),{remoteAddress:nt}}const WEBRTC_TRANSPORT="/webrtc",CIRCUIT_RELAY_TRANSPORT="/p2p-circuit",SIGNALING_PROTO_ID="/webrtc-signaling/0.0.1",INBOUND_CONNECTION_TIMEOUT=30*1e3;class WebRTCTransport{components;init;log;_started=!1;metrics;shutdownController;constructor(s,a={}){this.components=s,this.init=a,this.log=s.logger.forComponent("libp2p:webrtc"),this.shutdownController=new AbortController,setMaxListeners(1/0,this.shutdownController.signal),s.metrics!=null&&(this.metrics={dialerEvents:s.metrics.registerCounterGroup("libp2p_webrtc_dialer_events_total",{label:"event",help:"Total count of WebRTC dialer events by type"}),listenerEvents:s.metrics.registerCounterGroup("libp2p_webrtc_listener_events_total",{label:"event",help:"Total count of WebRTC listener events by type"})})}[transportSymbol]=!0;[Symbol.toStringTag]="@libp2p/webrtc";[serviceCapabilities]=["@libp2p/transport"];[serviceDependencies]=["@libp2p/identify","@libp2p/circuit-relay-v2-transport"];isStarted(){return this._started}async start(){await this.components.registrar.handle(SIGNALING_PROTO_ID,s=>{this._onProtocol(s).catch(a=>{this.log.error("failed to handle incoming connect from %p",s.connection.remotePeer,a)})},{runOnTransientConnection:!0}),this._started=!0}async stop(){await this.components.registrar.unhandle(SIGNALING_PROTO_ID),this._started=!1}createListener(s){return new WebRTCPeerListener(this.components,{shutdownController:this.shutdownController})}listenFilter(s){return s.filter(WebRTC.exactMatch)}dialFilter(s){return this.listenFilter(s)}async dial(s,a){this.log.trace("dialing address: %a",s);const{remoteAddress:et,peerConnection:tt,muxerFactory:rt}=await initiateConnection({rtcConfiguration:typeof this.init.rtcConfiguration=="function"?await this.init.rtcConfiguration():this.init.rtcConfiguration,dataChannel:this.init.dataChannel,multiaddr:s,dataChannelOptions:this.init.dataChannel,signal:a.signal,connectionManager:this.components.connectionManager,transportManager:this.components.transportManager,log:this.log,logger:this.components.logger}),nt=new WebRTCMultiaddrConnection(this.components,{peerConnection:tt,timeline:{open:Date.now()},remoteAddr:et,metrics:this.metrics?.dialerEvents}),it=await a.upgrader.upgradeOutbound(nt,{skipProtection:!0,skipEncryption:!0,muxerFactory:rt});return this._closeOnShutdown(tt,nt),it}async _onProtocol({connection:s,stream:a}){const et=AbortSignal.timeout(this.init.inboundConnectionTimeout??INBOUND_CONNECTION_TIMEOUT),tt=new RTCPeerConnection(typeof this.init.rtcConfiguration=="function"?await this.init.rtcConfiguration():this.init.rtcConfiguration),rt=new DataChannelMuxerFactory(this.components,{peerConnection:tt,dataChannelOptions:this.init.dataChannel});try{const{remoteAddress:nt}=await handleIncomingStream({peerConnection:tt,connection:s,stream:a,signal:et,log:this.log});await a.close({signal:et});const it=new WebRTCMultiaddrConnection(this.components,{peerConnection:tt,timeline:{open:new Date().getTime()},remoteAddr:nt,metrics:this.metrics?.listenerEvents});await this.components.upgrader.upgradeInbound(it,{skipEncryption:!0,skipProtection:!0,muxerFactory:rt}),this._closeOnShutdown(tt,it)}catch(nt){throw this.log.error("incoming signalling error",nt),tt.close(),a.abort(nt),nt}}_closeOnShutdown(s,a){const et=()=>{a.close().catch(tt=>{this.log.error("could not close WebRTCMultiaddrConnection",tt)})};this.shutdownController.signal.addEventListener("abort",et),s.addEventListener("close",()=>{this.shutdownController.signal.removeEventListener("abort",et)})}}function splitAddr(o){const s=o.toString().split(WEBRTC_TRANSPORT+"/");if(s.length!==2)throw new CodeError$3("webrtc protocol was not present in multiaddr",codes$4.ERR_INVALID_MULTIADDR);if(!s[0].includes(CIRCUIT_RELAY_TRANSPORT))throw new CodeError$3("p2p-circuit protocol was not present in multiaddr",codes$4.ERR_INVALID_MULTIADDR);let a=multiaddr(s[0]);const tt=multiaddr("/"+s[1]).getPeerId();if(tt==null)throw new CodeError$3("destination peer id was missing",codes$4.ERR_INVALID_MULTIADDR);const rt=a.protos().pop();if(rt===void 0)throw new CodeError$3("invalid multiaddr",codes$4.ERR_INVALID_MULTIADDR);return rt.name!=="p2p"&&(a=a.encapsulate(`/p2p/${tt}`)),{baseAddr:a,peerId:peerIdFromString(tt)}}var src$2={exports:{}};function base$1(o){if(o.length>=255)throw new TypeError("Alphabet too long");for(var s=new Uint8Array(256),a=0;a<s.length;a++)s[a]=255;for(var et=0;et<o.length;et++){var tt=o.charAt(et),rt=tt.charCodeAt(0);if(s[rt]!==255)throw new TypeError(tt+" is ambiguous");s[rt]=et}var nt=o.length,it=o.charAt(0),st=Math.log(nt)/Math.log(256),ot=Math.log(256)/Math.log(nt);function at(ht){if(ht instanceof Uint8Array||(ArrayBuffer.isView(ht)?ht=new Uint8Array(ht.buffer,ht.byteOffset,ht.byteLength):Array.isArray(ht)&&(ht=Uint8Array.from(ht))),!(ht instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(ht.length===0)return"";for(var ft=0,dt=0,pt=0,gt=ht.length;pt!==gt&&ht[pt]===0;)pt++,ft++;for(var mt=(gt-pt)*ot+1>>>0,yt=new Uint8Array(mt);pt!==gt;){for(var vt=ht[pt],Et=0,xt=mt-1;(vt!==0||Et<dt)&&xt!==-1;xt--,Et++)vt+=256*yt[xt]>>>0,yt[xt]=vt%nt>>>0,vt=vt/nt>>>0;if(vt!==0)throw new Error("Non-zero carry");dt=Et,pt++}for(var wt=mt-dt;wt!==mt&&yt[wt]===0;)wt++;for(var Rt=it.repeat(ft);wt<mt;++wt)Rt+=o.charAt(yt[wt]);return Rt}function lt(ht){if(typeof ht!="string")throw new TypeError("Expected String");if(ht.length===0)return new Uint8Array;var ft=0;if(ht[ft]!==" "){for(var dt=0,pt=0;ht[ft]===it;)dt++,ft++;for(var gt=(ht.length-ft)*st+1>>>0,mt=new Uint8Array(gt);ht[ft];){var yt=s[ht.charCodeAt(ft)];if(yt===255)return;for(var vt=0,Et=gt-1;(yt!==0||vt<pt)&&Et!==-1;Et--,vt++)yt+=nt*mt[Et]>>>0,mt[Et]=yt%256>>>0,yt=yt/256>>>0;if(yt!==0)throw new Error("Non-zero carry");pt=vt,ft++}if(ht[ft]!==" "){for(var xt=gt-pt;xt!==gt&&mt[xt]===0;)xt++;for(var wt=new Uint8Array(dt+(gt-xt)),Rt=dt;xt!==gt;)wt[Rt++]=mt[xt++];return wt}}}function ct(ht){var ft=lt(ht);if(ft)return ft;throw new Error("Non-base"+nt+" character")}return{encode:at,decodeUnsafe:lt,decode:ct}}var src$1=base$1;const textDecoder=new TextDecoder,decodeText$1=o=>textDecoder.decode(o),textEncoder=new TextEncoder,encodeText$2=o=>textEncoder.encode(o);function concat$5(o,s){const a=new Uint8Array(s);let et=0;for(const tt of o)a.set(tt,et),et+=tt.length;return a}var util$1={decodeText:decodeText$1,encodeText:encodeText$2,concat:concat$5};const{encodeText:encodeText$1}=util$1;let Base$1=class{constructor(s,a,et,tt){this.name=s,this.code=a,this.codeBuf=encodeText$1(this.code),this.alphabet=tt,this.codec=et(tt)}encode(s){return this.codec.encode(s)}decode(s){for(const a of s)if(this.alphabet&&this.alphabet.indexOf(a)<0)throw new Error(`invalid character '${a}' in '${s}'`);return this.codec.decode(s)}};var base=Base$1;const decode$2=(o,s,a)=>{const et={};for(let ot=0;ot<s.length;++ot)et[s[ot]]=ot;let tt=o.length;for(;o[tt-1]==="=";)--tt;const rt=new Uint8Array(tt*a/8|0);let nt=0,it=0,st=0;for(let ot=0;ot<tt;++ot){const at=et[o[ot]];if(at===void 0)throw new SyntaxError("Invalid character "+o[ot]);it=it<<a|at,nt+=a,nt>=8&&(nt-=8,rt[st++]=255&it>>nt)}if(nt>=a||255&it<<8-nt)throw new SyntaxError("Unexpected end of data");return rt},encode$2=(o,s,a)=>{const et=s[s.length-1]==="=",tt=(1<<a)-1;let rt="",nt=0,it=0;for(let st=0;st<o.length;++st)for(it=it<<8|o[st],nt+=8;nt>a;)nt-=a,rt+=s[tt&it>>nt];if(nt&&(rt+=s[tt&it<<a-nt]),et)for(;rt.length*a&7;)rt+="=";return rt},rfc4648$1=o=>s=>({encode(a){return encode$2(a,s,o)},decode(a){return decode$2(a,s,o)}});var rfc4648_1={rfc4648:rfc4648$1};const baseX=src$1,Base=base,{rfc4648}=rfc4648_1,{decodeText,encodeText}=util$1,identity=()=>({encode:decodeText,decode:encodeText}),constants$1=[["identity","\0",identity,""],["base2","0",rfc4648(1),"01"],["base8","7",rfc4648(3),"01234567"],["base10","9",baseX,"0123456789"],["base16","f",rfc4648(4),"0123456789abcdef"],["base16upper","F",rfc4648(4),"0123456789ABCDEF"],["base32hex","v",rfc4648(5),"0123456789abcdefghijklmnopqrstuv"],["base32hexupper","V",rfc4648(5),"0123456789ABCDEFGHIJKLMNOPQRSTUV"],["base32hexpad","t",rfc4648(5),"0123456789abcdefghijklmnopqrstuv="],["base32hexpadupper","T",rfc4648(5),"0123456789ABCDEFGHIJKLMNOPQRSTUV="],["base32","b",rfc4648(5),"abcdefghijklmnopqrstuvwxyz234567"],["base32upper","B",rfc4648(5),"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"],["base32pad","c",rfc4648(5),"abcdefghijklmnopqrstuvwxyz234567="],["base32padupper","C",rfc4648(5),"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567="],["base32z","h",rfc4648(5),"ybndrfg8ejkmcpqxot1uwisza345h769"],["base36","k",baseX,"0123456789abcdefghijklmnopqrstuvwxyz"],["base36upper","K",baseX,"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"],["base58btc","z",baseX,"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"],["base58flickr","Z",baseX,"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"],["base64","m",rfc4648(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"],["base64pad","M",rfc4648(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="],["base64url","u",rfc4648(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"],["base64urlpad","U",rfc4648(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_="]],names$2=constants$1.reduce((o,s)=>(o[s[0]]=new Base(s[0],s[1],s[2],s[3]),o),{}),codes$3=constants$1.reduce((o,s)=>(o[s[1]]=names$2[s[0]],o),{});var constants_1={names:names$2,codes:codes$3};(function(o,s){const a=constants_1,{encodeText:et,decodeText:tt,concat:rt}=util$1;function nt(dt,pt){if(!pt)throw new Error("requires an encoded Uint8Array");const{name:gt,codeBuf:mt}=lt(dt);return at(gt,pt),rt([mt,pt],mt.length+pt.length)}function it(dt,pt){const gt=lt(dt),mt=et(gt.encode(pt));return rt([gt.codeBuf,mt],gt.codeBuf.length+mt.length)}function st(dt){dt instanceof Uint8Array&&(dt=tt(dt));const pt=dt[0];return["f","F","v","V","t","T","b","B","c","C","h","k","K"].includes(pt)&&(dt=dt.toLowerCase()),lt(dt[0]).decode(dt.substring(1))}function ot(dt){if(dt instanceof Uint8Array&&(dt=tt(dt)),Object.prototype.toString.call(dt)!=="[object String]")return!1;try{return lt(dt[0]).name}catch{return!1}}function at(dt,pt){lt(dt).decode(tt(pt))}function lt(dt){if(Object.prototype.hasOwnProperty.call(a.names,dt))return a.names[dt];if(Object.prototype.hasOwnProperty.call(a.codes,dt))return a.codes[dt];throw new Error(`Unsupported encoding: ${dt}`)}function ct(dt){return dt instanceof Uint8Array&&(dt=tt(dt)),lt(dt[0])}s=o.exports=nt,s.encode=it,s.decode=st,s.isEncoded=ot,s.encoding=lt,s.encodingFromData=ct;const ht=Object.freeze(a.names),ft=Object.freeze(a.codes);s.names=ht,s.codes=ft})(src$2,src$2.exports);var srcExports=src$2.exports,encode_1=encode$1,MSB$1=128,REST$1=127,MSBALL=~REST$1,INT=Math.pow(2,31);function encode$1(o,s,a){s=s||[],a=a||0;for(var et=a;o>=INT;)s[a++]=o&255|MSB$1,o/=128;for(;o&MSBALL;)s[a++]=o&255|MSB$1,o>>>=7;return s[a]=o|0,encode$1.bytes=a-et+1,s}var decode$1=read$1,MSB=128,REST=127;function read$1(o,et){var a=0,et=et||0,tt=0,rt=et,nt,it=o.length;do{if(rt>=it)throw read$1.bytes=0,new RangeError("Could not decode varint");nt=o[rt++],a+=tt<28?(nt&REST)<<tt:(nt&REST)*Math.pow(2,tt),tt+=7}while(nt>=MSB);return read$1.bytes=rt-et,a}var N1=Math.pow(2,7),N2=Math.pow(2,14),N3=Math.pow(2,21),N4=Math.pow(2,28),N5=Math.pow(2,35),N6=Math.pow(2,42),N7=Math.pow(2,49),N8=Math.pow(2,56),N9=Math.pow(2,63),length$1=function(o){return o<N1?1:o<N2?2:o<N3?3:o<N4?4:o<N5?5:o<N6?6:o<N7?7:o<N8?8:o<N9?9:10},varint$1={encode:encode_1,decode:decode$1,encodingLength:length$1};const names$1=Object.freeze({identity:0,sha1:17,"sha2-256":18,"sha2-512":19,"sha3-512":20,"sha3-384":21,"sha3-256":22,"sha3-224":23,"shake-128":24,"shake-256":25,"keccak-224":26,"keccak-256":27,"keccak-384":28,"keccak-512":29,blake3:30,"murmur3-128":34,"murmur3-32":35,"dbl-sha2-256":86,md4:212,md5:213,bmt:214,"sha2-256-trunc254-padded":4114,"ripemd-128":4178,"ripemd-160":4179,"ripemd-256":4180,"ripemd-320":4181,x11:4352,kangarootwelve:7425,"sm3-256":21325,"blake2b-8":45569,"blake2b-16":45570,"blake2b-24":45571,"blake2b-32":45572,"blake2b-40":45573,"blake2b-48":45574,"blake2b-56":45575,"blake2b-64":45576,"blake2b-72":45577,"blake2b-80":45578,"blake2b-88":45579,"blake2b-96":45580,"blake2b-104":45581,"blake2b-112":45582,"blake2b-120":45583,"blake2b-128":45584,"blake2b-136":45585,"blake2b-144":45586,"blake2b-152":45587,"blake2b-160":45588,"blake2b-168":45589,"blake2b-176":45590,"blake2b-184":45591,"blake2b-192":45592,"blake2b-200":45593,"blake2b-208":45594,"blake2b-216":45595,"blake2b-224":45596,"blake2b-232":45597,"blake2b-240":45598,"blake2b-248":45599,"blake2b-256":45600,"blake2b-264":45601,"blake2b-272":45602,"blake2b-280":45603,"blake2b-288":45604,"blake2b-296":45605,"blake2b-304":45606,"blake2b-312":45607,"blake2b-320":45608,"blake2b-328":45609,"blake2b-336":45610,"blake2b-344":45611,"blake2b-352":45612,"blake2b-360":45613,"blake2b-368":45614,"blake2b-376":45615,"blake2b-384":45616,"blake2b-392":45617,"blake2b-400":45618,"blake2b-408":45619,"blake2b-416":45620,"blake2b-424":45621,"blake2b-432":45622,"blake2b-440":45623,"blake2b-448":45624,"blake2b-456":45625,"blake2b-464":45626,"blake2b-472":45627,"blake2b-480":45628,"blake2b-488":45629,"blake2b-496":45630,"blake2b-504":45631,"blake2b-512":45632,"blake2s-8":45633,"blake2s-16":45634,"blake2s-24":45635,"blake2s-32":45636,"blake2s-40":45637,"blake2s-48":45638,"blake2s-56":45639,"blake2s-64":45640,"blake2s-72":45641,"blake2s-80":45642,"blake2s-88":45643,"blake2s-96":45644,"blake2s-104":45645,"blake2s-112":45646,"blake2s-120":45647,"blake2s-128":45648,"blake2s-136":45649,"blake2s-144":45650,"blake2s-152":45651,"blake2s-160":45652,"blake2s-168":45653,"blake2s-176":45654,"blake2s-184":45655,"blake2s-192":45656,"blake2s-200":45657,"blake2s-208":45658,"blake2s-216":45659,"blake2s-224":45660,"blake2s-232":45661,"blake2s-240":45662,"blake2s-248":45663,"blake2s-256":45664,"skein256-8":45825,"skein256-16":45826,"skein256-24":45827,"skein256-32":45828,"skein256-40":45829,"skein256-48":45830,"skein256-56":45831,"skein256-64":45832,"skein256-72":45833,"skein256-80":45834,"skein256-88":45835,"skein256-96":45836,"skein256-104":45837,"skein256-112":45838,"skein256-120":45839,"skein256-128":45840,"skein256-136":45841,"skein256-144":45842,"skein256-152":45843,"skein256-160":45844,"skein256-168":45845,"skein256-176":45846,"skein256-184":45847,"skein256-192":45848,"skein256-200":45849,"skein256-208":45850,"skein256-216":45851,"skein256-224":45852,"skein256-232":45853,"skein256-240":45854,"skein256-248":45855,"skein256-256":45856,"skein512-8":45857,"skein512-16":45858,"skein512-24":45859,"skein512-32":45860,"skein512-40":45861,"skein512-48":45862,"skein512-56":45863,"skein512-64":45864,"skein512-72":45865,"skein512-80":45866,"skein512-88":45867,"skein512-96":45868,"skein512-104":45869,"skein512-112":45870,"skein512-120":45871,"skein512-128":45872,"skein512-136":45873,"skein512-144":45874,"skein512-152":45875,"skein512-160":45876,"skein512-168":45877,"skein512-176":45878,"skein512-184":45879,"skein512-192":45880,"skein512-200":45881,"skein512-208":45882,"skein512-216":45883,"skein512-224":45884,"skein512-232":45885,"skein512-240":45886,"skein512-248":45887,"skein512-256":45888,"skein512-264":45889,"skein512-272":45890,"skein512-280":45891,"skein512-288":45892,"skein512-296":45893,"skein512-304":45894,"skein512-312":45895,"skein512-320":45896,"skein512-328":45897,"skein512-336":45898,"skein512-344":45899,"skein512-352":45900,"skein512-360":45901,"skein512-368":45902,"skein512-376":45903,"skein512-384":45904,"skein512-392":45905,"skein512-400":45906,"skein512-408":45907,"skein512-416":45908,"skein512-424":45909,"skein512-432":45910,"skein512-440":45911,"skein512-448":45912,"skein512-456":45913,"skein512-464":45914,"skein512-472":45915,"skein512-480":45916,"skein512-488":45917,"skein512-496":45918,"skein512-504":45919,"skein512-512":45920,"skein1024-8":45921,"skein1024-16":45922,"skein1024-24":45923,"skein1024-32":45924,"skein1024-40":45925,"skein1024-48":45926,"skein1024-56":45927,"skein1024-64":45928,"skein1024-72":45929,"skein1024-80":45930,"skein1024-88":45931,"skein1024-96":45932,"skein1024-104":45933,"skein1024-112":45934,"skein1024-120":45935,"skein1024-128":45936,"skein1024-136":45937,"skein1024-144":45938,"skein1024-152":45939,"skein1024-160":45940,"skein1024-168":45941,"skein1024-176":45942,"skein1024-184":45943,"skein1024-192":45944,"skein1024-200":45945,"skein1024-208":45946,"skein1024-216":45947,"skein1024-224":45948,"skein1024-232":45949,"skein1024-240":45950,"skein1024-248":45951,"skein1024-256":45952,"skein1024-264":45953,"skein1024-272":45954,"skein1024-280":45955,"skein1024-288":45956,"skein1024-296":45957,"skein1024-304":45958,"skein1024-312":45959,"skein1024-320":45960,"skein1024-328":45961,"skein1024-336":45962,"skein1024-344":45963,"skein1024-352":45964,"skein1024-360":45965,"skein1024-368":45966,"skein1024-376":45967,"skein1024-384":45968,"skein1024-392":45969,"skein1024-400":45970,"skein1024-408":45971,"skein1024-416":45972,"skein1024-424":45973,"skein1024-432":45974,"skein1024-440":45975,"skein1024-448":45976,"skein1024-456":45977,"skein1024-464":45978,"skein1024-472":45979,"skein1024-480":45980,"skein1024-488":45981,"skein1024-496":45982,"skein1024-504":45983,"skein1024-512":45984,"skein1024-520":45985,"skein1024-528":45986,"skein1024-536":45987,"skein1024-544":45988,"skein1024-552":45989,"skein1024-560":45990,"skein1024-568":45991,"skein1024-576":45992,"skein1024-584":45993,"skein1024-592":45994,"skein1024-600":45995,"skein1024-608":45996,"skein1024-616":45997,"skein1024-624":45998,"skein1024-632":45999,"skein1024-640":46e3,"skein1024-648":46001,"skein1024-656":46002,"skein1024-664":46003,"skein1024-672":46004,"skein1024-680":46005,"skein1024-688":46006,"skein1024-696":46007,"skein1024-704":46008,"skein1024-712":46009,"skein1024-720":46010,"skein1024-728":46011,"skein1024-736":46012,"skein1024-744":46013,"skein1024-752":46014,"skein1024-760":46015,"skein1024-768":46016,"skein1024-776":46017,"skein1024-784":46018,"skein1024-792":46019,"skein1024-800":46020,"skein1024-808":46021,"skein1024-816":46022,"skein1024-824":46023,"skein1024-832":46024,"skein1024-840":46025,"skein1024-848":46026,"skein1024-856":46027,"skein1024-864":46028,"skein1024-872":46029,"skein1024-880":46030,"skein1024-888":46031,"skein1024-896":46032,"skein1024-904":46033,"skein1024-912":46034,"skein1024-920":46035,"skein1024-928":46036,"skein1024-936":46037,"skein1024-944":46038,"skein1024-952":46039,"skein1024-960":46040,"skein1024-968":46041,"skein1024-976":46042,"skein1024-984":46043,"skein1024-992":46044,"skein1024-1000":46045,"skein1024-1008":46046,"skein1024-1016":46047,"skein1024-1024":46048,"poseidon-bls12_381-a2-fc1":46081,"poseidon-bls12_381-a2-fc1-sc":46082});var constants={names:names$1};const require$$3=getAugmentedNamespace(toString$l);function fromString$9(o,s="utf8"){const a=BASES$q[s];if(!a)throw new Error(`Unsupported encoding "${s}"`);return(s==="utf8"||s==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?asUint8Array$c(globalThis.Buffer.from(o,"utf-8")):a.decoder.decode(`${a.prefix}${o}`)}const fromString$a=Object.freeze(Object.defineProperty({__proto__:null,fromString:fromString$9},Symbol.toStringTag,{value:"Module"})),require$$4$1=getAugmentedNamespace(fromString$a),require$$5$1=getAugmentedNamespace(concat$f),multibase=srcExports,varint=varint$1,{names}=constants,{toString:uint8ArrayToString}=require$$3,{fromString:uint8ArrayFromString}=require$$4$1,{concat:uint8ArrayConcat}=require$$5$1,codes$2={};for(const o in names){const s=o;codes$2[names[s]]=s}Object.freeze(codes$2);function toHexString(o){if(!(o instanceof Uint8Array))throw new Error("must be passed a Uint8Array");return uint8ArrayToString(o,"base16")}function fromHexString(o){return uint8ArrayFromString(o,"base16")}function toB58String(o){if(!(o instanceof Uint8Array))throw new Error("must be passed a Uint8Array");return uint8ArrayToString(multibase.encode("base58btc",o)).slice(1)}function fromB58String(o){const s=o instanceof Uint8Array?uint8ArrayToString(o):o;return multibase.decode("z"+s)}function decode(o){if(!(o instanceof Uint8Array))throw new Error("multihash must be a Uint8Array");if(o.length<2)throw new Error("multihash too short. must be > 2 bytes.");const s=varint.decode(o);if(!isValidCode(s))throw new Error(`multihash unknown function code: 0x${s.toString(16)}`);o=o.slice(varint.decode.bytes);const a=varint.decode(o);if(a<0)throw new Error(`multihash invalid length: ${a}`);if(o=o.slice(varint.decode.bytes),o.length!==a)throw new Error(`multihash length inconsistent: 0x${uint8ArrayToString(o,"base16")}`);return{code:s,name:codes$2[s],length:a,digest:o}}function encode(o,s,a){if(!o||s===void 0)throw new Error("multihash encode requires at least two args: digest, code");const et=coerceCode(s);if(!(o instanceof Uint8Array))throw new Error("digest should be a Uint8Array");if(a==null&&(a=o.length),a&&o.length!==a)throw new Error("digest length should be equal to specified length.");const tt=varint.encode(et),rt=varint.encode(a);return uint8ArrayConcat([tt,rt,o],tt.length+rt.length+o.length)}function coerceCode(o){let s=o;if(typeof o=="string"){if(names[o]===void 0)throw new Error(`Unrecognized hash function named: ${o}`);s=names[o]}if(typeof s!="number")throw new Error(`Hash function code should be a number. Got: ${s}`);if(codes$2[s]===void 0&&!isAppCode(s))throw new Error(`Unrecognized function code: ${s}`);return s}function isAppCode(o){return o>0&&o<16}function isValidCode(o){return!!(isAppCode(o)||codes$2[o])}function validate(o){decode(o)}function prefix$2(o){return validate(o),o.subarray(0,2)}var src={names,codes:codes$2,toHexString,fromHexString,toB58String,fromB58String,decode,encode,coerceCode,isAppCode,validate,prefix:prefix$2,isValidCode};function allocUnsafe$8(o=0){return new Uint8Array(o)}function asUint8Array$5(o){return o}function concat$4(o,s){s==null&&(s=o.reduce((tt,rt)=>tt+rt.length,0));const a=allocUnsafe$8(s);let et=0;for(const tt of o)a.set(tt,et),et+=tt.length;return a}function createCodec$8(o,s,a,et){return{name:o,prefix:s,encoder:{name:o,prefix:s,encode:a},decoder:{decode:et}}}const string$8=createCodec$8("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),ascii$8=createCodec$8("ascii","a",o=>{let s="a";for(let a=0;a<o.length;a++)s+=String.fromCharCode(o[a]);return s},o=>{o=o.substring(1);const s=allocUnsafe$8(o.length);for(let a=0;a<o.length;a++)s[a]=o.charCodeAt(a);return s}),BASES$8={utf8:string$8,"utf-8":string$8,hex:bases.base16,latin1:ascii$8,ascii:ascii$8,binary:ascii$8,...bases};function fromString$8(o,s="utf8"){const a=BASES$8[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.decoder.decode(`${a.prefix}${o}`)}const mbdecoder=Object.values(bases).map(o=>o.decoder).reduce((o,s)=>o.or(s));function getLocalFingerprint(o,s){const a=o.getConfiguration().certificates?.at(0);if(a==null||a.getFingerprints==null){s.log.trace("fetching fingerprint from local SDP");const tt=o.localDescription;return tt==null?void 0:getFingerprintFromSdp(tt.sdp)}if(s.log.trace("fetching fingerprint from local certificate"),a.getFingerprints().length===0)return;const et=a.getFingerprints()[0].value;if(et==null)throw invalidFingerprint("","no fingerprint on local certificate");return et}const fingerprintRegex=/^a=fingerprint:(?:\w+-[0-9]+)\s(?<fingerprint>(:?[0-9a-fA-F]{2})+)$/m;function getFingerprintFromSdp(o){return o.match(fingerprintRegex)?.groups?.fingerprint}function ipv(o){for(const s of o.protoNames())if(s.startsWith("ip"))return s.toUpperCase();return"IP6"}function certhash(o){const a=o.stringTuples().filter(et=>et[0]===CERTHASH_CODE).map(et=>et[1])[0];if(a===void 0||a==="")throw inappropriateMultiaddr(`Couldn't find a certhash component of multiaddr: ${o.toString()}`);return a}function decodeCerthash(o){const s=mbdecoder.decode(o);return src.decode(s)}function ma2Fingerprint(o){const s=decodeCerthash(certhash(o)),a=toSupportedHashFunction(s.name),et=s.digest.reduce((rt,nt)=>rt+nt.toString(16).padStart(2,"0"),""),tt=et.match(/.{1,2}/g);if(tt==null)throw invalidFingerprint(et,o.toString());return[`${a.toUpperCase()} ${tt.join(":").toUpperCase()}`,et]}function toSupportedHashFunction(o){switch(o){case"sha1":return"sha-1";case"sha2-256":return"sha-256";case"sha2-512":return"sha-512";default:throw unsupportedHashAlgorithm(o)}}function ma2sdp(o,s){const{host:a,port:et}=o.toOptions(),tt=ipv(o),[rt]=ma2Fingerprint(o);return`v=0
o=- 0 0 IN ${tt} ${a}
s=-
c=IN ${tt} ${a}
t=0 0
a=ice-lite
m=application ${et} UDP/DTLS/SCTP webrtc-datachannel
a=mid:0
a=setup:passive
a=ice-ufrag:${s}
a=ice-pwd:${s}
a=fingerprint:${rt}
a=sctp-port:5000
a=max-message-size:16384
a=candidate:1467250027 1 UDP 1467250027 ${a} ${et} typ host\r
`}function fromMultiAddr(o,s){return{type:"answer",sdp:ma2sdp(o,s)}}function munge(o,s){if(o.sdp===void 0)throw invalidArgument("Can't munge a missing SDP");return o.sdp=o.sdp.replace(/\na=ice-ufrag:[^\n]*\n/,`
a=ice-ufrag:`+s+`
`).replace(/\na=ice-pwd:[^\n]*\n/,`
a=ice-pwd:`+s+`
`),o}const charset=Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),genUfrag=o=>[...Array(o)].map(()=>charset.at(Math.floor(Math.random()*charset.length))).join(""),HANDSHAKE_TIMEOUT_MS=1e4;getProtocol("webrtc-direct").code;const CERTHASH_CODE=getProtocol("certhash").code;class WebRTCDirectTransport{log;metrics;components;init;constructor(s,a={}){this.log=s.logger.forComponent("libp2p:webrtc-direct"),this.components=s,this.init=a,s.metrics!=null&&(this.metrics={dialerEvents:s.metrics.registerCounterGroup("libp2p_webrtc-direct_dialer_events_total",{label:"event",help:"Total count of WebRTC-direct dial events by type"})})}[transportSymbol]=!0;[Symbol.toStringTag]="@libp2p/webrtc-direct";[serviceCapabilities]=["@libp2p/transport"];async dial(s,a){const et=await this._connect(s,a);return this.log("dialing address: %a",s),et}createListener(s){throw unimplemented("WebRTCTransport.createListener")}listenFilter(s){return s.filter(WebRTCDirect$1.exactMatch)}dialFilter(s){return this.listenFilter(s)}async _connect(s,a){const et=new AbortController,tt=et.signal,rt=s.getPeerId();if(rt===null)throw inappropriateMultiaddr("we need to have the remote's PeerId");const nt=peerIdFromString(rt),it=decodeCerthash(certhash(s)),st=await RTCPeerConnection.generateCertificate({name:"ECDSA",namedCurve:"P-256",hash:toSupportedHashFunction(it.name)}),ot=new RTCPeerConnection({...typeof this.init.rtcConfiguration=="function"?await this.init.rtcConfiguration():this.init.rtcConfiguration??{},certificates:[st]});try{const at=new Promise((Rt,Ct)=>{const Ft=ot.createDataChannel("",{negotiated:!0,id:0}),zt=setTimeout(()=>{const Nt=`Data channel was never opened: state: ${Ft.readyState}`;this.log.error(Nt),this.metrics?.dialerEvents.increment({open_error:!0}),Ct(dataChannelError("data",Nt))},HANDSHAKE_TIMEOUT_MS);Ft.onopen=Nt=>{clearTimeout(zt),Rt(Ft)},Ft.onerror=Nt=>{clearTimeout(zt);const Yt=`Error opening a data channel for handshaking: ${Nt.target?.toString()??"not specified"}`;this.log.error(Yt),this.metrics?.dialerEvents.increment({unknown_error:!0}),Ct(dataChannelError("data",Yt))}}),lt="libp2p+webrtc+v1/"+genUfrag(32),ct=await ot.createOffer(),ht=munge(ct,lt);await ot.setLocalDescription(ht);const ft=fromMultiAddr(s,lt);await ot.setRemoteDescription(ft);const dt=await at,pt=this.components.peerId,gt=this.generateNoisePrologue(ot,it.code,s),mt=noise({prologueBytes:gt})(this.components),yt=createStream({channel:dt,direction:"inbound",logger:this.components.logger,...this.init.dataChannel??{}}),vt={...yt,sink:yt.sink.bind(yt),source:async function*(){for await(const Rt of yt.source)for(const Ct of Rt)yield Ct}()},Et=new WebRTCMultiaddrConnection(this.components,{peerConnection:ot,remoteAddr:s,timeline:{open:Date.now()},metrics:this.metrics?.dialerEvents}),xt=isFirefox?"iceconnectionstatechange":"connectionstatechange";ot.addEventListener(xt,()=>{switch(ot.connectionState){case"failed":case"disconnected":case"closed":Et.close().catch(Rt=>{this.log.error("error closing connection",Rt)}).finally(()=>{et.abort()});break;default:break}},{signal:tt}),this.metrics?.dialerEvents.increment({peer_connection:!0});const wt=new DataChannelMuxerFactory(this.components,{peerConnection:ot,metrics:this.metrics?.dialerEvents,dataChannelOptions:this.init.dataChannel});return await mt.secureInbound(pt,vt,nt),await a.upgrader.upgradeOutbound(Et,{skipProtection:!0,skipEncryption:!0,muxerFactory:wt})}catch(at){throw ot.close(),at}}generateNoisePrologue(s,a,et){if(s.getConfiguration().certificates?.length===0)throw invalidArgument("no local certificate");const tt=getLocalFingerprint(s,{log:this.log});if(tt==null)throw invalidArgument("no local fingerprint found");const rt=tt.trim().toLowerCase().replaceAll(":",""),nt=fromString$8(rt,"hex"),it=src.encode(nt,a),st=mbdecoder.decode(certhash(et)),ot=fromString$8("libp2p-webrtc-noise:");return concat$4([ot,it,st])}}function webRTCDirect(o){return s=>new WebRTCDirectTransport(s,o)}function webRTC(o){return s=>new WebRTCTransport(s,o)}const ready$1=async o=>{if(o.readyState>=2)throw new Error("socket closed");o.readyState!==1&&await new Promise((s,a)=>{function et(){o.removeEventListener("open",tt),o.removeEventListener("error",rt)}function tt(){et(),s()}function rt(nt){et(),a(nt.error??new Error(`connect ECONNREFUSED ${o.url}`))}o.addEventListener("open",tt),o.addEventListener("error",rt)})},sink$1=(o,s)=>(s=s??{},s.closeOnEnd=s.closeOnEnd!==!1,async et=>{for await(const tt of et){try{await ready$1(o)}catch(rt){if(rt.message==="socket closed")break;throw rt}if(o.readyState===o.CLOSING||o.readyState===o.CLOSED)break;o.send(tt)}s.closeOnEnd!=null&&o.readyState<=1&&await new Promise((tt,rt)=>{o.addEventListener("close",nt=>{if(nt.wasClean||nt.code===1006)tt();else{const it=Object.assign(new Error("ws error"),{event:nt});rt(it)}}),setTimeout(()=>{o.close()})})});var dom={},eventIterator={};Object.defineProperty(eventIterator,"__esModule",{value:!0});class EventQueue{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(s){if(this.isStopped)return;const a={value:s,done:!1};if(this.pullQueue.length){const et=this.pullQueue.shift();et&&et.resolve(a)}else this.pushQueue.push(Promise.resolve(a)),this.highWaterMark!==void 0&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(const s of this.pullQueue)s.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(s){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const a of this.pullQueue)a.reject(s);this.pullQueue.length=0}else{const a=Promise.reject(s);a.catch(()=>{}),this.pushQueue.push(a)}}remove(){Promise.resolve().then(()=>{this.removeCallback&&this.removeCallback()})}[Symbol.asyncIterator](){return{next:s=>{const a=this.pushQueue.shift();return a?(this.lowWaterMark!==void 0&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),a):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise((et,tt)=>{this.pullQueue.push({resolve:et,reject:tt})})},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}let EventIterator$1=class{constructor(s,{highWaterMark:a=100,lowWaterMark:et=1}={}){const tt=new EventQueue;tt.highWaterMark=a,tt.lowWaterMark=et,tt.removeCallback=s({push:rt=>tt.push(rt),stop:()=>tt.stop(),fail:rt=>tt.fail(rt),on:(rt,nt)=>{tt.eventHandlers[rt]=nt}})||(()=>{}),this[Symbol.asyncIterator]=()=>tt[Symbol.asyncIterator](),Object.freeze(this)}};eventIterator.EventIterator=EventIterator$1;eventIterator.default=EventIterator$1;Object.defineProperty(dom,"__esModule",{value:!0});const event_iterator_1=eventIterator;var EventIterator=dom.EventIterator=event_iterator_1.EventIterator;function subscribe(o,s,a){return new event_iterator_1.EventIterator(({push:et})=>(this.addEventListener(o,et,s),()=>this.removeEventListener(o,et,s)),a)}dom.subscribe=subscribe;dom.default=event_iterator_1.EventIterator;function allocUnsafe$7(o=0){return new Uint8Array(o)}function createCodec$7(o,s,a,et){return{name:o,prefix:s,encoder:{name:o,prefix:s,encode:a},decoder:{decode:et}}}const string$7=createCodec$7("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),ascii$7=createCodec$7("ascii","a",o=>{let s="a";for(let a=0;a<o.length;a++)s+=String.fromCharCode(o[a]);return s},o=>{o=o.substring(1);const s=allocUnsafe$7(o.length);for(let a=0;a<o.length;a++)s[a]=o.charCodeAt(a);return s}),BASES$7={utf8:string$7,"utf-8":string$7,hex:bases.base16,latin1:ascii$7,ascii:ascii$7,binary:ascii$7,...bases};function fromString$7(o,s="utf8"){const a=BASES$7[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.decoder.decode(`${a.prefix}${o}`)}function isArrayBuffer(o){return o instanceof ArrayBuffer||o?.constructor?.name==="ArrayBuffer"&&typeof o?.byteLength=="number"}const source$2=o=>{o.binaryType="arraybuffer";const s=async()=>{await new Promise((rt,nt)=>{if(et){rt();return}if(tt!=null){nt(tt);return}const it=at=>{o.removeEventListener("open",st),o.removeEventListener("error",ot),at()},st=()=>{it(rt)},ot=at=>{it(()=>{nt(at.error??new Error(`connect ECONNREFUSED ${o.url}`))})};o.addEventListener("open",st),o.addEventListener("error",ot)})},a=async function*(){const rt=new EventIterator(({push:nt,stop:it,fail:st})=>{const ot=lt=>{let ct=null;typeof lt.data=="string"&&(ct=fromString$7(lt.data)),isArrayBuffer(lt.data)&&(ct=new Uint8Array(lt.data)),lt.data instanceof Uint8Array&&(ct=lt.data),ct!=null&&nt(ct)},at=lt=>{st(lt.error??new Error("Socket error"))};return o.addEventListener("message",ot),o.addEventListener("error",at),o.addEventListener("close",it),()=>{o.removeEventListener("message",ot),o.removeEventListener("error",at),o.removeEventListener("close",it)}},{highWaterMark:1/0});await s();for await(const nt of rt)yield isArrayBuffer(nt)?new Uint8Array(nt):nt}();let et=o.readyState===1,tt;return o.addEventListener("open",()=>{et=!0,tt=null}),o.addEventListener("close",()=>{et=!1,tt=null}),o.addEventListener("error",rt=>{et||(tt=rt.error??new Error(`connect ECONNREFUSED ${o.url}`))}),Object.assign(a,{connected:s})},duplex$1=(o,s)=>{s=s??{};const a=source$2(o);let et=s.remoteAddress,tt=s.remotePort;if(o.url!=null)try{const nt=new URL(o.url);et=nt.hostname,tt=parseInt(nt.port,10)}catch{}if(et==null||tt==null)throw new Error("Remote connection did not have address and/or port");return{sink:sink$1(o,s),source:a,connected:async()=>{await a.connected()},close:async()=>{(o.readyState===o.CONNECTING||o.readyState===o.OPEN)&&await new Promise(nt=>{o.addEventListener("close",()=>{nt()}),o.close()})},destroy:()=>{o.terminate!=null?o.terminate():o.close()},remoteAddress:et,remotePort:tt,socket:o}},WebSocket$1=WebSocket,map={"http:":"ws:","https:":"wss:"},defaultProtocol="ws:",wsurl=(o,s)=>{if(o.startsWith("//")&&(o=`${s?.protocol??defaultProtocol}${o}`),o.startsWith("/")&&s!=null){const et=s.protocol??defaultProtocol,tt=s.host,rt=s.port!=null&&tt?.endsWith(`:${s.port}`)!==!0?`:${s.port}`:"";o=`${et}//${tt}${rt}${o}`}const a=new URL(o);for(const[et,tt]of Object.entries(map))a.protocol===et&&(a.protocol=tt);return a};function connect(o,s){const a=typeof window>"u"?void 0:window.location;s=s??{};const et=wsurl(o,a),tt=new WebSocket$1(et.toString(),s.websocket);return duplex$1(tt,s)}const CODE_P2P$1=421,CODE_CIRCUIT$1=290,CLOSE_TIMEOUT$2=500;function all$2(o){return o.filter(s=>{if(s.protoCodes().includes(CODE_CIRCUIT$1))return!1;const a=s.decapsulateCode(CODE_P2P$1);return WebSockets$1.matches(a)||WebSocketsSecure.matches(a)})}function wss(o){return o.filter(s=>{if(s.protoCodes().includes(CODE_CIRCUIT$1))return!1;const a=s.decapsulateCode(CODE_P2P$1);return WebSocketsSecure.matches(a)})}function createListener$1(){throw new Error("WebSocket Servers can not be created in the browser!")}function socketToMaConn(o,s,a){const et=a.logger.forComponent("libp2p:websockets:maconn"),tt={log:et,async sink(rt){try{await o.sink(async function*(){for await(const nt of rt)nt instanceof Uint8Array?yield nt:yield nt.subarray()}())}catch(nt){nt.type!=="aborted"&&et.error(nt)}},source:o.source,remoteAddr:s,timeline:{open:Date.now()},async close(rt={}){const nt=Date.now();if(rt.signal==null){const st=AbortSignal.timeout(CLOSE_TIMEOUT$2);rt={...rt,signal:st}}const it=()=>{const{host:st,port:ot}=tt.remoteAddr.toOptions();et("timeout closing stream to %s:%s after %dms, destroying it manually",st,ot,Date.now()-nt),this.abort(new CodeError$3("Socket close timeout","ERR_SOCKET_CLOSE_TIMEOUT"))};rt.signal?.addEventListener("abort",it);try{await o.close()}catch(st){et.error("error closing WebSocket gracefully",st),this.abort(st)}finally{rt.signal?.removeEventListener("abort",it),tt.timeline.close=Date.now()}},abort(rt){const{host:nt,port:it}=tt.remoteAddr.toOptions();et("timeout closing stream to %s:%s due to error",nt,it,rt),o.destroy(),tt.timeline.close=Date.now()}};return o.socket.addEventListener("close",()=>{tt.timeline.close==null&&(tt.timeline.close=Date.now())},{once:!0}),tt}class WebSockets{log;init;logger;constructor(s,a){this.log=s.logger.forComponent("libp2p:websockets"),this.logger=s.logger,this.init=a}[transportSymbol]=!0;[Symbol.toStringTag]="@libp2p/websockets";[serviceCapabilities]=["@libp2p/transport"];async dial(s,a){this.log("dialing %s",s),a=a??{};const et=await this._connect(s,a),tt=socketToMaConn(et,s,{logger:this.logger});this.log("new outbound connection %s",tt.remoteAddr);const rt=await a.upgrader.upgradeOutbound(tt);return this.log("outbound connection %s upgraded",tt.remoteAddr),rt}async _connect(s,a){if(a?.signal?.aborted===!0)throw new AbortError$5;const et=s.toOptions();this.log("dialing %s:%s",et.host,et.port);const tt=pDefer(),rt=connect(multiaddrToUri(s),this.init);if(rt.socket.addEventListener("error",()=>{const st=new CodeError$3(`Could not connect to ${s.toString()}`,"ERR_CONNECTION_FAILED");this.log.error("connection error:",st),tt.reject(st)}),a.signal==null)return await Promise.race([rt.connected(),tt.promise]),this.log("connected %s",s),rt;let nt;const it=new Promise((st,ot)=>{if(nt=()=>{ot(new AbortError$5),rt.close().catch(at=>{this.log.error("error closing raw socket",at)})},a?.signal?.aborted===!0){nt();return}a?.signal?.addEventListener("abort",nt)});try{await Promise.race([it,tt.promise,rt.connected()])}finally{nt!=null&&a?.signal?.removeEventListener("abort",nt)}return this.log("connected %s",s),rt}createListener(s){return createListener$1({logger:this.logger},{...this.init,...s})}listenFilter(s){return s=Array.isArray(s)?s:[s],this.init?.filter!=null?this.init?.filter(s):isBrowser$1||isWebWorker?wss(s):all$2(s)}dialFilter(s){return this.listenFilter(s)}}function webSockets(o={}){return s=>new WebSockets(s,o)}function createListener(o){throw new Error("Not implemented")}class WebTransportStream extends AbstractStream{writer;reader;constructor(s){super(s),this.writer=s.bidiStream.writable.getWriter(),this.reader=s.bidiStream.readable.getReader(),Promise.resolve().then(async()=>{for(;;){const a=await this.reader.read();if(a.done){s.log("remote closed write");return}a.value!=null&&this.sourcePush(new Uint8ArrayList(a.value))}}).catch(a=>{s.log.error("error reading from stream",a),this.abort(a)}).finally(()=>{this.remoteCloseWrite()}),this.writer.closed.then(()=>{s.log("writer closed")}).catch(a=>{s.log("writer close promise rejected",a)}).finally(()=>{this.remoteCloseRead()})}sendNewStream(s){}async sendData(s,a){for await(const et of s)this.log("sendData waiting for writer to be ready"),await raceSignal(this.writer.ready,a?.signal),this.writer.write(et).catch(tt=>{this.log.error("error sending stream data",tt)})}async sendReset(s){this.log("sendReset aborting writer"),await raceSignal(this.writer.abort(),s?.signal),this.log("sendReset aborted writer")}async sendCloseWrite(s){this.log("sendCloseWrite closing writer"),await raceSignal(this.writer.close(),s?.signal),this.log("sendCloseWrite closed writer")}async sendCloseRead(s){this.log("sendCloseRead cancelling reader"),await raceSignal(this.reader.cancel(),s?.signal),this.log("sendCloseRead cancelled reader")}}async function webtransportBiDiStreamToStream(o,s,a,et,tt,rt){const nt=rt.forComponent(`libp2p:webtransport:stream:${a}:${s}`),it=new WebTransportStream({bidiStream:o,id:s,direction:a,log:nt,onEnd:()=>{const st=et.findIndex(ot=>ot===it);st!==-1&&et.splice(st,1),tt?.(it)}});return it}function inertDuplex(){return{source:{[Symbol.asyncIterator](){return{async next(){return new Promise(()=>{})}}}},sink:async o=>new Promise(()=>{})}}function webtransportMuxer(o,s,a,et){let tt=0;const rt=a.forComponent("libp2p:webtransport:muxer");return{protocol:"webtransport",createStreamMuxer:nt=>{typeof nt=="function"&&(nt={onIncomingStream:nt});const it=[];Promise.resolve().then(async()=>{//! TODO unclear how to add backpressure here?
for(;;){const{done:ot,value:at}=await s.read();if(ot)break;if(it.length>=et.maxInboundStreams)rt(`too many inbound streams open - ${it.length}/${et.maxInboundStreams}, closing new incoming stream`),at.writable.close().catch(lt=>{rt.error(`failed to close inbound stream that crossed our maxInboundStream limit: ${lt.message}`)}),at.readable.cancel().catch(lt=>{rt.error(`failed to close inbound stream that crossed our maxInboundStream limit: ${lt.message}`)});else{const lt=await webtransportBiDiStreamToStream(at,String(tt++),"inbound",it,nt?.onStreamEnd,a);it.push(lt),nt?.onIncomingStream?.(lt)}}}).catch(ot=>{rt.error("could not create a new stream",ot)});const st={protocol:"webtransport",streams:it,newStream:async ot=>{rt("new outgoing stream",ot);const at=await o.createBidirectionalStream(),lt=await webtransportBiDiStreamToStream(at,String(tt++),nt?.direction??"outbound",it,nt?.onStreamEnd,a);return it.push(lt),lt},close:async()=>{rt("closing webtransport muxer gracefully");try{o.close()}catch(ot){st.abort(ot)}},abort:ot=>{rt("closing webtransport muxer with err:",ot);try{o.close()}catch(at){rt.error("webtransport session threw error during close",at)}},...inertDuplex()};return st}}}function equals$2(o,s){if(o===s)return!0;if(o.byteLength!==s.byteLength)return!1;for(let a=0;a<o.byteLength;a++)if(o[a]!==s[a])return!1;return!0}function isSubset(o,s){return s.filter(et=>!!o.find(tt=>equals$2(et,tt))).length===s.length}const multibaseDecoder=Object.values(bases).map(o=>o.decoder).reduce((o,s)=>o.or(s));function decodeCerthashStr(o){return decode$8(multibaseDecoder.decode(o))}function parseMultiaddr(o){if(!WebTransport$3.matches(o))throw new CodeError$3("Invalid multiaddr, was not a WebTransport address","ERR_INVALID_MULTIADDR");const s=o.stringTuples(),a=s.filter(([nt,it])=>nt===getProtocol("certhash").code).map(([nt,it])=>decodeCerthashStr(it??"")),et=s.filter(([nt,it])=>nt===getProtocol("p2p").code).map(([nt,it])=>peerIdFromString(it??""))[0],tt=o.toOptions();let rt=tt.host;return tt.family===6&&rt?.includes(":")&&(rt=`[${rt}]`),{url:`https://${rt}:${tt.port}`,certhashes:a,remotePeer:et}}const WebTransport$1=WebTransport;class WebTransportTransport{log;components;config;metrics;constructor(s,a={}){this.log=s.logger.forComponent("libp2p:webtransport"),this.components=s,this.config={...a,maxInboundStreams:a.maxInboundStreams??1e3,certificates:a.certificates??[]},s.metrics!=null&&(this.metrics={dialerEvents:s.metrics.registerCounterGroup("libp2p_webtransport_dialer_events_total",{label:"event",help:"Total count of WebTransport dialer events by type"})})}[Symbol.toStringTag]="@libp2p/webtransport";[transportSymbol]=!0;[serviceCapabilities]=["@libp2p/transport"];async dial(s,a){if(a?.signal?.aborted===!0)throw new AbortError$5;this.log("dialing %s",s);const et=this.components.peerId;if(et===void 0)throw new CodeError$3("Need a local peerid","ERR_INVALID_PARAMETERS");a=a??{};const{url:tt,certhashes:rt,remotePeer:nt}=parseMultiaddr(s);let it,st,ot=()=>{},at=!1,lt=!1,ct=!1;try{this.metrics?.dialerEvents.increment({pending:!0});const ht=new WebTransport$1(`${tt}/.well-known/libp2p-webtransport?type=noise`,{serverCertificateHashes:rt.map(ft=>({algorithm:"sha-256",value:ft.digest}))});if(ot=ft=>{if(!at)try{this.metrics?.dialerEvents.increment({[ft]:!0}),ht.close()}catch(dt){this.log.error("error closing wt session",dt)}finally{st!=null&&(st.timeline.close=Date.now()),at=!0}},it=()=>{ot(lt?"noise_timeout":"ready_timeout")},a.signal?.addEventListener("abort",it,{once:!0}),this.log("wait for session to be ready"),await Promise.race([ht.closed,ht.ready]),this.log("session became ready"),lt=!0,this.metrics?.dialerEvents.increment({ready:!0}),ht.closed.catch(ft=>{this.log.error("error on remote wt session close",ft)}).finally(()=>{ot("remote_close")}),ct=await raceSignal(this.authenticateWebTransport(ht,et,nt,rt),a.signal),!ct)throw new CodeError$3("Failed to authenticate webtransport","ERR_AUTHENTICATION_FAILED");return this.metrics?.dialerEvents.increment({open:!0}),st={close:async()=>{this.log("closing webtransport"),ot("close")},abort:ft=>{this.log("aborting webtransport due to passed err",ft),ot("abort")},remoteAddr:s,timeline:{open:Date.now()},log:this.components.logger.forComponent("libp2p:webtransport:maconn"),...inertDuplex()},await a.upgrader.upgradeOutbound(st,{skipEncryption:!0,muxerFactory:webtransportMuxer(ht,ht.incomingBidirectionalStreams.getReader(),this.components.logger,this.config),skipProtection:!0})}catch(ht){throw this.log.error("caught wt session err",ht),ot(ct?"upgrade_error":lt?"noise_error":"ready_error"),ht}finally{it!=null&&a.signal?.removeEventListener("abort",it)}}async authenticateWebTransport(s,a,et,tt=[],rt){if(rt?.aborted===!0)throw new AbortError$5;const nt=await s.createBidirectionalStream(),it=nt.writable.getWriter(),st=nt.readable.getReader(),ot={source:async function*(){for(;;){const ct=await st.read();if(ct.value!=null&&(yield ct.value),ct.done)break}}(),sink:async ct=>{for await(const ht of ct){await raceSignal(it.ready,rt);const ft=ht instanceof Uint8Array?ht:ht.subarray();it.write(ft).catch(dt=>{this.log.error("could not write chunk during authentication of WebTransport stream",dt)})}}},at=noise()(this.components),{remoteExtensions:lt}=await at.secureOutbound(a,ot,et);if(it.close().catch(ct=>{this.log.error(`Failed to close authentication stream writer: ${ct.message}`)}),st.cancel().catch(ct=>{this.log.error(`Failed to close authentication stream reader: ${ct.message}`)}),!isSubset(lt?.webtransportCerthashes??[],tt.map(ct=>ct.bytes)))throw new Error("Our certhashes are not a subset of the remote's reported certhashes");return!0}createListener(s){return createListener(this.components,{...s,certificates:this.config.certificates,maxInboundStreams:this.config.maxInboundStreams})}listenFilter(){return[]}dialFilter(s){return s.filter(a=>{if(!WebTransport$3.exactMatch(a))return!1;const{url:et,certhashes:tt}=parseMultiaddr(a);return et!=null&&tt.length>0})}}function webTransport(o={}){return s=>new WebTransportTransport(s,o)}function ipnsSelector(o,s){const a=s.map((et,tt)=>({record:unmarshal(et),index:tt}));return a.sort((et,tt)=>{const rt=et.record.sequence,nt=tt.record.sequence;if(rt>nt)return-1;if(rt<nt)return 1;if(et.record.validityType===IpnsEntry.ValidityType.EOL&&tt.record.validityType===IpnsEntry.ValidityType.EOL){const it=NanoDate.fromString(et.record.validity).toDate(),st=NanoDate.fromString(tt.record.validity).toDate();if(it.getTime()>st.getTime())return-1;if(it.getTime()<st.getTime())return 1}return 0}),a[0].index}const version$3="1.7.0",name$2="libp2p",version$2="4.2.4",name$1="helia",bootstrapConfig={list:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ"]};function libp2pDefaults(o={}){const s=`${name$1}/${version$2} ${name$2}/${version$3} UserAgent=${globalThis.navigator.userAgent}`;return{peerId:o.peerId,dns:o.dns,addresses:{listen:["/webrtc"]},transports:[circuitRelayTransport({discoverRelays:1}),webRTC(),webRTCDirect(),webTransport(),webSockets()],connectionEncryption:[noise()],streamMuxers:[yamux(),mplex()],peerDiscovery:[bootstrap(bootstrapConfig)],services:{autoNAT:autoNAT(),dcutr:dcutr(),delegatedRouting:()=>createDelegatedRoutingV1HttpApiClient("https://delegated-ipfs.dev"),dht:kadDHT({clientMode:!0,validators:{ipns:ipnsValidator},selectors:{ipns:ipnsSelector}}),identify:identify({agentVersion:s}),identifyPush:identifyPush({agentVersion:s}),keychain:keychain(o.keychain),ping:ping()}}}const createEd25519PeerId=async()=>{const o=await generateKeyPair("Ed25519"),s=await createFromPrivKey(o);if(s.type==="Ed25519")return s;throw new Error(`Generated unexpected PeerId type "${s.type}"`)};async function createFromPrivKey(o){return peerIdFromKeys(marshalPublicKey(o.public),marshalPrivateKey(o))}function isAsyncIterable$4(o){return o[Symbol.asyncIterator]!=null}function all$1(o){if(isAsyncIterable$4(o))return(async()=>{const a=[];for await(const et of o)a.push(et);return a})();const s=[];for(const a of o)s.push(a);return s}function equals$1(o,s){if(o===s)return!0;if(o.byteLength!==s.byteLength)return!1;for(let a=0;a<o.byteLength;a++)if(o[a]!==s[a])return!1;return!0}const codes$1={ERR_INVALID_PARAMETERS:"ERR_INVALID_PARAMETERS"};var Peer$1;(function(o){(function(a){let et;a.codec=()=>(et==null&&(et=message((tt,rt,nt={})=>{nt.lengthDelimited!==!1&&rt.fork(),tt.key!=null&&tt.key!==""&&(rt.uint32(10),rt.string(tt.key)),tt.value!=null&&tt.value.byteLength>0&&(rt.uint32(18),rt.bytes(tt.value)),nt.lengthDelimited!==!1&&rt.ldelim()},(tt,rt)=>{const nt={key:"",value:new Uint8Array(0)},it=rt==null?tt.len:tt.pos+rt;for(;tt.pos<it;){const st=tt.uint32();switch(st>>>3){case 1:nt.key=tt.string();break;case 2:nt.value=tt.bytes();break;default:tt.skipType(st&7);break}}return nt})),et),a.encode=tt=>encodeMessage(tt,a.codec()),a.decode=tt=>decodeMessage(tt,a.codec())})(o.Peer$metadataEntry||(o.Peer$metadataEntry={})),function(a){let et;a.codec=()=>(et==null&&(et=message((tt,rt,nt={})=>{nt.lengthDelimited!==!1&&rt.fork(),tt.key!=null&&tt.key!==""&&(rt.uint32(10),rt.string(tt.key)),tt.value!=null&&(rt.uint32(18),Tag.codec().encode(tt.value,rt)),nt.lengthDelimited!==!1&&rt.ldelim()},(tt,rt)=>{const nt={key:""},it=rt==null?tt.len:tt.pos+rt;for(;tt.pos<it;){const st=tt.uint32();switch(st>>>3){case 1:nt.key=tt.string();break;case 2:nt.value=Tag.codec().decode(tt,tt.uint32());break;default:tt.skipType(st&7);break}}return nt})),et),a.encode=tt=>encodeMessage(tt,a.codec()),a.decode=tt=>decodeMessage(tt,a.codec())}(o.Peer$tagsEntry||(o.Peer$tagsEntry={}));let s;o.codec=()=>(s==null&&(s=message((a,et,tt={})=>{if(tt.lengthDelimited!==!1&&et.fork(),a.addresses!=null)for(const rt of a.addresses)et.uint32(10),Address.codec().encode(rt,et);if(a.protocols!=null)for(const rt of a.protocols)et.uint32(18),et.string(rt);if(a.publicKey!=null&&(et.uint32(34),et.bytes(a.publicKey)),a.peerRecordEnvelope!=null&&(et.uint32(42),et.bytes(a.peerRecordEnvelope)),a.metadata!=null&&a.metadata.size!==0)for(const[rt,nt]of a.metadata.entries())et.uint32(50),o.Peer$metadataEntry.codec().encode({key:rt,value:nt},et);if(a.tags!=null&&a.tags.size!==0)for(const[rt,nt]of a.tags.entries())et.uint32(58),o.Peer$tagsEntry.codec().encode({key:rt,value:nt},et);tt.lengthDelimited!==!1&&et.ldelim()},(a,et)=>{const tt={addresses:[],protocols:[],metadata:new Map,tags:new Map},rt=et==null?a.len:a.pos+et;for(;a.pos<rt;){const nt=a.uint32();switch(nt>>>3){case 1:tt.addresses.push(Address.codec().decode(a,a.uint32()));break;case 2:tt.protocols.push(a.string());break;case 4:tt.publicKey=a.bytes();break;case 5:tt.peerRecordEnvelope=a.bytes();break;case 6:{const it=o.Peer$metadataEntry.codec().decode(a,a.uint32());tt.metadata.set(it.key,it.value);break}case 7:{const it=o.Peer$tagsEntry.codec().decode(a,a.uint32());tt.tags.set(it.key,it.value);break}default:a.skipType(nt&7);break}}return tt})),s),o.encode=a=>encodeMessage(a,o.codec()),o.decode=a=>decodeMessage(a,o.codec())})(Peer$1||(Peer$1={}));var Address;(function(o){let s;o.codec=()=>(s==null&&(s=message((a,et,tt={})=>{tt.lengthDelimited!==!1&&et.fork(),a.multiaddr!=null&&a.multiaddr.byteLength>0&&(et.uint32(10),et.bytes(a.multiaddr)),a.isCertified!=null&&(et.uint32(16),et.bool(a.isCertified)),tt.lengthDelimited!==!1&&et.ldelim()},(a,et)=>{const tt={multiaddr:new Uint8Array(0)},rt=et==null?a.len:a.pos+et;for(;a.pos<rt;){const nt=a.uint32();switch(nt>>>3){case 1:tt.multiaddr=a.bytes();break;case 2:tt.isCertified=a.bool();break;default:a.skipType(nt&7);break}}return tt})),s),o.encode=a=>encodeMessage(a,o.codec()),o.decode=a=>decodeMessage(a,o.codec())})(Address||(Address={}));var Tag;(function(o){let s;o.codec=()=>(s==null&&(s=message((a,et,tt={})=>{tt.lengthDelimited!==!1&&et.fork(),a.value!=null&&a.value!==0&&(et.uint32(8),et.uint32(a.value)),a.expiry!=null&&(et.uint32(16),et.uint64(a.expiry)),tt.lengthDelimited!==!1&&et.ldelim()},(a,et)=>{const tt={value:0},rt=et==null?a.len:a.pos+et;for(;a.pos<rt;){const nt=a.uint32();switch(nt>>>3){case 1:tt.value=a.uint32();break;case 2:tt.expiry=a.uint64();break;default:a.skipType(nt&7);break}}return tt})),s),o.encode=a=>encodeMessage(a,o.codec()),o.decode=a=>decodeMessage(a,o.codec())})(Tag||(Tag={}));function bytesToPeer(o,s){const a=Peer$1.decode(s);a.publicKey!=null&&o.publicKey==null&&(o=peerIdFromPeerId({...o,publicKey:o.publicKey}));const et=new Map,tt=BigInt(Date.now());for(const[rt,nt]of a.tags.entries())nt.expiry!=null&&nt.expiry<tt||et.set(rt,nt);return{...a,id:o,addresses:a.addresses.map(({multiaddr:rt,isCertified:nt})=>({multiaddr:multiaddr(rt),isCertified:nt??!1})),metadata:a.metadata,peerRecordEnvelope:a.peerRecordEnvelope??void 0,tags:et}}const NAMESPACE_COMMON="/peers/";function peerIdToDatastoreKey(o){if(!isPeerId(o)||o.type==null)throw new CodeError$3("Invalid PeerId",codes$1.ERR_INVALID_PARAMETERS);const s=o.toCID().toString();return new Key(`${NAMESPACE_COMMON}${s}`)}async function dedupeFilterAndSortAddresses(o,s,a){const et=new Map;for(const tt of a){if(tt==null)continue;if(tt.multiaddr instanceof Uint8Array&&(tt.multiaddr=multiaddr(tt.multiaddr)),!isMultiaddr(tt.multiaddr))throw new CodeError$3("Multiaddr was invalid",codes$1.ERR_INVALID_PARAMETERS);if(!await s(o,tt.multiaddr))continue;const rt=tt.isCertified??!1,nt=tt.multiaddr.toString(),it=et.get(nt);it!=null?tt.isCertified=it.isCertified||rt:et.set(nt,{multiaddr:tt.multiaddr,isCertified:rt})}return[...et.values()].sort((tt,rt)=>tt.multiaddr.toString().localeCompare(rt.multiaddr.toString())).map(({isCertified:tt,multiaddr:rt})=>({isCertified:tt,multiaddr:rt.bytes}))}async function toPeerPB(o,s,a,et){if(s==null)throw new CodeError$3("Invalid PeerData",codes$1.ERR_INVALID_PARAMETERS);if(s.publicKey!=null&&o.publicKey!=null&&!equals$1(s.publicKey,o.publicKey))throw new CodeError$3("publicKey bytes do not match peer id publicKey bytes",codes$1.ERR_INVALID_PARAMETERS);const tt=et.existingPeer;if(tt!=null&&!o.equals(tt.id))throw new CodeError$3("peer id did not match existing peer id",codes$1.ERR_INVALID_PARAMETERS);let rt=tt?.addresses??[],nt=new Set(tt?.protocols??[]),it=tt?.metadata??new Map,st=tt?.tags??new Map,ot=tt?.peerRecordEnvelope;if(a==="patch"){if((s.multiaddrs!=null||s.addresses!=null)&&(rt=[],s.multiaddrs!=null&&rt.push(...s.multiaddrs.map(lt=>({isCertified:!1,multiaddr:lt}))),s.addresses!=null&&rt.push(...s.addresses)),s.protocols!=null&&(nt=new Set(s.protocols)),s.metadata!=null){const lt=s.metadata instanceof Map?[...s.metadata.entries()]:Object.entries(s.metadata);it=createSortedMap(lt,{validate:validateMetadata})}if(s.tags!=null){const lt=s.tags instanceof Map?[...s.tags.entries()]:Object.entries(s.tags);st=createSortedMap(lt,{validate:validateTag,map:mapTag})}s.peerRecordEnvelope!=null&&(ot=s.peerRecordEnvelope)}if(a==="merge"){if(s.multiaddrs!=null&&rt.push(...s.multiaddrs.map(lt=>({isCertified:!1,multiaddr:lt}))),s.addresses!=null&&rt.push(...s.addresses),s.protocols!=null&&(nt=new Set([...nt,...s.protocols])),s.metadata!=null){const lt=s.metadata instanceof Map?[...s.metadata.entries()]:Object.entries(s.metadata);for(const[ct,ht]of lt)ht==null?it.delete(ct):it.set(ct,ht);it=createSortedMap([...it.entries()],{validate:validateMetadata})}if(s.tags!=null){const lt=s.tags instanceof Map?[...s.tags.entries()]:Object.entries(s.tags),ct=new Map(st);for(const[ht,ft]of lt)ft==null?ct.delete(ht):ct.set(ht,ft);st=createSortedMap([...ct.entries()],{validate:validateTag,map:mapTag})}s.peerRecordEnvelope!=null&&(ot=s.peerRecordEnvelope)}const at={addresses:await dedupeFilterAndSortAddresses(o,et.addressFilter??(async()=>!0),rt),protocols:[...nt.values()].sort((lt,ct)=>lt.localeCompare(ct)),metadata:it,tags:st,publicKey:tt?.id.publicKey??s.publicKey??o.publicKey,peerRecordEnvelope:ot};return o.type!=="RSA"&&delete at.publicKey,at}function createSortedMap(o,s){const a=new Map;for(const[et,tt]of o)tt!=null&&s.validate(et,tt);for(const[et,tt]of o.sort(([rt],[nt])=>rt.localeCompare(nt)))tt!=null&&a.set(et,s.map?.(et,tt)??tt);return a}function validateMetadata(o,s){if(typeof o!="string")throw new CodeError$3("Metadata key must be a string",codes$1.ERR_INVALID_PARAMETERS);if(!(s instanceof Uint8Array))throw new CodeError$3("Metadata value must be a Uint8Array",codes$1.ERR_INVALID_PARAMETERS)}function validateTag(o,s){if(typeof o!="string")throw new CodeError$3("Tag name must be a string",codes$1.ERR_INVALID_PARAMETERS);if(s.value!=null){if(parseInt(`${s.value}`,10)!==s.value)throw new CodeError$3("Tag value must be an integer",codes$1.ERR_INVALID_PARAMETERS);if(s.value<0||s.value>100)throw new CodeError$3("Tag value must be between 0-100",codes$1.ERR_INVALID_PARAMETERS)}if(s.ttl!=null){if(parseInt(`${s.ttl}`,10)!==s.ttl)throw new CodeError$3("Tag ttl must be an integer",codes$1.ERR_INVALID_PARAMETERS);if(s.ttl<0)throw new CodeError$3("Tag ttl must be between greater than 0",codes$1.ERR_INVALID_PARAMETERS)}}function mapTag(o,s){let a;return s.expiry!=null&&(a=s.expiry),s.ttl!=null&&(a=BigInt(Date.now()+Number(s.ttl))),{value:s.value??0,expiry:a}}function decodePeer(o,s,a){const et=o.toString().split("/")[2],tt=base32.decode(et),rt=peerIdFromBytes(tt),nt=a.get(rt);if(nt!=null)return nt;const it=bytesToPeer(rt,s);return a.set(rt,it),it}function mapQuery(o,s){return o==null?{}:{prefix:NAMESPACE_COMMON,filters:(o.filters??[]).map(a=>({key:et,value:tt})=>a(decodePeer(et,tt,s))),orders:(o.orders??[]).map(a=>(et,tt)=>a(decodePeer(et.key,et.value,s),decodePeer(tt.key,tt.value,s)))}}class PersistentStore{peerId;datastore;lock;addressFilter;constructor(s,a={}){this.peerId=s.peerId,this.datastore=s.datastore,this.addressFilter=a.addressFilter,this.lock=createMortice({name:"peer-store",singleProcess:!0})}async has(s){return this.datastore.has(peerIdToDatastoreKey(s))}async delete(s){if(this.peerId.equals(s))throw new CodeError$3("Cannot delete self peer",codes$1.ERR_INVALID_PARAMETERS);await this.datastore.delete(peerIdToDatastoreKey(s))}async load(s){const a=await this.datastore.get(peerIdToDatastoreKey(s));return bytesToPeer(s,a)}async save(s,a){const{existingBuf:et,existingPeer:tt}=await this.#e(s),rt=await toPeerPB(s,a,"patch",{addressFilter:this.addressFilter});return this.#t(s,rt,et,tt)}async patch(s,a){const{existingBuf:et,existingPeer:tt}=await this.#e(s),rt=await toPeerPB(s,a,"patch",{addressFilter:this.addressFilter,existingPeer:tt});return this.#t(s,rt,et,tt)}async merge(s,a){const{existingBuf:et,existingPeer:tt}=await this.#e(s),rt=await toPeerPB(s,a,"merge",{addressFilter:this.addressFilter,existingPeer:tt});return this.#t(s,rt,et,tt)}async*all(s){const a=new PeerMap;for await(const{key:et,value:tt}of this.datastore.query(mapQuery(s??{},a))){const rt=decodePeer(et,tt,a);rt.id.equals(this.peerId)||(yield rt)}}async#e(s){try{const a=await this.datastore.get(peerIdToDatastoreKey(s)),et=bytesToPeer(s,a);return{existingBuf:a,existingPeer:et}}catch(a){if(a.code!=="ERR_NOT_FOUND")throw a}return{}}async#t(s,a,et,tt){const rt=Peer$1.encode(a);return et!=null&&equals$1(rt,et)?{peer:bytesToPeer(s,rt),previous:tt,updated:!1}:(await this.datastore.put(peerIdToDatastoreKey(s),rt),{peer:bytesToPeer(s,rt),previous:tt,updated:!0})}}class PersistentPeerStore{store;events;peerId;log;constructor(s,a={}){this.log=s.logger.forComponent("libp2p:peer-store"),this.events=s.events,this.peerId=s.peerId,this.store=new PersistentStore(s,a)}[Symbol.toStringTag]="@libp2p/peer-store";async forEach(s,a){this.log.trace("forEach await read lock");const et=await this.store.lock.readLock();this.log.trace("forEach got read lock");try{for await(const tt of this.store.all(a))s(tt)}finally{this.log.trace("forEach release read lock"),et()}}async all(s){this.log.trace("all await read lock");const a=await this.store.lock.readLock();this.log.trace("all got read lock");try{return await all$1(this.store.all(s))}finally{this.log.trace("all release read lock"),a()}}async delete(s){this.log.trace("delete await write lock");const a=await this.store.lock.writeLock();this.log.trace("delete got write lock");try{await this.store.delete(s)}finally{this.log.trace("delete release write lock"),a()}}async has(s){this.log.trace("has await read lock");const a=await this.store.lock.readLock();this.log.trace("has got read lock");try{return await this.store.has(s)}finally{this.log.trace("has release read lock"),a()}}async get(s){this.log.trace("get await read lock");const a=await this.store.lock.readLock();this.log.trace("get got read lock");try{return await this.store.load(s)}finally{this.log.trace("get release read lock"),a()}}async save(s,a){this.log.trace("save await write lock");const et=await this.store.lock.writeLock();this.log.trace("save got write lock");try{const tt=await this.store.save(s,a);return this.#e(s,tt),tt.peer}finally{this.log.trace("save release write lock"),et()}}async patch(s,a){this.log.trace("patch await write lock");const et=await this.store.lock.writeLock();this.log.trace("patch got write lock");try{const tt=await this.store.patch(s,a);return this.#e(s,tt),tt.peer}finally{this.log.trace("patch release write lock"),et()}}async merge(s,a){this.log.trace("merge await write lock");const et=await this.store.lock.writeLock();this.log.trace("merge got write lock");try{const tt=await this.store.merge(s,a);return this.#e(s,tt),tt.peer}finally{this.log.trace("merge release write lock"),et()}}async consumePeerRecord(s,a){const et=await RecordEnvelope.openAndCertify(s,PeerRecord.DOMAIN);if(a?.equals(et.peerId)===!1)return this.log("envelope peer id was not the expected peer id - expected: %p received: %p",a,et.peerId),!1;const tt=PeerRecord.createFromProtobuf(et.payload);let rt;try{rt=await this.get(et.peerId)}catch(nt){if(nt.code!=="ERR_NOT_FOUND")throw nt}if(rt?.peerRecordEnvelope!=null){const nt=await RecordEnvelope.createFromProtobuf(rt.peerRecordEnvelope),it=PeerRecord.createFromProtobuf(nt.payload);if(it.seqNumber>=tt.seqNumber)return this.log("sequence number was lower or equal to existing sequence number - stored: %d received: %d",it.seqNumber,tt.seqNumber),!1}return await this.patch(tt.peerId,{peerRecordEnvelope:s,addresses:tt.multiaddrs.map(nt=>({isCertified:!0,multiaddr:nt}))}),!0}#e(s,a){a.updated&&(this.peerId.equals(s)?this.events.safeDispatchEvent("self:peer:update",{detail:a}):this.events.safeDispatchEvent("peer:update",{detail:a}))}}function allocUnsafe$6(o=0){return new Uint8Array(o)}function asUint8Array$4(o){return o}function concat$3(o,s){s==null&&(s=o.reduce((tt,rt)=>tt+rt.length,0));const a=allocUnsafe$6(s);let et=0;for(const tt of o)a.set(tt,et),et+=tt.length;return a}function createCodec$6(o,s,a,et){return{name:o,prefix:s,encoder:{name:o,prefix:s,encode:a},decoder:{decode:et}}}const string$6=createCodec$6("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),ascii$6=createCodec$6("ascii","a",o=>{let s="a";for(let a=0;a<o.length;a++)s+=String.fromCharCode(o[a]);return s},o=>{o=o.substring(1);const s=allocUnsafe$6(o.length);for(let a=0;a<o.length;a++)s[a]=o.charCodeAt(a);return s}),BASES$6={utf8:string$6,"utf-8":string$6,hex:bases.base16,latin1:ascii$6,ascii:ascii$6,binary:ascii$6,...bases};function fromString$6(o,s="utf8"){const a=BASES$6[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.decoder.decode(`${a.prefix}${o}`)}function debounce$1(o,s){let a;return function(){const et=function(){a=void 0,o()};clearTimeout(a),a=setTimeout(et,s)}}const defaultAddressFilter=o=>o;function stripPeerId(o,s){const a=o.getPeerId();return a!=null&&peerIdFromString(a).equals(s)&&(o=o.decapsulate(multiaddr(`/p2p/${s.toString()}`))),o}class DefaultAddressManager{log;components;listen;announce;observed;announceFilter;constructor(s,a={}){const{listen:et=[],announce:tt=[]}=a;this.components=s,this.log=s.logger.forComponent("libp2p:address-manager"),this.listen=et.map(rt=>rt.toString()),this.announce=new Set(tt.map(rt=>rt.toString())),this.observed=new Map,this.announceFilter=a.announceFilter??defaultAddressFilter,this._updatePeerStoreAddresses=debounce$1(this._updatePeerStoreAddresses.bind(this),1e3),s.events.addEventListener("transport:listening",()=>{this._updatePeerStoreAddresses()}),s.events.addEventListener("transport:close",()=>{this._updatePeerStoreAddresses()})}[Symbol.toStringTag]="@libp2p/address-manager";_updatePeerStoreAddresses(){const s=this.getAnnounceAddrs().concat(this.components.transportManager.getAddrs()).concat([...this.observed.entries()].filter(([a,et])=>et.confident).map(([a])=>multiaddr(a))).map(a=>a.getPeerId()===this.components.peerId.toString()?a.decapsulate(`/p2p/${this.components.peerId.toString()}`):a);this.components.peerStore.patch(this.components.peerId,{multiaddrs:s}).catch(a=>{this.log.error("error updating addresses",a)})}getListenAddrs(){return Array.from(this.listen).map(s=>multiaddr(s))}getAnnounceAddrs(){return Array.from(this.announce).map(s=>multiaddr(s))}getObservedAddrs(){return Array.from(this.observed).map(([s])=>multiaddr(s))}addObservedAddr(s){s=stripPeerId(s,this.components.peerId);const a=s.toString();this.observed.has(a)||this.observed.set(a,{confident:!1})}confirmObservedAddr(s){s=stripPeerId(s,this.components.peerId);const a=s.toString(),tt=(this.observed.get(a)??{confident:!1}).confident;this.observed.set(a,{confident:!0}),tt||this._updatePeerStoreAddresses()}removeObservedAddr(s){s=stripPeerId(s,this.components.peerId);const a=s.toString();this.observed.delete(a)}getAddresses(){let s=this.getAnnounceAddrs().map(et=>et.toString());s.length===0&&(s=this.components.transportManager.getAddrs().map(et=>et.toString())),s=s.concat(Array.from(this.observed).filter(([et,tt])=>tt.confident).map(([et])=>et));const a=new Set(s);return this.announceFilter(Array.from(a).map(et=>multiaddr(et))).map(et=>et.protos().pop()?.path===!0||et.getPeerId()===this.components.peerId.toString()?et:et.encapsulate(`/p2p/${this.components.peerId.toString()}`))}}class DefaultComponents{components={};_started=!1;constructor(s={}){this.components={};for(const[a,et]of Object.entries(s))this.components[a]=et;this.components.logger==null&&(this.components.logger=defaultLogger())}isStarted(){return this._started}async _invokeStartableMethod(s){await Promise.all(Object.values(this.components).filter(a=>isStartable(a)).map(async a=>{await a[s]?.()}))}async beforeStart(){await this._invokeStartableMethod("beforeStart")}async start(){await this._invokeStartableMethod("start"),this._started=!0}async afterStart(){await this._invokeStartableMethod("afterStart")}async beforeStop(){await this._invokeStartableMethod("beforeStop")}async stop(){await this._invokeStartableMethod("stop"),this._started=!1}async afterStop(){await this._invokeStartableMethod("afterStop")}}const OPTIONAL_SERVICES=["metrics","connectionProtector","dns"],NON_SERVICE_PROPERTIES=["components","isStarted","beforeStart","start","afterStart","beforeStop","stop","afterStop","then","_invokeStartableMethod"];function defaultComponents(o={}){const s=new DefaultComponents(o);return new Proxy(s,{get(et,tt,rt){if(typeof tt=="string"&&!NON_SERVICE_PROPERTIES.includes(tt)){const nt=s.components[tt];if(nt==null&&!OPTIONAL_SERVICES.includes(tt))throw new CodeError$3(`${tt} not set`,"ERR_SERVICE_MISSING");return nt}return Reflect.get(et,tt,rt)},set(et,tt,rt){return typeof tt=="string"?s.components[tt]=rt:Reflect.set(et,tt,rt),!0}})}function checkServiceDependencies(o){const s={};for(const a of Object.values(o.components))for(const et of getServiceCapabilities(a))s[et]=!0;for(const a of Object.values(o.components))for(const et of getServiceDependencies(a))if(s[et]!==!0)throw new CodeError$3(`Service "${getServiceName(a)}" required capability "${et}" but it was not provided by any component, you may need to add additional configuration when creating your node.`,"ERR_UNMET_SERVICE_DEPENDENCIES")}function getServiceCapabilities(o){return Array.isArray(o?.[serviceCapabilities])?o[serviceCapabilities]:[]}function getServiceDependencies(o){return Array.isArray(o?.[serviceDependencies])?o[serviceDependencies]:[]}function getServiceName(o){return o?.[Symbol.toStringTag]??o?.toString()??"unknown"}function connectionGater(o={}){return{denyDialPeer:async()=>!1,denyDialMultiaddr:async s=>{const a=s.stringTuples();return a[0][0]===4||a[0][0]===41?!!isPrivateIp(`${a[0][1]}`):!1},denyInboundConnection:async()=>!1,denyOutboundConnection:async()=>!1,denyInboundEncryptedConnection:async()=>!1,denyOutboundEncryptedConnection:async()=>!1,denyInboundUpgradedConnection:async()=>!1,denyOutboundUpgradedConnection:async()=>!1,filterMultiaddrForPeer:async()=>!0,...o}}function isPrivate(o){try{const{address:s}=o.nodeAddress();return!!isPrivateIp(s)}catch{return!0}}function publicAddressesFirst(o,s){const a=isPrivate(o.multiaddr),et=isPrivate(s.multiaddr);return a&&!et?1:!a&&et?-1:0}function certifiedAddressesFirst(o,s){return o.isCertified&&!s.isCertified?-1:!o.isCertified&&s.isCertified?1:0}function circuitRelayAddressesLast(o,s){const a=Circuit$1.exactMatch(o.multiaddr),et=Circuit$1.exactMatch(s.multiaddr);return a&&!et?1:!a&&et?-1:0}function defaultAddressSort(o,s){const a=publicAddressesFirst(o,s);if(a!==0)return a;const et=circuitRelayAddressesLast(o,s);return et!==0?et:certifiedAddressesFirst(o,s)}const MAX_RECURSIVE_DEPTH=32,{code:dnsaddrCode}=getProtocol("dnsaddr"),dnsaddrResolver=async function(s,a={}){const et=a.maxRecursiveDepth??MAX_RECURSIVE_DEPTH;if(et===0)throw new CodeError$3("Max recursive depth reached","ERR_MAX_RECURSIVE_DEPTH_REACHED");const[,tt]=s.stringTuples().find(([ot])=>ot===dnsaddrCode)??[],nt=await(a?.dns??dns()).query(`_dnsaddr.${tt}`,{signal:a?.signal,types:[RecordType.TXT]}),it=s.getPeerId(),st=[];for(const ot of nt.Answer){const at=ot.data.replace(/["']/g,"").trim().split("=")[1];if(at==null||it!=null&&!at.includes(it))continue;const lt=multiaddr(at);if(at.startsWith("/dnsaddr")){const ct=await lt.resolve({...a,maxRecursiveDepth:et-1});st.push(...ct.map(ht=>ht.toString()))}else st.push(lt.toString())}return st};var messages;(function(o){o.NOT_STARTED_YET="The libp2p node is not started yet",o.ERR_PROTECTOR_REQUIRED="Private network is enforced, but no protector was provided",o.NOT_FOUND="Not found"})(messages||(messages={}));var codes;(function(o){o.ERR_PROTECTOR_REQUIRED="ERR_PROTECTOR_REQUIRED",o.ERR_PEER_DIAL_INTERCEPTED="ERR_PEER_DIAL_INTERCEPTED",o.ERR_CONNECTION_INTERCEPTED="ERR_CONNECTION_INTERCEPTED",o.ERR_INVALID_PROTOCOLS_FOR_STREAM="ERR_INVALID_PROTOCOLS_FOR_STREAM",o.ERR_CONNECTION_ENDED="ERR_CONNECTION_ENDED",o.ERR_CONNECTION_FAILED="ERR_CONNECTION_FAILED",o.ERR_NODE_NOT_STARTED="ERR_NODE_NOT_STARTED",o.ERR_ALREADY_ABORTED="ERR_ALREADY_ABORTED",o.ERR_TOO_MANY_ADDRESSES="ERR_TOO_MANY_ADDRESSES",o.ERR_NO_VALID_ADDRESSES="ERR_NO_VALID_ADDRESSES",o.ERR_RELAYED_DIAL="ERR_RELAYED_DIAL",o.ERR_DIALED_SELF="ERR_DIALED_SELF",o.ERR_DISCOVERED_SELF="ERR_DISCOVERED_SELF",o.ERR_DUPLICATE_TRANSPORT="ERR_DUPLICATE_TRANSPORT",o.ERR_ENCRYPTION_FAILED="ERR_ENCRYPTION_FAILED",o.ERR_HOP_REQUEST_FAILED="ERR_HOP_REQUEST_FAILED",o.ERR_INVALID_KEY="ERR_INVALID_KEY",o.ERR_INVALID_MESSAGE="ERR_INVALID_MESSAGE",o.ERR_INVALID_PARAMETERS="ERR_INVALID_PARAMETERS",o.ERR_INVALID_PEER="ERR_INVALID_PEER",o.ERR_MUXER_UNAVAILABLE="ERR_MUXER_UNAVAILABLE",o.ERR_NOT_FOUND="ERR_NOT_FOUND",o.ERR_TRANSPORT_UNAVAILABLE="ERR_TRANSPORT_UNAVAILABLE",o.ERR_TRANSPORT_DIAL_FAILED="ERR_TRANSPORT_DIAL_FAILED",o.ERR_UNSUPPORTED_PROTOCOL="ERR_UNSUPPORTED_PROTOCOL",o.ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED="ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED",o.ERR_INVALID_MULTIADDR="ERR_INVALID_MULTIADDR",o.ERR_SIGNATURE_NOT_VALID="ERR_SIGNATURE_NOT_VALID",o.ERR_FIND_SELF="ERR_FIND_SELF",o.ERR_NO_ROUTERS_AVAILABLE="ERR_NO_ROUTERS_AVAILABLE",o.ERR_CONNECTION_NOT_MULTIPLEXED="ERR_CONNECTION_NOT_MULTIPLEXED",o.ERR_NO_DIAL_TOKENS="ERR_NO_DIAL_TOKENS",o.ERR_INVALID_CMS="ERR_INVALID_CMS",o.ERR_MISSING_KEYS="ERR_MISSING_KEYS",o.ERR_NO_KEY="ERR_NO_KEY",o.ERR_INVALID_KEY_NAME="ERR_INVALID_KEY_NAME",o.ERR_INVALID_KEY_TYPE="ERR_INVALID_KEY_TYPE",o.ERR_KEY_ALREADY_EXISTS="ERR_KEY_ALREADY_EXISTS",o.ERR_INVALID_KEY_SIZE="ERR_INVALID_KEY_SIZE",o.ERR_KEY_NOT_FOUND="ERR_KEY_NOT_FOUND",o.ERR_OLD_KEY_NAME_INVALID="ERR_OLD_KEY_NAME_INVALID",o.ERR_NEW_KEY_NAME_INVALID="ERR_NEW_KEY_NAME_INVALID",o.ERR_PASSWORD_REQUIRED="ERR_PASSWORD_REQUIRED",o.ERR_PEM_REQUIRED="ERR_PEM_REQUIRED",o.ERR_CANNOT_READ_KEY="ERR_CANNOT_READ_KEY",o.ERR_MISSING_PRIVATE_KEY="ERR_MISSING_PRIVATE_KEY",o.ERR_MISSING_PUBLIC_KEY="ERR_MISSING_PUBLIC_KEY",o.ERR_INVALID_OLD_PASS_TYPE="ERR_INVALID_OLD_PASS_TYPE",o.ERR_INVALID_NEW_PASS_TYPE="ERR_INVALID_NEW_PASS_TYPE",o.ERR_INVALID_PASS_LENGTH="ERR_INVALID_PASS_LENGTH",o.ERR_NOT_IMPLEMENTED="ERR_NOT_IMPLEMENTED",o.ERR_WRONG_PING_ACK="ERR_WRONG_PING_ACK",o.ERR_INVALID_RECORD="ERR_INVALID_RECORD",o.ERR_ALREADY_SUCCEEDED="ERR_ALREADY_SUCCEEDED",o.ERR_NO_HANDLER_FOR_PROTOCOL="ERR_NO_HANDLER_FOR_PROTOCOL",o.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS",o.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS",o.ERR_CONNECTION_DENIED="ERR_CONNECTION_DENIED",o.ERR_TRANSFER_LIMIT_EXCEEDED="ERR_TRANSFER_LIMIT_EXCEEDED"})(codes||(codes={}));const DefaultConfig={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:o=>o},connectionManager:{resolvers:{dnsaddr:dnsaddrResolver},addressSorter:defaultAddressSort},transportManager:{faultTolerance:FaultTolerance.FATAL_ALL}};async function validateConfig(o){const s=mergeOptions$9(DefaultConfig,o);if(s.connectionProtector===null&&globalThis.process?.env?.LIBP2P_FORCE_PNET!=null)throw new CodeError$3(messages.ERR_PROTECTOR_REQUIRED,codes.ERR_PROTECTOR_REQUIRED);if(s.privateKey!=null&&!(await peerIdFromKeys(s.privateKey.public.bytes,s.privateKey.bytes)).equals(s.peerId))throw new CodeError$3("Private key doesn't match peer id",codes.ERR_INVALID_KEY);return s}function getPeerAddress(o){if(isPeerId(o))return{peerId:o,multiaddrs:[]};Array.isArray(o)||(o=[o]);let s;if(o.length>0){const a=o[0].getPeerId();s=a==null?void 0:peerIdFromString(a),o.forEach(et=>{if(!isMultiaddr(et))throw new CodeError$3("Invalid Multiaddr",codes.ERR_INVALID_MULTIADDR);const tt=et.getPeerId();if(tt==null){if(s!=null)throw new CodeError$3("Multiaddrs must all have the same peer id or have no peer id",codes.ERR_INVALID_PARAMETERS)}else{const rt=peerIdFromString(tt);if(s==null||!s.equals(rt))throw new CodeError$3("Multiaddrs must all have the same peer id or have no peer id",codes.ERR_INVALID_PARAMETERS)}})}return{peerId:s,multiaddrs:o}}function toString$2(o,s="utf8"){const a=BASES$6[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.encoder.encode(o).substring(1)}const DIAL_TIMEOUT=5e3,INBOUND_UPGRADE_TIMEOUT=2e3,MAX_PEER_ADDRS_TO_DIAL=25,AUTO_DIAL_INTERVAL=5e3,AUTO_DIAL_CONCURRENCY=25,AUTO_DIAL_PRIORITY=0,AUTO_DIAL_MAX_QUEUE_LENGTH=100,AUTO_DIAL_DISCOVERED_PEERS_DEBOUNCE=10,INBOUND_CONNECTION_THRESHOLD=5,MAX_INCOMING_PENDING_CONNECTIONS=10,LAST_DIAL_FAILURE_KEY="last-dial-failure",MAX_DIAL_QUEUE_LENGTH=500,MIN_CONNECTIONS=5,MAX_CONNECTIONS=100,MAX_PARALLEL_DIALS=50,AUTO_DIAL_PEER_RETRY_THRESHOLD=1e3*60*7,defaultOptions$b={minConnections:MIN_CONNECTIONS,maxQueueLength:AUTO_DIAL_MAX_QUEUE_LENGTH,autoDialConcurrency:AUTO_DIAL_CONCURRENCY,autoDialPriority:AUTO_DIAL_PRIORITY,autoDialInterval:AUTO_DIAL_INTERVAL,autoDialPeerRetryThreshold:AUTO_DIAL_PEER_RETRY_THRESHOLD,autoDialDiscoveredPeersDebounce:AUTO_DIAL_DISCOVERED_PEERS_DEBOUNCE};class AutoDial{connectionManager;peerStore;queue;minConnections;autoDialPriority;autoDialIntervalMs;autoDialMaxQueueLength;autoDialPeerRetryThresholdMs;autoDialDiscoveredPeersDebounce;autoDialInterval;started;running;log;constructor(s,a){this.connectionManager=s.connectionManager,this.peerStore=s.peerStore,this.minConnections=a.minConnections??defaultOptions$b.minConnections,this.autoDialPriority=a.autoDialPriority??defaultOptions$b.autoDialPriority,this.autoDialIntervalMs=a.autoDialInterval??defaultOptions$b.autoDialInterval,this.autoDialMaxQueueLength=a.maxQueueLength??defaultOptions$b.maxQueueLength,this.autoDialPeerRetryThresholdMs=a.autoDialPeerRetryThreshold??defaultOptions$b.autoDialPeerRetryThreshold,this.autoDialDiscoveredPeersDebounce=a.autoDialDiscoveredPeersDebounce??defaultOptions$b.autoDialDiscoveredPeersDebounce,this.log=s.logger.forComponent("libp2p:connection-manager:auto-dial"),this.started=!1,this.running=!1,this.queue=new PeerQueue({concurrency:a.autoDialConcurrency??defaultOptions$b.autoDialConcurrency,metricName:"libp2p_autodial_queue",metrics:s.metrics}),this.queue.addEventListener("error",tt=>{this.log.error("error during auto-dial",tt.detail)}),s.events.addEventListener("connection:close",()=>{this.autoDial().catch(tt=>{this.log.error(tt)})});let et;s.events.addEventListener("peer:discovery",()=>{clearTimeout(et),et=setTimeout(()=>{this.autoDial().catch(tt=>{this.log.error(tt)})},this.autoDialDiscoveredPeersDebounce)})}isStarted(){return this.started}start(){this.started=!0}afterStart(){this.autoDial().catch(s=>{this.log.error("error while autodialing",s)})}stop(){this.queue.clear(),clearTimeout(this.autoDialInterval),this.started=!1,this.running=!1}async autoDial(){if(!this.started||this.running)return;const s=this.connectionManager.getConnectionsMap(),a=s.size;if(a>=this.minConnections){this.minConnections>0&&this.log.trace("have enough connections %d/%d",a,this.minConnections);return}if(this.queue.size>this.autoDialMaxQueueLength){this.log("not enough connections %d/%d but auto dial queue is full",a,this.minConnections),this.sheduleNextAutodial();return}this.running=!0,this.log("not enough connections %d/%d - will dial peers to increase the number of connections",a,this.minConnections);const et=new PeerSet(this.connectionManager.getDialQueue().map(ot=>ot.peerId).filter(Boolean)),tt=await this.peerStore.all({filters:[ot=>ot.addresses.length===0?(this.log.trace("not autodialing %p because they have no addresses",ot.id),!1):s.has(ot.id)?(this.log.trace("not autodialing %p because they are already connected",ot.id),!1):et.has(ot.id)?(this.log.trace("not autodialing %p because they are already being dialed",ot.id),!1):this.queue.has(ot.id)?(this.log.trace("not autodialing %p because they are already being autodialed",ot.id),!1):!0]}),rt=tt.sort(()=>Math.random()>.5?1:-1),nt=new PeerMap;for(const ot of rt)nt.has(ot.id)||nt.set(ot.id,[...ot.tags.values()].reduce((at,lt)=>at+lt.value,0));const st=rt.sort((ot,at)=>{const lt=nt.get(ot.id)??0,ct=nt.get(at.id)??0;return lt>ct?-1:lt<ct?1:0}).filter(ot=>{const at=ot.metadata.get(LAST_DIAL_FAILURE_KEY);if(at==null)return!0;const lt=parseInt(toString$2(at));return isNaN(lt)?!0:Date.now()-lt>this.autoDialPeerRetryThresholdMs});this.log("selected %d/%d peers to dial",st.length,tt.length);for(const ot of st)this.queue.add(async()=>{const at=this.connectionManager.getConnectionsMap().size;if(at>=this.minConnections){this.log("got enough connections now %d/%d",at,this.minConnections),this.queue.clear();return}this.log("connecting to a peerStore stored peer %p",ot.id),await this.connectionManager.openConnection(ot.id,{priority:this.autoDialPriority})},{peerId:ot.id}).catch(at=>{this.log.error("could not connect to peerStore stored peer",at)});this.running=!1,this.sheduleNextAutodial()}sheduleNextAutodial(){this.started&&(this.autoDialInterval=setTimeout(()=>{this.autoDial().catch(s=>{this.log.error("error while autodialing",s)})},this.autoDialIntervalMs))}}const DEFAULT_CLOSABLE_PROTOCOLS=["/ipfs/id/1.0.0","/ipfs/id/push/1.0.0","/libp2p/autonat/1.0.0","/libp2p/dcutr"];async function safelyCloseConnectionIfUnused(o,s){const a=o?.streams?.map(tt=>tt.protocol)??[],et=s?.closableProtocols??DEFAULT_CLOSABLE_PROTOCOLS;if(!(a.filter(tt=>tt!=null&&!et.includes(tt)).length>0))try{await o?.close(s)}catch(tt){o?.abort(tt)}}const defaultOptions$a={maxConnections:MAX_CONNECTIONS,allow:[]};class ConnectionPruner{maxConnections;connectionManager;peerStore;allow;events;log;constructor(s,a={}){this.maxConnections=a.maxConnections??defaultOptions$a.maxConnections,this.allow=a.allow??defaultOptions$a.allow,this.connectionManager=s.connectionManager,this.peerStore=s.peerStore,this.events=s.events,this.log=s.logger.forComponent("libp2p:connection-manager:connection-pruner"),s.events.addEventListener("connection:open",()=>{this.maybePruneConnections().catch(et=>{this.log.error(et)})})}async maybePruneConnections(){const s=this.connectionManager.getConnections(),a=s.length;if(this.log("checking max connections limit %d/%d",a,this.maxConnections),a<=this.maxConnections)return;const et=new PeerMap;for(const it of s){const st=it.remotePeer;if(!et.has(st)){et.set(st,0);try{const ot=await this.peerStore.get(st);et.set(st,[...ot.tags.values()].reduce((at,lt)=>at+lt.value,0))}catch(ot){ot.code!=="ERR_NOT_FOUND"&&this.log.error("error loading peer tags",ot)}}}const tt=this.sortConnections(s,et),rt=Math.max(a-this.maxConnections,0),nt=[];for(const it of tt)if(this.log("too many connections open - closing a connection to %p",it.remotePeer),this.allow.some(ot=>it.remoteAddr.toString().startsWith(ot.toString()))||nt.push(it),nt.length===rt)break;await Promise.all(nt.map(async it=>{await safelyCloseConnectionIfUnused(it,{signal:AbortSignal.timeout(1e3)})})),this.events.safeDispatchEvent("connection:prune",{detail:nt})}sortConnections(s,a){return s.sort((et,tt)=>{const rt=et.timeline.open,nt=tt.timeline.open;return rt<nt?1:rt>nt?-1:0}).sort((et,tt)=>et.direction==="outbound"&&tt.direction==="inbound"?1:et.direction==="inbound"&&tt.direction==="outbound"?-1:0).sort((et,tt)=>et.streams.length>tt.streams.length?1:et.streams.length<tt.streams.length?-1:0).sort((et,tt)=>{const rt=a.get(et.remotePeer)??0,nt=a.get(tt.remotePeer)??0;return rt>nt?1:rt<nt?-1:0})}}class PriorityQueue extends Queue{constructor(s={}){super({...s,sort:(a,et)=>a.options.priority>et.options.priority?-1:a.options.priority<et.options.priority?1:0})}}async function resolveMultiaddrs(o,s){let a=!1;for(const tt of resolvers$1.keys())if(a=o.protoNames().includes(tt),a)break;if(!a)return[o];const et=await o.resolve(s);return s.log("resolved %s to",o,et.map(tt=>tt.toString())),et}const defaultOptions$9={addressSorter:defaultAddressSort,maxParallelDials:MAX_PARALLEL_DIALS,maxDialQueueLength:MAX_DIAL_QUEUE_LENGTH,maxPeerAddrsToDial:MAX_PEER_ADDRS_TO_DIAL,dialTimeout:DIAL_TIMEOUT,resolvers:{dnsaddr:dnsaddrResolver}};class DialQueue{queue;components;addressSorter;maxPeerAddrsToDial;maxDialQueueLength;dialTimeout;shutDownController;connections;log;constructor(s,a={}){this.addressSorter=a.addressSorter??defaultOptions$9.addressSorter,this.maxPeerAddrsToDial=a.maxPeerAddrsToDial??defaultOptions$9.maxPeerAddrsToDial,this.maxDialQueueLength=a.maxDialQueueLength??defaultOptions$9.maxDialQueueLength,this.dialTimeout=a.dialTimeout??defaultOptions$9.dialTimeout,this.connections=a.connections??new PeerMap,this.log=s.logger.forComponent("libp2p:connection-manager:dial-queue"),this.components=s,this.shutDownController=new AbortController,setMaxListeners(1/0,this.shutDownController.signal);for(const[et,tt]of Object.entries(a.resolvers??{}))resolvers$1.set(et,tt);this.queue=new PriorityQueue({concurrency:a.maxParallelDials??defaultOptions$9.maxParallelDials,metricName:"libp2p_dial_queue",metrics:s.metrics}),this.queue.addEventListener("error",et=>{this.log.error("error in dial queue",et.detail)})}start(){this.shutDownController=new AbortController,setMaxListeners(1/0,this.shutDownController.signal)}stop(){this.shutDownController.abort(),this.queue.abort()}async dial(s,a={}){const{peerId:et,multiaddrs:tt}=getPeerAddress(s),rt=Array.from(this.connections.values()).flat().find(it=>a.force===!0?!1:it.remotePeer.equals(et)?!0:tt.find(st=>st.equals(it.remoteAddr)));if(rt!=null)return this.log("already connected to %a",rt.remoteAddr),rt;const nt=this.queue.queue.find(it=>{if(et?.equals(it.options.peerId)===!0)return!0;const st=it.options.multiaddrs;if(st==null)return!1;for(const ot of tt)if(st.has(ot.toString()))return!0;return!1});if(nt!=null){this.log("joining existing dial target for %p",et);for(const it of tt)nt.options.multiaddrs.add(it.toString());return nt.join(a)}if(this.queue.size>=this.maxDialQueueLength)throw new CodeError$3("Dial queue is full","ERR_DIAL_QUEUE_FULL");return this.log("creating dial target for %p",et,tt.map(it=>it.toString())),this.queue.add(async it=>{const st=this.createDialAbortController(it?.signal);let ot;try{ot=await this.calculateMultiaddrs(et,it?.multiaddrs,{...it,signal:st}),ot.map(({multiaddr:at})=>at.toString()).forEach(at=>{it?.multiaddrs.add(at)})}catch(at){throw st.clear(),at}try{let at=0;const lt=[];for(const ct of ot){if(at===this.maxPeerAddrsToDial)throw this.log("dialed maxPeerAddrsToDial (%d) addresses for %p, not trying any others",at,et),new CodeError$3("Peer had more than maxPeerAddrsToDial",codes.ERR_TOO_MANY_ADDRESSES);at++;try{const ht=await this.components.transportManager.dial(ct.multiaddr,{...it,signal:st});return this.log("dial to %a succeeded",ct.multiaddr),ht}catch(ht){if(this.log.error("dial failed to %a",ct.multiaddr,ht),et!=null)try{await this.components.peerStore.patch(et,{metadata:{[LAST_DIAL_FAILURE_KEY]:fromString$6(Date.now().toString())}})}catch(ft){this.log.error("could not update last dial failure key for %p",et,ft)}if(st.aborted)throw new CodeError$3(ht.message,ERR_TIMEOUT);lt.push(ht)}}throw lt.length===1?lt[0]:new AggregateCodeError(lt,"All multiaddr dials failed",codes.ERR_TRANSPORT_DIAL_FAILED)}finally{st.clear()}},{peerId:et,priority:a.priority??DEFAULT_DIAL_PRIORITY,multiaddrs:new Set(tt.map(it=>it.toString())),signal:a.signal})}createDialAbortController(s){const a=anySignal([AbortSignal.timeout(this.dialTimeout),this.shutDownController.signal,s]);return setMaxListeners(1/0,a),a}async calculateMultiaddrs(s,a=new Set,et={}){const tt=[...a].map(lt=>({multiaddr:multiaddr(lt),isCertified:!1}));if(s!=null){if(this.components.peerId.equals(s))throw new CodeError$3("Tried to dial self",codes.ERR_DIALED_SELF);if(await this.components.connectionGater.denyDialPeer?.(s)===!0)throw new CodeError$3("The dial request is blocked by gater.allowDialPeer",codes.ERR_PEER_DIAL_INTERCEPTED);if(tt.length===0){this.log("loading multiaddrs for %p",s);try{const lt=await this.components.peerStore.get(s);tt.push(...lt.addresses),this.log("loaded multiaddrs for %p",s,tt.map(({multiaddr:ct})=>ct.toString()))}catch(lt){if(lt.code!==codes.ERR_NOT_FOUND)throw lt}}if(tt.length===0){this.log("looking up multiaddrs for %p in the peer routing",s);try{const lt=await this.components.peerRouting.findPeer(s);this.log("found multiaddrs for %p in the peer routing",s,tt.map(({multiaddr:ct})=>ct.toString())),tt.push(...lt.multiaddrs.map(ct=>({multiaddr:ct,isCertified:!1})))}catch(lt){lt.code!==codes.ERR_NO_ROUTERS_AVAILABLE&&this.log.error("looking up multiaddrs for %p in the peer routing failed",s,lt)}}}let rt=(await Promise.all(tt.map(async lt=>{const ct=await resolveMultiaddrs(lt.multiaddr,{dns:this.components.dns,...et,log:this.log});return ct.length===1&&ct[0].equals(lt.multiaddr)?lt:ct.map(ht=>({multiaddr:ht,isCertified:!1}))}))).flat();if(s!=null){const lt=`/p2p/${s.toString()}`;rt=rt.map(ct=>ct.multiaddr.protos().pop()?.path===!0?ct:ct.multiaddr.getPeerId()==null?{multiaddr:ct.multiaddr.encapsulate(lt),isCertified:ct.isCertified}:ct)}const nt=rt.filter(lt=>{if(this.components.transportManager.dialTransportForMultiaddr(lt.multiaddr)==null)return!1;const ct=lt.multiaddr.getPeerId();return s!=null&&ct!=null?s.equals(ct):!0}),it=new Map;for(const lt of nt){const ct=lt.multiaddr.toString(),ht=it.get(ct);if(ht!=null){ht.isCertified=ht.isCertified||lt.isCertified||!1;continue}it.set(ct,lt)}const st=[...it.values()];if(st.length===0)throw new CodeError$3("The dial request has no valid addresses",codes.ERR_NO_VALID_ADDRESSES);const ot=[];for(const lt of st)this.components.connectionGater.denyDialMultiaddr!=null&&await this.components.connectionGater.denyDialMultiaddr(lt.multiaddr)||ot.push(lt);const at=ot.sort(this.addressSorter);if(at.length===0)throw new CodeError$3("The connection gater denied all addresses in the dial request",codes.ERR_NO_VALID_ADDRESSES);return this.log.trace("addresses for %p before filtering",s??"unknown peer",rt.map(({multiaddr:lt})=>lt.toString())),this.log.trace("addresses for %p after filtering",s??"unknown peer",at.map(({multiaddr:lt})=>lt.toString())),at}async isDialable(s,a={}){Array.isArray(s)||(s=[s]);try{const et=await this.calculateMultiaddrs(void 0,new Set(s.map(tt=>tt.toString())),a);return a.runOnTransientConnection===!1?et.find(tt=>!Circuit$1.matches(tt.multiaddr))!=null:!0}catch(et){this.log.trace("error calculating if multiaddr(s) were dialable",et)}return!1}}const DEFAULT_DIAL_PRIORITY=50,defaultOptions$8={minConnections:MIN_CONNECTIONS,maxConnections:MAX_CONNECTIONS,inboundConnectionThreshold:INBOUND_CONNECTION_THRESHOLD,maxIncomingPendingConnections:MAX_INCOMING_PENDING_CONNECTIONS,autoDialConcurrency:AUTO_DIAL_CONCURRENCY,autoDialPriority:AUTO_DIAL_PRIORITY,autoDialMaxQueueLength:AUTO_DIAL_MAX_QUEUE_LENGTH,autoDialPeerRetryThreshold:AUTO_DIAL_PEER_RETRY_THRESHOLD,autoDialDiscoveredPeersDebounce:AUTO_DIAL_DISCOVERED_PEERS_DEBOUNCE};class DefaultConnectionManager{started;connections;allow;deny;maxIncomingPendingConnections;incomingPendingConnections;maxConnections;dialQueue;autoDial;connectionPruner;inboundConnectionRateLimiter;peerStore;metrics;events;log;constructor(s,a={}){this.maxConnections=a.maxConnections??defaultOptions$8.maxConnections;const et=a.minConnections??defaultOptions$8.minConnections;if(this.maxConnections<et)throw new CodeError$3("Connection Manager maxConnections must be greater than minConnections",codes.ERR_INVALID_PARAMETERS);this.connections=new PeerMap,this.started=!1,this.peerStore=s.peerStore,this.metrics=s.metrics,this.events=s.events,this.log=s.logger.forComponent("libp2p:connection-manager"),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.events.addEventListener("connection:open",this.onConnect),this.events.addEventListener("connection:close",this.onDisconnect),this.allow=(a.allow??[]).map(tt=>multiaddr(tt)),this.deny=(a.deny??[]).map(tt=>multiaddr(tt)),this.incomingPendingConnections=0,this.maxIncomingPendingConnections=a.maxIncomingPendingConnections??defaultOptions$8.maxIncomingPendingConnections,this.inboundConnectionRateLimiter=new RateLimiter({points:a.inboundConnectionThreshold??defaultOptions$8.inboundConnectionThreshold,duration:1}),this.autoDial=new AutoDial({connectionManager:this,peerStore:s.peerStore,events:s.events,logger:s.logger},{minConnections:et,autoDialConcurrency:a.autoDialConcurrency??defaultOptions$8.autoDialConcurrency,autoDialPriority:a.autoDialPriority??defaultOptions$8.autoDialPriority,autoDialPeerRetryThreshold:a.autoDialPeerRetryThreshold??defaultOptions$8.autoDialPeerRetryThreshold,autoDialDiscoveredPeersDebounce:a.autoDialDiscoveredPeersDebounce??defaultOptions$8.autoDialDiscoveredPeersDebounce,maxQueueLength:a.autoDialMaxQueueLength??defaultOptions$8.autoDialMaxQueueLength}),this.connectionPruner=new ConnectionPruner({connectionManager:this,peerStore:s.peerStore,events:s.events,logger:s.logger},{maxConnections:this.maxConnections,allow:this.allow}),this.dialQueue=new DialQueue(s,{addressSorter:a.addressSorter??defaultAddressSort,maxParallelDials:a.maxParallelDials??MAX_PARALLEL_DIALS,maxDialQueueLength:a.maxDialQueueLength??MAX_DIAL_QUEUE_LENGTH,maxPeerAddrsToDial:a.maxPeerAddrsToDial??MAX_PEER_ADDRS_TO_DIAL,dialTimeout:a.dialTimeout??DIAL_TIMEOUT,resolvers:a.resolvers??{dnsaddr:dnsaddrResolver},connections:this.connections})}[Symbol.toStringTag]="@libp2p/connection-manager";isStarted(){return this.started}async start(){this.metrics?.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{const s={inbound:0,outbound:0};for(const a of this.connections.values())for(const et of a)et.direction==="inbound"?s.inbound++:s.outbound++;return s}}),this.metrics?.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{const s={};for(const a of this.connections.values())for(const et of a)for(const tt of et.streams){const rt=`${tt.direction} ${tt.protocol??"unnegotiated"}`;s[rt]=(s[rt]??0)+1}return s}}),this.metrics?.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{const s={};for(const et of this.connections.values())for(const tt of et){const rt={};for(const nt of tt.streams){const it=`${nt.direction} ${nt.protocol??"unnegotiated"}`;rt[it]=(rt[it]??0)+1}for(const[nt,it]of Object.entries(rt))s[nt]=s[nt]??[],s[nt].push(it)}const a={};for(let[et,tt]of Object.entries(s)){tt=tt.sort((nt,it)=>nt-it);const rt=Math.floor(tt.length*.9);a[et]=tt[rt]}return a}}),this.dialQueue.start(),this.autoDial.start(),this.started=!0,this.log("started")}async afterStart(){Promise.resolve().then(async()=>{const s=await this.peerStore.all({filters:[a=>a.tags.has(KEEP_ALIVE)]});await Promise.all(s.map(async a=>{await this.openConnection(a.id).catch(et=>{this.log.error(et)})}))}).catch(s=>{this.log.error(s)}),this.autoDial.afterStart()}async stop(){this.dialQueue.stop(),this.autoDial.stop();const s=[];for(const a of this.connections.values())for(const et of a)s.push((async()=>{try{await et.close()}catch(tt){this.log.error(tt)}})());this.log("closing %d connections",s.length),await Promise.all(s),this.connections.clear(),this.log("stopped")}onConnect(s){this._onConnect(s).catch(a=>{this.log.error(a)})}async _onConnect(s){const{detail:a}=s;if(!this.started){await a.close();return}const et=a.remotePeer,tt=this.connections.get(et);let rt=!1;tt!=null?tt.push(a):(rt=!0,this.connections.set(et,[a])),et.publicKey!=null&&et.type==="RSA"&&await this.peerStore.patch(et,{publicKey:et.publicKey}),rt&&this.events.safeDispatchEvent("peer:connect",{detail:a.remotePeer})}onDisconnect(s){const{detail:a}=s;if(!this.started)return;const et=a.remotePeer;let tt=this.connections.get(et);tt!=null&&tt.length>1?(tt=tt.filter(rt=>rt.id!==a.id),this.connections.set(et,tt)):tt!=null&&(this.connections.delete(et),this.events.safeDispatchEvent("peer:disconnect",{detail:a.remotePeer}))}getConnections(s){if(s!=null)return this.connections.get(s)??[];let a=[];for(const et of this.connections.values())a=a.concat(et);return a}getConnectionsMap(){return this.connections}async openConnection(s,a={}){if(!this.isStarted())throw new CodeError$3("Not started",codes.ERR_NODE_NOT_STARTED);a.signal?.throwIfAborted();const{peerId:et}=getPeerAddress(s);if(et!=null&&a.force!==!0){this.log("dial %p",et);const it=this.getConnections(et).find(st=>!st.transient);if(it!=null)return this.log("had an existing non-transient connection to %p",et),it}const tt=await this.dialQueue.dial(s,{...a,priority:a.priority??DEFAULT_DIAL_PRIORITY});let rt=this.connections.get(tt.remotePeer);rt==null&&(rt=[],this.connections.set(tt.remotePeer,rt));let nt=!1;for(const it of rt)it.id===tt.id&&(nt=!0);return nt||rt.push(tt),tt}async closeConnections(s,a={}){const et=this.connections.get(s)??[];await Promise.all(et.map(async tt=>{try{await tt.close(a)}catch(rt){tt.abort(rt)}}))}async acceptIncomingConnection(s){if(this.deny.some(tt=>s.remoteAddr.toString().startsWith(tt.toString())))return this.log("connection from %a refused - connection remote address was in deny list",s.remoteAddr),!1;if(this.allow.some(tt=>s.remoteAddr.toString().startsWith(tt.toString())))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.maxIncomingPendingConnections)return this.log("connection from %a refused - incomingPendingConnections exceeded by host",s.remoteAddr),!1;if(s.remoteAddr.isThinWaistAddress()){const tt=s.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(tt,1)}catch{return this.log("connection from %a refused - inboundConnectionThreshold exceeded by host %s",s.remoteAddr,tt),!1}}return this.getConnections().length<this.maxConnections?(this.incomingPendingConnections++,!0):(this.log("connection from %a refused - maxConnections exceeded",s.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}getDialQueue(){const s={queued:"queued",running:"active",errored:"error",complete:"success"};return this.dialQueue.queue.queue.map(a=>({id:a.id,status:s[a.status],peerId:a.options.peerId,multiaddrs:[...a.options.multiaddrs].map(et=>multiaddr(et))}))}async isDialable(s,a={}){return this.dialQueue.isDialable(s,a)}}class CompoundContentRouting{routers;started;components;constructor(s,a){this.routers=a.routers??[],this.started=!1,this.components=s}[Symbol.toStringTag]="@libp2p/content-routing";isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async*findProviders(s,a={}){if(this.routers.length===0)throw new CodeError$3("No content routers available",codes.ERR_NO_ROUTERS_AVAILABLE);const et=this,tt=new PeerSet;for await(const rt of merge$2(...et.routers.map(nt=>nt.findProviders(s,a))))rt!=null&&(rt.multiaddrs.length>0&&await this.components.peerStore.merge(rt.id,{multiaddrs:rt.multiaddrs}),!tt.has(rt.id)&&(tt.add(rt.id),yield rt))}async provide(s,a={}){if(this.routers.length===0)throw new CodeError$3("No content routers available",codes.ERR_NO_ROUTERS_AVAILABLE);await Promise.all(this.routers.map(async et=>{await et.provide(s,a)}))}async put(s,a,et){if(!this.isStarted())throw new CodeError$3(messages.NOT_STARTED_YET,codes.ERR_NODE_NOT_STARTED);await Promise.all(this.routers.map(async tt=>{await tt.put(s,a,et)}))}async get(s,a){if(!this.isStarted())throw new CodeError$3(messages.NOT_STARTED_YET,codes.ERR_NODE_NOT_STARTED);return Promise.any(this.routers.map(async et=>et.get(s,a)))}}class DefaultPeerRouting{log;peerId;peerStore;routers;constructor(s,a={}){this.log=s.logger.forComponent("libp2p:peer-routing"),this.peerId=s.peerId,this.peerStore=s.peerStore,this.routers=a.routers??[]}[Symbol.toStringTag]="@libp2p/peer-routing";async findPeer(s,a){if(this.routers.length===0)throw new CodeError$3("No peer routers available",codes.ERR_NO_ROUTERS_AVAILABLE);if(s.toString()===this.peerId.toString())throw new CodeError$3("Should not try to find self",codes.ERR_FIND_SELF);const et=this,tt=merge$2(...this.routers.map(rt=>async function*(){try{yield await rt.findPeer(s,a)}catch(nt){et.log.error(nt)}}()));for await(const rt of tt)if(rt!=null)return rt.multiaddrs.length>0&&await this.peerStore.merge(rt.id,{multiaddrs:rt.multiaddrs}),rt;throw new CodeError$3(messages.NOT_FOUND,codes.ERR_NOT_FOUND)}async*getClosestPeers(s,a={}){if(this.routers.length===0)throw new CodeError$3("No peer routers available",codes.ERR_NO_ROUTERS_AVAILABLE);const et=this,tt=createScalableCuckooFilter(1024);for await(const rt of parallel(async function*(){const nt=merge$2(...et.routers.map(it=>it.getClosestPeers(s,a)));for await(let it of nt)yield async()=>{if(it.multiaddrs.length===0)try{it=await et.findPeer(it.id,{...a,useCache:!1})}catch(st){et.log.error("could not find peer multiaddrs",st);return}return it}}()))rt!=null&&(rt.multiaddrs.length>0&&await this.peerStore.merge(rt.id,{multiaddrs:rt.multiaddrs}),!tt.has(rt.id.toBytes())&&(tt.add(rt.id.toBytes()),yield rt))}}class RandomWalk extends TypedEventEmitter{peerRouting;log;walking;walkers;shutdownController;walkController;needNext;constructor(s){super(),this.log=s.logger.forComponent("libp2p:random-walk"),this.peerRouting=s.peerRouting,this.walkers=0,this.walking=!1,this.shutdownController=new AbortController,setMaxListeners(1/0,this.shutdownController.signal)}[Symbol.toStringTag]="@libp2p/random-walk";start(){this.shutdownController=new AbortController,setMaxListeners(1/0,this.shutdownController.signal)}stop(){this.shutdownController.abort()}async*walk(s){this.walking||this.startWalk(),this.walkers++;const a=anySignal([this.shutdownController.signal,s?.signal]);setMaxListeners(1/0,a);try{for(;;)this.needNext?.resolve(),this.needNext=pDefer(),yield(await raceEvent(this,"walk:peer",a,{errorEvent:"walk:error"})).detail}finally{a.clear(),this.walkers--,this.walkers===0&&(this.walkController?.abort(),this.walkController=void 0)}}startWalk(){this.walking=!0,this.walkController=new AbortController,setMaxListeners(1/0,this.walkController.signal);const s=anySignal([this.walkController.signal,this.shutdownController.signal]);setMaxListeners(1/0,s);const a=Date.now();let et=0;Promise.resolve().then(async()=>{for(this.log("start walk");this.walkers>0;)try{const tt=randomBytes(32);let rt=Date.now();for await(const nt of this.peerRouting.getClosestPeers(tt,{signal:s}))s.aborted&&this.log("aborting walk"),s.throwIfAborted(),this.log("found peer %p after %dms for %d walkers",nt.id,Date.now()-rt,this.walkers),et++,this.safeDispatchEvent("walk:peer",{detail:nt}),this.walkers===1&&this.needNext!=null&&(this.log("wait for need next"),await raceSignal(this.needNext.promise,s)),rt=Date.now();this.log("walk iteration for %b and %d walkers finished, found %d peers",tt,this.walkers,et)}catch(tt){this.log.error("randomwalk errored",tt),this.safeDispatchEvent("walk:error",{detail:tt})}this.log("no walkers left, ended walk")}).catch(tt=>{this.log.error("randomwalk errored",tt)}).finally(()=>{this.log("finished walk, found %d peers after %dms",et,Date.now()-a),this.walking=!1})}}const DEFAULT_MAX_INBOUND_STREAMS=32,DEFAULT_MAX_OUTBOUND_STREAMS=64;class DefaultRegistrar{log;topologies;handlers;components;constructor(s){this.log=s.logger.forComponent("libp2p:registrar"),this.topologies=new Map,this.handlers=new Map,this.components=s,this._onDisconnect=this._onDisconnect.bind(this),this._onPeerUpdate=this._onPeerUpdate.bind(this),this._onPeerIdentify=this._onPeerIdentify.bind(this),this.components.events.addEventListener("peer:disconnect",this._onDisconnect),this.components.events.addEventListener("peer:update",this._onPeerUpdate),this.components.events.addEventListener("peer:identify",this._onPeerIdentify)}[Symbol.toStringTag]="@libp2p/registrar";getProtocols(){return Array.from(new Set([...this.handlers.keys()])).sort()}getHandler(s){const a=this.handlers.get(s);if(a==null)throw new CodeError$3(`No handler registered for protocol ${s}`,codes.ERR_NO_HANDLER_FOR_PROTOCOL);return a}getTopologies(s){const a=this.topologies.get(s);return a==null?[]:[...a.values()]}async handle(s,a,et){if(this.handlers.has(s))throw new CodeError$3(`Handler already registered for protocol ${s}`,codes.ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED);const tt=mergeOptions$9.bind({ignoreUndefined:!0})({maxInboundStreams:DEFAULT_MAX_INBOUND_STREAMS,maxOutboundStreams:DEFAULT_MAX_OUTBOUND_STREAMS},et);this.handlers.set(s,{handler:a,options:tt}),await this.components.peerStore.merge(this.components.peerId,{protocols:[s]})}async unhandle(s){(Array.isArray(s)?s:[s]).forEach(et=>{this.handlers.delete(et)}),await this.components.peerStore.patch(this.components.peerId,{protocols:this.getProtocols()})}async register(s,a){if(a==null)throw new CodeError$3("invalid topology",codes.ERR_INVALID_PARAMETERS);const et=`${(Math.random()*1e9).toString(36)}${Date.now()}`;let tt=this.topologies.get(s);return tt==null&&(tt=new Map,this.topologies.set(s,tt)),tt.set(et,a),et}unregister(s){for(const[a,et]of this.topologies.entries())et.has(s)&&(et.delete(s),et.size===0&&this.topologies.delete(a))}_onDisconnect(s){const a=s.detail;this.components.peerStore.get(a).then(et=>{for(const tt of et.protocols){const rt=this.topologies.get(tt);if(rt!=null)for(const nt of rt.values())nt.filter?.has(a)!==!1&&(nt.filter?.remove(a),nt.onDisconnect?.(a))}}).catch(et=>{et.code!==codes.ERR_NOT_FOUND&&this.log.error("could not inform topologies of disconnecting peer %p",a,et)})}_onPeerUpdate(s){const{peer:a,previous:et}=s.detail,tt=(et?.protocols??[]).filter(rt=>!a.protocols.includes(rt));for(const rt of tt){const nt=this.topologies.get(rt);if(nt!=null)for(const it of nt.values())it.filter?.has(a.id)!==!1&&(it.filter?.remove(a.id),it.onDisconnect?.(a.id))}}_onPeerIdentify(s){const a=s.detail.protocols,et=s.detail.connection,tt=s.detail.peerId;for(const rt of a){const nt=this.topologies.get(rt);if(nt!=null)for(const it of nt.values())et.transient&&it.notifyOnTransient!==!0||it.filter?.has(tt)!==!0&&(it.filter?.add(tt),it.onConnect?.(tt,et))}}}class DefaultTransportManager{log;components;transports;listeners;faultTolerance;started;constructor(s,a={}){this.log=s.logger.forComponent("libp2p:transports"),this.components=s,this.started=!1,this.transports=new Map,this.listeners=trackedMap({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=a.faultTolerance??FaultTolerance.FATAL_ALL}[Symbol.toStringTag]="@libp2p/transport-manager";add(s){const a=s[Symbol.toStringTag];if(a==null)throw new CodeError$3("Transport must have a valid tag",codes.ERR_INVALID_KEY);if(this.transports.has(a))throw new CodeError$3(`There is already a transport with the tag ${a}`,codes.ERR_DUPLICATE_TRANSPORT);this.log("adding transport %s",a),this.transports.set(a,s),this.listeners.has(a)||this.listeners.set(a,[])}isStarted(){return this.started}start(){this.started=!0}async afterStart(){const s=this.components.addressManager.getListenAddrs();await this.listen(s)}async stop(){const s=[];for(const[a,et]of this.listeners)for(this.log("closing listeners for %s",a);et.length>0;){const tt=et.pop();tt!=null&&s.push(tt.close())}await Promise.all(s),this.log("all listeners closed");for(const a of this.listeners.keys())this.listeners.set(a,[]);this.started=!1}async dial(s,a){const et=this.dialTransportForMultiaddr(s);if(et==null)throw new CodeError$3(`No transport available for address ${String(s)}`,codes.ERR_TRANSPORT_UNAVAILABLE);try{return await et.dial(s,{...a,upgrader:this.components.upgrader})}catch(tt){throw tt.code==null&&(tt.code=codes.ERR_TRANSPORT_DIAL_FAILED),tt}}getAddrs(){let s=[];for(const a of this.listeners.values())for(const et of a)s=[...s,...et.getAddrs()];return s}getTransports(){return Array.of(...this.transports.values())}getListeners(){return Array.of(...this.listeners.values()).flat()}dialTransportForMultiaddr(s){for(const a of this.transports.values())if(a.dialFilter([s]).length>0)return a}listenTransportForMultiaddr(s){for(const a of this.transports.values())if(a.listenFilter([s]).length>0)return a}async listen(s){if(!this.isStarted())throw new CodeError$3("Not started",codes.ERR_NODE_NOT_STARTED);if(s==null||s.length===0){this.log("no addresses were provided for listening, this node is dial only");return}const a=[];for(const[et,tt]of this.transports.entries()){const rt=tt.listenFilter(s),nt=[];for(const ot of rt){this.log("creating listener for %s on %a",et,ot);const at=tt.createListener({upgrader:this.components.upgrader});let lt=this.listeners.get(et)??[];lt==null&&(lt=[],this.listeners.set(et,lt)),lt.push(at),at.addEventListener("listening",()=>{this.components.events.safeDispatchEvent("transport:listening",{detail:at})}),at.addEventListener("close",()=>{const ct=lt.findIndex(ht=>ht===at);lt.splice(ct,1),this.components.events.safeDispatchEvent("transport:close",{detail:at})}),nt.push(at.listen(ot))}if(nt.length===0){a.push(et);continue}if((await Promise.allSettled(nt)).find(ot=>ot.status==="fulfilled")==null&&this.faultTolerance!==FaultTolerance.NO_FATAL)throw new CodeError$3(`Transport (${et}) could not listen on any available address`,codes.ERR_NO_VALID_ADDRESSES)}if(a.length===this.transports.size){const et=`no valid addresses were provided for transports [${a.join(", ")}]`;if(this.faultTolerance===FaultTolerance.FATAL_ALL)throw new CodeError$3(et,codes.ERR_NO_VALID_ADDRESSES);this.log(`libp2p in dial mode only: ${et}`)}}async remove(s){const a=this.listeners.get(s)??[];this.log.trace("removing transport %s",s);const et=[];for(this.log.trace("closing listeners for %s",s);a.length>0;){const tt=a.pop();tt!=null&&et.push(tt.close())}await Promise.all(et),this.transports.delete(s),this.listeners.delete(s)}async removeAll(){const s=[];for(const a of this.transports.keys())s.push(this.remove(a));await Promise.all(s)}}const PROTOCOL_ID="/multistream/1.0.0",MAX_PROTOCOL_LENGTH=1024;function allocUnsafe$5(o=0){return new Uint8Array(o)}function createCodec$5(o,s,a,et){return{name:o,prefix:s,encoder:{name:o,prefix:s,encode:a},decoder:{decode:et}}}const string$5=createCodec$5("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),ascii$5=createCodec$5("ascii","a",o=>{let s="a";for(let a=0;a<o.length;a++)s+=String.fromCharCode(o[a]);return s},o=>{o=o.substring(1);const s=allocUnsafe$5(o.length);for(let a=0;a<o.length;a++)s[a]=o.charCodeAt(a);return s}),BASES$5={utf8:string$5,"utf-8":string$5,hex:bases.base16,latin1:ascii$5,ascii:ascii$5,binary:ascii$5,...bases};function fromString$5(o,s="utf8"){const a=BASES$5[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.decoder.decode(`${a.prefix}${o}`)}function toString$1(o,s="utf8"){const a=BASES$5[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.encoder.encode(o).substring(1)}const NewLine=fromString$5(`
`);async function write(o,s,a){await o.write(s,a)}async function writeAll(o,s,a){await o.writeV(s,a)}async function read(o,s){const a=await o.read(s);if(a.byteLength===0||a.get(a.byteLength-1)!==NewLine[0])throw s.log.error("Invalid mss message - missing newline",a),new CodeError$3("missing newline","ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");return a.sublist(0,-1)}async function readString(o,s){const a=await read(o,s);return toString$1(a.subarray())}async function select(o,s,a){if(s=Array.isArray(s)?[...s]:[s],s.length===1&&a.negotiateFully===!1)return optimisticSelect(o,s[0],a);const et=lpStream(o,{...a,maxDataLength:MAX_PROTOCOL_LENGTH}),tt=s.shift();if(tt==null)throw new Error("At least one protocol must be specified");a.log.trace('select: write ["%s", "%s"]',PROTOCOL_ID,tt);const rt=fromString$5(`${PROTOCOL_ID}
`),nt=fromString$5(`${tt}
`);await writeAll(et,[rt,nt],a),a.log.trace("select: reading multistream-select header");let it=await readString(et,a);if(a.log.trace('select: read "%s"',it),it===PROTOCOL_ID&&(a.log.trace("select: reading protocol response"),it=await readString(et,a),a.log.trace('select: read "%s"',it)),it===tt)return{stream:et.unwrap(),protocol:tt};for(const st of s){a.log.trace('select: write "%s"',st),await write(et,fromString$5(`${st}
`),a),a.log.trace("select: reading protocol response");const ot=await readString(et,a);if(a.log.trace('select: read "%s" for "%s"',ot,st),ot===st)return{stream:et.unwrap(),protocol:st}}throw new CodeError$3("protocol selection failed","ERR_UNSUPPORTED_PROTOCOL")}function optimisticSelect(o,s,a){const et=o.sink.bind(o),tt=o.source;let rt=!1,nt=!1;const it=pDefer();let st=!1,ot=!1;const at=pDefer();let lt=!1,ct=!1;const ht=pDefer(),ft=lpStream({sink:et,source:tt},{...a,maxDataLength:MAX_PROTOCOL_LENGTH});o.sink=async mt=>{const{sink:yt}=ft.unwrap();await yt(async function*(){let vt=!1;for await(const Et of mt){if(ot&&await at.promise,st)yield Et;else{ot=!0,a.log.trace('optimistic: write ["%s", "%s", data(%d)] in sink',PROTOCOL_ID,s,Et.byteLength);const xt=`${s}
`;yield new Uint8ArrayList(Uint8Array.from([19]),fromString$5(`${PROTOCOL_ID}
`),encode$c(xt.length),fromString$5(xt),Et).subarray(),a.log.trace('optimistic: wrote ["%s", "%s", data(%d)] in sink',PROTOCOL_ID,s,Et.byteLength),st=!0,ot=!1,at.resolve(),dt().catch(wt=>{a.log.error("could not finish optimistic protocol negotiation of %s",s,wt)})}vt=!0}vt||await dt()}())};async function dt(){if(nt){a.log.trace("optimistic: already negotiating %s stream",s),await it.promise;return}nt=!0;try{st||(a.log.trace("optimistic: doing send protocol for %s stream",s),await pt()),lt||(a.log.trace("optimistic: doing read protocol for %s stream",s),await gt())}finally{nt=!1,rt=!0,it.resolve()}}async function pt(){if(ot){await at.promise;return}ot=!0;try{a.log.trace('optimistic: write ["%s", "%s", data] in source',PROTOCOL_ID,s),await ft.writeV([fromString$5(`${PROTOCOL_ID}
`),fromString$5(`${s}
`)]),a.log.trace('optimistic: wrote ["%s", "%s", data] in source',PROTOCOL_ID,s)}finally{st=!0,ot=!1,at.resolve()}}async function gt(){if(ct){await ht.promise;return}ct=!0;try{a.log.trace("optimistic: reading multistream select header");let mt=await readString(ft,a);if(a.log.trace('optimistic: read multistream select header "%s"',mt),mt===PROTOCOL_ID&&(mt=await readString(ft,a)),a.log.trace('optimistic: read protocol "%s", expecting "%s"',mt,s),mt!==s)throw new CodeError$3("protocol selection failed","ERR_UNSUPPORTED_PROTOCOL")}finally{lt=!0,ct=!1,ht.resolve()}}if(o.source=async function*(){await dt(),a.log.trace('optimistic: reading data from "%s" stream',s),yield*ft.unwrap().source}(),o.closeRead!=null){const mt=o.closeRead.bind(o);o.closeRead=async yt=>{rt||await dt().catch(vt=>{a.log.error("could not negotiate protocol before close read",vt)}),await mt(yt)}}if(o.closeWrite!=null){const mt=o.closeWrite.bind(o);o.closeWrite=async yt=>{rt||await dt().catch(vt=>{a.log.error("could not negotiate protocol before close write",vt)}),await mt(yt)}}if(o.close!=null){const mt=o.close.bind(o);o.close=async yt=>{const vt=[];ot&&vt.push(at.promise),ct&&vt.push(ht.promise),vt.length>0?await raceSignal(Promise.all(vt),yt?.signal):(rt=!0,nt=!1,it.resolve()),await mt(yt)}}return{stream:o,protocol:s}}async function handle(o,s,a){s=Array.isArray(s)?s:[s],a.log.trace("handle: available protocols %s",s);const et=lpStream(o,{...a,maxDataLength:MAX_PROTOCOL_LENGTH,maxLengthLength:2});for(;;){a.log.trace("handle: reading incoming string");const tt=await readString(et,a);if(a.log.trace('handle: read "%s"',tt),tt===PROTOCOL_ID){a.log.trace('handle: respond with "%s" for "%s"',PROTOCOL_ID,tt),await write(et,fromString$5(`${PROTOCOL_ID}
`),a),a.log.trace('handle: responded with "%s" for "%s"',PROTOCOL_ID,tt);continue}if(s.includes(tt))return a.log.trace('handle: respond with "%s" for "%s"',tt,tt),await write(et,fromString$5(`${tt}
`),a),a.log.trace('handle: responded with "%s" for "%s"',tt,tt),{stream:et.unwrap(),protocol:tt};if(tt==="ls"){const rt=new Uint8ArrayList(...s.map(nt=>encode$b.single(fromString$5(`${nt}
`))),fromString$5(`
`));a.log.trace('handle: respond with "%s" for %s',s,tt),await write(et,rt,a),a.log.trace('handle: responded with "%s" for %s',s,tt);continue}a.log('handle: respond with "na" for "%s"',tt),await write(et,fromString$5(`na
`),a),a.log('handle: responded with "na" for "%s"',tt)}}const CLOSE_TIMEOUT$1=500;class ConnectionImpl{id;remoteAddr;remotePeer;direction;timeline;multiplexer;encryption;status;transient;log;tags;_newStream;_close;_abort;_getStreams;constructor(s){const{remoteAddr:a,remotePeer:et,newStream:tt,close:rt,abort:nt,getStreams:it}=s;this.id=`${parseInt(String(Math.random()*1e9)).toString(36)}${Date.now()}`,this.remoteAddr=a,this.remotePeer=et,this.direction=s.direction,this.status="open",this.timeline=s.timeline,this.multiplexer=s.multiplexer,this.encryption=s.encryption,this.transient=s.transient??!1,this.log=s.logger.forComponent(`libp2p:connection:${this.direction}:${this.id}`),this.remoteAddr.getPeerId()==null&&(this.remoteAddr=this.remoteAddr.encapsulate(`/p2p/${this.remotePeer}`)),this._newStream=tt,this._close=rt,this._abort=nt,this._getStreams=it,this.tags=[]}[Symbol.toStringTag]="Connection";[connectionSymbol]=!0;get streams(){return this._getStreams()}async newStream(s,a){if(this.status==="closing")throw new CodeError$3("the connection is being closed","ERR_CONNECTION_BEING_CLOSED");if(this.status==="closed")throw new CodeError$3("the connection is closed","ERR_CONNECTION_CLOSED");if(Array.isArray(s)||(s=[s]),this.transient&&a?.runOnTransientConnection!==!0)throw new CodeError$3("Cannot open protocol stream on transient connection","ERR_TRANSIENT_CONNECTION");const et=await this._newStream(s,a);return et.direction="outbound",et}async close(s={}){if(!(this.status==="closed"||this.status==="closing")){if(this.log("closing connection to %a",this.remoteAddr),this.status="closing",s.signal==null){const a=AbortSignal.timeout(CLOSE_TIMEOUT$1);setMaxListeners(1/0,a),s={...s,signal:a}}try{this.log.trace("closing all streams"),await Promise.all(this.streams.map(async a=>a.close(s))),this.log.trace("closing underlying transport"),await this._close(s),this.log.trace("updating timeline with close time"),this.status="closed",this.timeline.close=Date.now()}catch(a){this.log.error("error encountered during graceful close of connection to %a",this.remoteAddr,a),this.abort(a)}}}abort(s){this.log.error("aborting connection to %a due to error",this.remoteAddr,s),this.status="closing",this.streams.forEach(a=>{a.abort(s)}),this.log.error("all streams aborted",this.streams.length),this._abort(s),this.timeline.close=Date.now(),this.status="closed"}}function createConnection(o){return new ConnectionImpl(o)}const DEFAULT_PROTOCOL_SELECT_TIMEOUT=3e4;function findIncomingStreamLimit(o,s){try{const{options:a}=s.getHandler(o);return a.maxInboundStreams}catch(a){if(a.code!==codes.ERR_NO_HANDLER_FOR_PROTOCOL)throw a}return DEFAULT_MAX_INBOUND_STREAMS}function findOutgoingStreamLimit(o,s,a={}){try{const{options:et}=s.getHandler(o);if(et.maxOutboundStreams!=null)return et.maxOutboundStreams}catch(et){if(et.code!==codes.ERR_NO_HANDLER_FOR_PROTOCOL)throw et}return a.maxOutboundStreams??DEFAULT_MAX_OUTBOUND_STREAMS}function countStreams(o,s,a){let et=0;return a.streams.forEach(tt=>{tt.direction===s&&tt.protocol===o&&et++}),et}class DefaultUpgrader{components;connectionEncryption;muxers;inboundUpgradeTimeout;events;constructor(s,a){this.components=s,this.connectionEncryption=new Map,a.connectionEncryption.forEach(et=>{this.connectionEncryption.set(et.protocol,et)}),this.muxers=new Map,a.muxers.forEach(et=>{this.muxers.set(et.protocol,et)}),this.inboundUpgradeTimeout=a.inboundUpgradeTimeout??INBOUND_UPGRADE_TIMEOUT,this.events=s.events}[Symbol.toStringTag]="@libp2p/upgrader";async shouldBlockConnection(s,a,et){const tt=this.components.connectionGater[et];if(tt!==void 0&&await tt(s,a))throw new CodeError$3(`The multiaddr connection is blocked by gater.${et}`,codes.ERR_CONNECTION_INTERCEPTED)}async upgradeInbound(s,a){if(!await this.components.connectionManager.acceptIncomingConnection(s))throw new CodeError$3("connection denied",codes.ERR_CONNECTION_DENIED);let tt,rt,nt,it,st;const ot=AbortSignal.timeout(this.inboundUpgradeTimeout),at=()=>{s.abort(new CodeError$3("inbound upgrade timeout",ERR_TIMEOUT))};ot.addEventListener("abort",at,{once:!0}),setMaxListeners(1/0,ot);try{if(await this.components.connectionGater.denyInboundConnection?.(s)===!0)throw new CodeError$3("The multiaddr connection is blocked by gater.acceptConnection",codes.ERR_CONNECTION_INTERCEPTED);this.components.metrics?.trackMultiaddrConnection(s),s.log("starting the inbound connection upgrade");let lt=s;if(a?.skipProtection!==!0){const ct=this.components.connectionProtector;ct!=null&&(s.log("protecting the inbound connection"),lt=await ct.protect(s))}try{if(tt=lt,a?.skipEncryption!==!0){({conn:tt,remotePeer:rt,protocol:st}=await this._encryptInbound(lt));const ct={...lt,...tt};await this.shouldBlockConnection(rt,ct,"denyInboundEncryptedConnection")}else{const ct=s.remoteAddr.getPeerId();if(ct==null)throw new CodeError$3("inbound connection that skipped encryption must have a peer id",codes.ERR_INVALID_MULTIADDR);const ht=peerIdFromString(ct);st="native",rt=ht}if(nt=tt,a?.muxerFactory!=null)it=a.muxerFactory;else if(this.muxers.size>0){const ct=await this._multiplexInbound({...lt,...tt},this.muxers);it=ct.muxerFactory,nt=ct.stream}}catch(ct){throw s.log.error("failed to upgrade inbound connection",ct),ct}return await this.shouldBlockConnection(rt,s,"denyInboundUpgradedConnection"),s.log("successfully upgraded inbound connection"),this._createConnection({cryptoProtocol:st,direction:"inbound",maConn:s,upgradedConn:nt,muxerFactory:it,remotePeer:rt,transient:a?.transient})}finally{ot.removeEventListener("abort",at),this.components.connectionManager.afterUpgradeInbound()}}async upgradeOutbound(s,a){const et=s.remoteAddr.getPeerId();let tt;et!=null&&(tt=peerIdFromString(et),await this.shouldBlockConnection(tt,s,"denyOutboundConnection"));let rt,nt,it,st,ot;this.components.metrics?.trackMultiaddrConnection(s),s.log("starting the outbound connection upgrade");let at=s;if(a?.skipProtection!==!0){const lt=this.components.connectionProtector;lt!=null&&(at=await lt.protect(s))}try{if(rt=at,a?.skipEncryption!==!0){({conn:rt,remotePeer:nt,protocol:st}=await this._encryptOutbound(at,tt));const lt={...at,...rt};await this.shouldBlockConnection(nt,lt,"denyOutboundEncryptedConnection")}else{if(tt==null)throw new CodeError$3("Encryption was skipped but no peer id was passed",codes.ERR_INVALID_PEER);st="native",nt=tt}if(it=rt,a?.muxerFactory!=null)ot=a.muxerFactory;else if(this.muxers.size>0){const lt=await this._multiplexOutbound({...at,...rt},this.muxers);ot=lt.muxerFactory,it=lt.stream}}catch(lt){throw s.log.error("failed to upgrade outbound connection",lt),await s.close(lt),lt}return await this.shouldBlockConnection(nt,s,"denyOutboundUpgradedConnection"),s.log("successfully upgraded outbound connection"),this._createConnection({cryptoProtocol:st,direction:"outbound",maConn:s,upgradedConn:it,muxerFactory:ot,remotePeer:nt,transient:a?.transient})}_createConnection(s){const{cryptoProtocol:a,direction:et,maConn:tt,upgradedConn:rt,remotePeer:nt,muxerFactory:it,transient:st}=s;let ot,at,lt;it!=null&&(ot=it.createStreamMuxer({direction:et,onIncomingStream:ft=>{lt!=null&&Promise.resolve().then(async()=>{const dt=this.components.registrar.getProtocols(),{stream:pt,protocol:gt}=await handle(ft,dt,{log:ft.log,yieldBytes:!1});if(lt==null)return;lt.log("incoming stream opened on %s",gt);const mt=findIncomingStreamLimit(gt,this.components.registrar);if(countStreams(gt,"inbound",lt)===mt){const vt=new CodeError$3(`Too many inbound protocol streams for protocol "${gt}" - limit ${mt}`,codes.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS);throw ft.abort(vt),vt}ft.source=pt.source,ft.sink=pt.sink,ft.protocol=gt,pt.closeWrite!=null&&(ft.closeWrite=pt.closeWrite),pt.closeRead!=null&&(ft.closeRead=pt.closeRead),pt.close!=null&&(ft.close=pt.close),await this.components.peerStore.merge(nt,{protocols:[gt]}),this.components.metrics?.trackProtocolStream(ft,lt),this._onStream({connection:lt,stream:ft,protocol:gt})}).catch(async dt=>{lt.log.error("error handling incoming stream id %s",ft.id,dt.message,dt.code,dt.stack),ft.timeline.close==null&&await ft.close()})}}),at=async(ft,dt={})=>{if(ot==null)throw new CodeError$3("Stream is not multiplexed",codes.ERR_MUXER_UNAVAILABLE);lt.log("starting new stream for protocols %s",ft);const pt=await ot.newStream();lt.log.trace("started new stream %s for protocols %s",pt.id,ft);try{if(dt.signal==null){pt.log("no abort signal was passed while trying to negotiate protocols %s falling back to default timeout",ft);const Et=AbortSignal.timeout(DEFAULT_PROTOCOL_SELECT_TIMEOUT);setMaxListeners(1/0,Et),dt={...dt,signal:Et}}pt.log.trace("selecting protocol from protocols %s",ft);const{stream:gt,protocol:mt}=await select(pt,ft,{...dt,log:pt.log,yieldBytes:!0});pt.log("selected protocol %s",mt);const yt=findOutgoingStreamLimit(mt,this.components.registrar,dt),vt=countStreams(mt,"outbound",lt);if(vt>=yt){const Et=new CodeError$3(`Too many outbound protocol streams for protocol "${mt}" - ${vt}/${yt}`,codes.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS);throw pt.abort(Et),Et}return await this.components.peerStore.merge(nt,{protocols:[mt]}),pt.source=gt.source,pt.sink=gt.sink,pt.protocol=mt,gt.closeWrite!=null&&(pt.closeWrite=gt.closeWrite),gt.closeRead!=null&&(pt.closeRead=gt.closeRead),gt.close!=null&&(pt.close=gt.close),this.components.metrics?.trackProtocolStream(pt,lt),pt}catch(gt){throw lt.log.error("could not create new stream for protocols %s",ft,gt),pt.timeline.close==null&&pt.abort(gt),gt.code!=null?gt:new CodeError$3(String(gt),codes.ERR_UNSUPPORTED_PROTOCOL)}},Promise.all([ot.sink(rt.source),rt.sink(ot.source)]).catch(ft=>{lt.log.error("error piping data through muxer",ft)}));const ct=tt.timeline;tt.timeline=new Proxy(ct,{set:(...ft)=>(lt!=null&&ft[1]==="close"&&ft[2]!=null&&ct.close==null&&(async()=>{try{lt.status==="open"&&await lt.close()}catch(dt){lt.log.error("error closing connection after timeline close",dt)}finally{this.events.safeDispatchEvent("connection:close",{detail:lt})}})().catch(dt=>{lt.log.error("error thrown while dispatching connection:close event",dt)}),Reflect.set(...ft))}),tt.timeline.upgraded=Date.now();const ht=()=>{throw new CodeError$3("connection is not multiplexed",codes.ERR_CONNECTION_NOT_MULTIPLEXED)};return lt=createConnection({remoteAddr:tt.remoteAddr,remotePeer:nt,status:"open",direction:et,timeline:tt.timeline,multiplexer:ot?.protocol,encryption:a,transient:st,logger:this.components.logger,newStream:at??ht,getStreams:()=>ot!=null?ot.streams:[],close:async ft=>{ot!=null&&(lt.log.trace("close muxer"),await ot.close(ft)),lt.log.trace("close maconn"),await tt.close(ft),lt.log.trace("closed maconn")},abort:ft=>{tt.abort(ft),ot?.abort(ft)}}),this.events.safeDispatchEvent("connection:open",{detail:lt}),lt}_onStream(s){const{connection:a,stream:et,protocol:tt}=s,{handler:rt,options:nt}=this.components.registrar.getHandler(tt);if(a.transient&&nt.runOnTransientConnection!==!0)throw new CodeError$3("Cannot open protocol stream on transient connection","ERR_TRANSIENT_CONNECTION");rt({connection:a,stream:et})}async _encryptInbound(s){const a=Array.from(this.connectionEncryption.keys());s.log("handling inbound crypto protocol selection",a);try{const{stream:et,protocol:tt}=await handle(s,a,{log:s.log}),rt=this.connectionEncryption.get(tt);if(rt==null)throw new Error(`no crypto module found for ${tt}`);return s.log("encrypting inbound connection using",tt),{...await rt.secureInbound(this.components.peerId,et),protocol:tt}}catch(et){throw s.log.error("encrypting inbound connection failed",et),new CodeError$3(et.message,codes.ERR_ENCRYPTION_FAILED)}}async _encryptOutbound(s,a){const et=Array.from(this.connectionEncryption.keys());s.log("selecting outbound crypto protocol",et);try{s.log.trace("selecting encrypter from %s",et);const{stream:tt,protocol:rt}=await select(s,et,{log:s.log,yieldBytes:!0}),nt=this.connectionEncryption.get(rt);if(nt==null)throw new Error(`no crypto module found for ${rt}`);return s.log("encrypting outbound connection to %p using %s",a,nt),{...await nt.secureOutbound(this.components.peerId,tt,a),protocol:rt}}catch(tt){throw s.log.error("encrypting outbound connection to %p failed",a,tt),new CodeError$3(tt.message,codes.ERR_ENCRYPTION_FAILED)}}async _multiplexOutbound(s,a){const et=Array.from(a.keys());s.log("outbound selecting muxer %s",et);try{s.log.trace("selecting stream muxer from %s",et);const{stream:tt,protocol:rt}=await select(s,et,{log:s.log,yieldBytes:!0});s.log("selected %s as muxer protocol",rt);const nt=a.get(rt);return{stream:tt,muxerFactory:nt}}catch(tt){throw s.log.error("error multiplexing outbound connection",tt),new CodeError$3(String(tt),codes.ERR_MUXER_UNAVAILABLE)}}async _multiplexInbound(s,a){const et=Array.from(a.keys());s.log("inbound handling muxers %s",et);try{const{stream:tt,protocol:rt}=await handle(s,et,{log:s.log}),nt=a.get(rt);return{stream:tt,muxerFactory:nt}}catch(tt){throw s.log.error("error multiplexing inbound connection",tt),new CodeError$3(String(tt),codes.ERR_MUXER_UNAVAILABLE)}}}class Libp2pNode extends TypedEventEmitter{peerId;peerStore;contentRouting;peerRouting;metrics;services;logger;status;components;log;constructor(s){super(),this.status="stopped";const a=new TypedEventEmitter,et=a.dispatchEvent.bind(a);a.dispatchEvent=it=>{const st=et(it),ot=this.dispatchEvent(new CustomEvent$2(it.type,{detail:it.detail}));return st||ot},setMaxListeners(1/0,a),this.peerId=s.peerId,this.logger=s.logger??defaultLogger(),this.log=this.logger.forComponent("libp2p"),this.services={};const tt=this.components=defaultComponents({peerId:s.peerId,privateKey:s.privateKey,nodeInfo:s.nodeInfo??{name:name$2,version:version$3},logger:this.logger,events:a,datastore:s.datastore??new MemoryDatastore,connectionGater:connectionGater(s.connectionGater),dns:s.dns});this.peerStore=this.configureComponent("peerStore",new PersistentPeerStore(tt,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...s.peerStore})),s.metrics!=null&&(this.metrics=this.configureComponent("metrics",s.metrics(this.components))),tt.events.addEventListener("peer:update",it=>{if(it.detail.previous==null){const st={id:it.detail.peer.id,multiaddrs:it.detail.peer.addresses.map(ot=>ot.multiaddr)};tt.events.safeDispatchEvent("peer:discovery",{detail:st})}}),s.connectionProtector!=null&&this.configureComponent("connectionProtector",s.connectionProtector(tt)),this.components.upgrader=new DefaultUpgrader(this.components,{connectionEncryption:(s.connectionEncryption??[]).map((it,st)=>this.configureComponent(`connection-encryption-${st}`,it(this.components))),muxers:(s.streamMuxers??[]).map((it,st)=>this.configureComponent(`stream-muxers-${st}`,it(this.components))),inboundUpgradeTimeout:s.connectionManager?.inboundUpgradeTimeout}),this.configureComponent("transportManager",new DefaultTransportManager(this.components,s.transportManager)),this.configureComponent("connectionManager",new DefaultConnectionManager(this.components,s.connectionManager)),this.configureComponent("registrar",new DefaultRegistrar(this.components)),this.configureComponent("addressManager",new DefaultAddressManager(this.components,s.addresses));const rt=(s.peerRouters??[]).map((it,st)=>this.configureComponent(`peer-router-${st}`,it(this.components)));this.peerRouting=this.components.peerRouting=this.configureComponent("peerRouting",new DefaultPeerRouting(this.components,{routers:rt}));const nt=(s.contentRouters??[]).map((it,st)=>this.configureComponent(`content-router-${st}`,it(this.components)));if(this.contentRouting=this.components.contentRouting=this.configureComponent("contentRouting",new CompoundContentRouting(this.components,{routers:nt})),this.configureComponent("randomWalk",new RandomWalk(this.components)),(s.peerDiscovery??[]).forEach((it,st)=>{this.configureComponent(`peer-discovery-${st}`,it(this.components)).addEventListener("peer",at=>{this.#e(at)})}),s.transports?.forEach((it,st)=>{this.components.transportManager.add(this.configureComponent(`transport-${st}`,it(this.components)))}),s.services!=null)for(const it of Object.keys(s.services)){const st=s.services[it],ot=st(this.components);if(ot==null){this.log.error("service factory %s returned null or undefined instance",it);continue}this.services[it]=ot,this.configureComponent(it,ot),ot[contentRoutingSymbol]!=null&&(this.log("registering service %s for content routing",it),nt.push(ot[contentRoutingSymbol])),ot[peerRoutingSymbol]!=null&&(this.log("registering service %s for peer routing",it),rt.push(ot[peerRoutingSymbol])),ot[peerDiscoverySymbol]!=null&&(this.log("registering service %s for peer discovery",it),ot[peerDiscoverySymbol].addEventListener?.("peer",at=>{this.#e(at)}))}checkServiceDependencies(tt)}configureComponent(s,a){return a==null&&this.log.error("component %s was null or undefined",s),this.components[s]=a,a}async start(){if(this.status==="stopped"){this.status="starting",this.log("libp2p is starting");try{await this.components.beforeStart?.(),await this.components.start(),await this.components.afterStart?.(),this.status="started",this.safeDispatchEvent("start",{detail:this}),this.log("libp2p has started")}catch(s){throw this.log.error("An error occurred starting libp2p",s),this.status="started",await this.stop(),s}}}async stop(){this.status==="started"&&(this.log("libp2p is stopping"),this.status="stopping",await this.components.beforeStop?.(),await this.components.stop(),await this.components.afterStop?.(),this.status="stopped",this.safeDispatchEvent("stop",{detail:this}),this.log("libp2p has stopped"))}getConnections(s){return this.components.connectionManager.getConnections(s)}getDialQueue(){return this.components.connectionManager.getDialQueue()}getPeers(){const s=new PeerSet;for(const a of this.components.connectionManager.getConnections())s.add(a.remotePeer);return Array.from(s)}async dial(s,a={}){return this.components.connectionManager.openConnection(s,{priority:75,...a})}async dialProtocol(s,a,et={}){if(a==null)throw new CodeError$3("no protocols were provided to open a stream",codes.ERR_INVALID_PROTOCOLS_FOR_STREAM);if(a=Array.isArray(a)?a:[a],a.length===0)throw new CodeError$3("no protocols were provided to open a stream",codes.ERR_INVALID_PROTOCOLS_FOR_STREAM);return(await this.dial(s,et)).newStream(a,et)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(s,a={}){isMultiaddr(s)&&(s=peerIdFromString(s.getPeerId()??"")),await this.components.connectionManager.closeConnections(s,a)}async getPublicKey(s,a={}){if(this.log("getPublicKey %p",s),s.publicKey!=null)return s.publicKey;try{const rt=await this.peerStore.get(s);if(rt.id.publicKey!=null)return rt.id.publicKey}catch(rt){if(rt.code!==codes.ERR_NOT_FOUND)throw rt}const et=concat$3([fromString$6("/pk/"),s.multihash.digest]),tt=await this.contentRouting.get(et,a);return unmarshalPublicKey(tt),await this.peerStore.patch(s,{publicKey:tt}),tt}async handle(s,a,et){Array.isArray(s)||(s=[s]),await Promise.all(s.map(async tt=>{await this.components.registrar.handle(tt,a,et)}))}async unhandle(s){Array.isArray(s)||(s=[s]),await Promise.all(s.map(async a=>{await this.components.registrar.unhandle(a)}))}async register(s,a){return this.components.registrar.register(s,a)}unregister(s){this.components.registrar.unregister(s)}async isDialable(s,a={}){return this.components.connectionManager.isDialable(s,a)}#e(s){const{detail:a}=s;if(a.id.toString()===this.peerId.toString()){this.log.error(new Error(codes.ERR_DISCOVERED_SELF));return}this.components.peerStore.merge(a.id,{multiaddrs:a.multiaddrs}).catch(et=>{this.log.error(et)})}}async function createLibp2pNode(o={}){const s=o.peerId??=await createEd25519PeerId();if(s.privateKey==null)throw new CodeError$3("peer id was missing private key","ERR_MISSING_PRIVATE_KEY");return o.privateKey??=await unmarshalPrivateKey(s.privateKey),new Libp2pNode(await validateConfig(o))}async function createLibp2p$1(o={}){const s=await createLibp2pNode(o);return o.start!==!1&&await s.start(),s}async function createLibp2p(o){const s=o.libp2p?.peerId,a=o.logger??defaultLogger(),et=new Key("/pkcs8/self");let tt;s==null&&o.datastore!=null&&(tt=keychain(o.keychain)({datastore:o.datastore,logger:a}),await o.datastore.has(et)&&(o.libp2p=o.libp2p??{},o.libp2p.peerId=await tt.exportPeerId("self")));const rt=libp2pDefaults(o);rt.datastore=rt.datastore??o.datastore,o=o??{};const nt=await createLibp2p$1({...rt,...o.libp2p,start:!1});return s==null&&tt!=null&&!await o.datastore.has(et)&&await tt.importPeer("self",nt.peerId),nt}async function createHelia(o={}){const s=o.datastore??new MemoryDatastore,a=o.blockstore??new MemoryBlockstore;let et;isLibp2p(o.libp2p)?et=o.libp2p:et=await createLibp2p({...o,libp2p:{dns:o.dns,...o.libp2p,start:void 0},datastore:s});const tt=new HeliaP2P({...o,libp2p:et,datastore:s,blockstore:a,blockBrokers:o.blockBrokers??[trustlessGateway(),bitswap()],routers:[libp2pRouting(et),httpGatewayRouting()],metrics:et.metrics});return o.start!==!1&&await tt.start(),tt}function isLibp2p(o){return o==null?!1:["dial","dialProtocol","hangUp","handle","unhandle","getMultiaddrs","getProtocols"].every(a=>typeof o[a]=="function")}function isAsyncIterable$3(o){return o[Symbol.asyncIterator]!=null}function batch(o,s=1){return s=Number(s),isAsyncIterable$3(o)?async function*(){let a=[];if(s<1&&(s=1),s!==Math.round(s))throw new Error("Batch size must be an integer");for await(const et of o)for(a.push(et);a.length>=s;)yield a.slice(0,s),a=a.slice(s);for(;a.length>0;)yield a.slice(0,s),a=a.slice(s)}():function*(){let a=[];if(s<1&&(s=1),s!==Math.round(s))throw new Error("Batch size must be an integer");for(const et of o)for(a.push(et);a.length>=s;)yield a.slice(0,s),a=a.slice(s);for(;a.length>0;)yield a.slice(0,s),a=a.slice(s)}()}async function*parallelBatch(o,s=1){for await(const a of batch(o,s)){const et=a.map(async tt=>tt().then(rt=>({ok:!0,value:rt}),rt=>({ok:!1,err:rt})));for(let tt=0;tt<et.length;tt++){const rt=await et[tt];if(rt.ok)yield rt.value;else throw rt.err}}}const DEFAULT_CHUNK_SIZE=262144,fixedSize=(o={})=>{const s=o.chunkSize??DEFAULT_CHUNK_SIZE;return async function*(et){let tt=new Uint8ArrayList,rt=0,nt=!1;for await(const it of et)for(tt.append(it),rt+=it.length;rt>=s;)if(yield tt.slice(0,s),nt=!0,s===tt.length)tt=new Uint8ArrayList,rt=0;else{const st=new Uint8ArrayList;st.append(tt.sublist(s)),tt=st,rt-=s}(!nt||rt>0)&&(yield tt.subarray(0,rt))}};var Data;(function(o){(function(et){et.Raw="Raw",et.Directory="Directory",et.File="File",et.Metadata="Metadata",et.Symlink="Symlink",et.HAMTShard="HAMTShard"})(o.DataType||(o.DataType={}));let s;(function(et){et[et.Raw=0]="Raw",et[et.Directory=1]="Directory",et[et.File=2]="File",et[et.Metadata=3]="Metadata",et[et.Symlink=4]="Symlink",et[et.HAMTShard=5]="HAMTShard"})(s||(s={})),function(et){et.codec=()=>enumeration(s)}(o.DataType||(o.DataType={}));let a;o.codec=()=>(a==null&&(a=message((et,tt,rt={})=>{if(rt.lengthDelimited!==!1&&tt.fork(),et.Type!=null&&(tt.uint32(8),o.DataType.codec().encode(et.Type,tt)),et.Data!=null&&(tt.uint32(18),tt.bytes(et.Data)),et.filesize!=null&&(tt.uint32(24),tt.uint64(et.filesize)),et.blocksizes!=null)for(const nt of et.blocksizes)tt.uint32(32),tt.uint64(nt);et.hashType!=null&&(tt.uint32(40),tt.uint64(et.hashType)),et.fanout!=null&&(tt.uint32(48),tt.uint64(et.fanout)),et.mode!=null&&(tt.uint32(56),tt.uint32(et.mode)),et.mtime!=null&&(tt.uint32(66),UnixTime.codec().encode(et.mtime,tt)),rt.lengthDelimited!==!1&&tt.ldelim()},(et,tt)=>{const rt={blocksizes:[]},nt=tt==null?et.len:et.pos+tt;for(;et.pos<nt;){const it=et.uint32();switch(it>>>3){case 1:rt.Type=o.DataType.codec().decode(et);break;case 2:rt.Data=et.bytes();break;case 3:rt.filesize=et.uint64();break;case 4:rt.blocksizes.push(et.uint64());break;case 5:rt.hashType=et.uint64();break;case 6:rt.fanout=et.uint64();break;case 7:rt.mode=et.uint32();break;case 8:rt.mtime=UnixTime.codec().decode(et,et.uint32());break;default:et.skipType(it&7);break}}return rt})),a),o.encode=et=>encodeMessage(et,o.codec()),o.decode=et=>decodeMessage(et,o.codec())})(Data||(Data={}));var UnixTime;(function(o){let s;o.codec=()=>(s==null&&(s=message((a,et,tt={})=>{tt.lengthDelimited!==!1&&et.fork(),a.Seconds!=null&&(et.uint32(8),et.int64(a.Seconds)),a.FractionalNanoseconds!=null&&(et.uint32(21),et.fixed32(a.FractionalNanoseconds)),tt.lengthDelimited!==!1&&et.ldelim()},(a,et)=>{const tt={},rt=et==null?a.len:a.pos+et;for(;a.pos<rt;){const nt=a.uint32();switch(nt>>>3){case 1:tt.Seconds=a.int64();break;case 2:tt.FractionalNanoseconds=a.fixed32();break;default:a.skipType(nt&7);break}}return tt})),s),o.encode=a=>encodeMessage(a,o.codec()),o.decode=a=>decodeMessage(a,o.codec())})(UnixTime||(UnixTime={}));var Metadata;(function(o){let s;o.codec=()=>(s==null&&(s=message((a,et,tt={})=>{tt.lengthDelimited!==!1&&et.fork(),a.MimeType!=null&&(et.uint32(10),et.string(a.MimeType)),tt.lengthDelimited!==!1&&et.ldelim()},(a,et)=>{const tt={},rt=et==null?a.len:a.pos+et;for(;a.pos<rt;){const nt=a.uint32();switch(nt>>>3){case 1:tt.MimeType=a.string();break;default:a.skipType(nt&7);break}}return tt})),s),o.encode=a=>encodeMessage(a,o.codec()),o.decode=a=>decodeMessage(a,o.codec())})(Metadata||(Metadata={}));const types$1={Raw:"raw",Directory:"directory",File:"file",Metadata:"metadata",Symlink:"symlink",HAMTShard:"hamt-sharded-directory"},dirTypes=["directory","hamt-sharded-directory"],DEFAULT_FILE_MODE=parseInt("0644",8),DEFAULT_DIRECTORY_MODE=parseInt("0755",8);let UnixFS$1=class Io{static unmarshal(s){const a=Data.decode(s),et=new Io({type:types$1[a.Type!=null?a.Type.toString():"File"],data:a.Data,blockSizes:a.blocksizes,mode:a.mode,mtime:a.mtime!=null?{secs:a.mtime.Seconds??0n,nsecs:a.mtime.FractionalNanoseconds}:void 0,fanout:a.fanout});return et._originalMode=a.mode??0,et}type;data;blockSizes;hashType;fanout;mtime;_mode;_originalMode;constructor(s={type:"file"}){const{type:a,data:et,blockSizes:tt,hashType:rt,fanout:nt,mtime:it,mode:st}=s;if(a!=null&&!Object.values(types$1).includes(a))throw errCode$1(new Error("Type: "+a+" is not valid"),"ERR_INVALID_TYPE");this.type=a??"file",this.data=et,this.hashType=rt,this.fanout=nt,this.blockSizes=tt??[],this._originalMode=0,this.mode=st,this.mtime=it}set mode(s){s==null?this._mode=this.isDirectory()?DEFAULT_DIRECTORY_MODE:DEFAULT_FILE_MODE:this._mode=s&4095}get mode(){return this._mode}isDirectory(){return dirTypes.includes(this.type)}addBlockSize(s){this.blockSizes.push(s)}removeBlockSize(s){this.blockSizes.splice(s,1)}fileSize(){if(this.isDirectory())return 0n;let s=0n;return this.blockSizes.forEach(a=>{s+=a}),this.data!=null&&(s+=BigInt(this.data.length)),s}marshal(){let s;switch(this.type){case"raw":s=Data.DataType.Raw;break;case"directory":s=Data.DataType.Directory;break;case"file":s=Data.DataType.File;break;case"metadata":s=Data.DataType.Metadata;break;case"symlink":s=Data.DataType.Symlink;break;case"hamt-sharded-directory":s=Data.DataType.HAMTShard;break;default:throw errCode$1(new Error(`Type: ${s} is not valid`),"ERR_INVALID_TYPE")}let a=this.data;(this.data==null||this.data.length===0)&&(a=void 0);let et;this.mode!=null&&(et=this._originalMode&4294963200|(this.mode??0),et===DEFAULT_FILE_MODE&&!this.isDirectory()&&(et=void 0),et===DEFAULT_DIRECTORY_MODE&&this.isDirectory()&&(et=void 0));let tt;return this.mtime!=null&&(tt={Seconds:this.mtime.secs,FractionalNanoseconds:this.mtime.nsecs}),Data.encode({Type:s,Data:a,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:et,mtime:tt})}};const persist$1=async(o,s,a)=>{a.codec==null&&(a.codec=dagPB);const et=await sha256$1.digest(o),tt=CID.create(a.cidVersion,a.codec.code,et);return await s.put(tt,o,a),tt};function defaultBufferImporter(o){return async function*(a,et){let tt=0n;for await(let rt of a.content)yield async()=>{let nt;const it={codec:dagPB,cidVersion:o.cidVersion,onProgress:o.onProgress};o.rawLeaves?(it.codec=raw,it.cidVersion=1):(nt=new UnixFS$1({type:o.leafType,data:rt}),rt=encode$4({Data:nt.marshal(),Links:[]}));const st=await persist$1(rt,et,it);return tt+=BigInt(rt.byteLength),o.onProgress?.(new CustomProgressEvent("unixfs:importer:progress:file:write",{bytesWritten:tt,cid:st,path:a.path})),{cid:st,unixfs:nt,size:BigInt(rt.length),block:rt}}}}const dirBuilder=async(o,s,a)=>{const et=new UnixFS$1({type:"directory",mtime:o.mtime,mode:o.mode}),tt=encode$4(prepare$1({Data:et.marshal()})),rt=await persist$1(tt,s,a),nt=o.path;return{cid:rt,path:nt,unixfs:et,size:BigInt(tt.length),originalPath:o.originalPath,block:tt}};async function*buildFileBatch(o,s,a){let et=-1,tt;for await(const rt of parallelBatch(a.bufferImporter(o,s),a.blockWriteConcurrency)){if(et++,et===0){tt={...rt,single:!0};continue}else et===1&&tt!=null&&(yield{...tt,block:void 0,single:void 0},tt=void 0);yield{...rt,block:void 0}}tt!=null&&(yield tt)}function isSingleBlockImport(o){return o.single===!0}const reduce=(o,s,a)=>async function(tt){if(tt.length===1&&isSingleBlockImport(tt[0])&&a.reduceSingleLeafToSelf){const at=tt[0];let lt=at.block;return isSingleBlockImport(at)&&(o.mtime!==void 0||o.mode!==void 0)&&(at.unixfs=new UnixFS$1({type:"file",mtime:o.mtime,mode:o.mode,data:at.block}),lt={Data:at.unixfs.marshal(),Links:[]},at.block=encode$4(prepare$1(lt)),at.cid=await persist$1(at.block,s,{...a,cidVersion:a.cidVersion}),at.size=BigInt(at.block.length)),a.onProgress?.(new CustomProgressEvent("unixfs:importer:progress:file:layout",{cid:at.cid,path:at.originalPath})),{cid:at.cid,path:o.path,unixfs:at.unixfs,size:at.size,originalPath:at.originalPath}}const rt=new UnixFS$1({type:"file",mtime:o.mtime,mode:o.mode}),nt=tt.filter(at=>at.cid.code===code$4&&at.size>0||at.unixfs!=null&&at.unixfs.data==null&&at.unixfs.fileSize()>0n?!0:!!at.unixfs?.data?.length).map(at=>at.cid.code===code$4?(rt.addBlockSize(at.size),{Name:"",Tsize:Number(at.size),Hash:at.cid}):(at.unixfs==null||at.unixfs.data==null?rt.addBlockSize(at.unixfs?.fileSize()??0n):rt.addBlockSize(BigInt(at.unixfs.data.length)),{Name:"",Tsize:Number(at.size),Hash:at.cid})),it={Data:rt.marshal(),Links:nt},st=encode$4(prepare$1(it)),ot=await persist$1(st,s,a);return a.onProgress?.(new CustomProgressEvent("unixfs:importer:progress:file:layout",{cid:ot,path:o.originalPath})),{cid:ot,path:o.path,unixfs:rt,size:BigInt(st.length+it.Links.reduce((at,lt)=>at+(lt.Tsize??0),0)),originalPath:o.originalPath,block:st}},fileBuilder=async(o,s,a)=>a.layout(buildFileBatch(o,s,a),reduce(o,s,a));function isIterable(o){return Symbol.iterator in o}function isAsyncIterable$2(o){return Symbol.asyncIterator in o}function contentAsAsyncIterable(o){try{if(o instanceof Uint8Array)return async function*(){yield o}();if(isIterable(o))return async function*(){yield*o}();if(isAsyncIterable$2(o))return o}catch{throw errCode$1(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}throw errCode$1(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}function defaultDagBuilder(o){return async function*(a,et){for await(const tt of a){let rt;if(tt.path!=null&&(rt=tt.path,tt.path=tt.path.split("/").filter(nt=>nt!=null&&nt!==".").join("/")),isFileCandidate(tt)){const nt={path:tt.path,mtime:tt.mtime,mode:tt.mode,content:async function*(){let it=0n;for await(const st of o.chunker(o.chunkValidator(contentAsAsyncIterable(tt.content)))){const ot=BigInt(st.byteLength);it+=ot,o.onProgress?.(new CustomProgressEvent("unixfs:importer:progress:file:read",{bytesRead:it,chunkSize:ot,path:tt.path})),yield st}}(),originalPath:rt};yield async()=>fileBuilder(nt,et,o)}else if(tt.path!=null){const nt={path:tt.path,mtime:tt.mtime,mode:tt.mode,originalPath:rt};yield async()=>dirBuilder(nt,et,o)}else throw new Error("Import candidate must have content or path or both")}}}function isFileCandidate(o){return o.content!=null}function allocUnsafe$4(o=0){return new Uint8Array(o)}function createCodec$4(o,s,a,et){return{name:o,prefix:s,encoder:{name:o,prefix:s,encode:a},decoder:{decode:et}}}const string$4=createCodec$4("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),ascii$4=createCodec$4("ascii","a",o=>{let s="a";for(let a=0;a<o.length;a++)s+=String.fromCharCode(o[a]);return s},o=>{o=o.substring(1);const s=allocUnsafe$4(o.length);for(let a=0;a<o.length;a++)s[a]=o.charCodeAt(a);return s}),BASES$4={utf8:string$4,"utf-8":string$4,hex:bases.base16,latin1:ascii$4,ascii:ascii$4,binary:ascii$4,...bases};function fromString$4(o,s="utf8"){const a=BASES$4[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.decoder.decode(`${a.prefix}${o}`)}const defaultChunkValidator=()=>async function*(s){for await(const a of s){if(a.length===void 0)throw errCode$1(new Error("Content was invalid"),"ERR_INVALID_CONTENT");if(typeof a=="string"||a instanceof String)yield fromString$4(a.toString());else if(Array.isArray(a))yield Uint8Array.from(a);else if(a instanceof Uint8Array)yield a;else throw errCode$1(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}},DEFAULT_MAX_CHILDREN_PER_NODE=174;function balanced(o){const s=o?.maxChildrenPerNode??DEFAULT_MAX_CHILDREN_PER_NODE;return async function a(et,tt){const rt=[];for await(const nt of batch(et,s))rt.push(await tt(nt));return rt.length>1?a(rt,tt):rt[0]}}let Dir$1=class{options;root;dir;path;dirty;flat;parent;parentKey;unixfs;mode;mtime;cid;size;nodeSize;constructor(s,a){this.options=a??{},this.root=s.root,this.dir=s.dir,this.path=s.path,this.dirty=s.dirty,this.flat=s.flat,this.parent=s.parent,this.parentKey=s.parentKey,this.unixfs=s.unixfs,this.mode=s.mode,this.mtime=s.mtime}};const CID_V0$1=CID.parse("QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn"),CID_V1$1=CID.parse("zdj7WbTaiJT1fgatdet9Ei9iDB5hdCxkbVyhyh8YTUnXMiwYi");class DirFlat extends Dir$1{_children;constructor(s,a){super(s,a),this._children=new Map}async put(s,a){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,this._children.set(s,a)}async get(s){return Promise.resolve(this._children.get(s))}childCount(){return this._children.size}directChildrenCount(){return this.childCount()}onlyChild(){return this._children.values().next().value}async*eachChildSeries(){for(const[s,a]of this._children.entries())yield{key:s,child:a}}estimateNodeSize(){if(this.nodeSize!==void 0)return this.nodeSize;this.nodeSize=0;for(const[s,a]of this._children.entries())a.size!=null&&a.cid!=null&&(this.nodeSize+=s.length+(this.options.cidVersion===1?CID_V1$1.bytes.byteLength:CID_V0$1.bytes.byteLength));return this.nodeSize}async*flush(s){const a=[];for(const[st,ot]of this._children.entries()){let at=ot;if(ot instanceof Dir$1)for await(const lt of ot.flush(s))at=lt,yield lt;at.size!=null&&at.cid!=null&&a.push({Name:st,Tsize:Number(at.size),Hash:at.cid})}const et=new UnixFS$1({type:"directory",mtime:this.mtime,mode:this.mode}),tt={Data:et.marshal(),Links:a},rt=encode$4(prepare$1(tt)),nt=await persist$1(rt,s,this.options),it=rt.length+tt.Links.reduce((st,ot)=>st+(ot.Tsize==null?0:ot.Tsize),0);this.cid=nt,this.size=it,yield{cid:nt,unixfs:et,path:this.path,size:BigInt(it)}}}const murmur3128=from$1({name:"murmur3-128",code:34,encode:o=>fromHex(mur.x64.hash128(o))}),BITS_PER_BYTE=7;var sparseArray=class{constructor(){this._bitArrays=[],this._data=[],this._length=0,this._changedLength=!1,this._changedData=!1}set(s,a){let et=this._internalPositionFor(s,!1);if(a===void 0)et!==-1&&(this._unsetInternalPos(et),this._unsetBit(s),this._changedLength=!0,this._changedData=!0);else{let tt=!1;et===-1?(et=this._data.length,this._setBit(s),this._changedData=!0):tt=!0,this._setInternalPos(et,s,a,tt),this._changedLength=!0}}unset(s){this.set(s,void 0)}get(s){this._sortData();const a=this._internalPositionFor(s,!0);if(a!==-1)return this._data[a][1]}push(s){return this.set(this.length,s),this.length}get length(){if(this._sortData(),this._changedLength){const s=this._data[this._data.length-1];this._length=s?s[0]+1:0,this._changedLength=!1}return this._length}forEach(s){let a=0;for(;a<this.length;)s(this.get(a),a,this),a++}map(s){let a=0,et=new Array(this.length);for(;a<this.length;)et[a]=s(this.get(a),a,this),a++;return et}reduce(s,a){let et=0,tt=a;for(;et<this.length;){const rt=this.get(et);tt=s(tt,rt,et),et++}return tt}find(s){let a=0,et,tt;for(;a<this.length&&!et;)tt=this.get(a),et=s(tt),a++;return et?tt:void 0}_internalPositionFor(s,a){const et=this._bytePosFor(s,a);if(et>=this._bitArrays.length)return-1;const tt=this._bitArrays[et],rt=s-et*BITS_PER_BYTE;if(!((tt&1<<rt)>0))return-1;const it=this._bitArrays.slice(0,et).reduce(popCountReduce,0),st=~(4294967295<<rt+1),ot=popCount(tt&st);return it+ot-1}_bytePosFor(s,a){const et=Math.floor(s/BITS_PER_BYTE),tt=et+1;for(;!a&&this._bitArrays.length<tt;)this._bitArrays.push(0);return et}_setBit(s){const a=this._bytePosFor(s,!1);this._bitArrays[a]|=1<<s-a*BITS_PER_BYTE}_unsetBit(s){const a=this._bytePosFor(s,!1);this._bitArrays[a]&=~(1<<s-a*BITS_PER_BYTE)}_setInternalPos(s,a,et,tt){const rt=this._data,nt=[a,et];if(tt)this._sortData(),rt[s]=nt;else{if(rt.length)if(rt[rt.length-1][0]>=a)rt.push(nt);else if(rt[0][0]<=a)rt.unshift(nt);else{const it=Math.round(rt.length/2);this._data=rt.slice(0,it).concat(nt).concat(rt.slice(it))}else this._data.push(nt);this._changedData=!0,this._changedLength=!0}}_unsetInternalPos(s){this._data.splice(s,1)}_sortData(){this._changedData&&this._data.sort(sortInternal),this._changedData=!1}bitField(){const s=[];let a=8,et=0,tt=0,rt;const nt=this._bitArrays.slice();for(;nt.length||et;){et===0&&(rt=nt.shift(),et=7);const st=Math.min(et,a),ot=~(255<<st),at=rt&ot;tt|=at<<8-a,rt=rt>>>st,et-=st,a-=st,(!a||!et&&!nt.length)&&(s.push(tt),tt=0,a=8)}for(var it=s.length-1;it>0&&s[it]===0;it--)s.pop();return s}compactArray(){return this._sortData(),this._data.map(valueOnly)}};function popCountReduce(o,s){return o+popCount(s)}function popCount(o){let s=o;return s=s-(s>>1&1431655765),s=(s&858993459)+(s>>2&858993459),(s+(s>>4)&252645135)*16843009>>24}function sortInternal(o,s){return o[0]-s[0]}function valueOnly(o){return o[1]}const SparseArray=getDefaultExportFromCjs$2(sparseArray);function allocUnsafe$3(o=0){return new Uint8Array(o)}function createCodec$3(o,s,a,et){return{name:o,prefix:s,encoder:{name:o,prefix:s,encode:a},decoder:{decode:et}}}const string$3=createCodec$3("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),ascii$3=createCodec$3("ascii","a",o=>{let s="a";for(let a=0;a<o.length;a++)s+=String.fromCharCode(o[a]);return s},o=>{o=o.substring(1);const s=allocUnsafe$3(o.length);for(let a=0;a<o.length;a++)s[a]=o.charCodeAt(a);return s}),BASES$3={utf8:string$3,"utf-8":string$3,hex:bases.base16,latin1:ascii$3,ascii:ascii$3,binary:ascii$3,...bases};function fromString$3(o,s="utf8"){const a=BASES$3[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.decoder.decode(`${a.prefix}${o}`)}class Bucket{_options;_popCount;_parent;_posAtParent;_children;key;constructor(s,a,et=0){this._options=s,this._popCount=0,this._parent=a,this._posAtParent=et,this._children=new SparseArray,this.key=null}async put(s,a){const et=await this._findNewBucketAndPos(s);et.bucket._putAt(et,s,a)}async get(s){const a=await this._findChild(s);if(a!=null)return a.value}async del(s){const a=await this._findPlace(s),et=a.bucket._at(a.pos);et!=null&&et.key===s&&a.bucket._delAt(a.pos)}leafCount(){return this._children.compactArray().reduce((a,et)=>et instanceof Bucket?a+et.leafCount():a+1,0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){const s=this._children.compactArray();for(const a of s)a instanceof Bucket?yield*a.eachLeafSeries():yield a}serialize(s,a){const et=[];return a(this._children.reduce((tt,rt,nt)=>(rt!=null&&(rt instanceof Bucket?tt.push(rt.serialize(s,a)):tt.push(s(rt,nt))),tt),et))}async asyncTransform(s,a){return asyncTransformBucket(this,s,a)}toJSON(){return this.serialize(mapNode,reduceNodes)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(s){const a=await this._findPlace(s),et=a.bucket._at(a.pos);if(!(et instanceof Bucket)&&et!=null&&et.key===s)return et}async _findPlace(s){const a=this._options.hash(typeof s=="string"?fromString$3(s):s),et=await a.take(this._options.bits),tt=this._children.get(et);return tt instanceof Bucket?tt._findPlace(a):{bucket:this,pos:et,hash:a,existingChild:tt}}async _findNewBucketAndPos(s){const a=await this._findPlace(s);if(a.existingChild!=null&&a.existingChild.key!==s){const et=new Bucket(this._options,a.bucket,a.pos);a.bucket._putObjectAt(a.pos,et);const tt=await et._findPlace(a.existingChild.hash);return tt.bucket._putAt(tt,a.existingChild.key,a.existingChild.value),et._findNewBucketAndPos(a.hash)}return a}_putAt(s,a,et){this._putObjectAt(s.pos,{key:a,value:et,hash:s.hash})}_putObjectAt(s,a){this._children.get(s)==null&&this._popCount++,this._children.set(s,a)}_delAt(s){if(s===-1)throw new Error("Invalid position");this._children.get(s)!=null&&this._popCount--,this._children.unset(s),this._level()}_level(){if(this._parent!=null&&this._popCount<=1)if(this._popCount===1){const s=this._children.find(exists);if(s!=null&&!(s instanceof Bucket)){const a=s.hash;a.untake(this._options.bits);const et={pos:this._posAtParent,hash:a,bucket:this._parent};this._parent._putAt(et,s.key,s.value)}}else this._parent._delAt(this._posAtParent)}_at(s){return this._children.get(s)}}function exists(o){return!!o}function mapNode(o,s){return o.key}function reduceNodes(o){return o}async function asyncTransformBucket(o,s,a){const et=[];for(const tt of o._children.compactArray())if(tt instanceof Bucket)await asyncTransformBucket(tt,s,a);else{const rt=await s(tt);et.push({bitField:o._children.bitField(),children:rt})}return a(et)}function asUint8Array$3(o){return o}function concat$2(o,s){s==null&&(s=o.reduce((tt,rt)=>tt+rt.length,0));const a=allocUnsafe$3(s);let et=0;for(const tt of o)a.set(tt,et),et+=tt.length;return a}const START_MASKS$1=[255,254,252,248,240,224,192,128],STOP_MASKS$1=[1,3,7,15,31,63,127,255];let ConsumableBuffer$1=class{_value;_currentBytePos;_currentBitPos;constructor(s){this._value=s,this._currentBytePos=s.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+this._currentBytePos*8}totalBits(){return this._value.length*8}take(s){let a=s,et=0;for(;a>0&&this._haveBits();){const tt=this._value[this._currentBytePos],rt=this._currentBitPos+1,nt=Math.min(rt,a),it=byteBitsToInt$1(tt,rt-nt,nt);et=(et<<nt)+it,a-=nt,this._currentBitPos-=nt,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return et}untake(s){for(this._currentBitPos+=s;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}};function byteBitsToInt$1(o,s,a){const et=maskFor$1(s,a);return(o&et)>>>s}function maskFor$1(o,s){return START_MASKS$1[o]&STOP_MASKS$1[Math.min(s+o-1,7)]}function wrapHash$1(o){function s(a){return a instanceof InfiniteHash$1?a:new InfiniteHash$1(a,o)}return s}let InfiniteHash$1=class{_value;_hashFn;_depth;_availableBits;_currentBufferIndex;_buffers;constructor(s,a){if(!(s instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=s,this._hashFn=a,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(s){let a=s;for(;this._availableBits<a;)await this._produceMoreBits();let et=0;for(;a>0;){const tt=this._buffers[this._currentBufferIndex],rt=Math.min(tt.availableBits(),a),nt=tt.take(rt);et=(et<<rt)+nt,a-=rt,this._availableBits-=rt,tt.availableBits()===0&&this._currentBufferIndex++}return et}untake(s){let a=s;for(;a>0;){const et=this._buffers[this._currentBufferIndex],tt=Math.min(et.totalBits()-et.availableBits(),a);et.untake(tt),a-=tt,this._availableBits+=tt,this._currentBufferIndex>0&&et.totalBits()===et.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;const s=this._depth>0?concat$2([this._value,Uint8Array.from([this._depth])]):this._value,a=await this._hashFn(s),et=new ConsumableBuffer$1(a);this._buffers.push(et),this._availableBits+=et.availableBits()}};function createHAMT(o){if(o==null||o.hashFn==null)throw new Error("please define an options.hashFn");const s={bits:o.bits??8,hash:wrapHash$1(o.hashFn)};return new Bucket(s)}async function hamtHashFn$1(o){return(await murmur3128.encode(o)).slice(0,8).reverse()}const HAMT_HASH_CODE=BigInt(34),DEFAULT_FANOUT_BITS=8;let DirSharded$1=class extends Dir$1{_bucket;constructor(s,a){super(s,a),this._bucket=createHAMT({hashFn:hamtHashFn$1,bits:a.shardFanoutBits??DEFAULT_FANOUT_BITS})}async put(s,a){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,await this._bucket.put(s,a)}async get(s){return this._bucket.get(s)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(const{key:s,value:a}of this._bucket.eachLeafSeries())yield{key:s,child:a}}estimateNodeSize(){return this.nodeSize!==void 0?this.nodeSize:(this.nodeSize=calculateSize$1(this._bucket,this,this.options),this.nodeSize)}async*flush(s){for await(const a of flush$1(this._bucket,s,this,this.options))yield{...a,path:this.path}}};async function*flush$1(o,s,a,et){const tt=o._children,rt=(o.tableSize()-1).toString(16).length,nt=[];let it=0n;for(let ft=0;ft<tt.length;ft++){const dt=tt.get(ft);if(dt==null)continue;const pt=ft.toString(16).toUpperCase().padStart(rt,"0");if(dt instanceof Bucket){let gt;for await(const mt of flush$1(dt,s,null,et))gt=mt;if(gt==null)throw new Error("Could not flush sharded directory, no subshard found");nt.push({Name:pt,Tsize:Number(gt.size),Hash:gt.cid}),it+=gt.size}else if(isDir$1(dt.value)){const gt=dt.value;let mt;for await(const vt of gt.flush(s))mt=vt,yield mt;if(mt==null)throw new Error("Did not flush dir");const yt=pt+dt.key;nt.push({Name:yt,Tsize:Number(mt.size),Hash:mt.cid}),it+=mt.size}else{const gt=dt.value;if(gt.cid==null)continue;const mt=pt+dt.key,yt=gt.size;nt.push({Name:mt,Tsize:Number(yt),Hash:gt.cid}),it+=BigInt(yt??0)}}const st=Uint8Array.from(tt.bitField().reverse()),ot=new UnixFS$1({type:"hamt-sharded-directory",data:st,fanout:BigInt(o.tableSize()),hashType:HAMT_HASH_CODE,mtime:a?.mtime,mode:a?.mode}),at={Data:ot.marshal(),Links:nt},lt=encode$4(prepare$1(at)),ct=await persist$1(lt,s,et),ht=BigInt(lt.byteLength)+it;yield{cid:ct,unixfs:ot,size:ht}}function isDir$1(o){return typeof o.flush=="function"}function calculateSize$1(o,s,a){const et=o._children,tt=(o.tableSize()-1).toString(16).length,rt=[];for(let ot=0;ot<et.length;ot++){const at=et.get(ot);if(at==null)continue;const lt=ot.toString(16).toUpperCase().padStart(tt,"0");if(at instanceof Bucket){const ct=calculateSize$1(at,null,a);rt.push({Name:lt,Tsize:Number(ct),Hash:a.cidVersion===0?CID_V0$1:CID_V1$1})}else if(typeof at.value.flush=="function"){const ht=at.value.nodeSize();rt.push({Name:lt+at.key,Tsize:Number(ht),Hash:a.cidVersion===0?CID_V0$1:CID_V1$1})}else{const ct=at.value;if(ct.cid==null)continue;const ht=lt+at.key,ft=ct.size;rt.push({Name:ht,Tsize:Number(ft),Hash:ct.cid})}}const nt=Uint8Array.from(et.bitField().reverse()),it=new UnixFS$1({type:"hamt-sharded-directory",data:nt,fanout:BigInt(o.tableSize()),hashType:HAMT_HASH_CODE,mtime:s?.mtime,mode:s?.mode});return encode$4(prepare$1({Data:it.marshal(),Links:rt})).length}async function flatToShard(o,s,a,et){let tt=s;s instanceof DirFlat&&s.estimateNodeSize()>a&&(tt=await convertToShard(s,et));const rt=tt.parent;if(rt!=null){if(tt!==s){if(o!=null&&(o.parent=tt),tt.parentKey==null)throw new Error("No parent key found");await rt.put(tt.parentKey,tt)}return flatToShard(tt,rt,a,et)}return tt}async function convertToShard(o,s){const a=new DirSharded$1({root:o.root,dir:!0,parent:o.parent,parentKey:o.parentKey,path:o.path,dirty:o.dirty,flat:!1,mtime:o.mtime,mode:o.mode},s);for await(const{key:et,child:tt}of o.eachChildSeries())await a.put(et,tt);return a}const toPathComponents$1=(o="")=>o.split(/(?<!\\)\//).filter(Boolean);async function addToTree(o,s,a){const et=toPathComponents$1(o.path??""),tt=et.length-1;let rt=s,nt="";for(let it=0;it<et.length;it++){const st=et[it];nt+=`${nt!==""?"/":""}${st}`;const ot=it===tt;if(rt.dirty=!0,rt.cid=void 0,rt.size=void 0,ot)await rt.put(st,o),s=await flatToShard(null,rt,a.shardSplitThresholdBytes,a);else{let at=await rt.get(st);(at==null||!(at instanceof Dir$1))&&(at=new DirFlat({root:!1,dir:!0,parent:rt,parentKey:st,path:nt,dirty:!0,flat:!0,mtime:at?.unixfs?.mtime,mode:at?.unixfs?.mode},a)),await rt.put(st,at),rt=at}}return s}async function*flushAndYield(o,s){if(!(o instanceof Dir$1)){o.unixfs?.isDirectory()===!0&&(yield o);return}yield*o.flush(s)}function defaultTreeBuilder(o){return async function*(a,et){let tt=new DirFlat({root:!0,dir:!0,path:"",dirty:!0,flat:!0},o),rt,nt=!1;for await(const it of a){if(it==null)continue;const st=`${it.originalPath??""}`.split("/")[0];st!=null&&st!==""&&(rt==null?(rt=st,nt=!0):rt!==st&&(nt=!1)),tt=await addToTree(it,tt,o),(it.unixfs==null||!it.unixfs.isDirectory())&&(yield it)}if(o.wrapWithDirectory||nt&&tt.childCount()>1)yield*flushAndYield(tt,et);else for await(const it of tt.eachChildSeries())it!=null&&(yield*flushAndYield(it.child,et))}}async function*importer(o,s,a={}){let et;Symbol.asyncIterator in o||Symbol.iterator in o?et=o:et=[o];const tt=a.wrapWithDirectory??!1,rt=a.shardSplitThresholdBytes??262144,nt=a.shardFanoutBits??8,it=a.cidVersion??1,st=a.rawLeaves??!0,ot=a.leafType??"file",at=a.fileImportConcurrency??50,lt=a.blockWriteConcurrency??10,ct=a.reduceSingleLeafToSelf??!0,ht=a.chunker??fixedSize(),ft=a.chunkValidator??defaultChunkValidator(),dt=a.dagBuilder??defaultDagBuilder({chunker:ht,chunkValidator:ft,wrapWithDirectory:tt,layout:a.layout??balanced(),bufferImporter:a.bufferImporter??defaultBufferImporter({cidVersion:it,rawLeaves:st,leafType:ot,onProgress:a.onProgress}),blockWriteConcurrency:lt,reduceSingleLeafToSelf:ct,cidVersion:it,onProgress:a.onProgress}),pt=a.treeBuilder??defaultTreeBuilder({wrapWithDirectory:tt,shardSplitThresholdBytes:rt,shardFanoutBits:nt,cidVersion:it,onProgress:a.onProgress});for await(const gt of pt(parallelBatch(dt(et,s),at),s))yield{cid:gt.cid,path:gt.path,unixfs:gt.unixfs,size:gt.size}}async function importFile(o,s,a={}){const et=await first(importer([o],s,a));if(et==null)throw errCode$1(new Error("Nothing imported"),"ERR_INVALID_PARAMS");return et}async function importDirectory(o,s,a={}){const et=await first(importer([o],s,a));if(et==null)throw errCode$1(new Error("Nothing imported"),"ERR_INVALID_PARAMS");return et}async function importBytes(o,s,a={}){return importFile({content:o},s,a)}async function importByteStream(o,s,a={}){return importFile({content:o},s,a)}const defaultImporterSettings={cidVersion:1,rawLeaves:!0,layout:balanced({maxChildrenPerNode:1024}),chunker:fixedSize({chunkSize:1048576})};async function*addAll(o,s,a={}){yield*importer(o,s,{...defaultImporterSettings,...a})}async function addBytes(o,s,a={}){const{cid:et}=await importBytes(o,s,{...defaultImporterSettings,...a});return et}async function addByteStream(o,s,a={}){const{cid:et}=await importByteStream(o,s,{...defaultImporterSettings,...a});return et}async function addFile(o,s,a={}){const{cid:et}=await importFile(o,s,{...defaultImporterSettings,...a});return et}async function addDirectory(o,s,a={}){const{cid:et}=await importDirectory({...o,path:o.path??"-"},s,{...defaultImporterSettings,...a});return et}function isAsyncIterable$1(o){return o[Symbol.asyncIterator]!=null}function last$1(o){if(isAsyncIterable$1(o))return(async()=>{let a;for await(const et of o)a=et;return a})();let s;for(const a of o)s=a;return s}function resolveObjectPath(o,s,a,et,tt,rt,nt){let it=o,st=tt;for(;rt.length>0;){const ot=rt[0];if(ot in it){rt.shift(),st=`${st}/${ot}`;const at=CID.asCID(it[ot]);if(at!=null)return{entry:{type:"object",name:et,path:tt,cid:a,node:s,depth:nt,size:BigInt(s.length),content:async function*(){yield o}},next:{cid:at,name:ot,path:st,toResolve:rt}};it=it[ot]}else throw errCode$1(new Error(`No property named ${ot} found in node ${a}`),"ERR_NO_PROP")}return{entry:{type:"object",name:et,path:tt,cid:a,node:s,depth:nt,size:BigInt(s.length),content:async function*(){yield o}}}}const resolve$6=async(o,s,a,et,tt,rt,nt,it)=>{const st=await nt.get(o,it),ot=decode$6(st);return resolveObjectPath(ot,st,o,s,a,et,rt)},resolve$5=async(o,s,a,et,tt,rt,nt,it)=>{const st=await nt.get(o,it),ot=decode$4(st);return resolveObjectPath(ot,st,o,s,a,et,rt)};function extractDataFromBlock(o,s,a,et){const tt=BigInt(o.length),rt=BigInt(s+tt);return a>=rt||et<s?new Uint8Array(0):(et>=s&&et<rt&&(o=o.subarray(0,Number(et-s))),a>=s&&a<rt&&(o=o.subarray(Number(a-s))),o)}const validateOffsetAndLength=(o,s=0,a=o)=>{const et=BigInt(o),tt=BigInt(s??0);let rt=BigInt(a);if(rt!==et&&(rt=tt+rt),rt>et&&(rt=et),tt<0n)throw errCode$1(new Error("Offset must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(tt>et)throw errCode$1(new Error("Offset must be less than the file size"),"ERR_INVALID_PARAMS");if(rt<0n)throw errCode$1(new Error("Length must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(rt>et)throw errCode$1(new Error("Length must be less than the file size"),"ERR_INVALID_PARAMS");return{start:tt,end:rt}},rawContent$1=o=>{async function*s(a={}){const{start:et,end:tt}=validateOffsetAndLength(o.length,a.offset,a.length),rt=extractDataFromBlock(o,0n,et,tt);a.onProgress?.(new CustomProgressEvent("unixfs:exporter:progress:identity",{bytesRead:BigInt(rt.byteLength),totalBytes:tt-et,fileSize:BigInt(o.byteLength)})),yield rt}return s},resolve$4=async(o,s,a,et,tt,rt,nt,it)=>{if(et.length>0)throw errCode$1(new Error(`No link named ${a} found in raw node ${o}`),"ERR_NOT_FOUND");const st=decode$8(o.multihash.bytes);return{entry:{type:"identity",name:s,path:a,cid:o,content:rawContent$1(st.digest),depth:rt,size:BigInt(st.digest.length),node:st.digest}}},resolve$3=async(o,s,a,et,tt,rt,nt,it)=>{const st=await nt.get(o,it),ot=decode$c(st);return resolveObjectPath(ot,st,o,s,a,et,rt)},rawContent=o=>{async function*s(a={}){const{start:et,end:tt}=validateOffsetAndLength(o.length,a.offset,a.length),rt=extractDataFromBlock(o,0n,et,tt);a.onProgress?.(new CustomProgressEvent("unixfs:exporter:progress:raw",{bytesRead:BigInt(rt.byteLength),totalBytes:tt-et,fileSize:BigInt(o.byteLength)})),yield rt}return s},resolve$2=async(o,s,a,et,tt,rt,nt,it)=>{if(et.length>0)throw errCode$1(new Error(`No link named ${a} found in raw node ${o}`),"ERR_NOT_FOUND");const st=await nt.get(o,it);return{entry:{type:"raw",name:s,path:a,cid:o,content:rawContent(st),depth:rt,size:BigInt(st.length),node:st}}},hashFn=async function(o){return(await murmur3128.encode(o)).slice(0,8).reverse()},addLinksToHamtBucket=async(o,s,a)=>{const et=(s.tableSize()-1).toString(16).length;await Promise.all(o.map(async tt=>{if(tt.Name==null)throw new Error("Unexpected Link without a Name");if(tt.Name.length===et){const rt=parseInt(tt.Name,16);s._putObjectAt(rt,new Bucket({hash:a._options.hash,bits:a._options.bits},s,rt));return}await a.put(tt.Name.substring(2),!0)}))},toPrefix$1=(o,s)=>o.toString(16).toUpperCase().padStart(s,"0").substring(0,s),toBucketPath=o=>{let s=o.bucket;const a=[];for(;s._parent!=null;)a.push(s),s=s._parent;return a.push(s),a.reverse()},findShardCid=async(o,s,a,et,tt)=>{if(et==null){if(o.Data==null)throw errCode$1(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let lt;try{lt=UnixFS$1.unmarshal(o.Data)}catch(ht){throw errCode$1(ht,"ERR_NOT_UNIXFS")}if(lt.type!=="hamt-sharded-directory")throw errCode$1(new Error("not a HAMT"),"ERR_NOT_UNIXFS");if(lt.fanout==null)throw errCode$1(new Error("missing fanout"),"ERR_NOT_UNIXFS");const ct=createHAMT({hashFn,bits:Math.log2(Number(lt.fanout))});et={rootBucket:ct,hamtDepth:1,lastBucket:ct}}const rt=(et.lastBucket.tableSize()-1).toString(16).length;await addLinksToHamtBucket(o.Links,et.lastBucket,et.rootBucket);const nt=await et.rootBucket._findNewBucketAndPos(s);let it=toPrefix$1(nt.pos,rt);const st=toBucketPath(nt);st.length>et.hamtDepth&&(et.lastBucket=st[et.hamtDepth],it=toPrefix$1(et.lastBucket._posAtParent,rt));const ot=o.Links.find(lt=>{if(lt.Name==null)return!1;const ct=lt.Name.substring(0,rt),ht=lt.Name.substring(rt);return!(ct!==it||ht!==""&&ht!==s)});if(ot==null)return;if(ot.Name!=null&&ot.Name.substring(rt)===s)return ot.Hash;et.hamtDepth++;const at=await a.get(ot.Hash,tt);return o=decode$3(at),findShardCid(o,s,a,et,tt)},directoryContent=(o,s,a,et,tt,rt,nt)=>{async function*it(st={}){const ot=st.offset??0,at=st.length??s.Links.length,lt=s.Links.slice(ot,at);st.onProgress?.(new CustomProgressEvent("unixfs:exporter:walk:directory",{cid:o})),yield*pipe(lt,ct=>map$1(ct,ht=>async()=>{const ft=ht.Name??"",dt=`${et}/${ft}`;return(await tt(ht.Hash,ft,dt,[],rt+1,nt,st)).entry}),ct=>parallel(ct,{ordered:!0,concurrency:st.blockReadConcurrency}),ct=>filter(ct,ht=>ht!=null))}return it};async function walkDAG(o,s,a,et,tt,rt,nt){if(s instanceof Uint8Array){const ot=extractDataFromBlock(s,et,tt,rt);a.push(ot);return}if(s.Data==null)throw errCode$1(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let it;try{it=UnixFS$1.unmarshal(s.Data)}catch(ot){throw errCode$1(ot,"ERR_NOT_UNIXFS")}if(it.data!=null){const ot=it.data,at=extractDataFromBlock(ot,et,tt,rt);a.push(at),et+=BigInt(at.byteLength)}const st=[];if(s.Links.length!==it.blockSizes.length)throw errCode$1(new Error("Inconsistent block sizes and dag links"),"ERR_NOT_UNIXFS");for(let ot=0;ot<s.Links.length;ot++){const at=s.Links[ot],lt=et,ct=lt+it.blockSizes[ot];if((tt>=lt&&tt<ct||rt>=lt&&rt<=ct||tt<lt&&rt>ct)&&st.push({link:at,blockStart:et}),et=ct,et>rt)break}await pipe(st,ot=>map$1(ot,at=>async()=>{const lt=await o.get(at.link.Hash,nt);return{...at,block:lt}}),ot=>parallel(ot,{ordered:!0,concurrency:nt.blockReadConcurrency}),async ot=>{for await(const{link:at,block:lt,blockStart:ct}of ot){let ht;switch(at.Hash.code){case code:ht=decode$3(lt);break;case code$4:ht=lt;break;default:a.end(errCode$1(new Error(`Unsupported codec: ${at.Hash.code}`),"ERR_NOT_UNIXFS"));return}const ft=new PQueue({concurrency:1});ft.on("error",dt=>{a.end(dt)}),ft.add(async()=>{nt.onProgress?.(new CustomProgressEvent("unixfs:exporter:walk:file",{cid:at.Hash})),await walkDAG(o,ht,a,ct,tt,rt,nt)}),await ft.onIdle()}}),et>=rt&&a.end()}const fileContent=(o,s,a,et,tt,rt,nt)=>{async function*it(st={}){const ot=a.fileSize();if(ot===void 0)throw new Error("File was a directory");const{start:at,end:lt}=validateOffsetAndLength(ot,st.offset,st.length);if(lt===0n)return;let ct=0n;const ht=lt-at,ft=pushable();st.onProgress?.(new CustomProgressEvent("unixfs:exporter:walk:file",{cid:o})),walkDAG(nt,s,ft,0n,at,lt,st).catch(dt=>{ft.end(dt)});for await(const dt of ft)if(dt!=null){if(ct+=BigInt(dt.byteLength),ct>ht)throw ft.end(),errCode$1(new Error("Read too many bytes - the file size reported by the UnixFS data in the root node may be incorrect"),"ERR_OVER_READ");ct===ht&&ft.end(),st.onProgress?.(new CustomProgressEvent("unixfs:exporter:progress:unixfs:file",{bytesRead:ct,totalBytes:ht,fileSize:ot})),yield dt}if(ct<ht)throw errCode$1(new Error("Traversed entire DAG but did not read enough bytes"),"ERR_UNDER_READ")}return it},hamtShardedDirectoryContent=(o,s,a,et,tt,rt,nt)=>{function it(st={}){return st.onProgress?.(new CustomProgressEvent("unixfs:exporter:walk:hamt-sharded-directory",{cid:o})),listDirectory(s,et,tt,rt,nt,st)}return it};async function*listDirectory(o,s,a,et,tt,rt){const nt=o.Links;if(o.Data==null)throw errCode$1(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let it;try{it=UnixFS$1.unmarshal(o.Data)}catch(at){throw errCode$1(at,"ERR_NOT_UNIXFS")}if(it.fanout==null)throw errCode$1(new Error("missing fanout"),"ERR_NOT_UNIXFS");const st=(it.fanout-1n).toString(16).length,ot=pipe(nt,at=>map$1(at,lt=>async()=>{const ct=lt.Name!=null?lt.Name.substring(st):null;if(ct!=null&&ct!==""){const ht=await a(lt.Hash,ct,`${s}/${ct}`,[],et+1,tt,rt);return{entries:ht.entry==null?[]:[ht.entry]}}else{const ht=await tt.get(lt.Hash,rt);return o=decode$3(ht),rt.onProgress?.(new CustomProgressEvent("unixfs:exporter:walk:hamt-sharded-directory",{cid:lt.Hash})),{entries:listDirectory(o,s,a,et,tt,rt)}}}),at=>parallel(at,{ordered:!0,concurrency:rt.blockReadConcurrency}));for await(const{entries:at}of ot)yield*at}const findLinkCid=(o,s)=>o.Links.find(et=>et.Name===s)?.Hash,contentExporters={raw:fileContent,file:fileContent,directory:directoryContent,"hamt-sharded-directory":hamtShardedDirectoryContent,metadata:(o,s,a,et,tt,rt,nt)=>()=>[],symlink:(o,s,a,et,tt,rt,nt)=>()=>[]},unixFsResolver=async(o,s,a,et,tt,rt,nt,it)=>{const st=await nt.get(o,it),ot=decode$3(st);let at,lt;if(s==null&&(s=o.toString()),ot.Data==null)throw errCode$1(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");try{at=UnixFS$1.unmarshal(ot.Data)}catch(ht){throw errCode$1(ht,"ERR_NOT_UNIXFS")}if(a==null&&(a=s),et.length>0){let ht;if(at?.type==="hamt-sharded-directory"?ht=await findShardCid(ot,et[0],nt):ht=findLinkCid(ot,et[0]),ht==null)throw errCode$1(new Error("file does not exist"),"ERR_NOT_FOUND");const ft=et.shift(),dt=`${a}/${ft}`;lt={cid:ht,toResolve:et,name:ft??"",path:dt}}const ct=contentExporters[at.type](o,ot,at,a,tt,rt,nt);if(ct==null)throw errCode$1(new Error("could not find content exporter"),"ERR_NOT_FOUND");return at.isDirectory()?{entry:{type:"directory",name:s,path:a,cid:o,content:ct,unixfs:at,depth:rt,node:ot,size:at.fileSize()},next:lt}:{entry:{type:"file",name:s,path:a,cid:o,content:ct,unixfs:at,depth:rt,node:ot,size:at.fileSize()},next:lt}},resolvers={[code]:unixFsResolver,[code$4]:resolve$2,[code$2]:resolve$6,[code$1]:resolve$5,[identity$1.code]:resolve$4,[code$5]:resolve$3},resolve$1=async(o,s,a,et,tt,rt,nt)=>{const it=resolvers[o.code];if(it==null)throw errCode$1(new Error(`No resolver for code ${o.code}`),"ERR_NO_RESOLVER");return it(o,s,a,et,resolve$1,tt,rt,nt)},toPathComponents=(o="")=>(o.trim().match(/([^\\^/]|\\\/)+/g)??[]).filter(Boolean),cidAndRest=o=>{if(o instanceof Uint8Array)return{cid:CID.decode(o),toResolve:[]};const s=CID.asCID(o);if(s!=null)return{cid:s,toResolve:[]};if(typeof o=="string"){o.indexOf("/ipfs/")===0&&(o=o.substring(6));const a=toPathComponents(o);return{cid:CID.parse(a[0]),toResolve:a.slice(1)}}throw errCode$1(new Error(`Unknown path type ${o}`),"ERR_BAD_PATH")};async function*walkPath(o,s,a={}){let{cid:et,toResolve:tt}=cidAndRest(o),rt=et.toString(),nt=rt;const it=tt.length;for(;;){const st=await resolve$1(et,rt,nt,tt,it,s,a);if(st.entry==null&&st.next==null)throw errCode$1(new Error(`Could not resolve ${o}`),"ERR_NOT_FOUND");if(st.entry!=null&&(yield st.entry),st.next==null)return;tt=st.next.toResolve,et=st.next.cid,rt=st.next.name,nt=st.next.path}}async function exporter(o,s,a={}){const et=await last$1(walkPath(o,s,a));if(et==null)throw errCode$1(new Error(`Could not resolve ${o}`),"ERR_NOT_FOUND");return et}async function*recursive(o,s,a={}){const et=await exporter(o,s,a);if(et==null)return;if(yield et,et.type==="directory")for await(const rt of tt(et,a))yield rt;async function*tt(rt,nt){for await(const it of rt.content(nt))yield it,!(it instanceof Uint8Array)&&it.type==="directory"&&(yield*tt(it,nt))}}class UnixFSError extends Error{name;code;constructor(s,a,et){super(s),this.name=a,this.code=et}}class NotUnixFSError extends UnixFSError{constructor(s="not a Unixfs node"){super(s,"NotUnixFSError","ERR_NOT_UNIXFS")}}class InvalidPBNodeError extends UnixFSError{constructor(s="invalid PBNode"){super(s,"InvalidPBNodeError","ERR_INVALID_PBNODE")}}class UnknownError extends UnixFSError{constructor(s="unknown error"){super(s,"InvalidPBNodeError","ERR_UNKNOWN_ERROR")}}class AlreadyExistsError extends UnixFSError{constructor(s="path already exists"){super(s,"AlreadyExistsError","ERR_ALREADY_EXISTS")}}class DoesNotExistError extends UnixFSError{constructor(s="path does not exist"){super(s,"DoesNotExistError","ERR_DOES_NOT_EXIST")}}class NoContentError extends UnixFSError{constructor(s="no content"){super(s,"NoContentError","ERR_NO_CONTENT")}}class NotAFileError extends UnixFSError{constructor(s="not a file"){super(s,"NotAFileError","ERR_NOT_A_FILE")}}class NotADirectoryError extends UnixFSError{constructor(s="not a directory"){super(s,"NotADirectoryError","ERR_NOT_A_DIRECTORY")}}class InvalidParametersError extends UnixFSError{constructor(s="invalid parameters"){super(s,"InvalidParametersError","ERR_INVALID_PARAMETERS")}}function isAsyncIterable(o){return o[Symbol.asyncIterator]!=null}function all(o){if(isAsyncIterable(o))return(async()=>{const a=[];for await(const et of o)a.push(et);return a})();const s=[];for(const a of o)s.push(a);return s}function allocUnsafe$2(o=0){return new Uint8Array(o)}function createCodec$2(o,s,a,et){return{name:o,prefix:s,encoder:{name:o,prefix:s,encode:a},decoder:{decode:et}}}const string$2=createCodec$2("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),ascii$2=createCodec$2("ascii","a",o=>{let s="a";for(let a=0;a<o.length;a++)s+=String.fromCharCode(o[a]);return s},o=>{o=o.substring(1);const s=allocUnsafe$2(o.length);for(let a=0;a<o.length;a++)s[a]=o.charCodeAt(a);return s}),BASES$2={utf8:string$2,"utf-8":string$2,hex:bases.base16,latin1:ascii$2,ascii:ascii$2,binary:ascii$2,...bases};function fromString$2(o,s="utf8"){const a=BASES$2[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.decoder.decode(`${a.prefix}${o}`)}function asUint8Array$2(o){return o}function concat$1(o,s){s==null&&(s=o.reduce((tt,rt)=>tt+rt.length,0));const a=allocUnsafe$2(s);let et=0;for(const tt of o)a.set(tt,et),et+=tt.length;return a}function wrapHash(o){function s(a){return a instanceof InfiniteHash?a:new InfiniteHash(a,o)}return s}class InfiniteHash{_value;_hashFn;_depth;_availableBits;_currentBufferIndex;_buffers;constructor(s,a){if(!(s instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=s,this._hashFn=a,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(s){let a=s;for(;this._availableBits<a;)await this._produceMoreBits();let et=0;for(;a>0;){const tt=this._buffers[this._currentBufferIndex],rt=Math.min(tt.availableBits(),a),nt=tt.take(rt);et=(et<<rt)+nt,a-=rt,this._availableBits-=rt,tt.availableBits()===0&&this._currentBufferIndex++}return et}untake(s){let a=s;for(;a>0;){const et=this._buffers[this._currentBufferIndex],tt=Math.min(et.totalBits()-et.availableBits(),a);et.untake(tt),a-=tt,this._availableBits+=tt,this._currentBufferIndex>0&&et.totalBits()===et.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;const s=this._depth>0?concat$1([this._value,Uint8Array.from([this._depth])]):this._value,a=await this._hashFn(s),et=new ConsumableBuffer(a);this._buffers.push(et),this._availableBits+=et.availableBits()}}const START_MASKS=[255,254,252,248,240,224,192,128],STOP_MASKS=[1,3,7,15,31,63,127,255];class ConsumableBuffer{_value;_currentBytePos;_currentBitPos;constructor(s){this._value=s,this._currentBytePos=s.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+this._currentBytePos*8}totalBits(){return this._value.length*8}take(s){let a=s,et=0;for(;a>0&&this._haveBits();){const tt=this._value[this._currentBytePos],rt=this._currentBitPos+1,nt=Math.min(rt,a),it=byteBitsToInt(tt,rt-nt,nt);et=(et<<nt)+it,a-=nt,this._currentBitPos-=nt,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return et}untake(s){for(this._currentBitPos+=s;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}}function byteBitsToInt(o,s,a){const et=maskFor(s,a);return(o&et)>>>s}function maskFor(o,s){return START_MASKS[o]&STOP_MASKS[Math.min(s+o-1,7)]}const hamtHashCode=BigInt(murmur3128.code),hamtBucketBits=8;async function hamtHashFn(o){return(await murmur3128.encode(o)).subarray(0,8).reverse()}const persist=async(o,s,a)=>{a.codec==null&&(a.codec=dagPB);const et=await sha256$1.digest(o),tt=CID.create(a.cidVersion,a.codec.code,et);return await s.put(tt,o,{...a,signal:a.signal}),tt};class Dir{options;root;dir;path;dirty;flat;parent;parentKey;unixfs;mode;mtime;cid;size;nodeSize;constructor(s,a){this.options=a??{},this.root=s.root,this.dir=s.dir,this.path=s.path,this.dirty=s.dirty,this.flat=s.flat,this.parent=s.parent,this.parentKey=s.parentKey,this.unixfs=s.unixfs,this.mode=s.mode,this.mtime=s.mtime}}class DirSharded extends Dir{_bucket;constructor(s,a){super(s,a),this._bucket=createHAMT({hashFn:hamtHashFn,bits:8})}async put(s,a){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,await this._bucket.put(s,a)}async get(s){return this._bucket.get(s)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(const{key:s,value:a}of this._bucket.eachLeafSeries())yield{key:s,child:a}}estimateNodeSize(){return this.nodeSize!==void 0?this.nodeSize:(this.nodeSize=calculateSize(this._bucket,this,this.options),this.nodeSize)}async*flush(s){for await(const a of flush(this._bucket,s,this,this.options))yield{...a,path:this.path}}}async function*flush(o,s,a,et){const tt=o._children,rt=[];let nt=0n;for(let ht=0;ht<tt.length;ht++){const ft=tt.get(ht);if(ft==null)continue;const dt=ht.toString(16).toUpperCase().padStart(2,"0");if(ft instanceof Bucket){let pt;for await(const gt of flush(ft,s,null,et))pt=gt;if(pt==null)throw new Error("Could not flush sharded directory, no subshard found");rt.push({Name:dt,Tsize:Number(pt.size),Hash:pt.cid}),nt+=pt.size}else if(isDir(ft.value)){const pt=ft.value;let gt;for await(const yt of pt.flush(s))gt=yt,yield gt;if(gt==null)throw new Error("Did not flush dir");const mt=dt+ft.key;rt.push({Name:mt,Tsize:Number(gt.size),Hash:gt.cid}),nt+=gt.size}else{const pt=ft.value;if(pt.cid==null)continue;const gt=dt+ft.key,mt=pt.size;rt.push({Name:gt,Tsize:Number(mt),Hash:pt.cid}),nt+=BigInt(mt??0)}}const it=Uint8Array.from(tt.bitField().reverse()),st=new UnixFS$1({type:"hamt-sharded-directory",data:it,fanout:BigInt(o.tableSize()),hashType:hamtHashCode,mtime:a?.mtime,mode:a?.mode}),ot={Data:st.marshal(),Links:rt},at=encode$4(prepare$1(ot)),lt=await persist(at,s,et),ct=BigInt(at.byteLength)+nt;yield{cid:lt,unixfs:st,size:ct}}function isDir(o){return typeof o.flush=="function"}function calculateSize(o,s,a){const et=o._children,tt=[];for(let st=0;st<et.length;st++){const ot=et.get(st);if(ot==null)continue;const at=st.toString(16).toUpperCase().padStart(2,"0");if(ot instanceof Bucket){const lt=calculateSize(ot,null,a);tt.push({Name:at,Tsize:Number(lt),Hash:a.cidVersion===0?CID_V0:CID_V1})}else if(typeof ot.value.flush=="function"){const ct=ot.value.nodeSize();tt.push({Name:at+ot.key,Tsize:Number(ct),Hash:a.cidVersion===0?CID_V0:CID_V1})}else{const lt=ot.value;if(lt.cid==null)continue;const ct=at+ot.key,ht=lt.size;tt.push({Name:ct,Tsize:Number(ht),Hash:lt.cid})}}const rt=Uint8Array.from(et.bitField().reverse()),nt=new UnixFS$1({type:"hamt-sharded-directory",data:rt,fanout:BigInt(o.tableSize()),hashType:hamtHashCode,mtime:s?.mtime,mode:s?.mode});return encode$4(prepare$1({Data:nt.marshal(),Links:tt})).length}const CID_V0=CID.parse("QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn"),CID_V1=CID.parse("zdj7WbTaiJT1fgatdet9Ei9iDB5hdCxkbVyhyh8YTUnXMiwYi"),log$9=logger$1("helia:unixfs:commands:utils:hamt-utils"),toPrefix=o=>o.toString(16).toUpperCase().padStart(2,"0").substring(0,2),createShard=async(o,s,a)=>{const et=new DirSharded({root:!0,dir:!0,parent:void 0,parentKey:void 0,path:"",dirty:!0,flat:!1,mtime:a.mtime,mode:a.mode},a);for(let rt=0;rt<s.length;rt++)await et._bucket.put(s[rt].name,{size:s[rt].size,cid:s[rt].cid});const tt=await last$1(et.flush(o));if(tt==null)throw new Error("Flushing shard yielded no result");return tt},updateShardedDirectory=async(o,s,a)=>{const et=UnixFS$1.unmarshal(o[0].node.Data??new Uint8Array(0)),tt=BigInt(Math.pow(2,hamtBucketBits));o.reverse();let rt,nt;for(let it=0;it<o.length;it++){const st=it===o.length-1,ot=o[it],at=Uint8Array.from(ot.children.bitField().reverse()),lt=new UnixFS$1({type:"hamt-sharded-directory",data:at,fanout:tt,hashType:hamtHashCode});st&&(lt.mtime=et.mtime,lt.mode=et.mode),nt={Data:lt.marshal(),Links:ot.node.Links};const ct=encode$4(prepare$1(nt));if(rt=await persist(ct,s,a),!st){const ht=o[it+1];if(ht==null)throw new Error("Was not operating on shard root but also had no parent?");log$9("updating link in parent sub-shard with prefix %s",ht.prefix),ht.node.Links=ht.node.Links.filter(ft=>ft.Name!==ht.prefix),ht.node.Links.push({Name:ht.prefix,Hash:rt,Tsize:ot.node.Links.reduce((ft,dt)=>ft+(dt.Tsize??0),ct.byteLength)})}}if(rt==null||nt==null)throw new Error("Noting persisted");return{cid:rt,node:nt}},recreateShardedDirectory=async(o,s,a,et)=>{const rt=wrapHash(hamtHashFn)(fromString$2(s)),nt=[];for(;;){const it=await a.get(o,et),st=decode$3(it),ot=new SparseArray,at=await rt.take(hamtBucketBits),lt=toPrefix(at);nt.push({prefix:lt,children:ot,node:st});let ct;for(const ft of st.Links){const dt=ft.Name??"";if(dt.length<2)throw new Error("Invalid HAMT - link name was too short");const pt=parseInt(dt.substring(0,2),16);ot.set(pt,!0),dt.startsWith(lt)&&(ct=ft)}if(ct==null){log$9("no link found with prefix %s for %s",lt,s);break}const ht=ct.Name??"";if(ht.length<2)throw new Error("Invalid HAMT - link name was too short");if(ht.length===2){o=ct.Hash,log$9("descend into sub-shard with prefix %s",ht);continue}break}return{path:nt,hash:rt}};async function isOverShardThreshold(o,s,a,et){if(o.Data==null)throw new Error("DagPB node had no data");const tt=UnixFS$1.unmarshal(o.Data);let rt;if(tt.type==="directory")rt=estimateNodeSize(o);else if(tt.type==="hamt-sharded-directory")rt=await estimateShardSize(o,0,a,s,et);else throw new Error("Can only estimate the size of directories or shards");return rt>a}function estimateNodeSize(o){let s=0;for(const a of o.Links)s+=(a.Name??"").length,s+=a.Hash.version===1?CID_V1.bytes.byteLength:CID_V0.bytes.byteLength;return s}async function estimateShardSize(o,s,a,et,tt){if(s>a)return a;if(o.Data==null||!UnixFS$1.unmarshal(o.Data).isDirectory())return s;for(const nt of o.Links){let it=nt.Name??"";if(it=it.substring(2),s+=it.length,s+=nt.Hash.bytes.byteLength,nt.Hash.code===code){const st=await et.get(nt.Hash,tt),ot=decode$3(st);s+=await estimateShardSize(ot,s,a,et,tt)}}return s}const log$8=logger$1("helia:unixfs:components:utils:add-link");async function addLink(o,s,a,et){if(o.node.Data==null)throw new InvalidParametersError("Invalid parent passed to addLink");if(UnixFS$1.unmarshal(o.node.Data).type==="hamt-sharded-directory")return log$8("adding link to sharded directory"),addToShardedDirectory(o,s,a,et);log$8(`adding ${s.Name} (${s.Hash}) to regular directory`);const rt=await addToDirectory(o,s,a,et);if(await isOverShardThreshold(rt.node,a,et.shardSplitThresholdBytes,et)){log$8("converting directory to sharded directory");const nt=await convertToShardedDirectory(rt,a);rt.cid=nt.cid,rt.node=decode$3(await a.get(nt.cid,et))}return rt}const convertToShardedDirectory=async(o,s)=>{if(o.node.Data==null)throw new InvalidParametersError("Invalid parent passed to convertToShardedDirectory");const a=UnixFS$1.unmarshal(o.node.Data),et=await createShard(s,o.node.Links.map(tt=>({name:tt.Name??"",size:BigInt(tt.Tsize??0),cid:tt.Hash})),{mode:a.mode,mtime:a.mtime,cidVersion:o.cid.version});return log$8(`converted directory to sharded directory ${et.cid}`),et},addToDirectory=async(o,s,a,et)=>{const tt=o.node.Links.filter(at=>{const lt=at.Name===s.Name;if(lt&&!et.allowOverwriting)throw new AlreadyExistsError;return!lt});if(tt.push(s),o.node.Data==null)throw new InvalidPBNodeError("Parent node with no data passed to addToDirectory");const rt=UnixFS$1.unmarshal(o.node.Data);let nt;if(rt.mtime!=null){const at=Date.now(),lt=Math.floor(at/1e3);rt.mtime={secs:BigInt(lt),nsecs:(at-lt*1e3)*1e3},nt=rt.marshal()}else nt=o.node.Data;o.node=prepare$1({Data:nt,Links:tt});const it=encode$4(o.node),st=await sha256$1.digest(it),ot=CID.create(o.cid.version,code,st);return await a.put(ot,it),{node:o.node,cid:ot}},addToShardedDirectory=async(o,s,a,et)=>{const{path:tt,hash:rt}=await recreateShardedDirectory(o.cid,s.Name,a,et),nt=tt[tt.length-1];if(nt==null)throw new Error("Invalid HAMT, could not generate path");const it=nt.prefix,st=parseInt(it,16);log$8("next prefix for %s is %s",s.Name,it);const ot=`${it}${s.Name}`,at=nt.node.Links.find(lt=>(lt.Name??"").startsWith(it));if(at!=null)if(log$8("link %s was present in shard",ot),at.Name===ot){if(!et.allowOverwriting)throw new AlreadyExistsError;log$8("overwriting %s in subshard",s.Name),nt.node.Links=nt.node.Links.filter(lt=>lt.Name!==ot),nt.node.Links.push({Name:ot,Hash:s.Hash,Tsize:s.Tsize})}else{if(at.Name?.length===2)throw new Error("Existing link was subshard?!");{log$8("prefix %s already exists, creating new subshard",it);const lt=nt.node.Links.findIndex(pt=>pt.Name?.startsWith(it)),ct=nt.node.Links.splice(lt,1)[0],ht=(ct.Name??"").substring(2),dt=wrapHash(hamtHashFn)(fromString$2(ht));for(let pt=0;pt<tt.length;pt++)await dt.take(hamtBucketBits);for(;;){const pt=await dt.take(hamtBucketBits),gt=toPrefix(pt);ct.Name=`${gt}${ht}`;const mt=await rt.take(hamtBucketBits),yt=toPrefix(mt);if(gt===yt){const Et=new SparseArray;Et.set(mt,!0),tt.push({prefix:yt,children:Et,node:{Links:[]}});continue}const vt=new SparseArray;vt.set(mt,!0),vt.set(pt,!0),tt.push({prefix:it,children:vt,node:{Links:[ct,{Name:`${yt}${s.Name}`,Hash:s.Hash,Tsize:s.Tsize}]}});break}}}else log$8("link %s was not present in sub-shard",ot),s.Name=ot,nt.node.Links.push(s),nt.children.set(st,!0),log$8("adding %s to existing sub-shard",ot);return updateShardedDirectory(tt,a,et)};async function cidToDirectory(o,s,a={}){const et=await exporter(o,s,a);if(et.type!=="directory")throw new NotADirectoryError(`${o.toString()} was not a UnixFS directory`);return{cid:o,node:et.node}}async function cidToPBLink(o,s,a,et){const tt=await exporter(o,a,et);if(tt.type!=="directory"&&tt.type!=="file"&&tt.type!=="raw")throw new NotUnixFSError(`${o.toString()} was not a UnixFS node`);return{Name:s,Tsize:tt.node instanceof Uint8Array?tt.node.byteLength:dagNodeTsize(tt.node),Hash:o}}function dagNodeTsize(o){const s=o.Links.reduce((a,et)=>a+(et.Tsize??0),0);return encode$4(o).byteLength+s}const log$7=logger$1("helia:unixfs:components:utils:resolve");async function resolve(o,s,a,et){if(s==null||s==="")return{cid:o};const tt=`/ipfs/${o}${s==null?"":`/${s}`}`,rt=await all(walkPath(tt,a,et));if(rt.length===0)throw new DoesNotExistError("Could not find path in directory");return log$7("resolved %s to %c",s,o),{cid:rt[rt.length-1].cid,path:s,segments:rt}}async function updatePathCids(o,s,a,et){if(s.segments==null||s.segments.length===0)return o;let tt=s.segments.pop();if(tt==null)throw new Error("Insufficient segments");tt.cid=o,s.segments.reverse();for(const rt of s.segments){const[nt,it]=await Promise.all([cidToDirectory(rt.cid,a,et),cidToPBLink(tt.cid,tt.name,a,et)]);o=(await addLink(nt,it,a,{...et,allowOverwriting:!0,cidVersion:o.version})).cid,rt.cid=o,tt=rt}return o}const mergeOptions$7=mergeOptions$9.bind({ignoreUndefined:!0}),defaultOptions$7={};async function*cat(o,s,a={}){const et=mergeOptions$7(defaultOptions$7,a),tt=await resolve(o,et.path,s,et),rt=await exporter(tt.cid,s,et);if(rt.type!=="file"&&rt.type!=="raw")throw new NotAFileError;if(rt.content==null)throw new NoContentError;yield*rt.content(et)}const SHARD_SPLIT_THRESHOLD_BYTES=262144,mergeOptions$6=mergeOptions$9.bind({ignoreUndefined:!0}),log$6=logger$1("helia:unixfs:chmod"),defaultOptions$6={recursive:!1,shardSplitThresholdBytes:SHARD_SPLIT_THRESHOLD_BYTES};async function chmod(o,s,a,et={}){const tt=mergeOptions$6(defaultOptions$6,et),rt=await resolve(o,tt.path,a,et);if(log$6("chmod %c %d",rt.cid,s),tt.recursive){const ct=await pipe(async function*(){for await(const ht of recursive(rt.cid,a,et)){let ft,dt=[];if(ht.type==="raw")ft=new UnixFS$1({type:"file",data:ht.node});else if(ht.type==="file"||ht.type==="directory")ft=ht.unixfs,dt=ht.node.Links;else throw new NotUnixFSError;ft.mode=s;const pt={Data:ft.marshal(),Links:dt};yield{path:ht.path,content:pt}}},ht=>importer(ht,a,{...tt,dagBuilder:async function*(ft,dt){for await(const pt of ft)yield async function(){const gt=pt.content,mt=encode$4(gt),yt=await persist(mt,dt,{...tt,cidVersion:o.version});if(gt.Data==null)throw new InvalidPBNodeError(`${yt} had no data`);const vt=UnixFS$1.unmarshal(gt.Data);return{cid:yt,size:BigInt(mt.length),path:pt.path,unixfs:vt}}}}),async ht=>last$1(ht));if(ct==null)throw new UnknownError(`Could not chmod ${rt.cid.toString()}`);return updatePathCids(ct.cid,rt,a,tt)}const nt=await a.get(rt.cid,et);let it,st=[];if(rt.cid.code===code$4)it=new UnixFS$1({type:"file",data:nt});else{const ct=decode$3(nt);if(ct.Data==null)throw new InvalidPBNodeError(`${rt.cid.toString()} had no data`);st=ct.Links,it=UnixFS$1.unmarshal(ct.Data)}it.mode=s;const ot=encode$4({Data:it.marshal(),Links:st}),at=await sha256$1.digest(ot),lt=CID.create(rt.cid.version,code,at);return await a.put(lt,ot),updatePathCids(lt,rt,a,tt)}const mergeOptions$5=mergeOptions$9.bind({ignoreUndefined:!0}),log$5=logger$1("helia:unixfs:cp"),defaultOptions$5={force:!1,shardSplitThresholdBytes:SHARD_SPLIT_THRESHOLD_BYTES};async function cp(o,s,a,et,tt={}){const rt=mergeOptions$5(defaultOptions$5,tt);if(a.includes("/"))throw new InvalidParametersError("Name must not have slashes");const[nt,it]=await Promise.all([cidToDirectory(s,et,rt),cidToPBLink(o,a,et,rt)]);return log$5('Adding %c as "%s" to %c',o,a,s),(await addLink(nt,it,et,{allowOverwriting:rt.force,cidVersion:s.version,...rt})).cid}const mergeOptions$4=mergeOptions$9.bind({ignoreUndefined:!0}),defaultOptions$4={};async function*ls(o,s,a={}){const et=mergeOptions$4(defaultOptions$4,a),tt=await resolve(o,et.path,s,et),rt=await exporter(tt.cid,s);if(rt.type==="file"||rt.type==="raw"){yield rt;return}if(rt.content==null)throw new NoContentError;if(rt.type!=="directory")throw new NotADirectoryError;yield*rt.content({offset:a.offset,length:a.length})}const mergeOptions$3=mergeOptions$9.bind({ignoreUndefined:!0}),log$4=logger$1("helia:unixfs:mkdir"),defaultOptions$3={cidVersion:1,force:!1,shardSplitThresholdBytes:SHARD_SPLIT_THRESHOLD_BYTES};async function mkdir(o,s,a,et={}){const tt=mergeOptions$3(defaultOptions$3,et);if(s.includes("/"))throw new InvalidParametersError("Path must not have slashes");if((await exporter(o,a,et)).type!=="directory")throw new NotADirectoryError(`${o.toString()} was not a UnixFS directory`);log$4("creating %s",s);const it={Data:new UnixFS$1({type:"directory",mode:tt.mode,mtime:tt.mtime}).marshal(),Links:[]},st=encode$4(it),ot=await sha256$1.digest(st),at=CID.create(tt.cidVersion,code,ot);await a.put(at,st);const[lt,ct]=await Promise.all([cidToDirectory(o,a,tt),cidToPBLink(at,s,a,tt)]);return log$4("adding empty dir called %s to %c",s,o),(await addLink(lt,ct,a,{...tt,allowOverwriting:tt.force})).cid}const log$3=logger$1("helia:unixfs:utils:remove-link");async function removeLink(o,s,a,et){if(o.node.Data==null)throw new InvalidPBNodeError("Parent node had no data");if(UnixFS$1.unmarshal(o.node.Data).type==="hamt-sharded-directory"){log$3(`removing ${s} from sharded directory`);const rt=await removeFromShardedDirectory(o,s,a,et);return await isOverShardThreshold(rt.node,a,et.shardSplitThresholdBytes,et)?rt:(log$3("converting shard to flat directory %c",o.cid),convertToFlatDirectory(rt,a,et))}return log$3(`removing link ${s} regular directory`),removeFromDirectory(o,s,a,et)}const removeFromDirectory=async(o,s,a,et)=>{o.node.Links=o.node.Links.filter(nt=>nt.Name!==s);const tt=encode$4(o.node),rt=await persist(tt,a,{...et,cidVersion:o.cid.version});return log$3(`Updated regular directory ${rt}`),{node:o.node,cid:rt}},removeFromShardedDirectory=async(o,s,a,et)=>{const{path:tt}=await recreateShardedDirectory(o.cid,s,a,et),rt=tt[tt.length-1];if(rt==null)throw new Error("Invalid HAMT, could not generate path");const nt=rt.node.Links.filter(ot=>(ot.Name??"").substring(2)===s).map(ot=>ot.Name).pop();if(nt==null)throw new Error("File not found");const it=nt.substring(0,2),st=parseInt(it,16);if(rt.node.Links=rt.node.Links.filter(ot=>ot.Name!==nt),rt.children.unset(st),rt.node.Links.length===1)for(;tt.length!==1;){const ot=tt[tt.length-1];if(ot==null||ot.node.Links.length>1)break;tt.pop();const at=tt[tt.length-1];if(at==null)break;const lt=ot.node.Links[0];at.node.Links=at.node.Links.filter(ct=>!(ct.Name??"").startsWith(at.prefix)),at.node.Links.push({Hash:lt.Hash,Name:`${at.prefix}${(lt.Name??"").substring(2)}`,Tsize:lt.Tsize})}return updateShardedDirectory(tt,a,et)},convertToFlatDirectory=async(o,s,a)=>{if(o.node.Data==null)throw new InvalidParametersError("Invalid parent passed to convertToFlatDirectory");const et={Links:[]},tt=await exporter(o.cid,s);if(tt.type!=="directory")throw new Error("Unexpected node type");for await(const st of tt.content()){let ot=0;st.node instanceof Uint8Array?ot=st.node.byteLength:ot=encode$4(st.node).length,et.Links.push({Hash:st.cid,Name:st.name,Tsize:ot})}const rt=UnixFS$1.unmarshal(o.node.Data);et.Data=new UnixFS$1({type:"directory",mode:rt.mode,mtime:rt.mtime}).marshal();const nt=encode$4(prepare$1(et));return{cid:await persist(nt,s,{codec:dagPB,cidVersion:o.cid.version,signal:a.signal}),node:et}},mergeOptions$2=mergeOptions$9.bind({ignoreUndefined:!0}),log$2=logger$1("helia:unixfs:rm"),defaultOptions$2={shardSplitThresholdBytes:SHARD_SPLIT_THRESHOLD_BYTES};async function rm(o,s,a,et={}){const tt=mergeOptions$2(defaultOptions$2,et);if(s.includes("/"))throw new InvalidParametersError("Name must not have slashes");const rt=await cidToDirectory(o,a,tt);return log$2("Removing %s from %c",s,o),(await removeLink(rt,s,a,{...tt,cidVersion:o.version})).cid}const mergeOptions$1=mergeOptions$9.bind({ignoreUndefined:!0}),log$1=logger$1("helia:unixfs:stat"),defaultOptions$1={};async function stat(o,s,a={}){const et=mergeOptions$1(defaultOptions$1,a),tt=await resolve(o,a.path,s,et);log$1("stat %c",tt.cid);const rt=await exporter(tt.cid,s,et);if(rt.type!=="file"&&rt.type!=="directory"&&rt.type!=="raw")throw new NotUnixFSError;let nt=0n,it=0n,st=0n,ot=0n,at=0,lt,ct;const ht=rt.type;let ft;if(rt.type==="raw"&&(nt=BigInt(rt.node.byteLength),it=BigInt(rt.node.byteLength),st=BigInt(rt.node.byteLength),ot=BigInt(rt.node.byteLength),at=1),rt.type==="directory"&&(nt=0n,it=BigInt(rt.unixfs.marshal().byteLength),st=0n,ot=it,at=1,lt=rt.unixfs.mode,ct=rt.unixfs.mtime,ft=rt.unixfs),rt.type==="file"){const dt=await inspectDag(tt.cid,s,et);nt=rt.unixfs.fileSize(),it=BigInt((rt.node.Data?.byteLength??0)+rt.node.Links.reduce((pt,gt)=>pt+(gt.Tsize??0),0)),st=BigInt(dt.localFileSize),ot=BigInt(dt.localDagSize),at=dt.blocks,lt=rt.unixfs.mode,ct=rt.unixfs.mtime,ft=rt.unixfs}return{cid:tt.cid,mode:lt,mtime:ct,fileSize:nt,dagSize:it,localFileSize:st,localDagSize:ot,blocks:at,type:ht,unixfs:ft}}async function inspectDag(o,s,a){const et={localFileSize:0,localDagSize:0,blocks:0};if(await s.has(o,a)){const tt=await s.get(o,a);if(et.blocks++,et.localDagSize+=tt.byteLength,o.code===code$4)et.localFileSize+=tt.byteLength;else if(o.code===code){const rt=decode$3(tt);if(rt.Links.length>0)for(const nt of rt.Links){const it=await inspectDag(nt.Hash,s,a);et.localFileSize+=it.localFileSize,et.localDagSize+=it.localDagSize,et.blocks+=it.blocks}else{if(rt.Data==null)throw new InvalidPBNodeError(`PBNode ${o.toString()} had no data`);const nt=UnixFS$1.unmarshal(rt.Data);if(nt.data==null)throw new InvalidPBNodeError(`UnixFS node ${o.toString()} had no data`);et.localFileSize+=nt.data.byteLength??0}}else throw new UnknownError(`${o.toString()} was neither DAG_PB nor RAW`)}return et}const mergeOptions=mergeOptions$9.bind({ignoreUndefined:!0}),log=logger$1("helia:unixfs:touch"),defaultOptions={recursive:!1,shardSplitThresholdBytes:SHARD_SPLIT_THRESHOLD_BYTES};async function touch(o,s,a={}){const et=mergeOptions(defaultOptions,a),tt=await resolve(o,et.path,s,et),rt=et.mtime??{secs:BigInt(Math.round(Date.now()/1e3)),nsecs:0};if(log("touch %c %o",tt.cid,rt),et.recursive){const ct=await pipe(async function*(){for await(const ht of recursive(tt.cid,s)){let ft,dt;if(ht.type==="raw")ft=new UnixFS$1({data:ht.node}),dt=[];else if(ht.type==="file"||ht.type==="directory")ft=ht.unixfs,dt=ht.node.Links;else throw new NotUnixFSError;ft.mtime=rt;const pt={Data:ft.marshal(),Links:dt};yield{path:ht.path,content:pt}}},ht=>importer(ht,s,{...et,dagBuilder:async function*(ft,dt){for await(const pt of ft)yield async function(){const gt=pt.content,mt=encode$4(gt),yt=await persist(mt,dt,{...et,cidVersion:o.version});if(gt.Data==null)throw new InvalidPBNodeError(`${yt} had no data`);const vt=UnixFS$1.unmarshal(gt.Data);return{cid:yt,size:BigInt(mt.length),path:pt.path,unixfs:vt}}}}),async ht=>last$1(ht));if(ct==null)throw new UnknownError(`Could not chmod ${tt.cid.toString()}`);return updatePathCids(ct.cid,tt,s,et)}const nt=await s.get(tt.cid,a);let it,st=[];if(tt.cid.code===code$4)it=new UnixFS$1({data:nt});else{const ct=decode$3(nt);if(st=ct.Links,ct.Data==null)throw new InvalidPBNodeError(`${tt.cid.toString()} had no data`);it=UnixFS$1.unmarshal(ct.Data)}it.mtime=rt;const ot=encode$4({Data:it.marshal(),Links:st}),at=await sha256$1.digest(ot),lt=CID.create(tt.cid.version,code,at);return await s.put(lt,ot),updatePathCids(lt,tt,s,et)}class UnixFS{components;constructor(s){this.components=s}async*addAll(s,a={}){yield*addAll(s,this.components.blockstore,a)}async addBytes(s,a={}){return addBytes(s,this.components.blockstore,a)}async addByteStream(s,a={}){return addByteStream(s,this.components.blockstore,a)}async addFile(s,a={}){return addFile(s,this.components.blockstore,a)}async addDirectory(s={},a={}){return addDirectory(s,this.components.blockstore,a)}async*cat(s,a={}){yield*cat(s,this.components.blockstore,a)}async chmod(s,a,et={}){return chmod(s,a,this.components.blockstore,et)}async cp(s,a,et,tt={}){return cp(s,a,et,this.components.blockstore,tt)}async*ls(s,a={}){yield*ls(s,this.components.blockstore,a)}async mkdir(s,a,et={}){return mkdir(s,a,this.components.blockstore,et)}async rm(s,a,et={}){return rm(s,a,this.components.blockstore,et)}async stat(s,a={}){return stat(s,this.components.blockstore,a)}async touch(s,a={}){return touch(s,this.components.blockstore,a)}}function unixfs(o){return new UnixFS(o)}const CODE_P2P=421,CODE_CIRCUIT=290,CODE_UNIX=400,CLOSE_TIMEOUT=500,SOCKET_TIMEOUT=5*6e4,Errors={ERR_INVALID_IP_PARAMETER:"ERR_INVALID_IP_PARAMETER",ERR_INVALID_PORT_PARAMETER:"ERR_INVALID_PORT_PARAMETER",ERR_INVALID_IP:"ERR_INVALID_IP"};function ipPortToMultiaddr(o,s){if(typeof o!="string")throw new CodeError$3(`invalid ip provided: ${o}`,Errors.ERR_INVALID_IP_PARAMETER);if(typeof s=="string"&&(s=parseInt(s)),isNaN(s))throw new CodeError$3(`invalid port provided: ${s}`,Errors.ERR_INVALID_PORT_PARAMETER);if(isIPv4$1(o))return multiaddr(`/ip4/${o}/tcp/${s}`);if(isIPv6$1(o))return multiaddr(`/ip6/${o}/tcp/${s}`);throw new CodeError$3(`invalid ip:port for creating a multiaddr: ${o}:${s}`,Errors.ERR_INVALID_IP)}function source$1(o){if(isReadableStream(o))return async function*(){const s=o.getReader();try{for(;;){const{done:a,value:et}=await s.read();if(a)return;yield et}}finally{s.releaseLock()}}();if(isNodeStream(o))return o;throw new Error("unknown stream")}function isNodeStream(o){return o[Symbol.asyncIterator]!=null}function isReadableStream(o){return typeof o?.getReader=="function"}function sink(o){return async s=>{const a=async()=>{isAsyncGenerator(s)&&await s.return(void 0)};let et,tt;const rt=gt=>{et=gt,a().catch(mt=>{mt=new AggregateError([et,mt],"The Writable emitted an error, additionally an error occurred while ending the Source")}).finally(()=>{tt?.(gt)})};let nt,it=!1;const st=()=>{it=!0,nt?.()};let ot,at=!1;const lt=()=>{at=!0,ot?.()};let ct;const ht=()=>{ct?.()},ft=async()=>new Promise((gt,mt)=>{nt=ct=gt,tt=mt,o.once("drain",ht)}),dt=async()=>(await a(),new Promise((gt,mt)=>{if(it||at||et!=null){gt();return}ot=nt=gt,tt=mt})),pt=()=>{o.removeListener("error",rt),o.removeListener("close",st),o.removeListener("finish",lt),o.removeListener("drain",ht)};o.once("error",rt),o.once("close",st),o.once("finish",lt);try{for await(const gt of s){if(!o.writable||o.destroyed||et!=null)break;o.write(gt)||await ft()}}catch(gt){et==null&&o.destroy(gt),et=gt}try{if(o.writable&&o.end(),await dt(),et!=null)throw et}finally{pt()}}}function isAsyncGenerator(o){return o.return!=null}function duplex(o){return{sink:sink(o),source:source$1(o)}}const ProtoFamily={ip4:"IPv4",ip6:"IPv6"};function multiaddrToNetConfig(o,s={}){const a=o.getPath();return a!=null?browser$5.platform()==="win32"?{path:path$1.join("\\\\.\\pipe\\",a)}:{path:a}:{...s,...o.toOptions()}}function getMultiaddrs(o,s,a){const et=tt=>multiaddr(`/${o}/${tt}/tcp/${a}`);return(isAnyAddr(s)?getNetworkAddrs(ProtoFamily[o]):[s]).map(et)}function isAnyAddr(o){return["0.0.0.0","::"].includes(o)}const networks=browser$5.networkInterfaces();function getNetworkAddrs(o){const s=[];for(const[,a]of Object.entries(networks))if(a!=null)for(const et of a)et.family===o&&s.push(et.address);return s}const toMultiaddrConnection=(o,s)=>{let a=null;const et=s.logger.forComponent("libp2p:tcp:socket"),tt=s.metrics,rt=s.metricPrefix??"",nt=s.socketInactivityTimeout??SOCKET_TIMEOUT,it=s.socketCloseTimeout??CLOSE_TIMEOUT;s.listeningAddr?.getPath()!=null&&(s.remoteAddr=s.listeningAddr),s.remoteAddr?.getPath()!=null&&(s.localAddr=s.remoteAddr);let st;if(s.remoteAddr!=null)st=s.remoteAddr;else{if(o.remoteAddress==null||o.remotePort==null)throw new CodeError$3("Could not determine remote address or port","ERR_NO_REMOTE_ADDRESS");st=ipPortToMultiaddr(o.remoteAddress,o.remotePort)}const ot=multiaddrToNetConfig(st),at=ot.path??`${ot.host??""}:${ot.port??""}`,{sink:lt,source:ct}=duplex(o);o.setTimeout(nt,()=>{et("%s socket read timeout",at),tt?.increment({[`${rt}timeout`]:!0});let ft;o.readable&&(ft=new CodeError$3("Socket read timeout","ERR_SOCKET_READ_TIMEOUT")),o.destroy(ft)}),o.once("close",()=>{et("%s socket close",at),tt?.increment({[`${rt}close`]:!0}),ht.timeline.close==null&&(ht.timeline.close=Date.now())}),o.once("end",()=>{et("%s socket end",at),tt?.increment({[`${rt}end`]:!0})});const ht={async sink(ft){try{await lt(async function*(){for await(const dt of ft)dt instanceof Uint8Array?yield dt:yield dt.subarray()}())}catch(dt){dt.type!=="aborted"&&et.error("%s error in sink",at,dt)}o.end()},source:ct,remoteAddr:st,timeline:{open:Date.now()},async close(ft={}){if(o.destroyed){et("The %s socket is destroyed",at);return}if(a!=null)return et("The %s socket is closed or closing",at),a;if(ft.signal==null){const pt=AbortSignal.timeout(it);ft={...ft,signal:pt}}const dt=()=>{o.destroy(new CodeError$3("Destroying socket after timeout","ERR_CLOSE_TIMEOUT"))};ft.signal?.addEventListener("abort",dt);try{et("%s closing socket",at),a=new Promise((pt,gt)=>{o.once("close",()=>{et("%s socket closed",at),pt()}),o.once("error",mt=>{et("%s socket error",at,mt),ht.timeline.close==null&&(ht.timeline.close=Date.now()),o.destroyed||gt(mt)}),o.setTimeout(it),o.end(),o.writableLength>0?o.once("drain",()=>{et("%s socket drained",at),o.destroy()}):o.destroy()}),await a}catch(pt){this.abort(pt)}finally{ft.signal?.removeEventListener("abort",dt)}},abort:ft=>{et("%s socket abort due to error",at,ft),o.destroyed||o.destroy(ft),ht.timeline.close==null&&(ht.timeline.close=Date.now())},log:et};return ht};async function attemptClose(o,s){try{await o.close()}catch(a){s.log.error("an error occurred closing the connection",a),o.abort(a)}}var TCPListenerStatusCode;(function(o){o[o.INACTIVE=0]="INACTIVE",o[o.ACTIVE=1]="ACTIVE",o[o.PAUSED=2]="PAUSED"})(TCPListenerStatusCode||(TCPListenerStatusCode={}));class TCPListener extends TypedEventEmitter{context;server;connections=new Set;status={code:TCPListenerStatusCode.INACTIVE};metrics;addr;log;constructor(s){if(super(),this.context=s,s.keepAlive=s.keepAlive??!0,s.noDelay=s.noDelay??!0,this.log=s.logger.forComponent("libp2p:tcp:listener"),this.addr="unknown",this.server=empty$1.createServer(s,this.onSocket.bind(this)),s.maxConnections!==void 0&&(this.server.maxConnections=s.maxConnections),s.closeServerOnMaxConnections!=null&&s.closeServerOnMaxConnections.closeAbove<s.closeServerOnMaxConnections.listenBelow)throw new CodeError$3("closeAbove must be >= listenBelow","ERR_CONNECTION_LIMITS");this.server.on("listening",()=>{if(s.metrics!=null){const a=this.server.address();a==null?this.addr="unknown":typeof a=="string"?this.addr=a:this.addr=`${a.address}:${a.port}`,s.metrics?.registerMetricGroup("libp2p_tcp_inbound_connections_total",{label:"address",help:"Current active connections in TCP listener",calculate:()=>({[this.addr]:this.connections.size})}),this.metrics={status:s.metrics.registerMetricGroup("libp2p_tcp_listener_status_info",{label:"address",help:"Current status of the TCP listener socket"}),errors:s.metrics.registerMetricGroup("libp2p_tcp_listener_errors_total",{label:"address",help:"Total count of TCP listener errors by type"}),events:s.metrics.registerMetricGroup("libp2p_tcp_listener_events_total",{label:"address",help:"Total count of TCP listener events by type"})},this.metrics?.status.update({[this.addr]:TCPListenerStatusCode.ACTIVE})}this.safeDispatchEvent("listening")}).on("error",a=>{this.metrics?.errors.increment({[`${this.addr} listen_error`]:!0}),this.safeDispatchEvent("error",{detail:a})}).on("close",()=>{this.metrics?.status.update({[this.addr]:this.status.code}),this.status.code!==TCPListenerStatusCode.PAUSED&&this.safeDispatchEvent("close")})}onSocket(s){if(this.status.code!==TCPListenerStatusCode.ACTIVE)throw new CodeError$3("Server is not listening yet","ERR_SERVER_NOT_RUNNING");s.on("error",et=>{this.log("socket error",et),this.metrics?.events.increment({[`${this.addr} error`]:!0})});let a;try{a=toMultiaddrConnection(s,{listeningAddr:this.status.listeningAddr,socketInactivityTimeout:this.context.socketInactivityTimeout,socketCloseTimeout:this.context.socketCloseTimeout,metrics:this.metrics?.events,metricPrefix:`${this.addr} `,logger:this.context.logger})}catch(et){this.log.error("inbound connection failed",et),this.metrics?.errors.increment({[`${this.addr} inbound_to_connection`]:!0});return}this.log("new inbound connection %s",a.remoteAddr);try{this.context.upgrader.upgradeInbound(a).then(et=>{this.log("inbound connection upgraded %s",a.remoteAddr),this.connections.add(a),s.once("close",()=>{this.connections.delete(a),this.context.closeServerOnMaxConnections!=null&&this.connections.size<this.context.closeServerOnMaxConnections.listenBelow&&this.resume().catch(tt=>{this.log.error("error attempting to listen server once connection count under limit",tt),this.context.closeServerOnMaxConnections?.onListenError?.(tt)})}),this.context.handler!=null&&this.context.handler(et),this.context.closeServerOnMaxConnections!=null&&this.connections.size>=this.context.closeServerOnMaxConnections.closeAbove&&this.pause(!1).catch(tt=>{this.log.error("error attempting to close server once connection count over limit",tt)}),this.safeDispatchEvent("connection",{detail:et})}).catch(async et=>{this.log.error("inbound connection failed",et),this.metrics?.errors.increment({[`${this.addr} inbound_upgrade`]:!0}),await attemptClose(a,{log:this.log})}).catch(et=>{this.log.error("closing inbound connection failed",et)})}catch(et){this.log.error("inbound connection failed",et),attemptClose(a,{log:this.log}).catch(tt=>{this.log.error("closing inbound connection failed",tt),this.metrics?.errors.increment({[`${this.addr} inbound_closing_failed`]:!0})})}}getAddrs(){if(this.status.code===TCPListenerStatusCode.INACTIVE)return[];let s=[];const a=this.server.address(),{listeningAddr:et,peerId:tt}=this.status;if(a==null)return[];if(typeof a=="string")s=[et];else try{et.toString().startsWith("/ip4")?s=s.concat(getMultiaddrs("ip4",a.address,a.port)):a.family==="IPv6"&&(s=s.concat(getMultiaddrs("ip6",a.address,a.port)))}catch(rt){this.log.error("could not turn %s:%s into multiaddr",a.address,a.port,rt)}return s.map(rt=>tt!=null?rt.encapsulate(`/p2p/${tt}`):rt)}async listen(s){if(this.status.code===TCPListenerStatusCode.ACTIVE||this.status.code===TCPListenerStatusCode.PAUSED)throw new CodeError$3("server is already listening","ERR_SERVER_ALREADY_LISTENING");const a=s.getPeerId(),et=a==null?s.decapsulateCode(CODE_P2P):s,{backlog:tt}=this.context;try{this.status={code:TCPListenerStatusCode.ACTIVE,listeningAddr:et,peerId:a,netConfig:multiaddrToNetConfig(et,{backlog:tt})},await this.resume()}catch(rt){throw this.status={code:TCPListenerStatusCode.INACTIVE},rt}}async close(){const s=new CodeError$3("Listener is closing","ERR_LISTENER_CLOSING");this.connections.forEach(a=>{a.abort(s)}),await this.pause(!0)}async resume(){if(this.server.listening||this.status.code===TCPListenerStatusCode.INACTIVE)return;const s=this.status.netConfig;await new Promise((a,et)=>{this.server.once("error",et),this.server.listen(s,a)}),this.status={...this.status,code:TCPListenerStatusCode.ACTIVE},this.log("listening on %s",this.server.address())}async pause(s){if(!this.server.listening&&this.status.code===TCPListenerStatusCode.PAUSED&&s){this.status={code:TCPListenerStatusCode.INACTIVE};return}!this.server.listening||this.status.code!==TCPListenerStatusCode.ACTIVE||(this.log("closing server on %s",this.server.address()),this.status=s?{code:TCPListenerStatusCode.INACTIVE}:{...this.status,code:TCPListenerStatusCode.PAUSED},await new Promise((a,et)=>{this.server.close(tt=>{if(tt!=null){et(tt);return}a()})}))}}class TCP{opts;metrics;components;log;constructor(s,a={}){this.log=s.logger.forComponent("libp2p:tcp"),this.opts=a,this.components=s,s.metrics!=null&&(this.metrics={dialerEvents:s.metrics.registerCounterGroup("libp2p_tcp_dialer_events_total",{label:"event",help:"Total count of TCP dialer events by type"})})}[transportSymbol]=!0;[Symbol.toStringTag]="@libp2p/tcp";[serviceCapabilities]=["@libp2p/transport"];async dial(s,a){a.keepAlive=a.keepAlive??!0,a.noDelay=a.noDelay??!0;const et=await this._connect(s,a);et.on("error",it=>{this.log("socket error",it)});const tt=toMultiaddrConnection(et,{remoteAddr:s,socketInactivityTimeout:this.opts.outboundSocketInactivityTimeout,socketCloseTimeout:this.opts.socketCloseTimeout,metrics:this.metrics?.dialerEvents,logger:this.components.logger}),rt=()=>{tt.close().catch(it=>{this.log.error("Error closing maConn after abort",it)})};a.signal?.addEventListener("abort",rt,{once:!0}),this.log("new outbound connection %s",tt.remoteAddr);const nt=await a.upgrader.upgradeOutbound(tt);if(this.log("outbound connection %s upgraded",tt.remoteAddr),a.signal?.removeEventListener("abort",rt),a.signal?.aborted===!0)throw nt.close().catch(it=>{this.log.error("Error closing conn after abort",it)}),new AbortError$5;return nt}async _connect(s,a){if(a.signal?.aborted===!0)throw new AbortError$5;return new Promise((et,tt)=>{const rt=Date.now(),nt=multiaddrToNetConfig(s,{...this.opts.dialOpts??{},...a});this.log("dialing %a",s);const it=empty$1.connect(nt),st=ht=>{const ft=nt.path??`${nt.host??""}:${nt.port}`;ht.message=`connection error ${ft}: ${ht.message}`,this.metrics?.dialerEvents.increment({error:!0}),ct(ht)},ot=()=>{this.log("connection timeout %a",s),this.metrics?.dialerEvents.increment({timeout:!0});const ht=new CodeError$3(`connection timeout after ${Date.now()-rt}ms`,"ERR_CONNECT_TIMEOUT");it.emit("error",ht)},at=()=>{this.log("connection opened %a",s),this.metrics?.dialerEvents.increment({connect:!0}),ct()},lt=()=>{this.log("connection aborted %a",s),this.metrics?.dialerEvents.increment({abort:!0}),it.destroy(),ct(new AbortError$5)},ct=ht=>{if(it.removeListener("error",st),it.removeListener("timeout",ot),it.removeListener("connect",at),a.signal!=null&&a.signal.removeEventListener("abort",lt),ht!=null){tt(ht);return}et(it)};it.on("error",st),it.on("timeout",ot),it.on("connect",at),a.signal!=null&&a.signal.addEventListener("abort",lt)})}createListener(s){return new TCPListener({...this.opts.listenOpts??{},...s,maxConnections:this.opts.maxConnections,backlog:this.opts.backlog,closeServerOnMaxConnections:this.opts.closeServerOnMaxConnections,socketInactivityTimeout:this.opts.inboundSocketInactivityTimeout,socketCloseTimeout:this.opts.socketCloseTimeout,metrics:this.components.metrics,logger:this.components.logger})}listenFilter(s){return s=Array.isArray(s)?s:[s],s.filter(a=>a.protoCodes().includes(CODE_CIRCUIT)?!1:a.protoCodes().includes(CODE_UNIX)?!0:TCP$1.matches(a.decapsulateCode(CODE_P2P)))}dialFilter(s){return this.listenFilter(s)}}function tcp(o={}){return s=>new TCP(s,o)}const second=1e3,minute=60*second,FloodsubID="/floodsub/1.0.0",GossipsubIDv10="/meshsub/1.0.0",GossipsubIDv11="/meshsub/1.1.0",GossipsubD=6,GossipsubDlo=4,GossipsubDhi=12,GossipsubDscore=4,GossipsubDout=2,GossipsubHistoryLength=5,GossipsubHistoryGossip=3,GossipsubDlazy=6,GossipsubGossipFactor=.25,GossipsubGossipRetransmission=3,GossipsubHeartbeatInitialDelay=100,GossipsubHeartbeatInterval=second,GossipsubFanoutTTL=minute,GossipsubPrunePeers=16,GossipsubPruneBackoff=minute,GossipsubUnsubscribeBackoff=10*second,GossipsubPruneBackoffTicks=15,GossipsubDirectConnectTicks=300,GossipsubDirectConnectInitialDelay=second,GossipsubOpportunisticGraftTicks=60,GossipsubOpportunisticGraftPeers=2,GossipsubGraftFloodThreshold=10*second,GossipsubMaxIHaveLength=5e3,GossipsubMaxIHaveMessages=10,GossipsubIWantFollowupTime=3*second,GossipsubSeenTTL=2*minute,TimeCacheDuration=120*1e3,ERR_TOPIC_VALIDATOR_REJECT="ERR_TOPIC_VALIDATOR_REJECT",ERR_TOPIC_VALIDATOR_IGNORE="ERR_TOPIC_VALIDATOR_IGNORE",ACCEPT_FROM_WHITELIST_THRESHOLD_SCORE=0,ACCEPT_FROM_WHITELIST_MAX_MESSAGES=128,ACCEPT_FROM_WHITELIST_DURATION_MS=1e3,DEFAULT_METRIC_MESH_MESSAGE_DELIVERIES_WINDOWS=1e3,BACKOFF_SLACK=1,defaultDecodeRpcLimits={maxSubscriptions:1/0,maxMessages:1/0,maxIhaveMessageIDs:1/0,maxIwantMessageIDs:1/0,maxControlMessages:1/0,maxPeerInfos:1/0};var RPC;(function(o){(function(a){let et;a.codec=()=>(et==null&&(et=message((tt,rt,nt={})=>{nt.lengthDelimited!==!1&&rt.fork(),tt.subscribe!=null&&(rt.uint32(8),rt.bool(tt.subscribe)),tt.topic!=null&&(rt.uint32(18),rt.string(tt.topic)),nt.lengthDelimited!==!1&&rt.ldelim()},(tt,rt,nt={})=>{const it={},st=rt==null?tt.len:tt.pos+rt;for(;tt.pos<st;){const ot=tt.uint32();switch(ot>>>3){case 1:{it.subscribe=tt.bool();break}case 2:{it.topic=tt.string();break}default:{tt.skipType(ot&7);break}}}return it})),et),a.encode=tt=>encodeMessage(tt,a.codec()),a.decode=(tt,rt)=>decodeMessage(tt,a.codec(),rt)})(o.SubOpts||(o.SubOpts={})),function(a){let et;a.codec=()=>(et==null&&(et=message((tt,rt,nt={})=>{nt.lengthDelimited!==!1&&rt.fork(),tt.from!=null&&(rt.uint32(10),rt.bytes(tt.from)),tt.data!=null&&(rt.uint32(18),rt.bytes(tt.data)),tt.seqno!=null&&(rt.uint32(26),rt.bytes(tt.seqno)),tt.topic!=null&&tt.topic!==""&&(rt.uint32(34),rt.string(tt.topic)),tt.signature!=null&&(rt.uint32(42),rt.bytes(tt.signature)),tt.key!=null&&(rt.uint32(50),rt.bytes(tt.key)),nt.lengthDelimited!==!1&&rt.ldelim()},(tt,rt,nt={})=>{const it={topic:""},st=rt==null?tt.len:tt.pos+rt;for(;tt.pos<st;){const ot=tt.uint32();switch(ot>>>3){case 1:{it.from=tt.bytes();break}case 2:{it.data=tt.bytes();break}case 3:{it.seqno=tt.bytes();break}case 4:{it.topic=tt.string();break}case 5:{it.signature=tt.bytes();break}case 6:{it.key=tt.bytes();break}default:{tt.skipType(ot&7);break}}}return it})),et),a.encode=tt=>encodeMessage(tt,a.codec()),a.decode=(tt,rt)=>decodeMessage(tt,a.codec(),rt)}(o.Message||(o.Message={})),function(a){let et;a.codec=()=>(et==null&&(et=message((tt,rt,nt={})=>{if(nt.lengthDelimited!==!1&&rt.fork(),tt.ihave!=null)for(const it of tt.ihave)rt.uint32(10),o.ControlIHave.codec().encode(it,rt);if(tt.iwant!=null)for(const it of tt.iwant)rt.uint32(18),o.ControlIWant.codec().encode(it,rt);if(tt.graft!=null)for(const it of tt.graft)rt.uint32(26),o.ControlGraft.codec().encode(it,rt);if(tt.prune!=null)for(const it of tt.prune)rt.uint32(34),o.ControlPrune.codec().encode(it,rt);nt.lengthDelimited!==!1&&rt.ldelim()},(tt,rt,nt={})=>{const it={ihave:[],iwant:[],graft:[],prune:[]},st=rt==null?tt.len:tt.pos+rt;for(;tt.pos<st;){const ot=tt.uint32();switch(ot>>>3){case 1:{if(nt.limits?.ihave!=null&&it.ihave.length===nt.limits.ihave)throw new CodeError$2('decode error - map field "ihave" had too many elements',"ERR_MAX_LENGTH");it.ihave.push(o.ControlIHave.codec().decode(tt,tt.uint32()));break}case 2:{if(nt.limits?.iwant!=null&&it.iwant.length===nt.limits.iwant)throw new CodeError$2('decode error - map field "iwant" had too many elements',"ERR_MAX_LENGTH");it.iwant.push(o.ControlIWant.codec().decode(tt,tt.uint32()));break}case 3:{if(nt.limits?.graft!=null&&it.graft.length===nt.limits.graft)throw new CodeError$2('decode error - map field "graft" had too many elements',"ERR_MAX_LENGTH");it.graft.push(o.ControlGraft.codec().decode(tt,tt.uint32()));break}case 4:{if(nt.limits?.prune!=null&&it.prune.length===nt.limits.prune)throw new CodeError$2('decode error - map field "prune" had too many elements',"ERR_MAX_LENGTH");it.prune.push(o.ControlPrune.codec().decode(tt,tt.uint32()));break}default:{tt.skipType(ot&7);break}}}return it})),et),a.encode=tt=>encodeMessage(tt,a.codec()),a.decode=(tt,rt)=>decodeMessage(tt,a.codec(),rt)}(o.ControlMessage||(o.ControlMessage={})),function(a){let et;a.codec=()=>(et==null&&(et=message((tt,rt,nt={})=>{if(nt.lengthDelimited!==!1&&rt.fork(),tt.topicID!=null&&(rt.uint32(10),rt.string(tt.topicID)),tt.messageIDs!=null)for(const it of tt.messageIDs)rt.uint32(18),rt.bytes(it);nt.lengthDelimited!==!1&&rt.ldelim()},(tt,rt,nt={})=>{const it={messageIDs:[]},st=rt==null?tt.len:tt.pos+rt;for(;tt.pos<st;){const ot=tt.uint32();switch(ot>>>3){case 1:{it.topicID=tt.string();break}case 2:{if(nt.limits?.messageIDs!=null&&it.messageIDs.length===nt.limits.messageIDs)throw new CodeError$2('decode error - map field "messageIDs" had too many elements',"ERR_MAX_LENGTH");it.messageIDs.push(tt.bytes());break}default:{tt.skipType(ot&7);break}}}return it})),et),a.encode=tt=>encodeMessage(tt,a.codec()),a.decode=(tt,rt)=>decodeMessage(tt,a.codec(),rt)}(o.ControlIHave||(o.ControlIHave={})),function(a){let et;a.codec=()=>(et==null&&(et=message((tt,rt,nt={})=>{if(nt.lengthDelimited!==!1&&rt.fork(),tt.messageIDs!=null)for(const it of tt.messageIDs)rt.uint32(10),rt.bytes(it);nt.lengthDelimited!==!1&&rt.ldelim()},(tt,rt,nt={})=>{const it={messageIDs:[]},st=rt==null?tt.len:tt.pos+rt;for(;tt.pos<st;){const ot=tt.uint32();switch(ot>>>3){case 1:{if(nt.limits?.messageIDs!=null&&it.messageIDs.length===nt.limits.messageIDs)throw new CodeError$2('decode error - map field "messageIDs" had too many elements',"ERR_MAX_LENGTH");it.messageIDs.push(tt.bytes());break}default:{tt.skipType(ot&7);break}}}return it})),et),a.encode=tt=>encodeMessage(tt,a.codec()),a.decode=(tt,rt)=>decodeMessage(tt,a.codec(),rt)}(o.ControlIWant||(o.ControlIWant={})),function(a){let et;a.codec=()=>(et==null&&(et=message((tt,rt,nt={})=>{nt.lengthDelimited!==!1&&rt.fork(),tt.topicID!=null&&(rt.uint32(10),rt.string(tt.topicID)),nt.lengthDelimited!==!1&&rt.ldelim()},(tt,rt,nt={})=>{const it={},st=rt==null?tt.len:tt.pos+rt;for(;tt.pos<st;){const ot=tt.uint32();switch(ot>>>3){case 1:{it.topicID=tt.string();break}default:{tt.skipType(ot&7);break}}}return it})),et),a.encode=tt=>encodeMessage(tt,a.codec()),a.decode=(tt,rt)=>decodeMessage(tt,a.codec(),rt)}(o.ControlGraft||(o.ControlGraft={})),function(a){let et;a.codec=()=>(et==null&&(et=message((tt,rt,nt={})=>{if(nt.lengthDelimited!==!1&&rt.fork(),tt.topicID!=null&&(rt.uint32(10),rt.string(tt.topicID)),tt.peers!=null)for(const it of tt.peers)rt.uint32(18),o.PeerInfo.codec().encode(it,rt);tt.backoff!=null&&(rt.uint32(24),rt.uint64Number(tt.backoff)),nt.lengthDelimited!==!1&&rt.ldelim()},(tt,rt,nt={})=>{const it={peers:[]},st=rt==null?tt.len:tt.pos+rt;for(;tt.pos<st;){const ot=tt.uint32();switch(ot>>>3){case 1:{it.topicID=tt.string();break}case 2:{if(nt.limits?.peers!=null&&it.peers.length===nt.limits.peers)throw new CodeError$2('decode error - map field "peers" had too many elements',"ERR_MAX_LENGTH");it.peers.push(o.PeerInfo.codec().decode(tt,tt.uint32()));break}case 3:{it.backoff=tt.uint64Number();break}default:{tt.skipType(ot&7);break}}}return it})),et),a.encode=tt=>encodeMessage(tt,a.codec()),a.decode=(tt,rt)=>decodeMessage(tt,a.codec(),rt)}(o.ControlPrune||(o.ControlPrune={})),function(a){let et;a.codec=()=>(et==null&&(et=message((tt,rt,nt={})=>{nt.lengthDelimited!==!1&&rt.fork(),tt.peerID!=null&&(rt.uint32(10),rt.bytes(tt.peerID)),tt.signedPeerRecord!=null&&(rt.uint32(18),rt.bytes(tt.signedPeerRecord)),nt.lengthDelimited!==!1&&rt.ldelim()},(tt,rt,nt={})=>{const it={},st=rt==null?tt.len:tt.pos+rt;for(;tt.pos<st;){const ot=tt.uint32();switch(ot>>>3){case 1:{it.peerID=tt.bytes();break}case 2:{it.signedPeerRecord=tt.bytes();break}default:{tt.skipType(ot&7);break}}}return it})),et),a.encode=tt=>encodeMessage(tt,a.codec()),a.decode=(tt,rt)=>decodeMessage(tt,a.codec(),rt)}(o.PeerInfo||(o.PeerInfo={}));let s;o.codec=()=>(s==null&&(s=message((a,et,tt={})=>{if(tt.lengthDelimited!==!1&&et.fork(),a.subscriptions!=null)for(const rt of a.subscriptions)et.uint32(10),o.SubOpts.codec().encode(rt,et);if(a.messages!=null)for(const rt of a.messages)et.uint32(18),o.Message.codec().encode(rt,et);a.control!=null&&(et.uint32(26),o.ControlMessage.codec().encode(a.control,et)),tt.lengthDelimited!==!1&&et.ldelim()},(a,et,tt={})=>{const rt={subscriptions:[],messages:[]},nt=et==null?a.len:a.pos+et;for(;a.pos<nt;){const it=a.uint32();switch(it>>>3){case 1:{if(tt.limits?.subscriptions!=null&&rt.subscriptions.length===tt.limits.subscriptions)throw new CodeError$2('decode error - map field "subscriptions" had too many elements',"ERR_MAX_LENGTH");rt.subscriptions.push(o.SubOpts.codec().decode(a,a.uint32()));break}case 2:{if(tt.limits?.messages!=null&&rt.messages.length===tt.limits.messages)throw new CodeError$2('decode error - map field "messages" had too many elements',"ERR_MAX_LENGTH");rt.messages.push(o.Message.codec().decode(a,a.uint32()));break}case 3:{rt.control=o.ControlMessage.codec().decode(a,a.uint32());break}default:{a.skipType(it&7);break}}}return rt})),s),o.encode=a=>encodeMessage(a,o.codec()),o.decode=(a,et)=>decodeMessage(a,o.codec(),et)})(RPC||(RPC={}));class MessageCache{gossip;msgs=new Map;msgIdToStrFn;history=[];notValidatedCount=0;constructor(s,a,et){this.gossip=s,this.msgIdToStrFn=et;for(let tt=0;tt<a;tt++)this.history[tt]=[]}get size(){return this.msgs.size}put(s,a,et=!1){const{msgIdStr:tt}=s;return this.msgs.has(tt)?!1:(this.msgs.set(tt,{message:a,validated:et,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...s,topic:a.topic}),et||this.notValidatedCount++,!0)}observeDuplicate(s,a){const et=this.msgs.get(s);et!=null&&!et.validated&&et.originatingPeers.add(a)}get(s){return this.msgs.get(this.msgIdToStrFn(s))?.message}getWithIWantCount(s,a){const et=this.msgs.get(s);if(et==null)return null;const tt=(et.iwantCounts.get(a)??0)+1;return et.iwantCounts.set(a,tt),{msg:et.message,count:tt}}getGossipIDs(s){const a=new Map;for(let et=0;et<this.gossip;et++)this.history[et].forEach(tt=>{if((this.msgs.get(tt.msgIdStr)?.validated??!1)&&s.has(tt.topic)){let nt=a.get(tt.topic);nt==null&&(nt=[],a.set(tt.topic,nt)),nt.push(tt.msgId)}});return a}validate(s){const a=this.msgs.get(s);if(a==null)return null;a.validated||this.notValidatedCount--;const{message:et,originatingPeers:tt}=a;return a.validated=!0,a.originatingPeers=new Set,{message:et,originatingPeers:tt}}shift(){this.history[this.history.length-1].forEach(a=>{const et=this.msgs.get(a.msgIdStr);et!=null&&(this.msgs.delete(a.msgIdStr),et.validated||this.notValidatedCount--)}),this.history.pop(),this.history.unshift([])}remove(s){const a=this.msgs.get(s);return a==null?null:(this.msgs.delete(s),a)}}var SignaturePolicy;(function(o){o.StrictSign="StrictSign",o.StrictNoSign="StrictNoSign"})(SignaturePolicy||(SignaturePolicy={}));var PublishConfigType;(function(o){o[o.Signing=0]="Signing",o[o.Anonymous=1]="Anonymous"})(PublishConfigType||(PublishConfigType={}));var RejectReason;(function(o){o.Error="error",o.Ignore="ignore",o.Reject="reject",o.Blacklisted="blacklisted"})(RejectReason||(RejectReason={}));var ValidateError;(function(o){o.InvalidSignature="invalid_signature",o.InvalidSeqno="invalid_seqno",o.InvalidPeerId="invalid_peerid",o.SignaturePresent="signature_present",o.SeqnoPresent="seqno_present",o.FromPresent="from_present",o.TransformFailed="transform_failed"})(ValidateError||(ValidateError={}));var MessageStatus;(function(o){o.duplicate="duplicate",o.invalid="invalid",o.valid="valid"})(MessageStatus||(MessageStatus={}));function rejectReasonFromAcceptance(o){switch(o){case TopicValidatorResult.Ignore:return RejectReason.Ignore;case TopicValidatorResult.Reject:return RejectReason.Reject;default:throw new Error("Unreachable")}}var MessageSource;(function(o){o.forward="forward",o.publish="publish"})(MessageSource||(MessageSource={}));var InclusionReason;(function(o){o.Fanout="fanout",o.Random="random",o.Subscribed="subscribed",o.Outbound="outbound",o.NotEnough="not_enough",o.Opportunistic="opportunistic"})(InclusionReason||(InclusionReason={}));var ChurnReason;(function(o){o.Dc="disconnected",o.BadScore="bad_score",o.Prune="prune",o.Excess="excess"})(ChurnReason||(ChurnReason={}));var ScorePenalty;(function(o){o.GraftBackoff="graft_backoff",o.BrokenPromise="broken_promise",o.MessageDeficit="message_deficit",o.IPColocation="IP_colocation"})(ScorePenalty||(ScorePenalty={}));var IHaveIgnoreReason;(function(o){o.LowScore="low_score",o.MaxIhave="max_ihave",o.MaxIasked="max_iasked"})(IHaveIgnoreReason||(IHaveIgnoreReason={}));var ScoreThreshold;(function(o){o.graylist="graylist",o.publish="publish",o.gossip="gossip",o.mesh="mesh"})(ScoreThreshold||(ScoreThreshold={}));function getMetrics(o,s,a){return{protocolsEnabled:o.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:o.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:o.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:o.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEventsFanout:o.gauge({name:"gossipsub_mesh_peer_inclusion_events_fanout_total",help:"Number of times we include peers in a topic mesh for fanout reasons",labelNames:["topic"]}),meshPeerInclusionEventsRandom:o.gauge({name:"gossipsub_mesh_peer_inclusion_events_random_total",help:"Number of times we include peers in a topic mesh for random reasons",labelNames:["topic"]}),meshPeerInclusionEventsSubscribed:o.gauge({name:"gossipsub_mesh_peer_inclusion_events_subscribed_total",help:"Number of times we include peers in a topic mesh for subscribed reasons",labelNames:["topic"]}),meshPeerInclusionEventsOutbound:o.gauge({name:"gossipsub_mesh_peer_inclusion_events_outbound_total",help:"Number of times we include peers in a topic mesh for outbound reasons",labelNames:["topic"]}),meshPeerInclusionEventsNotEnough:o.gauge({name:"gossipsub_mesh_peer_inclusion_events_not_enough_total",help:"Number of times we include peers in a topic mesh for not_enough reasons",labelNames:["topic"]}),meshPeerInclusionEventsOpportunistic:o.gauge({name:"gossipsub_mesh_peer_inclusion_events_opportunistic_total",help:"Number of times we include peers in a topic mesh for opportunistic reasons",labelNames:["topic"]}),meshPeerInclusionEventsUnknown:o.gauge({name:"gossipsub_mesh_peer_inclusion_events_unknown_total",help:"Number of times we include peers in a topic mesh for unknown reasons",labelNames:["topic"]}),meshPeerChurnEventsDisconnected:o.gauge({name:"gossipsub_peer_churn_events_disconnected_total",help:"Number of times we remove peers in a topic mesh for disconnected reasons",labelNames:["topic"]}),meshPeerChurnEventsBadScore:o.gauge({name:"gossipsub_peer_churn_events_bad_score_total",help:"Number of times we remove peers in a topic mesh for bad_score reasons",labelNames:["topic"]}),meshPeerChurnEventsPrune:o.gauge({name:"gossipsub_peer_churn_events_prune_total",help:"Number of times we remove peers in a topic mesh for prune reasons",labelNames:["topic"]}),meshPeerChurnEventsExcess:o.gauge({name:"gossipsub_peer_churn_events_excess_total",help:"Number of times we remove peers in a topic mesh for excess reasons",labelNames:["topic"]}),meshPeerChurnEventsUnknown:o.gauge({name:"gossipsub_peer_churn_events_unknown_total",help:"Number of times we remove peers in a topic mesh for unknown reasons",labelNames:["topic"]}),peersPerProtocol:o.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:o.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:o.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),acceptedMessagesTotal:o.gauge({name:"gossipsub_accepted_messages_total",help:"Total accepted messages for each topic",labelNames:["topic"]}),ignoredMessagesTotal:o.gauge({name:"gossipsub_ignored_messages_total",help:"Total ignored messages for each topic",labelNames:["topic"]}),rejectedMessagesTotal:o.gauge({name:"gossipsub_rejected_messages_total",help:"Total rejected messages for each topic",labelNames:["topic"]}),unknownValidationResultsTotal:o.gauge({name:"gossipsub_unknown_validation_results_total",help:"Total unknown validation results for each topic",labelNames:["topic"]}),asyncValidationMcacheHit:o.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),asyncValidationDelayFromFirstSeenSec:o.histogram({name:"gossipsub_async_validation_delay_from_first_seen",help:"Async validation report delay from first seen in second",buckets:[.01,.03,.1,.3,1,3,10]}),asyncValidationUnknownFirstSeen:o.gauge({name:"gossipsub_async_validation_unknown_first_seen_count_total",help:"Async validation report unknown first seen value for message"}),peerReadStreamError:o.gauge({name:"gossipsub_peer_read_stream_err_count_total",help:"Peer read stream error"}),rpcRecvBytes:o.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:o.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:o.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:o.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:o.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:o.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:o.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:o.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:o.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcDataError:o.gauge({name:"gossipsub_rpc_data_err_count_total",help:"RPC data error"}),rpcRecvError:o.gauge({name:"gossipsub_rpc_recv_err_count_total",help:"RPC recv error"}),rpcRecvNotAccepted:o.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:o.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:o.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:o.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:o.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:o.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:o.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:o.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:o.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:o.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),msgPublishCount:o.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeersByTopic:o.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),directPeersPublishedTotal:o.gauge({name:"gossipsub_direct_peers_published_total",help:"Total direct peers that we publish a msg to",labelNames:["topic"]}),floodsubPeersPublishedTotal:o.gauge({name:"gossipsub_floodsub_peers_published_total",help:"Total floodsub peers that we publish a msg to",labelNames:["topic"]}),meshPeersPublishedTotal:o.gauge({name:"gossipsub_mesh_peers_published_total",help:"Total mesh peers that we publish a msg to",labelNames:["topic"]}),fanoutPeersPublishedTotal:o.gauge({name:"gossipsub_fanout_peers_published_total",help:"Total fanout peers that we publish a msg to",labelNames:["topic"]}),msgPublishBytes:o.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgPublishTime:o.histogram({name:"gossipsub_msg_publish_seconds",help:"Total time in seconds to publish a message",buckets:[.001,.002,.005,.01,.1,.5,1],labelNames:["topic"]}),msgForwardCount:o.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:o.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:o.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedError:o.gauge({name:"gossipsub_msg_received_error_total",help:"Total count of recv msgs error",labelNames:["topic"]}),prevalidationInvalidTotal:o.gauge({name:"gossipsub_pre_validation_invalid_total",help:"Total count of invalid messages received",labelNames:["topic"]}),prevalidationValidTotal:o.gauge({name:"gossipsub_pre_validation_valid_total",help:"Total count of valid messages received",labelNames:["topic"]}),prevalidationDuplicateTotal:o.gauge({name:"gossipsub_pre_validation_duplicate_total",help:"Total count of duplicate messages received",labelNames:["topic"]}),prevalidationUnknownTotal:o.gauge({name:"gossipsub_pre_validation_unknown_status_total",help:"Total count of unknown_status messages received",labelNames:["topic"]}),msgReceivedInvalid:o.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["error"]}),msgReceivedInvalidByTopic:o.gauge({name:"gossipsub_msg_received_invalid_by_topic_total",help:"Tracks specific invalid message by topic",labelNames:["topic"]}),duplicateMsgDeliveryDelay:o.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*a.maxMeshMessageDeliveriesWindowSec,.5*a.maxMeshMessageDeliveriesWindowSec,Number(a.maxMeshMessageDeliveriesWindowSec),2*a.maxMeshMessageDeliveriesWindowSec,4*a.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:o.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),duplicateMsgIgnored:o.gauge({name:"gossisub_ignored_published_duplicate_msgs_total",help:"Total count of published duplicate message ignored by topic",labelNames:["topic"]}),scoreFnCalls:o.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:o.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:o.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:o.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:o.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores"}),scoreWeights:o.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:o.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:o.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:o.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*a.behaviourPenaltyThreshold,.5*a.behaviourPenaltyThreshold,Number(a.behaviourPenaltyThreshold),2*a.behaviourPenaltyThreshold,4*a.behaviourPenaltyThreshold]}),ihaveRcvIgnored:o.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:o.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:o.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:o.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:o.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),iwantPromiseStarted:o.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:o.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedFromDuplicate:o.gauge({name:"gossipsub_iwant_promise_resolved_from_duplicate_total",help:"Total count of resolved IWANT promises from duplicate messages"}),iwantPromiseResolvedPeers:o.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:o.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantMessagePruned:o.gauge({name:"gossipsub_iwant_message_pruned",help:"Total count of pruned IWANT messages"}),iwantPromiseDeliveryTime:o.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*a.gossipPromiseExpireSec,Number(a.gossipPromiseExpireSec),2*a.gossipPromiseExpireSec,4*a.gossipPromiseExpireSec]}),iwantPromiseUntracked:o.gauge({name:"gossip_iwant_promise_untracked",help:"Total count of untracked IWANT promise"}),connectedPeersBackoffSec:o.histogram({name:"gossipsub_connected_peers_backoff_seconds",help:"Backoff time in seconds",buckets:[1,2,4,10,20,60,120]}),cacheSize:o.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:o.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),mcacheNotValidatedCount:o.gauge({name:"gossipsub_mcache_not_validated_count",help:"Current mcache msg count not validated"}),fastMsgIdCacheCollision:o.gauge({name:"gossipsub_fastmsgid_cache_collision_total",help:"Total count of key collisions on fastmsgid cache put"}),newConnectionCount:o.gauge({name:"gossipsub_new_connection_total",help:"Total new connection by status",labelNames:["status"]}),topicStrToLabel:s,toTopic(et){return this.topicStrToLabel.get(et)??et},onJoin(et){this.topicSubscriptionStatus.set({topicStr:et},1),this.meshPeerCounts.set({topicStr:et},0)},onLeave(et){this.topicSubscriptionStatus.set({topicStr:et},0),this.meshPeerCounts.set({topicStr:et},0)},onAddToMesh(et,tt,rt){const nt=this.toTopic(et);switch(tt){case InclusionReason.Fanout:this.meshPeerInclusionEventsFanout.inc({topic:nt},rt);break;case InclusionReason.Random:this.meshPeerInclusionEventsRandom.inc({topic:nt},rt);break;case InclusionReason.Subscribed:this.meshPeerInclusionEventsSubscribed.inc({topic:nt},rt);break;case InclusionReason.Outbound:this.meshPeerInclusionEventsOutbound.inc({topic:nt},rt);break;case InclusionReason.NotEnough:this.meshPeerInclusionEventsNotEnough.inc({topic:nt},rt);break;case InclusionReason.Opportunistic:this.meshPeerInclusionEventsOpportunistic.inc({topic:nt},rt);break;default:this.meshPeerInclusionEventsUnknown.inc({topic:nt},rt);break}},onRemoveFromMesh(et,tt,rt){const nt=this.toTopic(et);switch(tt){case ChurnReason.Dc:this.meshPeerChurnEventsDisconnected.inc({topic:nt},rt);break;case ChurnReason.BadScore:this.meshPeerChurnEventsBadScore.inc({topic:nt},rt);break;case ChurnReason.Prune:this.meshPeerChurnEventsPrune.inc({topic:nt},rt);break;case ChurnReason.Excess:this.meshPeerChurnEventsExcess.inc({topic:nt},rt);break;default:this.meshPeerChurnEventsUnknown.inc({topic:nt},rt);break}},onReportValidation(et,tt,rt){if(this.asyncValidationMcacheHit.inc({hit:et!=null?"hit":"miss"}),et!=null){const nt=this.toTopic(et.message.topic);switch(tt){case TopicValidatorResult.Accept:this.acceptedMessagesTotal.inc({topic:nt});break;case TopicValidatorResult.Ignore:this.ignoredMessagesTotal.inc({topic:nt});break;case TopicValidatorResult.Reject:this.rejectedMessagesTotal.inc({topic:nt});break;default:this.unknownValidationResultsTotal.inc({topic:nt});break}}rt!=null?this.asyncValidationDelayFromFirstSeenSec.observe((Date.now()-rt)/1e3):this.asyncValidationUnknownFirstSeen.inc()},onScorePenalty(et){this.scoringPenalties.inc({penalty:et},1)},onIhaveRcv(et,tt,rt){const nt=this.toTopic(et);this.ihaveRcvMsgids.inc({topic:nt},tt),this.ihaveRcvNotSeenMsgids.inc({topic:nt},rt)},onIwantRcv(et,tt){for(const[rt,nt]of et){const it=this.toTopic(rt);this.iwantRcvMsgids.inc({topic:it},nt)}this.iwantRcvDonthaveMsgids.inc(tt)},onForwardMsg(et,tt){const rt=this.toTopic(et);this.msgForwardCount.inc({topic:rt},1),this.msgForwardPeers.inc({topic:rt},tt)},onPublishMsg(et,tt,rt,nt,it){const st=this.toTopic(et);this.msgPublishCount.inc({topic:st},1),this.msgPublishBytes.inc({topic:st},rt*nt),this.msgPublishPeersByTopic.inc({topic:st},rt),this.directPeersPublishedTotal.inc({topic:st},tt.direct),this.floodsubPeersPublishedTotal.inc({topic:st},tt.floodsub),this.meshPeersPublishedTotal.inc({topic:st},tt.mesh),this.fanoutPeersPublishedTotal.inc({topic:st},tt.fanout),this.msgPublishTime.observe({topic:st},it/1e3)},onMsgRecvPreValidation(et){const tt=this.toTopic(et);this.msgReceivedPreValidation.inc({topic:tt},1)},onMsgRecvError(et){const tt=this.toTopic(et);this.msgReceivedError.inc({topic:tt},1)},onPrevalidationResult(et,tt){const rt=this.toTopic(et);switch(tt){case MessageStatus.duplicate:this.prevalidationDuplicateTotal.inc({topic:rt});break;case MessageStatus.invalid:this.prevalidationInvalidTotal.inc({topic:rt});break;case MessageStatus.valid:this.prevalidationValidTotal.inc({topic:rt});break;default:this.prevalidationUnknownTotal.inc({topic:rt});break}},onMsgRecvInvalid(et,tt){const rt=this.toTopic(et),nt=tt.reason===RejectReason.Error?tt.error:tt.reason;this.msgReceivedInvalid.inc({error:nt},1),this.msgReceivedInvalidByTopic.inc({topic:rt},1)},onDuplicateMsgDelivery(et,tt,rt){const nt=this.toTopic(et);this.duplicateMsgDeliveryDelay.observe({topic:nt},tt/1e3),rt&&this.duplicateMsgLateDelivery.inc({topic:nt},1)},onPublishDuplicateMsg(et){const tt=this.toTopic(et);this.duplicateMsgIgnored.inc({topic:tt},1)},onPeerReadStreamError(){this.peerReadStreamError.inc(1)},onRpcRecvError(){this.rpcRecvError.inc(1)},onRpcDataError(){this.rpcDataError.inc(1)},onRpcRecv(et,tt){this.rpcRecvBytes.inc(tt),this.rpcRecvCount.inc(1),et.subscriptions!=null&&this.rpcRecvSubscription.inc(et.subscriptions.length),et.messages!=null&&this.rpcRecvMessage.inc(et.messages.length),et.control!=null&&(this.rpcRecvControl.inc(1),et.control.ihave!=null&&this.rpcRecvIHave.inc(et.control.ihave.length),et.control.iwant!=null&&this.rpcRecvIWant.inc(et.control.iwant.length),et.control.graft!=null&&this.rpcRecvGraft.inc(et.control.graft.length),et.control.prune!=null&&this.rpcRecvPrune.inc(et.control.prune.length))},onRpcSent(et,tt){if(this.rpcSentBytes.inc(tt),this.rpcSentCount.inc(1),et.subscriptions!=null&&this.rpcSentSubscription.inc(et.subscriptions.length),et.messages!=null&&this.rpcSentMessage.inc(et.messages.length),et.control!=null){const rt=et.control.ihave?.length??0,nt=et.control.iwant?.length??0,it=et.control.graft?.length??0,st=et.control.prune?.length??0;rt>0&&this.rpcSentIHave.inc(rt),nt>0&&this.rpcSentIWant.inc(nt),it>0&&this.rpcSentGraft.inc(it),st>0&&this.rpcSentPrune.inc(st),(rt>0||nt>0||it>0||st>0)&&this.rpcSentControl.inc(1)}},registerScores(et,tt){let rt=0,nt=0,it=0,st=0;for(const ot of et)ot>=tt.graylistThreshold&&rt++,ot>=tt.publishThreshold&&nt++,ot>=tt.gossipThreshold&&it++,ot>=0&&st++;this.peersByScoreThreshold.set({threshold:ScoreThreshold.graylist},rt),this.peersByScoreThreshold.set({threshold:ScoreThreshold.publish},nt),this.peersByScoreThreshold.set({threshold:ScoreThreshold.gossip},it),this.peersByScoreThreshold.set({threshold:ScoreThreshold.mesh},st),this.score.set(et)},registerScoreWeights(et){for(const[tt,rt]of et.byTopic)this.scoreWeights.set({topic:tt,p:"p1"},rt.p1w),this.scoreWeights.set({topic:tt,p:"p2"},rt.p2w),this.scoreWeights.set({topic:tt,p:"p3"},rt.p3w),this.scoreWeights.set({topic:tt,p:"p3b"},rt.p3bw),this.scoreWeights.set({topic:tt,p:"p4"},rt.p4w);this.scoreWeights.set({p:"p5"},et.p5w),this.scoreWeights.set({p:"p6"},et.p6w),this.scoreWeights.set({p:"p7"},et.p7w)},registerScorePerMesh(et,tt){const rt=new Map;et.forEach((nt,it)=>{const st=this.topicStrToLabel.get(it)??"unknown";let ot=rt.get(st);ot==null&&(ot=new Set,rt.set(st,ot)),nt.forEach(at=>ot?.add(at))});for(const[nt,it]of rt){const st=[];it.forEach(ot=>{st.push(tt.get(ot)??0)}),this.scorePerMesh.set({topic:nt},st)}}}}const ERR_INVALID_PEER_SCORE_PARAMS="ERR_INVALID_PEER_SCORE_PARAMS",defaultPeerScoreParams={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:3600*1e3},defaultTopicScoreParams={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function createPeerScoreParams(o={}){return{...defaultPeerScoreParams,...o,topics:o.topics!=null?Object.entries(o.topics).reduce((s,[a,et])=>(s[a]=createTopicScoreParams(et),s),{}):{}}}function createTopicScoreParams(o={}){return{...defaultTopicScoreParams,...o}}function validatePeerScoreParams(o){for(const[s,a]of Object.entries(o.topics))try{validateTopicScoreParams(a)}catch(et){throw new CodeError$3(`invalid score parameters for topic ${s}: ${et.message}`,ERR_INVALID_PEER_SCORE_PARAMS)}if(o.topicScoreCap<0)throw new CodeError$3("invalid topic score cap; must be positive (or 0 for no cap)",ERR_INVALID_PEER_SCORE_PARAMS);if(o.appSpecificScore===null||o.appSpecificScore===void 0)throw new CodeError$3("missing application specific score function",ERR_INVALID_PEER_SCORE_PARAMS);if(o.IPColocationFactorWeight>0)throw new CodeError$3("invalid IPColocationFactorWeight; must be negative (or 0 to disable)",ERR_INVALID_PEER_SCORE_PARAMS);if(o.IPColocationFactorWeight!==0&&o.IPColocationFactorThreshold<1)throw new CodeError$3("invalid IPColocationFactorThreshold; must be at least 1",ERR_INVALID_PEER_SCORE_PARAMS);if(o.behaviourPenaltyWeight>0)throw new CodeError$3("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)",ERR_INVALID_PEER_SCORE_PARAMS);if(o.behaviourPenaltyWeight!==0&&(o.behaviourPenaltyDecay<=0||o.behaviourPenaltyDecay>=1))throw new CodeError$3("invalid BehaviourPenaltyDecay; must be between 0 and 1",ERR_INVALID_PEER_SCORE_PARAMS);if(o.decayInterval<1e3)throw new CodeError$3("invalid DecayInterval; must be at least 1s",ERR_INVALID_PEER_SCORE_PARAMS);if(o.decayToZero<=0||o.decayToZero>=1)throw new CodeError$3("invalid DecayToZero; must be between 0 and 1",ERR_INVALID_PEER_SCORE_PARAMS)}function validateTopicScoreParams(o){if(o.topicWeight<0)throw new CodeError$3("invalid topic weight; must be >= 0",ERR_INVALID_PEER_SCORE_PARAMS);if(o.timeInMeshQuantum===0)throw new CodeError$3("invalid TimeInMeshQuantum; must be non zero",ERR_INVALID_PEER_SCORE_PARAMS);if(o.timeInMeshWeight<0)throw new CodeError$3("invalid TimeInMeshWeight; must be positive (or 0 to disable)",ERR_INVALID_PEER_SCORE_PARAMS);if(o.timeInMeshWeight!==0&&o.timeInMeshQuantum<=0)throw new CodeError$3("invalid TimeInMeshQuantum; must be positive",ERR_INVALID_PEER_SCORE_PARAMS);if(o.timeInMeshWeight!==0&&o.timeInMeshCap<=0)throw new CodeError$3("invalid TimeInMeshCap; must be positive",ERR_INVALID_PEER_SCORE_PARAMS);if(o.firstMessageDeliveriesWeight<0)throw new CodeError$3("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)",ERR_INVALID_PEER_SCORE_PARAMS);if(o.firstMessageDeliveriesWeight!==0&&(o.firstMessageDeliveriesDecay<=0||o.firstMessageDeliveriesDecay>=1))throw new CodeError$3("invalid FirstMessageDeliveriesDecay; must be between 0 and 1",ERR_INVALID_PEER_SCORE_PARAMS);if(o.firstMessageDeliveriesWeight!==0&&o.firstMessageDeliveriesCap<=0)throw new CodeError$3("invalid FirstMessageDeliveriesCap; must be positive",ERR_INVALID_PEER_SCORE_PARAMS);if(o.meshMessageDeliveriesWeight>0)throw new CodeError$3("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)",ERR_INVALID_PEER_SCORE_PARAMS);if(o.meshMessageDeliveriesWeight!==0&&(o.meshMessageDeliveriesDecay<=0||o.meshMessageDeliveriesDecay>=1))throw new CodeError$3("invalid MeshMessageDeliveriesDecay; must be between 0 and 1",ERR_INVALID_PEER_SCORE_PARAMS);if(o.meshMessageDeliveriesWeight!==0&&o.meshMessageDeliveriesCap<=0)throw new CodeError$3("invalid MeshMessageDeliveriesCap; must be positive",ERR_INVALID_PEER_SCORE_PARAMS);if(o.meshMessageDeliveriesWeight!==0&&o.meshMessageDeliveriesThreshold<=0)throw new CodeError$3("invalid MeshMessageDeliveriesThreshold; must be positive",ERR_INVALID_PEER_SCORE_PARAMS);if(o.meshMessageDeliveriesWindow<0)throw new CodeError$3("invalid MeshMessageDeliveriesWindow; must be non-negative",ERR_INVALID_PEER_SCORE_PARAMS);if(o.meshMessageDeliveriesWeight!==0&&o.meshMessageDeliveriesActivation<1e3)throw new CodeError$3("invalid MeshMessageDeliveriesActivation; must be at least 1s",ERR_INVALID_PEER_SCORE_PARAMS);if(o.meshFailurePenaltyWeight>0)throw new CodeError$3("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)",ERR_INVALID_PEER_SCORE_PARAMS);if(o.meshFailurePenaltyWeight!==0&&(o.meshFailurePenaltyDecay<=0||o.meshFailurePenaltyDecay>=1))throw new CodeError$3("invalid MeshFailurePenaltyDecay; must be between 0 and 1",ERR_INVALID_PEER_SCORE_PARAMS);if(o.invalidMessageDeliveriesWeight>0)throw new CodeError$3("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)",ERR_INVALID_PEER_SCORE_PARAMS);if(o.invalidMessageDeliveriesDecay<=0||o.invalidMessageDeliveriesDecay>=1)throw new CodeError$3("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1",ERR_INVALID_PEER_SCORE_PARAMS)}const defaultPeerScoreThresholds={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function createPeerScoreThresholds(o={}){return{...defaultPeerScoreThresholds,...o}}function removeItemsFromSet(o,s,a=()=>!0){const et=new Set;if(s<=0)return et;for(const tt of o){if(et.size>=s)break;a(tt)&&(et.add(tt),o.delete(tt))}return et}function removeFirstNItemsFromSet(o,s){return removeItemsFromSet(o,s,()=>!0)}class MapDef extends Map{getDefault;constructor(s){super(),this.getDefault=s}getOrDefault(s){let a=super.get(s);return a===void 0&&(a=this.getDefault(),this.set(s,a)),a}}function computeScore(o,s,a,et){let tt=0;Object.entries(s.topics).forEach(([nt,it])=>{const st=a.topics[nt];if(st===void 0)return;let ot=0;if(it.inMesh){let ht=it.meshTime/st.timeInMeshQuantum;ht>st.timeInMeshCap&&(ht=st.timeInMeshCap),ot+=ht*st.timeInMeshWeight}let at=it.firstMessageDeliveries;if(at>st.firstMessageDeliveriesCap&&(at=st.firstMessageDeliveriesCap),ot+=at*st.firstMessageDeliveriesWeight,it.meshMessageDeliveriesActive&&it.meshMessageDeliveries<st.meshMessageDeliveriesThreshold){const ht=st.meshMessageDeliveriesThreshold-it.meshMessageDeliveries,ft=ht*ht;ot+=ft*st.meshMessageDeliveriesWeight}const lt=it.meshFailurePenalty;ot+=lt*st.meshFailurePenaltyWeight;const ct=it.invalidMessageDeliveries*it.invalidMessageDeliveries;ot+=ct*st.invalidMessageDeliveriesWeight,tt+=ot*st.topicWeight}),a.topicScoreCap>0&&tt>a.topicScoreCap&&(tt=a.topicScoreCap);const rt=a.appSpecificScore(o);if(tt+=rt*a.appSpecificWeight,s.knownIPs.forEach(nt=>{if(a.IPColocationFactorWhitelist.has(nt))return;const it=et.get(nt),st=it!=null?it.size:0;if(st>a.IPColocationFactorThreshold){const ot=st-a.IPColocationFactorThreshold,at=ot*ot;tt+=at*a.IPColocationFactorWeight}}),s.behaviourPenalty>a.behaviourPenaltyThreshold){const nt=s.behaviourPenalty-a.behaviourPenaltyThreshold,it=nt*nt;tt+=it*a.behaviourPenaltyWeight}return tt}function Denque(o,a){var a=a||{};this._capacity=a.capacity,this._head=0,this._tail=0,Array.isArray(o)?this._fromArray(o):(this._capacityMask=3,this._list=new Array(4))}Denque.prototype.peekAt=function(s){var a=s;if(a===(a|0)){var et=this.size();if(!(a>=et||a<-et))return a<0&&(a+=et),a=this._head+a&this._capacityMask,this._list[a]}};Denque.prototype.get=function(s){return this.peekAt(s)};Denque.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]};Denque.prototype.peekFront=function(){return this.peek()};Denque.prototype.peekBack=function(){return this.peekAt(-1)};Object.defineProperty(Denque.prototype,"length",{get:function(){return this.size()}});Denque.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Denque.prototype.unshift=function(s){if(arguments.length===0)return this.size();var a=this._list.length;return this._head=this._head-1+a&this._capacityMask,this._list[this._head]=s,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Denque.prototype.shift=function(){var s=this._head;if(s!==this._tail){var a=this._list[s];return this._list[s]=void 0,this._head=s+1&this._capacityMask,s<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),a}};Denque.prototype.push=function(s){if(arguments.length===0)return this.size();var a=this._tail;return this._list[a]=s,this._tail=a+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Denque.prototype.pop=function(){var s=this._tail;if(s!==this._head){var a=this._list.length;this._tail=s-1+a&this._capacityMask;var et=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&s>1e4&&s<=a>>>2&&this._shrinkArray(),et}};Denque.prototype.removeOne=function(s){var a=s;if(a===(a|0)&&this._head!==this._tail){var et=this.size(),tt=this._list.length;if(!(a>=et||a<-et)){a<0&&(a+=et),a=this._head+a&this._capacityMask;var rt=this._list[a],nt;if(s<et/2){for(nt=s;nt>0;nt--)this._list[a]=this._list[a=a-1+tt&this._capacityMask];this._list[a]=void 0,this._head=this._head+1+tt&this._capacityMask}else{for(nt=et-1-s;nt>0;nt--)this._list[a]=this._list[a=a+1+tt&this._capacityMask];this._list[a]=void 0,this._tail=this._tail-1+tt&this._capacityMask}return rt}}};Denque.prototype.remove=function(s,a){var et=s,tt,rt=a;if(et===(et|0)&&this._head!==this._tail){var nt=this.size(),it=this._list.length;if(!(et>=nt||et<-nt||a<1)){if(et<0&&(et+=nt),a===1||!a)return tt=new Array(1),tt[0]=this.removeOne(et),tt;if(et===0&&et+a>=nt)return tt=this.toArray(),this.clear(),tt;et+a>nt&&(a=nt-et);var st;for(tt=new Array(a),st=0;st<a;st++)tt[st]=this._list[this._head+et+st&this._capacityMask];if(et=this._head+et&this._capacityMask,s+a===nt){for(this._tail=this._tail-a+it&this._capacityMask,st=a;st>0;st--)this._list[et=et+1+it&this._capacityMask]=void 0;return tt}if(s===0){for(this._head=this._head+a+it&this._capacityMask,st=a-1;st>0;st--)this._list[et=et+1+it&this._capacityMask]=void 0;return tt}if(et<nt/2){for(this._head=this._head+s+a+it&this._capacityMask,st=s;st>0;st--)this.unshift(this._list[et=et-1+it&this._capacityMask]);for(et=this._head-1+it&this._capacityMask;rt>0;)this._list[et=et-1+it&this._capacityMask]=void 0,rt--;s<0&&(this._tail=et)}else{for(this._tail=et,et=et+a+it&this._capacityMask,st=nt-(a+s);st>0;st--)this.push(this._list[et++]);for(et=this._tail;rt>0;)this._list[et=et+1+it&this._capacityMask]=void 0,rt--}return this._head<2&&this._tail>1e4&&this._tail<=it>>>2&&this._shrinkArray(),tt}}};Denque.prototype.splice=function(s,a){var et=s;if(et===(et|0)){var tt=this.size();if(et<0&&(et+=tt),!(et>tt))if(arguments.length>2){var rt,nt,it,st=arguments.length,ot=this._list.length,at=2;if(!tt||et<tt/2){for(nt=new Array(et),rt=0;rt<et;rt++)nt[rt]=this._list[this._head+rt&this._capacityMask];for(a===0?(it=[],et>0&&(this._head=this._head+et+ot&this._capacityMask)):(it=this.remove(et,a),this._head=this._head+et+ot&this._capacityMask);st>at;)this.unshift(arguments[--st]);for(rt=et;rt>0;rt--)this.unshift(nt[rt-1])}else{nt=new Array(tt-(et+a));var lt=nt.length;for(rt=0;rt<lt;rt++)nt[rt]=this._list[this._head+et+a+rt&this._capacityMask];for(a===0?(it=[],et!=tt&&(this._tail=this._head+et+ot&this._capacityMask)):(it=this.remove(et,a),this._tail=this._tail-lt+ot&this._capacityMask);at<st;)this.push(arguments[at++]);for(rt=0;rt<lt;rt++)this.push(nt[rt])}return it}else return this.remove(et,a)}};Denque.prototype.clear=function(){this._list=new Array(this._list.length),this._head=0,this._tail=0};Denque.prototype.isEmpty=function(){return this._head===this._tail};Denque.prototype.toArray=function(){return this._copyArray(!1)};Denque.prototype._fromArray=function(s){var a=s.length,et=this._nextPowerOf2(a);this._list=new Array(et),this._capacityMask=et-1,this._tail=a;for(var tt=0;tt<a;tt++)this._list[tt]=s[tt]};Denque.prototype._copyArray=function(s,a){var et=this._list,tt=et.length,rt=this.length;if(a=a|rt,a==rt&&this._head<this._tail)return this._list.slice(this._head,this._tail);var nt=new Array(a),it=0,st;if(s||this._head>this._tail){for(st=this._head;st<tt;st++)nt[it++]=et[st];for(st=0;st<this._tail;st++)nt[it++]=et[st]}else for(st=this._head;st<this._tail;st++)nt[it++]=et[st];return nt};Denque.prototype._growArray=function(){if(this._head!=0){var s=this._copyArray(!0,this._list.length<<1);this._tail=this._list.length,this._head=0,this._list=s}else this._tail=this._list.length,this._list.length<<=1;this._capacityMask=this._capacityMask<<1|1};Denque.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1};Denque.prototype._nextPowerOf2=function(s){var a=Math.log(s)/Math.log(2),et=1<<a+1;return Math.max(et,4)};var denque=Denque;const Denque$1=getDefaultExportFromCjs$2(denque);var DeliveryRecordStatus;(function(o){o[o.unknown=0]="unknown",o[o.valid=1]="valid",o[o.invalid=2]="invalid",o[o.ignored=3]="ignored"})(DeliveryRecordStatus||(DeliveryRecordStatus={}));class MessageDeliveries{records;queue;constructor(){this.records=new Map,this.queue=new Denque$1}getRecord(s){return this.records.get(s)}ensureRecord(s){let a=this.records.get(s);if(a!=null)return a;a={status:DeliveryRecordStatus.unknown,firstSeenTsMs:Date.now(),validated:0,peers:new Set},this.records.set(s,a);const et={msgId:s,expire:Date.now()+TimeCacheDuration};return this.queue.push(et),a}gc(){const s=Date.now();let a=this.queue.peekFront();for(;a!=null&&a.expire<s;)this.records.delete(a.msgId),this.queue.shift(),a=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}}class PeerScore{params;metrics;peerStats=new Map;peerIPs=new MapDef(()=>new Set);scoreCache=new Map;deliveryRecords=new MessageDeliveries;_backgroundInterval;scoreCacheValidityMs;computeScore;log;constructor(s,a,et,tt){this.params=s,this.metrics=a,validatePeerScoreParams(s),this.scoreCacheValidityMs=tt.scoreCacheValidityMs,this.computeScore=tt.computeScore??computeScore,this.log=et.forComponent("libp2p:gossipsub:score")}get size(){return this.peerStats.size}start(){if(this._backgroundInterval!=null){this.log("Peer score already running");return}this._backgroundInterval=setInterval(()=>{this.background()},this.params.decayInterval),this.log("started")}stop(){if(this._backgroundInterval==null){this.log("Peer score already stopped");return}clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),this.log("stopped")}background(){this.refreshScores(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map(([s,a])=>[s,a]))}messageFirstSeenTimestampMs(s){const a=this.deliveryRecords.getRecord(s);return a!=null?a.firstSeenTsMs:null}refreshScores(){const s=Date.now(),a=this.params.decayToZero;this.peerStats.forEach((et,tt)=>{if(!et.connected){s>et.expire&&(this.removeIPsForPeer(tt,et.knownIPs),this.peerStats.delete(tt),this.scoreCache.delete(tt));return}Object.entries(et.topics).forEach(([rt,nt])=>{const it=this.params.topics[rt];it!==void 0&&(nt.firstMessageDeliveries*=it.firstMessageDeliveriesDecay,nt.firstMessageDeliveries<a&&(nt.firstMessageDeliveries=0),nt.meshMessageDeliveries*=it.meshMessageDeliveriesDecay,nt.meshMessageDeliveries<a&&(nt.meshMessageDeliveries=0),nt.meshFailurePenalty*=it.meshFailurePenaltyDecay,nt.meshFailurePenalty<a&&(nt.meshFailurePenalty=0),nt.invalidMessageDeliveries*=it.invalidMessageDeliveriesDecay,nt.invalidMessageDeliveries<a&&(nt.invalidMessageDeliveries=0),nt.inMesh&&(nt.meshTime=s-nt.graftTime,nt.meshTime>it.meshMessageDeliveriesActivation&&(nt.meshMessageDeliveriesActive=!0)))}),et.behaviourPenalty*=this.params.behaviourPenaltyDecay,et.behaviourPenalty<a&&(et.behaviourPenalty=0)})}score(s){this.metrics?.scoreFnCalls.inc();const a=this.peerStats.get(s);if(a==null)return 0;const et=Date.now(),tt=this.scoreCache.get(s);if(tt!=null&&tt.cacheUntil>et)return tt.score;this.metrics?.scoreFnRuns.inc();const rt=this.computeScore(s,a,this.params,this.peerIPs),nt=et+this.scoreCacheValidityMs;return tt!=null?(this.metrics?.scoreCachedDelta.observe(Math.abs(rt-tt.score)),tt.score=rt,tt.cacheUntil=nt):this.scoreCache.set(s,{score:rt,cacheUntil:nt}),rt}addPenalty(s,a,et){const tt=this.peerStats.get(s);tt!=null&&(tt.behaviourPenalty+=a,this.metrics?.onScorePenalty(et))}addPeer(s){const a={connected:!0,expire:0,topics:{},knownIPs:new Set,behaviourPenalty:0};this.peerStats.set(s,a)}addIP(s,a){const et=this.peerStats.get(s);et?.knownIPs.add(a),this.peerIPs.getOrDefault(a).add(s)}removeIP(s,a){const et=this.peerStats.get(s);et?.knownIPs.delete(a);const tt=this.peerIPs.get(a);tt!=null&&(tt.delete(s),tt.size===0&&this.peerIPs.delete(a))}removePeer(s){const a=this.peerStats.get(s);if(a!=null){if(this.score(s)>0){this.removeIPsForPeer(s,a.knownIPs),this.peerStats.delete(s);return}Object.entries(a.topics).forEach(([et,tt])=>{tt.firstMessageDeliveries=0;const rt=this.params.topics[et].meshMessageDeliveriesThreshold;if(tt.inMesh&&tt.meshMessageDeliveriesActive&&tt.meshMessageDeliveries<rt){const nt=rt-tt.meshMessageDeliveries;tt.meshFailurePenalty+=nt*nt}tt.inMesh=!1,tt.meshMessageDeliveriesActive=!1}),a.connected=!1,a.expire=Date.now()+this.params.retainScore}}graft(s,a){const et=this.peerStats.get(s);if(et!=null){const tt=this.getPtopicStats(et,a);tt!=null&&(tt.inMesh=!0,tt.graftTime=Date.now(),tt.meshTime=0,tt.meshMessageDeliveriesActive=!1)}}prune(s,a){const et=this.peerStats.get(s);if(et!=null){const tt=this.getPtopicStats(et,a);if(tt!=null){const rt=this.params.topics[a].meshMessageDeliveriesThreshold;if(tt.meshMessageDeliveriesActive&&tt.meshMessageDeliveries<rt){const nt=rt-tt.meshMessageDeliveries;tt.meshFailurePenalty+=nt*nt}tt.meshMessageDeliveriesActive=!1,tt.inMesh=!1}}}validateMessage(s){this.deliveryRecords.ensureRecord(s)}deliverMessage(s,a,et){this.markFirstMessageDelivery(s,et);const tt=this.deliveryRecords.ensureRecord(a),rt=Date.now();if(tt.status!==DeliveryRecordStatus.unknown){this.log("unexpected delivery: message from %s was first seen %s ago and has delivery status %s",s,rt-tt.firstSeenTsMs,DeliveryRecordStatus[tt.status]);return}tt.status=DeliveryRecordStatus.valid,tt.validated=rt,tt.peers.forEach(nt=>{nt!==s.toString()&&this.markDuplicateMessageDelivery(nt,et)})}rejectInvalidMessage(s,a){this.markInvalidMessageDelivery(s,a)}rejectMessage(s,a,et,tt){switch(tt){case RejectReason.Error:this.markInvalidMessageDelivery(s,et);return;case RejectReason.Blacklisted:return}const rt=this.deliveryRecords.ensureRecord(a);if(rt.status!==DeliveryRecordStatus.unknown){this.log("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",s,Date.now()-rt.firstSeenTsMs,DeliveryRecordStatus[rt.status]);return}if(tt===RejectReason.Ignore){rt.status=DeliveryRecordStatus.ignored,rt.peers.clear();return}rt.status=DeliveryRecordStatus.invalid,this.markInvalidMessageDelivery(s,et),rt.peers.forEach(nt=>{this.markInvalidMessageDelivery(nt,et)}),rt.peers.clear()}duplicateMessage(s,a,et){const tt=this.deliveryRecords.ensureRecord(a);if(!tt.peers.has(s))switch(tt.status){case DeliveryRecordStatus.unknown:tt.peers.add(s);break;case DeliveryRecordStatus.valid:tt.peers.add(s),this.markDuplicateMessageDelivery(s,et,tt.validated);break;case DeliveryRecordStatus.invalid:this.markInvalidMessageDelivery(s,et);break;case DeliveryRecordStatus.ignored:break}}markInvalidMessageDelivery(s,a){const et=this.peerStats.get(s);if(et!=null){const tt=this.getPtopicStats(et,a);tt!=null&&(tt.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(s,a){const et=this.peerStats.get(s);if(et!=null){const tt=this.getPtopicStats(et,a);if(tt!=null){let rt=this.params.topics[a].firstMessageDeliveriesCap;tt.firstMessageDeliveries=Math.min(rt,tt.firstMessageDeliveries+1),tt.inMesh&&(rt=this.params.topics[a].meshMessageDeliveriesCap,tt.meshMessageDeliveries=Math.min(rt,tt.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(s,a,et){const tt=this.peerStats.get(s);if(tt!=null){const rt=et!==void 0?Date.now():0,nt=this.getPtopicStats(tt,a);if(nt!=null&&nt.inMesh){const it=this.params.topics[a];if(et!==void 0){const ot=rt-et,at=ot>it.meshMessageDeliveriesWindow;if(this.metrics?.onDuplicateMsgDelivery(a,ot,at),at)return}const st=it.meshMessageDeliveriesCap;nt.meshMessageDeliveries=Math.min(st,nt.meshMessageDeliveries+1)}}}removeIPsForPeer(s,a){for(const et of a){const tt=this.peerIPs.get(et);tt!=null&&(tt.delete(s),tt.size===0&&this.peerIPs.delete(et))}}getPtopicStats(s,a){let et=s.topics[a];return et!==void 0?et:this.params.topics[a]!==void 0?(et={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},s.topics[a]=et,et):null}}function computeScoreWeights(o,s,a,et,tt){let rt=0;const nt=new Map;if(Object.entries(s.topics).forEach(([ct,ht])=>{const ft=tt.get(ct)??"unknown",dt=a.topics[ct];if(dt===void 0)return;let pt=nt.get(ft);pt==null&&(pt={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},nt.set(ft,pt));let gt=0,mt=0,yt=0,vt=0,Et=0;if(ht.inMesh){const Ct=Math.max(ht.meshTime/dt.timeInMeshQuantum,dt.timeInMeshCap);gt+=Ct*dt.timeInMeshWeight}let xt=ht.firstMessageDeliveries;if(xt>dt.firstMessageDeliveriesCap&&(xt=dt.firstMessageDeliveriesCap),mt+=xt*dt.firstMessageDeliveriesWeight,ht.meshMessageDeliveriesActive&&ht.meshMessageDeliveries<dt.meshMessageDeliveriesThreshold){const Ct=dt.meshMessageDeliveriesThreshold-ht.meshMessageDeliveries,Ft=Ct*Ct;yt+=Ft*dt.meshMessageDeliveriesWeight}const wt=ht.meshFailurePenalty;vt+=wt*dt.meshFailurePenaltyWeight;const Rt=ht.invalidMessageDeliveries*ht.invalidMessageDeliveries;Et+=Rt*dt.invalidMessageDeliveriesWeight,rt+=(gt+mt+yt+vt+Et)*dt.topicWeight,pt.p1w+=gt,pt.p2w+=mt,pt.p3w+=yt,pt.p3bw+=vt,pt.p4w+=Et}),a.topicScoreCap>0&&rt>a.topicScoreCap){rt=a.topicScoreCap;const ct=a.topicScoreCap/rt;for(const ht of nt.values())ht.p1w*=ct,ht.p2w*=ct,ht.p3w*=ct,ht.p3bw*=ct,ht.p4w*=ct}let it=0,st=0,ot=0;const at=a.appSpecificScore(o);it+=at*a.appSpecificWeight,s.knownIPs.forEach(ct=>{if(a.IPColocationFactorWhitelist.has(ct))return;const ht=et.get(ct),ft=ht!=null?ht.size:0;if(ft>a.IPColocationFactorThreshold){const dt=ft-a.IPColocationFactorThreshold,pt=dt*dt;st+=pt*a.IPColocationFactorWeight}});const lt=s.behaviourPenalty*s.behaviourPenalty;return ot+=lt*a.behaviourPenaltyWeight,rt+=it+st+ot,{byTopic:nt,p5w:it,p6w:st,p7w:ot,score:rt}}function computeAllPeersScoreWeights(o,s,a,et,tt){const rt={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(const nt of o){const it=s.get(nt);if(it!=null){const st=computeScoreWeights(nt,it,a,et,tt);for(const[ot,at]of st.byTopic){let lt=rt.byTopic.get(ot);lt==null&&(lt={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},rt.byTopic.set(ot,lt)),lt.p1w.push(at.p1w),lt.p2w.push(at.p2w),lt.p3w.push(at.p3w),lt.p3bw.push(at.p3bw),lt.p4w.push(at.p4w)}rt.p5w.push(st.p5w),rt.p6w.push(st.p6w),rt.p7w.push(st.p7w),rt.score.push(st.score)}else rt.p5w.push(0),rt.p6w.push(0),rt.p7w.push(0),rt.score.push(0)}return rt}class OutboundStream{rawStream;pushable;closeController;maxBufferSize;constructor(s,a,et){this.rawStream=s,this.pushable=pushable(),this.closeController=new AbortController,this.maxBufferSize=et.maxBufferSize??1/0,this.closeController.signal.addEventListener("abort",()=>{s.close().catch(tt=>{s.abort(tt)})}),pipe(this.pushable,this.rawStream).catch(a)}get protocol(){return this.rawStream.protocol}push(s){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(encode$b.single(s))}pushPrefixed(s){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(s)}async close(){this.closeController.abort(),await this.pushable.return()}}class InboundStream{source;rawStream;closeController;constructor(s,a={}){this.rawStream=s,this.closeController=new AbortController,this.closeController.signal.addEventListener("abort",()=>{s.close().catch(et=>{s.abort(et)})}),this.source=pipe(this.rawStream,et=>decode$f(et,a))}async close(){this.closeController.abort()}}class IWantTracer{gossipsubIWantFollowupMs;msgIdToStrFn;metrics;promises=new Map;requestMsByMsg=new Map;requestMsByMsgExpire;constructor(s,a,et){this.gossipsubIWantFollowupMs=s,this.msgIdToStrFn=a,this.metrics=et,this.requestMsByMsgExpire=10*s}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(s,a){const et=Math.floor(Math.random()*a.length),tt=a[et],rt=this.msgIdToStrFn(tt);let nt=this.promises.get(rt);nt==null&&(nt=new Map,this.promises.set(rt,nt));const it=Date.now();nt.has(s)||(nt.set(s,it+this.gossipsubIWantFollowupMs),this.metrics!=null&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(rt)||this.requestMsByMsg.set(rt,it)))}getBrokenPromises(){const s=Date.now(),a=new Map;let et=0;return this.promises.forEach((tt,rt)=>{tt.forEach((nt,it)=>{nt<s&&(a.set(it,(a.get(it)??0)+1),tt.delete(it),et++)}),tt.size===0&&this.promises.delete(rt)}),this.metrics?.iwantPromiseBroken.inc(et),a}deliverMessage(s,a=!1){this.trackMessage(s);const et=this.promises.get(s);et!=null&&(this.promises.delete(s),this.metrics!=null&&(this.metrics.iwantPromiseResolved.inc(1),a&&this.metrics.iwantPromiseResolvedFromDuplicate.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(et.size)))}rejectMessage(s,a){switch(this.trackMessage(s),a){case RejectReason.Error:return}this.promises.delete(s)}clear(){this.promises.clear()}prune(){const s=Date.now()-this.requestMsByMsgExpire;let a=0;for(const[et,tt]of this.requestMsByMsg.entries())if(tt<s)this.requestMsByMsg.delete(et),a++;else break;this.metrics?.iwantMessagePruned.inc(a)}trackMessage(s){if(this.metrics!=null){const a=this.requestMsByMsg.get(s);a!==void 0&&(this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-a)/1e3),this.requestMsByMsg.delete(s))}}}function allocUnsafe$1(o=0){return new Uint8Array(o)}function asUint8Array$1(o){return o}function concat(o,s){s==null&&(s=o.reduce((tt,rt)=>tt+rt.length,0));const a=allocUnsafe$1(s);let et=0;for(const tt of o)a.set(tt,et),et+=tt.length;return a}function equals(o,s){if(o===s)return!0;if(o.byteLength!==s.byteLength)return!1;for(let a=0;a<o.byteLength;a++)if(o[a]!==s[a])return!1;return!0}function createCodec$1(o,s,a,et){return{name:o,prefix:s,encoder:{name:o,prefix:s,encode:a},decoder:{decode:et}}}const string$1=createCodec$1("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),ascii$1=createCodec$1("ascii","a",o=>{let s="a";for(let a=0;a<o.length;a++)s+=String.fromCharCode(o[a]);return s},o=>{o=o.substring(1);const s=allocUnsafe$1(o.length);for(let a=0;a<o.length;a++)s[a]=o.charCodeAt(a);return s}),BASES$1={utf8:string$1,"utf-8":string$1,hex:bases.base16,latin1:ascii$1,ascii:ascii$1,binary:ascii$1,...bases};function fromString$1(o,s="utf8"){const a=BASES$1[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.decoder.decode(`${a.prefix}${o}`)}function toString(o,s="utf8"){const a=BASES$1[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.encoder.encode(o).substring(1)}const SignPrefix=fromString$1("libp2p-pubsub:");async function buildRawMessage(o,s,a,et){switch(o.type){case PublishConfigType.Signing:{const tt={from:o.author.toBytes(),data:et,seqno:randomBytes(8),topic:s,signature:void 0,key:void 0},rt=concat([SignPrefix,RPC.Message.encode(tt)]);tt.signature=await o.privateKey.sign(rt),tt.key=o.key;const nt={type:"signed",from:o.author,data:a,sequenceNumber:BigInt(`0x${toString(tt.seqno,"base16")}`),topic:s,signature:tt.signature,key:tt.key};return{raw:tt,msg:nt}}case PublishConfigType.Anonymous:return{raw:{from:void 0,data:et,seqno:void 0,topic:s,signature:void 0,key:void 0},msg:{type:"unsigned",data:a,topic:s}};default:throw new Error("Unreachable")}}async function validateToRawMessage(o,s){switch(o){case StrictNoSign:return s.signature!=null?{valid:!1,error:ValidateError.SignaturePresent}:s.seqno!=null?{valid:!1,error:ValidateError.SeqnoPresent}:s.key!=null?{valid:!1,error:ValidateError.FromPresent}:{valid:!0,message:{type:"unsigned",topic:s.topic,data:s.data??new Uint8Array(0)}};case StrictSign:{if(s.seqno==null)return{valid:!1,error:ValidateError.InvalidSeqno};if(s.seqno.length!==8)return{valid:!1,error:ValidateError.InvalidSeqno};if(s.signature==null)return{valid:!1,error:ValidateError.InvalidSignature};if(s.from==null)return{valid:!1,error:ValidateError.InvalidPeerId};let a;try{a=peerIdFromBytes(s.from)}catch{return{valid:!1,error:ValidateError.InvalidPeerId}}let et;if(s.key!=null){if(et=unmarshalPublicKey(s.key),a.publicKey!==void 0&&!equals(et.bytes,a.publicKey))return{valid:!1,error:ValidateError.InvalidPeerId}}else{if(a.publicKey==null)return{valid:!1,error:ValidateError.InvalidPeerId};et=unmarshalPublicKey(a.publicKey)}const tt={from:s.from,data:s.data,seqno:s.seqno,topic:s.topic,signature:void 0,key:void 0},rt=concat([SignPrefix,RPC.Message.encode(tt)]);return await et.verify(rt,s.signature)?{valid:!0,message:{type:"signed",from:a,data:s.data??new Uint8Array(0),sequenceNumber:BigInt(`0x${toString(s.seqno,"base16")}`),topic:s.topic,signature:s.signature,key:s.key??marshalPublicKey(et)}}:{valid:!1,error:ValidateError.InvalidSignature}}default:throw new Error("Unreachable")}}function createGossipRpc(o=[],s){return{subscriptions:[],messages:o,control:s!==void 0?{graft:s.graft??[],prune:s.prune??[],ihave:s.ihave??[],iwant:s.iwant??[]}:void 0}}function ensureControl(o){return o.control===void 0&&(o.control={graft:[],prune:[],ihave:[],iwant:[]}),o}function shuffle$1(o){if(o.length<=1)return o;const s=()=>Math.floor(Math.random()*Math.floor(o.length));for(let a=0;a<o.length;a++){const et=s(),tt=o[a];o[a]=o[et],o[et]=tt}return o}function messageIdToString(o){return toString(o,"base64")}async function getPublishConfigFromPeerId(o,s){switch(o){case StrictSign:{if(s==null)throw Error("Must provide PeerId");if(s.privateKey==null)throw Error("Cannot sign message, no private key present");if(s.publicKey==null)throw Error("Cannot sign message, no public key present");const a=await unmarshalPrivateKey(s.privateKey);return{type:PublishConfigType.Signing,author:s,key:s.publicKey,privateKey:a}}case StrictNoSign:return{type:PublishConfigType.Anonymous};default:throw new Error(`Unknown signature policy "${o}"`)}}function allocUnsafe(o=0){return new Uint8Array(o)}function createCodec(o,s,a,et){return{name:o,prefix:s,encoder:{name:o,prefix:s,encode:a},decoder:{decode:et}}}const string=createCodec("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),ascii=createCodec("ascii","a",o=>{let s="a";for(let a=0;a<o.length;a++)s+=String.fromCharCode(o[a]);return s},o=>{o=o.substring(1);const s=allocUnsafe(o.length);for(let a=0;a<o.length;a++)s[a]=o.charCodeAt(a);return s}),BASES={utf8:string,"utf-8":string,hex:bases.base16,latin1:ascii,ascii,binary:ascii,...bases};function fromString(o,s="utf8"){const a=BASES[s];if(a==null)throw new Error(`Unsupported encoding "${s}"`);return a.decoder.decode(`${a.prefix}${o}`)}const msgId=(o,s)=>{const a=fromString(s.toString(16).padStart(16,"0"),"base16"),et=new Uint8Array(o.length+a.length);return et.set(o,0),et.set(a,o.length),et};function msgIdFnStrictSign(o){if(o.type!=="signed")throw new Error("expected signed message type");if(o.sequenceNumber==null)throw Error("missing seqno field");return msgId(o.from.toBytes(),o.sequenceNumber)}async function msgIdFnStrictNoSign(o){return sha256$1.encode(o.data)}var Protocol;(function(o){o[o.ip4=4]="ip4",o[o.ip6=41]="ip6"})(Protocol||(Protocol={}));function multiaddrToIPStr(o){for(const s of o.tuples())switch(s[0]){case Protocol.ip4:case Protocol.ip6:return convertToString(s[0],s[1])}return null}class SimpleTimeCache{entries=new Map;validityMs;constructor(s){this.validityMs=s.validityMs}get size(){return this.entries.size}put(s,a){return this.entries.has(s)?!0:(this.entries.set(s,{value:a,validUntilMs:Date.now()+this.validityMs}),!1)}prune(){const s=Date.now();for(const[a,et]of this.entries.entries())if(et.validUntilMs<s)this.entries.delete(a);else break}has(s){return this.entries.has(s)}get(s){const a=this.entries.get(s);return a!=null&&a.validUntilMs>=Date.now()?a.value:void 0}clear(){this.entries.clear()}}var GossipStatusCode;(function(o){o[o.started=0]="started",o[o.stopped=1]="stopped"})(GossipStatusCode||(GossipStatusCode={}));class GossipSub extends TypedEventEmitter{globalSignaturePolicy;multicodecs=[GossipsubIDv11,GossipsubIDv10];publishConfig;dataTransform;peers=new Set;streamsInbound=new Map;streamsOutbound=new Map;outboundInflightQueue=pushable({objectMode:!0});direct=new Set;floodsubPeers=new Set;seenCache;acceptFromWhitelist=new Map;topics=new Map;subscriptions=new Set;mesh=new Map;fanout=new Map;fanoutLastpub=new Map;gossip=new Map;control=new Map;peerhave=new Map;iasked=new Map;backoff=new Map;outbound=new Map;msgIdFn;fastMsgIdFn;msgIdToStrFn;fastMsgIdCache;publishedMessageIds;mcache;score;topicValidators=new Map;log;heartbeatTicks=0;gossipTracer;components;directPeerInitial=null;static multicodec=GossipsubIDv11;opts;decodeRpcLimits;metrics;status={code:GossipStatusCode.stopped};maxInboundStreams;maxOutboundStreams;runOnTransientConnection;allowedTopics;heartbeatTimer=null;constructor(s,a={}){super();const et={fallbackToFloodsub:!0,floodPublish:!0,batchPublish:!1,tagMeshPeers:!0,doPX:!1,directPeers:[],D:GossipsubD,Dlo:GossipsubDlo,Dhi:GossipsubDhi,Dscore:GossipsubDscore,Dout:GossipsubDout,Dlazy:GossipsubDlazy,heartbeatInterval:GossipsubHeartbeatInterval,fanoutTTL:GossipsubFanoutTTL,mcacheLength:GossipsubHistoryLength,mcacheGossip:GossipsubHistoryGossip,seenTTL:GossipsubSeenTTL,gossipsubIWantFollowupMs:GossipsubIWantFollowupTime,prunePeers:GossipsubPrunePeers,pruneBackoff:GossipsubPruneBackoff,unsubcribeBackoff:GossipsubUnsubscribeBackoff,graftFloodThreshold:GossipsubGraftFloodThreshold,opportunisticGraftPeers:GossipsubOpportunisticGraftPeers,opportunisticGraftTicks:GossipsubOpportunisticGraftTicks,directConnectTicks:GossipsubDirectConnectTicks,...a,scoreParams:createPeerScoreParams(a.scoreParams),scoreThresholds:createPeerScoreThresholds(a.scoreThresholds)};if(this.components=s,this.decodeRpcLimits=et.decodeRpcLimits??defaultDecodeRpcLimits,this.globalSignaturePolicy=et.globalSignaturePolicy??StrictSign,et.fallbackToFloodsub&&this.multicodecs.push(FloodsubID),this.log=s.logger.forComponent(et.debugName??"libp2p:gossipsub"),this.opts=et,this.direct=new Set(et.directPeers.map(tt=>tt.id.toString())),this.seenCache=new SimpleTimeCache({validityMs:et.seenTTL}),this.publishedMessageIds=new SimpleTimeCache({validityMs:et.seenTTL}),a.msgIdFn!=null)this.msgIdFn=a.msgIdFn;else switch(this.globalSignaturePolicy){case StrictSign:this.msgIdFn=msgIdFnStrictSign;break;case StrictNoSign:this.msgIdFn=msgIdFnStrictNoSign;break;default:throw new Error(`Invalid globalSignaturePolicy: ${this.globalSignaturePolicy}`)}if(a.fastMsgIdFn!=null&&(this.fastMsgIdFn=a.fastMsgIdFn,this.fastMsgIdCache=new SimpleTimeCache({validityMs:et.seenTTL})),this.msgIdToStrFn=a.msgIdToStrFn??messageIdToString,this.mcache=a.messageCache??new MessageCache(et.mcacheGossip,et.mcacheLength,this.msgIdToStrFn),a.dataTransform!=null&&(this.dataTransform=a.dataTransform),a.metricsRegister!=null){if(a.metricsTopicStrToLabel==null)throw Error("Must set metricsTopicStrToLabel with metrics");const tt=Math.max(...Object.values(et.scoreParams.topics).map(nt=>nt.meshMessageDeliveriesWindow),DEFAULT_METRIC_MESH_MESSAGE_DELIVERIES_WINDOWS),rt=getMetrics(a.metricsRegister,a.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:et.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:tt/1e3});rt.mcacheSize.addCollect(()=>{this.onScrapeMetrics(rt)});for(const nt of this.multicodecs)rt.protocolsEnabled.set({protocol:nt},1);this.metrics=rt}else this.metrics=null;this.gossipTracer=new IWantTracer(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new PeerScore(this.opts.scoreParams,this.metrics,this.components.logger,{scoreCacheValidityMs:et.heartbeatInterval}),this.maxInboundStreams=a.maxInboundStreams,this.maxOutboundStreams=a.maxOutboundStreams,this.runOnTransientConnection=a.runOnTransientConnection,this.allowedTopics=et.allowedTopics!=null?new Set(et.allowedTopics):null}getPeers(){return[...this.peers.keys()].map(s=>peerIdFromString(s))}isStarted(){return this.status.code===GossipStatusCode.started}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=await getPublishConfigFromPeerId(this.globalSignaturePolicy,this.components.peerId),this.outboundInflightQueue=pushable({objectMode:!0}),pipe(this.outboundInflightQueue,async rt=>{for await(const{peerId:nt,connection:it}of rt)await this.createOutboundStream(nt,it)}).catch(rt=>{this.log.error("outbound inflight queue error",rt)}),await Promise.all(this.opts.directPeers.map(async rt=>{await this.components.peerStore.merge(rt.id,{multiaddrs:rt.addrs})}));const s=this.components.registrar;await Promise.all(this.multicodecs.map(async rt=>s.handle(rt,this.onIncomingStream.bind(this),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnTransientConnection:this.runOnTransientConnection})));const a={onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this),notifyOnTransient:this.runOnTransientConnection},et=await Promise.all(this.multicodecs.map(async rt=>s.register(rt,a))),tt=setTimeout(this.runHeartbeat,GossipsubHeartbeatInitialDelay);this.status={code:GossipStatusCode.started,registrarTopologyIds:et,heartbeatTimeout:tt,hearbeatStartMs:Date.now()+GossipsubHeartbeatInitialDelay},this.score.start(),this.directPeerInitial=setTimeout(()=>{Promise.resolve().then(async()=>{await Promise.all(Array.from(this.direct).map(async rt=>this.connect(rt)))}).catch(rt=>{this.log(rt)})},GossipsubDirectConnectInitialDelay),this.opts.tagMeshPeers&&(this.addEventListener("gossipsub:graft",this.tagMeshPeer),this.addEventListener("gossipsub:prune",this.untagMeshPeer)),this.log("started")}async stop(){if(this.log("stopping"),this.status.code!==GossipStatusCode.started)return;const{registrarTopologyIds:s}=this.status;this.status={code:GossipStatusCode.stopped},this.opts.tagMeshPeers&&(this.removeEventListener("gossipsub:graft",this.tagMeshPeer),this.removeEventListener("gossipsub:prune",this.untagMeshPeer));const a=this.components.registrar;await Promise.all(this.multicodecs.map(async tt=>a.unhandle(tt))),s.forEach(tt=>{a.unregister(tt)}),this.outboundInflightQueue.end();const et=[];for(const tt of this.streamsOutbound.values())et.push(tt.close());this.streamsOutbound.clear();for(const tt of this.streamsInbound.values())et.push(tt.close());this.streamsInbound.clear(),await Promise.all(et),this.peers.clear(),this.subscriptions.clear(),this.heartbeatTimer!=null&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),this.fastMsgIdCache!=null&&this.fastMsgIdCache.clear(),this.directPeerInitial!=null&&clearTimeout(this.directPeerInitial),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream({stream:s,connection:a}){if(!this.isStarted())return;const et=a.remotePeer;this.addPeer(et,a.direction,a.remoteAddr),this.createInboundStream(et,s),this.outboundInflightQueue.push({peerId:et,connection:a})}onPeerConnected(s,a){this.metrics?.newConnectionCount.inc({status:a.status}),!(!this.isStarted()||a.status!=="open")&&(this.addPeer(s,a.direction,a.remoteAddr),this.outboundInflightQueue.push({peerId:s,connection:a}))}onPeerDisconnected(s){this.log("connection ended %p",s),this.removePeer(s)}async createOutboundStream(s,a){if(!this.isStarted())return;const et=s.toString();if(this.peers.has(et)&&!this.streamsOutbound.has(et))try{const tt=new OutboundStream(await a.newStream(this.multicodecs,{runOnTransientConnection:this.runOnTransientConnection}),nt=>{this.log.error("outbound pipe error",nt)},{maxBufferSize:this.opts.maxOutboundBufferSize});this.log("create outbound stream %p",s),this.streamsOutbound.set(et,tt);const rt=tt.protocol;rt===FloodsubID&&this.floodsubPeers.add(et),this.metrics?.peersPerProtocol.inc({protocol:rt},1),this.subscriptions.size>0&&(this.log("send subscriptions to",et),this.sendSubscriptions(et,Array.from(this.subscriptions),!0))}catch(tt){this.log.error("createOutboundStream error",tt)}}createInboundStream(s,a){if(!this.isStarted())return;const et=s.toString();if(!this.peers.has(et))return;const tt=this.streamsInbound.get(et);tt!==void 0&&(this.log("replacing existing inbound steam %s",et),tt.close().catch(nt=>{this.log.error(nt)})),this.log("create inbound stream %s",et);const rt=new InboundStream(a,{maxDataLength:this.opts.maxInboundDataLength});this.streamsInbound.set(et,rt),this.pipePeerReadStream(s,rt.source).catch(nt=>{this.log(nt)})}addPeer(s,a,et){const tt=s.toString();if(!this.peers.has(tt)){this.log("new peer %p",s),this.peers.add(tt),this.score.addPeer(tt);const rt=multiaddrToIPStr(et);rt!==null?this.score.addIP(tt,rt):this.log("Added peer has no IP in current address %s %s",tt,et.toString()),this.outbound.has(tt)||this.outbound.set(tt,a==="outbound")}}removePeer(s){const a=s.toString();if(!this.peers.has(a))return;this.log("delete peer %p",s),this.peers.delete(a);const et=this.streamsOutbound.get(a),tt=this.streamsInbound.get(a);et!=null&&this.metrics?.peersPerProtocol.inc({protocol:et.protocol},-1),et?.close().catch(rt=>{this.log.error(rt)}),tt?.close().catch(rt=>{this.log.error(rt)}),this.streamsOutbound.delete(a),this.streamsInbound.delete(a);for(const rt of this.topics.values())rt.delete(a);for(const[rt,nt]of this.mesh)nt.delete(a)&&this.metrics?.onRemoveFromMesh(rt,ChurnReason.Dc,1);for(const rt of this.fanout.values())rt.delete(a);this.floodsubPeers.delete(a),this.gossip.delete(a),this.control.delete(a),this.outbound.delete(a),this.score.removePeer(a),this.acceptFromWhitelist.delete(a)}get started(){return this.status.code===GossipStatusCode.started}getMeshPeers(s){const a=this.mesh.get(s);return a!=null?Array.from(a):[]}getSubscribers(s){const a=this.topics.get(s);return(a!=null?Array.from(a):[]).map(et=>peerIdFromString(et))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(s,a){try{await pipe(a,async et=>{for await(const tt of et)try{const rt=tt.subarray(),nt=RPC.decode(rt,{limits:{subscriptions:this.decodeRpcLimits.maxSubscriptions,messages:this.decodeRpcLimits.maxMessages,control$:{ihave:this.decodeRpcLimits.maxIhaveMessageIDs,iwant:this.decodeRpcLimits.maxIwantMessageIDs,graft:this.decodeRpcLimits.maxControlMessages,prune:this.decodeRpcLimits.maxControlMessages,prune$:{peers:this.decodeRpcLimits.maxPeerInfos}}}});if(this.metrics?.onRpcRecv(nt,rt.length),this.opts.awaitRpcHandler)try{await this.handleReceivedRpc(s,nt)}catch(it){this.metrics?.onRpcRecvError(),this.log(it)}else this.handleReceivedRpc(s,nt).catch(it=>{this.metrics?.onRpcRecvError(),this.log(it)})}catch(rt){this.metrics?.onRpcDataError(),this.log(rt)}})}catch(et){this.metrics?.onPeerReadStreamError(),this.handlePeerReadStreamError(et,s)}}handlePeerReadStreamError(s,a){this.log.error(s),this.onPeerDisconnected(a)}async handleReceivedRpc(s,a){if(!this.acceptFrom(s.toString())){this.log("received message from unacceptable peer %p",s),this.metrics?.rpcRecvNotAccepted.inc();return}const et=a.subscriptions!=null?a.subscriptions.length:0,tt=a.messages!=null?a.messages.length:0;let rt=0,nt=0,it=0,st=0;if(a.control!=null&&(a.control.ihave!=null&&(rt=a.control.ihave.length),a.control.iwant!=null&&(nt=a.control.iwant.length),a.control.graft!=null&&(it=a.control.graft.length),a.control.prune!=null&&(st=a.control.prune.length)),this.log(`rpc.from ${s.toString()} subscriptions ${et} messages ${tt} ihave ${rt} iwant ${nt} graft ${it} prune ${st}`),a.subscriptions!=null&&a.subscriptions.length>0){const ot=[];a.subscriptions.forEach(at=>{const lt=at.topic,ct=at.subscribe===!0;if(lt!=null){if(this.allowedTopics!=null&&!this.allowedTopics.has(lt))return;this.handleReceivedSubscription(s,lt,ct),ot.push({topic:lt,subscribe:ct})}}),this.safeDispatchEvent("subscription-change",{detail:{peerId:s,subscriptions:ot}})}for(const ot of a.messages){if(this.allowedTopics!=null&&!this.allowedTopics.has(ot.topic))continue;const at=this.handleReceivedMessage(s,ot).catch(lt=>{this.metrics?.onMsgRecvError(ot.topic),this.log(lt)});this.opts.awaitRpcMessageHandler&&await at}a.control!=null&&await this.handleControlMessage(s.toString(),a.control)}handleReceivedSubscription(s,a,et){this.log("subscription update from %p topic %s",s,a);let tt=this.topics.get(a);tt==null&&(tt=new Set,this.topics.set(a,tt)),et?tt.add(s.toString()):tt.delete(s.toString())}async handleReceivedMessage(s,a){this.metrics?.onMsgRecvPreValidation(a.topic);const et=await this.validateReceivedMessage(s,a);this.metrics?.onPrevalidationResult(a.topic,et.code);const tt=et.code;switch(tt){case MessageStatus.duplicate:this.score.duplicateMessage(s.toString(),et.msgIdStr,a.topic),this.gossipTracer.deliverMessage(et.msgIdStr,!0),this.mcache.observeDuplicate(et.msgIdStr,s.toString());return;case MessageStatus.invalid:if(et.msgIdStr!=null){const rt=et.msgIdStr;this.score.rejectMessage(s.toString(),rt,a.topic,et.reason),this.gossipTracer.rejectMessage(rt,et.reason)}else this.score.rejectInvalidMessage(s.toString(),a.topic);this.metrics?.onMsgRecvInvalid(a.topic,et);return;case MessageStatus.valid:this.score.validateMessage(et.messageId.msgIdStr),this.gossipTracer.deliverMessage(et.messageId.msgIdStr),this.mcache.put(et.messageId,a,!this.opts.asyncValidation),this.subscriptions.has(a.topic)&&(!this.components.peerId.equals(s)||this.opts.emitSelf)&&(super.dispatchEvent(new CustomEvent$2("gossipsub:message",{detail:{propagationSource:s,msgId:et.messageId.msgIdStr,msg:et.msg}})),super.dispatchEvent(new CustomEvent$2("message",{detail:et.msg}))),this.opts.asyncValidation||this.forwardMessage(et.messageId.msgIdStr,a,s.toString());break;default:throw new Error(`Invalid validation result: ${tt}`)}}async validateReceivedMessage(s,a){const et=this.fastMsgIdFn?.(a),tt=et!==void 0?this.fastMsgIdCache?.get(et):void 0;if(tt!=null)return{code:MessageStatus.duplicate,msgIdStr:tt};const rt=await validateToRawMessage(this.globalSignaturePolicy,a);if(!rt.valid)return{code:MessageStatus.invalid,reason:RejectReason.Error,error:rt.error};const nt=rt.message;try{this.dataTransform!=null&&(nt.data=this.dataTransform.inboundTransform(a.topic,nt.data))}catch(lt){return this.log("Invalid message, transform failed",lt),{code:MessageStatus.invalid,reason:RejectReason.Error,error:ValidateError.TransformFailed}}const it=await this.msgIdFn(nt),st=this.msgIdToStrFn(it),ot={msgId:it,msgIdStr:st};if(et!==void 0&&this.fastMsgIdCache!=null&&this.fastMsgIdCache.put(et,st)&&this.metrics?.fastMsgIdCacheCollision.inc(),this.seenCache.has(st))return{code:MessageStatus.duplicate,msgIdStr:st};this.seenCache.put(st);const at=this.topicValidators.get(a.topic);if(at!=null){let lt;try{lt=await at(s,nt)}catch(ct){const ht=ct.code;ht===ERR_TOPIC_VALIDATOR_IGNORE&&(lt=TopicValidatorResult.Ignore),ht===ERR_TOPIC_VALIDATOR_REJECT?lt=TopicValidatorResult.Reject:lt=TopicValidatorResult.Ignore}if(lt!==TopicValidatorResult.Accept)return{code:MessageStatus.invalid,reason:rejectReasonFromAcceptance(lt),msgIdStr:st}}return{code:MessageStatus.valid,messageId:ot,msg:nt}}getScore(s){return this.score.score(s)}sendSubscriptions(s,a,et){this.sendRpc(s,{subscriptions:a.map(tt=>({topic:tt,subscribe:et})),messages:[]})}async handleControlMessage(s,a){if(a===void 0)return;const et=a.ihave!=null?this.handleIHave(s,a.ihave):[],tt=a.iwant!=null?this.handleIWant(s,a.iwant):[],rt=a.graft!=null?await this.handleGraft(s,a.graft):[];if(a.prune!=null&&await this.handlePrune(s,a.prune),et.length===0&&tt.length===0&&rt.length===0)return;const nt=this.sendRpc(s,createGossipRpc(tt,{iwant:et,prune:rt})),it=et[0]?.messageIDs;it!=null&&(nt?this.gossipTracer.addPromise(s,it):this.metrics?.iwantPromiseUntracked.inc(1))}acceptFrom(s){if(this.direct.has(s))return!0;const a=Date.now(),et=this.acceptFromWhitelist.get(s);if(et!=null&&et.messagesAccepted<ACCEPT_FROM_WHITELIST_MAX_MESSAGES&&et.acceptUntil>=a)return et.messagesAccepted+=1,!0;const tt=this.score.score(s);return tt>=ACCEPT_FROM_WHITELIST_THRESHOLD_SCORE?this.acceptFromWhitelist.set(s,{messagesAccepted:0,acceptUntil:a+ACCEPT_FROM_WHITELIST_DURATION_MS}):this.acceptFromWhitelist.delete(s),tt>=this.opts.scoreThresholds.graylistThreshold}handleIHave(s,a){if(a.length===0)return[];const et=this.score.score(s);if(et<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",s,et),this.metrics?.ihaveRcvIgnored.inc({reason:IHaveIgnoreReason.LowScore}),[];const tt=(this.peerhave.get(s)??0)+1;if(this.peerhave.set(s,tt),tt>GossipsubMaxIHaveMessages)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",s,tt),this.metrics?.ihaveRcvIgnored.inc({reason:IHaveIgnoreReason.MaxIhave}),[];const rt=this.iasked.get(s)??0;if(rt>=GossipsubMaxIHaveLength)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",s,rt),this.metrics?.ihaveRcvIgnored.inc({reason:IHaveIgnoreReason.MaxIasked}),[];const nt=new Map;if(a.forEach(({topicID:ot,messageIDs:at})=>{if(ot==null||at==null||!this.mesh.has(ot))return;let lt=0;at.forEach(ct=>{const ht=this.msgIdToStrFn(ct);this.seenCache.has(ht)||(nt.set(ht,ct),lt++)}),this.metrics?.onIhaveRcv(ot,at.length,lt)}),nt.size===0)return[];let it=nt.size;it+rt>GossipsubMaxIHaveLength&&(it=GossipsubMaxIHaveLength-rt),this.log("IHAVE: Asking for %d out of %d messages from %s",it,nt.size,s);let st=Array.from(nt.values());return shuffle$1(st),st=st.slice(0,it),this.iasked.set(s,rt+it),[{messageIDs:st}]}handleIWant(s,a){if(a.length===0)return[];const et=this.score.score(s);if(et<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",s,et),[];const tt=new Map,rt=new Map;let nt=0;return a.forEach(({messageIDs:it})=>{it?.forEach(st=>{const ot=this.msgIdToStrFn(st),at=this.mcache.getWithIWantCount(ot,s);if(at==null){nt++;return}if(rt.set(at.msg.topic,1+(rt.get(at.msg.topic)??0)),at.count>GossipsubGossipRetransmission){this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",s,st);return}tt.set(ot,at.msg)})}),this.metrics?.onIwantRcv(rt,nt),tt.size===0?(this.log("IWANT: Could not provide any wanted messages to %s",s),[]):(this.log("IWANT: Sending %d messages to %s",tt.size,s),Array.from(tt.values()))}async handleGraft(s,a){const et=[],tt=this.score.score(s),rt=Date.now();let nt=this.opts.doPX;if(a.forEach(({topicID:st})=>{if(st==null)return;const ot=this.mesh.get(st);if(ot==null){nt=!1;return}if(ot.has(s))return;const at=this.backoff.get(st)?.get(s);if(this.direct.has(s))this.log("GRAFT: ignoring request from direct peer %s",s),et.push(st),nt=!1;else if(typeof at=="number"&&rt<at){this.log("GRAFT: ignoring backed off peer %s",s),this.score.addPenalty(s,1,ScorePenalty.GraftBackoff),nt=!1;const lt=at+this.opts.graftFloodThreshold-this.opts.pruneBackoff;rt<lt&&this.score.addPenalty(s,1,ScorePenalty.GraftBackoff),this.addBackoff(s,st),et.push(st)}else tt<0?(this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",s,tt,st),et.push(st),nt=!1,this.addBackoff(s,st)):ot.size>=this.opts.Dhi&&!(this.outbound.get(s)??!1)?(et.push(st),this.addBackoff(s,st)):(this.log("GRAFT: Add mesh link from %s in %s",s,st),this.score.graft(s,st),ot.add(s),this.metrics?.onAddToMesh(st,InclusionReason.Subscribed,1));this.safeDispatchEvent("gossipsub:graft",{detail:{peerId:s,topic:st,direction:"inbound"}})}),et.length===0)return[];const it=!1;return Promise.all(et.map(async st=>this.makePrune(s,st,nt,it)))}async handlePrune(s,a){const et=this.score.score(s);for(const{topicID:tt,backoff:rt,peers:nt}of a){if(tt==null)continue;const it=this.mesh.get(tt);if(it==null)return;this.log("PRUNE: Remove mesh link to %s in %s",s,tt),this.score.prune(s,tt),it.has(s)&&(it.delete(s),this.metrics?.onRemoveFromMesh(tt,ChurnReason.Prune,1)),typeof rt=="number"&&rt>0?this.doAddBackoff(s,tt,rt*1e3):this.addBackoff(s,tt),nt!=null&&nt.length>0&&(et<this.opts.scoreThresholds.acceptPXThreshold?this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",s,et,tt):await this.pxConnect(nt)),this.safeDispatchEvent("gossipsub:prune",{detail:{peerId:s,topic:tt,direction:"inbound"}})}}addBackoff(s,a){this.doAddBackoff(s,a,this.opts.pruneBackoff)}doAddBackoff(s,a,et){let tt=this.backoff.get(a);tt==null&&(tt=new Map,this.backoff.set(a,tt));const rt=Date.now()+et;(tt.get(s)??0)<rt&&tt.set(s,rt)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach((s,a)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",a,s),this.score.addPenalty(a,s,ScorePenalty.BrokenPromise)})}clearBackoff(){if(this.heartbeatTicks%GossipsubPruneBackoffTicks!==0)return;const s=Date.now();this.backoff.forEach((a,et)=>{a.forEach((tt,rt)=>{tt+BACKOFF_SLACK*this.opts.heartbeatInterval<s&&a.delete(rt)}),a.size===0&&this.backoff.delete(et)})}async directConnect(){const s=[];this.direct.forEach(a=>{this.streamsOutbound.has(a)||s.push(a)}),await Promise.all(s.map(async a=>this.connect(a)))}async pxConnect(s){s.length>this.opts.prunePeers&&(shuffle$1(s),s=s.slice(0,this.opts.prunePeers));const a=[];await Promise.all(s.map(async et=>{if(et.peerID==null)return;const tt=peerIdFromBytes(et.peerID),rt=tt.toString();if(!this.peers.has(rt)){if(et.signedPeerRecord==null){a.push(rt);return}try{if(!await this.components.peerStore.consumePeerRecord(et.signedPeerRecord,tt)){this.log("bogus peer record obtained through px: could not add peer record to address book");return}a.push(rt)}catch{this.log("bogus peer record obtained through px: invalid signature or not a peer record")}}})),a.length!==0&&await Promise.all(a.map(async et=>this.connect(et)))}async connect(s){this.log("Initiating connection with %s",s);const a=peerIdFromString(s),et=await this.components.connectionManager.openConnection(a);for(const tt of this.multicodecs)for(const rt of this.components.registrar.getTopologies(tt))rt.onConnect?.(a,et)}subscribe(s){if(this.status.code!==GossipStatusCode.started)throw new Error("Pubsub has not started");if(!this.subscriptions.has(s)){this.subscriptions.add(s);for(const a of this.peers.keys())this.sendSubscriptions(a,[s],!0)}this.join(s)}unsubscribe(s){if(this.status.code!==GossipStatusCode.started)throw new Error("Pubsub is not started");const a=this.subscriptions.delete(s);if(this.log("unsubscribe from %s - am subscribed %s",s,a),a)for(const et of this.peers.keys())this.sendSubscriptions(et,[s],!1);this.leave(s)}join(s){if(this.status.code!==GossipStatusCode.started)throw new Error("Gossipsub has not started");if(this.mesh.has(s))return;this.log("JOIN %s",s),this.metrics?.onJoin(s);const a=new Set,et=this.backoff.get(s),tt=this.fanout.get(s);if(tt!=null&&(this.fanout.delete(s),this.fanoutLastpub.delete(s),tt.forEach(rt=>{!this.direct.has(rt)&&this.score.score(rt)>=0&&(et==null||!et.has(rt))&&a.add(rt)}),this.metrics?.onAddToMesh(s,InclusionReason.Fanout,a.size)),a.size<this.opts.D){const rt=a.size;this.getRandomGossipPeers(s,this.opts.D,it=>!a.has(it)&&!this.direct.has(it)&&this.score.score(it)>=0&&(et==null||!et.has(it))).forEach(it=>{a.add(it)}),this.metrics?.onAddToMesh(s,InclusionReason.Random,a.size-rt)}this.mesh.set(s,a),a.forEach(rt=>{this.log("JOIN: Add mesh link to %s in %s",rt,s),this.sendGraft(rt,s)})}leave(s){if(this.status.code!==GossipStatusCode.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",s),this.metrics?.onLeave(s);const a=this.mesh.get(s);a!=null&&(Promise.all(Array.from(a).map(async et=>{this.log("LEAVE: Remove mesh link to %s in %s",et,s),await this.sendPrune(et,s)})).catch(et=>{this.log("Error sending prunes to mesh peers",et)}),this.mesh.delete(s))}selectPeersToForward(s,a,et){const tt=new Set,rt=this.topics.get(s);rt!=null&&(this.direct.forEach(it=>{rt.has(it)&&a!==it&&!(et?.has(it)??!1)&&tt.add(it)}),this.floodsubPeers.forEach(it=>{rt.has(it)&&a!==it&&!(et?.has(it)??!1)&&this.score.score(it)>=this.opts.scoreThresholds.publishThreshold&&tt.add(it)}));const nt=this.mesh.get(s);return nt!=null&&nt.size>0&&nt.forEach(it=>{a!==it&&!(et?.has(it)??!1)&&tt.add(it)}),tt}selectPeersToPublish(s){const a=new Set,et={direct:0,floodsub:0,mesh:0,fanout:0},tt=this.topics.get(s);if(tt!=null)if(this.opts.floodPublish)tt.forEach(rt=>{this.direct.has(rt)?(a.add(rt),et.direct++):this.score.score(rt)>=this.opts.scoreThresholds.publishThreshold&&(a.add(rt),et.floodsub++)});else{this.direct.forEach(nt=>{tt.has(nt)&&(a.add(nt),et.direct++)}),this.floodsubPeers.forEach(nt=>{tt.has(nt)&&this.score.score(nt)>=this.opts.scoreThresholds.publishThreshold&&(a.add(nt),et.floodsub++)});const rt=this.mesh.get(s);if(rt!=null&&rt.size>0)rt.forEach(nt=>{a.add(nt),et.mesh++});else{const nt=this.fanout.get(s);if(nt!=null&&nt.size>0)nt.forEach(it=>{a.add(it),et.fanout++});else{const it=this.getRandomGossipPeers(s,this.opts.D,st=>this.score.score(st)>=this.opts.scoreThresholds.publishThreshold);it.size>0&&(this.fanout.set(s,it),it.forEach(st=>{a.add(st),et.fanout++}))}this.fanoutLastpub.set(s,Date.now())}}return{tosend:a,tosendCount:et}}forwardMessage(s,a,et,tt){et!=null&&this.score.deliverMessage(et,s,a.topic);const rt=this.selectPeersToForward(a.topic,et,tt);rt.forEach(nt=>{this.sendRpc(nt,createGossipRpc([a]))}),this.metrics?.onForwardMsg(a.topic,rt.size)}async publish(s,a,et){const tt=Date.now(),rt=this.dataTransform!=null?this.dataTransform.outboundTransform(s,a):a;if(this.publishConfig==null)throw Error("PublishError.Uninitialized");const{raw:nt,msg:it}=await buildRawMessage(this.publishConfig,s,a,rt),st=await this.msgIdFn(it),ot=this.msgIdToStrFn(st),at=et?.ignoreDuplicatePublishError??this.opts.ignoreDuplicatePublishError;if(this.seenCache.has(ot)){if(at)return this.metrics?.onPublishDuplicateMsg(s),{recipients:[]};throw Error("PublishError.Duplicate")}const{tosend:lt,tosendCount:ct}=this.selectPeersToPublish(s),ht=this.opts.emitSelf&&this.subscriptions.has(s),ft=et?.allowPublishToZeroTopicPeers??this.opts.allowPublishToZeroTopicPeers;if(lt.size===0&&!ft&&!ht)throw Error("PublishError.NoPeersSubscribedToTopic");this.seenCache.put(ot),this.mcache.put({msgId:st,msgIdStr:ot},nt,!0),this.publishedMessageIds.put(ot);const dt=et?.batchPublish??this.opts.batchPublish,pt=createGossipRpc([nt]);if(dt)this.sendRpcInBatch(lt,pt);else for(const mt of lt)this.sendRpc(mt,pt)||lt.delete(mt);const gt=Date.now()-tt;return this.metrics?.onPublishMsg(s,ct,lt.size,nt.data!=null?nt.data.length:0,gt),ht&&(lt.add(this.components.peerId.toString()),super.dispatchEvent(new CustomEvent$2("gossipsub:message",{detail:{propagationSource:this.components.peerId,msgId:ot,msg:it}})),super.dispatchEvent(new CustomEvent$2("message",{detail:it}))),{recipients:Array.from(lt.values()).map(mt=>peerIdFromString(mt))}}sendRpcInBatch(s,a){const et=RPC.encode(a),tt=encode$b.single(et);for(const rt of s){const nt=this.streamsOutbound.get(rt);if(nt==null){this.log(`Cannot send RPC to ${rt} as there is no open stream to it available`),s.delete(rt);continue}try{nt.pushPrefixed(tt)}catch(it){s.delete(rt),this.log.error(`Cannot send rpc to ${rt}`,it)}this.metrics?.onRpcSent(a,et.length)}}reportMessageValidationResult(s,a,et){let tt;if(et===TopicValidatorResult.Accept){if(tt=this.mcache.validate(s),tt!=null){const{message:nt,originatingPeers:it}=tt;this.score.deliverMessage(a,s,nt.topic),this.forwardMessage(s,tt.message,a,it)}}else if(tt=this.mcache.remove(s),tt!=null){const nt=rejectReasonFromAcceptance(et),{message:it,originatingPeers:st}=tt;this.score.rejectMessage(a,s,it.topic,nt);for(const ot of st)this.score.rejectMessage(ot,s,it.topic,nt)}const rt=this.score.messageFirstSeenTimestampMs(s);this.metrics?.onReportValidation(tt,et,rt)}sendGraft(s,a){const tt=createGossipRpc([],{graft:[{topicID:a}]});this.sendRpc(s,tt)}async sendPrune(s,a){const tt=[await this.makePrune(s,a,this.opts.doPX,!0)],rt=createGossipRpc([],{prune:tt});this.sendRpc(s,rt)}sendRpc(s,a){const et=this.streamsOutbound.get(s);if(et==null)return this.log(`Cannot send RPC to ${s} as there is no open stream to it available`),!1;const tt=this.control.get(s);tt!=null&&(this.piggybackControl(s,a,tt),this.control.delete(s));const rt=this.gossip.get(s);rt!=null&&(this.piggybackGossip(s,a,rt),this.gossip.delete(s));const nt=RPC.encode(a);try{et.push(nt)}catch(it){return this.log.error(`Cannot send rpc to ${s}`,it),tt!=null&&this.control.set(s,tt),rt!=null&&this.gossip.set(s,rt),!1}if(this.metrics?.onRpcSent(a,nt.length),a.control?.graft!=null)for(const it of a.control?.graft)it.topicID!=null&&this.safeDispatchEvent("gossipsub:graft",{detail:{peerId:s,topic:it.topicID,direction:"outbound"}});if(a.control?.prune!=null)for(const it of a.control?.prune)it.topicID!=null&&this.safeDispatchEvent("gossipsub:prune",{detail:{peerId:s,topic:it.topicID,direction:"outbound"}});return!0}piggybackControl(s,a,et){const tt=ensureControl(a);for(const rt of et.graft)rt.topicID!=null&&(this.mesh.get(rt.topicID)?.has(s)??!1)&&tt.control.graft.push(rt);for(const rt of et.prune)rt.topicID!=null&&!(this.mesh.get(rt.topicID)?.has(s)??!1)&&tt.control.prune.push(rt)}piggybackGossip(s,a,et){const tt=ensureControl(a);tt.control.ihave=et}async sendGraftPrune(s,a,et){const tt=this.opts.doPX,rt=!1;for(const[nt,it]of s){const st=it.map(lt=>({topicID:lt}));let ot=[];const at=a.get(nt);at!=null&&(ot=await Promise.all(at.map(async lt=>this.makePrune(nt,lt,tt&&!(et.get(nt)??!1),rt))),a.delete(nt)),this.sendRpc(nt,createGossipRpc([],{graft:st,prune:ot}))}for(const[nt,it]of a){const st=await Promise.all(it.map(async ot=>this.makePrune(nt,ot,tt&&!(et.get(nt)??!1),rt)));this.sendRpc(nt,createGossipRpc([],{prune:st}))}}emitGossip(s){const a=this.mcache.getGossipIDs(new Set(s.keys()));for(const[et,tt]of s)this.doEmitGossip(et,tt,a.get(et)??[])}doEmitGossip(s,a,et){if(et.length===0||(shuffle$1(et),et.length>GossipsubMaxIHaveLength&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",et.length),a.size===0))return;let tt=this.opts.Dlazy;const rt=GossipsubGossipFactor*a.size;let nt=a;rt>tt&&(tt=rt),tt>nt.size?tt=nt.size:nt=shuffle$1(Array.from(nt)).slice(0,tt),nt.forEach(it=>{let st=et;et.length>GossipsubMaxIHaveLength&&(st=shuffle$1(st.slice()).slice(0,GossipsubMaxIHaveLength)),this.pushGossip(it,{topicID:s,messageIDs:st})})}flush(){for(const[s,a]of this.gossip.entries())this.gossip.delete(s),this.sendRpc(s,createGossipRpc([],{ihave:a}));for(const[s,a]of this.control.entries()){this.control.delete(s);const et=createGossipRpc([],{graft:a.graft,prune:a.prune});this.sendRpc(s,et)}}pushGossip(s,a){this.log("Add gossip to %s",s);const et=this.gossip.get(s)??[];this.gossip.set(s,et.concat(a))}async makePrune(s,a,et,tt){if(this.score.prune(s,a),this.streamsOutbound.get(s)?.protocol===GossipsubIDv10)return{topicID:a,peers:[]};const rt=tt?this.opts.unsubcribeBackoff:this.opts.pruneBackoff,nt=rt/1e3;if(this.doAddBackoff(s,a,rt),!et)return{topicID:a,peers:[],backoff:nt};const it=this.getRandomGossipPeers(a,this.opts.prunePeers,ot=>ot!==s&&this.score.score(ot)>=0),st=await Promise.all(Array.from(it).map(async ot=>{const at=peerIdFromString(ot);let lt;try{lt=await this.components.peerStore.get(at)}catch(ct){if(ct.code!=="ERR_NOT_FOUND")throw ct}return{peerID:at.toBytes(),signedPeerRecord:lt?.peerRecordEnvelope}}));return{topicID:a,peers:st,backoff:nt}}runHeartbeat=()=>{const s=this.metrics?.heartbeatDuration.startTimer();this.heartbeat().catch(a=>{this.log("Error running heartbeat",a)}).finally(()=>{if(s?.(),this.status.code===GossipStatusCode.started){clearTimeout(this.status.heartbeatTimeout);let a=this.opts.heartbeatInterval-(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;a<this.opts.heartbeatInterval*.25&&(a+=this.opts.heartbeatInterval,this.metrics?.heartbeatSkipped.inc()),this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,a)}})};async heartbeat(){const{D:s,Dlo:a,Dhi:et,Dscore:tt,Dout:rt,fanoutTTL:nt}=this.opts;this.heartbeatTicks++;const it=new Map,st=ft=>{let dt=it.get(ft);return dt===void 0&&(dt=this.score.score(ft),it.set(ft,dt)),dt},ot=new Map,at=new Map,lt=new Map;this.clearBackoff(),this.peerhave.clear(),this.metrics?.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.heartbeatTicks%this.opts.directConnectTicks===0&&await this.directConnect(),this.fastMsgIdCache?.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();const ct=new Map;this.mesh.forEach((ft,dt)=>{const pt=this.topics.get(dt),gt=new Set,mt=new Set;if(ct.set(dt,mt),pt!=null){const Et=shuffle$1(Array.from(pt)),xt=this.backoff.get(dt);for(const wt of Et){const Rt=this.streamsOutbound.get(wt);if(Rt!=null&&this.multicodecs.includes(Rt.protocol)&&!ft.has(wt)&&!this.direct.has(wt)){const Ct=st(wt);(xt==null||!xt.has(wt))&&Ct>=0&&gt.add(wt),Ct>=this.opts.scoreThresholds.gossipThreshold&&mt.add(wt)}}}const yt=(Et,xt)=>{this.log("HEARTBEAT: Remove mesh link to %s in %s",Et,dt),this.addBackoff(Et,dt),ft.delete(Et),st(Et)>=this.opts.scoreThresholds.gossipThreshold&&mt.add(Et),this.metrics?.onRemoveFromMesh(dt,xt,1);const wt=at.get(Et);wt==null?at.set(Et,[dt]):wt.push(dt)},vt=(Et,xt)=>{this.log("HEARTBEAT: Add mesh link to %s in %s",Et,dt),this.score.graft(Et,dt),ft.add(Et),mt.delete(Et),this.metrics?.onAddToMesh(dt,xt,1);const wt=ot.get(Et);wt==null?ot.set(Et,[dt]):wt.push(dt)};if(ft.forEach(Et=>{const xt=st(Et);xt<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",Et,xt,dt),yt(Et,ChurnReason.BadScore),lt.set(Et,!0))}),ft.size<a){const Et=s-ft.size;removeFirstNItemsFromSet(gt,Et).forEach(wt=>{vt(wt,InclusionReason.NotEnough)})}if(ft.size>et){let Et=Array.from(ft);Et.sort((wt,Rt)=>st(Rt)-st(wt)),Et=Et.slice(0,tt).concat(shuffle$1(Et.slice(tt)));let xt=0;if(Et.slice(0,s).forEach(wt=>{(this.outbound.get(wt)??!1)&&xt++}),xt<rt){const wt=Ct=>{const Ft=Et[Ct];for(let zt=Ct;zt>0;zt--)Et[zt]=Et[zt-1];Et[0]=Ft};if(xt>0){let Ct=xt;for(let Ft=1;Ft<s&&Ct>0;Ft++)(this.outbound.get(Et[Ft])??!1)&&(wt(Ft),Ct--)}let Rt=s-xt;for(let Ct=s;Ct<Et.length&&Rt>0;Ct++)(this.outbound.get(Et[Ct])??!1)&&(wt(Ct),Rt--)}Et.slice(s).forEach(wt=>{yt(wt,ChurnReason.Excess)})}if(ft.size>=a){let Et=0;if(ft.forEach(xt=>{(this.outbound.get(xt)??!1)&&Et++}),Et<rt){const xt=rt-Et;removeItemsFromSet(gt,xt,Rt=>this.outbound.get(Rt)===!0).forEach(Rt=>{vt(Rt,InclusionReason.Outbound)})}}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks===0&&ft.size>1){const Et=Array.from(ft).sort((Rt,Ct)=>st(Rt)-st(Ct)),xt=Math.floor(ft.size/2),wt=st(Et[xt]);if(wt<this.opts.scoreThresholds.opportunisticGraftThreshold){const Rt=this.opts.opportunisticGraftPeers,Ct=removeItemsFromSet(gt,Rt,Ft=>st(Ft)>wt);for(const Ft of Ct)this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",Ft,dt),vt(Ft,InclusionReason.Opportunistic)}}});const ht=Date.now();this.fanoutLastpub.forEach((ft,dt)=>{ft+nt<ht&&(this.fanout.delete(dt),this.fanoutLastpub.delete(dt))}),this.fanout.forEach((ft,dt)=>{const pt=this.topics.get(dt);ft.forEach(vt=>{(!(pt?.has(vt)??!1)||st(vt)<this.opts.scoreThresholds.publishThreshold)&&ft.delete(vt)});const gt=this.topics.get(dt),mt=[],yt=new Set;if(ct.set(dt,yt),gt!=null){const vt=shuffle$1(Array.from(gt));for(const Et of vt){const xt=this.streamsOutbound.get(Et);if(xt!=null&&this.multicodecs.includes(xt.protocol)&&!ft.has(Et)&&!this.direct.has(Et)){const wt=st(Et);wt>=this.opts.scoreThresholds.publishThreshold&&mt.push(Et),wt>=this.opts.scoreThresholds.gossipThreshold&&yt.add(Et)}}}if(ft.size<s){const vt=s-ft.size;mt.slice(0,vt).forEach(Et=>{ft.add(Et),yt?.delete(Et)})}}),this.emitGossip(ct),await this.sendGraftPrune(ot,at,lt),this.flush(),this.mcache.shift(),this.dispatchEvent(new CustomEvent$2("gossipsub:heartbeat"))}getRandomGossipPeers(s,a,et=()=>!0){const tt=this.topics.get(s);if(tt==null)return new Set;let rt=[];return tt.forEach(nt=>{const it=this.streamsOutbound.get(nt);it!=null&&this.multicodecs.includes(it.protocol)&&et(nt)&&rt.push(nt)}),rt=shuffle$1(rt),a>0&&rt.length>a&&(rt=rt.slice(0,a)),new Set(rt)}onScrapeMetrics(s){s.mcacheSize.set(this.mcache.size),s.mcacheNotValidatedCount.set(this.mcache.notValidatedCount),s.cacheSize.set({cache:"direct"},this.direct.size),s.cacheSize.set({cache:"seenCache"},this.seenCache.size),s.cacheSize.set({cache:"fastMsgIdCache"},this.fastMsgIdCache?.size??0),s.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),s.cacheSize.set({cache:"mcache"},this.mcache.size),s.cacheSize.set({cache:"score"},this.score.size),s.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),s.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),s.cacheSize.set({cache:"topics"},this.topics.size),s.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),s.cacheSize.set({cache:"mesh"},this.mesh.size),s.cacheSize.set({cache:"fanout"},this.fanout.size),s.cacheSize.set({cache:"peers"},this.peers.size),s.cacheSize.set({cache:"streamsOutbound"},this.streamsOutbound.size),s.cacheSize.set({cache:"streamsInbound"},this.streamsInbound.size),s.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),s.cacheSize.set({cache:"gossip"},this.gossip.size),s.cacheSize.set({cache:"control"},this.control.size),s.cacheSize.set({cache:"peerhave"},this.peerhave.size),s.cacheSize.set({cache:"outbound"},this.outbound.size);let a=0;const et=Date.now();s.connectedPeersBackoffSec.reset();for(const it of this.backoff.values()){a+=it.size;for(const[st,ot]of it.entries())this.peers.has(st)&&s.connectedPeersBackoffSec.observe(Math.max(0,ot-et)/1e3)}s.cacheSize.set({cache:"backoff"},a);for(const[it,st]of this.topics)s.topicPeersCount.set({topicStr:it},st.size);for(const[it,st]of this.mesh)s.meshPeerCounts.set({topicStr:it},st.size);const tt=[],rt=new Map;s.behaviourPenalty.reset();for(const it of this.peers.keys()){const st=this.score.score(it);tt.push(st),rt.set(it,st),s.behaviourPenalty.observe(this.score.peerStats.get(it)?.behaviourPenalty??0)}s.registerScores(tt,this.opts.scoreThresholds),s.registerScorePerMesh(this.mesh,rt);const nt=computeAllPeersScoreWeights(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,s.topicStrToLabel);s.registerScoreWeights(nt)}tagMeshPeer=s=>{const{peerId:a,topic:et}=s.detail;this.components.peerStore.merge(peerIdFromString(a),{tags:{[et]:{value:100}}}).catch(tt=>{this.log.error("Error tagging peer %s with topic %s",a,et,tt)})};untagMeshPeer=s=>{const{peerId:a,topic:et}=s.detail;this.components.peerStore.merge(peerIdFromString(a),{tags:{[et]:void 0}}).catch(tt=>{this.log.error("Error untagging peer %s with topic %s",a,et,tt)})}}function gossipsub(o={}){return s=>new GossipSub(s,o)}function asUint8Array(o){return globalThis.Buffer!=null?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):o}function alloc$1(o=0){return globalThis.Buffer?.alloc!=null?asUint8Array(globalThis.Buffer.alloc(o)):new Uint8Array(o)}var Peer;(function(o){let s;o.codec=()=>(s==null&&(s=message((a,et,tt={})=>{if(tt.lengthDelimited!==!1&&et.fork(),a.publicKey!=null&&a.publicKey.byteLength>0&&(et.uint32(10),et.bytes(a.publicKey)),a.addrs!=null)for(const rt of a.addrs)et.uint32(18),et.bytes(rt);tt.lengthDelimited!==!1&&et.ldelim()},(a,et)=>{const tt={publicKey:alloc$1(0),addrs:[]},rt=et==null?a.len:a.pos+et;for(;a.pos<rt;){const nt=a.uint32();switch(nt>>>3){case 1:{tt.publicKey=a.bytes();break}case 2:{tt.addrs.push(a.bytes());break}default:{a.skipType(nt&7);break}}}return tt})),s),o.encode=a=>encodeMessage(a,o.codec()),o.decode=a=>decodeMessage(a,o.codec())})(Peer||(Peer={}));const TOPIC="_peer-discovery._p2p._pubsub";class PubSubPeerDiscovery extends TypedEventEmitter{[peerDiscoverySymbol]=!0;[Symbol.toStringTag]="@libp2p/pubsub-peer-discovery";interval;listenOnly;topics;intervalId;components;log;constructor(s,a={}){super();const{interval:et,topics:tt,listenOnly:rt}=a;this.components=s,this.interval=et??1e4,this.listenOnly=rt??!1,this.log=s.logger.forComponent("libp2p:discovery:pubsub"),Array.isArray(tt)&&tt.length>0?this.topics=tt:this.topics=[TOPIC],this._onMessage=this._onMessage.bind(this)}isStarted(){return this.intervalId!=null}start(){}afterStart(){if(this.intervalId!=null)return;const s=this.components.pubsub;if(s==null)throw new Error("PubSub not configured");for(const a of this.topics)s.subscribe(a),s.addEventListener("message",this._onMessage);this.listenOnly||(this._broadcast(),this.intervalId=setInterval(()=>{this._broadcast()},this.interval))}beforeStop(){const s=this.components.pubsub;if(s==null)throw new Error("PubSub not configured");for(const a of this.topics)s.unsubscribe(a),s.removeEventListener("message",this._onMessage)}stop(){this.intervalId!=null&&(clearInterval(this.intervalId),this.intervalId=void 0)}_broadcast(){const s=this.components.peerId;if(s.publicKey==null)throw new Error("PeerId was missing public key");const a={publicKey:s.publicKey,addrs:this.components.addressManager.getAddresses().map(rt=>rt.bytes)},et=Peer.encode(a),tt=this.components.pubsub;if(tt==null)throw new Error("PubSub not configured");for(const rt of this.topics){if(tt.getSubscribers(rt).length===0){this.log("skipping broadcasting our peer data on topic %s because there are no peers present",rt);continue}this.log("broadcasting our peer data on topic %s",rt),tt.publish(rt,et)}}_onMessage(s){if(!this.isStarted())return;const a=s.detail;if(!this.topics.includes(a.topic))return;const et=Peer.decode(a.data);peerIdFromKeys(et.publicKey).then(tt=>{tt.equals(this.components.peerId)||(this.log("discovered peer %p on %s",tt,a.topic),this.safeDispatchEvent("peer",{detail:{id:tt,multiaddrs:et.addrs.map(rt=>multiaddr(rt))}}))}).catch(tt=>{this.log.error(tt)})}}function pubsubPeerDiscovery(o={}){return s=>new PubSubPeerDiscovery(s,o)}function getConfig(o="node"){const s=o==="web",a=libp2pDefaults(),et=[...!s&&["/ip4/0.0.0.0/tcp/0","/ip4/0.0.0.0/tcp/0/ws","/webrtc"]||["/webrtc","/ws"]],tt=[...a.peerDiscovery,...s&&[pubsubPeerDiscovery({interval:1e4,topics:["watchit-pubsub-discovery"],listenOnly:!1})]||[]],rt=[...!s&&[tcp(),circuitRelayTransport({discoverRelays:3}),webSockets({websocket:{rejectUnauthorized:!1}})]||[webSockets(),circuitRelayTransport({discoverRelays:1}),webRTC()],webRTCDirect()];return Object.assign({},a,{transports:rt,addresses:{listen:et},peerDiscovery:tt,streamMuxers:[yamux()],services:{...a.services,pubsub:gossipsub({allowPublishToZeroTopicPeers:!0,emitSelf:!0,canRelayMessage:!0})}})}async function Helia(o){const s=getConfig(o),a=await createHelia({libp2p:s,start:!0});log$d.info(`Running helia with peer ${a.libp2p.peerId}`);const et=unixfs(a);return{node:a,fs:et}}const common={black:"#000",white:"#fff"},red={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},purple={50:"#f3e5f5",100:"#e1bee7",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",600:"#8e24aa",700:"#7b1fa2",800:"#6a1b9a",900:"#4a148c",A100:"#ea80fc",A200:"#e040fb",A400:"#d500f9",A700:"#aa00ff"},blue={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},lightBlue={50:"#e1f5fe",100:"#b3e5fc",200:"#81d4fa",300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",600:"#039be5",700:"#0288d1",800:"#0277bd",900:"#01579b",A100:"#80d8ff",A200:"#40c4ff",A400:"#00b0ff",A700:"#0091ea"},green={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},orange={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},grey={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"};function formatMuiErrorMessage$1(o){let s="https://mui.com/production-error/?code="+o;for(let a=1;a<arguments.length;a+=1)s+="&args[]="+encodeURIComponent(arguments[a]);return"Minified MUI error #"+o+"; visit "+s+" for the full message."}const formatMuiErrorMessage=Object.freeze(Object.defineProperty({__proto__:null,default:formatMuiErrorMessage$1},Symbol.toStringTag,{value:"Module"})),THEME_ID="$$material";function _extends$3(){return _extends$3=Object.assign?Object.assign.bind():function(o){for(var s=1;s<arguments.length;s++){var a=arguments[s];for(var et in a)({}).hasOwnProperty.call(a,et)&&(o[et]=a[et])}return o},_extends$3.apply(null,arguments)}function _objectWithoutPropertiesLoose$1(o,s){if(o==null)return{};var a={};for(var et in o)if({}.hasOwnProperty.call(o,et)){if(s.indexOf(et)>=0)continue;a[et]=o[et]}return a}function memoize$1(o){var s=Object.create(null);return function(a){return s[a]===void 0&&(s[a]=o(a)),s[a]}}var reactPropsRegex=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,isPropValid=memoize$1(function(o){return reactPropsRegex.test(o)||o.charCodeAt(0)===111&&o.charCodeAt(1)===110&&o.charCodeAt(2)<91});function sheetForTag(o){if(o.sheet)return o.sheet;for(var s=0;s<document.styleSheets.length;s++)if(document.styleSheets[s].ownerNode===o)return document.styleSheets[s]}function createStyleElement(o){var s=document.createElement("style");return s.setAttribute("data-emotion",o.key),o.nonce!==void 0&&s.setAttribute("nonce",o.nonce),s.appendChild(document.createTextNode("")),s.setAttribute("data-s",""),s}var StyleSheet=function(){function o(a){var et=this;this._insertTag=function(tt){var rt;et.tags.length===0?et.insertionPoint?rt=et.insertionPoint.nextSibling:et.prepend?rt=et.container.firstChild:rt=et.before:rt=et.tags[et.tags.length-1].nextSibling,et.container.insertBefore(tt,rt),et.tags.push(tt)},this.isSpeedy=a.speedy===void 0?!0:a.speedy,this.tags=[],this.ctr=0,this.nonce=a.nonce,this.key=a.key,this.container=a.container,this.prepend=a.prepend,this.insertionPoint=a.insertionPoint,this.before=null}var s=o.prototype;return s.hydrate=function(et){et.forEach(this._insertTag)},s.insert=function(et){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(createStyleElement(this));var tt=this.tags[this.tags.length-1];if(this.isSpeedy){var rt=sheetForTag(tt);try{rt.insertRule(et,rt.cssRules.length)}catch{}}else tt.appendChild(document.createTextNode(et));this.ctr++},s.flush=function(){this.tags.forEach(function(et){return et.parentNode&&et.parentNode.removeChild(et)}),this.tags=[],this.ctr=0},o}(),MS="-ms-",MOZ="-moz-",WEBKIT="-webkit-",COMMENT="comm",RULESET="rule",DECLARATION="decl",IMPORT="@import",KEYFRAMES="@keyframes",LAYER="@layer",abs=Math.abs,from=String.fromCharCode,assign=Object.assign;function hash$1(o,s){return charat(o,0)^45?(((s<<2^charat(o,0))<<2^charat(o,1))<<2^charat(o,2))<<2^charat(o,3):0}function trim(o){return o.trim()}function match(o,s){return(o=s.exec(o))?o[0]:o}function replace(o,s,a){return o.replace(s,a)}function indexof(o,s){return o.indexOf(s)}function charat(o,s){return o.charCodeAt(s)|0}function substr(o,s,a){return o.slice(s,a)}function strlen(o){return o.length}function sizeof(o){return o.length}function append(o,s){return s.push(o),o}function combine(o,s){return o.map(s).join("")}var line=1,column=1,length=0,position=0,character=0,characters$1="";function node(o,s,a,et,tt,rt,nt){return{value:o,root:s,parent:a,type:et,props:tt,children:rt,line,column,length:nt,return:""}}function copy(o,s){return assign(node("",null,null,"",null,null,0),o,{length:-o.length},s)}function char(){return character}function prev(){return character=position>0?charat(characters$1,--position):0,column--,character===10&&(column=1,line--),character}function next(){return character=position<length?charat(characters$1,position++):0,column++,character===10&&(column=1,line++),character}function peek(){return charat(characters$1,position)}function caret(){return position}function slice(o,s){return substr(characters$1,o,s)}function token(o){switch(o){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function alloc(o){return line=column=1,length=strlen(characters$1=o),position=0,[]}function dealloc(o){return characters$1="",o}function delimit(o){return trim(slice(position-1,delimiter(o===91?o+2:o===40?o+1:o)))}function whitespace(o){for(;(character=peek())&&character<33;)next();return token(o)>2||token(character)>3?"":" "}function escaping(o,s){for(;--s&&next()&&!(character<48||character>102||character>57&&character<65||character>70&&character<97););return slice(o,caret()+(s<6&&peek()==32&&next()==32))}function delimiter(o){for(;next();)switch(character){case o:return position;case 34:case 39:o!==34&&o!==39&&delimiter(character);break;case 40:o===41&&delimiter(o);break;case 92:next();break}return position}function commenter(o,s){for(;next()&&o+character!==57;)if(o+character===84&&peek()===47)break;return"/*"+slice(s,position-1)+"*"+from(o===47?o:next())}function identifier(o){for(;!token(peek());)next();return slice(o,position)}function compile(o){return dealloc(parse("",null,null,null,[""],o=alloc(o),0,[0],o))}function parse(o,s,a,et,tt,rt,nt,it,st){for(var ot=0,at=0,lt=nt,ct=0,ht=0,ft=0,dt=1,pt=1,gt=1,mt=0,yt="",vt=tt,Et=rt,xt=et,wt=yt;pt;)switch(ft=mt,mt=next()){case 40:if(ft!=108&&charat(wt,lt-1)==58){indexof(wt+=replace(delimit(mt),"&","&\f"),"&\f")!=-1&&(gt=-1);break}case 34:case 39:case 91:wt+=delimit(mt);break;case 9:case 10:case 13:case 32:wt+=whitespace(ft);break;case 92:wt+=escaping(caret()-1,7);continue;case 47:switch(peek()){case 42:case 47:append(comment(commenter(next(),caret()),s,a),st);break;default:wt+="/"}break;case 123*dt:it[ot++]=strlen(wt)*gt;case 125*dt:case 59:case 0:switch(mt){case 0:case 125:pt=0;case 59+at:gt==-1&&(wt=replace(wt,/\f/g,"")),ht>0&&strlen(wt)-lt&&append(ht>32?declaration(wt+";",et,a,lt-1):declaration(replace(wt," ","")+";",et,a,lt-2),st);break;case 59:wt+=";";default:if(append(xt=ruleset(wt,s,a,ot,at,tt,it,yt,vt=[],Et=[],lt),rt),mt===123)if(at===0)parse(wt,s,xt,xt,vt,rt,lt,it,Et);else switch(ct===99&&charat(wt,3)===110?100:ct){case 100:case 108:case 109:case 115:parse(o,xt,xt,et&&append(ruleset(o,xt,xt,0,0,tt,it,yt,tt,vt=[],lt),Et),tt,Et,lt,it,et?vt:Et);break;default:parse(wt,xt,xt,xt,[""],Et,0,it,Et)}}ot=at=ht=0,dt=gt=1,yt=wt="",lt=nt;break;case 58:lt=1+strlen(wt),ht=ft;default:if(dt<1){if(mt==123)--dt;else if(mt==125&&dt++==0&&prev()==125)continue}switch(wt+=from(mt),mt*dt){case 38:gt=at>0?1:(wt+="\f",-1);break;case 44:it[ot++]=(strlen(wt)-1)*gt,gt=1;break;case 64:peek()===45&&(wt+=delimit(next())),ct=peek(),at=lt=strlen(yt=wt+=identifier(caret())),mt++;break;case 45:ft===45&&strlen(wt)==2&&(dt=0)}}return rt}function ruleset(o,s,a,et,tt,rt,nt,it,st,ot,at){for(var lt=tt-1,ct=tt===0?rt:[""],ht=sizeof(ct),ft=0,dt=0,pt=0;ft<et;++ft)for(var gt=0,mt=substr(o,lt+1,lt=abs(dt=nt[ft])),yt=o;gt<ht;++gt)(yt=trim(dt>0?ct[gt]+" "+mt:replace(mt,/&\f/g,ct[gt])))&&(st[pt++]=yt);return node(o,s,a,tt===0?RULESET:it,st,ot,at)}function comment(o,s,a){return node(o,s,a,COMMENT,from(char()),substr(o,2,-2),0)}function declaration(o,s,a,et){return node(o,s,a,DECLARATION,substr(o,0,et),substr(o,et+1,-1),et)}function serialize(o,s){for(var a="",et=sizeof(o),tt=0;tt<et;tt++)a+=s(o[tt],tt,o,s)||"";return a}function stringify(o,s,a,et){switch(o.type){case LAYER:if(o.children.length)break;case IMPORT:case DECLARATION:return o.return=o.return||o.value;case COMMENT:return"";case KEYFRAMES:return o.return=o.value+"{"+serialize(o.children,et)+"}";case RULESET:o.value=o.props.join(",")}return strlen(a=serialize(o.children,et))?o.return=o.value+"{"+a+"}":""}function middleware(o){var s=sizeof(o);return function(a,et,tt,rt){for(var nt="",it=0;it<s;it++)nt+=o[it](a,et,tt,rt)||"";return nt}}function rulesheet(o){return function(s){s.root||(s=s.return)&&o(s)}}var identifierWithPointTracking=function(s,a,et){for(var tt=0,rt=0;tt=rt,rt=peek(),tt===38&&rt===12&&(a[et]=1),!token(rt);)next();return slice(s,position)},toRules=function(s,a){var et=-1,tt=44;do switch(token(tt)){case 0:tt===38&&peek()===12&&(a[et]=1),s[et]+=identifierWithPointTracking(position-1,a,et);break;case 2:s[et]+=delimit(tt);break;case 4:if(tt===44){s[++et]=peek()===58?"&\f":"",a[et]=s[et].length;break}default:s[et]+=from(tt)}while(tt=next());return s},getRules=function(s,a){return dealloc(toRules(alloc(s),a))},fixedElements=new WeakMap,compat=function(s){if(!(s.type!=="rule"||!s.parent||s.length<1)){for(var a=s.value,et=s.parent,tt=s.column===et.column&&s.line===et.line;et.type!=="rule";)if(et=et.parent,!et)return;if(!(s.props.length===1&&a.charCodeAt(0)!==58&&!fixedElements.get(et))&&!tt){fixedElements.set(s,!0);for(var rt=[],nt=getRules(a,rt),it=et.props,st=0,ot=0;st<nt.length;st++)for(var at=0;at<it.length;at++,ot++)s.props[ot]=rt[st]?nt[st].replace(/&\f/g,it[at]):it[at]+" "+nt[st]}}},removeLabel=function(s){if(s.type==="decl"){var a=s.value;a.charCodeAt(0)===108&&a.charCodeAt(2)===98&&(s.return="",s.value="")}};function prefix$1(o,s){switch(hash$1(o,s)){case 5103:return WEBKIT+"print-"+o+o;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return WEBKIT+o+o;case 5349:case 4246:case 4810:case 6968:case 2756:return WEBKIT+o+MOZ+o+MS+o+o;case 6828:case 4268:return WEBKIT+o+MS+o+o;case 6165:return WEBKIT+o+MS+"flex-"+o+o;case 5187:return WEBKIT+o+replace(o,/(\w+).+(:[^]+)/,WEBKIT+"box-$1$2"+MS+"flex-$1$2")+o;case 5443:return WEBKIT+o+MS+"flex-item-"+replace(o,/flex-|-self/,"")+o;case 4675:return WEBKIT+o+MS+"flex-line-pack"+replace(o,/align-content|flex-|-self/,"")+o;case 5548:return WEBKIT+o+MS+replace(o,"shrink","negative")+o;case 5292:return WEBKIT+o+MS+replace(o,"basis","preferred-size")+o;case 6060:return WEBKIT+"box-"+replace(o,"-grow","")+WEBKIT+o+MS+replace(o,"grow","positive")+o;case 4554:return WEBKIT+replace(o,/([^-])(transform)/g,"$1"+WEBKIT+"$2")+o;case 6187:return replace(replace(replace(o,/(zoom-|grab)/,WEBKIT+"$1"),/(image-set)/,WEBKIT+"$1"),o,"")+o;case 5495:case 3959:return replace(o,/(image-set\([^]*)/,WEBKIT+"$1$`$1");case 4968:return replace(replace(o,/(.+:)(flex-)?(.*)/,WEBKIT+"box-pack:$3"+MS+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+WEBKIT+o+o;case 4095:case 3583:case 4068:case 2532:return replace(o,/(.+)-inline(.+)/,WEBKIT+"$1$2")+o;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(strlen(o)-1-s>6)switch(charat(o,s+1)){case 109:if(charat(o,s+4)!==45)break;case 102:return replace(o,/(.+:)(.+)-([^]+)/,"$1"+WEBKIT+"$2-$3$1"+MOZ+(charat(o,s+3)==108?"$3":"$2-$3"))+o;case 115:return~indexof(o,"stretch")?prefix$1(replace(o,"stretch","fill-available"),s)+o:o}break;case 4949:if(charat(o,s+1)!==115)break;case 6444:switch(charat(o,strlen(o)-3-(~indexof(o,"!important")&&10))){case 107:return replace(o,":",":"+WEBKIT)+o;case 101:return replace(o,/(.+:)([^;!]+)(;|!.+)?/,"$1"+WEBKIT+(charat(o,14)===45?"inline-":"")+"box$3$1"+WEBKIT+"$2$3$1"+MS+"$2box$3")+o}break;case 5936:switch(charat(o,s+11)){case 114:return WEBKIT+o+MS+replace(o,/[svh]\w+-[tblr]{2}/,"tb")+o;case 108:return WEBKIT+o+MS+replace(o,/[svh]\w+-[tblr]{2}/,"tb-rl")+o;case 45:return WEBKIT+o+MS+replace(o,/[svh]\w+-[tblr]{2}/,"lr")+o}return WEBKIT+o+MS+o+o}return o}var prefixer=function(s,a,et,tt){if(s.length>-1&&!s.return)switch(s.type){case DECLARATION:s.return=prefix$1(s.value,s.length);break;case KEYFRAMES:return serialize([copy(s,{value:replace(s.value,"@","@"+WEBKIT)})],tt);case RULESET:if(s.length)return combine(s.props,function(rt){switch(match(rt,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return serialize([copy(s,{props:[replace(rt,/:(read-\w+)/,":"+MOZ+"$1")]})],tt);case"::placeholder":return serialize([copy(s,{props:[replace(rt,/:(plac\w+)/,":"+WEBKIT+"input-$1")]}),copy(s,{props:[replace(rt,/:(plac\w+)/,":"+MOZ+"$1")]}),copy(s,{props:[replace(rt,/:(plac\w+)/,MS+"input-$1")]})],tt)}return""})}},defaultStylisPlugins=[prefixer],createCache=function(s){var a=s.key;if(a==="css"){var et=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(et,function(dt){var pt=dt.getAttribute("data-emotion");pt.indexOf(" ")!==-1&&(document.head.appendChild(dt),dt.setAttribute("data-s",""))})}var tt=s.stylisPlugins||defaultStylisPlugins,rt={},nt,it=[];nt=s.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+a+' "]'),function(dt){for(var pt=dt.getAttribute("data-emotion").split(" "),gt=1;gt<pt.length;gt++)rt[pt[gt]]=!0;it.push(dt)});var st,ot=[compat,removeLabel];{var at,lt=[stringify,rulesheet(function(dt){at.insert(dt)})],ct=middleware(ot.concat(tt,lt)),ht=function(pt){return serialize(compile(pt),ct)};st=function(pt,gt,mt,yt){at=mt,ht(pt?pt+"{"+gt.styles+"}":gt.styles),yt&&(ft.inserted[gt.name]=!0)}}var ft={key:a,sheet:new StyleSheet({key:a,container:nt,nonce:s.nonce,speedy:s.speedy,prepend:s.prepend,insertionPoint:s.insertionPoint}),nonce:s.nonce,inserted:rt,registered:{},insert:st};return ft.sheet.hydrate(it),ft},reactIs$2={exports:{}},reactIs_production_min$1={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var b$2=typeof Symbol=="function"&&Symbol.for,c$1=b$2?Symbol.for("react.element"):60103,d$1=b$2?Symbol.for("react.portal"):60106,e$1=b$2?Symbol.for("react.fragment"):60107,f$1=b$2?Symbol.for("react.strict_mode"):60108,g$2=b$2?Symbol.for("react.profiler"):60114,h$2=b$2?Symbol.for("react.provider"):60109,k$2=b$2?Symbol.for("react.context"):60110,l$1=b$2?Symbol.for("react.async_mode"):60111,m$2=b$2?Symbol.for("react.concurrent_mode"):60111,n$1=b$2?Symbol.for("react.forward_ref"):60112,p$1=b$2?Symbol.for("react.suspense"):60113,q$2=b$2?Symbol.for("react.suspense_list"):60120,r$1=b$2?Symbol.for("react.memo"):60115,t$1=b$2?Symbol.for("react.lazy"):60116,v$3=b$2?Symbol.for("react.block"):60121,w$2=b$2?Symbol.for("react.fundamental"):60117,x$1=b$2?Symbol.for("react.responder"):60118,y$1=b$2?Symbol.for("react.scope"):60119;function z$1(o){if(typeof o=="object"&&o!==null){var s=o.$$typeof;switch(s){case c$1:switch(o=o.type,o){case l$1:case m$2:case e$1:case g$2:case f$1:case p$1:return o;default:switch(o=o&&o.$$typeof,o){case k$2:case n$1:case t$1:case r$1:case h$2:return o;default:return s}}case d$1:return s}}}function A(o){return z$1(o)===m$2}reactIs_production_min$1.AsyncMode=l$1;reactIs_production_min$1.ConcurrentMode=m$2;reactIs_production_min$1.ContextConsumer=k$2;reactIs_production_min$1.ContextProvider=h$2;reactIs_production_min$1.Element=c$1;reactIs_production_min$1.ForwardRef=n$1;reactIs_production_min$1.Fragment=e$1;reactIs_production_min$1.Lazy=t$1;reactIs_production_min$1.Memo=r$1;reactIs_production_min$1.Portal=d$1;reactIs_production_min$1.Profiler=g$2;reactIs_production_min$1.StrictMode=f$1;reactIs_production_min$1.Suspense=p$1;reactIs_production_min$1.isAsyncMode=function(o){return A(o)||z$1(o)===l$1};reactIs_production_min$1.isConcurrentMode=A;reactIs_production_min$1.isContextConsumer=function(o){return z$1(o)===k$2};reactIs_production_min$1.isContextProvider=function(o){return z$1(o)===h$2};reactIs_production_min$1.isElement=function(o){return typeof o=="object"&&o!==null&&o.$$typeof===c$1};reactIs_production_min$1.isForwardRef=function(o){return z$1(o)===n$1};reactIs_production_min$1.isFragment=function(o){return z$1(o)===e$1};reactIs_production_min$1.isLazy=function(o){return z$1(o)===t$1};reactIs_production_min$1.isMemo=function(o){return z$1(o)===r$1};reactIs_production_min$1.isPortal=function(o){return z$1(o)===d$1};reactIs_production_min$1.isProfiler=function(o){return z$1(o)===g$2};reactIs_production_min$1.isStrictMode=function(o){return z$1(o)===f$1};reactIs_production_min$1.isSuspense=function(o){return z$1(o)===p$1};reactIs_production_min$1.isValidElementType=function(o){return typeof o=="string"||typeof o=="function"||o===e$1||o===m$2||o===g$2||o===f$1||o===p$1||o===q$2||typeof o=="object"&&o!==null&&(o.$$typeof===t$1||o.$$typeof===r$1||o.$$typeof===h$2||o.$$typeof===k$2||o.$$typeof===n$1||o.$$typeof===w$2||o.$$typeof===x$1||o.$$typeof===y$1||o.$$typeof===v$3)};reactIs_production_min$1.typeOf=z$1;reactIs$2.exports=reactIs_production_min$1;var reactIsExports$1=reactIs$2.exports,reactIs$1=reactIsExports$1,REACT_STATICS={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},KNOWN_STATICS={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},FORWARD_REF_STATICS={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},MEMO_STATICS={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},TYPE_STATICS={};TYPE_STATICS[reactIs$1.ForwardRef]=FORWARD_REF_STATICS;TYPE_STATICS[reactIs$1.Memo]=MEMO_STATICS;function getStatics(o){return reactIs$1.isMemo(o)?MEMO_STATICS:TYPE_STATICS[o.$$typeof]||REACT_STATICS}var defineProperty=Object.defineProperty,getOwnPropertyNames=Object.getOwnPropertyNames,getOwnPropertySymbols=Object.getOwnPropertySymbols,getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,getPrototypeOf=Object.getPrototypeOf,objectPrototype=Object.prototype;function hoistNonReactStatics(o,s,a){if(typeof s!="string"){if(objectPrototype){var et=getPrototypeOf(s);et&&et!==objectPrototype&&hoistNonReactStatics(o,et,a)}var tt=getOwnPropertyNames(s);getOwnPropertySymbols&&(tt=tt.concat(getOwnPropertySymbols(s)));for(var rt=getStatics(o),nt=getStatics(s),it=0;it<tt.length;++it){var st=tt[it];if(!KNOWN_STATICS[st]&&!(a&&a[st])&&!(nt&&nt[st])&&!(rt&&rt[st])){var ot=getOwnPropertyDescriptor(s,st);try{defineProperty(o,st,ot)}catch{}}}}return o}var hoistNonReactStatics_cjs=hoistNonReactStatics;const m$1=getDefaultExportFromCjs$2(hoistNonReactStatics_cjs);var isBrowser=!0;function getRegisteredStyles(o,s,a){var et="";return a.split(" ").forEach(function(tt){o[tt]!==void 0?s.push(o[tt]+";"):et+=tt+" "}),et}var registerStyles=function(s,a,et){var tt=s.key+"-"+a.name;(et===!1||isBrowser===!1)&&s.registered[tt]===void 0&&(s.registered[tt]=a.styles)},insertStyles=function(s,a,et){registerStyles(s,a,et);var tt=s.key+"-"+a.name;if(s.inserted[a.name]===void 0){var rt=a;do s.insert(a===rt?"."+tt:"",rt,s.sheet,!0),rt=rt.next;while(rt!==void 0)}};function murmur2(o){for(var s=0,a,et=0,tt=o.length;tt>=4;++et,tt-=4)a=o.charCodeAt(et)&255|(o.charCodeAt(++et)&255)<<8|(o.charCodeAt(++et)&255)<<16|(o.charCodeAt(++et)&255)<<24,a=(a&65535)*1540483477+((a>>>16)*59797<<16),a^=a>>>24,s=(a&65535)*1540483477+((a>>>16)*59797<<16)^(s&65535)*1540483477+((s>>>16)*59797<<16);switch(tt){case 3:s^=(o.charCodeAt(et+2)&255)<<16;case 2:s^=(o.charCodeAt(et+1)&255)<<8;case 1:s^=o.charCodeAt(et)&255,s=(s&65535)*1540483477+((s>>>16)*59797<<16)}return s^=s>>>13,s=(s&65535)*1540483477+((s>>>16)*59797<<16),((s^s>>>15)>>>0).toString(36)}var unitlessKeys$1={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},hyphenateRegex=/[A-Z]|^ms/g,animationRegex=/_EMO_([^_]+?)_([^]*?)_EMO_/g,isCustomProperty=function(s){return s.charCodeAt(1)===45},isProcessableValue=function(s){return s!=null&&typeof s!="boolean"},processStyleName=memoize$1(function(o){return isCustomProperty(o)?o:o.replace(hyphenateRegex,"-$&").toLowerCase()}),processStyleValue=function(s,a){switch(s){case"animation":case"animationName":if(typeof a=="string")return a.replace(animationRegex,function(et,tt,rt){return cursor={name:tt,styles:rt,next:cursor},tt})}return unitlessKeys$1[s]!==1&&!isCustomProperty(s)&&typeof a=="number"&&a!==0?a+"px":a},noComponentSelectorMessage="Component selectors can only be used in conjunction with @emotion/babel-plugin, the swc Emotion plugin, or another Emotion-aware compiler transform.";function handleInterpolation(o,s,a){if(a==null)return"";if(a.__emotion_styles!==void 0)return a;switch(typeof a){case"boolean":return"";case"object":{if(a.anim===1)return cursor={name:a.name,styles:a.styles,next:cursor},a.name;if(a.styles!==void 0){var et=a.next;if(et!==void 0)for(;et!==void 0;)cursor={name:et.name,styles:et.styles,next:cursor},et=et.next;var tt=a.styles+";";return tt}return createStringFromObject(o,s,a)}case"function":{if(o!==void 0){var rt=cursor,nt=a(o);return cursor=rt,handleInterpolation(o,s,nt)}break}}if(s==null)return a;var it=s[a];return it!==void 0?it:a}function createStringFromObject(o,s,a){var et="";if(Array.isArray(a))for(var tt=0;tt<a.length;tt++)et+=handleInterpolation(o,s,a[tt])+";";else for(var rt in a){var nt=a[rt];if(typeof nt!="object")s!=null&&s[nt]!==void 0?et+=rt+"{"+s[nt]+"}":isProcessableValue(nt)&&(et+=processStyleName(rt)+":"+processStyleValue(rt,nt)+";");else if(Array.isArray(nt)&&typeof nt[0]=="string"&&(s==null||s[nt[0]]===void 0))for(var it=0;it<nt.length;it++)isProcessableValue(nt[it])&&(et+=processStyleName(rt)+":"+processStyleValue(rt,nt[it])+";");else{var st=handleInterpolation(o,s,nt);switch(rt){case"animation":case"animationName":{et+=processStyleName(rt)+":"+st+";";break}default:et+=rt+"{"+st+"}"}}}return et}var labelPattern=/label:\s*([^\s;\n{]+)\s*(;|$)/g,cursor,serializeStyles=function(s,a,et){if(s.length===1&&typeof s[0]=="object"&&s[0]!==null&&s[0].styles!==void 0)return s[0];var tt=!0,rt="";cursor=void 0;var nt=s[0];nt==null||nt.raw===void 0?(tt=!1,rt+=handleInterpolation(et,a,nt)):rt+=nt[0];for(var it=1;it<s.length;it++)rt+=handleInterpolation(et,a,s[it]),tt&&(rt+=nt[it]);labelPattern.lastIndex=0;for(var st="",ot;(ot=labelPattern.exec(rt))!==null;)st+="-"+ot[1];var at=murmur2(rt)+st;return{name:at,styles:rt,next:cursor}},syncFallback=function(s){return s()},useInsertionEffect=React$1.useInsertionEffect?React$1.useInsertionEffect:!1,useInsertionEffectAlwaysWithSyncFallback=useInsertionEffect||syncFallback,useInsertionEffectWithLayoutFallback=useInsertionEffect||reactExports.useLayoutEffect,EmotionCacheContext=reactExports.createContext(typeof HTMLElement<"u"?createCache({key:"css"}):null),CacheProvider=EmotionCacheContext.Provider,withEmotionCache=function(s){return reactExports.forwardRef(function(a,et){var tt=reactExports.useContext(EmotionCacheContext);return s(a,tt,et)})},ThemeContext=reactExports.createContext({}),_extends$2={exports:{}},hasRequired_extends;function require_extends(){return hasRequired_extends||(hasRequired_extends=1,function(o){function s(){return o.exports=s=Object.assign?Object.assign.bind():function(a){for(var et=1;et<arguments.length;et++){var tt=arguments[et];for(var rt in tt)({}).hasOwnProperty.call(tt,rt)&&(a[rt]=tt[rt])}return a},o.exports.__esModule=!0,o.exports.default=o.exports,s.apply(null,arguments)}o.exports=s,o.exports.__esModule=!0,o.exports.default=o.exports}(_extends$2)),_extends$2.exports}require_extends();var Global=withEmotionCache(function(o,s){var a=o.styles,et=serializeStyles([a],void 0,reactExports.useContext(ThemeContext)),tt=reactExports.useRef();return useInsertionEffectWithLayoutFallback(function(){var rt=s.key+"-global",nt=new s.sheet.constructor({key:rt,nonce:s.sheet.nonce,container:s.sheet.container,speedy:s.sheet.isSpeedy}),it=!1,st=document.querySelector('style[data-emotion="'+rt+" "+et.name+'"]');return s.sheet.tags.length&&(nt.before=s.sheet.tags[0]),st!==null&&(it=!0,st.setAttribute("data-emotion",rt),nt.hydrate([st])),tt.current=[nt,it],function(){nt.flush()}},[s]),useInsertionEffectWithLayoutFallback(function(){var rt=tt.current,nt=rt[0],it=rt[1];if(it){rt[1]=!1;return}if(et.next!==void 0&&insertStyles(s,et.next,!0),nt.tags.length){var st=nt.tags[nt.tags.length-1].nextElementSibling;nt.before=st,nt.flush()}s.insert("",et,nt,!1)},[s,et.name]),null});function css(){for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return serializeStyles(s)}var keyframes=function(){var s=css.apply(void 0,arguments),a="animation-"+s.name;return{name:a,styles:"@keyframes "+a+"{"+s.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}},testOmitPropsOnStringTag=isPropValid,testOmitPropsOnComponent=function(s){return s!=="theme"},getDefaultShouldForwardProp=function(s){return typeof s=="string"&&s.charCodeAt(0)>96?testOmitPropsOnStringTag:testOmitPropsOnComponent},composeShouldForwardProps=function(s,a,et){var tt;if(a){var rt=a.shouldForwardProp;tt=s.__emotion_forwardProp&&rt?function(nt){return s.__emotion_forwardProp(nt)&&rt(nt)}:rt}return typeof tt!="function"&&et&&(tt=s.__emotion_forwardProp),tt},Insertion=function(s){var a=s.cache,et=s.serialized,tt=s.isStringTag;return registerStyles(a,et,tt),useInsertionEffectAlwaysWithSyncFallback(function(){return insertStyles(a,et,tt)}),null},createStyled$2=function o(s,a){var et=s.__emotion_real===s,tt=et&&s.__emotion_base||s,rt,nt;a!==void 0&&(rt=a.label,nt=a.target);var it=composeShouldForwardProps(s,a,et),st=it||getDefaultShouldForwardProp(tt),ot=!st("as");return function(){var at=arguments,lt=et&&s.__emotion_styles!==void 0?s.__emotion_styles.slice(0):[];if(rt!==void 0&&lt.push("label:"+rt+";"),at[0]==null||at[0].raw===void 0)lt.push.apply(lt,at);else{lt.push(at[0][0]);for(var ct=at.length,ht=1;ht<ct;ht++)lt.push(at[ht],at[0][ht])}var ft=withEmotionCache(function(dt,pt,gt){var mt=ot&&dt.as||tt,yt="",vt=[],Et=dt;if(dt.theme==null){Et={};for(var xt in dt)Et[xt]=dt[xt];Et.theme=reactExports.useContext(ThemeContext)}typeof dt.className=="string"?yt=getRegisteredStyles(pt.registered,vt,dt.className):dt.className!=null&&(yt=dt.className+" ");var wt=serializeStyles(lt.concat(vt),pt.registered,Et);yt+=pt.key+"-"+wt.name,nt!==void 0&&(yt+=" "+nt);var Rt=ot&&it===void 0?getDefaultShouldForwardProp(mt):st,Ct={};for(var Ft in dt)ot&&Ft==="as"||Rt(Ft)&&(Ct[Ft]=dt[Ft]);return Ct.className=yt,Ct.ref=gt,reactExports.createElement(reactExports.Fragment,null,reactExports.createElement(Insertion,{cache:pt,serialized:wt,isStringTag:typeof mt=="string"}),reactExports.createElement(mt,Ct))});return ft.displayName=rt!==void 0?rt:"Styled("+(typeof tt=="string"?tt:tt.displayName||tt.name||"Component")+")",ft.defaultProps=s.defaultProps,ft.__emotion_real=ft,ft.__emotion_base=tt,ft.__emotion_styles=lt,ft.__emotion_forwardProp=it,Object.defineProperty(ft,"toString",{value:function(){return"."+nt}}),ft.withComponent=function(dt,pt){return o(dt,_extends$3({},a,pt,{shouldForwardProp:composeShouldForwardProps(ft,pt,!0)})).apply(void 0,lt)},ft}},tags=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],newStyled=createStyled$2.bind();tags.forEach(function(o){newStyled[o]=newStyled(o)});var propTypes={exports:{}},ReactPropTypesSecret$1="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",ReactPropTypesSecret_1=ReactPropTypesSecret$1,ReactPropTypesSecret=ReactPropTypesSecret_1;function emptyFunction(){}function emptyFunctionWithReset(){}emptyFunctionWithReset.resetWarningCache=emptyFunction;var factoryWithThrowingShims=function(){function o(et,tt,rt,nt,it,st){if(st!==ReactPropTypesSecret){var ot=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw ot.name="Invariant Violation",ot}}o.isRequired=o;function s(){return o}var a={array:o,bigint:o,bool:o,func:o,number:o,object:o,string:o,symbol:o,any:o,arrayOf:s,element:o,elementType:o,instanceOf:s,node:o,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:emptyFunctionWithReset,resetWarningCache:emptyFunction};return a.PropTypes=a,a};propTypes.exports=factoryWithThrowingShims();var propTypesExports=propTypes.exports;const PropTypes=getDefaultExportFromCjs$2(propTypesExports);let cache$1;typeof document=="object"&&(cache$1=createCache({key:"css",prepend:!0}));function StyledEngineProvider(o){const{injectFirst:s,children:a}=o;return s&&cache$1?jsxRuntimeExports.jsx(CacheProvider,{value:cache$1,children:a}):a}function isEmpty$5(o){return o==null||Object.keys(o).length===0}function GlobalStyles$2(o){const{styles:s,defaultTheme:a={}}=o,et=typeof s=="function"?tt=>s(isEmpty$5(tt)?a:tt):s;return jsxRuntimeExports.jsx(Global,{styles:et})}function styled$1(o,s){return newStyled(o,s)}const internal_processStyles=(o,s)=>{Array.isArray(o.__emotion_styles)&&(o.__emotion_styles=s(o.__emotion_styles))},styledEngine=Object.freeze(Object.defineProperty({__proto__:null,GlobalStyles:GlobalStyles$2,StyledEngineProvider,ThemeContext,css,default:styled$1,internal_processStyles,keyframes},Symbol.toStringTag,{value:"Module"}));function isPlainObject(o){if(typeof o!="object"||o===null)return!1;const s=Object.getPrototypeOf(o);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(Symbol.toStringTag in o)&&!(Symbol.iterator in o)}function deepClone(o){if(!isPlainObject(o))return o;const s={};return Object.keys(o).forEach(a=>{s[a]=deepClone(o[a])}),s}function deepmerge$1(o,s,a={clone:!0}){const et=a.clone?_extends$3({},o):o;return isPlainObject(o)&&isPlainObject(s)&&Object.keys(s).forEach(tt=>{isPlainObject(s[tt])&&Object.prototype.hasOwnProperty.call(o,tt)&&isPlainObject(o[tt])?et[tt]=deepmerge$1(o[tt],s[tt],a):a.clone?et[tt]=isPlainObject(s[tt])?deepClone(s[tt]):s[tt]:et[tt]=s[tt]}),et}const deepmerge=Object.freeze(Object.defineProperty({__proto__:null,default:deepmerge$1,isPlainObject},Symbol.toStringTag,{value:"Module"})),_excluded$G=["values","unit","step"],sortBreakpointsValues=o=>{const s=Object.keys(o).map(a=>({key:a,val:o[a]}))||[];return s.sort((a,et)=>a.val-et.val),s.reduce((a,et)=>_extends$3({},a,{[et.key]:et.val}),{})};function createBreakpoints(o){const{values:s={xs:0,sm:600,md:900,lg:1200,xl:1536},unit:a="px",step:et=5}=o,tt=_objectWithoutPropertiesLoose$1(o,_excluded$G),rt=sortBreakpointsValues(s),nt=Object.keys(rt);function it(ct){return`@media (min-width:${typeof s[ct]=="number"?s[ct]:ct}${a})`}function st(ct){return`@media (max-width:${(typeof s[ct]=="number"?s[ct]:ct)-et/100}${a})`}function ot(ct,ht){const ft=nt.indexOf(ht);return`@media (min-width:${typeof s[ct]=="number"?s[ct]:ct}${a}) and (max-width:${(ft!==-1&&typeof s[nt[ft]]=="number"?s[nt[ft]]:ht)-et/100}${a})`}function at(ct){return nt.indexOf(ct)+1<nt.length?ot(ct,nt[nt.indexOf(ct)+1]):it(ct)}function lt(ct){const ht=nt.indexOf(ct);return ht===0?it(nt[1]):ht===nt.length-1?st(nt[ht]):ot(ct,nt[nt.indexOf(ct)+1]).replace("@media","@media not all and")}return _extends$3({keys:nt,values:rt,up:it,down:st,between:ot,only:at,not:lt,unit:a},tt)}const shape={borderRadius:4};function merge(o,s){return s?deepmerge$1(o,s,{clone:!1}):o}const values$1={xs:0,sm:600,md:900,lg:1200,xl:1536},defaultBreakpoints={keys:["xs","sm","md","lg","xl"],up:o=>`@media (min-width:${values$1[o]}px)`};function handleBreakpoints(o,s,a){const et=o.theme||{};if(Array.isArray(s)){const rt=et.breakpoints||defaultBreakpoints;return s.reduce((nt,it,st)=>(nt[rt.up(rt.keys[st])]=a(s[st]),nt),{})}if(typeof s=="object"){const rt=et.breakpoints||defaultBreakpoints;return Object.keys(s).reduce((nt,it)=>{if(Object.keys(rt.values||values$1).indexOf(it)!==-1){const st=rt.up(it);nt[st]=a(s[it],it)}else{const st=it;nt[st]=s[st]}return nt},{})}return a(s)}function createEmptyBreakpointObject(o={}){var s;return((s=o.keys)==null?void 0:s.reduce((et,tt)=>{const rt=o.up(tt);return et[rt]={},et},{}))||{}}function removeUnusedBreakpoints(o,s){return o.reduce((a,et)=>{const tt=a[et];return(!tt||Object.keys(tt).length===0)&&delete a[et],a},s)}function computeBreakpointsBase(o,s){if(typeof o!="object")return{};const a={},et=Object.keys(s);return Array.isArray(o)?et.forEach((tt,rt)=>{rt<o.length&&(a[tt]=!0)}):et.forEach(tt=>{o[tt]!=null&&(a[tt]=!0)}),a}function resolveBreakpointValues({values:o,breakpoints:s,base:a}){const et=a||computeBreakpointsBase(o,s),tt=Object.keys(et);if(tt.length===0)return o;let rt;return tt.reduce((nt,it,st)=>(Array.isArray(o)?(nt[it]=o[st]!=null?o[st]:o[rt],rt=st):typeof o=="object"?(nt[it]=o[it]!=null?o[it]:o[rt],rt=it):nt[it]=o,nt),{})}function capitalize$1(o){if(typeof o!="string")throw new Error(formatMuiErrorMessage$1(7));return o.charAt(0).toUpperCase()+o.slice(1)}const capitalize=Object.freeze(Object.defineProperty({__proto__:null,default:capitalize$1},Symbol.toStringTag,{value:"Module"}));function getPath(o,s,a=!0){if(!s||typeof s!="string")return null;if(o&&o.vars&&a){const et=`vars.${s}`.split(".").reduce((tt,rt)=>tt&&tt[rt]?tt[rt]:null,o);if(et!=null)return et}return s.split(".").reduce((et,tt)=>et&&et[tt]!=null?et[tt]:null,o)}function getStyleValue$1(o,s,a,et=a){let tt;return typeof o=="function"?tt=o(a):Array.isArray(o)?tt=o[a]||et:tt=getPath(o,a)||et,s&&(tt=s(tt,et,o)),tt}function style$2(o){const{prop:s,cssProperty:a=o.prop,themeKey:et,transform:tt}=o,rt=nt=>{if(nt[s]==null)return null;const it=nt[s],st=nt.theme,ot=getPath(st,et)||{};return handleBreakpoints(nt,it,lt=>{let ct=getStyleValue$1(ot,tt,lt);return lt===ct&&typeof lt=="string"&&(ct=getStyleValue$1(ot,tt,`${s}${lt==="default"?"":capitalize$1(lt)}`,lt)),a===!1?ct:{[a]:ct}})};return rt.propTypes={},rt.filterProps=[s],rt}function memoize(o){const s={};return a=>(s[a]===void 0&&(s[a]=o(a)),s[a])}const properties={m:"margin",p:"padding"},directions={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},aliases={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},getCssProperties=memoize(o=>{if(o.length>2)if(aliases[o])o=aliases[o];else return[o];const[s,a]=o.split(""),et=properties[s],tt=directions[a]||"";return Array.isArray(tt)?tt.map(rt=>et+rt):[et+tt]}),marginKeys=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],paddingKeys=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"];[...marginKeys,...paddingKeys];function createUnaryUnit(o,s,a,et){var tt;const rt=(tt=getPath(o,s,!1))!=null?tt:a;return typeof rt=="number"?nt=>typeof nt=="string"?nt:rt*nt:Array.isArray(rt)?nt=>typeof nt=="string"?nt:rt[nt]:typeof rt=="function"?rt:()=>{}}function createUnarySpacing(o){return createUnaryUnit(o,"spacing",8)}function getValue(o,s){if(typeof s=="string"||s==null)return s;const a=Math.abs(s),et=o(a);return s>=0?et:typeof et=="number"?-et:`-${et}`}function getStyleFromPropValue(o,s){return a=>o.reduce((et,tt)=>(et[tt]=getValue(s,a),et),{})}function resolveCssProperty(o,s,a,et){if(s.indexOf(a)===-1)return null;const tt=getCssProperties(a),rt=getStyleFromPropValue(tt,et),nt=o[a];return handleBreakpoints(o,nt,rt)}function style$1(o,s){const a=createUnarySpacing(o.theme);return Object.keys(o).map(et=>resolveCssProperty(o,s,et,a)).reduce(merge,{})}function margin(o){return style$1(o,marginKeys)}margin.propTypes={};margin.filterProps=marginKeys;function padding(o){return style$1(o,paddingKeys)}padding.propTypes={};padding.filterProps=paddingKeys;function createSpacing(o=8){if(o.mui)return o;const s=createUnarySpacing({spacing:o}),a=(...et)=>(et.length===0?[1]:et).map(rt=>{const nt=s(rt);return typeof nt=="number"?`${nt}px`:nt}).join(" ");return a.mui=!0,a}function compose(...o){const s=o.reduce((et,tt)=>(tt.filterProps.forEach(rt=>{et[rt]=tt}),et),{}),a=et=>Object.keys(et).reduce((tt,rt)=>s[rt]?merge(tt,s[rt](et)):tt,{});return a.propTypes={},a.filterProps=o.reduce((et,tt)=>et.concat(tt.filterProps),[]),a}function borderTransform(o){return typeof o!="number"?o:`${o}px solid`}function createBorderStyle(o,s){return style$2({prop:o,themeKey:"borders",transform:s})}const border=createBorderStyle("border",borderTransform),borderTop=createBorderStyle("borderTop",borderTransform),borderRight=createBorderStyle("borderRight",borderTransform),borderBottom=createBorderStyle("borderBottom",borderTransform),borderLeft=createBorderStyle("borderLeft",borderTransform),borderColor=createBorderStyle("borderColor"),borderTopColor=createBorderStyle("borderTopColor"),borderRightColor=createBorderStyle("borderRightColor"),borderBottomColor=createBorderStyle("borderBottomColor"),borderLeftColor=createBorderStyle("borderLeftColor"),outline=createBorderStyle("outline",borderTransform),outlineColor=createBorderStyle("outlineColor"),borderRadius=o=>{if(o.borderRadius!==void 0&&o.borderRadius!==null){const s=createUnaryUnit(o.theme,"shape.borderRadius",4),a=et=>({borderRadius:getValue(s,et)});return handleBreakpoints(o,o.borderRadius,a)}return null};borderRadius.propTypes={};borderRadius.filterProps=["borderRadius"];compose(border,borderTop,borderRight,borderBottom,borderLeft,borderColor,borderTopColor,borderRightColor,borderBottomColor,borderLeftColor,borderRadius,outline,outlineColor);const gap=o=>{if(o.gap!==void 0&&o.gap!==null){const s=createUnaryUnit(o.theme,"spacing",8),a=et=>({gap:getValue(s,et)});return handleBreakpoints(o,o.gap,a)}return null};gap.propTypes={};gap.filterProps=["gap"];const columnGap=o=>{if(o.columnGap!==void 0&&o.columnGap!==null){const s=createUnaryUnit(o.theme,"spacing",8),a=et=>({columnGap:getValue(s,et)});return handleBreakpoints(o,o.columnGap,a)}return null};columnGap.propTypes={};columnGap.filterProps=["columnGap"];const rowGap=o=>{if(o.rowGap!==void 0&&o.rowGap!==null){const s=createUnaryUnit(o.theme,"spacing",8),a=et=>({rowGap:getValue(s,et)});return handleBreakpoints(o,o.rowGap,a)}return null};rowGap.propTypes={};rowGap.filterProps=["rowGap"];const gridColumn=style$2({prop:"gridColumn"}),gridRow=style$2({prop:"gridRow"}),gridAutoFlow=style$2({prop:"gridAutoFlow"}),gridAutoColumns=style$2({prop:"gridAutoColumns"}),gridAutoRows=style$2({prop:"gridAutoRows"}),gridTemplateColumns=style$2({prop:"gridTemplateColumns"}),gridTemplateRows=style$2({prop:"gridTemplateRows"}),gridTemplateAreas=style$2({prop:"gridTemplateAreas"}),gridArea=style$2({prop:"gridArea"});compose(gap,columnGap,rowGap,gridColumn,gridRow,gridAutoFlow,gridAutoColumns,gridAutoRows,gridTemplateColumns,gridTemplateRows,gridTemplateAreas,gridArea);function paletteTransform(o,s){return s==="grey"?s:o}const color=style$2({prop:"color",themeKey:"palette",transform:paletteTransform}),bgcolor=style$2({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette",transform:paletteTransform}),backgroundColor=style$2({prop:"backgroundColor",themeKey:"palette",transform:paletteTransform});compose(color,bgcolor,backgroundColor);function sizingTransform(o){return o<=1&&o!==0?`${o*100}%`:o}const width=style$2({prop:"width",transform:sizingTransform}),maxWidth=o=>{if(o.maxWidth!==void 0&&o.maxWidth!==null){const s=a=>{var et,tt;const rt=((et=o.theme)==null||(et=et.breakpoints)==null||(et=et.values)==null?void 0:et[a])||values$1[a];return rt?((tt=o.theme)==null||(tt=tt.breakpoints)==null?void 0:tt.unit)!=="px"?{maxWidth:`${rt}${o.theme.breakpoints.unit}`}:{maxWidth:rt}:{maxWidth:sizingTransform(a)}};return handleBreakpoints(o,o.maxWidth,s)}return null};maxWidth.filterProps=["maxWidth"];const minWidth=style$2({prop:"minWidth",transform:sizingTransform}),height=style$2({prop:"height",transform:sizingTransform}),maxHeight=style$2({prop:"maxHeight",transform:sizingTransform}),minHeight=style$2({prop:"minHeight",transform:sizingTransform});style$2({prop:"size",cssProperty:"width",transform:sizingTransform});style$2({prop:"size",cssProperty:"height",transform:sizingTransform});const boxSizing=style$2({prop:"boxSizing"});compose(width,maxWidth,minWidth,height,maxHeight,minHeight,boxSizing);const defaultSxConfig={border:{themeKey:"borders",transform:borderTransform},borderTop:{themeKey:"borders",transform:borderTransform},borderRight:{themeKey:"borders",transform:borderTransform},borderBottom:{themeKey:"borders",transform:borderTransform},borderLeft:{themeKey:"borders",transform:borderTransform},borderColor:{themeKey:"palette"},borderTopColor:{themeKey:"palette"},borderRightColor:{themeKey:"palette"},borderBottomColor:{themeKey:"palette"},borderLeftColor:{themeKey:"palette"},outline:{themeKey:"borders",transform:borderTransform},outlineColor:{themeKey:"palette"},borderRadius:{themeKey:"shape.borderRadius",style:borderRadius},color:{themeKey:"palette",transform:paletteTransform},bgcolor:{themeKey:"palette",cssProperty:"backgroundColor",transform:paletteTransform},backgroundColor:{themeKey:"palette",transform:paletteTransform},p:{style:padding},pt:{style:padding},pr:{style:padding},pb:{style:padding},pl:{style:padding},px:{style:padding},py:{style:padding},padding:{style:padding},paddingTop:{style:padding},paddingRight:{style:padding},paddingBottom:{style:padding},paddingLeft:{style:padding},paddingX:{style:padding},paddingY:{style:padding},paddingInline:{style:padding},paddingInlineStart:{style:padding},paddingInlineEnd:{style:padding},paddingBlock:{style:padding},paddingBlockStart:{style:padding},paddingBlockEnd:{style:padding},m:{style:margin},mt:{style:margin},mr:{style:margin},mb:{style:margin},ml:{style:margin},mx:{style:margin},my:{style:margin},margin:{style:margin},marginTop:{style:margin},marginRight:{style:margin},marginBottom:{style:margin},marginLeft:{style:margin},marginX:{style:margin},marginY:{style:margin},marginInline:{style:margin},marginInlineStart:{style:margin},marginInlineEnd:{style:margin},marginBlock:{style:margin},marginBlockStart:{style:margin},marginBlockEnd:{style:margin},displayPrint:{cssProperty:!1,transform:o=>({"@media print":{display:o}})},display:{},overflow:{},textOverflow:{},visibility:{},whiteSpace:{},flexBasis:{},flexDirection:{},flexWrap:{},justifyContent:{},alignItems:{},alignContent:{},order:{},flex:{},flexGrow:{},flexShrink:{},alignSelf:{},justifyItems:{},justifySelf:{},gap:{style:gap},rowGap:{style:rowGap},columnGap:{style:columnGap},gridColumn:{},gridRow:{},gridAutoFlow:{},gridAutoColumns:{},gridAutoRows:{},gridTemplateColumns:{},gridTemplateRows:{},gridTemplateAreas:{},gridArea:{},position:{},zIndex:{themeKey:"zIndex"},top:{},right:{},bottom:{},left:{},boxShadow:{themeKey:"shadows"},width:{transform:sizingTransform},maxWidth:{style:maxWidth},minWidth:{transform:sizingTransform},height:{transform:sizingTransform},maxHeight:{transform:sizingTransform},minHeight:{transform:sizingTransform},boxSizing:{},fontFamily:{themeKey:"typography"},fontSize:{themeKey:"typography"},fontStyle:{themeKey:"typography"},fontWeight:{themeKey:"typography"},letterSpacing:{},textTransform:{},lineHeight:{},textAlign:{},typography:{cssProperty:!1,themeKey:"typography"}};function objectsHaveSameKeys(...o){const s=o.reduce((et,tt)=>et.concat(Object.keys(tt)),[]),a=new Set(s);return o.every(et=>a.size===Object.keys(et).length)}function callIfFn(o,s){return typeof o=="function"?o(s):o}function unstable_createStyleFunctionSx(){function o(a,et,tt,rt){const nt={[a]:et,theme:tt},it=rt[a];if(!it)return{[a]:et};const{cssProperty:st=a,themeKey:ot,transform:at,style:lt}=it;if(et==null)return null;if(ot==="typography"&&et==="inherit")return{[a]:et};const ct=getPath(tt,ot)||{};return lt?lt(nt):handleBreakpoints(nt,et,ft=>{let dt=getStyleValue$1(ct,at,ft);return ft===dt&&typeof ft=="string"&&(dt=getStyleValue$1(ct,at,`${a}${ft==="default"?"":capitalize$1(ft)}`,ft)),st===!1?dt:{[st]:dt}})}function s(a){var et;const{sx:tt,theme:rt={}}=a||{};if(!tt)return null;const nt=(et=rt.unstable_sxConfig)!=null?et:defaultSxConfig;function it(st){let ot=st;if(typeof st=="function")ot=st(rt);else if(typeof st!="object")return st;if(!ot)return null;const at=createEmptyBreakpointObject(rt.breakpoints),lt=Object.keys(at);let ct=at;return Object.keys(ot).forEach(ht=>{const ft=callIfFn(ot[ht],rt);if(ft!=null)if(typeof ft=="object")if(nt[ht])ct=merge(ct,o(ht,ft,rt,nt));else{const dt=handleBreakpoints({theme:rt},ft,pt=>({[ht]:pt}));objectsHaveSameKeys(dt,ft)?ct[ht]=s({sx:ft,theme:rt}):ct=merge(ct,dt)}else ct=merge(ct,o(ht,ft,rt,nt))}),removeUnusedBreakpoints(lt,ct)}return Array.isArray(tt)?tt.map(it):it(tt)}return s}const styleFunctionSx$1=unstable_createStyleFunctionSx();styleFunctionSx$1.filterProps=["sx"];function applyStyles(o,s){const a=this;return a.vars&&typeof a.getColorSchemeSelector=="function"?{[a.getColorSchemeSelector(o).replace(/(\[[^\]]+\])/,"*:where($1)")]:s}:a.palette.mode===o?s:{}}const _excluded$F=["breakpoints","palette","spacing","shape"];function createTheme$2(o={},...s){const{breakpoints:a={},palette:et={},spacing:tt,shape:rt={}}=o,nt=_objectWithoutPropertiesLoose$1(o,_excluded$F),it=createBreakpoints(a),st=createSpacing(tt);let ot=deepmerge$1({breakpoints:it,direction:"ltr",components:{},palette:_extends$3({mode:"light"},et),spacing:st,shape:_extends$3({},shape,rt)},nt);return ot.applyStyles=applyStyles,ot=s.reduce((at,lt)=>deepmerge$1(at,lt),ot),ot.unstable_sxConfig=_extends$3({},defaultSxConfig,nt?.unstable_sxConfig),ot.unstable_sx=function(lt){return styleFunctionSx$1({sx:lt,theme:this})},ot}const createTheme$1=Object.freeze(Object.defineProperty({__proto__:null,default:createTheme$2,private_createBreakpoints:createBreakpoints,unstable_applyStyles:applyStyles},Symbol.toStringTag,{value:"Module"}));function isObjectEmpty(o){return Object.keys(o).length===0}function useTheme$2(o=null){const s=reactExports.useContext(ThemeContext);return!s||isObjectEmpty(s)?o:s}const systemDefaultTheme$1=createTheme$2();function useTheme$1(o=systemDefaultTheme$1){return useTheme$2(o)}function GlobalStyles$1({styles:o,themeId:s,defaultTheme:a={}}){const et=useTheme$1(a),tt=typeof o=="function"?o(s&&et[s]||et):o;return jsxRuntimeExports.jsx(GlobalStyles$2,{styles:tt})}const _excluded$E=["sx"],splitProps=o=>{var s,a;const et={systemProps:{},otherProps:{}},tt=(s=o==null||(a=o.theme)==null?void 0:a.unstable_sxConfig)!=null?s:defaultSxConfig;return Object.keys(o).forEach(rt=>{tt[rt]?et.systemProps[rt]=o[rt]:et.otherProps[rt]=o[rt]}),et};function extendSxProp(o){const{sx:s}=o,a=_objectWithoutPropertiesLoose$1(o,_excluded$E),{systemProps:et,otherProps:tt}=splitProps(a);let rt;return Array.isArray(s)?rt=[et,...s]:typeof s=="function"?rt=(...nt)=>{const it=s(...nt);return isPlainObject(it)?_extends$3({},et,it):et}:rt=_extends$3({},et,s),_extends$3({},tt,{sx:rt})}const styleFunctionSx=Object.freeze(Object.defineProperty({__proto__:null,default:styleFunctionSx$1,extendSxProp,unstable_createStyleFunctionSx,unstable_defaultSxConfig:defaultSxConfig},Symbol.toStringTag,{value:"Module"})),defaultGenerator=o=>o,createClassNameGenerator=()=>{let o=defaultGenerator;return{configure(s){o=s},generate(s){return o(s)},reset(){o=defaultGenerator}}},ClassNameGenerator=createClassNameGenerator();function r(o){var s,a,et="";if(typeof o=="string"||typeof o=="number")et+=o;else if(typeof o=="object")if(Array.isArray(o)){var tt=o.length;for(s=0;s<tt;s++)o[s]&&(a=r(o[s]))&&(et&&(et+=" "),et+=a)}else for(a in o)o[a]&&(et&&(et+=" "),et+=a);return et}function clsx(){for(var o,s,a=0,et="",tt=arguments.length;a<tt;a++)(o=arguments[a])&&(s=r(o))&&(et&&(et+=" "),et+=s);return et}const _excluded$D=["className","component"];function createBox(o={}){const{themeId:s,defaultTheme:a,defaultClassName:et="MuiBox-root",generateClassName:tt}=o,rt=styled$1("div",{shouldForwardProp:it=>it!=="theme"&&it!=="sx"&&it!=="as"})(styleFunctionSx$1);return reactExports.forwardRef(function(st,ot){const at=useTheme$1(a),lt=extendSxProp(st),{className:ct,component:ht="div"}=lt,ft=_objectWithoutPropertiesLoose$1(lt,_excluded$D);return jsxRuntimeExports.jsx(rt,_extends$3({as:ht,ref:ot,className:clsx(ct,tt?tt(et):et),theme:s&&at[s]||at},ft))})}const globalStateClasses={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",open:"open",readOnly:"readOnly",required:"required",selected:"selected"};function generateUtilityClass(o,s,a="Mui"){const et=globalStateClasses[s];return et?`${a}-${et}`:`${ClassNameGenerator.generate(o)}-${s}`}function generateUtilityClasses(o,s,a="Mui"){const et={};return s.forEach(tt=>{et[tt]=generateUtilityClass(o,tt,a)}),et}var reactIs={exports:{}},reactIs_production_min={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var b$1=Symbol.for("react.element"),c=Symbol.for("react.portal"),d=Symbol.for("react.fragment"),e=Symbol.for("react.strict_mode"),f=Symbol.for("react.profiler"),g$1=Symbol.for("react.provider"),h$1=Symbol.for("react.context"),k$1=Symbol.for("react.server_context"),l=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),n=Symbol.for("react.suspense_list"),p=Symbol.for("react.memo"),q$1=Symbol.for("react.lazy"),t=Symbol.for("react.offscreen"),u;u=Symbol.for("react.module.reference");function v$2(o){if(typeof o=="object"&&o!==null){var s=o.$$typeof;switch(s){case b$1:switch(o=o.type,o){case d:case f:case e:case m:case n:return o;default:switch(o=o&&o.$$typeof,o){case k$1:case h$1:case l:case q$1:case p:case g$1:return o;default:return s}}case c:return s}}}reactIs_production_min.ContextConsumer=h$1;reactIs_production_min.ContextProvider=g$1;reactIs_production_min.Element=b$1;reactIs_production_min.ForwardRef=l;reactIs_production_min.Fragment=d;reactIs_production_min.Lazy=q$1;reactIs_production_min.Memo=p;reactIs_production_min.Portal=c;reactIs_production_min.Profiler=f;reactIs_production_min.StrictMode=e;reactIs_production_min.Suspense=m;reactIs_production_min.SuspenseList=n;reactIs_production_min.isAsyncMode=function(){return!1};reactIs_production_min.isConcurrentMode=function(){return!1};reactIs_production_min.isContextConsumer=function(o){return v$2(o)===h$1};reactIs_production_min.isContextProvider=function(o){return v$2(o)===g$1};reactIs_production_min.isElement=function(o){return typeof o=="object"&&o!==null&&o.$$typeof===b$1};reactIs_production_min.isForwardRef=function(o){return v$2(o)===l};reactIs_production_min.isFragment=function(o){return v$2(o)===d};reactIs_production_min.isLazy=function(o){return v$2(o)===q$1};reactIs_production_min.isMemo=function(o){return v$2(o)===p};reactIs_production_min.isPortal=function(o){return v$2(o)===c};reactIs_production_min.isProfiler=function(o){return v$2(o)===f};reactIs_production_min.isStrictMode=function(o){return v$2(o)===e};reactIs_production_min.isSuspense=function(o){return v$2(o)===m};reactIs_production_min.isSuspenseList=function(o){return v$2(o)===n};reactIs_production_min.isValidElementType=function(o){return typeof o=="string"||typeof o=="function"||o===d||o===f||o===e||o===m||o===n||o===t||typeof o=="object"&&o!==null&&(o.$$typeof===q$1||o.$$typeof===p||o.$$typeof===g$1||o.$$typeof===h$1||o.$$typeof===l||o.$$typeof===u||o.getModuleId!==void 0)};reactIs_production_min.typeOf=v$2;reactIs.exports=reactIs_production_min;var reactIsExports=reactIs.exports;const fnNameMatchRegex=/^\s*function(?:\s|\s*\/\*.*\*\/\s*)+([^(\s/]*)\s*/;function getFunctionName(o){const s=`${o}`.match(fnNameMatchRegex);return s&&s[1]||""}function getFunctionComponentName(o,s=""){return o.displayName||o.name||getFunctionName(o)||s}function getWrappedName(o,s,a){const et=getFunctionComponentName(s);return o.displayName||(et!==""?`${a}(${et})`:a)}function getDisplayName$1(o){if(o!=null){if(typeof o=="string")return o;if(typeof o=="function")return getFunctionComponentName(o,"Component");if(typeof o=="object")switch(o.$$typeof){case reactIsExports.ForwardRef:return getWrappedName(o,o.render,"ForwardRef");case reactIsExports.Memo:return getWrappedName(o,o.type,"memo");default:return}}}const getDisplayName=Object.freeze(Object.defineProperty({__proto__:null,default:getDisplayName$1,getFunctionName},Symbol.toStringTag,{value:"Module"}));function resolveProps(o,s){const a=_extends$3({},s);return Object.keys(o).forEach(et=>{if(et.toString().match(/^(components|slots)$/))a[et]=_extends$3({},o[et],a[et]);else if(et.toString().match(/^(componentsProps|slotProps)$/)){const tt=o[et]||{},rt=s[et];a[et]={},!rt||!Object.keys(rt)?a[et]=tt:!tt||!Object.keys(tt)?a[et]=rt:(a[et]=_extends$3({},rt),Object.keys(tt).forEach(nt=>{a[et][nt]=resolveProps(tt[nt],rt[nt])}))}else a[et]===void 0&&(a[et]=o[et])}),a}function getThemeProps(o){const{theme:s,name:a,props:et}=o;return!s||!s.components||!s.components[a]||!s.components[a].defaultProps?et:resolveProps(s.components[a].defaultProps,et)}function useThemeProps$1({props:o,name:s,defaultTheme:a,themeId:et}){let tt=useTheme$1(a);return et&&(tt=tt[et]||tt),getThemeProps({theme:tt,name:s,props:o})}const useEnhancedEffect=typeof window<"u"?reactExports.useLayoutEffect:reactExports.useEffect;function clamp$2(o,s=Number.MIN_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER){return Math.max(s,Math.min(o,a))}const clamp$1=Object.freeze(Object.defineProperty({__proto__:null,default:clamp$2},Symbol.toStringTag,{value:"Module"}));function createChainedFunction(...o){return o.reduce((s,a)=>a==null?s:function(...tt){s.apply(this,tt),a.apply(this,tt)},()=>{})}function debounce(o,s=166){let a;function et(...tt){const rt=()=>{o.apply(this,tt)};clearTimeout(a),a=setTimeout(rt,s)}return et.clear=()=>{clearTimeout(a)},et}function deprecatedPropType(o,s){return()=>null}function isMuiElement(o,s){var a,et;return reactExports.isValidElement(o)&&s.indexOf((a=o.type.muiName)!=null?a:(et=o.type)==null||(et=et._payload)==null||(et=et.value)==null?void 0:et.muiName)!==-1}function ownerDocument(o){return o&&o.ownerDocument||document}function ownerWindow(o){return ownerDocument(o).defaultView||window}function requirePropFactory(o,s){return()=>null}function setRef(o,s){typeof o=="function"?o(s):o&&(o.current=s)}let globalId=0;function useGlobalId(o){const[s,a]=reactExports.useState(o),et=o||s;return reactExports.useEffect(()=>{s==null&&(globalId+=1,a(`mui-${globalId}`))},[s]),et}const maybeReactUseId=React$1.useId;function useId(o){if(maybeReactUseId!==void 0){const s=maybeReactUseId();return o??s}return useGlobalId(o)}function unsupportedProp(o,s,a,et,tt){return null}function useControlled({controlled:o,default:s,name:a,state:et="value"}){const{current:tt}=reactExports.useRef(o!==void 0),[rt,nt]=reactExports.useState(s),it=tt?o:rt,st=reactExports.useCallback(ot=>{tt||nt(ot)},[]);return[it,st]}function useEventCallback(o){const s=reactExports.useRef(o);return useEnhancedEffect(()=>{s.current=o}),reactExports.useRef((...a)=>(0,s.current)(...a)).current}function useForkRef(...o){return reactExports.useMemo(()=>o.every(s=>s==null)?null:s=>{o.forEach(a=>{setRef(a,s)})},o)}const UNINITIALIZED={};function useLazyRef(o,s){const a=reactExports.useRef(UNINITIALIZED);return a.current===UNINITIALIZED&&(a.current=o(s)),a}const EMPTY=[];function useOnMount(o){reactExports.useEffect(o,EMPTY)}class Timeout{constructor(){this.currentId=null,this.clear=()=>{this.currentId!==null&&(clearTimeout(this.currentId),this.currentId=null)},this.disposeEffect=()=>this.clear}static create(){return new Timeout}start(s,a){this.clear(),this.currentId=setTimeout(()=>{this.currentId=null,a()},s)}}function useTimeout(){const o=useLazyRef(Timeout.create).current;return useOnMount(o.disposeEffect),o}let hadKeyboardEvent=!0,hadFocusVisibleRecently=!1;const hadFocusVisibleRecentlyTimeout=new Timeout,inputTypesWhitelist={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function focusTriggersKeyboardModality(o){const{type:s,tagName:a}=o;return!!(a==="INPUT"&&inputTypesWhitelist[s]&&!o.readOnly||a==="TEXTAREA"&&!o.readOnly||o.isContentEditable)}function handleKeyDown(o){o.metaKey||o.altKey||o.ctrlKey||(hadKeyboardEvent=!0)}function handlePointerDown(){hadKeyboardEvent=!1}function handleVisibilityChange(){this.visibilityState==="hidden"&&hadFocusVisibleRecently&&(hadKeyboardEvent=!0)}function prepare(o){o.addEventListener("keydown",handleKeyDown,!0),o.addEventListener("mousedown",handlePointerDown,!0),o.addEventListener("pointerdown",handlePointerDown,!0),o.addEventListener("touchstart",handlePointerDown,!0),o.addEventListener("visibilitychange",handleVisibilityChange,!0)}function isFocusVisible(o){const{target:s}=o;try{return s.matches(":focus-visible")}catch{}return hadKeyboardEvent||focusTriggersKeyboardModality(s)}function useIsFocusVisible(){const o=reactExports.useCallback(tt=>{tt!=null&&prepare(tt.ownerDocument)},[]),s=reactExports.useRef(!1);function a(){return s.current?(hadFocusVisibleRecently=!0,hadFocusVisibleRecentlyTimeout.start(100,()=>{hadFocusVisibleRecently=!1}),s.current=!1,!0):!1}function et(tt){return isFocusVisible(tt)?(s.current=!0,!0):!1}return{isFocusVisibleRef:s,onFocus:et,onBlur:a,ref:o}}function getScrollbarSize$1(o){const s=o.documentElement.clientWidth;return Math.abs(window.innerWidth-s)}function composeClasses(o,s,a=void 0){const et={};return Object.keys(o).forEach(tt=>{et[tt]=o[tt].reduce((rt,nt)=>{if(nt){const it=s(nt);it!==""&&rt.push(it),a&&a[nt]&&rt.push(a[nt])}return rt},[]).join(" ")}),et}const RtlContext=reactExports.createContext(),useRtl=()=>{const o=reactExports.useContext(RtlContext);return o??!1};function createMixins(o,s){return _extends$3({toolbar:{minHeight:56,[o.up("xs")]:{"@media (orientation: landscape)":{minHeight:48}},[o.up("sm")]:{minHeight:64}}},s)}var colorManipulator={},interopRequireDefault={exports:{}};(function(o){function s(a){return a&&a.__esModule?a:{default:a}}o.exports=s,o.exports.__esModule=!0,o.exports.default=o.exports})(interopRequireDefault);var interopRequireDefaultExports=interopRequireDefault.exports;const require$$1$1=getAugmentedNamespace(formatMuiErrorMessage),require$$2=getAugmentedNamespace(clamp$1);var _interopRequireDefault$3=interopRequireDefaultExports;Object.defineProperty(colorManipulator,"__esModule",{value:!0});var alpha_1=colorManipulator.alpha=alpha;colorManipulator.blend=blend;colorManipulator.colorChannel=void 0;var darken_1=colorManipulator.darken=darken;colorManipulator.decomposeColor=decomposeColor;colorManipulator.emphasize=emphasize;var getContrastRatio_1=colorManipulator.getContrastRatio=getContrastRatio;colorManipulator.getLuminance=getLuminance;colorManipulator.hexToRgb=hexToRgb;colorManipulator.hslToRgb=hslToRgb;var lighten_1=colorManipulator.lighten=lighten;colorManipulator.private_safeAlpha=private_safeAlpha;colorManipulator.private_safeColorChannel=void 0;colorManipulator.private_safeDarken=private_safeDarken;colorManipulator.private_safeEmphasize=private_safeEmphasize;colorManipulator.private_safeLighten=private_safeLighten;colorManipulator.recomposeColor=recomposeColor;colorManipulator.rgbToHex=rgbToHex;var _formatMuiErrorMessage2=_interopRequireDefault$3(require$$1$1),_clamp=_interopRequireDefault$3(require$$2);function clampWrapper(o,s=0,a=1){return(0,_clamp.default)(o,s,a)}function hexToRgb(o){o=o.slice(1);const s=new RegExp(`.{1,${o.length>=6?2:1}}`,"g");let a=o.match(s);return a&&a[0].length===1&&(a=a.map(et=>et+et)),a?`rgb${a.length===4?"a":""}(${a.map((et,tt)=>tt<3?parseInt(et,16):Math.round(parseInt(et,16)/255*1e3)/1e3).join(", ")})`:""}function intToHex(o){const s=o.toString(16);return s.length===1?`0${s}`:s}function decomposeColor(o){if(o.type)return o;if(o.charAt(0)==="#")return decomposeColor(hexToRgb(o));const s=o.indexOf("("),a=o.substring(0,s);if(["rgb","rgba","hsl","hsla","color"].indexOf(a)===-1)throw new Error((0,_formatMuiErrorMessage2.default)(9,o));let et=o.substring(s+1,o.length-1),tt;if(a==="color"){if(et=et.split(" "),tt=et.shift(),et.length===4&&et[3].charAt(0)==="/"&&(et[3]=et[3].slice(1)),["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].indexOf(tt)===-1)throw new Error((0,_formatMuiErrorMessage2.default)(10,tt))}else et=et.split(",");return et=et.map(rt=>parseFloat(rt)),{type:a,values:et,colorSpace:tt}}const colorChannel=o=>{const s=decomposeColor(o);return s.values.slice(0,3).map((a,et)=>s.type.indexOf("hsl")!==-1&&et!==0?`${a}%`:a).join(" ")};colorManipulator.colorChannel=colorChannel;const private_safeColorChannel=(o,s)=>{try{return colorChannel(o)}catch{return o}};colorManipulator.private_safeColorChannel=private_safeColorChannel;function recomposeColor(o){const{type:s,colorSpace:a}=o;let{values:et}=o;return s.indexOf("rgb")!==-1?et=et.map((tt,rt)=>rt<3?parseInt(tt,10):tt):s.indexOf("hsl")!==-1&&(et[1]=`${et[1]}%`,et[2]=`${et[2]}%`),s.indexOf("color")!==-1?et=`${a} ${et.join(" ")}`:et=`${et.join(", ")}`,`${s}(${et})`}function rgbToHex(o){if(o.indexOf("#")===0)return o;const{values:s}=decomposeColor(o);return`#${s.map((a,et)=>intToHex(et===3?Math.round(255*a):a)).join("")}`}function hslToRgb(o){o=decomposeColor(o);const{values:s}=o,a=s[0],et=s[1]/100,tt=s[2]/100,rt=et*Math.min(tt,1-tt),nt=(ot,at=(ot+a/30)%12)=>tt-rt*Math.max(Math.min(at-3,9-at,1),-1);let it="rgb";const st=[Math.round(nt(0)*255),Math.round(nt(8)*255),Math.round(nt(4)*255)];return o.type==="hsla"&&(it+="a",st.push(s[3])),recomposeColor({type:it,values:st})}function getLuminance(o){o=decomposeColor(o);let s=o.type==="hsl"||o.type==="hsla"?decomposeColor(hslToRgb(o)).values:o.values;return s=s.map(a=>(o.type!=="color"&&(a/=255),a<=.03928?a/12.92:((a+.055)/1.055)**2.4)),Number((.2126*s[0]+.7152*s[1]+.0722*s[2]).toFixed(3))}function getContrastRatio(o,s){const a=getLuminance(o),et=getLuminance(s);return(Math.max(a,et)+.05)/(Math.min(a,et)+.05)}function alpha(o,s){return o=decomposeColor(o),s=clampWrapper(s),(o.type==="rgb"||o.type==="hsl")&&(o.type+="a"),o.type==="color"?o.values[3]=`/${s}`:o.values[3]=s,recomposeColor(o)}function private_safeAlpha(o,s,a){try{return alpha(o,s)}catch{return o}}function darken(o,s){if(o=decomposeColor(o),s=clampWrapper(s),o.type.indexOf("hsl")!==-1)o.values[2]*=1-s;else if(o.type.indexOf("rgb")!==-1||o.type.indexOf("color")!==-1)for(let a=0;a<3;a+=1)o.values[a]*=1-s;return recomposeColor(o)}function private_safeDarken(o,s,a){try{return darken(o,s)}catch{return o}}function lighten(o,s){if(o=decomposeColor(o),s=clampWrapper(s),o.type.indexOf("hsl")!==-1)o.values[2]+=(100-o.values[2])*s;else if(o.type.indexOf("rgb")!==-1)for(let a=0;a<3;a+=1)o.values[a]+=(255-o.values[a])*s;else if(o.type.indexOf("color")!==-1)for(let a=0;a<3;a+=1)o.values[a]+=(1-o.values[a])*s;return recomposeColor(o)}function private_safeLighten(o,s,a){try{return lighten(o,s)}catch{return o}}function emphasize(o,s=.15){return getLuminance(o)>.5?darken(o,s):lighten(o,s)}function private_safeEmphasize(o,s,a){try{return emphasize(o,s)}catch{return o}}function blend(o,s,a,et=1){const tt=(st,ot)=>Math.round((st**(1/et)*(1-a)+ot**(1/et)*a)**et),rt=decomposeColor(o),nt=decomposeColor(s),it=[tt(rt.values[0],nt.values[0]),tt(rt.values[1],nt.values[1]),tt(rt.values[2],nt.values[2])];return recomposeColor({type:"rgb",values:it})}const _excluded$C=["mode","contrastThreshold","tonalOffset"],light={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:common.white,default:common.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},dark={text:{primary:common.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:common.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function addLightOrDark(o,s,a,et){const tt=et.light||et,rt=et.dark||et*1.5;o[s]||(o.hasOwnProperty(a)?o[s]=o[a]:s==="light"?o.light=lighten_1(o.main,tt):s==="dark"&&(o.dark=darken_1(o.main,rt)))}function getDefaultPrimary(o="light"){return o==="dark"?{main:blue[200],light:blue[50],dark:blue[400]}:{main:blue[700],light:blue[400],dark:blue[800]}}function getDefaultSecondary(o="light"){return o==="dark"?{main:purple[200],light:purple[50],dark:purple[400]}:{main:purple[500],light:purple[300],dark:purple[700]}}function getDefaultError(o="light"){return o==="dark"?{main:red[500],light:red[300],dark:red[700]}:{main:red[700],light:red[400],dark:red[800]}}function getDefaultInfo(o="light"){return o==="dark"?{main:lightBlue[400],light:lightBlue[300],dark:lightBlue[700]}:{main:lightBlue[700],light:lightBlue[500],dark:lightBlue[900]}}function getDefaultSuccess(o="light"){return o==="dark"?{main:green[400],light:green[300],dark:green[700]}:{main:green[800],light:green[500],dark:green[900]}}function getDefaultWarning(o="light"){return o==="dark"?{main:orange[400],light:orange[300],dark:orange[700]}:{main:"#ed6c02",light:orange[500],dark:orange[900]}}function createPalette(o){const{mode:s="light",contrastThreshold:a=3,tonalOffset:et=.2}=o,tt=_objectWithoutPropertiesLoose$1(o,_excluded$C),rt=o.primary||getDefaultPrimary(s),nt=o.secondary||getDefaultSecondary(s),it=o.error||getDefaultError(s),st=o.info||getDefaultInfo(s),ot=o.success||getDefaultSuccess(s),at=o.warning||getDefaultWarning(s);function lt(dt){return getContrastRatio_1(dt,dark.text.primary)>=a?dark.text.primary:light.text.primary}const ct=({color:dt,name:pt,mainShade:gt=500,lightShade:mt=300,darkShade:yt=700})=>{if(dt=_extends$3({},dt),!dt.main&&dt[gt]&&(dt.main=dt[gt]),!dt.hasOwnProperty("main"))throw new Error(formatMuiErrorMessage$1(11,pt?` (${pt})`:"",gt));if(typeof dt.main!="string")throw new Error(formatMuiErrorMessage$1(12,pt?` (${pt})`:"",JSON.stringify(dt.main)));return addLightOrDark(dt,"light",mt,et),addLightOrDark(dt,"dark",yt,et),dt.contrastText||(dt.contrastText=lt(dt.main)),dt},ht={dark,light};return deepmerge$1(_extends$3({common:_extends$3({},common),mode:s,primary:ct({color:rt,name:"primary"}),secondary:ct({color:nt,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:ct({color:it,name:"error"}),warning:ct({color:at,name:"warning"}),info:ct({color:st,name:"info"}),success:ct({color:ot,name:"success"}),grey,contrastThreshold:a,getContrastText:lt,augmentColor:ct,tonalOffset:et},ht[s]),tt)}const _excluded$B=["fontFamily","fontSize","fontWeightLight","fontWeightRegular","fontWeightMedium","fontWeightBold","htmlFontSize","allVariants","pxToRem"];function round$1(o){return Math.round(o*1e5)/1e5}const caseAllCaps={textTransform:"uppercase"},defaultFontFamily='"Roboto", "Helvetica", "Arial", sans-serif';function createTypography(o,s){const a=typeof s=="function"?s(o):s,{fontFamily:et=defaultFontFamily,fontSize:tt=14,fontWeightLight:rt=300,fontWeightRegular:nt=400,fontWeightMedium:it=500,fontWeightBold:st=700,htmlFontSize:ot=16,allVariants:at,pxToRem:lt}=a,ct=_objectWithoutPropertiesLoose$1(a,_excluded$B),ht=tt/14,ft=lt||(gt=>`${gt/ot*ht}rem`),dt=(gt,mt,yt,vt,Et)=>_extends$3({fontFamily:et,fontWeight:gt,fontSize:ft(mt),lineHeight:yt},et===defaultFontFamily?{letterSpacing:`${round$1(vt/mt)}em`}:{},Et,at),pt={h1:dt(rt,96,1.167,-1.5),h2:dt(rt,60,1.2,-.5),h3:dt(nt,48,1.167,0),h4:dt(nt,34,1.235,.25),h5:dt(nt,24,1.334,0),h6:dt(it,20,1.6,.15),subtitle1:dt(nt,16,1.75,.15),subtitle2:dt(it,14,1.57,.1),body1:dt(nt,16,1.5,.15),body2:dt(nt,14,1.43,.15),button:dt(it,14,1.75,.4,caseAllCaps),caption:dt(nt,12,1.66,.4),overline:dt(nt,12,2.66,1,caseAllCaps),inherit:{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}};return deepmerge$1(_extends$3({htmlFontSize:ot,pxToRem:ft,fontFamily:et,fontSize:tt,fontWeightLight:rt,fontWeightRegular:nt,fontWeightMedium:it,fontWeightBold:st},pt),ct,{clone:!1})}const shadowKeyUmbraOpacity=.2,shadowKeyPenumbraOpacity=.14,shadowAmbientShadowOpacity=.12;function createShadow(...o){return[`${o[0]}px ${o[1]}px ${o[2]}px ${o[3]}px rgba(0,0,0,${shadowKeyUmbraOpacity})`,`${o[4]}px ${o[5]}px ${o[6]}px ${o[7]}px rgba(0,0,0,${shadowKeyPenumbraOpacity})`,`${o[8]}px ${o[9]}px ${o[10]}px ${o[11]}px rgba(0,0,0,${shadowAmbientShadowOpacity})`].join(",")}const shadows=["none",createShadow(0,2,1,-1,0,1,1,0,0,1,3,0),createShadow(0,3,1,-2,0,2,2,0,0,1,5,0),createShadow(0,3,3,-2,0,3,4,0,0,1,8,0),createShadow(0,2,4,-1,0,4,5,0,0,1,10,0),createShadow(0,3,5,-1,0,5,8,0,0,1,14,0),createShadow(0,3,5,-1,0,6,10,0,0,1,18,0),createShadow(0,4,5,-2,0,7,10,1,0,2,16,1),createShadow(0,5,5,-3,0,8,10,1,0,3,14,2),createShadow(0,5,6,-3,0,9,12,1,0,3,16,2),createShadow(0,6,6,-3,0,10,14,1,0,4,18,3),createShadow(0,6,7,-4,0,11,15,1,0,4,20,3),createShadow(0,7,8,-4,0,12,17,2,0,5,22,4),createShadow(0,7,8,-4,0,13,19,2,0,5,24,4),createShadow(0,7,9,-4,0,14,21,2,0,5,26,4),createShadow(0,8,9,-5,0,15,22,2,0,6,28,5),createShadow(0,8,10,-5,0,16,24,2,0,6,30,5),createShadow(0,8,11,-5,0,17,26,2,0,6,32,5),createShadow(0,9,11,-5,0,18,28,2,0,7,34,6),createShadow(0,9,12,-6,0,19,29,2,0,7,36,6),createShadow(0,10,13,-6,0,20,31,3,0,8,38,7),createShadow(0,10,13,-6,0,21,33,3,0,8,40,7),createShadow(0,10,14,-6,0,22,35,3,0,8,42,7),createShadow(0,11,14,-7,0,23,36,3,0,9,44,8),createShadow(0,11,15,-7,0,24,38,3,0,9,46,8)],_excluded$A=["duration","easing","delay"],easing={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},duration={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function formatMs(o){return`${Math.round(o)}ms`}function getAutoHeightDuration(o){if(!o)return 0;const s=o/36;return Math.round((4+15*s**.25+s/5)*10)}function createTransitions(o){const s=_extends$3({},easing,o.easing),a=_extends$3({},duration,o.duration);return _extends$3({getAutoHeightDuration,create:(tt=["all"],rt={})=>{const{duration:nt=a.standard,easing:it=s.easeInOut,delay:st=0}=rt;return _objectWithoutPropertiesLoose$1(rt,_excluded$A),(Array.isArray(tt)?tt:[tt]).map(ot=>`${ot} ${typeof nt=="string"?nt:formatMs(nt)} ${it} ${typeof st=="string"?st:formatMs(st)}`).join(",")}},o,{easing:s,duration:a})}const zIndex={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500},_excluded$z=["breakpoints","mixins","spacing","palette","transitions","typography","shape"];function createTheme(o={},...s){const{mixins:a={},palette:et={},transitions:tt={},typography:rt={}}=o,nt=_objectWithoutPropertiesLoose$1(o,_excluded$z);if(o.vars)throw new Error(formatMuiErrorMessage$1(18));const it=createPalette(et),st=createTheme$2(o);let ot=deepmerge$1(st,{mixins:createMixins(st.breakpoints,a),palette:it,shadows:shadows.slice(),typography:createTypography(it,rt),transitions:createTransitions(tt),zIndex:_extends$3({},zIndex)});return ot=deepmerge$1(ot,nt),ot=s.reduce((at,lt)=>deepmerge$1(at,lt),ot),ot.unstable_sxConfig=_extends$3({},defaultSxConfig,nt?.unstable_sxConfig),ot.unstable_sx=function(lt){return styleFunctionSx$1({sx:lt,theme:this})},ot}const defaultTheme$1=createTheme();function useTheme(){const o=useTheme$1(defaultTheme$1);return o[THEME_ID]||o}function useThemeProps({props:o,name:s}){return useThemeProps$1({props:o,name:s,defaultTheme:defaultTheme$1,themeId:THEME_ID})}var createStyled$1={},objectWithoutPropertiesLoose={exports:{}},hasRequiredObjectWithoutPropertiesLoose;function requireObjectWithoutPropertiesLoose(){return hasRequiredObjectWithoutPropertiesLoose||(hasRequiredObjectWithoutPropertiesLoose=1,function(o){function s(a,et){if(a==null)return{};var tt={};for(var rt in a)if({}.hasOwnProperty.call(a,rt)){if(et.indexOf(rt)>=0)continue;tt[rt]=a[rt]}return tt}o.exports=s,o.exports.__esModule=!0,o.exports.default=o.exports}(objectWithoutPropertiesLoose)),objectWithoutPropertiesLoose.exports}const require$$1=getAugmentedNamespace(styledEngine),require$$4=getAugmentedNamespace(deepmerge),require$$5=getAugmentedNamespace(capitalize),require$$6=getAugmentedNamespace(getDisplayName),require$$7=getAugmentedNamespace(createTheme$1),require$$8=getAugmentedNamespace(styleFunctionSx);var _interopRequireDefault$2=interopRequireDefaultExports;Object.defineProperty(createStyled$1,"__esModule",{value:!0});var _default=createStyled$1.default=createStyled;createStyled$1.shouldForwardProp=shouldForwardProp;createStyled$1.systemDefaultTheme=void 0;var _extends2=_interopRequireDefault$2(require_extends()),_objectWithoutPropertiesLoose2=_interopRequireDefault$2(requireObjectWithoutPropertiesLoose()),_styledEngine=_interopRequireWildcard(require$$1),_deepmerge=require$$4;_interopRequireDefault$2(require$$5);_interopRequireDefault$2(require$$6);var _createTheme=_interopRequireDefault$2(require$$7),_styleFunctionSx=_interopRequireDefault$2(require$$8);const _excluded$y=["ownerState"],_excluded2$3=["variants"],_excluded3$1=["name","slot","skipVariantsResolver","skipSx","overridesResolver"];function _getRequireWildcardCache(o){if(typeof WeakMap!="function")return null;var s=new WeakMap,a=new WeakMap;return(_getRequireWildcardCache=function(et){return et?a:s})(o)}function _interopRequireWildcard(o,s){if(o&&o.__esModule)return o;if(o===null||typeof o!="object"&&typeof o!="function")return{default:o};var a=_getRequireWildcardCache(s);if(a&&a.has(o))return a.get(o);var et={__proto__:null},tt=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var rt in o)if(rt!=="default"&&Object.prototype.hasOwnProperty.call(o,rt)){var nt=tt?Object.getOwnPropertyDescriptor(o,rt):null;nt&&(nt.get||nt.set)?Object.defineProperty(et,rt,nt):et[rt]=o[rt]}return et.default=o,a&&a.set(o,et),et}function isEmpty$4(o){return Object.keys(o).length===0}function isStringTag(o){return typeof o=="string"&&o.charCodeAt(0)>96}function shouldForwardProp(o){return o!=="ownerState"&&o!=="theme"&&o!=="sx"&&o!=="as"}const systemDefaultTheme=createStyled$1.systemDefaultTheme=(0,_createTheme.default)(),lowercaseFirstLetter=o=>o&&o.charAt(0).toLowerCase()+o.slice(1);function resolveTheme({defaultTheme:o,theme:s,themeId:a}){return isEmpty$4(s)?o:s[a]||s}function defaultOverridesResolver(o){return o?(s,a)=>a[o]:null}function processStyleArg(o,s){let{ownerState:a}=s,et=(0,_objectWithoutPropertiesLoose2.default)(s,_excluded$y);const tt=typeof o=="function"?o((0,_extends2.default)({ownerState:a},et)):o;if(Array.isArray(tt))return tt.flatMap(rt=>processStyleArg(rt,(0,_extends2.default)({ownerState:a},et)));if(tt&&typeof tt=="object"&&Array.isArray(tt.variants)){const{variants:rt=[]}=tt;let it=(0,_objectWithoutPropertiesLoose2.default)(tt,_excluded2$3);return rt.forEach(st=>{let ot=!0;typeof st.props=="function"?ot=st.props((0,_extends2.default)({ownerState:a},et,a)):Object.keys(st.props).forEach(at=>{a?.[at]!==st.props[at]&&et[at]!==st.props[at]&&(ot=!1)}),ot&&(Array.isArray(it)||(it=[it]),it.push(typeof st.style=="function"?st.style((0,_extends2.default)({ownerState:a},et,a)):st.style))}),it}return tt}function createStyled(o={}){const{themeId:s,defaultTheme:a=systemDefaultTheme,rootShouldForwardProp:et=shouldForwardProp,slotShouldForwardProp:tt=shouldForwardProp}=o,rt=nt=>(0,_styleFunctionSx.default)((0,_extends2.default)({},nt,{theme:resolveTheme((0,_extends2.default)({},nt,{defaultTheme:a,themeId:s}))}));return rt.__mui_systemSx=!0,(nt,it={})=>{(0,_styledEngine.internal_processStyles)(nt,Et=>Et.filter(xt=>!(xt!=null&&xt.__mui_systemSx)));const{name:st,slot:ot,skipVariantsResolver:at,skipSx:lt,overridesResolver:ct=defaultOverridesResolver(lowercaseFirstLetter(ot))}=it,ht=(0,_objectWithoutPropertiesLoose2.default)(it,_excluded3$1),ft=at!==void 0?at:ot&&ot!=="Root"&&ot!=="root"||!1,dt=lt||!1;let pt,gt=shouldForwardProp;ot==="Root"||ot==="root"?gt=et:ot?gt=tt:isStringTag(nt)&&(gt=void 0);const mt=(0,_styledEngine.default)(nt,(0,_extends2.default)({shouldForwardProp:gt,label:pt},ht)),yt=Et=>typeof Et=="function"&&Et.__emotion_real!==Et||(0,_deepmerge.isPlainObject)(Et)?xt=>processStyleArg(Et,(0,_extends2.default)({},xt,{theme:resolveTheme({theme:xt.theme,defaultTheme:a,themeId:s})})):Et,vt=(Et,...xt)=>{let wt=yt(Et);const Rt=xt?xt.map(yt):[];st&&ct&&Rt.push(zt=>{const Nt=resolveTheme((0,_extends2.default)({},zt,{defaultTheme:a,themeId:s}));if(!Nt.components||!Nt.components[st]||!Nt.components[st].styleOverrides)return null;const Kt=Nt.components[st].styleOverrides,Yt={};return Object.entries(Kt).forEach(([Bt,Pt])=>{Yt[Bt]=processStyleArg(Pt,(0,_extends2.default)({},zt,{theme:Nt}))}),ct(zt,Yt)}),st&&!ft&&Rt.push(zt=>{var Nt;const Kt=resolveTheme((0,_extends2.default)({},zt,{defaultTheme:a,themeId:s})),Yt=Kt==null||(Nt=Kt.components)==null||(Nt=Nt[st])==null?void 0:Nt.variants;return processStyleArg({variants:Yt},(0,_extends2.default)({},zt,{theme:Kt}))}),dt||Rt.push(rt);const Ct=Rt.length-xt.length;if(Array.isArray(Et)&&Ct>0){const zt=new Array(Ct).fill("");wt=[...Et,...zt],wt.raw=[...Et.raw,...zt]}const Ft=mt(wt,...Rt);return nt.muiName&&(Ft.muiName=nt.muiName),Ft};return mt.withConfig&&(vt.withConfig=mt.withConfig),vt}}function slotShouldForwardProp(o){return o!=="ownerState"&&o!=="theme"&&o!=="sx"&&o!=="as"}const rootShouldForwardProp=o=>slotShouldForwardProp(o)&&o!=="classes",styled=_default({themeId:THEME_ID,defaultTheme:defaultTheme$1,rootShouldForwardProp}),getOverlayAlpha=o=>{let s;return o<1?s=5.11916*o**2:s=4.5*Math.log(o+1)+2,(s/100).toFixed(2)};function getSvgIconUtilityClass(o){return generateUtilityClass("MuiSvgIcon",o)}generateUtilityClasses("MuiSvgIcon",["root","colorPrimary","colorSecondary","colorAction","colorError","colorDisabled","fontSizeInherit","fontSizeSmall","fontSizeMedium","fontSizeLarge"]);const _excluded$x=["children","className","color","component","fontSize","htmlColor","inheritViewBox","titleAccess","viewBox"],useUtilityClasses$o=o=>{const{color:s,fontSize:a,classes:et}=o,tt={root:["root",s!=="inherit"&&`color${capitalize$1(s)}`,`fontSize${capitalize$1(a)}`]};return composeClasses(tt,getSvgIconUtilityClass,et)},SvgIconRoot=styled("svg",{name:"MuiSvgIcon",slot:"Root",overridesResolver:(o,s)=>{const{ownerState:a}=o;return[s.root,a.color!=="inherit"&&s[`color${capitalize$1(a.color)}`],s[`fontSize${capitalize$1(a.fontSize)}`]]}})(({theme:o,ownerState:s})=>{var a,et,tt,rt,nt,it,st,ot,at,lt,ct,ht,ft;return{userSelect:"none",width:"1em",height:"1em",display:"inline-block",fill:s.hasSvgAsChild?void 0:"currentColor",flexShrink:0,transition:(a=o.transitions)==null||(et=a.create)==null?void 0:et.call(a,"fill",{duration:(tt=o.transitions)==null||(tt=tt.duration)==null?void 0:tt.shorter}),fontSize:{inherit:"inherit",small:((rt=o.typography)==null||(nt=rt.pxToRem)==null?void 0:nt.call(rt,20))||"1.25rem",medium:((it=o.typography)==null||(st=it.pxToRem)==null?void 0:st.call(it,24))||"1.5rem",large:((ot=o.typography)==null||(at=ot.pxToRem)==null?void 0:at.call(ot,35))||"2.1875rem"}[s.fontSize],color:(lt=(ct=(o.vars||o).palette)==null||(ct=ct[s.color])==null?void 0:ct.main)!=null?lt:{action:(ht=(o.vars||o).palette)==null||(ht=ht.action)==null?void 0:ht.active,disabled:(ft=(o.vars||o).palette)==null||(ft=ft.action)==null?void 0:ft.disabled,inherit:void 0}[s.color]}}),SvgIcon=reactExports.forwardRef(function(s,a){const et=useThemeProps({props:s,name:"MuiSvgIcon"}),{children:tt,className:rt,color:nt="inherit",component:it="svg",fontSize:st="medium",htmlColor:ot,inheritViewBox:at=!1,titleAccess:lt,viewBox:ct="0 0 24 24"}=et,ht=_objectWithoutPropertiesLoose$1(et,_excluded$x),ft=reactExports.isValidElement(tt)&&tt.type==="svg",dt=_extends$3({},et,{color:nt,component:it,fontSize:st,instanceFontSize:s.fontSize,inheritViewBox:at,viewBox:ct,hasSvgAsChild:ft}),pt={};at||(pt.viewBox=ct);const gt=useUtilityClasses$o(dt);return jsxRuntimeExports.jsxs(SvgIconRoot,_extends$3({as:it,className:clsx(gt.root,rt),focusable:"false",color:ot,"aria-hidden":lt?void 0:!0,role:lt?"img":void 0,ref:a},pt,ht,ft&&tt.props,{ownerState:dt,children:[ft?tt.props.children:tt,lt?jsxRuntimeExports.jsx("title",{children:lt}):null]}))});SvgIcon.muiName="SvgIcon";function createSvgIcon$1(o,s){function a(et,tt){return jsxRuntimeExports.jsx(SvgIcon,_extends$3({"data-testid":`${s}Icon`,ref:tt},et,{children:o}))}return a.muiName=SvgIcon.muiName,reactExports.memo(reactExports.forwardRef(a))}const unstable_ClassNameGenerator={configure:o=>{ClassNameGenerator.configure(o)}},utils=Object.freeze(Object.defineProperty({__proto__:null,capitalize:capitalize$1,createChainedFunction,createSvgIcon:createSvgIcon$1,debounce,deprecatedPropType,isMuiElement,ownerDocument,ownerWindow,requirePropFactory,setRef,unstable_ClassNameGenerator,unstable_useEnhancedEffect:useEnhancedEffect,unstable_useId:useId,unsupportedProp,useControlled,useEventCallback,useForkRef,useIsFocusVisible},Symbol.toStringTag,{value:"Module"}));function _setPrototypeOf(o,s){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,et){return a.__proto__=et,a},_setPrototypeOf(o,s)}function _inheritsLoose(o,s){o.prototype=Object.create(s.prototype),o.prototype.constructor=o,_setPrototypeOf(o,s)}const config={disabled:!1},TransitionGroupContext=React.createContext(null);var forceReflow=function(s){return s.scrollTop},UNMOUNTED="unmounted",EXITED="exited",ENTERING="entering",ENTERED="entered",EXITING="exiting",Transition=function(o){_inheritsLoose(s,o);function s(et,tt){var rt;rt=o.call(this,et,tt)||this;var nt=tt,it=nt&&!nt.isMounting?et.enter:et.appear,st;return rt.appearStatus=null,et.in?it?(st=EXITED,rt.appearStatus=ENTERING):st=ENTERED:et.unmountOnExit||et.mountOnEnter?st=UNMOUNTED:st=EXITED,rt.state={status:st},rt.nextCallback=null,rt}s.getDerivedStateFromProps=function(tt,rt){var nt=tt.in;return nt&&rt.status===UNMOUNTED?{status:EXITED}:null};var a=s.prototype;return a.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},a.componentDidUpdate=function(tt){var rt=null;if(tt!==this.props){var nt=this.state.status;this.props.in?nt!==ENTERING&&nt!==ENTERED&&(rt=ENTERING):(nt===ENTERING||nt===ENTERED)&&(rt=EXITING)}this.updateStatus(!1,rt)},a.componentWillUnmount=function(){this.cancelNextCallback()},a.getTimeouts=function(){var tt=this.props.timeout,rt,nt,it;return rt=nt=it=tt,tt!=null&&typeof tt!="number"&&(rt=tt.exit,nt=tt.enter,it=tt.appear!==void 0?tt.appear:nt),{exit:rt,enter:nt,appear:it}},a.updateStatus=function(tt,rt){if(tt===void 0&&(tt=!1),rt!==null)if(this.cancelNextCallback(),rt===ENTERING){if(this.props.unmountOnExit||this.props.mountOnEnter){var nt=this.props.nodeRef?this.props.nodeRef.current:ReactDOM.findDOMNode(this);nt&&forceReflow(nt)}this.performEnter(tt)}else this.performExit();else this.props.unmountOnExit&&this.state.status===EXITED&&this.setState({status:UNMOUNTED})},a.performEnter=function(tt){var rt=this,nt=this.props.enter,it=this.context?this.context.isMounting:tt,st=this.props.nodeRef?[it]:[ReactDOM.findDOMNode(this),it],ot=st[0],at=st[1],lt=this.getTimeouts(),ct=it?lt.appear:lt.enter;if(!tt&&!nt||config.disabled){this.safeSetState({status:ENTERED},function(){rt.props.onEntered(ot)});return}this.props.onEnter(ot,at),this.safeSetState({status:ENTERING},function(){rt.props.onEntering(ot,at),rt.onTransitionEnd(ct,function(){rt.safeSetState({status:ENTERED},function(){rt.props.onEntered(ot,at)})})})},a.performExit=function(){var tt=this,rt=this.props.exit,nt=this.getTimeouts(),it=this.props.nodeRef?void 0:ReactDOM.findDOMNode(this);if(!rt||config.disabled){this.safeSetState({status:EXITED},function(){tt.props.onExited(it)});return}this.props.onExit(it),this.safeSetState({status:EXITING},function(){tt.props.onExiting(it),tt.onTransitionEnd(nt.exit,function(){tt.safeSetState({status:EXITED},function(){tt.props.onExited(it)})})})},a.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},a.safeSetState=function(tt,rt){rt=this.setNextCallback(rt),this.setState(tt,rt)},a.setNextCallback=function(tt){var rt=this,nt=!0;return this.nextCallback=function(it){nt&&(nt=!1,rt.nextCallback=null,tt(it))},this.nextCallback.cancel=function(){nt=!1},this.nextCallback},a.onTransitionEnd=function(tt,rt){this.setNextCallback(rt);var nt=this.props.nodeRef?this.props.nodeRef.current:ReactDOM.findDOMNode(this),it=tt==null&&!this.props.addEndListener;if(!nt||it){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var st=this.props.nodeRef?[this.nextCallback]:[nt,this.nextCallback],ot=st[0],at=st[1];this.props.addEndListener(ot,at)}tt!=null&&setTimeout(this.nextCallback,tt)},a.render=function(){var tt=this.state.status;if(tt===UNMOUNTED)return null;var rt=this.props,nt=rt.children;rt.in,rt.mountOnEnter,rt.unmountOnExit,rt.appear,rt.enter,rt.exit,rt.timeout,rt.addEndListener,rt.onEnter,rt.onEntering,rt.onEntered,rt.onExit,rt.onExiting,rt.onExited,rt.nodeRef;var it=_objectWithoutPropertiesLoose$1(rt,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return React.createElement(TransitionGroupContext.Provider,{value:null},typeof nt=="function"?nt(tt,it):React.cloneElement(React.Children.only(nt),it))},s}(React.Component);Transition.contextType=TransitionGroupContext;Transition.propTypes={};function noop$3(){}Transition.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:noop$3,onEntering:noop$3,onEntered:noop$3,onExit:noop$3,onExiting:noop$3,onExited:noop$3};Transition.UNMOUNTED=UNMOUNTED;Transition.EXITED=EXITED;Transition.ENTERING=ENTERING;Transition.ENTERED=ENTERED;Transition.EXITING=EXITING;function _assertThisInitialized(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function getChildMapping(o,s){var a=function(rt){return s&&reactExports.isValidElement(rt)?s(rt):rt},et=Object.create(null);return o&&reactExports.Children.map(o,function(tt){return tt}).forEach(function(tt){et[tt.key]=a(tt)}),et}function mergeChildMappings(o,s){o=o||{},s=s||{};function a(at){return at in s?s[at]:o[at]}var et=Object.create(null),tt=[];for(var rt in o)rt in s?tt.length&&(et[rt]=tt,tt=[]):tt.push(rt);var nt,it={};for(var st in s){if(et[st])for(nt=0;nt<et[st].length;nt++){var ot=et[st][nt];it[et[st][nt]]=a(ot)}it[st]=a(st)}for(nt=0;nt<tt.length;nt++)it[tt[nt]]=a(tt[nt]);return it}function getProp(o,s,a){return a[s]!=null?a[s]:o.props[s]}function getInitialChildMapping(o,s){return getChildMapping(o.children,function(a){return reactExports.cloneElement(a,{onExited:s.bind(null,a),in:!0,appear:getProp(a,"appear",o),enter:getProp(a,"enter",o),exit:getProp(a,"exit",o)})})}function getNextChildMapping(o,s,a){var et=getChildMapping(o.children),tt=mergeChildMappings(s,et);return Object.keys(tt).forEach(function(rt){var nt=tt[rt];if(reactExports.isValidElement(nt)){var it=rt in s,st=rt in et,ot=s[rt],at=reactExports.isValidElement(ot)&&!ot.props.in;st&&(!it||at)?tt[rt]=reactExports.cloneElement(nt,{onExited:a.bind(null,nt),in:!0,exit:getProp(nt,"exit",o),enter:getProp(nt,"enter",o)}):!st&&it&&!at?tt[rt]=reactExports.cloneElement(nt,{in:!1}):st&&it&&reactExports.isValidElement(ot)&&(tt[rt]=reactExports.cloneElement(nt,{onExited:a.bind(null,nt),in:ot.props.in,exit:getProp(nt,"exit",o),enter:getProp(nt,"enter",o)}))}}),tt}var values=Object.values||function(o){return Object.keys(o).map(function(s){return o[s]})},defaultProps={component:"div",childFactory:function(s){return s}},TransitionGroup=function(o){_inheritsLoose(s,o);function s(et,tt){var rt;rt=o.call(this,et,tt)||this;var nt=rt.handleExited.bind(_assertThisInitialized(rt));return rt.state={contextValue:{isMounting:!0},handleExited:nt,firstRender:!0},rt}var a=s.prototype;return a.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},a.componentWillUnmount=function(){this.mounted=!1},s.getDerivedStateFromProps=function(tt,rt){var nt=rt.children,it=rt.handleExited,st=rt.firstRender;return{children:st?getInitialChildMapping(tt,it):getNextChildMapping(tt,nt,it),firstRender:!1}},a.handleExited=function(tt,rt){var nt=getChildMapping(this.props.children);tt.key in nt||(tt.props.onExited&&tt.props.onExited(rt),this.mounted&&this.setState(function(it){var st=_extends$3({},it.children);return delete st[tt.key],{children:st}}))},a.render=function(){var tt=this.props,rt=tt.component,nt=tt.childFactory,it=_objectWithoutPropertiesLoose$1(tt,["component","childFactory"]),st=this.state.contextValue,ot=values(this.state.children).map(nt);return delete it.appear,delete it.enter,delete it.exit,rt===null?React.createElement(TransitionGroupContext.Provider,{value:st},ot):React.createElement(TransitionGroupContext.Provider,{value:st},React.createElement(rt,it,ot))},s}(React.Component);TransitionGroup.propTypes={};TransitionGroup.defaultProps=defaultProps;const reflow=o=>o.scrollTop;function getTransitionProps(o,s){var a,et;const{timeout:tt,easing:rt,style:nt={}}=o;return{duration:(a=nt.transitionDuration)!=null?a:typeof tt=="number"?tt:tt[s.mode]||0,easing:(et=nt.transitionTimingFunction)!=null?et:typeof rt=="object"?rt[s.mode]:rt,delay:nt.transitionDelay}}function getPaperUtilityClass(o){return generateUtilityClass("MuiPaper",o)}generateUtilityClasses("MuiPaper",["root","rounded","outlined","elevation","elevation0","elevation1","elevation2","elevation3","elevation4","elevation5","elevation6","elevation7","elevation8","elevation9","elevation10","elevation11","elevation12","elevation13","elevation14","elevation15","elevation16","elevation17","elevation18","elevation19","elevation20","elevation21","elevation22","elevation23","elevation24"]);const _excluded$w=["className","component","elevation","square","variant"],useUtilityClasses$n=o=>{const{square:s,elevation:a,variant:et,classes:tt}=o,rt={root:["root",et,!s&&"rounded",et==="elevation"&&`elevation${a}`]};return composeClasses(rt,getPaperUtilityClass,tt)},PaperRoot=styled("div",{name:"MuiPaper",slot:"Root",overridesResolver:(o,s)=>{const{ownerState:a}=o;return[s.root,s[a.variant],!a.square&&s.rounded,a.variant==="elevation"&&s[`elevation${a.elevation}`]]}})(({theme:o,ownerState:s})=>{var a;return _extends$3({backgroundColor:(o.vars||o).palette.background.paper,color:(o.vars||o).palette.text.primary,transition:o.transitions.create("box-shadow")},!s.square&&{borderRadius:o.shape.borderRadius},s.variant==="outlined"&&{border:`1px solid ${(o.vars||o).palette.divider}`},s.variant==="elevation"&&_extends$3({boxShadow:(o.vars||o).shadows[s.elevation]},!o.vars&&o.palette.mode==="dark"&&{backgroundImage:`linear-gradient(${alpha_1("#fff",getOverlayAlpha(s.elevation))}, ${alpha_1("#fff",getOverlayAlpha(s.elevation))})`},o.vars&&{backgroundImage:(a=o.vars.overlays)==null?void 0:a[s.elevation]}))}),Paper=reactExports.forwardRef(function(s,a){const et=useThemeProps({props:s,name:"MuiPaper"}),{className:tt,component:rt="div",elevation:nt=1,square:it=!1,variant:st="elevation"}=et,ot=_objectWithoutPropertiesLoose$1(et,_excluded$w),at=_extends$3({},et,{component:rt,elevation:nt,square:it,variant:st}),lt=useUtilityClasses$n(at);return jsxRuntimeExports.jsx(PaperRoot,_extends$3({as:rt,ownerState:at,className:clsx(lt.root,tt),ref:a},ot))});function isHostComponent(o){return typeof o=="string"}function appendOwnerState(o,s,a){return o===void 0||isHostComponent(o)?s:_extends$3({},s,{ownerState:_extends$3({},s.ownerState,a)})}function extractEventHandlers(o,s=[]){if(o===void 0)return{};const a={};return Object.keys(o).filter(et=>et.match(/^on[A-Z]/)&&typeof o[et]=="function"&&!s.includes(et)).forEach(et=>{a[et]=o[et]}),a}function resolveComponentProps(o,s,a){return typeof o=="function"?o(s,a):o}function omitEventHandlers(o){if(o===void 0)return{};const s={};return Object.keys(o).filter(a=>!(a.match(/^on[A-Z]/)&&typeof o[a]=="function")).forEach(a=>{s[a]=o[a]}),s}function mergeSlotProps(o){const{getSlotProps:s,additionalProps:a,externalSlotProps:et,externalForwardedProps:tt,className:rt}=o;if(!s){const ht=clsx(a?.className,rt,tt?.className,et?.className),ft=_extends$3({},a?.style,tt?.style,et?.style),dt=_extends$3({},a,tt,et);return ht.length>0&&(dt.className=ht),Object.keys(ft).length>0&&(dt.style=ft),{props:dt,internalRef:void 0}}const nt=extractEventHandlers(_extends$3({},tt,et)),it=omitEventHandlers(et),st=omitEventHandlers(tt),ot=s(nt),at=clsx(ot?.className,a?.className,rt,tt?.className,et?.className),lt=_extends$3({},ot?.style,a?.style,tt?.style,et?.style),ct=_extends$3({},ot,a,st,it);return at.length>0&&(ct.className=at),Object.keys(lt).length>0&&(ct.style=lt),{props:ct,internalRef:ot.ref}}const _excluded$v=["elementType","externalSlotProps","ownerState","skipResolvingSlotProps"];function useSlotProps(o){var s;const{elementType:a,externalSlotProps:et,ownerState:tt,skipResolvingSlotProps:rt=!1}=o,nt=_objectWithoutPropertiesLoose$1(o,_excluded$v),it=rt?{}:resolveComponentProps(et,tt),{props:st,internalRef:ot}=mergeSlotProps(_extends$3({},nt,{externalSlotProps:it})),at=useForkRef(ot,it?.ref,(s=o.additionalProps)==null?void 0:s.ref);return appendOwnerState(a,_extends$3({},st,{ref:at}),tt)}function Ripple(o){const{className:s,classes:a,pulsate:et=!1,rippleX:tt,rippleY:rt,rippleSize:nt,in:it,onExited:st,timeout:ot}=o,[at,lt]=reactExports.useState(!1),ct=clsx(s,a.ripple,a.rippleVisible,et&&a.ripplePulsate),ht={width:nt,height:nt,top:-(nt/2)+rt,left:-(nt/2)+tt},ft=clsx(a.child,at&&a.childLeaving,et&&a.childPulsate);return!it&&!at&&lt(!0),reactExports.useEffect(()=>{if(!it&&st!=null){const dt=setTimeout(st,ot);return()=>{clearTimeout(dt)}}},[st,it,ot]),jsxRuntimeExports.jsx("span",{className:ct,style:ht,children:jsxRuntimeExports.jsx("span",{className:ft})})}const touchRippleClasses=generateUtilityClasses("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]),_excluded$u=["center","classes","className"];let _$1=o=>o,_t,_t2,_t3,_t4;const DURATION=550,DELAY_RIPPLE=80,enterKeyframe=keyframes(_t||(_t=_$1`
  0% {
    transform: scale(0);
    opacity: 0.1;
  }

  100% {
    transform: scale(1);
    opacity: 0.3;
  }
`)),exitKeyframe=keyframes(_t2||(_t2=_$1`
  0% {
    opacity: 1;
  }

  100% {
    opacity: 0;
  }
`)),pulsateKeyframe=keyframes(_t3||(_t3=_$1`
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(0.92);
  }

  100% {
    transform: scale(1);
  }
`)),TouchRippleRoot=styled("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),TouchRippleRipple=styled(Ripple,{name:"MuiTouchRipple",slot:"Ripple"})(_t4||(_t4=_$1`
  opacity: 0;
  position: absolute;

  &.${0} {
    opacity: 0.3;
    transform: scale(1);
    animation-name: ${0};
    animation-duration: ${0}ms;
    animation-timing-function: ${0};
  }

  &.${0} {
    animation-duration: ${0}ms;
  }

  & .${0} {
    opacity: 1;
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-color: currentColor;
  }

  & .${0} {
    opacity: 0;
    animation-name: ${0};
    animation-duration: ${0}ms;
    animation-timing-function: ${0};
  }

  & .${0} {
    position: absolute;
    /* @noflip */
    left: 0px;
    top: 0;
    animation-name: ${0};
    animation-duration: 2500ms;
    animation-timing-function: ${0};
    animation-iteration-count: infinite;
    animation-delay: 200ms;
  }
`),touchRippleClasses.rippleVisible,enterKeyframe,DURATION,({theme:o})=>o.transitions.easing.easeInOut,touchRippleClasses.ripplePulsate,({theme:o})=>o.transitions.duration.shorter,touchRippleClasses.child,touchRippleClasses.childLeaving,exitKeyframe,DURATION,({theme:o})=>o.transitions.easing.easeInOut,touchRippleClasses.childPulsate,pulsateKeyframe,({theme:o})=>o.transitions.easing.easeInOut),TouchRipple=reactExports.forwardRef(function(s,a){const et=useThemeProps({props:s,name:"MuiTouchRipple"}),{center:tt=!1,classes:rt={},className:nt}=et,it=_objectWithoutPropertiesLoose$1(et,_excluded$u),[st,ot]=reactExports.useState([]),at=reactExports.useRef(0),lt=reactExports.useRef(null);reactExports.useEffect(()=>{lt.current&&(lt.current(),lt.current=null)},[st]);const ct=reactExports.useRef(!1),ht=useTimeout(),ft=reactExports.useRef(null),dt=reactExports.useRef(null),pt=reactExports.useCallback(vt=>{const{pulsate:Et,rippleX:xt,rippleY:wt,rippleSize:Rt,cb:Ct}=vt;ot(Ft=>[...Ft,jsxRuntimeExports.jsx(TouchRippleRipple,{classes:{ripple:clsx(rt.ripple,touchRippleClasses.ripple),rippleVisible:clsx(rt.rippleVisible,touchRippleClasses.rippleVisible),ripplePulsate:clsx(rt.ripplePulsate,touchRippleClasses.ripplePulsate),child:clsx(rt.child,touchRippleClasses.child),childLeaving:clsx(rt.childLeaving,touchRippleClasses.childLeaving),childPulsate:clsx(rt.childPulsate,touchRippleClasses.childPulsate)},timeout:DURATION,pulsate:Et,rippleX:xt,rippleY:wt,rippleSize:Rt},at.current)]),at.current+=1,lt.current=Ct},[rt]),gt=reactExports.useCallback((vt={},Et={},xt=()=>{})=>{const{pulsate:wt=!1,center:Rt=tt||Et.pulsate,fakeElement:Ct=!1}=Et;if(vt?.type==="mousedown"&&ct.current){ct.current=!1;return}vt?.type==="touchstart"&&(ct.current=!0);const Ft=Ct?null:dt.current,zt=Ft?Ft.getBoundingClientRect():{width:0,height:0,left:0,top:0};let Nt,Kt,Yt;if(Rt||vt===void 0||vt.clientX===0&&vt.clientY===0||!vt.clientX&&!vt.touches)Nt=Math.round(zt.width/2),Kt=Math.round(zt.height/2);else{const{clientX:Bt,clientY:Pt}=vt.touches&&vt.touches.length>0?vt.touches[0]:vt;Nt=Math.round(Bt-zt.left),Kt=Math.round(Pt-zt.top)}if(Rt)Yt=Math.sqrt((2*zt.width**2+zt.height**2)/3),Yt%2===0&&(Yt+=1);else{const Bt=Math.max(Math.abs((Ft?Ft.clientWidth:0)-Nt),Nt)*2+2,Pt=Math.max(Math.abs((Ft?Ft.clientHeight:0)-Kt),Kt)*2+2;Yt=Math.sqrt(Bt**2+Pt**2)}vt!=null&&vt.touches?ft.current===null&&(ft.current=()=>{pt({pulsate:wt,rippleX:Nt,rippleY:Kt,rippleSize:Yt,cb:xt})},ht.start(DELAY_RIPPLE,()=>{ft.current&&(ft.current(),ft.current=null)})):pt({pulsate:wt,rippleX:Nt,rippleY:Kt,rippleSize:Yt,cb:xt})},[tt,pt,ht]),mt=reactExports.useCallback(()=>{gt({},{pulsate:!0})},[gt]),yt=reactExports.useCallback((vt,Et)=>{if(ht.clear(),vt?.type==="touchend"&&ft.current){ft.current(),ft.current=null,ht.start(0,()=>{yt(vt,Et)});return}ft.current=null,ot(xt=>xt.length>0?xt.slice(1):xt),lt.current=Et},[ht]);return reactExports.useImperativeHandle(a,()=>({pulsate:mt,start:gt,stop:yt}),[mt,gt,yt]),jsxRuntimeExports.jsx(TouchRippleRoot,_extends$3({className:clsx(touchRippleClasses.root,rt.root,nt),ref:dt},it,{children:jsxRuntimeExports.jsx(TransitionGroup,{component:null,exit:!0,children:st})}))});function getButtonBaseUtilityClass(o){return generateUtilityClass("MuiButtonBase",o)}const buttonBaseClasses=generateUtilityClasses("MuiButtonBase",["root","disabled","focusVisible"]),_excluded$t=["action","centerRipple","children","className","component","disabled","disableRipple","disableTouchRipple","focusRipple","focusVisibleClassName","LinkComponent","onBlur","onClick","onContextMenu","onDragLeave","onFocus","onFocusVisible","onKeyDown","onKeyUp","onMouseDown","onMouseLeave","onMouseUp","onTouchEnd","onTouchMove","onTouchStart","tabIndex","TouchRippleProps","touchRippleRef","type"],useUtilityClasses$m=o=>{const{disabled:s,focusVisible:a,focusVisibleClassName:et,classes:tt}=o,nt=composeClasses({root:["root",s&&"disabled",a&&"focusVisible"]},getButtonBaseUtilityClass,tt);return a&&et&&(nt.root+=` ${et}`),nt},ButtonBaseRoot=styled("button",{name:"MuiButtonBase",slot:"Root",overridesResolver:(o,s)=>s.root})({display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},[`&.${buttonBaseClasses.disabled}`]:{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}}),ButtonBase=reactExports.forwardRef(function(s,a){const et=useThemeProps({props:s,name:"MuiButtonBase"}),{action:tt,centerRipple:rt=!1,children:nt,className:it,component:st="button",disabled:ot=!1,disableRipple:at=!1,disableTouchRipple:lt=!1,focusRipple:ct=!1,LinkComponent:ht="a",onBlur:ft,onClick:dt,onContextMenu:pt,onDragLeave:gt,onFocus:mt,onFocusVisible:yt,onKeyDown:vt,onKeyUp:Et,onMouseDown:xt,onMouseLeave:wt,onMouseUp:Rt,onTouchEnd:Ct,onTouchMove:Ft,onTouchStart:zt,tabIndex:Nt=0,TouchRippleProps:Kt,touchRippleRef:Yt,type:Bt}=et,Pt=_objectWithoutPropertiesLoose$1(et,_excluded$t),Dt=reactExports.useRef(null),Tt=reactExports.useRef(null),St=useForkRef(Tt,Yt),{isFocusVisibleRef:Mt,onFocus:jt,onBlur:Gt,ref:Ht}=useIsFocusVisible(),[At,$t]=reactExports.useState(!1);ot&&At&&$t(!1),reactExports.useImperativeHandle(tt,()=>({focusVisible:()=>{$t(!0),Dt.current.focus()}}),[]);const[kt,Lt]=reactExports.useState(!1);reactExports.useEffect(()=>{Lt(!0)},[]);const bt=kt&&!at&&!ot;reactExports.useEffect(()=>{At&&ct&&!at&&kt&&Tt.current.pulsate()},[at,ct,At,kt]);function It(Sr,$r,Or=lt){return useEventCallback(Nr=>($r&&$r(Nr),!Or&&Tt.current&&Tt.current[Sr](Nr),!0))}const Ut=It("start",xt),Wt=It("stop",pt),Xt=It("stop",gt),Qt=It("stop",Rt),er=It("stop",Sr=>{At&&Sr.preventDefault(),wt&&wt(Sr)}),lr=It("start",zt),pr=It("stop",Ct),gr=It("stop",Ft),wr=It("stop",Sr=>{Gt(Sr),Mt.current===!1&&$t(!1),ft&&ft(Sr)},!1),cr=useEventCallback(Sr=>{Dt.current||(Dt.current=Sr.currentTarget),jt(Sr),Mt.current===!0&&($t(!0),yt&&yt(Sr)),mt&&mt(Sr)}),Cr=()=>{const Sr=Dt.current;return st&&st!=="button"&&!(Sr.tagName==="A"&&Sr.href)},_r=reactExports.useRef(!1),kr=useEventCallback(Sr=>{ct&&!_r.current&&At&&Tt.current&&Sr.key===" "&&(_r.current=!0,Tt.current.stop(Sr,()=>{Tt.current.start(Sr)})),Sr.target===Sr.currentTarget&&Cr()&&Sr.key===" "&&Sr.preventDefault(),vt&&vt(Sr),Sr.target===Sr.currentTarget&&Cr()&&Sr.key==="Enter"&&!ot&&(Sr.preventDefault(),dt&&dt(Sr))}),Ir=useEventCallback(Sr=>{ct&&Sr.key===" "&&Tt.current&&At&&!Sr.defaultPrevented&&(_r.current=!1,Tt.current.stop(Sr,()=>{Tt.current.pulsate(Sr)})),Et&&Et(Sr),dt&&Sr.target===Sr.currentTarget&&Cr()&&Sr.key===" "&&!Sr.defaultPrevented&&dt(Sr)});let tr=st;tr==="button"&&(Pt.href||Pt.to)&&(tr=ht);const sr={};tr==="button"?(sr.type=Bt===void 0?"button":Bt,sr.disabled=ot):(!Pt.href&&!Pt.to&&(sr.role="button"),ot&&(sr["aria-disabled"]=ot));const vr=useForkRef(a,Ht,Dt),xr=_extends$3({},et,{centerRipple:rt,component:st,disabled:ot,disableRipple:at,disableTouchRipple:lt,focusRipple:ct,tabIndex:Nt,focusVisible:At}),Er=useUtilityClasses$m(xr);return jsxRuntimeExports.jsxs(ButtonBaseRoot,_extends$3({as:tr,className:clsx(Er.root,it),ownerState:xr,onBlur:wr,onClick:dt,onContextMenu:Wt,onFocus:cr,onKeyDown:kr,onKeyUp:Ir,onMouseDown:Ut,onMouseLeave:er,onMouseUp:Qt,onDragLeave:Xt,onTouchEnd:pr,onTouchMove:gr,onTouchStart:lr,ref:vr,tabIndex:ot?-1:Nt,type:Bt},sr,Pt,{children:[nt,bt?jsxRuntimeExports.jsx(TouchRipple,_extends$3({ref:St,center:rt},Kt)):null]}))});function getIconButtonUtilityClass(o){return generateUtilityClass("MuiIconButton",o)}const iconButtonClasses=generateUtilityClasses("MuiIconButton",["root","disabled","colorInherit","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","edgeStart","edgeEnd","sizeSmall","sizeMedium","sizeLarge"]),_excluded$s=["edge","children","className","color","disabled","disableFocusRipple","size"],useUtilityClasses$l=o=>{const{classes:s,disabled:a,color:et,edge:tt,size:rt}=o,nt={root:["root",a&&"disabled",et!=="default"&&`color${capitalize$1(et)}`,tt&&`edge${capitalize$1(tt)}`,`size${capitalize$1(rt)}`]};return composeClasses(nt,getIconButtonUtilityClass,s)},IconButtonRoot=styled(ButtonBase,{name:"MuiIconButton",slot:"Root",overridesResolver:(o,s)=>{const{ownerState:a}=o;return[s.root,a.color!=="default"&&s[`color${capitalize$1(a.color)}`],a.edge&&s[`edge${capitalize$1(a.edge)}`],s[`size${capitalize$1(a.size)}`]]}})(({theme:o,ownerState:s})=>_extends$3({textAlign:"center",flex:"0 0 auto",fontSize:o.typography.pxToRem(24),padding:8,borderRadius:"50%",overflow:"visible",color:(o.vars||o).palette.action.active,transition:o.transitions.create("background-color",{duration:o.transitions.duration.shortest})},!s.disableRipple&&{"&:hover":{backgroundColor:o.vars?`rgba(${o.vars.palette.action.activeChannel} / ${o.vars.palette.action.hoverOpacity})`:alpha_1(o.palette.action.active,o.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},s.edge==="start"&&{marginLeft:s.size==="small"?-3:-12},s.edge==="end"&&{marginRight:s.size==="small"?-3:-12}),({theme:o,ownerState:s})=>{var a;const et=(a=(o.vars||o).palette)==null?void 0:a[s.color];return _extends$3({},s.color==="inherit"&&{color:"inherit"},s.color!=="inherit"&&s.color!=="default"&&_extends$3({color:et?.main},!s.disableRipple&&{"&:hover":_extends$3({},et&&{backgroundColor:o.vars?`rgba(${et.mainChannel} / ${o.vars.palette.action.hoverOpacity})`:alpha_1(et.main,o.palette.action.hoverOpacity)},{"@media (hover: none)":{backgroundColor:"transparent"}})}),s.size==="small"&&{padding:5,fontSize:o.typography.pxToRem(18)},s.size==="large"&&{padding:12,fontSize:o.typography.pxToRem(28)},{[`&.${iconButtonClasses.disabled}`]:{backgroundColor:"transparent",color:(o.vars||o).palette.action.disabled}})}),IconButton=reactExports.forwardRef(function(s,a){const et=useThemeProps({props:s,name:"MuiIconButton"}),{edge:tt=!1,children:rt,className:nt,color:it="default",disabled:st=!1,disableFocusRipple:ot=!1,size:at="medium"}=et,lt=_objectWithoutPropertiesLoose$1(et,_excluded$s),ct=_extends$3({},et,{edge:tt,color:it,disabled:st,disableFocusRipple:ot,size:at}),ht=useUtilityClasses$l(ct);return jsxRuntimeExports.jsx(IconButtonRoot,_extends$3({className:clsx(ht.root,nt),centerRipple:!0,focusRipple:!ot,disabled:st,ref:a},lt,{ownerState:ct,children:rt}))});function getTypographyUtilityClass(o){return generateUtilityClass("MuiTypography",o)}generateUtilityClasses("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]);const _excluded$r=["align","className","component","gutterBottom","noWrap","paragraph","variant","variantMapping"],useUtilityClasses$k=o=>{const{align:s,gutterBottom:a,noWrap:et,paragraph:tt,variant:rt,classes:nt}=o,it={root:["root",rt,o.align!=="inherit"&&`align${capitalize$1(s)}`,a&&"gutterBottom",et&&"noWrap",tt&&"paragraph"]};return composeClasses(it,getTypographyUtilityClass,nt)},TypographyRoot=styled("span",{name:"MuiTypography",slot:"Root",overridesResolver:(o,s)=>{const{ownerState:a}=o;return[s.root,a.variant&&s[a.variant],a.align!=="inherit"&&s[`align${capitalize$1(a.align)}`],a.noWrap&&s.noWrap,a.gutterBottom&&s.gutterBottom,a.paragraph&&s.paragraph]}})(({theme:o,ownerState:s})=>_extends$3({margin:0},s.variant==="inherit"&&{font:"inherit"},s.variant!=="inherit"&&o.typography[s.variant],s.align!=="inherit"&&{textAlign:s.align},s.noWrap&&{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},s.gutterBottom&&{marginBottom:"0.35em"},s.paragraph&&{marginBottom:16})),defaultVariantMapping={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},colorTransformations={primary:"primary.main",textPrimary:"text.primary",secondary:"secondary.main",textSecondary:"text.secondary",error:"error.main"},transformDeprecatedColors=o=>colorTransformations[o]||o,Typography=reactExports.forwardRef(function(s,a){const et=useThemeProps({props:s,name:"MuiTypography"}),tt=transformDeprecatedColors(et.color),rt=extendSxProp(_extends$3({},et,{color:tt})),{align:nt="inherit",className:it,component:st,gutterBottom:ot=!1,noWrap:at=!1,paragraph:lt=!1,variant:ct="body1",variantMapping:ht=defaultVariantMapping}=rt,ft=_objectWithoutPropertiesLoose$1(rt,_excluded$r),dt=_extends$3({},rt,{align:nt,color:tt,className:it,component:st,gutterBottom:ot,noWrap:at,paragraph:lt,variant:ct,variantMapping:ht}),pt=st||(lt?"p":ht[ct]||defaultVariantMapping[ct])||"span",gt=useUtilityClasses$k(dt);return jsxRuntimeExports.jsx(TypographyRoot,_extends$3({as:pt,ref:a,ownerState:dt,className:clsx(gt.root,it)},ft))}),candidatesSelector=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'].join(",");function getTabIndex(o){const s=parseInt(o.getAttribute("tabindex")||"",10);return Number.isNaN(s)?o.contentEditable==="true"||(o.nodeName==="AUDIO"||o.nodeName==="VIDEO"||o.nodeName==="DETAILS")&&o.getAttribute("tabindex")===null?0:o.tabIndex:s}function isNonTabbableRadio(o){if(o.tagName!=="INPUT"||o.type!=="radio"||!o.name)return!1;const s=et=>o.ownerDocument.querySelector(`input[type="radio"]${et}`);let a=s(`[name="${o.name}"]:checked`);return a||(a=s(`[name="${o.name}"]`)),a!==o}function isNodeMatchingSelectorFocusable(o){return!(o.disabled||o.tagName==="INPUT"&&o.type==="hidden"||isNonTabbableRadio(o))}function defaultGetTabbable(o){const s=[],a=[];return Array.from(o.querySelectorAll(candidatesSelector)).forEach((et,tt)=>{const rt=getTabIndex(et);rt===-1||!isNodeMatchingSelectorFocusable(et)||(rt===0?s.push(et):a.push({documentOrder:tt,tabIndex:rt,node:et}))}),a.sort((et,tt)=>et.tabIndex===tt.tabIndex?et.documentOrder-tt.documentOrder:et.tabIndex-tt.tabIndex).map(et=>et.node).concat(s)}function defaultIsEnabled(){return!0}function FocusTrap(o){const{children:s,disableAutoFocus:a=!1,disableEnforceFocus:et=!1,disableRestoreFocus:tt=!1,getTabbable:rt=defaultGetTabbable,isEnabled:nt=defaultIsEnabled,open:it}=o,st=reactExports.useRef(!1),ot=reactExports.useRef(null),at=reactExports.useRef(null),lt=reactExports.useRef(null),ct=reactExports.useRef(null),ht=reactExports.useRef(!1),ft=reactExports.useRef(null),dt=useForkRef(s.ref,ft),pt=reactExports.useRef(null);reactExports.useEffect(()=>{!it||!ft.current||(ht.current=!a)},[a,it]),reactExports.useEffect(()=>{if(!it||!ft.current)return;const yt=ownerDocument(ft.current);return ft.current.contains(yt.activeElement)||(ft.current.hasAttribute("tabIndex")||ft.current.setAttribute("tabIndex","-1"),ht.current&&ft.current.focus()),()=>{tt||(lt.current&&lt.current.focus&&(st.current=!0,lt.current.focus()),lt.current=null)}},[it]),reactExports.useEffect(()=>{if(!it||!ft.current)return;const yt=ownerDocument(ft.current),vt=wt=>{pt.current=wt,!(et||!nt()||wt.key!=="Tab")&&yt.activeElement===ft.current&&wt.shiftKey&&(st.current=!0,at.current&&at.current.focus())},Et=()=>{const wt=ft.current;if(wt===null)return;if(!yt.hasFocus()||!nt()||st.current){st.current=!1;return}if(wt.contains(yt.activeElement)||et&&yt.activeElement!==ot.current&&yt.activeElement!==at.current)return;if(yt.activeElement!==ct.current)ct.current=null;else if(ct.current!==null)return;if(!ht.current)return;let Rt=[];if((yt.activeElement===ot.current||yt.activeElement===at.current)&&(Rt=rt(ft.current)),Rt.length>0){var Ct,Ft;const zt=!!((Ct=pt.current)!=null&&Ct.shiftKey&&((Ft=pt.current)==null?void 0:Ft.key)==="Tab"),Nt=Rt[0],Kt=Rt[Rt.length-1];typeof Nt!="string"&&typeof Kt!="string"&&(zt?Kt.focus():Nt.focus())}else wt.focus()};yt.addEventListener("focusin",Et),yt.addEventListener("keydown",vt,!0);const xt=setInterval(()=>{yt.activeElement&&yt.activeElement.tagName==="BODY"&&Et()},50);return()=>{clearInterval(xt),yt.removeEventListener("focusin",Et),yt.removeEventListener("keydown",vt,!0)}},[a,et,tt,nt,it,rt]);const gt=yt=>{lt.current===null&&(lt.current=yt.relatedTarget),ht.current=!0,ct.current=yt.target;const vt=s.props.onFocus;vt&&vt(yt)},mt=yt=>{lt.current===null&&(lt.current=yt.relatedTarget),ht.current=!0};return jsxRuntimeExports.jsxs(reactExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{tabIndex:it?0:-1,onFocus:mt,ref:ot,"data-testid":"sentinelStart"}),reactExports.cloneElement(s,{ref:dt,onFocus:gt}),jsxRuntimeExports.jsx("div",{tabIndex:it?0:-1,onFocus:mt,ref:at,"data-testid":"sentinelEnd"})]})}function getContainer$1(o){return typeof o=="function"?o():o}const Portal=reactExports.forwardRef(function(s,a){const{children:et,container:tt,disablePortal:rt=!1}=s,[nt,it]=reactExports.useState(null),st=useForkRef(reactExports.isValidElement(et)?et.ref:null,a);if(useEnhancedEffect(()=>{rt||it(getContainer$1(tt)||document.body)},[tt,rt]),useEnhancedEffect(()=>{if(nt&&!rt)return setRef(a,nt),()=>{setRef(a,null)}},[a,nt,rt]),rt){if(reactExports.isValidElement(et)){const ot={ref:st};return reactExports.cloneElement(et,ot)}return jsxRuntimeExports.jsx(reactExports.Fragment,{children:et})}return jsxRuntimeExports.jsx(reactExports.Fragment,{children:nt&&reactDomExports.createPortal(et,nt)})});function isOverflowing(o){const s=ownerDocument(o);return s.body===o?ownerWindow(o).innerWidth>s.documentElement.clientWidth:o.scrollHeight>o.clientHeight}function ariaHidden(o,s){s?o.setAttribute("aria-hidden","true"):o.removeAttribute("aria-hidden")}function getPaddingRight(o){return parseInt(ownerWindow(o).getComputedStyle(o).paddingRight,10)||0}function isAriaHiddenForbiddenOnElement(o){const a=["TEMPLATE","SCRIPT","STYLE","LINK","MAP","META","NOSCRIPT","PICTURE","COL","COLGROUP","PARAM","SLOT","SOURCE","TRACK"].indexOf(o.tagName)!==-1,et=o.tagName==="INPUT"&&o.getAttribute("type")==="hidden";return a||et}function ariaHiddenSiblings(o,s,a,et,tt){const rt=[s,a,...et];[].forEach.call(o.children,nt=>{const it=rt.indexOf(nt)===-1,st=!isAriaHiddenForbiddenOnElement(nt);it&&st&&ariaHidden(nt,tt)})}function findIndexOf(o,s){let a=-1;return o.some((et,tt)=>s(et)?(a=tt,!0):!1),a}function handleContainer(o,s){const a=[],et=o.container;if(!s.disableScrollLock){if(isOverflowing(et)){const nt=getScrollbarSize$1(ownerDocument(et));a.push({value:et.style.paddingRight,property:"padding-right",el:et}),et.style.paddingRight=`${getPaddingRight(et)+nt}px`;const it=ownerDocument(et).querySelectorAll(".mui-fixed");[].forEach.call(it,st=>{a.push({value:st.style.paddingRight,property:"padding-right",el:st}),st.style.paddingRight=`${getPaddingRight(st)+nt}px`})}let rt;if(et.parentNode instanceof DocumentFragment)rt=ownerDocument(et).body;else{const nt=et.parentElement,it=ownerWindow(et);rt=nt?.nodeName==="HTML"&&it.getComputedStyle(nt).overflowY==="scroll"?nt:et}a.push({value:rt.style.overflow,property:"overflow",el:rt},{value:rt.style.overflowX,property:"overflow-x",el:rt},{value:rt.style.overflowY,property:"overflow-y",el:rt}),rt.style.overflow="hidden"}return()=>{a.forEach(({value:rt,el:nt,property:it})=>{rt?nt.style.setProperty(it,rt):nt.style.removeProperty(it)})}}function getHiddenSiblings(o){const s=[];return[].forEach.call(o.children,a=>{a.getAttribute("aria-hidden")==="true"&&s.push(a)}),s}class ModalManager{constructor(){this.containers=void 0,this.modals=void 0,this.modals=[],this.containers=[]}add(s,a){let et=this.modals.indexOf(s);if(et!==-1)return et;et=this.modals.length,this.modals.push(s),s.modalRef&&ariaHidden(s.modalRef,!1);const tt=getHiddenSiblings(a);ariaHiddenSiblings(a,s.mount,s.modalRef,tt,!0);const rt=findIndexOf(this.containers,nt=>nt.container===a);return rt!==-1?(this.containers[rt].modals.push(s),et):(this.containers.push({modals:[s],container:a,restore:null,hiddenSiblings:tt}),et)}mount(s,a){const et=findIndexOf(this.containers,rt=>rt.modals.indexOf(s)!==-1),tt=this.containers[et];tt.restore||(tt.restore=handleContainer(tt,a))}remove(s,a=!0){const et=this.modals.indexOf(s);if(et===-1)return et;const tt=findIndexOf(this.containers,nt=>nt.modals.indexOf(s)!==-1),rt=this.containers[tt];if(rt.modals.splice(rt.modals.indexOf(s),1),this.modals.splice(et,1),rt.modals.length===0)rt.restore&&rt.restore(),s.modalRef&&ariaHidden(s.modalRef,a),ariaHiddenSiblings(rt.container,s.mount,s.modalRef,rt.hiddenSiblings,!1),this.containers.splice(tt,1);else{const nt=rt.modals[rt.modals.length-1];nt.modalRef&&ariaHidden(nt.modalRef,!1)}return et}isTopModal(s){return this.modals.length>0&&this.modals[this.modals.length-1]===s}}function getContainer(o){return typeof o=="function"?o():o}function getHasTransition(o){return o?o.props.hasOwnProperty("in"):!1}const defaultManager=new ModalManager;function useModal(o){const{container:s,disableEscapeKeyDown:a=!1,disableScrollLock:et=!1,manager:tt=defaultManager,closeAfterTransition:rt=!1,onTransitionEnter:nt,onTransitionExited:it,children:st,onClose:ot,open:at,rootRef:lt}=o,ct=reactExports.useRef({}),ht=reactExports.useRef(null),ft=reactExports.useRef(null),dt=useForkRef(ft,lt),[pt,gt]=reactExports.useState(!at),mt=getHasTransition(st);let yt=!0;(o["aria-hidden"]==="false"||o["aria-hidden"]===!1)&&(yt=!1);const vt=()=>ownerDocument(ht.current),Et=()=>(ct.current.modalRef=ft.current,ct.current.mount=ht.current,ct.current),xt=()=>{tt.mount(Et(),{disableScrollLock:et}),ft.current&&(ft.current.scrollTop=0)},wt=useEventCallback(()=>{const Pt=getContainer(s)||vt().body;tt.add(Et(),Pt),ft.current&&xt()}),Rt=reactExports.useCallback(()=>tt.isTopModal(Et()),[tt]),Ct=useEventCallback(Pt=>{ht.current=Pt,Pt&&(at&&Rt()?xt():ft.current&&ariaHidden(ft.current,yt))}),Ft=reactExports.useCallback(()=>{tt.remove(Et(),yt)},[yt,tt]);reactExports.useEffect(()=>()=>{Ft()},[Ft]),reactExports.useEffect(()=>{at?wt():(!mt||!rt)&&Ft()},[at,Ft,mt,rt,wt]);const zt=Pt=>Dt=>{var Tt;(Tt=Pt.onKeyDown)==null||Tt.call(Pt,Dt),!(Dt.key!=="Escape"||Dt.which===229||!Rt())&&(a||(Dt.stopPropagation(),ot&&ot(Dt,"escapeKeyDown")))},Nt=Pt=>Dt=>{var Tt;(Tt=Pt.onClick)==null||Tt.call(Pt,Dt),Dt.target===Dt.currentTarget&&ot&&ot(Dt,"backdropClick")};return{getRootProps:(Pt={})=>{const Dt=extractEventHandlers(o);delete Dt.onTransitionEnter,delete Dt.onTransitionExited;const Tt=_extends$3({},Dt,Pt);return _extends$3({role:"presentation"},Tt,{onKeyDown:zt(Tt),ref:dt})},getBackdropProps:(Pt={})=>{const Dt=Pt;return _extends$3({"aria-hidden":!0},Dt,{onClick:Nt(Dt),open:at})},getTransitionProps:()=>{const Pt=()=>{gt(!1),nt&&nt()},Dt=()=>{gt(!0),it&&it(),rt&&Ft()};return{onEnter:createChainedFunction(Pt,st?.props.onEnter),onExited:createChainedFunction(Dt,st?.props.onExited)}},rootRef:dt,portalRef:Ct,isTopModal:Rt,exited:pt,hasTransition:mt}}const _excluded$q=["onChange","maxRows","minRows","style","value"];function getStyleValue(o){return parseInt(o,10)||0}const styles$3={shadow:{visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"}};function isEmpty$3(o){return o==null||Object.keys(o).length===0||o.outerHeightStyle===0&&!o.overflowing}const TextareaAutosize=reactExports.forwardRef(function(s,a){const{onChange:et,maxRows:tt,minRows:rt=1,style:nt,value:it}=s,st=_objectWithoutPropertiesLoose$1(s,_excluded$q),{current:ot}=reactExports.useRef(it!=null),at=reactExports.useRef(null),lt=useForkRef(a,at),ct=reactExports.useRef(null),ht=reactExports.useCallback(()=>{const pt=at.current,mt=ownerWindow(pt).getComputedStyle(pt);if(mt.width==="0px")return{outerHeightStyle:0,overflowing:!1};const yt=ct.current;yt.style.width=mt.width,yt.value=pt.value||s.placeholder||"x",yt.value.slice(-1)===`
`&&(yt.value+=" ");const vt=mt.boxSizing,Et=getStyleValue(mt.paddingBottom)+getStyleValue(mt.paddingTop),xt=getStyleValue(mt.borderBottomWidth)+getStyleValue(mt.borderTopWidth),wt=yt.scrollHeight;yt.value="x";const Rt=yt.scrollHeight;let Ct=wt;rt&&(Ct=Math.max(Number(rt)*Rt,Ct)),tt&&(Ct=Math.min(Number(tt)*Rt,Ct)),Ct=Math.max(Ct,Rt);const Ft=Ct+(vt==="border-box"?Et+xt:0),zt=Math.abs(Ct-wt)<=1;return{outerHeightStyle:Ft,overflowing:zt}},[tt,rt,s.placeholder]),ft=reactExports.useCallback(()=>{const pt=ht();if(isEmpty$3(pt))return;const gt=at.current;gt.style.height=`${pt.outerHeightStyle}px`,gt.style.overflow=pt.overflowing?"hidden":""},[ht]);useEnhancedEffect(()=>{const pt=()=>{ft()};let gt;const mt=debounce(pt),yt=at.current,vt=ownerWindow(yt);vt.addEventListener("resize",mt);let Et;return typeof ResizeObserver<"u"&&(Et=new ResizeObserver(pt),Et.observe(yt)),()=>{mt.clear(),cancelAnimationFrame(gt),vt.removeEventListener("resize",mt),Et&&Et.disconnect()}},[ht,ft]),useEnhancedEffect(()=>{ft()});const dt=pt=>{ot||ft(),et&&et(pt)};return jsxRuntimeExports.jsxs(reactExports.Fragment,{children:[jsxRuntimeExports.jsx("textarea",_extends$3({value:it,onChange:dt,ref:lt,rows:rt,style:nt},st)),jsxRuntimeExports.jsx("textarea",{"aria-hidden":!0,className:s.className,readOnly:!0,ref:ct,tabIndex:-1,style:_extends$3({},styles$3.shadow,nt,{paddingTop:0,paddingBottom:0})})]})});function formControlState({props:o,states:s,muiFormControl:a}){return s.reduce((et,tt)=>(et[tt]=o[tt],a&&typeof o[tt]>"u"&&(et[tt]=a[tt]),et),{})}const FormControlContext=reactExports.createContext(void 0);function useFormControl(){return reactExports.useContext(FormControlContext)}function GlobalStyles(o){return jsxRuntimeExports.jsx(GlobalStyles$1,_extends$3({},o,{defaultTheme:defaultTheme$1,themeId:THEME_ID}))}function hasValue(o){return o!=null&&!(Array.isArray(o)&&o.length===0)}function isFilled(o,s=!1){return o&&(hasValue(o.value)&&o.value!==""||s&&hasValue(o.defaultValue)&&o.defaultValue!=="")}function isAdornedStart(o){return o.startAdornment}function getInputBaseUtilityClass(o){return generateUtilityClass("MuiInputBase",o)}const inputBaseClasses=generateUtilityClasses("MuiInputBase",["root","formControl","focused","disabled","adornedStart","adornedEnd","error","sizeSmall","multiline","colorSecondary","fullWidth","hiddenLabel","readOnly","input","inputSizeSmall","inputMultiline","inputTypeSearch","inputAdornedStart","inputAdornedEnd","inputHiddenLabel"]),_excluded$p=["aria-describedby","autoComplete","autoFocus","className","color","components","componentsProps","defaultValue","disabled","disableInjectingGlobalStyles","endAdornment","error","fullWidth","id","inputComponent","inputProps","inputRef","margin","maxRows","minRows","multiline","name","onBlur","onChange","onClick","onFocus","onKeyDown","onKeyUp","placeholder","readOnly","renderSuffix","rows","size","slotProps","slots","startAdornment","type","value"],rootOverridesResolver=(o,s)=>{const{ownerState:a}=o;return[s.root,a.formControl&&s.formControl,a.startAdornment&&s.adornedStart,a.endAdornment&&s.adornedEnd,a.error&&s.error,a.size==="small"&&s.sizeSmall,a.multiline&&s.multiline,a.color&&s[`color${capitalize$1(a.color)}`],a.fullWidth&&s.fullWidth,a.hiddenLabel&&s.hiddenLabel]},inputOverridesResolver=(o,s)=>{const{ownerState:a}=o;return[s.input,a.size==="small"&&s.inputSizeSmall,a.multiline&&s.inputMultiline,a.type==="search"&&s.inputTypeSearch,a.startAdornment&&s.inputAdornedStart,a.endAdornment&&s.inputAdornedEnd,a.hiddenLabel&&s.inputHiddenLabel]},useUtilityClasses$j=o=>{const{classes:s,color:a,disabled:et,error:tt,endAdornment:rt,focused:nt,formControl:it,fullWidth:st,hiddenLabel:ot,multiline:at,readOnly:lt,size:ct,startAdornment:ht,type:ft}=o,dt={root:["root",`color${capitalize$1(a)}`,et&&"disabled",tt&&"error",st&&"fullWidth",nt&&"focused",it&&"formControl",ct&&ct!=="medium"&&`size${capitalize$1(ct)}`,at&&"multiline",ht&&"adornedStart",rt&&"adornedEnd",ot&&"hiddenLabel",lt&&"readOnly"],input:["input",et&&"disabled",ft==="search"&&"inputTypeSearch",at&&"inputMultiline",ct==="small"&&"inputSizeSmall",ot&&"inputHiddenLabel",ht&&"inputAdornedStart",rt&&"inputAdornedEnd",lt&&"readOnly"]};return composeClasses(dt,getInputBaseUtilityClass,s)},InputBaseRoot=styled("div",{name:"MuiInputBase",slot:"Root",overridesResolver:rootOverridesResolver})(({theme:o,ownerState:s})=>_extends$3({},o.typography.body1,{color:(o.vars||o).palette.text.primary,lineHeight:"1.4375em",boxSizing:"border-box",position:"relative",cursor:"text",display:"inline-flex",alignItems:"center",[`&.${inputBaseClasses.disabled}`]:{color:(o.vars||o).palette.text.disabled,cursor:"default"}},s.multiline&&_extends$3({padding:"4px 0 5px"},s.size==="small"&&{paddingTop:1}),s.fullWidth&&{width:"100%"})),InputBaseComponent=styled("input",{name:"MuiInputBase",slot:"Input",overridesResolver:inputOverridesResolver})(({theme:o,ownerState:s})=>{const a=o.palette.mode==="light",et=_extends$3({color:"currentColor"},o.vars?{opacity:o.vars.opacity.inputPlaceholder}:{opacity:a?.42:.5},{transition:o.transitions.create("opacity",{duration:o.transitions.duration.shorter})}),tt={opacity:"0 !important"},rt=o.vars?{opacity:o.vars.opacity.inputPlaceholder}:{opacity:a?.42:.5};return _extends$3({font:"inherit",letterSpacing:"inherit",color:"currentColor",padding:"4px 0 5px",border:0,boxSizing:"content-box",background:"none",height:"1.4375em",margin:0,WebkitTapHighlightColor:"transparent",display:"block",minWidth:0,width:"100%",animationName:"mui-auto-fill-cancel",animationDuration:"10ms","&::-webkit-input-placeholder":et,"&::-moz-placeholder":et,"&:-ms-input-placeholder":et,"&::-ms-input-placeholder":et,"&:focus":{outline:0},"&:invalid":{boxShadow:"none"},"&::-webkit-search-decoration":{WebkitAppearance:"none"},[`label[data-shrink=false] + .${inputBaseClasses.formControl} &`]:{"&::-webkit-input-placeholder":tt,"&::-moz-placeholder":tt,"&:-ms-input-placeholder":tt,"&::-ms-input-placeholder":tt,"&:focus::-webkit-input-placeholder":rt,"&:focus::-moz-placeholder":rt,"&:focus:-ms-input-placeholder":rt,"&:focus::-ms-input-placeholder":rt},[`&.${inputBaseClasses.disabled}`]:{opacity:1,WebkitTextFillColor:(o.vars||o).palette.text.disabled},"&:-webkit-autofill":{animationDuration:"5000s",animationName:"mui-auto-fill"}},s.size==="small"&&{paddingTop:1},s.multiline&&{height:"auto",resize:"none",padding:0,paddingTop:0},s.type==="search"&&{MozAppearance:"textfield"})}),inputGlobalStyles=jsxRuntimeExports.jsx(GlobalStyles,{styles:{"@keyframes mui-auto-fill":{from:{display:"block"}},"@keyframes mui-auto-fill-cancel":{from:{display:"block"}}}}),InputBase=reactExports.forwardRef(function(s,a){var et;const tt=useThemeProps({props:s,name:"MuiInputBase"}),{"aria-describedby":rt,autoComplete:nt,autoFocus:it,className:st,components:ot={},componentsProps:at={},defaultValue:lt,disabled:ct,disableInjectingGlobalStyles:ht,endAdornment:ft,fullWidth:dt=!1,id:pt,inputComponent:gt="input",inputProps:mt={},inputRef:yt,maxRows:vt,minRows:Et,multiline:xt=!1,name:wt,onBlur:Rt,onChange:Ct,onClick:Ft,onFocus:zt,onKeyDown:Nt,onKeyUp:Kt,placeholder:Yt,readOnly:Bt,renderSuffix:Pt,rows:Dt,slotProps:Tt={},slots:St={},startAdornment:Mt,type:jt="text",value:Gt}=tt,Ht=_objectWithoutPropertiesLoose$1(tt,_excluded$p),At=mt.value!=null?mt.value:Gt,{current:$t}=reactExports.useRef(At!=null),kt=reactExports.useRef(),Lt=reactExports.useCallback(Er=>{},[]),bt=useForkRef(kt,yt,mt.ref,Lt),[It,Ut]=reactExports.useState(!1),Wt=useFormControl(),Xt=formControlState({props:tt,muiFormControl:Wt,states:["color","disabled","error","hiddenLabel","size","required","filled"]});Xt.focused=Wt?Wt.focused:It,reactExports.useEffect(()=>{!Wt&&ct&&It&&(Ut(!1),Rt&&Rt())},[Wt,ct,It,Rt]);const Qt=Wt&&Wt.onFilled,er=Wt&&Wt.onEmpty,lr=reactExports.useCallback(Er=>{isFilled(Er)?Qt&&Qt():er&&er()},[Qt,er]);useEnhancedEffect(()=>{$t&&lr({value:At})},[At,lr,$t]);const pr=Er=>{if(Xt.disabled){Er.stopPropagation();return}zt&&zt(Er),mt.onFocus&&mt.onFocus(Er),Wt&&Wt.onFocus?Wt.onFocus(Er):Ut(!0)},gr=Er=>{Rt&&Rt(Er),mt.onBlur&&mt.onBlur(Er),Wt&&Wt.onBlur?Wt.onBlur(Er):Ut(!1)},wr=(Er,...Sr)=>{if(!$t){const $r=Er.target||kt.current;if($r==null)throw new Error(formatMuiErrorMessage$1(1));lr({value:$r.value})}mt.onChange&&mt.onChange(Er,...Sr),Ct&&Ct(Er,...Sr)};reactExports.useEffect(()=>{lr(kt.current)},[]);const cr=Er=>{kt.current&&Er.currentTarget===Er.target&&kt.current.focus(),Ft&&Ft(Er)};let Cr=gt,_r=mt;xt&&Cr==="input"&&(Dt?_r=_extends$3({type:void 0,minRows:Dt,maxRows:Dt},_r):_r=_extends$3({type:void 0,maxRows:vt,minRows:Et},_r),Cr=TextareaAutosize);const kr=Er=>{lr(Er.animationName==="mui-auto-fill-cancel"?kt.current:{value:"x"})};reactExports.useEffect(()=>{Wt&&Wt.setAdornedStart(!!Mt)},[Wt,Mt]);const Ir=_extends$3({},tt,{color:Xt.color||"primary",disabled:Xt.disabled,endAdornment:ft,error:Xt.error,focused:Xt.focused,formControl:Wt,fullWidth:dt,hiddenLabel:Xt.hiddenLabel,multiline:xt,size:Xt.size,startAdornment:Mt,type:jt}),tr=useUtilityClasses$j(Ir),sr=St.root||ot.Root||InputBaseRoot,vr=Tt.root||at.root||{},xr=St.input||ot.Input||InputBaseComponent;return _r=_extends$3({},_r,(et=Tt.input)!=null?et:at.input),jsxRuntimeExports.jsxs(reactExports.Fragment,{children:[!ht&&inputGlobalStyles,jsxRuntimeExports.jsxs(sr,_extends$3({},vr,!isHostComponent(sr)&&{ownerState:_extends$3({},Ir,vr.ownerState)},{ref:a,onClick:cr},Ht,{className:clsx(tr.root,vr.className,st,Bt&&"MuiInputBase-readOnly"),children:[Mt,jsxRuntimeExports.jsx(FormControlContext.Provider,{value:null,children:jsxRuntimeExports.jsx(xr,_extends$3({ownerState:Ir,"aria-invalid":Xt.error,"aria-describedby":rt,autoComplete:nt,autoFocus:it,defaultValue:lt,disabled:Xt.disabled,id:pt,onAnimationStart:kr,name:wt,placeholder:Yt,readOnly:Bt,required:Xt.required,rows:Dt,value:At,onKeyDown:Nt,onKeyUp:Kt,type:jt},_r,!isHostComponent(xr)&&{as:Cr,ownerState:_extends$3({},Ir,_r.ownerState)},{ref:bt,className:clsx(tr.input,_r.className,Bt&&"MuiInputBase-readOnly"),onBlur:gr,onChange:wr,onFocus:pr}))}),ft,Pt?Pt(_extends$3({},Xt,{startAdornment:Mt})):null]}))]})}),InputBase$1=InputBase;function getInputUtilityClass(o){return generateUtilityClass("MuiInput",o)}const inputClasses=_extends$3({},inputBaseClasses,generateUtilityClasses("MuiInput",["root","underline","input"]));function getOutlinedInputUtilityClass(o){return generateUtilityClass("MuiOutlinedInput",o)}const outlinedInputClasses=_extends$3({},inputBaseClasses,generateUtilityClasses("MuiOutlinedInput",["root","notchedOutline","input"]));function getFilledInputUtilityClass(o){return generateUtilityClass("MuiFilledInput",o)}const filledInputClasses=_extends$3({},inputBaseClasses,generateUtilityClasses("MuiFilledInput",["root","underline","input"])),ArrowDropDownIcon=createSvgIcon$1(jsxRuntimeExports.jsx("path",{d:"M7 10l5 5 5-5z"}),"ArrowDropDown"),_excluded$o=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"],styles$2={entering:{opacity:1},entered:{opacity:1}},Fade=reactExports.forwardRef(function(s,a){const et=useTheme(),tt={enter:et.transitions.duration.enteringScreen,exit:et.transitions.duration.leavingScreen},{addEndListener:rt,appear:nt=!0,children:it,easing:st,in:ot,onEnter:at,onEntered:lt,onEntering:ct,onExit:ht,onExited:ft,onExiting:dt,style:pt,timeout:gt=tt,TransitionComponent:mt=Transition}=s,yt=_objectWithoutPropertiesLoose$1(s,_excluded$o),vt=reactExports.useRef(null),Et=useForkRef(vt,it.ref,a),xt=Yt=>Bt=>{if(Yt){const Pt=vt.current;Bt===void 0?Yt(Pt):Yt(Pt,Bt)}},wt=xt(ct),Rt=xt((Yt,Bt)=>{reflow(Yt);const Pt=getTransitionProps({style:pt,timeout:gt,easing:st},{mode:"enter"});Yt.style.webkitTransition=et.transitions.create("opacity",Pt),Yt.style.transition=et.transitions.create("opacity",Pt),at&&at(Yt,Bt)}),Ct=xt(lt),Ft=xt(dt),zt=xt(Yt=>{const Bt=getTransitionProps({style:pt,timeout:gt,easing:st},{mode:"exit"});Yt.style.webkitTransition=et.transitions.create("opacity",Bt),Yt.style.transition=et.transitions.create("opacity",Bt),ht&&ht(Yt)}),Nt=xt(ft),Kt=Yt=>{rt&&rt(vt.current,Yt)};return jsxRuntimeExports.jsx(mt,_extends$3({appear:nt,in:ot,nodeRef:vt,onEnter:Rt,onEntered:Ct,onEntering:wt,onExit:zt,onExited:Nt,onExiting:Ft,addEndListener:Kt,timeout:gt},yt,{children:(Yt,Bt)=>reactExports.cloneElement(it,_extends$3({style:_extends$3({opacity:0,visibility:Yt==="exited"&&!ot?"hidden":void 0},styles$2[Yt],pt,it.props.style),ref:Et},Bt))}))});function getBackdropUtilityClass(o){return generateUtilityClass("MuiBackdrop",o)}generateUtilityClasses("MuiBackdrop",["root","invisible"]);const _excluded$n=["children","className","component","components","componentsProps","invisible","open","slotProps","slots","TransitionComponent","transitionDuration"],useUtilityClasses$i=o=>{const{classes:s,invisible:a}=o;return composeClasses({root:["root",a&&"invisible"]},getBackdropUtilityClass,s)},BackdropRoot=styled("div",{name:"MuiBackdrop",slot:"Root",overridesResolver:(o,s)=>{const{ownerState:a}=o;return[s.root,a.invisible&&s.invisible]}})(({ownerState:o})=>_extends$3({position:"fixed",display:"flex",alignItems:"center",justifyContent:"center",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent"},o.invisible&&{backgroundColor:"transparent"})),Backdrop=reactExports.forwardRef(function(s,a){var et,tt,rt;const nt=useThemeProps({props:s,name:"MuiBackdrop"}),{children:it,className:st,component:ot="div",components:at={},componentsProps:lt={},invisible:ct=!1,open:ht,slotProps:ft={},slots:dt={},TransitionComponent:pt=Fade,transitionDuration:gt}=nt,mt=_objectWithoutPropertiesLoose$1(nt,_excluded$n),yt=_extends$3({},nt,{component:ot,invisible:ct}),vt=useUtilityClasses$i(yt),Et=(et=ft.root)!=null?et:lt.root;return jsxRuntimeExports.jsx(pt,_extends$3({in:ht,timeout:gt},mt,{children:jsxRuntimeExports.jsx(BackdropRoot,_extends$3({"aria-hidden":!0},Et,{as:(tt=(rt=dt.root)!=null?rt:at.Root)!=null?tt:ot,className:clsx(vt.root,st,Et?.className),ownerState:_extends$3({},yt,Et?.ownerState),classes:vt,ref:a,children:it}))}))}),boxClasses=generateUtilityClasses("MuiBox",["root"]),defaultTheme=createTheme(),Box=createBox({themeId:THEME_ID,defaultTheme,defaultClassName:boxClasses.root,generateClassName:ClassNameGenerator.generate});function getButtonUtilityClass(o){return generateUtilityClass("MuiButton",o)}const buttonClasses=generateUtilityClasses("MuiButton",["root","text","textInherit","textPrimary","textSecondary","textSuccess","textError","textInfo","textWarning","outlined","outlinedInherit","outlinedPrimary","outlinedSecondary","outlinedSuccess","outlinedError","outlinedInfo","outlinedWarning","contained","containedInherit","containedPrimary","containedSecondary","containedSuccess","containedError","containedInfo","containedWarning","disableElevation","focusVisible","disabled","colorInherit","colorPrimary","colorSecondary","colorSuccess","colorError","colorInfo","colorWarning","textSizeSmall","textSizeMedium","textSizeLarge","outlinedSizeSmall","outlinedSizeMedium","outlinedSizeLarge","containedSizeSmall","containedSizeMedium","containedSizeLarge","sizeMedium","sizeSmall","sizeLarge","fullWidth","startIcon","endIcon","icon","iconSizeSmall","iconSizeMedium","iconSizeLarge"]),ButtonGroupContext=reactExports.createContext({}),ButtonGroupButtonContext=reactExports.createContext(void 0),_excluded$m=["children","color","component","className","disabled","disableElevation","disableFocusRipple","endIcon","focusVisibleClassName","fullWidth","size","startIcon","type","variant"],useUtilityClasses$h=o=>{const{color:s,disableElevation:a,fullWidth:et,size:tt,variant:rt,classes:nt}=o,it={root:["root",rt,`${rt}${capitalize$1(s)}`,`size${capitalize$1(tt)}`,`${rt}Size${capitalize$1(tt)}`,`color${capitalize$1(s)}`,a&&"disableElevation",et&&"fullWidth"],label:["label"],startIcon:["icon","startIcon",`iconSize${capitalize$1(tt)}`],endIcon:["icon","endIcon",`iconSize${capitalize$1(tt)}`]},st=composeClasses(it,getButtonUtilityClass,nt);return _extends$3({},nt,st)},commonIconStyles=o=>_extends$3({},o.size==="small"&&{"& > *:nth-of-type(1)":{fontSize:18}},o.size==="medium"&&{"& > *:nth-of-type(1)":{fontSize:20}},o.size==="large"&&{"& > *:nth-of-type(1)":{fontSize:22}}),ButtonRoot=styled(ButtonBase,{shouldForwardProp:o=>rootShouldForwardProp(o)||o==="classes",name:"MuiButton",slot:"Root",overridesResolver:(o,s)=>{const{ownerState:a}=o;return[s.root,s[a.variant],s[`${a.variant}${capitalize$1(a.color)}`],s[`size${capitalize$1(a.size)}`],s[`${a.variant}Size${capitalize$1(a.size)}`],a.color==="inherit"&&s.colorInherit,a.disableElevation&&s.disableElevation,a.fullWidth&&s.fullWidth]}})(({theme:o,ownerState:s})=>{var a,et;const tt=o.palette.mode==="light"?o.palette.grey[300]:o.palette.grey[800],rt=o.palette.mode==="light"?o.palette.grey.A100:o.palette.grey[700];return _extends$3({},o.typography.button,{minWidth:64,padding:"6px 16px",borderRadius:(o.vars||o).shape.borderRadius,transition:o.transitions.create(["background-color","box-shadow","border-color","color"],{duration:o.transitions.duration.short}),"&:hover":_extends$3({textDecoration:"none",backgroundColor:o.vars?`rgba(${o.vars.palette.text.primaryChannel} / ${o.vars.palette.action.hoverOpacity})`:alpha_1(o.palette.text.primary,o.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},s.variant==="text"&&s.color!=="inherit"&&{backgroundColor:o.vars?`rgba(${o.vars.palette[s.color].mainChannel} / ${o.vars.palette.action.hoverOpacity})`:alpha_1(o.palette[s.color].main,o.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},s.variant==="outlined"&&s.color!=="inherit"&&{border:`1px solid ${(o.vars||o).palette[s.color].main}`,backgroundColor:o.vars?`rgba(${o.vars.palette[s.color].mainChannel} / ${o.vars.palette.action.hoverOpacity})`:alpha_1(o.palette[s.color].main,o.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},s.variant==="contained"&&{backgroundColor:o.vars?o.vars.palette.Button.inheritContainedHoverBg:rt,boxShadow:(o.vars||o).shadows[4],"@media (hover: none)":{boxShadow:(o.vars||o).shadows[2],backgroundColor:(o.vars||o).palette.grey[300]}},s.variant==="contained"&&s.color!=="inherit"&&{backgroundColor:(o.vars||o).palette[s.color].dark,"@media (hover: none)":{backgroundColor:(o.vars||o).palette[s.color].main}}),"&:active":_extends$3({},s.variant==="contained"&&{boxShadow:(o.vars||o).shadows[8]}),[`&.${buttonClasses.focusVisible}`]:_extends$3({},s.variant==="contained"&&{boxShadow:(o.vars||o).shadows[6]}),[`&.${buttonClasses.disabled}`]:_extends$3({color:(o.vars||o).palette.action.disabled},s.variant==="outlined"&&{border:`1px solid ${(o.vars||o).palette.action.disabledBackground}`},s.variant==="contained"&&{color:(o.vars||o).palette.action.disabled,boxShadow:(o.vars||o).shadows[0],backgroundColor:(o.vars||o).palette.action.disabledBackground})},s.variant==="text"&&{padding:"6px 8px"},s.variant==="text"&&s.color!=="inherit"&&{color:(o.vars||o).palette[s.color].main},s.variant==="outlined"&&{padding:"5px 15px",border:"1px solid currentColor"},s.variant==="outlined"&&s.color!=="inherit"&&{color:(o.vars||o).palette[s.color].main,border:o.vars?`1px solid rgba(${o.vars.palette[s.color].mainChannel} / 0.5)`:`1px solid ${alpha_1(o.palette[s.color].main,.5)}`},s.variant==="contained"&&{color:o.vars?o.vars.palette.text.primary:(a=(et=o.palette).getContrastText)==null?void 0:a.call(et,o.palette.grey[300]),backgroundColor:o.vars?o.vars.palette.Button.inheritContainedBg:tt,boxShadow:(o.vars||o).shadows[2]},s.variant==="contained"&&s.color!=="inherit"&&{color:(o.vars||o).palette[s.color].contrastText,backgroundColor:(o.vars||o).palette[s.color].main},s.color==="inherit"&&{color:"inherit",borderColor:"currentColor"},s.size==="small"&&s.variant==="text"&&{padding:"4px 5px",fontSize:o.typography.pxToRem(13)},s.size==="large"&&s.variant==="text"&&{padding:"8px 11px",fontSize:o.typography.pxToRem(15)},s.size==="small"&&s.variant==="outlined"&&{padding:"3px 9px",fontSize:o.typography.pxToRem(13)},s.size==="large"&&s.variant==="outlined"&&{padding:"7px 21px",fontSize:o.typography.pxToRem(15)},s.size==="small"&&s.variant==="contained"&&{padding:"4px 10px",fontSize:o.typography.pxToRem(13)},s.size==="large"&&s.variant==="contained"&&{padding:"8px 22px",fontSize:o.typography.pxToRem(15)},s.fullWidth&&{width:"100%"})},({ownerState:o})=>o.disableElevation&&{boxShadow:"none","&:hover":{boxShadow:"none"},[`&.${buttonClasses.focusVisible}`]:{boxShadow:"none"},"&:active":{boxShadow:"none"},[`&.${buttonClasses.disabled}`]:{boxShadow:"none"}}),ButtonStartIcon=styled("span",{name:"MuiButton",slot:"StartIcon",overridesResolver:(o,s)=>{const{ownerState:a}=o;return[s.startIcon,s[`iconSize${capitalize$1(a.size)}`]]}})(({ownerState:o})=>_extends$3({display:"inherit",marginRight:8,marginLeft:-4},o.size==="small"&&{marginLeft:-2},commonIconStyles(o))),ButtonEndIcon=styled("span",{name:"MuiButton",slot:"EndIcon",overridesResolver:(o,s)=>{const{ownerState:a}=o;return[s.endIcon,s[`iconSize${capitalize$1(a.size)}`]]}})(({ownerState:o})=>_extends$3({display:"inherit",marginRight:-4,marginLeft:8},o.size==="small"&&{marginRight:-2},commonIconStyles(o))),Button=reactExports.forwardRef(function(s,a){const et=reactExports.useContext(ButtonGroupContext),tt=reactExports.useContext(ButtonGroupButtonContext),rt=resolveProps(et,s),nt=useThemeProps({props:rt,name:"MuiButton"}),{children:it,color:st="primary",component:ot="button",className:at,disabled:lt=!1,disableElevation:ct=!1,disableFocusRipple:ht=!1,endIcon:ft,focusVisibleClassName:dt,fullWidth:pt=!1,size:gt="medium",startIcon:mt,type:yt,variant:vt="text"}=nt,Et=_objectWithoutPropertiesLoose$1(nt,_excluded$m),xt=_extends$3({},nt,{color:st,component:ot,disabled:lt,disableElevation:ct,disableFocusRipple:ht,fullWidth:pt,size:gt,type:yt,variant:vt}),wt=useUtilityClasses$h(xt),Rt=mt&&jsxRuntimeExports.jsx(ButtonStartIcon,{className:wt.startIcon,ownerState:xt,children:mt}),Ct=ft&&jsxRuntimeExports.jsx(ButtonEndIcon,{className:wt.endIcon,ownerState:xt,children:ft}),Ft=tt||"";return jsxRuntimeExports.jsxs(ButtonRoot,_extends$3({ownerState:xt,className:clsx(et.className,wt.root,at,Ft),component:ot,disabled:lt,focusRipple:!ht,focusVisibleClassName:clsx(wt.focusVisible,dt),ref:a,type:yt},Et,{classes:wt,children:[Rt,it,Ct]}))});function getModalUtilityClass(o){return generateUtilityClass("MuiModal",o)}generateUtilityClasses("MuiModal",["root","hidden","backdrop"]);const _excluded$l=["BackdropComponent","BackdropProps","classes","className","closeAfterTransition","children","container","component","components","componentsProps","disableAutoFocus","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","onBackdropClick","onClose","onTransitionEnter","onTransitionExited","open","slotProps","slots","theme"],useUtilityClasses$g=o=>{const{open:s,exited:a,classes:et}=o;return composeClasses({root:["root",!s&&a&&"hidden"],backdrop:["backdrop"]},getModalUtilityClass,et)},ModalRoot=styled("div",{name:"MuiModal",slot:"Root",overridesResolver:(o,s)=>{const{ownerState:a}=o;return[s.root,!a.open&&a.exited&&s.hidden]}})(({theme:o,ownerState:s})=>_extends$3({position:"fixed",zIndex:(o.vars||o).zIndex.modal,right:0,bottom:0,top:0,left:0},!s.open&&s.exited&&{visibility:"hidden"})),ModalBackdrop=styled(Backdrop,{name:"MuiModal",slot:"Backdrop",overridesResolver:(o,s)=>s.backdrop})({zIndex:-1}),Modal=reactExports.forwardRef(function(s,a){var et,tt,rt,nt,it,st;const ot=useThemeProps({name:"MuiModal",props:s}),{BackdropComponent:at=ModalBackdrop,BackdropProps:lt,className:ct,closeAfterTransition:ht=!1,children:ft,container:dt,component:pt,components:gt={},componentsProps:mt={},disableAutoFocus:yt=!1,disableEnforceFocus:vt=!1,disableEscapeKeyDown:Et=!1,disablePortal:xt=!1,disableRestoreFocus:wt=!1,disableScrollLock:Rt=!1,hideBackdrop:Ct=!1,keepMounted:Ft=!1,onBackdropClick:zt,open:Nt,slotProps:Kt,slots:Yt}=ot,Bt=_objectWithoutPropertiesLoose$1(ot,_excluded$l),Pt=_extends$3({},ot,{closeAfterTransition:ht,disableAutoFocus:yt,disableEnforceFocus:vt,disableEscapeKeyDown:Et,disablePortal:xt,disableRestoreFocus:wt,disableScrollLock:Rt,hideBackdrop:Ct,keepMounted:Ft}),{getRootProps:Dt,getBackdropProps:Tt,getTransitionProps:St,portalRef:Mt,isTopModal:jt,exited:Gt,hasTransition:Ht}=useModal(_extends$3({},Pt,{rootRef:a})),At=_extends$3({},Pt,{exited:Gt}),$t=useUtilityClasses$g(At),kt={};if(ft.props.tabIndex===void 0&&(kt.tabIndex="-1"),Ht){const{onEnter:Qt,onExited:er}=St();kt.onEnter=Qt,kt.onExited=er}const Lt=(et=(tt=Yt?.root)!=null?tt:gt.Root)!=null?et:ModalRoot,bt=(rt=(nt=Yt?.backdrop)!=null?nt:gt.Backdrop)!=null?rt:at,It=(it=Kt?.root)!=null?it:mt.root,Ut=(st=Kt?.backdrop)!=null?st:mt.backdrop,Wt=useSlotProps({elementType:Lt,externalSlotProps:It,externalForwardedProps:Bt,getSlotProps:Dt,additionalProps:{ref:a,as:pt},ownerState:At,className:clsx(ct,It?.className,$t?.root,!At.open&&At.exited&&$t?.hidden)}),Xt=useSlotProps({elementType:bt,externalSlotProps:Ut,additionalProps:lt,getSlotProps:Qt=>Tt(_extends$3({},Qt,{onClick:er=>{zt&&zt(er),Qt!=null&&Qt.onClick&&Qt.onClick(er)}})),className:clsx(Ut?.className,lt?.className,$t?.backdrop),ownerState:At});return!Ft&&!Nt&&(!Ht||Gt)?null:jsxRuntimeExports.jsx(Portal,{ref:Mt,container:dt,disablePortal:xt,children:jsxRuntimeExports.jsxs(Lt,_extends$3({},Wt,{children:[!Ct&&at?jsxRuntimeExports.jsx(bt,_extends$3({},Xt)):null,jsxRuntimeExports.jsx(FocusTrap,{disableEnforceFocus:vt,disableAutoFocus:yt,disableRestoreFocus:wt,isEnabled:jt,open:Nt,children:reactExports.cloneElement(ft,kt)})]}))})});function getDividerUtilityClass(o){return generateUtilityClass("MuiDivider",o)}generateUtilityClasses("MuiDivider",["root","absolute","fullWidth","inset","middle","flexItem","light","vertical","withChildren","withChildrenVertical","textAlignRight","textAlignLeft","wrapper","wrapperVertical"]);const _excluded$k=["absolute","children","className","component","flexItem","light","orientation","role","textAlign","variant"],useUtilityClasses$f=o=>{const{absolute:s,children:a,classes:et,flexItem:tt,light:rt,orientation:nt,textAlign:it,variant:st}=o;return composeClasses({root:["root",s&&"absolute",st,rt&&"light",nt==="vertical"&&"vertical",tt&&"flexItem",a&&"withChildren",a&&nt==="vertical"&&"withChildrenVertical",it==="right"&&nt!=="vertical"&&"textAlignRight",it==="left"&&nt!=="vertical"&&"textAlignLeft"],wrapper:["wrapper",nt==="vertical"&&"wrapperVertical"]},getDividerUtilityClass,et)},DividerRoot=styled("div",{name:"MuiDivider",slot:"Root",overridesResolver:(o,s)=>{const{ownerState:a}=o;return[s.root,a.absolute&&s.absolute,s[a.variant],a.light&&s.light,a.orientation==="vertical"&&s.vertical,a.flexItem&&s.flexItem,a.children&&s.withChildren,a.children&&a.orientation==="vertical"&&s.withChildrenVertical,a.textAlign==="right"&&a.orientation!=="vertical"&&s.textAlignRight,a.textAlign==="left"&&a.orientation!=="vertical"&&s.textAlignLeft]}})(({theme:o,ownerState:s})=>_extends$3({margin:0,flexShrink:0,borderWidth:0,borderStyle:"solid",borderColor:(o.vars||o).palette.divider,borderBottomWidth:"thin"},s.absolute&&{position:"absolute",bottom:0,left:0,width:"100%"},s.light&&{borderColor:o.vars?`rgba(${o.vars.palette.dividerChannel} / 0.08)`:alpha_1(o.palette.divider,.08)},s.variant==="inset"&&{marginLeft:72},s.variant==="middle"&&s.orientation==="horizontal"&&{marginLeft:o.spacing(2),marginRight:o.spacing(2)},s.variant==="middle"&&s.orientation==="vertical"&&{marginTop:o.spacing(1),marginBottom:o.spacing(1)},s.orientation==="vertical"&&{height:"100%",borderBottomWidth:0,borderRightWidth:"thin"},s.flexItem&&{alignSelf:"stretch",height:"auto"}),({ownerState:o})=>_extends$3({},o.children&&{display:"flex",whiteSpace:"nowrap",textAlign:"center",border:0,"&::before, &::after":{content:'""',alignSelf:"center"}}),({theme:o,ownerState:s})=>_extends$3({},s.children&&s.orientation!=="vertical"&&{"&::before, &::after":{width:"100%",borderTop:`thin solid ${(o.vars||o).palette.divider}`}}),({theme:o,ownerState:s})=>_extends$3({},s.children&&s.orientation==="vertical"&&{flexDirection:"column","&::before, &::after":{height:"100%",borderLeft:`thin solid ${(o.vars||o).palette.divider}`}}),({ownerState:o})=>_extends$3({},o.textAlign==="right"&&o.orientation!=="vertical"&&{"&::before":{width:"90%"},"&::after":{width:"10%"}},o.textAlign==="left"&&o.orientation!=="vertical"&&{"&::before":{width:"10%"},"&::after":{width:"90%"}})),DividerWrapper=styled("span",{name:"MuiDivider",slot:"Wrapper",overridesResolver:(o,s)=>{const{ownerState:a}=o;return[s.wrapper,a.orientation==="vertical"&&s.wrapperVertical]}})(({theme:o,ownerState:s})=>_extends$3({display:"inline-block",paddingLeft:`calc(${o.spacing(1)} * 1.2)`,paddingRight:`calc(${o.spacing(1)} * 1.2)`},s.orientation==="vertical"&&{paddingTop:`calc(${o.spacing(1)} * 1.2)`,paddingBottom:`calc(${o.spacing(1)} * 1.2)`})),Divider=reactExports.forwardRef(function(s,a){const et=useThemeProps({props:s,name:"MuiDivider"}),{absolute:tt=!1,children:rt,className:nt,component:it=rt?"div":"hr",flexItem:st=!1,light:ot=!1,orientation:at="horizontal",role:lt=it!=="hr"?"separator":void 0,textAlign:ct="center",variant:ht="fullWidth"}=et,ft=_objectWithoutPropertiesLoose$1(et,_excluded$k),dt=_extends$3({},et,{absolute:tt,component:it,flexItem:st,light:ot,orientation:at,role:lt,textAlign:ct,variant:ht}),pt=useUtilityClasses$f(dt);return jsxRuntimeExports.jsx(DividerRoot,_extends$3({as:it,className:clsx(pt.root,nt),role:lt,ref:a,ownerState:dt},ft,{children:rt?jsxRuntimeExports.jsx(DividerWrapper,{className:pt.wrapper,ownerState:dt,children:rt}):null}))});Divider.muiSkipListHighlight=!0;const _excluded$j=["disableUnderline","components","componentsProps","fullWidth","hiddenLabel","inputComponent","multiline","slotProps","slots","type"],useUtilityClasses$e=o=>{const{classes:s,disableUnderline:a}=o,tt=composeClasses({root:["root",!a&&"underline"],input:["input"]},getFilledInputUtilityClass,s);return _extends$3({},s,tt)},FilledInputRoot=styled(InputBaseRoot,{shouldForwardProp:o=>rootShouldForwardProp(o)||o==="classes",name:"MuiFilledInput",slot:"Root",overridesResolver:(o,s)=>{const{ownerState:a}=o;return[...rootOverridesResolver(o,s),!a.disableUnderline&&s.underline]}})(({theme:o,ownerState:s})=>{var a;const et=o.palette.mode==="light",tt=et?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)",rt=et?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)",nt=et?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)",it=et?"rgba(0, 0, 0, 0.12)":"rgba(255, 255, 255, 0.12)";return _extends$3({position:"relative",backgroundColor:o.vars?o.vars.palette.FilledInput.bg:rt,borderTopLeftRadius:(o.vars||o).shape.borderRadius,borderTopRightRadius:(o.vars||o).shape.borderRadius,transition:o.transitions.create("background-color",{duration:o.transitions.duration.shorter,easing:o.transitions.easing.easeOut}),"&:hover":{backgroundColor:o.vars?o.vars.palette.FilledInput.hoverBg:nt,"@media (hover: none)":{backgroundColor:o.vars?o.vars.palette.FilledInput.bg:rt}},[`&.${filledInputClasses.focused}`]:{backgroundColor:o.vars?o.vars.palette.FilledInput.bg:rt},[`&.${filledInputClasses.disabled}`]:{backgroundColor:o.vars?o.vars.palette.FilledInput.disabledBg:it}},!s.disableUnderline&&{"&::after":{borderBottom:`2px solid ${(a=(o.vars||o).palette[s.color||"primary"])==null?void 0:a.main}`,left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:o.transitions.create("transform",{duration:o.transitions.duration.shorter,easing:o.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${filledInputClasses.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${filledInputClasses.error}`]:{"&::before, &::after":{borderBottomColor:(o.vars||o).palette.error.main}},"&::before":{borderBottom:`1px solid ${o.vars?`rgba(${o.vars.palette.common.onBackgroundChannel} / ${o.vars.opacity.inputUnderline})`:tt}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:o.transitions.create("border-bottom-color",{duration:o.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${filledInputClasses.disabled}, .${filledInputClasses.error}):before`]:{borderBottom:`1px solid ${(o.vars||o).palette.text.primary}`},[`&.${filledInputClasses.disabled}:before`]:{borderBottomStyle:"dotted"}},s.startAdornment&&{paddingLeft:12},s.endAdornment&&{paddingRight:12},s.multiline&&_extends$3({padding:"25px 12px 8px"},s.size==="small"&&{paddingTop:21,paddingBottom:4},s.hiddenLabel&&{paddingTop:16,paddingBottom:17},s.hiddenLabel&&s.size==="small"&&{paddingTop:8,paddingBottom:9}))}),FilledInputInput=styled(InputBaseComponent,{name:"MuiFilledInput",slot:"Input",overridesResolver:inputOverridesResolver})(({theme:o,ownerState:s})=>_extends$3({paddingTop:25,paddingRight:12,paddingBottom:8,paddingLeft:12},!o.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:o.palette.mode==="light"?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:o.palette.mode==="light"?null:"#fff",caretColor:o.palette.mode==="light"?null:"#fff",borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"}},o.vars&&{"&:-webkit-autofill":{borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"},[o.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},s.size==="small"&&{paddingTop:21,paddingBottom:4},s.hiddenLabel&&{paddingTop:16,paddingBottom:17},s.startAdornment&&{paddingLeft:0},s.endAdornment&&{paddingRight:0},s.hiddenLabel&&s.size==="small"&&{paddingTop:8,paddingBottom:9},s.multiline&&{paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0})),FilledInput=reactExports.forwardRef(function(s,a){var et,tt,rt,nt;const it=useThemeProps({props:s,name:"MuiFilledInput"}),{components:st={},componentsProps:ot,fullWidth:at=!1,inputComponent:lt="input",multiline:ct=!1,slotProps:ht,slots:ft={},type:dt="text"}=it,pt=_objectWithoutPropertiesLoose$1(it,_excluded$j),gt=_extends$3({},it,{fullWidth:at,inputComponent:lt,multiline:ct,type:dt}),mt=useUtilityClasses$e(it),yt={root:{ownerState:gt},input:{ownerState:gt}},vt=ht??ot?deepmerge$1(yt,ht??ot):yt,Et=(et=(tt=ft.root)!=null?tt:st.Root)!=null?et:FilledInputRoot,xt=(rt=(nt=ft.input)!=null?nt:st.Input)!=null?rt:FilledInputInput;return jsxRuntimeExports.jsx(InputBase$1,_extends$3({slots:{root:Et,input:xt},componentsProps:vt,fullWidth:at,inputComponent:lt,multiline:ct,ref:a,type:dt},pt,{classes:mt}))});FilledInput.muiName="Input";function getFormControlUtilityClasses(o){return generateUtilityClass("MuiFormControl",o)}generateUtilityClasses("MuiFormControl",["root","marginNone","marginNormal","marginDense","fullWidth","disabled"]);const _excluded$i=["children","className","color","component","disabled","error","focused","fullWidth","hiddenLabel","margin","required","size","variant"],useUtilityClasses$d=o=>{const{classes:s,margin:a,fullWidth:et}=o,tt={root:["root",a!=="none"&&`margin${capitalize$1(a)}`,et&&"fullWidth"]};return composeClasses(tt,getFormControlUtilityClasses,s)},FormControlRoot=styled("div",{name:"MuiFormControl",slot:"Root",overridesResolver:({ownerState:o},s)=>_extends$3({},s.root,s[`margin${capitalize$1(o.margin)}`],o.fullWidth&&s.fullWidth)})(({ownerState:o})=>_extends$3({display:"inline-flex",flexDirection:"column",position:"relative",minWidth:0,padding:0,margin:0,border:0,verticalAlign:"top"},o.margin==="normal"&&{marginTop:16,marginBottom:8},o.margin==="dense"&&{marginTop:8,marginBottom:4},o.fullWidth&&{width:"100%"})),FormControl=reactExports.forwardRef(function(s,a){const et=useThemeProps({props:s,name:"MuiFormControl"}),{children:tt,className:rt,color:nt="primary",component:it="div",disabled:st=!1,error:ot=!1,focused:at,fullWidth:lt=!1,hiddenLabel:ct=!1,margin:ht="none",required:ft=!1,size:dt="medium",variant:pt="outlined"}=et,gt=_objectWithoutPropertiesLoose$1(et,_excluded$i),mt=_extends$3({},et,{color:nt,component:it,disabled:st,error:ot,fullWidth:lt,hiddenLabel:ct,margin:ht,required:ft,size:dt,variant:pt}),yt=useUtilityClasses$d(mt),[vt,Et]=reactExports.useState(()=>{let Kt=!1;return tt&&reactExports.Children.forEach(tt,Yt=>{if(!isMuiElement(Yt,["Input","Select"]))return;const Bt=isMuiElement(Yt,["Select"])?Yt.props.input:Yt;Bt&&isAdornedStart(Bt.props)&&(Kt=!0)}),Kt}),[xt,wt]=reactExports.useState(()=>{let Kt=!1;return tt&&reactExports.Children.forEach(tt,Yt=>{isMuiElement(Yt,["Input","Select"])&&(isFilled(Yt.props,!0)||isFilled(Yt.props.inputProps,!0))&&(Kt=!0)}),Kt}),[Rt,Ct]=reactExports.useState(!1);st&&Rt&&Ct(!1);const Ft=at!==void 0&&!st?at:Rt;let zt;const Nt=reactExports.useMemo(()=>({adornedStart:vt,setAdornedStart:Et,color:nt,disabled:st,error:ot,filled:xt,focused:Ft,fullWidth:lt,hiddenLabel:ct,size:dt,onBlur:()=>{Ct(!1)},onEmpty:()=>{wt(!1)},onFilled:()=>{wt(!0)},onFocus:()=>{Ct(!0)},registerEffect:zt,required:ft,variant:pt}),[vt,nt,st,ot,xt,Ft,lt,ct,zt,ft,dt,pt]);return jsxRuntimeExports.jsx(FormControlContext.Provider,{value:Nt,children:jsxRuntimeExports.jsx(FormControlRoot,_extends$3({as:it,ownerState:mt,className:clsx(yt.root,rt),ref:a},gt,{children:tt}))})});function getFormHelperTextUtilityClasses(o){return generateUtilityClass("MuiFormHelperText",o)}const formHelperTextClasses=generateUtilityClasses("MuiFormHelperText",["root","error","disabled","sizeSmall","sizeMedium","contained","focused","filled","required"]);var _span$2;const _excluded$h=["children","className","component","disabled","error","filled","focused","margin","required","variant"],useUtilityClasses$c=o=>{const{classes:s,contained:a,size:et,disabled:tt,error:rt,filled:nt,focused:it,required:st}=o,ot={root:["root",tt&&"disabled",rt&&"error",et&&`size${capitalize$1(et)}`,a&&"contained",it&&"focused",nt&&"filled",st&&"required"]};return composeClasses(ot,getFormHelperTextUtilityClasses,s)},FormHelperTextRoot=styled("p",{name:"MuiFormHelperText",slot:"Root",overridesResolver:(o,s)=>{const{ownerState:a}=o;return[s.root,a.size&&s[`size${capitalize$1(a.size)}`],a.contained&&s.contained,a.filled&&s.filled]}})(({theme:o,ownerState:s})=>_extends$3({color:(o.vars||o).palette.text.secondary},o.typography.caption,{textAlign:"left",marginTop:3,marginRight:0,marginBottom:0,marginLeft:0,[`&.${formHelperTextClasses.disabled}`]:{color:(o.vars||o).palette.text.disabled},[`&.${formHelperTextClasses.error}`]:{color:(o.vars||o).palette.error.main}},s.size==="small"&&{marginTop:4},s.contained&&{marginLeft:14,marginRight:14})),FormHelperText=reactExports.forwardRef(function(s,a){const et=useThemeProps({props:s,name:"MuiFormHelperText"}),{children:tt,className:rt,component:nt="p"}=et,it=_objectWithoutPropertiesLoose$1(et,_excluded$h),st=useFormControl(),ot=formControlState({props:et,muiFormControl:st,states:["variant","size","disabled","error","filled","focused","required"]}),at=_extends$3({},et,{component:nt,contained:ot.variant==="filled"||ot.variant==="outlined",variant:ot.variant,size:ot.size,disabled:ot.disabled,error:ot.error,filled:ot.filled,focused:ot.focused,required:ot.required}),lt=useUtilityClasses$c(at);return jsxRuntimeExports.jsx(FormHelperTextRoot,_extends$3({as:nt,ownerState:at,className:clsx(lt.root,rt),ref:a},it,{children:tt===" "?_span$2||(_span$2=jsxRuntimeExports.jsx("span",{className:"notranslate",children:""})):tt}))});function getFormLabelUtilityClasses(o){return generateUtilityClass("MuiFormLabel",o)}const formLabelClasses=generateUtilityClasses("MuiFormLabel",["root","colorSecondary","focused","disabled","error","filled","required","asterisk"]),_excluded$g=["children","className","color","component","disabled","error","filled","focused","required"],useUtilityClasses$b=o=>{const{classes:s,color:a,focused:et,disabled:tt,error:rt,filled:nt,required:it}=o,st={root:["root",`color${capitalize$1(a)}`,tt&&"disabled",rt&&"error",nt&&"filled",et&&"focused",it&&"required"],asterisk:["asterisk",rt&&"error"]};return composeClasses(st,getFormLabelUtilityClasses,s)},FormLabelRoot=styled("label",{name:"MuiFormLabel",slot:"Root",overridesResolver:({ownerState:o},s)=>_extends$3({},s.root,o.color==="secondary"&&s.colorSecondary,o.filled&&s.filled)})(({theme:o,ownerState:s})=>_extends$3({color:(o.vars||o).palette.text.secondary},o.typography.body1,{lineHeight:"1.4375em",padding:0,position:"relative",[`&.${formLabelClasses.focused}`]:{color:(o.vars||o).palette[s.color].main},[`&.${formLabelClasses.disabled}`]:{color:(o.vars||o).palette.text.disabled},[`&.${formLabelClasses.error}`]:{color:(o.vars||o).palette.error.main}})),AsteriskComponent=styled("span",{name:"MuiFormLabel",slot:"Asterisk",overridesResolver:(o,s)=>s.asterisk})(({theme:o})=>({[`&.${formLabelClasses.error}`]:{color:(o.vars||o).palette.error.main}})),FormLabel=reactExports.forwardRef(function(s,a){const et=useThemeProps({props:s,name:"MuiFormLabel"}),{children:tt,className:rt,component:nt="label"}=et,it=_objectWithoutPropertiesLoose$1(et,_excluded$g),st=useFormControl(),ot=formControlState({props:et,muiFormControl:st,states:["color","required","focused","disabled","error","filled"]}),at=_extends$3({},et,{color:ot.color||"primary",component:nt,disabled:ot.disabled,error:ot.error,filled:ot.filled,focused:ot.focused,required:ot.required}),lt=useUtilityClasses$b(at);return jsxRuntimeExports.jsxs(FormLabelRoot,_extends$3({as:nt,ownerState:at,className:clsx(lt.root,rt),ref:a},it,{children:[tt,ot.required&&jsxRuntimeExports.jsxs(AsteriskComponent,{ownerState:at,"aria-hidden":!0,className:lt.asterisk,children:["","*"]})]}))}),GridContext=reactExports.createContext();function getGridUtilityClass(o){return generateUtilityClass("MuiGrid",o)}const SPACINGS=[0,1,2,3,4,5,6,7,8,9,10],DIRECTIONS=["column-reverse","column","row-reverse","row"],WRAPS=["nowrap","wrap-reverse","wrap"],GRID_SIZES=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],gridClasses=generateUtilityClasses("MuiGrid",["root","container","item","zeroMinWidth",...SPACINGS.map(o=>`spacing-xs-${o}`),...DIRECTIONS.map(o=>`direction-xs-${o}`),...WRAPS.map(o=>`wrap-xs-${o}`),...GRID_SIZES.map(o=>`grid-xs-${o}`),...GRID_SIZES.map(o=>`grid-sm-${o}`),...GRID_SIZES.map(o=>`grid-md-${o}`),...GRID_SIZES.map(o=>`grid-lg-${o}`),...GRID_SIZES.map(o=>`grid-xl-${o}`)]),_excluded$f=["className","columns","columnSpacing","component","container","direction","item","rowSpacing","spacing","wrap","zeroMinWidth"];function getOffset(o){const s=parseFloat(o);return`${s}${String(o).replace(String(s),"")||"px"}`}function generateGrid({theme:o,ownerState:s}){let a;return o.breakpoints.keys.reduce((et,tt)=>{let rt={};if(s[tt]&&(a=s[tt]),!a)return et;if(a===!0)rt={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if(a==="auto")rt={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const nt=resolveBreakpointValues({values:s.columns,breakpoints:o.breakpoints.values}),it=typeof nt=="object"?nt[tt]:nt;if(it==null)return et;const st=`${Math.round(a/it*1e8)/1e6}%`;let ot={};if(s.container&&s.item&&s.columnSpacing!==0){const at=o.spacing(s.columnSpacing);if(at!=="0px"){const lt=`calc(${st} + ${getOffset(at)})`;ot={flexBasis:lt,maxWidth:lt}}}rt=_extends$3({flexBasis:st,flexGrow:0,maxWidth:st},ot)}return o.breakpoints.values[tt]===0?Object.assign(et,rt):et[o.breakpoints.up(tt)]=rt,et},{})}function generateDirection({theme:o,ownerState:s}){const a=resolveBreakpointValues({values:s.direction,breakpoints:o.breakpoints.values});return handleBreakpoints({theme:o},a,et=>{const tt={flexDirection:et};return et.indexOf("column")===0&&(tt[`& > .${gridClasses.item}`]={maxWidth:"none"}),tt})}function extractZeroValueBreakpointKeys({breakpoints:o,values:s}){let a="";Object.keys(s).forEach(tt=>{a===""&&s[tt]!==0&&(a=tt)});const et=Object.keys(o).sort((tt,rt)=>o[tt]-o[rt]);return et.slice(0,et.indexOf(a))}function generateRowGap({theme:o,ownerState:s}){const{container:a,rowSpacing:et}=s;let tt={};if(a&&et!==0){const rt=resolveBreakpointValues({values:et,breakpoints:o.breakpoints.values});let nt;typeof rt=="object"&&(nt=extractZeroValueBreakpointKeys({breakpoints:o.breakpoints.values,values:rt})),tt=handleBreakpoints({theme:o},rt,(it,st)=>{var ot;const at=o.spacing(it);return at!=="0px"?{marginTop:`-${getOffset(at)}`,[`& > .${gridClasses.item}`]:{paddingTop:getOffset(at)}}:(ot=nt)!=null&&ot.includes(st)?{}:{marginTop:0,[`& > .${gridClasses.item}`]:{paddingTop:0}}})}return tt}function generateColumnGap({theme:o,ownerState:s}){const{container:a,columnSpacing:et}=s;let tt={};if(a&&et!==0){const rt=resolveBreakpointValues({values:et,breakpoints:o.breakpoints.values});let nt;typeof rt=="object"&&(nt=extractZeroValueBreakpointKeys({breakpoints:o.breakpoints.values,values:rt})),tt=handleBreakpoints({theme:o},rt,(it,st)=>{var ot;const at=o.spacing(it);return at!=="0px"?{width:`calc(100% + ${getOffset(at)})`,marginLeft:`-${getOffset(at)}`,[`& > .${gridClasses.item}`]:{paddingLeft:getOffset(at)}}:(ot=nt)!=null&&ot.includes(st)?{}:{width:"100%",marginLeft:0,[`& > .${gridClasses.item}`]:{paddingLeft:0}}})}return tt}function resolveSpacingStyles(o,s,a={}){if(!o||o<=0)return[];if(typeof o=="string"&&!Number.isNaN(Number(o))||typeof o=="number")return[a[`spacing-xs-${String(o)}`]];const et=[];return s.forEach(tt=>{const rt=o[tt];Number(rt)>0&&et.push(a[`spacing-${tt}-${String(rt)}`])}),et}const GridRoot=styled("div",{name:"MuiGrid",slot:"Root",overridesResolver:(o,s)=>{const{ownerState:a}=o,{container:et,direction:tt,item:rt,spacing:nt,wrap:it,zeroMinWidth:st,breakpoints:ot}=a;let at=[];et&&(at=resolveSpacingStyles(nt,ot,s));const lt=[];return ot.forEach(ct=>{const ht=a[ct];ht&&lt.push(s[`grid-${ct}-${String(ht)}`])}),[s.root,et&&s.container,rt&&s.item,st&&s.zeroMinWidth,...at,tt!=="row"&&s[`direction-xs-${String(tt)}`],it!=="wrap"&&s[`wrap-xs-${String(it)}`],...lt]}})(({ownerState:o})=>_extends$3({boxSizing:"border-box"},o.container&&{display:"flex",flexWrap:"wrap",width:"100%"},o.item&&{margin:0},o.zeroMinWidth&&{minWidth:0},o.wrap!=="wrap"&&{flexWrap:o.wrap}),generateDirection,generateRowGap,generateColumnGap,generateGrid);function resolveSpacingClasses(o,s){if(!o||o<=0)return[];if(typeof o=="string"&&!Number.isNaN(Number(o))||typeof o=="number")return[`spacing-xs-${String(o)}`];const a=[];return s.forEach(et=>{const tt=o[et];if(Number(tt)>0){const rt=`spacing-${et}-${String(tt)}`;a.push(rt)}}),a}const useUtilityClasses$a=o=>{const{classes:s,container:a,direction:et,item:tt,spacing:rt,wrap:nt,zeroMinWidth:it,breakpoints:st}=o;let ot=[];a&&(ot=resolveSpacingClasses(rt,st));const at=[];st.forEach(ct=>{const ht=o[ct];ht&&at.push(`grid-${ct}-${String(ht)}`)});const lt={root:["root",a&&"container",tt&&"item",it&&"zeroMinWidth",...ot,et!=="row"&&`direction-xs-${String(et)}`,nt!=="wrap"&&`wrap-xs-${String(nt)}`,...at]};return composeClasses(lt,getGridUtilityClass,s)},Grid=reactExports.forwardRef(function(s,a){const et=useThemeProps({props:s,name:"MuiGrid"}),{breakpoints:tt}=useTheme(),rt=extendSxProp(et),{className:nt,columns:it,columnSpacing:st,component:ot="div",container:at=!1,direction:lt="row",item:ct=!1,rowSpacing:ht,spacing:ft=0,wrap:dt="wrap",zeroMinWidth:pt=!1}=rt,gt=_objectWithoutPropertiesLoose$1(rt,_excluded$f),mt=ht||ft,yt=st||ft,vt=reactExports.useContext(GridContext),Et=at?it||12:vt,xt={},wt=_extends$3({},gt);tt.keys.forEach(Ft=>{gt[Ft]!=null&&(xt[Ft]=gt[Ft],delete wt[Ft])});const Rt=_extends$3({},rt,{columns:Et,container:at,direction:lt,item:ct,rowSpacing:mt,columnSpacing:yt,wrap:dt,zeroMinWidth:pt,spacing:ft},xt,{breakpoints:tt.keys}),Ct=useUtilityClasses$a(Rt);return jsxRuntimeExports.jsx(GridContext.Provider,{value:Et,children:jsxRuntimeExports.jsx(GridRoot,_extends$3({ownerState:Rt,className:clsx(Ct.root,nt),as:ot,ref:a},wt))})}),_excluded$e=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"];function getScale(o){return`scale(${o}, ${o**2})`}const styles$1={entering:{opacity:1,transform:getScale(1)},entered:{opacity:1,transform:"none"}},isWebKit154=typeof navigator<"u"&&/^((?!chrome|android).)*(safari|mobile)/i.test(navigator.userAgent)&&/(os |version\/)15(.|_)4/i.test(navigator.userAgent),Grow=reactExports.forwardRef(function(s,a){const{addEndListener:et,appear:tt=!0,children:rt,easing:nt,in:it,onEnter:st,onEntered:ot,onEntering:at,onExit:lt,onExited:ct,onExiting:ht,style:ft,timeout:dt="auto",TransitionComponent:pt=Transition}=s,gt=_objectWithoutPropertiesLoose$1(s,_excluded$e),mt=useTimeout(),yt=reactExports.useRef(),vt=useTheme(),Et=reactExports.useRef(null),xt=useForkRef(Et,rt.ref,a),wt=Bt=>Pt=>{if(Bt){const Dt=Et.current;Pt===void 0?Bt(Dt):Bt(Dt,Pt)}},Rt=wt(at),Ct=wt((Bt,Pt)=>{reflow(Bt);const{duration:Dt,delay:Tt,easing:St}=getTransitionProps({style:ft,timeout:dt,easing:nt},{mode:"enter"});let Mt;dt==="auto"?(Mt=vt.transitions.getAutoHeightDuration(Bt.clientHeight),yt.current=Mt):Mt=Dt,Bt.style.transition=[vt.transitions.create("opacity",{duration:Mt,delay:Tt}),vt.transitions.create("transform",{duration:isWebKit154?Mt:Mt*.666,delay:Tt,easing:St})].join(","),st&&st(Bt,Pt)}),Ft=wt(ot),zt=wt(ht),Nt=wt(Bt=>{const{duration:Pt,delay:Dt,easing:Tt}=getTransitionProps({style:ft,timeout:dt,easing:nt},{mode:"exit"});let St;dt==="auto"?(St=vt.transitions.getAutoHeightDuration(Bt.clientHeight),yt.current=St):St=Pt,Bt.style.transition=[vt.transitions.create("opacity",{duration:St,delay:Dt}),vt.transitions.create("transform",{duration:isWebKit154?St:St*.666,delay:isWebKit154?Dt:Dt||St*.333,easing:Tt})].join(","),Bt.style.opacity=0,Bt.style.transform=getScale(.75),lt&&lt(Bt)}),Kt=wt(ct),Yt=Bt=>{dt==="auto"&&mt.start(yt.current||0,Bt),et&&et(Et.current,Bt)};return jsxRuntimeExports.jsx(pt,_extends$3({appear:tt,in:it,nodeRef:Et,onEnter:Ct,onEntered:Ft,onEntering:Rt,onExit:Nt,onExited:Kt,onExiting:zt,addEndListener:Yt,timeout:dt==="auto"?null:dt},gt,{children:(Bt,Pt)=>reactExports.cloneElement(rt,_extends$3({style:_extends$3({opacity:0,transform:getScale(.75),visibility:Bt==="exited"&&!it?"hidden":void 0},styles$1[Bt],ft,rt.props.style),ref:xt},Pt))}))});Grow.muiSupportAuto=!0;const _excluded$d=["disableUnderline","components","componentsProps","fullWidth","inputComponent","multiline","slotProps","slots","type"],useUtilityClasses$9=o=>{const{classes:s,disableUnderline:a}=o,tt=composeClasses({root:["root",!a&&"underline"],input:["input"]},getInputUtilityClass,s);return _extends$3({},s,tt)},InputRoot=styled(InputBaseRoot,{shouldForwardProp:o=>rootShouldForwardProp(o)||o==="classes",name:"MuiInput",slot:"Root",overridesResolver:(o,s)=>{const{ownerState:a}=o;return[...rootOverridesResolver(o,s),!a.disableUnderline&&s.underline]}})(({theme:o,ownerState:s})=>{let et=o.palette.mode==="light"?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)";return o.vars&&(et=`rgba(${o.vars.palette.common.onBackgroundChannel} / ${o.vars.opacity.inputUnderline})`),_extends$3({position:"relative"},s.formControl&&{"label + &":{marginTop:16}},!s.disableUnderline&&{"&::after":{borderBottom:`2px solid ${(o.vars||o).palette[s.color].main}`,left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:o.transitions.create("transform",{duration:o.transitions.duration.shorter,easing:o.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${inputClasses.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${inputClasses.error}`]:{"&::before, &::after":{borderBottomColor:(o.vars||o).palette.error.main}},"&::before":{borderBottom:`1px solid ${et}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:o.transitions.create("border-bottom-color",{duration:o.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${inputClasses.disabled}, .${inputClasses.error}):before`]:{borderBottom:`2px solid ${(o.vars||o).palette.text.primary}`,"@media (hover: none)":{borderBottom:`1px solid ${et}`}},[`&.${inputClasses.disabled}:before`]:{borderBottomStyle:"dotted"}})}),InputInput=styled(InputBaseComponent,{name:"MuiInput",slot:"Input",overridesResolver:inputOverridesResolver})({}),Input$2=reactExports.forwardRef(function(s,a){var et,tt,rt,nt;const it=useThemeProps({props:s,name:"MuiInput"}),{disableUnderline:st,components:ot={},componentsProps:at,fullWidth:lt=!1,inputComponent:ct="input",multiline:ht=!1,slotProps:ft,slots:dt={},type:pt="text"}=it,gt=_objectWithoutPropertiesLoose$1(it,_excluded$d),mt=useUtilityClasses$9(it),vt={root:{ownerState:{disableUnderline:st}}},Et=ft??at?deepmerge$1(ft??at,vt):vt,xt=(et=(tt=dt.root)!=null?tt:ot.Root)!=null?et:InputRoot,wt=(rt=(nt=dt.input)!=null?nt:ot.Input)!=null?rt:InputInput;return jsxRuntimeExports.jsx(InputBase$1,_extends$3({slots:{root:xt,input:wt},slotProps:Et,fullWidth:lt,inputComponent:ct,multiline:ht,ref:a,type:pt},gt,{classes:mt}))});Input$2.muiName="Input";function getInputLabelUtilityClasses(o){return generateUtilityClass("MuiInputLabel",o)}generateUtilityClasses("MuiInputLabel",["root","focused","disabled","error","required","asterisk","formControl","sizeSmall","shrink","animated","standard","filled","outlined"]);const _excluded$c=["disableAnimation","margin","shrink","variant","className"],useUtilityClasses$8=o=>{const{classes:s,formControl:a,size:et,shrink:tt,disableAnimation:rt,variant:nt,required:it}=o,st={root:["root",a&&"formControl",!rt&&"animated",tt&&"shrink",et&&et!=="normal"&&`size${capitalize$1(et)}`,nt],asterisk:[it&&"asterisk"]},ot=composeClasses(st,getInputLabelUtilityClasses,s);return _extends$3({},s,ot)},InputLabelRoot=styled(FormLabel,{shouldForwardProp:o=>rootShouldForwardProp(o)||o==="classes",name:"MuiInputLabel",slot:"Root",overridesResolver:(o,s)=>{const{ownerState:a}=o;return[{[`& .${formLabelClasses.asterisk}`]:s.asterisk},s.root,a.formControl&&s.formControl,a.size==="small"&&s.sizeSmall,a.shrink&&s.shrink,!a.disableAnimation&&s.animated,a.focused&&s.focused,s[a.variant]]}})(({theme:o,ownerState:s})=>_extends$3({display:"block",transformOrigin:"top left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%"},s.formControl&&{position:"absolute",left:0,top:0,transform:"translate(0, 20px) scale(1)"},s.size==="small"&&{transform:"translate(0, 17px) scale(1)"},s.shrink&&{transform:"translate(0, -1.5px) scale(0.75)",transformOrigin:"top left",maxWidth:"133%"},!s.disableAnimation&&{transition:o.transitions.create(["color","transform","max-width"],{duration:o.transitions.duration.shorter,easing:o.transitions.easing.easeOut})},s.variant==="filled"&&_extends$3({zIndex:1,pointerEvents:"none",transform:"translate(12px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"},s.size==="small"&&{transform:"translate(12px, 13px) scale(1)"},s.shrink&&_extends$3({userSelect:"none",pointerEvents:"auto",transform:"translate(12px, 7px) scale(0.75)",maxWidth:"calc(133% - 24px)"},s.size==="small"&&{transform:"translate(12px, 4px) scale(0.75)"})),s.variant==="outlined"&&_extends$3({zIndex:1,pointerEvents:"none",transform:"translate(14px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"},s.size==="small"&&{transform:"translate(14px, 9px) scale(1)"},s.shrink&&{userSelect:"none",pointerEvents:"auto",maxWidth:"calc(133% - 32px)",transform:"translate(14px, -9px) scale(0.75)"}))),InputLabel=reactExports.forwardRef(function(s,a){const et=useThemeProps({name:"MuiInputLabel",props:s}),{disableAnimation:tt=!1,shrink:rt,className:nt}=et,it=_objectWithoutPropertiesLoose$1(et,_excluded$c),st=useFormControl();let ot=rt;typeof ot>"u"&&st&&(ot=st.filled||st.focused||st.adornedStart);const at=formControlState({props:et,muiFormControl:st,states:["size","variant","required","focused"]}),lt=_extends$3({},et,{disableAnimation:tt,formControl:st,shrink:ot,size:at.size,variant:at.variant,required:at.required,focused:at.focused}),ct=useUtilityClasses$8(lt);return jsxRuntimeExports.jsx(InputLabelRoot,_extends$3({"data-shrink":ot,ownerState:lt,ref:a,className:clsx(ct.root,nt)},it,{classes:ct}))}),ListContext=reactExports.createContext({});function getListUtilityClass(o){return generateUtilityClass("MuiList",o)}generateUtilityClasses("MuiList",["root","padding","dense","subheader"]);const _excluded$b=["children","className","component","dense","disablePadding","subheader"],useUtilityClasses$7=o=>{const{classes:s,disablePadding:a,dense:et,subheader:tt}=o;return composeClasses({root:["root",!a&&"padding",et&&"dense",tt&&"subheader"]},getListUtilityClass,s)},ListRoot=styled("ul",{name:"MuiList",slot:"Root",overridesResolver:(o,s)=>{const{ownerState:a}=o;return[s.root,!a.disablePadding&&s.padding,a.dense&&s.dense,a.subheader&&s.subheader]}})(({ownerState:o})=>_extends$3({listStyle:"none",margin:0,padding:0,position:"relative"},!o.disablePadding&&{paddingTop:8,paddingBottom:8},o.subheader&&{paddingTop:0})),List=reactExports.forwardRef(function(s,a){const et=useThemeProps({props:s,name:"MuiList"}),{children:tt,className:rt,component:nt="ul",dense:it=!1,disablePadding:st=!1,subheader:ot}=et,at=_objectWithoutPropertiesLoose$1(et,_excluded$b),lt=reactExports.useMemo(()=>({dense:it}),[it]),ct=_extends$3({},et,{component:nt,dense:it,disablePadding:st}),ht=useUtilityClasses$7(ct);return jsxRuntimeExports.jsx(ListContext.Provider,{value:lt,children:jsxRuntimeExports.jsxs(ListRoot,_extends$3({as:nt,className:clsx(ht.root,rt),ref:a,ownerState:ct},at,{children:[ot,tt]}))})}),_excluded$a=["actions","autoFocus","autoFocusItem","children","className","disabledItemsFocusable","disableListWrap","onKeyDown","variant"];function nextItem(o,s,a){return o===s?o.firstChild:s&&s.nextElementSibling?s.nextElementSibling:a?null:o.firstChild}function previousItem(o,s,a){return o===s?a?o.firstChild:o.lastChild:s&&s.previousElementSibling?s.previousElementSibling:a?null:o.lastChild}function textCriteriaMatches(o,s){if(s===void 0)return!0;let a=o.innerText;return a===void 0&&(a=o.textContent),a=a.trim().toLowerCase(),a.length===0?!1:s.repeating?a[0]===s.keys[0]:a.indexOf(s.keys.join(""))===0}function moveFocus(o,s,a,et,tt,rt){let nt=!1,it=tt(o,s,s?a:!1);for(;it;){if(it===o.firstChild){if(nt)return!1;nt=!0}const st=et?!1:it.disabled||it.getAttribute("aria-disabled")==="true";if(!it.hasAttribute("tabindex")||!textCriteriaMatches(it,rt)||st)it=tt(o,it,a);else return it.focus(),!0}return!1}const MenuList=reactExports.forwardRef(function(s,a){const{actions:et,autoFocus:tt=!1,autoFocusItem:rt=!1,children:nt,className:it,disabledItemsFocusable:st=!1,disableListWrap:ot=!1,onKeyDown:at,variant:lt="selectedMenu"}=s,ct=_objectWithoutPropertiesLoose$1(s,_excluded$a),ht=reactExports.useRef(null),ft=reactExports.useRef({keys:[],repeating:!0,previousKeyMatched:!0,lastTime:null});useEnhancedEffect(()=>{tt&&ht.current.focus()},[tt]),reactExports.useImperativeHandle(et,()=>({adjustStyleForScrollbar:(yt,{direction:vt})=>{const Et=!ht.current.style.width;if(yt.clientHeight<ht.current.clientHeight&&Et){const xt=`${getScrollbarSize$1(ownerDocument(yt))}px`;ht.current.style[vt==="rtl"?"paddingLeft":"paddingRight"]=xt,ht.current.style.width=`calc(100% + ${xt})`}return ht.current}}),[]);const dt=yt=>{const vt=ht.current,Et=yt.key,xt=ownerDocument(vt).activeElement;if(Et==="ArrowDown")yt.preventDefault(),moveFocus(vt,xt,ot,st,nextItem);else if(Et==="ArrowUp")yt.preventDefault(),moveFocus(vt,xt,ot,st,previousItem);else if(Et==="Home")yt.preventDefault(),moveFocus(vt,null,ot,st,nextItem);else if(Et==="End")yt.preventDefault(),moveFocus(vt,null,ot,st,previousItem);else if(Et.length===1){const wt=ft.current,Rt=Et.toLowerCase(),Ct=performance.now();wt.keys.length>0&&(Ct-wt.lastTime>500?(wt.keys=[],wt.repeating=!0,wt.previousKeyMatched=!0):wt.repeating&&Rt!==wt.keys[0]&&(wt.repeating=!1)),wt.lastTime=Ct,wt.keys.push(Rt);const Ft=xt&&!wt.repeating&&textCriteriaMatches(xt,wt);wt.previousKeyMatched&&(Ft||moveFocus(vt,xt,!1,st,nextItem,wt))?yt.preventDefault():wt.previousKeyMatched=!1}at&&at(yt)},pt=useForkRef(ht,a);let gt=-1;reactExports.Children.forEach(nt,(yt,vt)=>{if(!reactExports.isValidElement(yt)){gt===vt&&(gt+=1,gt>=nt.length&&(gt=-1));return}yt.props.disabled||(lt==="selectedMenu"&&yt.props.selected||gt===-1)&&(gt=vt),gt===vt&&(yt.props.disabled||yt.props.muiSkipListHighlight||yt.type.muiSkipListHighlight)&&(gt+=1,gt>=nt.length&&(gt=-1))});const mt=reactExports.Children.map(nt,(yt,vt)=>{if(vt===gt){const Et={};return rt&&(Et.autoFocus=!0),yt.props.tabIndex===void 0&&lt==="selectedMenu"&&(Et.tabIndex=0),reactExports.cloneElement(yt,Et)}return yt});return jsxRuntimeExports.jsx(List,_extends$3({role:"menu",ref:pt,className:it,onKeyDown:dt,tabIndex:tt?0:-1},ct,{children:mt}))});function getPopoverUtilityClass(o){return generateUtilityClass("MuiPopover",o)}generateUtilityClasses("MuiPopover",["root","paper"]);const _excluded$9=["onEntering"],_excluded2$2=["action","anchorEl","anchorOrigin","anchorPosition","anchorReference","children","className","container","elevation","marginThreshold","open","PaperProps","slots","slotProps","transformOrigin","TransitionComponent","transitionDuration","TransitionProps","disableScrollLock"],_excluded3=["slotProps"];function getOffsetTop(o,s){let a=0;return typeof s=="number"?a=s:s==="center"?a=o.height/2:s==="bottom"&&(a=o.height),a}function getOffsetLeft(o,s){let a=0;return typeof s=="number"?a=s:s==="center"?a=o.width/2:s==="right"&&(a=o.width),a}function getTransformOriginValue(o){return[o.horizontal,o.vertical].map(s=>typeof s=="number"?`${s}px`:s).join(" ")}function resolveAnchorEl(o){return typeof o=="function"?o():o}const useUtilityClasses$6=o=>{const{classes:s}=o;return composeClasses({root:["root"],paper:["paper"]},getPopoverUtilityClass,s)},PopoverRoot=styled(Modal,{name:"MuiPopover",slot:"Root",overridesResolver:(o,s)=>s.root})({}),PopoverPaper=styled(Paper,{name:"MuiPopover",slot:"Paper",overridesResolver:(o,s)=>s.paper})({position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}),Popover=reactExports.forwardRef(function(s,a){var et,tt,rt;const nt=useThemeProps({props:s,name:"MuiPopover"}),{action:it,anchorEl:st,anchorOrigin:ot={vertical:"top",horizontal:"left"},anchorPosition:at,anchorReference:lt="anchorEl",children:ct,className:ht,container:ft,elevation:dt=8,marginThreshold:pt=16,open:gt,PaperProps:mt={},slots:yt,slotProps:vt,transformOrigin:Et={vertical:"top",horizontal:"left"},TransitionComponent:xt=Grow,transitionDuration:wt="auto",TransitionProps:{onEntering:Rt}={},disableScrollLock:Ct=!1}=nt,Ft=_objectWithoutPropertiesLoose$1(nt.TransitionProps,_excluded$9),zt=_objectWithoutPropertiesLoose$1(nt,_excluded2$2),Nt=(et=vt?.paper)!=null?et:mt,Kt=reactExports.useRef(),Yt=useForkRef(Kt,Nt.ref),Bt=_extends$3({},nt,{anchorOrigin:ot,anchorReference:lt,elevation:dt,marginThreshold:pt,externalPaperSlotProps:Nt,transformOrigin:Et,TransitionComponent:xt,transitionDuration:wt,TransitionProps:Ft}),Pt=useUtilityClasses$6(Bt),Dt=reactExports.useCallback(()=>{if(lt==="anchorPosition")return at;const Qt=resolveAnchorEl(st),lr=(Qt&&Qt.nodeType===1?Qt:ownerDocument(Kt.current).body).getBoundingClientRect();return{top:lr.top+getOffsetTop(lr,ot.vertical),left:lr.left+getOffsetLeft(lr,ot.horizontal)}},[st,ot.horizontal,ot.vertical,at,lt]),Tt=reactExports.useCallback(Qt=>({vertical:getOffsetTop(Qt,Et.vertical),horizontal:getOffsetLeft(Qt,Et.horizontal)}),[Et.horizontal,Et.vertical]),St=reactExports.useCallback(Qt=>{const er={width:Qt.offsetWidth,height:Qt.offsetHeight},lr=Tt(er);if(lt==="none")return{top:null,left:null,transformOrigin:getTransformOriginValue(lr)};const pr=Dt();let gr=pr.top-lr.vertical,wr=pr.left-lr.horizontal;const cr=gr+er.height,Cr=wr+er.width,_r=ownerWindow(resolveAnchorEl(st)),kr=_r.innerHeight-pt,Ir=_r.innerWidth-pt;if(pt!==null&&gr<pt){const tr=gr-pt;gr-=tr,lr.vertical+=tr}else if(pt!==null&&cr>kr){const tr=cr-kr;gr-=tr,lr.vertical+=tr}if(pt!==null&&wr<pt){const tr=wr-pt;wr-=tr,lr.horizontal+=tr}else if(Cr>Ir){const tr=Cr-Ir;wr-=tr,lr.horizontal+=tr}return{top:`${Math.round(gr)}px`,left:`${Math.round(wr)}px`,transformOrigin:getTransformOriginValue(lr)}},[st,lt,Dt,Tt,pt]),[Mt,jt]=reactExports.useState(gt),Gt=reactExports.useCallback(()=>{const Qt=Kt.current;if(!Qt)return;const er=St(Qt);er.top!==null&&(Qt.style.top=er.top),er.left!==null&&(Qt.style.left=er.left),Qt.style.transformOrigin=er.transformOrigin,jt(!0)},[St]);reactExports.useEffect(()=>(Ct&&window.addEventListener("scroll",Gt),()=>window.removeEventListener("scroll",Gt)),[st,Ct,Gt]);const Ht=(Qt,er)=>{Rt&&Rt(Qt,er),Gt()},At=()=>{jt(!1)};reactExports.useEffect(()=>{gt&&Gt()}),reactExports.useImperativeHandle(it,()=>gt?{updatePosition:()=>{Gt()}}:null,[gt,Gt]),reactExports.useEffect(()=>{if(!gt)return;const Qt=debounce(()=>{Gt()}),er=ownerWindow(st);return er.addEventListener("resize",Qt),()=>{Qt.clear(),er.removeEventListener("resize",Qt)}},[st,gt,Gt]);let $t=wt;wt==="auto"&&!xt.muiSupportAuto&&($t=void 0);const kt=ft||(st?ownerDocument(resolveAnchorEl(st)).body:void 0),Lt=(tt=yt?.root)!=null?tt:PopoverRoot,bt=(rt=yt?.paper)!=null?rt:PopoverPaper,It=useSlotProps({elementType:bt,externalSlotProps:_extends$3({},Nt,{style:Mt?Nt.style:_extends$3({},Nt.style,{opacity:0})}),additionalProps:{elevation:dt,ref:Yt},ownerState:Bt,className:clsx(Pt.paper,Nt?.className)}),Ut=useSlotProps({elementType:Lt,externalSlotProps:vt?.root||{},externalForwardedProps:zt,additionalProps:{ref:a,slotProps:{backdrop:{invisible:!0}},container:kt,open:gt},ownerState:Bt,className:clsx(Pt.root,ht)}),{slotProps:Wt}=Ut,Xt=_objectWithoutPropertiesLoose$1(Ut,_excluded3);return jsxRuntimeExports.jsx(Lt,_extends$3({},Xt,!isHostComponent(Lt)&&{slotProps:Wt,disableScrollLock:Ct},{children:jsxRuntimeExports.jsx(xt,_extends$3({appear:!0,in:gt,onEntering:Ht,onExited:At,timeout:$t},Ft,{children:jsxRuntimeExports.jsx(bt,_extends$3({},It,{children:ct}))}))}))});function getMenuUtilityClass(o){return generateUtilityClass("MuiMenu",o)}generateUtilityClasses("MuiMenu",["root","paper","list"]);const _excluded$8=["onEntering"],_excluded2$1=["autoFocus","children","className","disableAutoFocusItem","MenuListProps","onClose","open","PaperProps","PopoverClasses","transitionDuration","TransitionProps","variant","slots","slotProps"],RTL_ORIGIN={vertical:"top",horizontal:"right"},LTR_ORIGIN={vertical:"top",horizontal:"left"},useUtilityClasses$5=o=>{const{classes:s}=o;return composeClasses({root:["root"],paper:["paper"],list:["list"]},getMenuUtilityClass,s)},MenuRoot=styled(Popover,{shouldForwardProp:o=>rootShouldForwardProp(o)||o==="classes",name:"MuiMenu",slot:"Root",overridesResolver:(o,s)=>s.root})({}),MenuPaper=styled(PopoverPaper,{name:"MuiMenu",slot:"Paper",overridesResolver:(o,s)=>s.paper})({maxHeight:"calc(100% - 96px)",WebkitOverflowScrolling:"touch"}),MenuMenuList=styled(MenuList,{name:"MuiMenu",slot:"List",overridesResolver:(o,s)=>s.list})({outline:0}),Menu=reactExports.forwardRef(function(s,a){var et,tt;const rt=useThemeProps({props:s,name:"MuiMenu"}),{autoFocus:nt=!0,children:it,className:st,disableAutoFocusItem:ot=!1,MenuListProps:at={},onClose:lt,open:ct,PaperProps:ht={},PopoverClasses:ft,transitionDuration:dt="auto",TransitionProps:{onEntering:pt}={},variant:gt="selectedMenu",slots:mt={},slotProps:yt={}}=rt,vt=_objectWithoutPropertiesLoose$1(rt.TransitionProps,_excluded$8),Et=_objectWithoutPropertiesLoose$1(rt,_excluded2$1),xt=useRtl(),wt=_extends$3({},rt,{autoFocus:nt,disableAutoFocusItem:ot,MenuListProps:at,onEntering:pt,PaperProps:ht,transitionDuration:dt,TransitionProps:vt,variant:gt}),Rt=useUtilityClasses$5(wt),Ct=nt&&!ot&&ct,Ft=reactExports.useRef(null),zt=(Tt,St)=>{Ft.current&&Ft.current.adjustStyleForScrollbar(Tt,{direction:xt?"rtl":"ltr"}),pt&&pt(Tt,St)},Nt=Tt=>{Tt.key==="Tab"&&(Tt.preventDefault(),lt&&lt(Tt,"tabKeyDown"))};let Kt=-1;reactExports.Children.map(it,(Tt,St)=>{reactExports.isValidElement(Tt)&&(Tt.props.disabled||(gt==="selectedMenu"&&Tt.props.selected||Kt===-1)&&(Kt=St))});const Yt=(et=mt.paper)!=null?et:MenuPaper,Bt=(tt=yt.paper)!=null?tt:ht,Pt=useSlotProps({elementType:mt.root,externalSlotProps:yt.root,ownerState:wt,className:[Rt.root,st]}),Dt=useSlotProps({elementType:Yt,externalSlotProps:Bt,ownerState:wt,className:Rt.paper});return jsxRuntimeExports.jsx(MenuRoot,_extends$3({onClose:lt,anchorOrigin:{vertical:"bottom",horizontal:xt?"right":"left"},transformOrigin:xt?RTL_ORIGIN:LTR_ORIGIN,slots:{paper:Yt,root:mt.root},slotProps:{root:Pt,paper:Dt},open:ct,ref:a,transitionDuration:dt,TransitionProps:_extends$3({onEntering:zt},vt),ownerState:wt},Et,{classes:ft,children:jsxRuntimeExports.jsx(MenuMenuList,_extends$3({onKeyDown:Nt,actions:Ft,autoFocus:nt&&(Kt===-1||ot),autoFocusItem:Ct,variant:gt},at,{className:clsx(Rt.list,at.className),children:it}))}))});function getNativeSelectUtilityClasses(o){return generateUtilityClass("MuiNativeSelect",o)}const nativeSelectClasses=generateUtilityClasses("MuiNativeSelect",["root","select","multiple","filled","outlined","standard","disabled","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]),_excluded$7=["className","disabled","error","IconComponent","inputRef","variant"],useUtilityClasses$4=o=>{const{classes:s,variant:a,disabled:et,multiple:tt,open:rt,error:nt}=o,it={select:["select",a,et&&"disabled",tt&&"multiple",nt&&"error"],icon:["icon",`icon${capitalize$1(a)}`,rt&&"iconOpen",et&&"disabled"]};return composeClasses(it,getNativeSelectUtilityClasses,s)},nativeSelectSelectStyles=({ownerState:o,theme:s})=>_extends$3({MozAppearance:"none",WebkitAppearance:"none",userSelect:"none",borderRadius:0,cursor:"pointer","&:focus":_extends$3({},s.vars?{backgroundColor:`rgba(${s.vars.palette.common.onBackgroundChannel} / 0.05)`}:{backgroundColor:s.palette.mode==="light"?"rgba(0, 0, 0, 0.05)":"rgba(255, 255, 255, 0.05)"},{borderRadius:0}),"&::-ms-expand":{display:"none"},[`&.${nativeSelectClasses.disabled}`]:{cursor:"default"},"&[multiple]":{height:"auto"},"&:not([multiple]) option, &:not([multiple]) optgroup":{backgroundColor:(s.vars||s).palette.background.paper},"&&&":{paddingRight:24,minWidth:16}},o.variant==="filled"&&{"&&&":{paddingRight:32}},o.variant==="outlined"&&{borderRadius:(s.vars||s).shape.borderRadius,"&:focus":{borderRadius:(s.vars||s).shape.borderRadius},"&&&":{paddingRight:32}}),NativeSelectSelect=styled("select",{name:"MuiNativeSelect",slot:"Select",shouldForwardProp:rootShouldForwardProp,overridesResolver:(o,s)=>{const{ownerState:a}=o;return[s.select,s[a.variant],a.error&&s.error,{[`&.${nativeSelectClasses.multiple}`]:s.multiple}]}})(nativeSelectSelectStyles),nativeSelectIconStyles=({ownerState:o,theme:s})=>_extends$3({position:"absolute",right:0,top:"calc(50% - .5em)",pointerEvents:"none",color:(s.vars||s).palette.action.active,[`&.${nativeSelectClasses.disabled}`]:{color:(s.vars||s).palette.action.disabled}},o.open&&{transform:"rotate(180deg)"},o.variant==="filled"&&{right:7},o.variant==="outlined"&&{right:7}),NativeSelectIcon=styled("svg",{name:"MuiNativeSelect",slot:"Icon",overridesResolver:(o,s)=>{const{ownerState:a}=o;return[s.icon,a.variant&&s[`icon${capitalize$1(a.variant)}`],a.open&&s.iconOpen]}})(nativeSelectIconStyles),NativeSelectInput=reactExports.forwardRef(function(s,a){const{className:et,disabled:tt,error:rt,IconComponent:nt,inputRef:it,variant:st="standard"}=s,ot=_objectWithoutPropertiesLoose$1(s,_excluded$7),at=_extends$3({},s,{disabled:tt,variant:st,error:rt}),lt=useUtilityClasses$4(at);return jsxRuntimeExports.jsxs(reactExports.Fragment,{children:[jsxRuntimeExports.jsx(NativeSelectSelect,_extends$3({ownerState:at,className:clsx(lt.select,et),disabled:tt,ref:it||a},ot)),s.multiple?null:jsxRuntimeExports.jsx(NativeSelectIcon,{as:nt,ownerState:at,className:lt.icon})]})});var _span$1;const _excluded$6=["children","classes","className","label","notched"],NotchedOutlineRoot$1=styled("fieldset",{shouldForwardProp:rootShouldForwardProp})({textAlign:"left",position:"absolute",bottom:0,right:0,top:-5,left:0,margin:0,padding:"0 8px",pointerEvents:"none",borderRadius:"inherit",borderStyle:"solid",borderWidth:1,overflow:"hidden",minWidth:"0%"}),NotchedOutlineLegend=styled("legend",{shouldForwardProp:rootShouldForwardProp})(({ownerState:o,theme:s})=>_extends$3({float:"unset",width:"auto",overflow:"hidden"},!o.withLabel&&{padding:0,lineHeight:"11px",transition:s.transitions.create("width",{duration:150,easing:s.transitions.easing.easeOut})},o.withLabel&&_extends$3({display:"block",padding:0,height:11,fontSize:"0.75em",visibility:"hidden",maxWidth:.01,transition:s.transitions.create("max-width",{duration:50,easing:s.transitions.easing.easeOut}),whiteSpace:"nowrap","& > span":{paddingLeft:5,paddingRight:5,display:"inline-block",opacity:0,visibility:"visible"}},o.notched&&{maxWidth:"100%",transition:s.transitions.create("max-width",{duration:100,easing:s.transitions.easing.easeOut,delay:50})})));function NotchedOutline(o){const{className:s,label:a,notched:et}=o,tt=_objectWithoutPropertiesLoose$1(o,_excluded$6),rt=a!=null&&a!=="",nt=_extends$3({},o,{notched:et,withLabel:rt});return jsxRuntimeExports.jsx(NotchedOutlineRoot$1,_extends$3({"aria-hidden":!0,className:s,ownerState:nt},tt,{children:jsxRuntimeExports.jsx(NotchedOutlineLegend,{ownerState:nt,children:rt?jsxRuntimeExports.jsx("span",{children:a}):_span$1||(_span$1=jsxRuntimeExports.jsx("span",{className:"notranslate",children:""}))})}))}const _excluded$5=["components","fullWidth","inputComponent","label","multiline","notched","slots","type"],useUtilityClasses$3=o=>{const{classes:s}=o,et=composeClasses({root:["root"],notchedOutline:["notchedOutline"],input:["input"]},getOutlinedInputUtilityClass,s);return _extends$3({},s,et)},OutlinedInputRoot=styled(InputBaseRoot,{shouldForwardProp:o=>rootShouldForwardProp(o)||o==="classes",name:"MuiOutlinedInput",slot:"Root",overridesResolver:rootOverridesResolver})(({theme:o,ownerState:s})=>{const a=o.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return _extends$3({position:"relative",borderRadius:(o.vars||o).shape.borderRadius,[`&:hover .${outlinedInputClasses.notchedOutline}`]:{borderColor:(o.vars||o).palette.text.primary},"@media (hover: none)":{[`&:hover .${outlinedInputClasses.notchedOutline}`]:{borderColor:o.vars?`rgba(${o.vars.palette.common.onBackgroundChannel} / 0.23)`:a}},[`&.${outlinedInputClasses.focused} .${outlinedInputClasses.notchedOutline}`]:{borderColor:(o.vars||o).palette[s.color].main,borderWidth:2},[`&.${outlinedInputClasses.error} .${outlinedInputClasses.notchedOutline}`]:{borderColor:(o.vars||o).palette.error.main},[`&.${outlinedInputClasses.disabled} .${outlinedInputClasses.notchedOutline}`]:{borderColor:(o.vars||o).palette.action.disabled}},s.startAdornment&&{paddingLeft:14},s.endAdornment&&{paddingRight:14},s.multiline&&_extends$3({padding:"16.5px 14px"},s.size==="small"&&{padding:"8.5px 14px"}))}),NotchedOutlineRoot=styled(NotchedOutline,{name:"MuiOutlinedInput",slot:"NotchedOutline",overridesResolver:(o,s)=>s.notchedOutline})(({theme:o})=>{const s=o.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{borderColor:o.vars?`rgba(${o.vars.palette.common.onBackgroundChannel} / 0.23)`:s}}),OutlinedInputInput=styled(InputBaseComponent,{name:"MuiOutlinedInput",slot:"Input",overridesResolver:inputOverridesResolver})(({theme:o,ownerState:s})=>_extends$3({padding:"16.5px 14px"},!o.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:o.palette.mode==="light"?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:o.palette.mode==="light"?null:"#fff",caretColor:o.palette.mode==="light"?null:"#fff",borderRadius:"inherit"}},o.vars&&{"&:-webkit-autofill":{borderRadius:"inherit"},[o.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},s.size==="small"&&{padding:"8.5px 14px"},s.multiline&&{padding:0},s.startAdornment&&{paddingLeft:0},s.endAdornment&&{paddingRight:0})),OutlinedInput=reactExports.forwardRef(function(s,a){var et,tt,rt,nt,it;const st=useThemeProps({props:s,name:"MuiOutlinedInput"}),{components:ot={},fullWidth:at=!1,inputComponent:lt="input",label:ct,multiline:ht=!1,notched:ft,slots:dt={},type:pt="text"}=st,gt=_objectWithoutPropertiesLoose$1(st,_excluded$5),mt=useUtilityClasses$3(st),yt=useFormControl(),vt=formControlState({props:st,muiFormControl:yt,states:["color","disabled","error","focused","hiddenLabel","size","required"]}),Et=_extends$3({},st,{color:vt.color||"primary",disabled:vt.disabled,error:vt.error,focused:vt.focused,formControl:yt,fullWidth:at,hiddenLabel:vt.hiddenLabel,multiline:ht,size:vt.size,type:pt}),xt=(et=(tt=dt.root)!=null?tt:ot.Root)!=null?et:OutlinedInputRoot,wt=(rt=(nt=dt.input)!=null?nt:ot.Input)!=null?rt:OutlinedInputInput;return jsxRuntimeExports.jsx(InputBase$1,_extends$3({slots:{root:xt,input:wt},renderSuffix:Rt=>jsxRuntimeExports.jsx(NotchedOutlineRoot,{ownerState:Et,className:mt.notchedOutline,label:ct!=null&&ct!==""&&vt.required?it||(it=jsxRuntimeExports.jsxs(reactExports.Fragment,{children:[ct,"","*"]})):ct,notched:typeof ft<"u"?ft:!!(Rt.startAdornment||Rt.filled||Rt.focused)}),fullWidth:at,inputComponent:lt,multiline:ht,ref:a,type:pt},gt,{classes:_extends$3({},mt,{notchedOutline:null})}))});OutlinedInput.muiName="Input";function getSelectUtilityClasses(o){return generateUtilityClass("MuiSelect",o)}const selectClasses=generateUtilityClasses("MuiSelect",["root","select","multiple","filled","outlined","standard","disabled","focused","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]);var _span;const _excluded$4=["aria-describedby","aria-label","autoFocus","autoWidth","children","className","defaultOpen","defaultValue","disabled","displayEmpty","error","IconComponent","inputRef","labelId","MenuProps","multiple","name","onBlur","onChange","onClose","onFocus","onOpen","open","readOnly","renderValue","SelectDisplayProps","tabIndex","type","value","variant"],SelectSelect=styled("div",{name:"MuiSelect",slot:"Select",overridesResolver:(o,s)=>{const{ownerState:a}=o;return[{[`&.${selectClasses.select}`]:s.select},{[`&.${selectClasses.select}`]:s[a.variant]},{[`&.${selectClasses.error}`]:s.error},{[`&.${selectClasses.multiple}`]:s.multiple}]}})(nativeSelectSelectStyles,{[`&.${selectClasses.select}`]:{height:"auto",minHeight:"1.4375em",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}}),SelectIcon=styled("svg",{name:"MuiSelect",slot:"Icon",overridesResolver:(o,s)=>{const{ownerState:a}=o;return[s.icon,a.variant&&s[`icon${capitalize$1(a.variant)}`],a.open&&s.iconOpen]}})(nativeSelectIconStyles),SelectNativeInput=styled("input",{shouldForwardProp:o=>slotShouldForwardProp(o)&&o!=="classes",name:"MuiSelect",slot:"NativeInput",overridesResolver:(o,s)=>s.nativeInput})({bottom:0,left:0,position:"absolute",opacity:0,pointerEvents:"none",width:"100%",boxSizing:"border-box"});function areEqualValues(o,s){return typeof s=="object"&&s!==null?o===s:String(o)===String(s)}function isEmpty$2(o){return o==null||typeof o=="string"&&!o.trim()}const useUtilityClasses$2=o=>{const{classes:s,variant:a,disabled:et,multiple:tt,open:rt,error:nt}=o,it={select:["select",a,et&&"disabled",tt&&"multiple",nt&&"error"],icon:["icon",`icon${capitalize$1(a)}`,rt&&"iconOpen",et&&"disabled"],nativeInput:["nativeInput"]};return composeClasses(it,getSelectUtilityClasses,s)},SelectInput=reactExports.forwardRef(function(s,a){var et;const{"aria-describedby":tt,"aria-label":rt,autoFocus:nt,autoWidth:it,children:st,className:ot,defaultOpen:at,defaultValue:lt,disabled:ct,displayEmpty:ht,error:ft=!1,IconComponent:dt,inputRef:pt,labelId:gt,MenuProps:mt={},multiple:yt,name:vt,onBlur:Et,onChange:xt,onClose:wt,onFocus:Rt,onOpen:Ct,open:Ft,readOnly:zt,renderValue:Nt,SelectDisplayProps:Kt={},tabIndex:Yt,value:Bt,variant:Pt="standard"}=s,Dt=_objectWithoutPropertiesLoose$1(s,_excluded$4),[Tt,St]=useControlled({controlled:Bt,default:lt,name:"Select"}),[Mt,jt]=useControlled({controlled:Ft,default:at,name:"Select"}),Gt=reactExports.useRef(null),Ht=reactExports.useRef(null),[At,$t]=reactExports.useState(null),{current:kt}=reactExports.useRef(Ft!=null),[Lt,bt]=reactExports.useState(),It=useForkRef(a,pt),Ut=reactExports.useCallback(Rr=>{Ht.current=Rr,Rr&&$t(Rr)},[]),Wt=At?.parentNode;reactExports.useImperativeHandle(It,()=>({focus:()=>{Ht.current.focus()},node:Gt.current,value:Tt}),[Tt]),reactExports.useEffect(()=>{at&&Mt&&At&&!kt&&(bt(it?null:Wt.clientWidth),Ht.current.focus())},[At,it]),reactExports.useEffect(()=>{nt&&Ht.current.focus()},[nt]),reactExports.useEffect(()=>{if(!gt)return;const Rr=ownerDocument(Ht.current).getElementById(gt);if(Rr){const Dr=()=>{getSelection().isCollapsed&&Ht.current.focus()};return Rr.addEventListener("click",Dr),()=>{Rr.removeEventListener("click",Dr)}}},[gt]);const Xt=(Rr,Dr)=>{Rr?Ct&&Ct(Dr):wt&&wt(Dr),kt||(bt(it?null:Wt.clientWidth),jt(Rr))},Qt=Rr=>{Rr.button===0&&(Rr.preventDefault(),Ht.current.focus(),Xt(!0,Rr))},er=Rr=>{Xt(!1,Rr)},lr=reactExports.Children.toArray(st),pr=Rr=>{const Dr=lr.find(Fr=>Fr.props.value===Rr.target.value);Dr!==void 0&&(St(Dr.props.value),xt&&xt(Rr,Dr))},gr=Rr=>Dr=>{let Fr;if(Dr.currentTarget.hasAttribute("tabindex")){if(yt){Fr=Array.isArray(Tt)?Tt.slice():[];const Kr=Tt.indexOf(Rr.props.value);Kr===-1?Fr.push(Rr.props.value):Fr.splice(Kr,1)}else Fr=Rr.props.value;if(Rr.props.onClick&&Rr.props.onClick(Dr),Tt!==Fr&&(St(Fr),xt)){const Kr=Dr.nativeEvent||Dr,Qr=new Kr.constructor(Kr.type,Kr);Object.defineProperty(Qr,"target",{writable:!0,value:{value:Fr,name:vt}}),xt(Qr,Rr)}yt||Xt(!1,Dr)}},wr=Rr=>{zt||[" ","ArrowUp","ArrowDown","Enter"].indexOf(Rr.key)!==-1&&(Rr.preventDefault(),Xt(!0,Rr))},cr=At!==null&&Mt,Cr=Rr=>{!cr&&Et&&(Object.defineProperty(Rr,"target",{writable:!0,value:{value:Tt,name:vt}}),Et(Rr))};delete Dt["aria-invalid"];let _r,kr;const Ir=[];let tr=!1;(isFilled({value:Tt})||ht)&&(Nt?_r=Nt(Tt):tr=!0);const sr=lr.map(Rr=>{if(!reactExports.isValidElement(Rr))return null;let Dr;if(yt){if(!Array.isArray(Tt))throw new Error(formatMuiErrorMessage$1(2));Dr=Tt.some(Fr=>areEqualValues(Fr,Rr.props.value)),Dr&&tr&&Ir.push(Rr.props.children)}else Dr=areEqualValues(Tt,Rr.props.value),Dr&&tr&&(kr=Rr.props.children);return reactExports.cloneElement(Rr,{"aria-selected":Dr?"true":"false",onClick:gr(Rr),onKeyUp:Fr=>{Fr.key===" "&&Fr.preventDefault(),Rr.props.onKeyUp&&Rr.props.onKeyUp(Fr)},role:"option",selected:Dr,value:void 0,"data-value":Rr.props.value})});tr&&(yt?Ir.length===0?_r=null:_r=Ir.reduce((Rr,Dr,Fr)=>(Rr.push(Dr),Fr<Ir.length-1&&Rr.push(", "),Rr),[]):_r=kr);let vr=Lt;!it&&kt&&At&&(vr=Wt.clientWidth);let xr;typeof Yt<"u"?xr=Yt:xr=ct?null:0;const Er=Kt.id||(vt?`mui-component-select-${vt}`:void 0),Sr=_extends$3({},s,{variant:Pt,value:Tt,open:cr,error:ft}),$r=useUtilityClasses$2(Sr),Or=_extends$3({},mt.PaperProps,(et=mt.slotProps)==null?void 0:et.paper),Nr=useId();return jsxRuntimeExports.jsxs(reactExports.Fragment,{children:[jsxRuntimeExports.jsx(SelectSelect,_extends$3({ref:Ut,tabIndex:xr,role:"combobox","aria-controls":Nr,"aria-disabled":ct?"true":void 0,"aria-expanded":cr?"true":"false","aria-haspopup":"listbox","aria-label":rt,"aria-labelledby":[gt,Er].filter(Boolean).join(" ")||void 0,"aria-describedby":tt,onKeyDown:wr,onMouseDown:ct||zt?null:Qt,onBlur:Cr,onFocus:Rt},Kt,{ownerState:Sr,className:clsx(Kt.className,$r.select,ot),id:Er,children:isEmpty$2(_r)?_span||(_span=jsxRuntimeExports.jsx("span",{className:"notranslate",children:""})):_r})),jsxRuntimeExports.jsx(SelectNativeInput,_extends$3({"aria-invalid":ft,value:Array.isArray(Tt)?Tt.join(","):Tt,name:vt,ref:Gt,"aria-hidden":!0,onChange:pr,tabIndex:-1,disabled:ct,className:$r.nativeInput,autoFocus:nt,ownerState:Sr},Dt)),jsxRuntimeExports.jsx(SelectIcon,{as:dt,className:$r.icon,ownerState:Sr}),jsxRuntimeExports.jsx(Menu,_extends$3({id:`menu-${vt||""}`,anchorEl:Wt,open:cr,onClose:er,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},mt,{MenuListProps:_extends$3({"aria-labelledby":gt,role:"listbox","aria-multiselectable":yt?"true":void 0,disableListWrap:!0,id:Nr},mt.MenuListProps),slotProps:_extends$3({},mt.slotProps,{paper:_extends$3({},Or,{style:_extends$3({minWidth:vr},Or!=null?Or.style:null)})}),children:sr}))]})}),_excluded$3=["autoWidth","children","classes","className","defaultOpen","displayEmpty","IconComponent","id","input","inputProps","label","labelId","MenuProps","multiple","native","onClose","onOpen","open","renderValue","SelectDisplayProps","variant"],_excluded2=["root"],useUtilityClasses$1=o=>{const{classes:s}=o;return s},styledRootConfig={name:"MuiSelect",overridesResolver:(o,s)=>s.root,shouldForwardProp:o=>rootShouldForwardProp(o)&&o!=="variant",slot:"Root"},StyledInput=styled(Input$2,styledRootConfig)(""),StyledOutlinedInput=styled(OutlinedInput,styledRootConfig)(""),StyledFilledInput=styled(FilledInput,styledRootConfig)(""),Select=reactExports.forwardRef(function(s,a){const et=useThemeProps({name:"MuiSelect",props:s}),{autoWidth:tt=!1,children:rt,classes:nt={},className:it,defaultOpen:st=!1,displayEmpty:ot=!1,IconComponent:at=ArrowDropDownIcon,id:lt,input:ct,inputProps:ht,label:ft,labelId:dt,MenuProps:pt,multiple:gt=!1,native:mt=!1,onClose:yt,onOpen:vt,open:Et,renderValue:xt,SelectDisplayProps:wt,variant:Rt="outlined"}=et,Ct=_objectWithoutPropertiesLoose$1(et,_excluded$3),Ft=mt?NativeSelectInput:SelectInput,zt=useFormControl(),Nt=formControlState({props:et,muiFormControl:zt,states:["variant","error"]}),Kt=Nt.variant||Rt,Yt=_extends$3({},et,{variant:Kt,classes:nt}),Bt=useUtilityClasses$1(Yt),Pt=_objectWithoutPropertiesLoose$1(Bt,_excluded2),Dt=ct||{standard:jsxRuntimeExports.jsx(StyledInput,{ownerState:Yt}),outlined:jsxRuntimeExports.jsx(StyledOutlinedInput,{label:ft,ownerState:Yt}),filled:jsxRuntimeExports.jsx(StyledFilledInput,{ownerState:Yt})}[Kt],Tt=useForkRef(a,Dt.ref);return jsxRuntimeExports.jsx(reactExports.Fragment,{children:reactExports.cloneElement(Dt,_extends$3({inputComponent:Ft,inputProps:_extends$3({children:rt,error:Nt.error,IconComponent:at,variant:Kt,type:void 0,multiple:gt},mt?{id:lt}:{autoWidth:tt,defaultOpen:st,displayEmpty:ot,labelId:dt,MenuProps:pt,onClose:yt,onOpen:vt,open:Et,renderValue:xt,SelectDisplayProps:_extends$3({id:lt},wt)},ht,{classes:ht?deepmerge$1(Pt,ht.classes):Pt},ct?ct.props.inputProps:{})},(gt&&mt||ot)&&Kt==="outlined"?{notched:!0}:{},{ref:Tt,className:clsx(Dt.props.className,it,Bt.root)},!ct&&{variant:Kt},Ct))})});Select.muiName="Select";function getTextFieldUtilityClass(o){return generateUtilityClass("MuiTextField",o)}generateUtilityClasses("MuiTextField",["root"]);const _excluded$2=["autoComplete","autoFocus","children","className","color","defaultValue","disabled","error","FormHelperTextProps","fullWidth","helperText","id","InputLabelProps","inputProps","InputProps","inputRef","label","maxRows","minRows","multiline","name","onBlur","onChange","onFocus","placeholder","required","rows","select","SelectProps","type","value","variant"],variantComponent={standard:Input$2,filled:FilledInput,outlined:OutlinedInput},useUtilityClasses=o=>{const{classes:s}=o;return composeClasses({root:["root"]},getTextFieldUtilityClass,s)},TextFieldRoot=styled(FormControl,{name:"MuiTextField",slot:"Root",overridesResolver:(o,s)=>s.root})({}),TextField=reactExports.forwardRef(function(s,a){const et=useThemeProps({props:s,name:"MuiTextField"}),{autoComplete:tt,autoFocus:rt=!1,children:nt,className:it,color:st="primary",defaultValue:ot,disabled:at=!1,error:lt=!1,FormHelperTextProps:ct,fullWidth:ht=!1,helperText:ft,id:dt,InputLabelProps:pt,inputProps:gt,InputProps:mt,inputRef:yt,label:vt,maxRows:Et,minRows:xt,multiline:wt=!1,name:Rt,onBlur:Ct,onChange:Ft,onFocus:zt,placeholder:Nt,required:Kt=!1,rows:Yt,select:Bt=!1,SelectProps:Pt,type:Dt,value:Tt,variant:St="outlined"}=et,Mt=_objectWithoutPropertiesLoose$1(et,_excluded$2),jt=_extends$3({},et,{autoFocus:rt,color:st,disabled:at,error:lt,fullWidth:ht,multiline:wt,required:Kt,select:Bt,variant:St}),Gt=useUtilityClasses(jt),Ht={};St==="outlined"&&(pt&&typeof pt.shrink<"u"&&(Ht.notched=pt.shrink),Ht.label=vt),Bt&&((!Pt||!Pt.native)&&(Ht.id=void 0),Ht["aria-describedby"]=void 0);const At=useId(dt),$t=ft&&At?`${At}-helper-text`:void 0,kt=vt&&At?`${At}-label`:void 0,Lt=variantComponent[St],bt=jsxRuntimeExports.jsx(Lt,_extends$3({"aria-describedby":$t,autoComplete:tt,autoFocus:rt,defaultValue:ot,fullWidth:ht,multiline:wt,name:Rt,rows:Yt,maxRows:Et,minRows:xt,type:Dt,value:Tt,id:At,inputRef:yt,onBlur:Ct,onChange:Ft,onFocus:zt,placeholder:Nt,inputProps:gt},Ht,mt));return jsxRuntimeExports.jsxs(TextFieldRoot,_extends$3({className:clsx(Gt.root,it),disabled:at,error:lt,fullWidth:ht,ref:a,required:Kt,color:st,variant:St,ownerState:jt},Mt,{children:[vt!=null&&vt!==""&&jsxRuntimeExports.jsx(InputLabel,_extends$3({htmlFor:At,id:kt},pt,{children:vt})),Bt?jsxRuntimeExports.jsx(Select,_extends$3({"aria-describedby":$t,id:At,labelId:kt,value:Tt,input:bt},Pt,{children:nt})):bt,ft&&jsxRuntimeExports.jsx(FormHelperText,_extends$3({id:$t},ct,{children:ft}))]}))}),Logo=o=>jsxRuntimeExports.jsx(LogoWrapper,{onClick:o.onClick,sx:{width:o.size?`${o.size}px`:"200px"},"data-testid":"logo-wrapper",children:jsxRuntimeExports.jsxs("svg",{width:"50",height:"50",viewBox:"0 0 627 435",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[jsxRuntimeExports.jsx("path",{opacity:"0.9",d:"M150.25 434.386C136.939 434.397 127.331 421.644 131.014 408.852L244.312 15.3208C246.778 6.7541 254.616 0.854004 263.531 0.854004H358.2C371.482 0.854004 381.074 13.5626 377.434 26.3362L265.291 419.787C262.843 428.373 255.002 434.297 246.073 434.305L150.25 434.386Z",fill:"url(#paint0_linear_367_1004)"}),jsxRuntimeExports.jsx("path",{opacity:"0.9",d:"M480.647 434.408C493.908 434.408 503.497 421.737 499.895 408.975L388.808 15.421C386.376 6.8044 378.513 0.854004 369.56 0.854004H274.842C261.599 0.854004 252.013 13.4915 255.582 26.2439L365.718 419.798C368.135 428.436 376.008 434.408 384.978 434.408H480.647Z",fill:"url(#paint1_linear_367_1004)"}),jsxRuntimeExports.jsx("path",{opacity:"0.9",d:"M600.034 0.854004C613.457 0.854004 623.069 13.8143 619.173 26.659L499.805 420.213C497.248 428.644 489.476 434.408 480.666 434.408H384.803C371.281 434.408 361.657 421.268 365.735 408.376L490.229 14.8219C492.86 6.50614 500.576 0.854004 509.298 0.854004H600.034Z",fill:"url(#paint2_linear_367_1004)"}),jsxRuntimeExports.jsx("path",{opacity:"0.9",d:"M27.2047 0.854004C13.7116 0.854004 4.09023 13.9413 8.11526 26.8201L131.114 420.374C133.723 428.723 141.456 434.408 150.203 434.408H246.705C260.224 434.408 269.849 421.273 265.775 408.381L141.402 14.8273C138.773 6.50882 131.056 0.854004 122.332 0.854004H27.2047Z",fill:"url(#paint3_linear_367_1004)"}),jsxRuntimeExports.jsx("path",{opacity:"0.9",d:"M319.798 239.255C318.596 242.943 313.375 242.933 312.187 239.241L243.904 26.9788C239.751 14.0676 249.38 0.854004 262.943 0.854004H369.946C383.541 0.854004 393.174 14.1259 388.961 27.0517L319.798 239.255Z",fill:"url(#paint4_linear_367_1004)"}),jsxRuntimeExports.jsxs("defs",{children:[jsxRuntimeExports.jsxs("linearGradient",{id:"paint0_linear_367_1004",x1:"308.153",y1:"33.3095",x2:"200.2",y2:"407.071",gradientUnits:"userSpaceOnUse",children:[jsxRuntimeExports.jsx("stop",{stopColor:"#48BBD3"}),jsxRuntimeExports.jsx("stop",{offset:"1",stopColor:"#C1D946"})]}),jsxRuntimeExports.jsxs("linearGradient",{id:"paint1_linear_367_1004",x1:"333.047",y1:"34.9381",x2:"434.368",y2:"405.442",gradientUnits:"userSpaceOnUse",children:[jsxRuntimeExports.jsx("stop",{stopColor:"#40BAB5"}),jsxRuntimeExports.jsx("stop",{offset:"1",stopColor:"#68C749"})]}),jsxRuntimeExports.jsxs("linearGradient",{id:"paint2_linear_367_1004",x1:"549.068",y1:"24.9339",x2:"449.375",y2:"407.071",gradientUnits:"userSpaceOnUse",children:[jsxRuntimeExports.jsx("stop",{stopColor:"#FE9900"}),jsxRuntimeExports.jsx("stop",{offset:"1",stopColor:"#BE007A"})]}),jsxRuntimeExports.jsxs("linearGradient",{id:"paint3_linear_367_1004",x1:"75.6131",y1:"34.9381",x2:"188.568",y2:"402.069",gradientUnits:"userSpaceOnUse",children:[jsxRuntimeExports.jsx("stop",{stopColor:"#26B2FD"}),jsxRuntimeExports.jsx("stop",{offset:"1",stopColor:"#A51687"})]}),jsxRuntimeExports.jsxs("linearGradient",{id:"paint4_linear_367_1004",x1:"316.645",y1:"14.8134",x2:"316.645",y2:"208.15",gradientUnits:"userSpaceOnUse",children:[jsxRuntimeExports.jsx("stop",{stopColor:"#2392C1"}),jsxRuntimeExports.jsx("stop",{offset:"1",stopColor:"#349995"})]})]})]})}),LogoWrapper=styled(Box)(()=>({cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"})),PulseLoader=React.memo(o=>jsxRuntimeExports.jsxs("div",{className:"spinner",...o,children:[jsxRuntimeExports.jsx("div",{className:"double-bounce1"}),jsxRuntimeExports.jsx("div",{className:"double-bounce2"})]}));let Image$1=class extends React.PureComponent{constructor(s={preload:!1,pulseStyle:null}){super(s),this.img=null,this.state={loaded:!1}}static get propTypes(){return{src:PropTypes.string.isRequired}}handleImageLoaded=()=>{setTimeout(()=>this.setState({loaded:!0}),0)};componentDidMount(){const s=this.img?.current;s&&s.complete&&this.handleImageLoaded()}componentWillUnmount(){this.img.src=""}handleImageError=()=>{log$d.warn("Fail image request"),log$d.warn("Retrying..."),this.setState({loaded:!1},()=>{this.forceUpdate()})};getRef=s=>{this.img=s};render(){return jsxRuntimeExports.jsxs("figure",{className:"image-container no-margin",children:[!this.state.loaded&&this.props.preload&&jsxRuntimeExports.jsx(PulseLoader,{style:this.props.pulseStyle}),jsxRuntimeExports.jsx("img",{alt:"",src:this.props.src,onLoad:this.handleImageLoaded,loading:"lazy",onError:this.handleImageError,ref:this.getRef,className:this.state.loaded||!this.props.preload?"loaded-img responsive-img":"locked-img"})]})}};var lottie$1={exports:{}};(function(module,exports){typeof navigator<"u"&&function(o,s){module.exports=s()}(commonjsGlobal,function(){var svgNS="http://www.w3.org/2000/svg",locationHref="",_useWebWorker=!1,initialDefaultFrame=-999999,setWebWorker=function(s){_useWebWorker=!!s},getWebWorker=function(){return _useWebWorker},setLocationHref=function(s){locationHref=s},getLocationHref=function(){return locationHref};function createTag(o){return document.createElement(o)}function extendPrototype(o,s){var a,et=o.length,tt;for(a=0;a<et;a+=1){tt=o[a].prototype;for(var rt in tt)Object.prototype.hasOwnProperty.call(tt,rt)&&(s.prototype[rt]=tt[rt])}}function getDescriptor(o,s){return Object.getOwnPropertyDescriptor(o,s)}function createProxyFunction(o){function s(){}return s.prototype=o,s}var audioControllerFactory=function(){function o(s){this.audios=[],this.audioFactory=s,this._volume=1,this._isMuted=!1}return o.prototype={addAudio:function(a){this.audios.push(a)},pause:function(){var a,et=this.audios.length;for(a=0;a<et;a+=1)this.audios[a].pause()},resume:function(){var a,et=this.audios.length;for(a=0;a<et;a+=1)this.audios[a].resume()},setRate:function(a){var et,tt=this.audios.length;for(et=0;et<tt;et+=1)this.audios[et].setRate(a)},createAudio:function(a){return this.audioFactory?this.audioFactory(a):window.Howl?new window.Howl({src:[a]}):{isPlaying:!1,play:function(){this.isPlaying=!0},seek:function(){this.isPlaying=!1},playing:function(){},rate:function(){},setVolume:function(){}}},setAudioFactory:function(a){this.audioFactory=a},setVolume:function(a){this._volume=a,this._updateVolume()},mute:function(){this._isMuted=!0,this._updateVolume()},unmute:function(){this._isMuted=!1,this._updateVolume()},getVolume:function(){return this._volume},_updateVolume:function(){var a,et=this.audios.length;for(a=0;a<et;a+=1)this.audios[a].volume(this._volume*(this._isMuted?0:1))}},function(){return new o}}(),createTypedArray=function(){function o(a,et){var tt=0,rt=[],nt;switch(a){case"int16":case"uint8c":nt=1;break;default:nt=1.1;break}for(tt=0;tt<et;tt+=1)rt.push(nt);return rt}function s(a,et){return a==="float32"?new Float32Array(et):a==="int16"?new Int16Array(et):a==="uint8c"?new Uint8ClampedArray(et):o(a,et)}return typeof Uint8ClampedArray=="function"&&typeof Float32Array=="function"?s:o}();function createSizedArray(o){return Array.apply(null,{length:o})}function _typeof$6(o){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof$6=function(a){return typeof a}:_typeof$6=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof$6(o)}var subframeEnabled=!0,expressionsPlugin=null,expressionsInterfaces=null,idPrefix$1="",isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),bmPow=Math.pow,bmSqrt=Math.sqrt,bmFloor=Math.floor,bmMax=Math.max,bmMin=Math.min,BMMath={};(function(){var o=["abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","cbrt","expm1","clz32","cos","cosh","exp","floor","fround","hypot","imul","log","log1p","log2","log10","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc","E","LN10","LN2","LOG10E","LOG2E","PI","SQRT1_2","SQRT2"],s,a=o.length;for(s=0;s<a;s+=1)BMMath[o[s]]=Math[o[s]]})(),BMMath.random=Math.random,BMMath.abs=function(o){var s=_typeof$6(o);if(s==="object"&&o.length){var a=createSizedArray(o.length),et,tt=o.length;for(et=0;et<tt;et+=1)a[et]=Math.abs(o[et]);return a}return Math.abs(o)};var defaultCurveSegments=150,degToRads=Math.PI/180,roundCorner=.5519;function styleDiv(o){o.style.position="absolute",o.style.top=0,o.style.left=0,o.style.display="block",o.style.transformOrigin="0 0",o.style.webkitTransformOrigin="0 0",o.style.backfaceVisibility="visible",o.style.webkitBackfaceVisibility="visible",o.style.transformStyle="preserve-3d",o.style.webkitTransformStyle="preserve-3d",o.style.mozTransformStyle="preserve-3d"}function BMEnterFrameEvent(o,s,a,et){this.type=o,this.currentTime=s,this.totalTime=a,this.direction=et<0?-1:1}function BMCompleteEvent(o,s){this.type=o,this.direction=s<0?-1:1}function BMCompleteLoopEvent(o,s,a,et){this.type=o,this.currentLoop=a,this.totalLoops=s,this.direction=et<0?-1:1}function BMSegmentStartEvent(o,s,a){this.type=o,this.firstFrame=s,this.totalFrames=a}function BMDestroyEvent(o,s){this.type=o,this.target=s}function BMRenderFrameErrorEvent(o,s){this.type="renderFrameError",this.nativeError=o,this.currentTime=s}function BMConfigErrorEvent(o){this.type="configError",this.nativeError=o}var createElementID=function(){var o=0;return function(){return o+=1,idPrefix$1+"__lottie_element_"+o}}();function HSVtoRGB(o,s,a){var et,tt,rt,nt,it,st,ot,at;switch(nt=Math.floor(o*6),it=o*6-nt,st=a*(1-s),ot=a*(1-it*s),at=a*(1-(1-it)*s),nt%6){case 0:et=a,tt=at,rt=st;break;case 1:et=ot,tt=a,rt=st;break;case 2:et=st,tt=a,rt=at;break;case 3:et=st,tt=ot,rt=a;break;case 4:et=at,tt=st,rt=a;break;case 5:et=a,tt=st,rt=ot;break}return[et,tt,rt]}function RGBtoHSV(o,s,a){var et=Math.max(o,s,a),tt=Math.min(o,s,a),rt=et-tt,nt,it=et===0?0:rt/et,st=et/255;switch(et){case tt:nt=0;break;case o:nt=s-a+rt*(s<a?6:0),nt/=6*rt;break;case s:nt=a-o+rt*2,nt/=6*rt;break;case a:nt=o-s+rt*4,nt/=6*rt;break}return[nt,it,st]}function addSaturationToRGB(o,s){var a=RGBtoHSV(o[0]*255,o[1]*255,o[2]*255);return a[1]+=s,a[1]>1?a[1]=1:a[1]<=0&&(a[1]=0),HSVtoRGB(a[0],a[1],a[2])}function addBrightnessToRGB(o,s){var a=RGBtoHSV(o[0]*255,o[1]*255,o[2]*255);return a[2]+=s,a[2]>1?a[2]=1:a[2]<0&&(a[2]=0),HSVtoRGB(a[0],a[1],a[2])}function addHueToRGB(o,s){var a=RGBtoHSV(o[0]*255,o[1]*255,o[2]*255);return a[0]+=s/360,a[0]>1?a[0]-=1:a[0]<0&&(a[0]+=1),HSVtoRGB(a[0],a[1],a[2])}var rgbToHex=function(){var o=[],s,a;for(s=0;s<256;s+=1)a=s.toString(16),o[s]=a.length===1?"0"+a:a;return function(et,tt,rt){return et<0&&(et=0),tt<0&&(tt=0),rt<0&&(rt=0),"#"+o[et]+o[tt]+o[rt]}}(),setSubframeEnabled=function(s){subframeEnabled=!!s},getSubframeEnabled=function(){return subframeEnabled},setExpressionsPlugin=function(s){expressionsPlugin=s},getExpressionsPlugin=function(){return expressionsPlugin},setExpressionInterfaces=function(s){expressionsInterfaces=s},getExpressionInterfaces=function(){return expressionsInterfaces},setDefaultCurveSegments=function(s){defaultCurveSegments=s},getDefaultCurveSegments=function(){return defaultCurveSegments},setIdPrefix=function(s){idPrefix$1=s};function createNS(o){return document.createElementNS(svgNS,o)}function _typeof$5(o){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof$5=function(a){return typeof a}:_typeof$5=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof$5(o)}var dataManager=function(){var o=1,s=[],a,et,tt={onmessage:function(){},postMessage:function(ht){a({data:ht})}},rt={postMessage:function(ht){tt.onmessage({data:ht})}};function nt(ct){if(window.Worker&&window.Blob&&getWebWorker()){var ht=new Blob(["var _workerSelf = self; self.onmessage = ",ct.toString()],{type:"text/javascript"}),ft=URL.createObjectURL(ht);return new Worker(ft)}return a=ct,tt}function it(){et||(et=nt(function(ht){function ft(){function pt(Bt,Pt){var Dt,Tt,St=Bt.length,Mt,jt,Gt,Ht;for(Tt=0;Tt<St;Tt+=1)if(Dt=Bt[Tt],"ks"in Dt&&!Dt.completed){if(Dt.completed=!0,Dt.hasMask){var At=Dt.masksProperties;for(jt=At.length,Mt=0;Mt<jt;Mt+=1)if(At[Mt].pt.k.i)Et(At[Mt].pt.k);else for(Ht=At[Mt].pt.k.length,Gt=0;Gt<Ht;Gt+=1)At[Mt].pt.k[Gt].s&&Et(At[Mt].pt.k[Gt].s[0]),At[Mt].pt.k[Gt].e&&Et(At[Mt].pt.k[Gt].e[0])}Dt.ty===0?(Dt.layers=yt(Dt.refId,Pt),pt(Dt.layers,Pt)):Dt.ty===4?vt(Dt.shapes):Dt.ty===5&&Kt(Dt)}}function gt(Bt,Pt){if(Bt){var Dt=0,Tt=Bt.length;for(Dt=0;Dt<Tt;Dt+=1)Bt[Dt].t===1&&(Bt[Dt].data.layers=yt(Bt[Dt].data.refId,Pt),pt(Bt[Dt].data.layers,Pt))}}function mt(Bt,Pt){for(var Dt=0,Tt=Pt.length;Dt<Tt;){if(Pt[Dt].id===Bt)return Pt[Dt];Dt+=1}return null}function yt(Bt,Pt){var Dt=mt(Bt,Pt);return Dt?Dt.layers.__used?JSON.parse(JSON.stringify(Dt.layers)):(Dt.layers.__used=!0,Dt.layers):null}function vt(Bt){var Pt,Dt=Bt.length,Tt,St;for(Pt=Dt-1;Pt>=0;Pt-=1)if(Bt[Pt].ty==="sh")if(Bt[Pt].ks.k.i)Et(Bt[Pt].ks.k);else for(St=Bt[Pt].ks.k.length,Tt=0;Tt<St;Tt+=1)Bt[Pt].ks.k[Tt].s&&Et(Bt[Pt].ks.k[Tt].s[0]),Bt[Pt].ks.k[Tt].e&&Et(Bt[Pt].ks.k[Tt].e[0]);else Bt[Pt].ty==="gr"&&vt(Bt[Pt].it)}function Et(Bt){var Pt,Dt=Bt.i.length;for(Pt=0;Pt<Dt;Pt+=1)Bt.i[Pt][0]+=Bt.v[Pt][0],Bt.i[Pt][1]+=Bt.v[Pt][1],Bt.o[Pt][0]+=Bt.v[Pt][0],Bt.o[Pt][1]+=Bt.v[Pt][1]}function xt(Bt,Pt){var Dt=Pt?Pt.split("."):[100,100,100];return Bt[0]>Dt[0]?!0:Dt[0]>Bt[0]?!1:Bt[1]>Dt[1]?!0:Dt[1]>Bt[1]?!1:Bt[2]>Dt[2]?!0:Dt[2]>Bt[2]?!1:null}var wt=function(){var Bt=[4,4,14];function Pt(Tt){var St=Tt.t.d;Tt.t.d={k:[{s:St,t:0}]}}function Dt(Tt){var St,Mt=Tt.length;for(St=0;St<Mt;St+=1)Tt[St].ty===5&&Pt(Tt[St])}return function(Tt){if(xt(Bt,Tt.v)&&(Dt(Tt.layers),Tt.assets)){var St,Mt=Tt.assets.length;for(St=0;St<Mt;St+=1)Tt.assets[St].layers&&Dt(Tt.assets[St].layers)}}}(),Rt=function(){var Bt=[4,7,99];return function(Pt){if(Pt.chars&&!xt(Bt,Pt.v)){var Dt,Tt=Pt.chars.length;for(Dt=0;Dt<Tt;Dt+=1){var St=Pt.chars[Dt];St.data&&St.data.shapes&&(vt(St.data.shapes),St.data.ip=0,St.data.op=99999,St.data.st=0,St.data.sr=1,St.data.ks={p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0}},Pt.chars[Dt].t||(St.data.shapes.push({ty:"no"}),St.data.shapes[0].it.push({p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0},sk:{k:0,a:0},sa:{k:0,a:0},ty:"tr"})))}}}}(),Ct=function(){var Bt=[5,7,15];function Pt(Tt){var St=Tt.t.p;typeof St.a=="number"&&(St.a={a:0,k:St.a}),typeof St.p=="number"&&(St.p={a:0,k:St.p}),typeof St.r=="number"&&(St.r={a:0,k:St.r})}function Dt(Tt){var St,Mt=Tt.length;for(St=0;St<Mt;St+=1)Tt[St].ty===5&&Pt(Tt[St])}return function(Tt){if(xt(Bt,Tt.v)&&(Dt(Tt.layers),Tt.assets)){var St,Mt=Tt.assets.length;for(St=0;St<Mt;St+=1)Tt.assets[St].layers&&Dt(Tt.assets[St].layers)}}}(),Ft=function(){var Bt=[4,1,9];function Pt(Tt){var St,Mt=Tt.length,jt,Gt;for(St=0;St<Mt;St+=1)if(Tt[St].ty==="gr")Pt(Tt[St].it);else if(Tt[St].ty==="fl"||Tt[St].ty==="st")if(Tt[St].c.k&&Tt[St].c.k[0].i)for(Gt=Tt[St].c.k.length,jt=0;jt<Gt;jt+=1)Tt[St].c.k[jt].s&&(Tt[St].c.k[jt].s[0]/=255,Tt[St].c.k[jt].s[1]/=255,Tt[St].c.k[jt].s[2]/=255,Tt[St].c.k[jt].s[3]/=255),Tt[St].c.k[jt].e&&(Tt[St].c.k[jt].e[0]/=255,Tt[St].c.k[jt].e[1]/=255,Tt[St].c.k[jt].e[2]/=255,Tt[St].c.k[jt].e[3]/=255);else Tt[St].c.k[0]/=255,Tt[St].c.k[1]/=255,Tt[St].c.k[2]/=255,Tt[St].c.k[3]/=255}function Dt(Tt){var St,Mt=Tt.length;for(St=0;St<Mt;St+=1)Tt[St].ty===4&&Pt(Tt[St].shapes)}return function(Tt){if(xt(Bt,Tt.v)&&(Dt(Tt.layers),Tt.assets)){var St,Mt=Tt.assets.length;for(St=0;St<Mt;St+=1)Tt.assets[St].layers&&Dt(Tt.assets[St].layers)}}}(),zt=function(){var Bt=[4,4,18];function Pt(Tt){var St,Mt=Tt.length,jt,Gt;for(St=Mt-1;St>=0;St-=1)if(Tt[St].ty==="sh")if(Tt[St].ks.k.i)Tt[St].ks.k.c=Tt[St].closed;else for(Gt=Tt[St].ks.k.length,jt=0;jt<Gt;jt+=1)Tt[St].ks.k[jt].s&&(Tt[St].ks.k[jt].s[0].c=Tt[St].closed),Tt[St].ks.k[jt].e&&(Tt[St].ks.k[jt].e[0].c=Tt[St].closed);else Tt[St].ty==="gr"&&Pt(Tt[St].it)}function Dt(Tt){var St,Mt,jt=Tt.length,Gt,Ht,At,$t;for(Mt=0;Mt<jt;Mt+=1){if(St=Tt[Mt],St.hasMask){var kt=St.masksProperties;for(Ht=kt.length,Gt=0;Gt<Ht;Gt+=1)if(kt[Gt].pt.k.i)kt[Gt].pt.k.c=kt[Gt].cl;else for($t=kt[Gt].pt.k.length,At=0;At<$t;At+=1)kt[Gt].pt.k[At].s&&(kt[Gt].pt.k[At].s[0].c=kt[Gt].cl),kt[Gt].pt.k[At].e&&(kt[Gt].pt.k[At].e[0].c=kt[Gt].cl)}St.ty===4&&Pt(St.shapes)}}return function(Tt){if(xt(Bt,Tt.v)&&(Dt(Tt.layers),Tt.assets)){var St,Mt=Tt.assets.length;for(St=0;St<Mt;St+=1)Tt.assets[St].layers&&Dt(Tt.assets[St].layers)}}}();function Nt(Bt){Bt.__complete||(Ft(Bt),wt(Bt),Rt(Bt),Ct(Bt),zt(Bt),pt(Bt.layers,Bt.assets),gt(Bt.chars,Bt.assets),Bt.__complete=!0)}function Kt(Bt){Bt.t.a.length===0&&"m"in Bt.t.p}var Yt={};return Yt.completeData=Nt,Yt.checkColors=Ft,Yt.checkChars=Rt,Yt.checkPathProperties=Ct,Yt.checkShapes=zt,Yt.completeLayers=pt,Yt}if(rt.dataManager||(rt.dataManager=ft()),rt.assetLoader||(rt.assetLoader=function(){function pt(mt){var yt=mt.getResponseHeader("content-type");return yt&&mt.responseType==="json"&&yt.indexOf("json")!==-1||mt.response&&_typeof$5(mt.response)==="object"?mt.response:mt.response&&typeof mt.response=="string"?JSON.parse(mt.response):mt.responseText?JSON.parse(mt.responseText):null}function gt(mt,yt,vt,Et){var xt,wt=new XMLHttpRequest;try{wt.responseType="json"}catch{}wt.onreadystatechange=function(){if(wt.readyState===4)if(wt.status===200)xt=pt(wt),vt(xt);else try{xt=pt(wt),vt(xt)}catch(Rt){Et&&Et(Rt)}};try{wt.open(["G","E","T"].join(""),mt,!0)}catch{wt.open(["G","E","T"].join(""),yt+"/"+mt,!0)}wt.send()}return{load:gt}}()),ht.data.type==="loadAnimation")rt.assetLoader.load(ht.data.path,ht.data.fullPath,function(pt){rt.dataManager.completeData(pt),rt.postMessage({id:ht.data.id,payload:pt,status:"success"})},function(){rt.postMessage({id:ht.data.id,status:"error"})});else if(ht.data.type==="complete"){var dt=ht.data.animation;rt.dataManager.completeData(dt),rt.postMessage({id:ht.data.id,payload:dt,status:"success"})}else ht.data.type==="loadData"&&rt.assetLoader.load(ht.data.path,ht.data.fullPath,function(pt){rt.postMessage({id:ht.data.id,payload:pt,status:"success"})},function(){rt.postMessage({id:ht.data.id,status:"error"})})}),et.onmessage=function(ct){var ht=ct.data,ft=ht.id,dt=s[ft];s[ft]=null,ht.status==="success"?dt.onComplete(ht.payload):dt.onError&&dt.onError()})}function st(ct,ht){o+=1;var ft="processId_"+o;return s[ft]={onComplete:ct,onError:ht},ft}function ot(ct,ht,ft){it();var dt=st(ht,ft);et.postMessage({type:"loadAnimation",path:ct,fullPath:window.location.origin+window.location.pathname,id:dt})}function at(ct,ht,ft){it();var dt=st(ht,ft);et.postMessage({type:"loadData",path:ct,fullPath:window.location.origin+window.location.pathname,id:dt})}function lt(ct,ht,ft){it();var dt=st(ht,ft);et.postMessage({type:"complete",animation:ct,id:dt})}return{loadAnimation:ot,loadData:at,completeAnimation:lt}}(),ImagePreloader=function(){var o=function(){var gt=createTag("canvas");gt.width=1,gt.height=1;var mt=gt.getContext("2d");return mt.fillStyle="rgba(0,0,0,0)",mt.fillRect(0,0,1,1),gt}();function s(){this.loadedAssets+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function a(){this.loadedFootagesCount+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function et(gt,mt,yt){var vt="";if(gt.e)vt=gt.p;else if(mt){var Et=gt.p;Et.indexOf("images/")!==-1&&(Et=Et.split("/")[1]),vt=mt+Et}else vt=yt,vt+=gt.u?gt.u:"",vt+=gt.p;return vt}function tt(gt){var mt=0,yt=setInterval(function(){var vt=gt.getBBox();(vt.width||mt>500)&&(this._imageLoaded(),clearInterval(yt)),mt+=1}.bind(this),50)}function rt(gt){var mt=et(gt,this.assetsPath,this.path),yt=createNS("image");isSafari?this.testImageLoaded(yt):yt.addEventListener("load",this._imageLoaded,!1),yt.addEventListener("error",function(){vt.img=o,this._imageLoaded()}.bind(this),!1),yt.setAttributeNS("http://www.w3.org/1999/xlink","href",mt),this._elementHelper.append?this._elementHelper.append(yt):this._elementHelper.appendChild(yt);var vt={img:yt,assetData:gt};return vt}function nt(gt){var mt=et(gt,this.assetsPath,this.path),yt=createTag("img");yt.crossOrigin="anonymous",yt.addEventListener("load",this._imageLoaded,!1),yt.addEventListener("error",function(){vt.img=o,this._imageLoaded()}.bind(this),!1),yt.src=mt;var vt={img:yt,assetData:gt};return vt}function it(gt){var mt={assetData:gt},yt=et(gt,this.assetsPath,this.path);return dataManager.loadData(yt,function(vt){mt.img=vt,this._footageLoaded()}.bind(this),function(){mt.img={},this._footageLoaded()}.bind(this)),mt}function st(gt,mt){this.imagesLoadedCb=mt;var yt,vt=gt.length;for(yt=0;yt<vt;yt+=1)gt[yt].layers||(!gt[yt].t||gt[yt].t==="seq"?(this.totalImages+=1,this.images.push(this._createImageData(gt[yt]))):gt[yt].t===3&&(this.totalFootages+=1,this.images.push(this.createFootageData(gt[yt]))))}function ot(gt){this.path=gt||""}function at(gt){this.assetsPath=gt||""}function lt(gt){for(var mt=0,yt=this.images.length;mt<yt;){if(this.images[mt].assetData===gt)return this.images[mt].img;mt+=1}return null}function ct(){this.imagesLoadedCb=null,this.images.length=0}function ht(){return this.totalImages===this.loadedAssets}function ft(){return this.totalFootages===this.loadedFootagesCount}function dt(gt,mt){gt==="svg"?(this._elementHelper=mt,this._createImageData=this.createImageData.bind(this)):this._createImageData=this.createImgData.bind(this)}function pt(){this._imageLoaded=s.bind(this),this._footageLoaded=a.bind(this),this.testImageLoaded=tt.bind(this),this.createFootageData=it.bind(this),this.assetsPath="",this.path="",this.totalImages=0,this.totalFootages=0,this.loadedAssets=0,this.loadedFootagesCount=0,this.imagesLoadedCb=null,this.images=[]}return pt.prototype={loadAssets:st,setAssetsPath:at,setPath:ot,loadedImages:ht,loadedFootages:ft,destroy:ct,getAsset:lt,createImgData:nt,createImageData:rt,imageLoaded:s,footageLoaded:a,setCacheType:dt},pt}();function BaseEvent(){}BaseEvent.prototype={triggerEvent:function(s,a){if(this._cbs[s])for(var et=this._cbs[s],tt=0;tt<et.length;tt+=1)et[tt](a)},addEventListener:function(s,a){return this._cbs[s]||(this._cbs[s]=[]),this._cbs[s].push(a),function(){this.removeEventListener(s,a)}.bind(this)},removeEventListener:function(s,a){if(!a)this._cbs[s]=null;else if(this._cbs[s]){for(var et=0,tt=this._cbs[s].length;et<tt;)this._cbs[s][et]===a&&(this._cbs[s].splice(et,1),et-=1,tt-=1),et+=1;this._cbs[s].length||(this._cbs[s]=null)}}};var markerParser=function(){function o(s){for(var a=s.split(`\r
`),et={},tt,rt=0,nt=0;nt<a.length;nt+=1)tt=a[nt].split(":"),tt.length===2&&(et[tt[0]]=tt[1].trim(),rt+=1);if(rt===0)throw new Error;return et}return function(s){for(var a=[],et=0;et<s.length;et+=1){var tt=s[et],rt={time:tt.tm,duration:tt.dr};try{rt.payload=JSON.parse(s[et].cm)}catch{try{rt.payload=o(s[et].cm)}catch{rt.payload={name:s[et].cm}}}a.push(rt)}return a}}(),ProjectInterface=function(){function o(s){this.compositions.push(s)}return function(){function s(a){for(var et=0,tt=this.compositions.length;et<tt;){if(this.compositions[et].data&&this.compositions[et].data.nm===a)return this.compositions[et].prepareFrame&&this.compositions[et].data.xt&&this.compositions[et].prepareFrame(this.currentFrame),this.compositions[et].compInterface;et+=1}return null}return s.compositions=[],s.currentFrame=0,s.registerComposition=o,s}}(),renderers={},registerRenderer=function(s,a){renderers[s]=a};function getRenderer(o){return renderers[o]}function getRegisteredRenderer(){if(renderers.canvas)return"canvas";for(var o in renderers)if(renderers[o])return o;return""}function _typeof$4(o){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof$4=function(a){return typeof a}:_typeof$4=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof$4(o)}var AnimationItem=function(){this._cbs=[],this.name="",this.path="",this.isLoaded=!1,this.currentFrame=0,this.currentRawFrame=0,this.firstFrame=0,this.totalFrames=0,this.frameRate=0,this.frameMult=0,this.playSpeed=1,this.playDirection=1,this.playCount=0,this.animationData={},this.assets=[],this.isPaused=!0,this.autoplay=!1,this.loop=!0,this.renderer=null,this.animationID=createElementID(),this.assetsPath="",this.timeCompleted=0,this.segmentPos=0,this.isSubframeEnabled=getSubframeEnabled(),this.segments=[],this._idle=!0,this._completedLoop=!1,this.projectInterface=ProjectInterface(),this.imagePreloader=new ImagePreloader,this.audioController=audioControllerFactory(),this.markers=[],this.configAnimation=this.configAnimation.bind(this),this.onSetupError=this.onSetupError.bind(this),this.onSegmentComplete=this.onSegmentComplete.bind(this),this.drawnFrameEvent=new BMEnterFrameEvent("drawnFrame",0,0,0),this.expressionsPlugin=getExpressionsPlugin()};extendPrototype([BaseEvent],AnimationItem),AnimationItem.prototype.setParams=function(o){(o.wrapper||o.container)&&(this.wrapper=o.wrapper||o.container);var s="svg";o.animType?s=o.animType:o.renderer&&(s=o.renderer);var a=getRenderer(s);this.renderer=new a(this,o.rendererSettings),this.imagePreloader.setCacheType(s,this.renderer.globalData.defs),this.renderer.setProjectInterface(this.projectInterface),this.animType=s,o.loop===""||o.loop===null||o.loop===void 0||o.loop===!0?this.loop=!0:o.loop===!1?this.loop=!1:this.loop=parseInt(o.loop,10),this.autoplay="autoplay"in o?o.autoplay:!0,this.name=o.name?o.name:"",this.autoloadSegments=Object.prototype.hasOwnProperty.call(o,"autoloadSegments")?o.autoloadSegments:!0,this.assetsPath=o.assetsPath,this.initialSegment=o.initialSegment,o.audioFactory&&this.audioController.setAudioFactory(o.audioFactory),o.animationData?this.setupAnimation(o.animationData):o.path&&(o.path.lastIndexOf("\\")!==-1?this.path=o.path.substr(0,o.path.lastIndexOf("\\")+1):this.path=o.path.substr(0,o.path.lastIndexOf("/")+1),this.fileName=o.path.substr(o.path.lastIndexOf("/")+1),this.fileName=this.fileName.substr(0,this.fileName.lastIndexOf(".json")),dataManager.loadAnimation(o.path,this.configAnimation,this.onSetupError))},AnimationItem.prototype.onSetupError=function(){this.trigger("data_failed")},AnimationItem.prototype.setupAnimation=function(o){dataManager.completeAnimation(o,this.configAnimation)},AnimationItem.prototype.setData=function(o,s){s&&_typeof$4(s)!=="object"&&(s=JSON.parse(s));var a={wrapper:o,animationData:s},et=o.attributes;a.path=et.getNamedItem("data-animation-path")?et.getNamedItem("data-animation-path").value:et.getNamedItem("data-bm-path")?et.getNamedItem("data-bm-path").value:et.getNamedItem("bm-path")?et.getNamedItem("bm-path").value:"",a.animType=et.getNamedItem("data-anim-type")?et.getNamedItem("data-anim-type").value:et.getNamedItem("data-bm-type")?et.getNamedItem("data-bm-type").value:et.getNamedItem("bm-type")?et.getNamedItem("bm-type").value:et.getNamedItem("data-bm-renderer")?et.getNamedItem("data-bm-renderer").value:et.getNamedItem("bm-renderer")?et.getNamedItem("bm-renderer").value:getRegisteredRenderer()||"canvas";var tt=et.getNamedItem("data-anim-loop")?et.getNamedItem("data-anim-loop").value:et.getNamedItem("data-bm-loop")?et.getNamedItem("data-bm-loop").value:et.getNamedItem("bm-loop")?et.getNamedItem("bm-loop").value:"";tt==="false"?a.loop=!1:tt==="true"?a.loop=!0:tt!==""&&(a.loop=parseInt(tt,10));var rt=et.getNamedItem("data-anim-autoplay")?et.getNamedItem("data-anim-autoplay").value:et.getNamedItem("data-bm-autoplay")?et.getNamedItem("data-bm-autoplay").value:et.getNamedItem("bm-autoplay")?et.getNamedItem("bm-autoplay").value:!0;a.autoplay=rt!=="false",a.name=et.getNamedItem("data-name")?et.getNamedItem("data-name").value:et.getNamedItem("data-bm-name")?et.getNamedItem("data-bm-name").value:et.getNamedItem("bm-name")?et.getNamedItem("bm-name").value:"";var nt=et.getNamedItem("data-anim-prerender")?et.getNamedItem("data-anim-prerender").value:et.getNamedItem("data-bm-prerender")?et.getNamedItem("data-bm-prerender").value:et.getNamedItem("bm-prerender")?et.getNamedItem("bm-prerender").value:"";nt==="false"&&(a.prerender=!1),a.path?this.setParams(a):this.trigger("destroy")},AnimationItem.prototype.includeLayers=function(o){o.op>this.animationData.op&&(this.animationData.op=o.op,this.totalFrames=Math.floor(o.op-this.animationData.ip));var s=this.animationData.layers,a,et=s.length,tt=o.layers,rt,nt=tt.length;for(rt=0;rt<nt;rt+=1)for(a=0;a<et;){if(s[a].id===tt[rt].id){s[a]=tt[rt];break}a+=1}if((o.chars||o.fonts)&&(this.renderer.globalData.fontManager.addChars(o.chars),this.renderer.globalData.fontManager.addFonts(o.fonts,this.renderer.globalData.defs)),o.assets)for(et=o.assets.length,a=0;a<et;a+=1)this.animationData.assets.push(o.assets[a]);this.animationData.__complete=!1,dataManager.completeAnimation(this.animationData,this.onSegmentComplete)},AnimationItem.prototype.onSegmentComplete=function(o){this.animationData=o;var s=getExpressionsPlugin();s&&s.initExpressions(this),this.loadNextSegment()},AnimationItem.prototype.loadNextSegment=function(){var o=this.animationData.segments;if(!o||o.length===0||!this.autoloadSegments){this.trigger("data_ready"),this.timeCompleted=this.totalFrames;return}var s=o.shift();this.timeCompleted=s.time*this.frameRate;var a=this.path+this.fileName+"_"+this.segmentPos+".json";this.segmentPos+=1,dataManager.loadData(a,this.includeLayers.bind(this),function(){this.trigger("data_failed")}.bind(this))},AnimationItem.prototype.loadSegments=function(){var o=this.animationData.segments;o||(this.timeCompleted=this.totalFrames),this.loadNextSegment()},AnimationItem.prototype.imagesLoaded=function(){this.trigger("loaded_images"),this.checkLoaded()},AnimationItem.prototype.preloadImages=function(){this.imagePreloader.setAssetsPath(this.assetsPath),this.imagePreloader.setPath(this.path),this.imagePreloader.loadAssets(this.animationData.assets,this.imagesLoaded.bind(this))},AnimationItem.prototype.configAnimation=function(o){if(this.renderer)try{this.animationData=o,this.initialSegment?(this.totalFrames=Math.floor(this.initialSegment[1]-this.initialSegment[0]),this.firstFrame=Math.round(this.initialSegment[0])):(this.totalFrames=Math.floor(this.animationData.op-this.animationData.ip),this.firstFrame=Math.round(this.animationData.ip)),this.renderer.configAnimation(o),o.assets||(o.assets=[]),this.assets=this.animationData.assets,this.frameRate=this.animationData.fr,this.frameMult=this.animationData.fr/1e3,this.renderer.searchExtraCompositions(o.assets),this.markers=markerParser(o.markers||[]),this.trigger("config_ready"),this.preloadImages(),this.loadSegments(),this.updaFrameModifier(),this.waitForFontsLoaded(),this.isPaused&&this.audioController.pause()}catch(s){this.triggerConfigError(s)}},AnimationItem.prototype.waitForFontsLoaded=function(){this.renderer&&(this.renderer.globalData.fontManager.isLoaded?this.checkLoaded():setTimeout(this.waitForFontsLoaded.bind(this),20))},AnimationItem.prototype.checkLoaded=function(){if(!this.isLoaded&&this.renderer.globalData.fontManager.isLoaded&&(this.imagePreloader.loadedImages()||this.renderer.rendererType!=="canvas")&&this.imagePreloader.loadedFootages()){this.isLoaded=!0;var o=getExpressionsPlugin();o&&o.initExpressions(this),this.renderer.initItems(),setTimeout(function(){this.trigger("DOMLoaded")}.bind(this),0),this.gotoFrame(),this.autoplay&&this.play()}},AnimationItem.prototype.resize=function(o,s){var a=typeof o=="number"?o:void 0,et=typeof s=="number"?s:void 0;this.renderer.updateContainerSize(a,et)},AnimationItem.prototype.setSubframe=function(o){this.isSubframeEnabled=!!o},AnimationItem.prototype.gotoFrame=function(){this.currentFrame=this.isSubframeEnabled?this.currentRawFrame:~~this.currentRawFrame,this.timeCompleted!==this.totalFrames&&this.currentFrame>this.timeCompleted&&(this.currentFrame=this.timeCompleted),this.trigger("enterFrame"),this.renderFrame(),this.trigger("drawnFrame")},AnimationItem.prototype.renderFrame=function(){if(!(this.isLoaded===!1||!this.renderer))try{this.expressionsPlugin&&this.expressionsPlugin.resetFrame(),this.renderer.renderFrame(this.currentFrame+this.firstFrame)}catch(o){this.triggerRenderFrameError(o)}},AnimationItem.prototype.play=function(o){o&&this.name!==o||this.isPaused===!0&&(this.isPaused=!1,this.trigger("_play"),this.audioController.resume(),this._idle&&(this._idle=!1,this.trigger("_active")))},AnimationItem.prototype.pause=function(o){o&&this.name!==o||this.isPaused===!1&&(this.isPaused=!0,this.trigger("_pause"),this._idle=!0,this.trigger("_idle"),this.audioController.pause())},AnimationItem.prototype.togglePause=function(o){o&&this.name!==o||(this.isPaused===!0?this.play():this.pause())},AnimationItem.prototype.stop=function(o){o&&this.name!==o||(this.pause(),this.playCount=0,this._completedLoop=!1,this.setCurrentRawFrameValue(0))},AnimationItem.prototype.getMarkerData=function(o){for(var s,a=0;a<this.markers.length;a+=1)if(s=this.markers[a],s.payload&&s.payload.name===o)return s;return null},AnimationItem.prototype.goToAndStop=function(o,s,a){if(!(a&&this.name!==a)){var et=Number(o);if(isNaN(et)){var tt=this.getMarkerData(o);tt&&this.goToAndStop(tt.time,!0)}else s?this.setCurrentRawFrameValue(o):this.setCurrentRawFrameValue(o*this.frameModifier);this.pause()}},AnimationItem.prototype.goToAndPlay=function(o,s,a){if(!(a&&this.name!==a)){var et=Number(o);if(isNaN(et)){var tt=this.getMarkerData(o);tt&&(tt.duration?this.playSegments([tt.time,tt.time+tt.duration],!0):this.goToAndStop(tt.time,!0))}else this.goToAndStop(et,s,a);this.play()}},AnimationItem.prototype.advanceTime=function(o){if(!(this.isPaused===!0||this.isLoaded===!1)){var s=this.currentRawFrame+o*this.frameModifier,a=!1;s>=this.totalFrames-1&&this.frameModifier>0?!this.loop||this.playCount===this.loop?this.checkSegments(s>this.totalFrames?s%this.totalFrames:0)||(a=!0,s=this.totalFrames-1):s>=this.totalFrames?(this.playCount+=1,this.checkSegments(s%this.totalFrames)||(this.setCurrentRawFrameValue(s%this.totalFrames),this._completedLoop=!0,this.trigger("loopComplete"))):this.setCurrentRawFrameValue(s):s<0?this.checkSegments(s%this.totalFrames)||(this.loop&&!(this.playCount--<=0&&this.loop!==!0)?(this.setCurrentRawFrameValue(this.totalFrames+s%this.totalFrames),this._completedLoop?this.trigger("loopComplete"):this._completedLoop=!0):(a=!0,s=0)):this.setCurrentRawFrameValue(s),a&&(this.setCurrentRawFrameValue(s),this.pause(),this.trigger("complete"))}},AnimationItem.prototype.adjustSegment=function(o,s){this.playCount=0,o[1]<o[0]?(this.frameModifier>0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(-1)),this.totalFrames=o[0]-o[1],this.timeCompleted=this.totalFrames,this.firstFrame=o[1],this.setCurrentRawFrameValue(this.totalFrames-.001-s)):o[1]>o[0]&&(this.frameModifier<0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(1)),this.totalFrames=o[1]-o[0],this.timeCompleted=this.totalFrames,this.firstFrame=o[0],this.setCurrentRawFrameValue(.001+s)),this.trigger("segmentStart")},AnimationItem.prototype.setSegment=function(o,s){var a=-1;this.isPaused&&(this.currentRawFrame+this.firstFrame<o?a=o:this.currentRawFrame+this.firstFrame>s&&(a=s-o)),this.firstFrame=o,this.totalFrames=s-o,this.timeCompleted=this.totalFrames,a!==-1&&this.goToAndStop(a,!0)},AnimationItem.prototype.playSegments=function(o,s){if(s&&(this.segments.length=0),_typeof$4(o[0])==="object"){var a,et=o.length;for(a=0;a<et;a+=1)this.segments.push(o[a])}else this.segments.push(o);this.segments.length&&s&&this.adjustSegment(this.segments.shift(),0),this.isPaused&&this.play()},AnimationItem.prototype.resetSegments=function(o){this.segments.length=0,this.segments.push([this.animationData.ip,this.animationData.op]),o&&this.checkSegments(0)},AnimationItem.prototype.checkSegments=function(o){return this.segments.length?(this.adjustSegment(this.segments.shift(),o),!0):!1},AnimationItem.prototype.destroy=function(o){o&&this.name!==o||!this.renderer||(this.renderer.destroy(),this.imagePreloader.destroy(),this.trigger("destroy"),this._cbs=null,this.onEnterFrame=null,this.onLoopComplete=null,this.onComplete=null,this.onSegmentStart=null,this.onDestroy=null,this.renderer=null,this.expressionsPlugin=null,this.imagePreloader=null,this.projectInterface=null)},AnimationItem.prototype.setCurrentRawFrameValue=function(o){this.currentRawFrame=o,this.gotoFrame()},AnimationItem.prototype.setSpeed=function(o){this.playSpeed=o,this.updaFrameModifier()},AnimationItem.prototype.setDirection=function(o){this.playDirection=o<0?-1:1,this.updaFrameModifier()},AnimationItem.prototype.setLoop=function(o){this.loop=o},AnimationItem.prototype.setVolume=function(o,s){s&&this.name!==s||this.audioController.setVolume(o)},AnimationItem.prototype.getVolume=function(){return this.audioController.getVolume()},AnimationItem.prototype.mute=function(o){o&&this.name!==o||this.audioController.mute()},AnimationItem.prototype.unmute=function(o){o&&this.name!==o||this.audioController.unmute()},AnimationItem.prototype.updaFrameModifier=function(){this.frameModifier=this.frameMult*this.playSpeed*this.playDirection,this.audioController.setRate(this.playSpeed*this.playDirection)},AnimationItem.prototype.getPath=function(){return this.path},AnimationItem.prototype.getAssetsPath=function(o){var s="";if(o.e)s=o.p;else if(this.assetsPath){var a=o.p;a.indexOf("images/")!==-1&&(a=a.split("/")[1]),s=this.assetsPath+a}else s=this.path,s+=o.u?o.u:"",s+=o.p;return s},AnimationItem.prototype.getAssetData=function(o){for(var s=0,a=this.assets.length;s<a;){if(o===this.assets[s].id)return this.assets[s];s+=1}return null},AnimationItem.prototype.hide=function(){this.renderer.hide()},AnimationItem.prototype.show=function(){this.renderer.show()},AnimationItem.prototype.getDuration=function(o){return o?this.totalFrames:this.totalFrames/this.frameRate},AnimationItem.prototype.updateDocumentData=function(o,s,a){try{var et=this.renderer.getElementByPath(o);et.updateDocumentData(s,a)}catch{}},AnimationItem.prototype.trigger=function(o){if(this._cbs&&this._cbs[o])switch(o){case"enterFrame":this.triggerEvent(o,new BMEnterFrameEvent(o,this.currentFrame,this.totalFrames,this.frameModifier));break;case"drawnFrame":this.drawnFrameEvent.currentTime=this.currentFrame,this.drawnFrameEvent.totalTime=this.totalFrames,this.drawnFrameEvent.direction=this.frameModifier,this.triggerEvent(o,this.drawnFrameEvent);break;case"loopComplete":this.triggerEvent(o,new BMCompleteLoopEvent(o,this.loop,this.playCount,this.frameMult));break;case"complete":this.triggerEvent(o,new BMCompleteEvent(o,this.frameMult));break;case"segmentStart":this.triggerEvent(o,new BMSegmentStartEvent(o,this.firstFrame,this.totalFrames));break;case"destroy":this.triggerEvent(o,new BMDestroyEvent(o,this));break;default:this.triggerEvent(o)}o==="enterFrame"&&this.onEnterFrame&&this.onEnterFrame.call(this,new BMEnterFrameEvent(o,this.currentFrame,this.totalFrames,this.frameMult)),o==="loopComplete"&&this.onLoopComplete&&this.onLoopComplete.call(this,new BMCompleteLoopEvent(o,this.loop,this.playCount,this.frameMult)),o==="complete"&&this.onComplete&&this.onComplete.call(this,new BMCompleteEvent(o,this.frameMult)),o==="segmentStart"&&this.onSegmentStart&&this.onSegmentStart.call(this,new BMSegmentStartEvent(o,this.firstFrame,this.totalFrames)),o==="destroy"&&this.onDestroy&&this.onDestroy.call(this,new BMDestroyEvent(o,this))},AnimationItem.prototype.triggerRenderFrameError=function(o){var s=new BMRenderFrameErrorEvent(o,this.currentFrame);this.triggerEvent("error",s),this.onError&&this.onError.call(this,s)},AnimationItem.prototype.triggerConfigError=function(o){var s=new BMConfigErrorEvent(o,this.currentFrame);this.triggerEvent("error",s),this.onError&&this.onError.call(this,s)};var animationManager=function(){var o={},s=[],a=0,et=0,tt=0,rt=!0,nt=!1;function it(Pt){for(var Dt=0,Tt=Pt.target;Dt<et;)s[Dt].animation===Tt&&(s.splice(Dt,1),Dt-=1,et-=1,Tt.isPaused||lt()),Dt+=1}function st(Pt,Dt){if(!Pt)return null;for(var Tt=0;Tt<et;){if(s[Tt].elem===Pt&&s[Tt].elem!==null)return s[Tt].animation;Tt+=1}var St=new AnimationItem;return ct(St,Pt),St.setData(Pt,Dt),St}function ot(){var Pt,Dt=s.length,Tt=[];for(Pt=0;Pt<Dt;Pt+=1)Tt.push(s[Pt].animation);return Tt}function at(){tt+=1,Ft()}function lt(){tt-=1}function ct(Pt,Dt){Pt.addEventListener("destroy",it),Pt.addEventListener("_active",at),Pt.addEventListener("_idle",lt),s.push({elem:Dt,animation:Pt}),et+=1}function ht(Pt){var Dt=new AnimationItem;return ct(Dt,null),Dt.setParams(Pt),Dt}function ft(Pt,Dt){var Tt;for(Tt=0;Tt<et;Tt+=1)s[Tt].animation.setSpeed(Pt,Dt)}function dt(Pt,Dt){var Tt;for(Tt=0;Tt<et;Tt+=1)s[Tt].animation.setDirection(Pt,Dt)}function pt(Pt){var Dt;for(Dt=0;Dt<et;Dt+=1)s[Dt].animation.play(Pt)}function gt(Pt){var Dt=Pt-a,Tt;for(Tt=0;Tt<et;Tt+=1)s[Tt].animation.advanceTime(Dt);a=Pt,tt&&!nt?window.requestAnimationFrame(gt):rt=!0}function mt(Pt){a=Pt,window.requestAnimationFrame(gt)}function yt(Pt){var Dt;for(Dt=0;Dt<et;Dt+=1)s[Dt].animation.pause(Pt)}function vt(Pt,Dt,Tt){var St;for(St=0;St<et;St+=1)s[St].animation.goToAndStop(Pt,Dt,Tt)}function Et(Pt){var Dt;for(Dt=0;Dt<et;Dt+=1)s[Dt].animation.stop(Pt)}function xt(Pt){var Dt;for(Dt=0;Dt<et;Dt+=1)s[Dt].animation.togglePause(Pt)}function wt(Pt){var Dt;for(Dt=et-1;Dt>=0;Dt-=1)s[Dt].animation.destroy(Pt)}function Rt(Pt,Dt,Tt){var St=[].concat([].slice.call(document.getElementsByClassName("lottie")),[].slice.call(document.getElementsByClassName("bodymovin"))),Mt,jt=St.length;for(Mt=0;Mt<jt;Mt+=1)Tt&&St[Mt].setAttribute("data-bm-type",Tt),st(St[Mt],Pt);if(Dt&&jt===0){Tt||(Tt="svg");var Gt=document.getElementsByTagName("body")[0];Gt.innerText="";var Ht=createTag("div");Ht.style.width="100%",Ht.style.height="100%",Ht.setAttribute("data-bm-type",Tt),Gt.appendChild(Ht),st(Ht,Pt)}}function Ct(){var Pt;for(Pt=0;Pt<et;Pt+=1)s[Pt].animation.resize()}function Ft(){!nt&&tt&&rt&&(window.requestAnimationFrame(mt),rt=!1)}function zt(){nt=!0}function Nt(){nt=!1,Ft()}function Kt(Pt,Dt){var Tt;for(Tt=0;Tt<et;Tt+=1)s[Tt].animation.setVolume(Pt,Dt)}function Yt(Pt){var Dt;for(Dt=0;Dt<et;Dt+=1)s[Dt].animation.mute(Pt)}function Bt(Pt){var Dt;for(Dt=0;Dt<et;Dt+=1)s[Dt].animation.unmute(Pt)}return o.registerAnimation=st,o.loadAnimation=ht,o.setSpeed=ft,o.setDirection=dt,o.play=pt,o.pause=yt,o.stop=Et,o.togglePause=xt,o.searchAnimations=Rt,o.resize=Ct,o.goToAndStop=vt,o.destroy=wt,o.freeze=zt,o.unfreeze=Nt,o.setVolume=Kt,o.mute=Yt,o.unmute=Bt,o.getRegisteredAnimations=ot,o}(),BezierFactory=function(){var o={};o.getBezierEasing=a;var s={};function a(mt,yt,vt,Et,xt){var wt=xt||("bez_"+mt+"_"+yt+"_"+vt+"_"+Et).replace(/\./g,"p");if(s[wt])return s[wt];var Rt=new gt([mt,yt,vt,Et]);return s[wt]=Rt,Rt}var et=4,tt=.001,rt=1e-7,nt=10,it=11,st=1/(it-1),ot=typeof Float32Array=="function";function at(mt,yt){return 1-3*yt+3*mt}function lt(mt,yt){return 3*yt-6*mt}function ct(mt){return 3*mt}function ht(mt,yt,vt){return((at(yt,vt)*mt+lt(yt,vt))*mt+ct(yt))*mt}function ft(mt,yt,vt){return 3*at(yt,vt)*mt*mt+2*lt(yt,vt)*mt+ct(yt)}function dt(mt,yt,vt,Et,xt){var wt,Rt,Ct=0;do Rt=yt+(vt-yt)/2,wt=ht(Rt,Et,xt)-mt,wt>0?vt=Rt:yt=Rt;while(Math.abs(wt)>rt&&++Ct<nt);return Rt}function pt(mt,yt,vt,Et){for(var xt=0;xt<et;++xt){var wt=ft(yt,vt,Et);if(wt===0)return yt;var Rt=ht(yt,vt,Et)-mt;yt-=Rt/wt}return yt}function gt(mt){this._p=mt,this._mSampleValues=ot?new Float32Array(it):new Array(it),this._precomputed=!1,this.get=this.get.bind(this)}return gt.prototype={get:function(yt){var vt=this._p[0],Et=this._p[1],xt=this._p[2],wt=this._p[3];return this._precomputed||this._precompute(),vt===Et&&xt===wt?yt:yt===0?0:yt===1?1:ht(this._getTForX(yt),Et,wt)},_precompute:function(){var yt=this._p[0],vt=this._p[1],Et=this._p[2],xt=this._p[3];this._precomputed=!0,(yt!==vt||Et!==xt)&&this._calcSampleValues()},_calcSampleValues:function(){for(var yt=this._p[0],vt=this._p[2],Et=0;Et<it;++Et)this._mSampleValues[Et]=ht(Et*st,yt,vt)},_getTForX:function(yt){for(var vt=this._p[0],Et=this._p[2],xt=this._mSampleValues,wt=0,Rt=1,Ct=it-1;Rt!==Ct&&xt[Rt]<=yt;++Rt)wt+=st;--Rt;var Ft=(yt-xt[Rt])/(xt[Rt+1]-xt[Rt]),zt=wt+Ft*st,Nt=ft(zt,vt,Et);return Nt>=tt?pt(yt,zt,vt,Et):Nt===0?zt:dt(yt,wt,wt+st,vt,Et)}},o}(),pooling=function(){function o(s){return s.concat(createSizedArray(s.length))}return{double:o}}(),poolFactory=function(){return function(o,s,a){var et=0,tt=o,rt=createSizedArray(tt),nt={newElement:it,release:st};function it(){var ot;return et?(et-=1,ot=rt[et]):ot=s(),ot}function st(ot){et===tt&&(rt=pooling.double(rt),tt*=2),a&&a(ot),rt[et]=ot,et+=1}return nt}}(),bezierLengthPool=function(){function o(){return{addedLength:0,percents:createTypedArray("float32",getDefaultCurveSegments()),lengths:createTypedArray("float32",getDefaultCurveSegments())}}return poolFactory(8,o)}(),segmentsLengthPool=function(){function o(){return{lengths:[],totalLength:0}}function s(a){var et,tt=a.lengths.length;for(et=0;et<tt;et+=1)bezierLengthPool.release(a.lengths[et]);a.lengths.length=0}return poolFactory(8,o,s)}();function bezFunction(){var o=Math;function s(ct,ht,ft,dt,pt,gt){var mt=ct*dt+ht*pt+ft*gt-pt*dt-gt*ct-ft*ht;return mt>-.001&&mt<.001}function a(ct,ht,ft,dt,pt,gt,mt,yt,vt){if(ft===0&&gt===0&&vt===0)return s(ct,ht,dt,pt,mt,yt);var Et=o.sqrt(o.pow(dt-ct,2)+o.pow(pt-ht,2)+o.pow(gt-ft,2)),xt=o.sqrt(o.pow(mt-ct,2)+o.pow(yt-ht,2)+o.pow(vt-ft,2)),wt=o.sqrt(o.pow(mt-dt,2)+o.pow(yt-pt,2)+o.pow(vt-gt,2)),Rt;return Et>xt?Et>wt?Rt=Et-xt-wt:Rt=wt-xt-Et:wt>xt?Rt=wt-xt-Et:Rt=xt-Et-wt,Rt>-1e-4&&Rt<1e-4}var et=function(){return function(ct,ht,ft,dt){var pt=getDefaultCurveSegments(),gt,mt,yt,vt,Et,xt=0,wt,Rt=[],Ct=[],Ft=bezierLengthPool.newElement();for(yt=ft.length,gt=0;gt<pt;gt+=1){for(Et=gt/(pt-1),wt=0,mt=0;mt<yt;mt+=1)vt=bmPow(1-Et,3)*ct[mt]+3*bmPow(1-Et,2)*Et*ft[mt]+3*(1-Et)*bmPow(Et,2)*dt[mt]+bmPow(Et,3)*ht[mt],Rt[mt]=vt,Ct[mt]!==null&&(wt+=bmPow(Rt[mt]-Ct[mt],2)),Ct[mt]=Rt[mt];wt&&(wt=bmSqrt(wt),xt+=wt),Ft.percents[gt]=Et,Ft.lengths[gt]=xt}return Ft.addedLength=xt,Ft}}();function tt(ct){var ht=segmentsLengthPool.newElement(),ft=ct.c,dt=ct.v,pt=ct.o,gt=ct.i,mt,yt=ct._length,vt=ht.lengths,Et=0;for(mt=0;mt<yt-1;mt+=1)vt[mt]=et(dt[mt],dt[mt+1],pt[mt],gt[mt+1]),Et+=vt[mt].addedLength;return ft&&yt&&(vt[mt]=et(dt[mt],dt[0],pt[mt],gt[0]),Et+=vt[mt].addedLength),ht.totalLength=Et,ht}function rt(ct){this.segmentLength=0,this.points=new Array(ct)}function nt(ct,ht){this.partialLength=ct,this.point=ht}var it=function(){var ct={};return function(ht,ft,dt,pt){var gt=(ht[0]+"_"+ht[1]+"_"+ft[0]+"_"+ft[1]+"_"+dt[0]+"_"+dt[1]+"_"+pt[0]+"_"+pt[1]).replace(/\./g,"p");if(!ct[gt]){var mt=getDefaultCurveSegments(),yt,vt,Et,xt,wt,Rt=0,Ct,Ft,zt=null;ht.length===2&&(ht[0]!==ft[0]||ht[1]!==ft[1])&&s(ht[0],ht[1],ft[0],ft[1],ht[0]+dt[0],ht[1]+dt[1])&&s(ht[0],ht[1],ft[0],ft[1],ft[0]+pt[0],ft[1]+pt[1])&&(mt=2);var Nt=new rt(mt);for(Et=dt.length,yt=0;yt<mt;yt+=1){for(Ft=createSizedArray(Et),wt=yt/(mt-1),Ct=0,vt=0;vt<Et;vt+=1)xt=bmPow(1-wt,3)*ht[vt]+3*bmPow(1-wt,2)*wt*(ht[vt]+dt[vt])+3*(1-wt)*bmPow(wt,2)*(ft[vt]+pt[vt])+bmPow(wt,3)*ft[vt],Ft[vt]=xt,zt!==null&&(Ct+=bmPow(Ft[vt]-zt[vt],2));Ct=bmSqrt(Ct),Rt+=Ct,Nt.points[yt]=new nt(Ct,Ft),zt=Ft}Nt.segmentLength=Rt,ct[gt]=Nt}return ct[gt]}}();function st(ct,ht){var ft=ht.percents,dt=ht.lengths,pt=ft.length,gt=bmFloor((pt-1)*ct),mt=ct*ht.addedLength,yt=0;if(gt===pt-1||gt===0||mt===dt[gt])return ft[gt];for(var vt=dt[gt]>mt?-1:1,Et=!0;Et;)if(dt[gt]<=mt&&dt[gt+1]>mt?(yt=(mt-dt[gt])/(dt[gt+1]-dt[gt]),Et=!1):gt+=vt,gt<0||gt>=pt-1){if(gt===pt-1)return ft[gt];Et=!1}return ft[gt]+(ft[gt+1]-ft[gt])*yt}function ot(ct,ht,ft,dt,pt,gt){var mt=st(pt,gt),yt=1-mt,vt=o.round((yt*yt*yt*ct[0]+(mt*yt*yt+yt*mt*yt+yt*yt*mt)*ft[0]+(mt*mt*yt+yt*mt*mt+mt*yt*mt)*dt[0]+mt*mt*mt*ht[0])*1e3)/1e3,Et=o.round((yt*yt*yt*ct[1]+(mt*yt*yt+yt*mt*yt+yt*yt*mt)*ft[1]+(mt*mt*yt+yt*mt*mt+mt*yt*mt)*dt[1]+mt*mt*mt*ht[1])*1e3)/1e3;return[vt,Et]}var at=createTypedArray("float32",8);function lt(ct,ht,ft,dt,pt,gt,mt){pt<0?pt=0:pt>1&&(pt=1);var yt=st(pt,mt);gt=gt>1?1:gt;var vt=st(gt,mt),Et,xt=ct.length,wt=1-yt,Rt=1-vt,Ct=wt*wt*wt,Ft=yt*wt*wt*3,zt=yt*yt*wt*3,Nt=yt*yt*yt,Kt=wt*wt*Rt,Yt=yt*wt*Rt+wt*yt*Rt+wt*wt*vt,Bt=yt*yt*Rt+wt*yt*vt+yt*wt*vt,Pt=yt*yt*vt,Dt=wt*Rt*Rt,Tt=yt*Rt*Rt+wt*vt*Rt+wt*Rt*vt,St=yt*vt*Rt+wt*vt*vt+yt*Rt*vt,Mt=yt*vt*vt,jt=Rt*Rt*Rt,Gt=vt*Rt*Rt+Rt*vt*Rt+Rt*Rt*vt,Ht=vt*vt*Rt+Rt*vt*vt+vt*Rt*vt,At=vt*vt*vt;for(Et=0;Et<xt;Et+=1)at[Et*4]=o.round((Ct*ct[Et]+Ft*ft[Et]+zt*dt[Et]+Nt*ht[Et])*1e3)/1e3,at[Et*4+1]=o.round((Kt*ct[Et]+Yt*ft[Et]+Bt*dt[Et]+Pt*ht[Et])*1e3)/1e3,at[Et*4+2]=o.round((Dt*ct[Et]+Tt*ft[Et]+St*dt[Et]+Mt*ht[Et])*1e3)/1e3,at[Et*4+3]=o.round((jt*ct[Et]+Gt*ft[Et]+Ht*dt[Et]+At*ht[Et])*1e3)/1e3;return at}return{getSegmentsLength:tt,getNewSegment:lt,getPointInSegment:ot,buildBezierData:it,pointOnLine2D:s,pointOnLine3D:a}}var bez=bezFunction(),initFrame=initialDefaultFrame,mathAbs=Math.abs;function interpolateValue(o,s){var a=this.offsetTime,et;this.propType==="multidimensional"&&(et=createTypedArray("float32",this.pv.length));for(var tt=s.lastIndex,rt=tt,nt=this.keyframes.length-1,it=!0,st,ot,at;it;){if(st=this.keyframes[rt],ot=this.keyframes[rt+1],rt===nt-1&&o>=ot.t-a){st.h&&(st=ot),tt=0;break}if(ot.t-a>o){tt=rt;break}rt<nt-1?rt+=1:(tt=0,it=!1)}at=this.keyframesMetadata[rt]||{};var lt,ct,ht,ft,dt,pt,gt=ot.t-a,mt=st.t-a,yt;if(st.to){at.bezierData||(at.bezierData=bez.buildBezierData(st.s,ot.s||st.e,st.to,st.ti));var vt=at.bezierData;if(o>=gt||o<mt){var Et=o>=gt?vt.points.length-1:0;for(ct=vt.points[Et].point.length,lt=0;lt<ct;lt+=1)et[lt]=vt.points[Et].point[lt]}else{at.__fnct?pt=at.__fnct:(pt=BezierFactory.getBezierEasing(st.o.x,st.o.y,st.i.x,st.i.y,st.n).get,at.__fnct=pt),ht=pt((o-mt)/(gt-mt));var xt=vt.segmentLength*ht,wt,Rt=s.lastFrame<o&&s._lastKeyframeIndex===rt?s._lastAddedLength:0;for(dt=s.lastFrame<o&&s._lastKeyframeIndex===rt?s._lastPoint:0,it=!0,ft=vt.points.length;it;){if(Rt+=vt.points[dt].partialLength,xt===0||ht===0||dt===vt.points.length-1){for(ct=vt.points[dt].point.length,lt=0;lt<ct;lt+=1)et[lt]=vt.points[dt].point[lt];break}else if(xt>=Rt&&xt<Rt+vt.points[dt+1].partialLength){for(wt=(xt-Rt)/vt.points[dt+1].partialLength,ct=vt.points[dt].point.length,lt=0;lt<ct;lt+=1)et[lt]=vt.points[dt].point[lt]+(vt.points[dt+1].point[lt]-vt.points[dt].point[lt])*wt;break}dt<ft-1?dt+=1:it=!1}s._lastPoint=dt,s._lastAddedLength=Rt-vt.points[dt].partialLength,s._lastKeyframeIndex=rt}}else{var Ct,Ft,zt,Nt,Kt;if(nt=st.s.length,yt=ot.s||st.e,this.sh&&st.h!==1)if(o>=gt)et[0]=yt[0],et[1]=yt[1],et[2]=yt[2];else if(o<=mt)et[0]=st.s[0],et[1]=st.s[1],et[2]=st.s[2];else{var Yt=createQuaternion(st.s),Bt=createQuaternion(yt),Pt=(o-mt)/(gt-mt);quaternionToEuler(et,slerp(Yt,Bt,Pt))}else for(rt=0;rt<nt;rt+=1)st.h!==1&&(o>=gt?ht=1:o<mt?ht=0:(st.o.x.constructor===Array?(at.__fnct||(at.__fnct=[]),at.__fnct[rt]?pt=at.__fnct[rt]:(Ct=st.o.x[rt]===void 0?st.o.x[0]:st.o.x[rt],Ft=st.o.y[rt]===void 0?st.o.y[0]:st.o.y[rt],zt=st.i.x[rt]===void 0?st.i.x[0]:st.i.x[rt],Nt=st.i.y[rt]===void 0?st.i.y[0]:st.i.y[rt],pt=BezierFactory.getBezierEasing(Ct,Ft,zt,Nt).get,at.__fnct[rt]=pt)):at.__fnct?pt=at.__fnct:(Ct=st.o.x,Ft=st.o.y,zt=st.i.x,Nt=st.i.y,pt=BezierFactory.getBezierEasing(Ct,Ft,zt,Nt).get,st.keyframeMetadata=pt),ht=pt((o-mt)/(gt-mt)))),yt=ot.s||st.e,Kt=st.h===1?st.s[rt]:st.s[rt]+(yt[rt]-st.s[rt])*ht,this.propType==="multidimensional"?et[rt]=Kt:et=Kt}return s.lastIndex=tt,et}function slerp(o,s,a){var et=[],tt=o[0],rt=o[1],nt=o[2],it=o[3],st=s[0],ot=s[1],at=s[2],lt=s[3],ct,ht,ft,dt,pt;return ht=tt*st+rt*ot+nt*at+it*lt,ht<0&&(ht=-ht,st=-st,ot=-ot,at=-at,lt=-lt),1-ht>1e-6?(ct=Math.acos(ht),ft=Math.sin(ct),dt=Math.sin((1-a)*ct)/ft,pt=Math.sin(a*ct)/ft):(dt=1-a,pt=a),et[0]=dt*tt+pt*st,et[1]=dt*rt+pt*ot,et[2]=dt*nt+pt*at,et[3]=dt*it+pt*lt,et}function quaternionToEuler(o,s){var a=s[0],et=s[1],tt=s[2],rt=s[3],nt=Math.atan2(2*et*rt-2*a*tt,1-2*et*et-2*tt*tt),it=Math.asin(2*a*et+2*tt*rt),st=Math.atan2(2*a*rt-2*et*tt,1-2*a*a-2*tt*tt);o[0]=nt/degToRads,o[1]=it/degToRads,o[2]=st/degToRads}function createQuaternion(o){var s=o[0]*degToRads,a=o[1]*degToRads,et=o[2]*degToRads,tt=Math.cos(s/2),rt=Math.cos(a/2),nt=Math.cos(et/2),it=Math.sin(s/2),st=Math.sin(a/2),ot=Math.sin(et/2),at=tt*rt*nt-it*st*ot,lt=it*st*nt+tt*rt*ot,ct=it*rt*nt+tt*st*ot,ht=tt*st*nt-it*rt*ot;return[lt,ct,ht,at]}function getValueAtCurrentTime(){var o=this.comp.renderedFrame-this.offsetTime,s=this.keyframes[0].t-this.offsetTime,a=this.keyframes[this.keyframes.length-1].t-this.offsetTime;if(!(o===this._caching.lastFrame||this._caching.lastFrame!==initFrame&&(this._caching.lastFrame>=a&&o>=a||this._caching.lastFrame<s&&o<s))){this._caching.lastFrame>=o&&(this._caching._lastKeyframeIndex=-1,this._caching.lastIndex=0);var et=this.interpolateValue(o,this._caching);this.pv=et}return this._caching.lastFrame=o,this.pv}function setVValue(o){var s;if(this.propType==="unidimensional")s=o*this.mult,mathAbs(this.v-s)>1e-5&&(this.v=s,this._mdf=!0);else for(var a=0,et=this.v.length;a<et;)s=o[a]*this.mult,mathAbs(this.v[a]-s)>1e-5&&(this.v[a]=s,this._mdf=!0),a+=1}function processEffectsSequence(){if(!(this.elem.globalData.frameId===this.frameId||!this.effectsSequence.length)){if(this.lock){this.setVValue(this.pv);return}this.lock=!0,this._mdf=this._isFirstFrame;var o,s=this.effectsSequence.length,a=this.kf?this.pv:this.data.k;for(o=0;o<s;o+=1)a=this.effectsSequence[o](a);this.setVValue(a),this._isFirstFrame=!1,this.lock=!1,this.frameId=this.elem.globalData.frameId}}function addEffect(o){this.effectsSequence.push(o),this.container.addDynamicProperty(this)}function ValueProperty(o,s,a,et){this.propType="unidimensional",this.mult=a||1,this.data=s,this.v=a?s.k*a:s.k,this.pv=s.k,this._mdf=!1,this.elem=o,this.container=et,this.comp=o.comp,this.k=!1,this.kf=!1,this.vel=0,this.effectsSequence=[],this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function MultiDimensionalProperty(o,s,a,et){this.propType="multidimensional",this.mult=a||1,this.data=s,this._mdf=!1,this.elem=o,this.container=et,this.comp=o.comp,this.k=!1,this.kf=!1,this.frameId=-1;var tt,rt=s.k.length;for(this.v=createTypedArray("float32",rt),this.pv=createTypedArray("float32",rt),this.vel=createTypedArray("float32",rt),tt=0;tt<rt;tt+=1)this.v[tt]=s.k[tt]*this.mult,this.pv[tt]=s.k[tt];this._isFirstFrame=!0,this.effectsSequence=[],this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function KeyframedValueProperty(o,s,a,et){this.propType="unidimensional",this.keyframes=s.k,this.keyframesMetadata=[],this.offsetTime=o.data.st,this.frameId=-1,this._caching={lastFrame:initFrame,lastIndex:0,value:0,_lastKeyframeIndex:-1},this.k=!0,this.kf=!0,this.data=s,this.mult=a||1,this.elem=o,this.container=et,this.comp=o.comp,this.v=initFrame,this.pv=initFrame,this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.addEffect=addEffect}function KeyframedMultidimensionalProperty(o,s,a,et){this.propType="multidimensional";var tt,rt=s.k.length,nt,it,st,ot;for(tt=0;tt<rt-1;tt+=1)s.k[tt].to&&s.k[tt].s&&s.k[tt+1]&&s.k[tt+1].s&&(nt=s.k[tt].s,it=s.k[tt+1].s,st=s.k[tt].to,ot=s.k[tt].ti,(nt.length===2&&!(nt[0]===it[0]&&nt[1]===it[1])&&bez.pointOnLine2D(nt[0],nt[1],it[0],it[1],nt[0]+st[0],nt[1]+st[1])&&bez.pointOnLine2D(nt[0],nt[1],it[0],it[1],it[0]+ot[0],it[1]+ot[1])||nt.length===3&&!(nt[0]===it[0]&&nt[1]===it[1]&&nt[2]===it[2])&&bez.pointOnLine3D(nt[0],nt[1],nt[2],it[0],it[1],it[2],nt[0]+st[0],nt[1]+st[1],nt[2]+st[2])&&bez.pointOnLine3D(nt[0],nt[1],nt[2],it[0],it[1],it[2],it[0]+ot[0],it[1]+ot[1],it[2]+ot[2]))&&(s.k[tt].to=null,s.k[tt].ti=null),nt[0]===it[0]&&nt[1]===it[1]&&st[0]===0&&st[1]===0&&ot[0]===0&&ot[1]===0&&(nt.length===2||nt[2]===it[2]&&st[2]===0&&ot[2]===0)&&(s.k[tt].to=null,s.k[tt].ti=null));this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.data=s,this.keyframes=s.k,this.keyframesMetadata=[],this.offsetTime=o.data.st,this.k=!0,this.kf=!0,this._isFirstFrame=!0,this.mult=a||1,this.elem=o,this.container=et,this.comp=o.comp,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.frameId=-1;var at=s.k[0].s.length;for(this.v=createTypedArray("float32",at),this.pv=createTypedArray("float32",at),tt=0;tt<at;tt+=1)this.v[tt]=initFrame,this.pv[tt]=initFrame;this._caching={lastFrame:initFrame,lastIndex:0,value:createTypedArray("float32",at)},this.addEffect=addEffect}var PropertyFactory=function(){function o(a,et,tt,rt,nt){et.sid&&(et=a.globalData.slotManager.getProp(et));var it;if(!et.k.length)it=new ValueProperty(a,et,rt,nt);else if(typeof et.k[0]=="number")it=new MultiDimensionalProperty(a,et,rt,nt);else switch(tt){case 0:it=new KeyframedValueProperty(a,et,rt,nt);break;case 1:it=new KeyframedMultidimensionalProperty(a,et,rt,nt);break}return it.effectsSequence.length&&nt.addDynamicProperty(it),it}var s={getProp:o};return s}();function DynamicPropertyContainer(){}DynamicPropertyContainer.prototype={addDynamicProperty:function(s){this.dynamicProperties.indexOf(s)===-1&&(this.dynamicProperties.push(s),this.container.addDynamicProperty(this),this._isAnimated=!0)},iterateDynamicProperties:function(){this._mdf=!1;var s,a=this.dynamicProperties.length;for(s=0;s<a;s+=1)this.dynamicProperties[s].getValue(),this.dynamicProperties[s]._mdf&&(this._mdf=!0)},initDynamicPropertyContainer:function(s){this.container=s,this.dynamicProperties=[],this._mdf=!1,this._isAnimated=!1}};var pointPool=function(){function o(){return createTypedArray("float32",2)}return poolFactory(8,o)}();function ShapePath(){this.c=!1,this._length=0,this._maxLength=8,this.v=createSizedArray(this._maxLength),this.o=createSizedArray(this._maxLength),this.i=createSizedArray(this._maxLength)}ShapePath.prototype.setPathData=function(o,s){this.c=o,this.setLength(s);for(var a=0;a<s;)this.v[a]=pointPool.newElement(),this.o[a]=pointPool.newElement(),this.i[a]=pointPool.newElement(),a+=1},ShapePath.prototype.setLength=function(o){for(;this._maxLength<o;)this.doubleArrayLength();this._length=o},ShapePath.prototype.doubleArrayLength=function(){this.v=this.v.concat(createSizedArray(this._maxLength)),this.i=this.i.concat(createSizedArray(this._maxLength)),this.o=this.o.concat(createSizedArray(this._maxLength)),this._maxLength*=2},ShapePath.prototype.setXYAt=function(o,s,a,et,tt){var rt;switch(this._length=Math.max(this._length,et+1),this._length>=this._maxLength&&this.doubleArrayLength(),a){case"v":rt=this.v;break;case"i":rt=this.i;break;case"o":rt=this.o;break;default:rt=[];break}(!rt[et]||rt[et]&&!tt)&&(rt[et]=pointPool.newElement()),rt[et][0]=o,rt[et][1]=s},ShapePath.prototype.setTripleAt=function(o,s,a,et,tt,rt,nt,it){this.setXYAt(o,s,"v",nt,it),this.setXYAt(a,et,"o",nt,it),this.setXYAt(tt,rt,"i",nt,it)},ShapePath.prototype.reverse=function(){var o=new ShapePath;o.setPathData(this.c,this._length);var s=this.v,a=this.o,et=this.i,tt=0;this.c&&(o.setTripleAt(s[0][0],s[0][1],et[0][0],et[0][1],a[0][0],a[0][1],0,!1),tt=1);var rt=this._length-1,nt=this._length,it;for(it=tt;it<nt;it+=1)o.setTripleAt(s[rt][0],s[rt][1],et[rt][0],et[rt][1],a[rt][0],a[rt][1],it,!1),rt-=1;return o},ShapePath.prototype.length=function(){return this._length};var shapePool=function(){function o(){return new ShapePath}function s(tt){var rt=tt._length,nt;for(nt=0;nt<rt;nt+=1)pointPool.release(tt.v[nt]),pointPool.release(tt.i[nt]),pointPool.release(tt.o[nt]),tt.v[nt]=null,tt.i[nt]=null,tt.o[nt]=null;tt._length=0,tt.c=!1}function a(tt){var rt=et.newElement(),nt,it=tt._length===void 0?tt.v.length:tt._length;for(rt.setLength(it),rt.c=tt.c,nt=0;nt<it;nt+=1)rt.setTripleAt(tt.v[nt][0],tt.v[nt][1],tt.o[nt][0],tt.o[nt][1],tt.i[nt][0],tt.i[nt][1],nt);return rt}var et=poolFactory(4,o,s);return et.clone=a,et}();function ShapeCollection(){this._length=0,this._maxLength=4,this.shapes=createSizedArray(this._maxLength)}ShapeCollection.prototype.addShape=function(o){this._length===this._maxLength&&(this.shapes=this.shapes.concat(createSizedArray(this._maxLength)),this._maxLength*=2),this.shapes[this._length]=o,this._length+=1},ShapeCollection.prototype.releaseShapes=function(){var o;for(o=0;o<this._length;o+=1)shapePool.release(this.shapes[o]);this._length=0};var shapeCollectionPool=function(){var o={newShapeCollection:tt,release:rt},s=0,a=4,et=createSizedArray(a);function tt(){var nt;return s?(s-=1,nt=et[s]):nt=new ShapeCollection,nt}function rt(nt){var it,st=nt._length;for(it=0;it<st;it+=1)shapePool.release(nt.shapes[it]);nt._length=0,s===a&&(et=pooling.double(et),a*=2),et[s]=nt,s+=1}return o}(),ShapePropertyFactory=function(){var o=-999999;function s(gt,mt,yt){var vt=yt.lastIndex,Et,xt,wt,Rt,Ct,Ft,zt,Nt,Kt,Yt=this.keyframes;if(gt<Yt[0].t-this.offsetTime)Et=Yt[0].s[0],wt=!0,vt=0;else if(gt>=Yt[Yt.length-1].t-this.offsetTime)Et=Yt[Yt.length-1].s?Yt[Yt.length-1].s[0]:Yt[Yt.length-2].e[0],wt=!0;else{for(var Bt=vt,Pt=Yt.length-1,Dt=!0,Tt,St,Mt;Dt&&(Tt=Yt[Bt],St=Yt[Bt+1],!(St.t-this.offsetTime>gt));)Bt<Pt-1?Bt+=1:Dt=!1;if(Mt=this.keyframesMetadata[Bt]||{},wt=Tt.h===1,vt=Bt,!wt){if(gt>=St.t-this.offsetTime)Nt=1;else if(gt<Tt.t-this.offsetTime)Nt=0;else{var jt;Mt.__fnct?jt=Mt.__fnct:(jt=BezierFactory.getBezierEasing(Tt.o.x,Tt.o.y,Tt.i.x,Tt.i.y).get,Mt.__fnct=jt),Nt=jt((gt-(Tt.t-this.offsetTime))/(St.t-this.offsetTime-(Tt.t-this.offsetTime)))}xt=St.s?St.s[0]:Tt.e[0]}Et=Tt.s[0]}for(Ft=mt._length,zt=Et.i[0].length,yt.lastIndex=vt,Rt=0;Rt<Ft;Rt+=1)for(Ct=0;Ct<zt;Ct+=1)Kt=wt?Et.i[Rt][Ct]:Et.i[Rt][Ct]+(xt.i[Rt][Ct]-Et.i[Rt][Ct])*Nt,mt.i[Rt][Ct]=Kt,Kt=wt?Et.o[Rt][Ct]:Et.o[Rt][Ct]+(xt.o[Rt][Ct]-Et.o[Rt][Ct])*Nt,mt.o[Rt][Ct]=Kt,Kt=wt?Et.v[Rt][Ct]:Et.v[Rt][Ct]+(xt.v[Rt][Ct]-Et.v[Rt][Ct])*Nt,mt.v[Rt][Ct]=Kt}function a(){var gt=this.comp.renderedFrame-this.offsetTime,mt=this.keyframes[0].t-this.offsetTime,yt=this.keyframes[this.keyframes.length-1].t-this.offsetTime,vt=this._caching.lastFrame;return vt!==o&&(vt<mt&&gt<mt||vt>yt&&gt>yt)||(this._caching.lastIndex=vt<gt?this._caching.lastIndex:0,this.interpolateShape(gt,this.pv,this._caching)),this._caching.lastFrame=gt,this.pv}function et(){this.paths=this.localShapeCollection}function tt(gt,mt){if(gt._length!==mt._length||gt.c!==mt.c)return!1;var yt,vt=gt._length;for(yt=0;yt<vt;yt+=1)if(gt.v[yt][0]!==mt.v[yt][0]||gt.v[yt][1]!==mt.v[yt][1]||gt.o[yt][0]!==mt.o[yt][0]||gt.o[yt][1]!==mt.o[yt][1]||gt.i[yt][0]!==mt.i[yt][0]||gt.i[yt][1]!==mt.i[yt][1])return!1;return!0}function rt(gt){tt(this.v,gt)||(this.v=shapePool.clone(gt),this.localShapeCollection.releaseShapes(),this.localShapeCollection.addShape(this.v),this._mdf=!0,this.paths=this.localShapeCollection)}function nt(){if(this.elem.globalData.frameId!==this.frameId){if(!this.effectsSequence.length){this._mdf=!1;return}if(this.lock){this.setVValue(this.pv);return}this.lock=!0,this._mdf=!1;var gt;this.kf?gt=this.pv:this.data.ks?gt=this.data.ks.k:gt=this.data.pt.k;var mt,yt=this.effectsSequence.length;for(mt=0;mt<yt;mt+=1)gt=this.effectsSequence[mt](gt);this.setVValue(gt),this.lock=!1,this.frameId=this.elem.globalData.frameId}}function it(gt,mt,yt){this.propType="shape",this.comp=gt.comp,this.container=gt,this.elem=gt,this.data=mt,this.k=!1,this.kf=!1,this._mdf=!1;var vt=yt===3?mt.pt.k:mt.ks.k;this.v=shapePool.clone(vt),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.reset=et,this.effectsSequence=[]}function st(gt){this.effectsSequence.push(gt),this.container.addDynamicProperty(this)}it.prototype.interpolateShape=s,it.prototype.getValue=nt,it.prototype.setVValue=rt,it.prototype.addEffect=st;function ot(gt,mt,yt){this.propType="shape",this.comp=gt.comp,this.elem=gt,this.container=gt,this.offsetTime=gt.data.st,this.keyframes=yt===3?mt.pt.k:mt.ks.k,this.keyframesMetadata=[],this.k=!0,this.kf=!0;var vt=this.keyframes[0].s[0].i.length;this.v=shapePool.newElement(),this.v.setPathData(this.keyframes[0].s[0].c,vt),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.lastFrame=o,this.reset=et,this._caching={lastFrame:o,lastIndex:0},this.effectsSequence=[a.bind(this)]}ot.prototype.getValue=nt,ot.prototype.interpolateShape=s,ot.prototype.setVValue=rt,ot.prototype.addEffect=st;var at=function(){var gt=roundCorner;function mt(yt,vt){this.v=shapePool.newElement(),this.v.setPathData(!0,4),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.localShapeCollection.addShape(this.v),this.d=vt.d,this.elem=yt,this.comp=yt.comp,this.frameId=-1,this.initDynamicPropertyContainer(yt),this.p=PropertyFactory.getProp(yt,vt.p,1,0,this),this.s=PropertyFactory.getProp(yt,vt.s,1,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertEllToPath())}return mt.prototype={reset:et,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertEllToPath())},convertEllToPath:function(){var vt=this.p.v[0],Et=this.p.v[1],xt=this.s.v[0]/2,wt=this.s.v[1]/2,Rt=this.d!==3,Ct=this.v;Ct.v[0][0]=vt,Ct.v[0][1]=Et-wt,Ct.v[1][0]=Rt?vt+xt:vt-xt,Ct.v[1][1]=Et,Ct.v[2][0]=vt,Ct.v[2][1]=Et+wt,Ct.v[3][0]=Rt?vt-xt:vt+xt,Ct.v[3][1]=Et,Ct.i[0][0]=Rt?vt-xt*gt:vt+xt*gt,Ct.i[0][1]=Et-wt,Ct.i[1][0]=Rt?vt+xt:vt-xt,Ct.i[1][1]=Et-wt*gt,Ct.i[2][0]=Rt?vt+xt*gt:vt-xt*gt,Ct.i[2][1]=Et+wt,Ct.i[3][0]=Rt?vt-xt:vt+xt,Ct.i[3][1]=Et+wt*gt,Ct.o[0][0]=Rt?vt+xt*gt:vt-xt*gt,Ct.o[0][1]=Et-wt,Ct.o[1][0]=Rt?vt+xt:vt-xt,Ct.o[1][1]=Et+wt*gt,Ct.o[2][0]=Rt?vt-xt*gt:vt+xt*gt,Ct.o[2][1]=Et+wt,Ct.o[3][0]=Rt?vt-xt:vt+xt,Ct.o[3][1]=Et-wt*gt}},extendPrototype([DynamicPropertyContainer],mt),mt}(),lt=function(){function gt(mt,yt){this.v=shapePool.newElement(),this.v.setPathData(!0,0),this.elem=mt,this.comp=mt.comp,this.data=yt,this.frameId=-1,this.d=yt.d,this.initDynamicPropertyContainer(mt),yt.sy===1?(this.ir=PropertyFactory.getProp(mt,yt.ir,0,0,this),this.is=PropertyFactory.getProp(mt,yt.is,0,.01,this),this.convertToPath=this.convertStarToPath):this.convertToPath=this.convertPolygonToPath,this.pt=PropertyFactory.getProp(mt,yt.pt,0,0,this),this.p=PropertyFactory.getProp(mt,yt.p,1,0,this),this.r=PropertyFactory.getProp(mt,yt.r,0,degToRads,this),this.or=PropertyFactory.getProp(mt,yt.or,0,0,this),this.os=PropertyFactory.getProp(mt,yt.os,0,.01,this),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertToPath())}return gt.prototype={reset:et,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertToPath())},convertStarToPath:function(){var yt=Math.floor(this.pt.v)*2,vt=Math.PI*2/yt,Et=!0,xt=this.or.v,wt=this.ir.v,Rt=this.os.v,Ct=this.is.v,Ft=2*Math.PI*xt/(yt*2),zt=2*Math.PI*wt/(yt*2),Nt,Kt,Yt,Bt,Pt=-Math.PI/2;Pt+=this.r.v;var Dt=this.data.d===3?-1:1;for(this.v._length=0,Nt=0;Nt<yt;Nt+=1){Kt=Et?xt:wt,Yt=Et?Rt:Ct,Bt=Et?Ft:zt;var Tt=Kt*Math.cos(Pt),St=Kt*Math.sin(Pt),Mt=Tt===0&&St===0?0:St/Math.sqrt(Tt*Tt+St*St),jt=Tt===0&&St===0?0:-Tt/Math.sqrt(Tt*Tt+St*St);Tt+=+this.p.v[0],St+=+this.p.v[1],this.v.setTripleAt(Tt,St,Tt-Mt*Bt*Yt*Dt,St-jt*Bt*Yt*Dt,Tt+Mt*Bt*Yt*Dt,St+jt*Bt*Yt*Dt,Nt,!0),Et=!Et,Pt+=vt*Dt}},convertPolygonToPath:function(){var yt=Math.floor(this.pt.v),vt=Math.PI*2/yt,Et=this.or.v,xt=this.os.v,wt=2*Math.PI*Et/(yt*4),Rt,Ct=-Math.PI*.5,Ft=this.data.d===3?-1:1;for(Ct+=this.r.v,this.v._length=0,Rt=0;Rt<yt;Rt+=1){var zt=Et*Math.cos(Ct),Nt=Et*Math.sin(Ct),Kt=zt===0&&Nt===0?0:Nt/Math.sqrt(zt*zt+Nt*Nt),Yt=zt===0&&Nt===0?0:-zt/Math.sqrt(zt*zt+Nt*Nt);zt+=+this.p.v[0],Nt+=+this.p.v[1],this.v.setTripleAt(zt,Nt,zt-Kt*wt*xt*Ft,Nt-Yt*wt*xt*Ft,zt+Kt*wt*xt*Ft,Nt+Yt*wt*xt*Ft,Rt,!0),Ct+=vt*Ft}this.paths.length=0,this.paths[0]=this.v}},extendPrototype([DynamicPropertyContainer],gt),gt}(),ct=function(){function gt(mt,yt){this.v=shapePool.newElement(),this.v.c=!0,this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.elem=mt,this.comp=mt.comp,this.frameId=-1,this.d=yt.d,this.initDynamicPropertyContainer(mt),this.p=PropertyFactory.getProp(mt,yt.p,1,0,this),this.s=PropertyFactory.getProp(mt,yt.s,1,0,this),this.r=PropertyFactory.getProp(mt,yt.r,0,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertRectToPath())}return gt.prototype={convertRectToPath:function(){var yt=this.p.v[0],vt=this.p.v[1],Et=this.s.v[0]/2,xt=this.s.v[1]/2,wt=bmMin(Et,xt,this.r.v),Rt=wt*(1-roundCorner);this.v._length=0,this.d===2||this.d===1?(this.v.setTripleAt(yt+Et,vt-xt+wt,yt+Et,vt-xt+wt,yt+Et,vt-xt+Rt,0,!0),this.v.setTripleAt(yt+Et,vt+xt-wt,yt+Et,vt+xt-Rt,yt+Et,vt+xt-wt,1,!0),wt!==0?(this.v.setTripleAt(yt+Et-wt,vt+xt,yt+Et-wt,vt+xt,yt+Et-Rt,vt+xt,2,!0),this.v.setTripleAt(yt-Et+wt,vt+xt,yt-Et+Rt,vt+xt,yt-Et+wt,vt+xt,3,!0),this.v.setTripleAt(yt-Et,vt+xt-wt,yt-Et,vt+xt-wt,yt-Et,vt+xt-Rt,4,!0),this.v.setTripleAt(yt-Et,vt-xt+wt,yt-Et,vt-xt+Rt,yt-Et,vt-xt+wt,5,!0),this.v.setTripleAt(yt-Et+wt,vt-xt,yt-Et+wt,vt-xt,yt-Et+Rt,vt-xt,6,!0),this.v.setTripleAt(yt+Et-wt,vt-xt,yt+Et-Rt,vt-xt,yt+Et-wt,vt-xt,7,!0)):(this.v.setTripleAt(yt-Et,vt+xt,yt-Et+Rt,vt+xt,yt-Et,vt+xt,2),this.v.setTripleAt(yt-Et,vt-xt,yt-Et,vt-xt+Rt,yt-Et,vt-xt,3))):(this.v.setTripleAt(yt+Et,vt-xt+wt,yt+Et,vt-xt+Rt,yt+Et,vt-xt+wt,0,!0),wt!==0?(this.v.setTripleAt(yt+Et-wt,vt-xt,yt+Et-wt,vt-xt,yt+Et-Rt,vt-xt,1,!0),this.v.setTripleAt(yt-Et+wt,vt-xt,yt-Et+Rt,vt-xt,yt-Et+wt,vt-xt,2,!0),this.v.setTripleAt(yt-Et,vt-xt+wt,yt-Et,vt-xt+wt,yt-Et,vt-xt+Rt,3,!0),this.v.setTripleAt(yt-Et,vt+xt-wt,yt-Et,vt+xt-Rt,yt-Et,vt+xt-wt,4,!0),this.v.setTripleAt(yt-Et+wt,vt+xt,yt-Et+wt,vt+xt,yt-Et+Rt,vt+xt,5,!0),this.v.setTripleAt(yt+Et-wt,vt+xt,yt+Et-Rt,vt+xt,yt+Et-wt,vt+xt,6,!0),this.v.setTripleAt(yt+Et,vt+xt-wt,yt+Et,vt+xt-wt,yt+Et,vt+xt-Rt,7,!0)):(this.v.setTripleAt(yt-Et,vt-xt,yt-Et+Rt,vt-xt,yt-Et,vt-xt,1,!0),this.v.setTripleAt(yt-Et,vt+xt,yt-Et,vt+xt-Rt,yt-Et,vt+xt,2,!0),this.v.setTripleAt(yt+Et,vt+xt,yt+Et-Rt,vt+xt,yt+Et,vt+xt,3,!0)))},getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertRectToPath())},reset:et},extendPrototype([DynamicPropertyContainer],gt),gt}();function ht(gt,mt,yt){var vt;if(yt===3||yt===4){var Et=yt===3?mt.pt:mt.ks,xt=Et.k;xt.length?vt=new ot(gt,mt,yt):vt=new it(gt,mt,yt)}else yt===5?vt=new ct(gt,mt):yt===6?vt=new at(gt,mt):yt===7&&(vt=new lt(gt,mt));return vt.k&&gt.addDynamicProperty(vt),vt}function ft(){return it}function dt(){return ot}var pt={};return pt.getShapeProp=ht,pt.getConstructorFunction=ft,pt.getKeyframedConstructorFunction=dt,pt}();/*!
 Transformation Matrix v2.0
 (c) Epistemex 2014-2015
 www.epistemex.com
 By Ken Fyrstenberg
 Contributions by leeoniya.
 License: MIT, header required.
 */var Matrix=function(){var o=Math.cos,s=Math.sin,a=Math.tan,et=Math.round;function tt(){return this.props[0]=1,this.props[1]=0,this.props[2]=0,this.props[3]=0,this.props[4]=0,this.props[5]=1,this.props[6]=0,this.props[7]=0,this.props[8]=0,this.props[9]=0,this.props[10]=1,this.props[11]=0,this.props[12]=0,this.props[13]=0,this.props[14]=0,this.props[15]=1,this}function rt(Tt){if(Tt===0)return this;var St=o(Tt),Mt=s(Tt);return this._t(St,-Mt,0,0,Mt,St,0,0,0,0,1,0,0,0,0,1)}function nt(Tt){if(Tt===0)return this;var St=o(Tt),Mt=s(Tt);return this._t(1,0,0,0,0,St,-Mt,0,0,Mt,St,0,0,0,0,1)}function it(Tt){if(Tt===0)return this;var St=o(Tt),Mt=s(Tt);return this._t(St,0,Mt,0,0,1,0,0,-Mt,0,St,0,0,0,0,1)}function st(Tt){if(Tt===0)return this;var St=o(Tt),Mt=s(Tt);return this._t(St,-Mt,0,0,Mt,St,0,0,0,0,1,0,0,0,0,1)}function ot(Tt,St){return this._t(1,St,Tt,1,0,0)}function at(Tt,St){return this.shear(a(Tt),a(St))}function lt(Tt,St){var Mt=o(St),jt=s(St);return this._t(Mt,jt,0,0,-jt,Mt,0,0,0,0,1,0,0,0,0,1)._t(1,0,0,0,a(Tt),1,0,0,0,0,1,0,0,0,0,1)._t(Mt,-jt,0,0,jt,Mt,0,0,0,0,1,0,0,0,0,1)}function ct(Tt,St,Mt){return!Mt&&Mt!==0&&(Mt=1),Tt===1&&St===1&&Mt===1?this:this._t(Tt,0,0,0,0,St,0,0,0,0,Mt,0,0,0,0,1)}function ht(Tt,St,Mt,jt,Gt,Ht,At,$t,kt,Lt,bt,It,Ut,Wt,Xt,Qt){return this.props[0]=Tt,this.props[1]=St,this.props[2]=Mt,this.props[3]=jt,this.props[4]=Gt,this.props[5]=Ht,this.props[6]=At,this.props[7]=$t,this.props[8]=kt,this.props[9]=Lt,this.props[10]=bt,this.props[11]=It,this.props[12]=Ut,this.props[13]=Wt,this.props[14]=Xt,this.props[15]=Qt,this}function ft(Tt,St,Mt){return Mt=Mt||0,Tt!==0||St!==0||Mt!==0?this._t(1,0,0,0,0,1,0,0,0,0,1,0,Tt,St,Mt,1):this}function dt(Tt,St,Mt,jt,Gt,Ht,At,$t,kt,Lt,bt,It,Ut,Wt,Xt,Qt){var er=this.props;if(Tt===1&&St===0&&Mt===0&&jt===0&&Gt===0&&Ht===1&&At===0&&$t===0&&kt===0&&Lt===0&&bt===1&&It===0)return er[12]=er[12]*Tt+er[15]*Ut,er[13]=er[13]*Ht+er[15]*Wt,er[14]=er[14]*bt+er[15]*Xt,er[15]*=Qt,this._identityCalculated=!1,this;var lr=er[0],pr=er[1],gr=er[2],wr=er[3],cr=er[4],Cr=er[5],_r=er[6],kr=er[7],Ir=er[8],tr=er[9],sr=er[10],vr=er[11],xr=er[12],Er=er[13],Sr=er[14],$r=er[15];return er[0]=lr*Tt+pr*Gt+gr*kt+wr*Ut,er[1]=lr*St+pr*Ht+gr*Lt+wr*Wt,er[2]=lr*Mt+pr*At+gr*bt+wr*Xt,er[3]=lr*jt+pr*$t+gr*It+wr*Qt,er[4]=cr*Tt+Cr*Gt+_r*kt+kr*Ut,er[5]=cr*St+Cr*Ht+_r*Lt+kr*Wt,er[6]=cr*Mt+Cr*At+_r*bt+kr*Xt,er[7]=cr*jt+Cr*$t+_r*It+kr*Qt,er[8]=Ir*Tt+tr*Gt+sr*kt+vr*Ut,er[9]=Ir*St+tr*Ht+sr*Lt+vr*Wt,er[10]=Ir*Mt+tr*At+sr*bt+vr*Xt,er[11]=Ir*jt+tr*$t+sr*It+vr*Qt,er[12]=xr*Tt+Er*Gt+Sr*kt+$r*Ut,er[13]=xr*St+Er*Ht+Sr*Lt+$r*Wt,er[14]=xr*Mt+Er*At+Sr*bt+$r*Xt,er[15]=xr*jt+Er*$t+Sr*It+$r*Qt,this._identityCalculated=!1,this}function pt(Tt){var St=Tt.props;return this.transform(St[0],St[1],St[2],St[3],St[4],St[5],St[6],St[7],St[8],St[9],St[10],St[11],St[12],St[13],St[14],St[15])}function gt(){return this._identityCalculated||(this._identity=!(this.props[0]!==1||this.props[1]!==0||this.props[2]!==0||this.props[3]!==0||this.props[4]!==0||this.props[5]!==1||this.props[6]!==0||this.props[7]!==0||this.props[8]!==0||this.props[9]!==0||this.props[10]!==1||this.props[11]!==0||this.props[12]!==0||this.props[13]!==0||this.props[14]!==0||this.props[15]!==1),this._identityCalculated=!0),this._identity}function mt(Tt){for(var St=0;St<16;){if(Tt.props[St]!==this.props[St])return!1;St+=1}return!0}function yt(Tt){var St;for(St=0;St<16;St+=1)Tt.props[St]=this.props[St];return Tt}function vt(Tt){var St;for(St=0;St<16;St+=1)this.props[St]=Tt[St]}function Et(Tt,St,Mt){return{x:Tt*this.props[0]+St*this.props[4]+Mt*this.props[8]+this.props[12],y:Tt*this.props[1]+St*this.props[5]+Mt*this.props[9]+this.props[13],z:Tt*this.props[2]+St*this.props[6]+Mt*this.props[10]+this.props[14]}}function xt(Tt,St,Mt){return Tt*this.props[0]+St*this.props[4]+Mt*this.props[8]+this.props[12]}function wt(Tt,St,Mt){return Tt*this.props[1]+St*this.props[5]+Mt*this.props[9]+this.props[13]}function Rt(Tt,St,Mt){return Tt*this.props[2]+St*this.props[6]+Mt*this.props[10]+this.props[14]}function Ct(){var Tt=this.props[0]*this.props[5]-this.props[1]*this.props[4],St=this.props[5]/Tt,Mt=-this.props[1]/Tt,jt=-this.props[4]/Tt,Gt=this.props[0]/Tt,Ht=(this.props[4]*this.props[13]-this.props[5]*this.props[12])/Tt,At=-(this.props[0]*this.props[13]-this.props[1]*this.props[12])/Tt,$t=new Matrix;return $t.props[0]=St,$t.props[1]=Mt,$t.props[4]=jt,$t.props[5]=Gt,$t.props[12]=Ht,$t.props[13]=At,$t}function Ft(Tt){var St=this.getInverseMatrix();return St.applyToPointArray(Tt[0],Tt[1],Tt[2]||0)}function zt(Tt){var St,Mt=Tt.length,jt=[];for(St=0;St<Mt;St+=1)jt[St]=Ft(Tt[St]);return jt}function Nt(Tt,St,Mt){var jt=createTypedArray("float32",6);if(this.isIdentity())jt[0]=Tt[0],jt[1]=Tt[1],jt[2]=St[0],jt[3]=St[1],jt[4]=Mt[0],jt[5]=Mt[1];else{var Gt=this.props[0],Ht=this.props[1],At=this.props[4],$t=this.props[5],kt=this.props[12],Lt=this.props[13];jt[0]=Tt[0]*Gt+Tt[1]*At+kt,jt[1]=Tt[0]*Ht+Tt[1]*$t+Lt,jt[2]=St[0]*Gt+St[1]*At+kt,jt[3]=St[0]*Ht+St[1]*$t+Lt,jt[4]=Mt[0]*Gt+Mt[1]*At+kt,jt[5]=Mt[0]*Ht+Mt[1]*$t+Lt}return jt}function Kt(Tt,St,Mt){var jt;return this.isIdentity()?jt=[Tt,St,Mt]:jt=[Tt*this.props[0]+St*this.props[4]+Mt*this.props[8]+this.props[12],Tt*this.props[1]+St*this.props[5]+Mt*this.props[9]+this.props[13],Tt*this.props[2]+St*this.props[6]+Mt*this.props[10]+this.props[14]],jt}function Yt(Tt,St){if(this.isIdentity())return Tt+","+St;var Mt=this.props;return Math.round((Tt*Mt[0]+St*Mt[4]+Mt[12])*100)/100+","+Math.round((Tt*Mt[1]+St*Mt[5]+Mt[13])*100)/100}function Bt(){for(var Tt=0,St=this.props,Mt="matrix3d(",jt=1e4;Tt<16;)Mt+=et(St[Tt]*jt)/jt,Mt+=Tt===15?")":",",Tt+=1;return Mt}function Pt(Tt){var St=1e4;return Tt<1e-6&&Tt>0||Tt>-1e-6&&Tt<0?et(Tt*St)/St:Tt}function Dt(){var Tt=this.props,St=Pt(Tt[0]),Mt=Pt(Tt[1]),jt=Pt(Tt[4]),Gt=Pt(Tt[5]),Ht=Pt(Tt[12]),At=Pt(Tt[13]);return"matrix("+St+","+Mt+","+jt+","+Gt+","+Ht+","+At+")"}return function(){this.reset=tt,this.rotate=rt,this.rotateX=nt,this.rotateY=it,this.rotateZ=st,this.skew=at,this.skewFromAxis=lt,this.shear=ot,this.scale=ct,this.setTransform=ht,this.translate=ft,this.transform=dt,this.multiply=pt,this.applyToPoint=Et,this.applyToX=xt,this.applyToY=wt,this.applyToZ=Rt,this.applyToPointArray=Kt,this.applyToTriplePoints=Nt,this.applyToPointStringified=Yt,this.toCSS=Bt,this.to2dCSS=Dt,this.clone=yt,this.cloneFromProps=vt,this.equals=mt,this.inversePoints=zt,this.inversePoint=Ft,this.getInverseMatrix=Ct,this._t=this.transform,this.isIdentity=gt,this._identity=!0,this._identityCalculated=!1,this.props=createTypedArray("float32",16),this.reset()}}();function _typeof$3(o){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof$3=function(a){return typeof a}:_typeof$3=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof$3(o)}var lottie={};function setLocation(o){setLocationHref(o)}function searchAnimations(){animationManager.searchAnimations()}function setSubframeRendering(o){setSubframeEnabled(o)}function setPrefix(o){setIdPrefix(o)}function loadAnimation(o){return animationManager.loadAnimation(o)}function setQuality(o){if(typeof o=="string")switch(o){case"high":setDefaultCurveSegments(200);break;default:case"medium":setDefaultCurveSegments(50);break;case"low":setDefaultCurveSegments(10);break}else!isNaN(o)&&o>1&&setDefaultCurveSegments(o)}function inBrowser(){return typeof navigator<"u"}function installPlugin(o,s){o==="expressions"&&setExpressionsPlugin(s)}function getFactory(o){switch(o){case"propertyFactory":return PropertyFactory;case"shapePropertyFactory":return ShapePropertyFactory;case"matrix":return Matrix;default:return null}}lottie.play=animationManager.play,lottie.pause=animationManager.pause,lottie.setLocationHref=setLocation,lottie.togglePause=animationManager.togglePause,lottie.setSpeed=animationManager.setSpeed,lottie.setDirection=animationManager.setDirection,lottie.stop=animationManager.stop,lottie.searchAnimations=searchAnimations,lottie.registerAnimation=animationManager.registerAnimation,lottie.loadAnimation=loadAnimation,lottie.setSubframeRendering=setSubframeRendering,lottie.resize=animationManager.resize,lottie.goToAndStop=animationManager.goToAndStop,lottie.destroy=animationManager.destroy,lottie.setQuality=setQuality,lottie.inBrowser=inBrowser,lottie.installPlugin=installPlugin,lottie.freeze=animationManager.freeze,lottie.unfreeze=animationManager.unfreeze,lottie.setVolume=animationManager.setVolume,lottie.mute=animationManager.mute,lottie.unmute=animationManager.unmute,lottie.getRegisteredAnimations=animationManager.getRegisteredAnimations,lottie.useWebWorker=setWebWorker,lottie.setIDPrefix=setPrefix,lottie.__getFactory=getFactory,lottie.version="5.12.2";function checkReady(){document.readyState==="complete"&&(clearInterval(readyStateCheckInterval),searchAnimations())}function getQueryVariable(o){for(var s=queryString.split("&"),a=0;a<s.length;a+=1){var et=s[a].split("=");if(decodeURIComponent(et[0])==o)return decodeURIComponent(et[1])}return null}var queryString="";{var scripts=document.getElementsByTagName("script"),index=scripts.length-1,myScript=scripts[index]||{src:""};queryString=myScript.src?myScript.src.replace(/^[^\?]+\??/,""):"",getQueryVariable("renderer")}var readyStateCheckInterval=setInterval(checkReady,100);try{_typeof$3(exports)!=="object"&&(window.bodymovin=lottie)}catch(o){}var ShapeModifiers=function(){var o={},s={};o.registerModifier=a,o.getModifier=et;function a(tt,rt){s[tt]||(s[tt]=rt)}function et(tt,rt,nt){return new s[tt](rt,nt)}return o}();function ShapeModifier(){}ShapeModifier.prototype.initModifierProperties=function(){},ShapeModifier.prototype.addShapeToModifier=function(){},ShapeModifier.prototype.addShape=function(o){if(!this.closed){o.sh.container.addDynamicProperty(o.sh);var s={shape:o.sh,data:o,localShapeCollection:shapeCollectionPool.newShapeCollection()};this.shapes.push(s),this.addShapeToModifier(s),this._isAnimated&&o.setAsAnimated()}},ShapeModifier.prototype.init=function(o,s){this.shapes=[],this.elem=o,this.initDynamicPropertyContainer(o),this.initModifierProperties(o,s),this.frameId=initialDefaultFrame,this.closed=!1,this.k=!1,this.dynamicProperties.length?this.k=!0:this.getValue(!0)},ShapeModifier.prototype.processKeys=function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties())},extendPrototype([DynamicPropertyContainer],ShapeModifier);function TrimModifier(){}extendPrototype([ShapeModifier],TrimModifier),TrimModifier.prototype.initModifierProperties=function(o,s){this.s=PropertyFactory.getProp(o,s.s,0,.01,this),this.e=PropertyFactory.getProp(o,s.e,0,.01,this),this.o=PropertyFactory.getProp(o,s.o,0,0,this),this.sValue=0,this.eValue=0,this.getValue=this.processKeys,this.m=s.m,this._isAnimated=!!this.s.effectsSequence.length||!!this.e.effectsSequence.length||!!this.o.effectsSequence.length},TrimModifier.prototype.addShapeToModifier=function(o){o.pathsData=[]},TrimModifier.prototype.calculateShapeEdges=function(o,s,a,et,tt){var rt=[];s<=1?rt.push({s:o,e:s}):o>=1?rt.push({s:o-1,e:s-1}):(rt.push({s:o,e:1}),rt.push({s:0,e:s-1}));var nt=[],it,st=rt.length,ot;for(it=0;it<st;it+=1)if(ot=rt[it],!(ot.e*tt<et||ot.s*tt>et+a)){var at,lt;ot.s*tt<=et?at=0:at=(ot.s*tt-et)/a,ot.e*tt>=et+a?lt=1:lt=(ot.e*tt-et)/a,nt.push([at,lt])}return nt.length||nt.push([0,0]),nt},TrimModifier.prototype.releasePathsData=function(o){var s,a=o.length;for(s=0;s<a;s+=1)segmentsLengthPool.release(o[s]);return o.length=0,o},TrimModifier.prototype.processShapes=function(o){var s,a;if(this._mdf||o){var et=this.o.v%360/360;if(et<0&&(et+=1),this.s.v>1?s=1+et:this.s.v<0?s=0+et:s=this.s.v+et,this.e.v>1?a=1+et:this.e.v<0?a=0+et:a=this.e.v+et,s>a){var tt=s;s=a,a=tt}s=Math.round(s*1e4)*1e-4,a=Math.round(a*1e4)*1e-4,this.sValue=s,this.eValue=a}else s=this.sValue,a=this.eValue;var rt,nt,it=this.shapes.length,st,ot,at,lt,ct,ht=0;if(a===s)for(nt=0;nt<it;nt+=1)this.shapes[nt].localShapeCollection.releaseShapes(),this.shapes[nt].shape._mdf=!0,this.shapes[nt].shape.paths=this.shapes[nt].localShapeCollection,this._mdf&&(this.shapes[nt].pathsData.length=0);else if(a===1&&s===0||a===0&&s===1){if(this._mdf)for(nt=0;nt<it;nt+=1)this.shapes[nt].pathsData.length=0,this.shapes[nt].shape._mdf=!0}else{var ft=[],dt,pt;for(nt=0;nt<it;nt+=1)if(dt=this.shapes[nt],!dt.shape._mdf&&!this._mdf&&!o&&this.m!==2)dt.shape.paths=dt.localShapeCollection;else{if(rt=dt.shape.paths,ot=rt._length,ct=0,!dt.shape._mdf&&dt.pathsData.length)ct=dt.totalShapeLength;else{for(at=this.releasePathsData(dt.pathsData),st=0;st<ot;st+=1)lt=bez.getSegmentsLength(rt.shapes[st]),at.push(lt),ct+=lt.totalLength;dt.totalShapeLength=ct,dt.pathsData=at}ht+=ct,dt.shape._mdf=!0}var gt=s,mt=a,yt=0,vt;for(nt=it-1;nt>=0;nt-=1)if(dt=this.shapes[nt],dt.shape._mdf){for(pt=dt.localShapeCollection,pt.releaseShapes(),this.m===2&&it>1?(vt=this.calculateShapeEdges(s,a,dt.totalShapeLength,yt,ht),yt+=dt.totalShapeLength):vt=[[gt,mt]],ot=vt.length,st=0;st<ot;st+=1){gt=vt[st][0],mt=vt[st][1],ft.length=0,mt<=1?ft.push({s:dt.totalShapeLength*gt,e:dt.totalShapeLength*mt}):gt>=1?ft.push({s:dt.totalShapeLength*(gt-1),e:dt.totalShapeLength*(mt-1)}):(ft.push({s:dt.totalShapeLength*gt,e:dt.totalShapeLength}),ft.push({s:0,e:dt.totalShapeLength*(mt-1)}));var Et=this.addShapes(dt,ft[0]);if(ft[0].s!==ft[0].e){if(ft.length>1){var xt=dt.shape.paths.shapes[dt.shape.paths._length-1];if(xt.c){var wt=Et.pop();this.addPaths(Et,pt),Et=this.addShapes(dt,ft[1],wt)}else this.addPaths(Et,pt),Et=this.addShapes(dt,ft[1])}this.addPaths(Et,pt)}}dt.shape.paths=pt}}},TrimModifier.prototype.addPaths=function(o,s){var a,et=o.length;for(a=0;a<et;a+=1)s.addShape(o[a])},TrimModifier.prototype.addSegment=function(o,s,a,et,tt,rt,nt){tt.setXYAt(s[0],s[1],"o",rt),tt.setXYAt(a[0],a[1],"i",rt+1),nt&&tt.setXYAt(o[0],o[1],"v",rt),tt.setXYAt(et[0],et[1],"v",rt+1)},TrimModifier.prototype.addSegmentFromArray=function(o,s,a,et){s.setXYAt(o[1],o[5],"o",a),s.setXYAt(o[2],o[6],"i",a+1),et&&s.setXYAt(o[0],o[4],"v",a),s.setXYAt(o[3],o[7],"v",a+1)},TrimModifier.prototype.addShapes=function(o,s,a){var et=o.pathsData,tt=o.shape.paths.shapes,rt,nt=o.shape.paths._length,it,st,ot=0,at,lt,ct,ht,ft=[],dt,pt=!0;for(a?(lt=a._length,dt=a._length):(a=shapePool.newElement(),lt=0,dt=0),ft.push(a),rt=0;rt<nt;rt+=1){for(ct=et[rt].lengths,a.c=tt[rt].c,st=tt[rt].c?ct.length:ct.length+1,it=1;it<st;it+=1)if(at=ct[it-1],ot+at.addedLength<s.s)ot+=at.addedLength,a.c=!1;else if(ot>s.e){a.c=!1;break}else s.s<=ot&&s.e>=ot+at.addedLength?(this.addSegment(tt[rt].v[it-1],tt[rt].o[it-1],tt[rt].i[it],tt[rt].v[it],a,lt,pt),pt=!1):(ht=bez.getNewSegment(tt[rt].v[it-1],tt[rt].v[it],tt[rt].o[it-1],tt[rt].i[it],(s.s-ot)/at.addedLength,(s.e-ot)/at.addedLength,ct[it-1]),this.addSegmentFromArray(ht,a,lt,pt),pt=!1,a.c=!1),ot+=at.addedLength,lt+=1;if(tt[rt].c&&ct.length){if(at=ct[it-1],ot<=s.e){var gt=ct[it-1].addedLength;s.s<=ot&&s.e>=ot+gt?(this.addSegment(tt[rt].v[it-1],tt[rt].o[it-1],tt[rt].i[0],tt[rt].v[0],a,lt,pt),pt=!1):(ht=bez.getNewSegment(tt[rt].v[it-1],tt[rt].v[0],tt[rt].o[it-1],tt[rt].i[0],(s.s-ot)/gt,(s.e-ot)/gt,ct[it-1]),this.addSegmentFromArray(ht,a,lt,pt),pt=!1,a.c=!1)}else a.c=!1;ot+=at.addedLength,lt+=1}if(a._length&&(a.setXYAt(a.v[dt][0],a.v[dt][1],"i",dt),a.setXYAt(a.v[a._length-1][0],a.v[a._length-1][1],"o",a._length-1)),ot>s.e)break;rt<nt-1&&(a=shapePool.newElement(),pt=!0,ft.push(a),lt=0)}return ft};function PuckerAndBloatModifier(){}extendPrototype([ShapeModifier],PuckerAndBloatModifier),PuckerAndBloatModifier.prototype.initModifierProperties=function(o,s){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(o,s.a,0,null,this),this._isAnimated=!!this.amount.effectsSequence.length},PuckerAndBloatModifier.prototype.processPath=function(o,s){var a=s/100,et=[0,0],tt=o._length,rt=0;for(rt=0;rt<tt;rt+=1)et[0]+=o.v[rt][0],et[1]+=o.v[rt][1];et[0]/=tt,et[1]/=tt;var nt=shapePool.newElement();nt.c=o.c;var it,st,ot,at,lt,ct;for(rt=0;rt<tt;rt+=1)it=o.v[rt][0]+(et[0]-o.v[rt][0])*a,st=o.v[rt][1]+(et[1]-o.v[rt][1])*a,ot=o.o[rt][0]+(et[0]-o.o[rt][0])*-a,at=o.o[rt][1]+(et[1]-o.o[rt][1])*-a,lt=o.i[rt][0]+(et[0]-o.i[rt][0])*-a,ct=o.i[rt][1]+(et[1]-o.i[rt][1])*-a,nt.setTripleAt(it,st,ot,at,lt,ct,rt);return nt},PuckerAndBloatModifier.prototype.processShapes=function(o){var s,a,et=this.shapes.length,tt,rt,nt=this.amount.v;if(nt!==0){var it,st;for(a=0;a<et;a+=1){if(it=this.shapes[a],st=it.localShapeCollection,!(!it.shape._mdf&&!this._mdf&&!o))for(st.releaseShapes(),it.shape._mdf=!0,s=it.shape.paths.shapes,rt=it.shape.paths._length,tt=0;tt<rt;tt+=1)st.addShape(this.processPath(s[tt],nt));it.shape.paths=it.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};var TransformPropertyFactory=function(){var o=[0,0];function s(st){var ot=this._mdf;this.iterateDynamicProperties(),this._mdf=this._mdf||ot,this.a&&st.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.s&&st.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&st.skewFromAxis(-this.sk.v,this.sa.v),this.r?st.rotate(-this.r.v):st.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.data.p.s?this.data.p.z?st.translate(this.px.v,this.py.v,-this.pz.v):st.translate(this.px.v,this.py.v,0):st.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}function a(st){if(this.elem.globalData.frameId!==this.frameId){if(this._isDirty&&(this.precalculateMatrix(),this._isDirty=!1),this.iterateDynamicProperties(),this._mdf||st){var ot;if(this.v.cloneFromProps(this.pre.props),this.appliedTransformations<1&&this.v.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations<2&&this.v.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&this.appliedTransformations<3&&this.v.skewFromAxis(-this.sk.v,this.sa.v),this.r&&this.appliedTransformations<4?this.v.rotate(-this.r.v):!this.r&&this.appliedTransformations<4&&this.v.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.autoOriented){var at,lt;if(ot=this.elem.globalData.frameRate,this.p&&this.p.keyframes&&this.p.getValueAtTime)this.p._caching.lastFrame+this.p.offsetTime<=this.p.keyframes[0].t?(at=this.p.getValueAtTime((this.p.keyframes[0].t+.01)/ot,0),lt=this.p.getValueAtTime(this.p.keyframes[0].t/ot,0)):this.p._caching.lastFrame+this.p.offsetTime>=this.p.keyframes[this.p.keyframes.length-1].t?(at=this.p.getValueAtTime(this.p.keyframes[this.p.keyframes.length-1].t/ot,0),lt=this.p.getValueAtTime((this.p.keyframes[this.p.keyframes.length-1].t-.05)/ot,0)):(at=this.p.pv,lt=this.p.getValueAtTime((this.p._caching.lastFrame+this.p.offsetTime-.01)/ot,this.p.offsetTime));else if(this.px&&this.px.keyframes&&this.py.keyframes&&this.px.getValueAtTime&&this.py.getValueAtTime){at=[],lt=[];var ct=this.px,ht=this.py;ct._caching.lastFrame+ct.offsetTime<=ct.keyframes[0].t?(at[0]=ct.getValueAtTime((ct.keyframes[0].t+.01)/ot,0),at[1]=ht.getValueAtTime((ht.keyframes[0].t+.01)/ot,0),lt[0]=ct.getValueAtTime(ct.keyframes[0].t/ot,0),lt[1]=ht.getValueAtTime(ht.keyframes[0].t/ot,0)):ct._caching.lastFrame+ct.offsetTime>=ct.keyframes[ct.keyframes.length-1].t?(at[0]=ct.getValueAtTime(ct.keyframes[ct.keyframes.length-1].t/ot,0),at[1]=ht.getValueAtTime(ht.keyframes[ht.keyframes.length-1].t/ot,0),lt[0]=ct.getValueAtTime((ct.keyframes[ct.keyframes.length-1].t-.01)/ot,0),lt[1]=ht.getValueAtTime((ht.keyframes[ht.keyframes.length-1].t-.01)/ot,0)):(at=[ct.pv,ht.pv],lt[0]=ct.getValueAtTime((ct._caching.lastFrame+ct.offsetTime-.01)/ot,ct.offsetTime),lt[1]=ht.getValueAtTime((ht._caching.lastFrame+ht.offsetTime-.01)/ot,ht.offsetTime))}else lt=o,at=lt;this.v.rotate(-Math.atan2(at[1]-lt[1],at[0]-lt[0]))}this.data.p&&this.data.p.s?this.data.p.z?this.v.translate(this.px.v,this.py.v,-this.pz.v):this.v.translate(this.px.v,this.py.v,0):this.v.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}this.frameId=this.elem.globalData.frameId}}function et(){if(this.appliedTransformations=0,this.pre.reset(),!this.a.effectsSequence.length)this.pre.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations=1;else return;if(!this.s.effectsSequence.length)this.pre.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.appliedTransformations=2;else return;if(this.sk)if(!this.sk.effectsSequence.length&&!this.sa.effectsSequence.length)this.pre.skewFromAxis(-this.sk.v,this.sa.v),this.appliedTransformations=3;else return;this.r?this.r.effectsSequence.length||(this.pre.rotate(-this.r.v),this.appliedTransformations=4):!this.rz.effectsSequence.length&&!this.ry.effectsSequence.length&&!this.rx.effectsSequence.length&&!this.or.effectsSequence.length&&(this.pre.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.appliedTransformations=4)}function tt(){}function rt(st){this._addDynamicProperty(st),this.elem.addDynamicProperty(st),this._isDirty=!0}function nt(st,ot,at){if(this.elem=st,this.frameId=-1,this.propType="transform",this.data=ot,this.v=new Matrix,this.pre=new Matrix,this.appliedTransformations=0,this.initDynamicPropertyContainer(at||st),ot.p&&ot.p.s?(this.px=PropertyFactory.getProp(st,ot.p.x,0,0,this),this.py=PropertyFactory.getProp(st,ot.p.y,0,0,this),ot.p.z&&(this.pz=PropertyFactory.getProp(st,ot.p.z,0,0,this))):this.p=PropertyFactory.getProp(st,ot.p||{k:[0,0,0]},1,0,this),ot.rx){if(this.rx=PropertyFactory.getProp(st,ot.rx,0,degToRads,this),this.ry=PropertyFactory.getProp(st,ot.ry,0,degToRads,this),this.rz=PropertyFactory.getProp(st,ot.rz,0,degToRads,this),ot.or.k[0].ti){var lt,ct=ot.or.k.length;for(lt=0;lt<ct;lt+=1)ot.or.k[lt].to=null,ot.or.k[lt].ti=null}this.or=PropertyFactory.getProp(st,ot.or,1,degToRads,this),this.or.sh=!0}else this.r=PropertyFactory.getProp(st,ot.r||{k:0},0,degToRads,this);ot.sk&&(this.sk=PropertyFactory.getProp(st,ot.sk,0,degToRads,this),this.sa=PropertyFactory.getProp(st,ot.sa,0,degToRads,this)),this.a=PropertyFactory.getProp(st,ot.a||{k:[0,0,0]},1,0,this),this.s=PropertyFactory.getProp(st,ot.s||{k:[100,100,100]},1,.01,this),ot.o?this.o=PropertyFactory.getProp(st,ot.o,0,.01,st):this.o={_mdf:!1,v:1},this._isDirty=!0,this.dynamicProperties.length||this.getValue(!0)}nt.prototype={applyToMatrix:s,getValue:a,precalculateMatrix:et,autoOrient:tt},extendPrototype([DynamicPropertyContainer],nt),nt.prototype.addDynamicProperty=rt,nt.prototype._addDynamicProperty=DynamicPropertyContainer.prototype.addDynamicProperty;function it(st,ot,at){return new nt(st,ot,at)}return{getTransformProperty:it}}();function RepeaterModifier(){}extendPrototype([ShapeModifier],RepeaterModifier),RepeaterModifier.prototype.initModifierProperties=function(o,s){this.getValue=this.processKeys,this.c=PropertyFactory.getProp(o,s.c,0,null,this),this.o=PropertyFactory.getProp(o,s.o,0,null,this),this.tr=TransformPropertyFactory.getTransformProperty(o,s.tr,this),this.so=PropertyFactory.getProp(o,s.tr.so,0,.01,this),this.eo=PropertyFactory.getProp(o,s.tr.eo,0,.01,this),this.data=s,this.dynamicProperties.length||this.getValue(!0),this._isAnimated=!!this.dynamicProperties.length,this.pMatrix=new Matrix,this.rMatrix=new Matrix,this.sMatrix=new Matrix,this.tMatrix=new Matrix,this.matrix=new Matrix},RepeaterModifier.prototype.applyTransforms=function(o,s,a,et,tt,rt){var nt=rt?-1:1,it=et.s.v[0]+(1-et.s.v[0])*(1-tt),st=et.s.v[1]+(1-et.s.v[1])*(1-tt);o.translate(et.p.v[0]*nt*tt,et.p.v[1]*nt*tt,et.p.v[2]),s.translate(-et.a.v[0],-et.a.v[1],et.a.v[2]),s.rotate(-et.r.v*nt*tt),s.translate(et.a.v[0],et.a.v[1],et.a.v[2]),a.translate(-et.a.v[0],-et.a.v[1],et.a.v[2]),a.scale(rt?1/it:it,rt?1/st:st),a.translate(et.a.v[0],et.a.v[1],et.a.v[2])},RepeaterModifier.prototype.init=function(o,s,a,et){for(this.elem=o,this.arr=s,this.pos=a,this.elemsData=et,this._currentCopies=0,this._elements=[],this._groups=[],this.frameId=-1,this.initDynamicPropertyContainer(o),this.initModifierProperties(o,s[a]);a>0;)a-=1,this._elements.unshift(s[a]);this.dynamicProperties.length?this.k=!0:this.getValue(!0)},RepeaterModifier.prototype.resetElements=function(o){var s,a=o.length;for(s=0;s<a;s+=1)o[s]._processed=!1,o[s].ty==="gr"&&this.resetElements(o[s].it)},RepeaterModifier.prototype.cloneElements=function(o){var s=JSON.parse(JSON.stringify(o));return this.resetElements(s),s},RepeaterModifier.prototype.changeGroupRender=function(o,s){var a,et=o.length;for(a=0;a<et;a+=1)o[a]._render=s,o[a].ty==="gr"&&this.changeGroupRender(o[a].it,s)},RepeaterModifier.prototype.processShapes=function(o){var s,a,et,tt,rt,nt=!1;if(this._mdf||o){var it=Math.ceil(this.c.v);if(this._groups.length<it){for(;this._groups.length<it;){var st={it:this.cloneElements(this._elements),ty:"gr"};st.it.push({a:{a:0,ix:1,k:[0,0]},nm:"Transform",o:{a:0,ix:7,k:100},p:{a:0,ix:2,k:[0,0]},r:{a:1,ix:6,k:[{s:0,e:0,t:0},{s:0,e:0,t:1}]},s:{a:0,ix:3,k:[100,100]},sa:{a:0,ix:5,k:0},sk:{a:0,ix:4,k:0},ty:"tr"}),this.arr.splice(0,0,st),this._groups.splice(0,0,st),this._currentCopies+=1}this.elem.reloadShapes(),nt=!0}rt=0;var ot;for(et=0;et<=this._groups.length-1;et+=1){if(ot=rt<it,this._groups[et]._render=ot,this.changeGroupRender(this._groups[et].it,ot),!ot){var at=this.elemsData[et].it,lt=at[at.length-1];lt.transform.op.v!==0?(lt.transform.op._mdf=!0,lt.transform.op.v=0):lt.transform.op._mdf=!1}rt+=1}this._currentCopies=it;var ct=this.o.v,ht=ct%1,ft=ct>0?Math.floor(ct):Math.ceil(ct),dt=this.pMatrix.props,pt=this.rMatrix.props,gt=this.sMatrix.props;this.pMatrix.reset(),this.rMatrix.reset(),this.sMatrix.reset(),this.tMatrix.reset(),this.matrix.reset();var mt=0;if(ct>0){for(;mt<ft;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),mt+=1;ht&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,ht,!1),mt+=ht)}else if(ct<0){for(;mt>ft;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!0),mt-=1;ht&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,-ht,!0),mt-=ht)}et=this.data.m===1?0:this._currentCopies-1,tt=this.data.m===1?1:-1,rt=this._currentCopies;for(var yt,vt;rt;){if(s=this.elemsData[et].it,a=s[s.length-1].transform.mProps.v.props,vt=a.length,s[s.length-1].transform.mProps._mdf=!0,s[s.length-1].transform.op._mdf=!0,s[s.length-1].transform.op.v=this._currentCopies===1?this.so.v:this.so.v+(this.eo.v-this.so.v)*(et/(this._currentCopies-1)),mt!==0){for((et!==0&&tt===1||et!==this._currentCopies-1&&tt===-1)&&this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),this.matrix.transform(pt[0],pt[1],pt[2],pt[3],pt[4],pt[5],pt[6],pt[7],pt[8],pt[9],pt[10],pt[11],pt[12],pt[13],pt[14],pt[15]),this.matrix.transform(gt[0],gt[1],gt[2],gt[3],gt[4],gt[5],gt[6],gt[7],gt[8],gt[9],gt[10],gt[11],gt[12],gt[13],gt[14],gt[15]),this.matrix.transform(dt[0],dt[1],dt[2],dt[3],dt[4],dt[5],dt[6],dt[7],dt[8],dt[9],dt[10],dt[11],dt[12],dt[13],dt[14],dt[15]),yt=0;yt<vt;yt+=1)a[yt]=this.matrix.props[yt];this.matrix.reset()}else for(this.matrix.reset(),yt=0;yt<vt;yt+=1)a[yt]=this.matrix.props[yt];mt+=1,rt-=1,et+=tt}}else for(rt=this._currentCopies,et=0,tt=1;rt;)s=this.elemsData[et].it,a=s[s.length-1].transform.mProps.v.props,s[s.length-1].transform.mProps._mdf=!1,s[s.length-1].transform.op._mdf=!1,rt-=1,et+=tt;return nt},RepeaterModifier.prototype.addShape=function(){};function RoundCornersModifier(){}extendPrototype([ShapeModifier],RoundCornersModifier),RoundCornersModifier.prototype.initModifierProperties=function(o,s){this.getValue=this.processKeys,this.rd=PropertyFactory.getProp(o,s.r,0,null,this),this._isAnimated=!!this.rd.effectsSequence.length},RoundCornersModifier.prototype.processPath=function(o,s){var a=shapePool.newElement();a.c=o.c;var et,tt=o._length,rt,nt,it,st,ot,at,lt=0,ct,ht,ft,dt,pt,gt;for(et=0;et<tt;et+=1)rt=o.v[et],it=o.o[et],nt=o.i[et],rt[0]===it[0]&&rt[1]===it[1]&&rt[0]===nt[0]&&rt[1]===nt[1]?(et===0||et===tt-1)&&!o.c?(a.setTripleAt(rt[0],rt[1],it[0],it[1],nt[0],nt[1],lt),lt+=1):(et===0?st=o.v[tt-1]:st=o.v[et-1],ot=Math.sqrt(Math.pow(rt[0]-st[0],2)+Math.pow(rt[1]-st[1],2)),at=ot?Math.min(ot/2,s)/ot:0,pt=rt[0]+(st[0]-rt[0])*at,ct=pt,gt=rt[1]-(rt[1]-st[1])*at,ht=gt,ft=ct-(ct-rt[0])*roundCorner,dt=ht-(ht-rt[1])*roundCorner,a.setTripleAt(ct,ht,ft,dt,pt,gt,lt),lt+=1,et===tt-1?st=o.v[0]:st=o.v[et+1],ot=Math.sqrt(Math.pow(rt[0]-st[0],2)+Math.pow(rt[1]-st[1],2)),at=ot?Math.min(ot/2,s)/ot:0,ft=rt[0]+(st[0]-rt[0])*at,ct=ft,dt=rt[1]+(st[1]-rt[1])*at,ht=dt,pt=ct-(ct-rt[0])*roundCorner,gt=ht-(ht-rt[1])*roundCorner,a.setTripleAt(ct,ht,ft,dt,pt,gt,lt),lt+=1):(a.setTripleAt(o.v[et][0],o.v[et][1],o.o[et][0],o.o[et][1],o.i[et][0],o.i[et][1],lt),lt+=1);return a},RoundCornersModifier.prototype.processShapes=function(o){var s,a,et=this.shapes.length,tt,rt,nt=this.rd.v;if(nt!==0){var it,st;for(a=0;a<et;a+=1){if(it=this.shapes[a],st=it.localShapeCollection,!(!it.shape._mdf&&!this._mdf&&!o))for(st.releaseShapes(),it.shape._mdf=!0,s=it.shape.paths.shapes,rt=it.shape.paths._length,tt=0;tt<rt;tt+=1)st.addShape(this.processPath(s[tt],nt));it.shape.paths=it.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function floatEqual(o,s){return Math.abs(o-s)*1e5<=Math.min(Math.abs(o),Math.abs(s))}function floatZero(o){return Math.abs(o)<=1e-5}function lerp(o,s,a){return o*(1-a)+s*a}function lerpPoint(o,s,a){return[lerp(o[0],s[0],a),lerp(o[1],s[1],a)]}function quadRoots(o,s,a){if(o===0)return[];var et=s*s-4*o*a;if(et<0)return[];var tt=-s/(2*o);if(et===0)return[tt];var rt=Math.sqrt(et)/(2*o);return[tt-rt,tt+rt]}function polynomialCoefficients(o,s,a,et){return[-o+3*s-3*a+et,3*o-6*s+3*a,-3*o+3*s,o]}function singlePoint(o){return new PolynomialBezier(o,o,o,o,!1)}function PolynomialBezier(o,s,a,et,tt){tt&&pointEqual(o,s)&&(s=lerpPoint(o,et,1/3)),tt&&pointEqual(a,et)&&(a=lerpPoint(o,et,2/3));var rt=polynomialCoefficients(o[0],s[0],a[0],et[0]),nt=polynomialCoefficients(o[1],s[1],a[1],et[1]);this.a=[rt[0],nt[0]],this.b=[rt[1],nt[1]],this.c=[rt[2],nt[2]],this.d=[rt[3],nt[3]],this.points=[o,s,a,et]}PolynomialBezier.prototype.point=function(o){return[((this.a[0]*o+this.b[0])*o+this.c[0])*o+this.d[0],((this.a[1]*o+this.b[1])*o+this.c[1])*o+this.d[1]]},PolynomialBezier.prototype.derivative=function(o){return[(3*o*this.a[0]+2*this.b[0])*o+this.c[0],(3*o*this.a[1]+2*this.b[1])*o+this.c[1]]},PolynomialBezier.prototype.tangentAngle=function(o){var s=this.derivative(o);return Math.atan2(s[1],s[0])},PolynomialBezier.prototype.normalAngle=function(o){var s=this.derivative(o);return Math.atan2(s[0],s[1])},PolynomialBezier.prototype.inflectionPoints=function(){var o=this.a[1]*this.b[0]-this.a[0]*this.b[1];if(floatZero(o))return[];var s=-.5*(this.a[1]*this.c[0]-this.a[0]*this.c[1])/o,a=s*s-1/3*(this.b[1]*this.c[0]-this.b[0]*this.c[1])/o;if(a<0)return[];var et=Math.sqrt(a);return floatZero(et)?et>0&&et<1?[s]:[]:[s-et,s+et].filter(function(tt){return tt>0&&tt<1})},PolynomialBezier.prototype.split=function(o){if(o<=0)return[singlePoint(this.points[0]),this];if(o>=1)return[this,singlePoint(this.points[this.points.length-1])];var s=lerpPoint(this.points[0],this.points[1],o),a=lerpPoint(this.points[1],this.points[2],o),et=lerpPoint(this.points[2],this.points[3],o),tt=lerpPoint(s,a,o),rt=lerpPoint(a,et,o),nt=lerpPoint(tt,rt,o);return[new PolynomialBezier(this.points[0],s,tt,nt,!0),new PolynomialBezier(nt,rt,et,this.points[3],!0)]};function extrema(o,s){var a=o.points[0][s],et=o.points[o.points.length-1][s];if(a>et){var tt=et;et=a,a=tt}for(var rt=quadRoots(3*o.a[s],2*o.b[s],o.c[s]),nt=0;nt<rt.length;nt+=1)if(rt[nt]>0&&rt[nt]<1){var it=o.point(rt[nt])[s];it<a?a=it:it>et&&(et=it)}return{min:a,max:et}}PolynomialBezier.prototype.bounds=function(){return{x:extrema(this,0),y:extrema(this,1)}},PolynomialBezier.prototype.boundingBox=function(){var o=this.bounds();return{left:o.x.min,right:o.x.max,top:o.y.min,bottom:o.y.max,width:o.x.max-o.x.min,height:o.y.max-o.y.min,cx:(o.x.max+o.x.min)/2,cy:(o.y.max+o.y.min)/2}};function intersectData(o,s,a){var et=o.boundingBox();return{cx:et.cx,cy:et.cy,width:et.width,height:et.height,bez:o,t:(s+a)/2,t1:s,t2:a}}function splitData(o){var s=o.bez.split(.5);return[intersectData(s[0],o.t1,o.t),intersectData(s[1],o.t,o.t2)]}function boxIntersect(o,s){return Math.abs(o.cx-s.cx)*2<o.width+s.width&&Math.abs(o.cy-s.cy)*2<o.height+s.height}function intersectsImpl(o,s,a,et,tt,rt){if(boxIntersect(o,s)){if(a>=rt||o.width<=et&&o.height<=et&&s.width<=et&&s.height<=et){tt.push([o.t,s.t]);return}var nt=splitData(o),it=splitData(s);intersectsImpl(nt[0],it[0],a+1,et,tt,rt),intersectsImpl(nt[0],it[1],a+1,et,tt,rt),intersectsImpl(nt[1],it[0],a+1,et,tt,rt),intersectsImpl(nt[1],it[1],a+1,et,tt,rt)}}PolynomialBezier.prototype.intersections=function(o,s,a){s===void 0&&(s=2),a===void 0&&(a=7);var et=[];return intersectsImpl(intersectData(this,0,1),intersectData(o,0,1),0,s,et,a),et},PolynomialBezier.shapeSegment=function(o,s){var a=(s+1)%o.length();return new PolynomialBezier(o.v[s],o.o[s],o.i[a],o.v[a],!0)},PolynomialBezier.shapeSegmentInverted=function(o,s){var a=(s+1)%o.length();return new PolynomialBezier(o.v[a],o.i[a],o.o[s],o.v[s],!0)};function crossProduct(o,s){return[o[1]*s[2]-o[2]*s[1],o[2]*s[0]-o[0]*s[2],o[0]*s[1]-o[1]*s[0]]}function lineIntersection(o,s,a,et){var tt=[o[0],o[1],1],rt=[s[0],s[1],1],nt=[a[0],a[1],1],it=[et[0],et[1],1],st=crossProduct(crossProduct(tt,rt),crossProduct(nt,it));return floatZero(st[2])?null:[st[0]/st[2],st[1]/st[2]]}function polarOffset(o,s,a){return[o[0]+Math.cos(s)*a,o[1]-Math.sin(s)*a]}function pointDistance(o,s){return Math.hypot(o[0]-s[0],o[1]-s[1])}function pointEqual(o,s){return floatEqual(o[0],s[0])&&floatEqual(o[1],s[1])}function ZigZagModifier(){}extendPrototype([ShapeModifier],ZigZagModifier),ZigZagModifier.prototype.initModifierProperties=function(o,s){this.getValue=this.processKeys,this.amplitude=PropertyFactory.getProp(o,s.s,0,null,this),this.frequency=PropertyFactory.getProp(o,s.r,0,null,this),this.pointsType=PropertyFactory.getProp(o,s.pt,0,null,this),this._isAnimated=this.amplitude.effectsSequence.length!==0||this.frequency.effectsSequence.length!==0||this.pointsType.effectsSequence.length!==0};function setPoint(o,s,a,et,tt,rt,nt){var it=a-Math.PI/2,st=a+Math.PI/2,ot=s[0]+Math.cos(a)*et*tt,at=s[1]-Math.sin(a)*et*tt;o.setTripleAt(ot,at,ot+Math.cos(it)*rt,at-Math.sin(it)*rt,ot+Math.cos(st)*nt,at-Math.sin(st)*nt,o.length())}function getPerpendicularVector(o,s){var a=[s[0]-o[0],s[1]-o[1]],et=-Math.PI*.5,tt=[Math.cos(et)*a[0]-Math.sin(et)*a[1],Math.sin(et)*a[0]+Math.cos(et)*a[1]];return tt}function getProjectingAngle(o,s){var a=s===0?o.length()-1:s-1,et=(s+1)%o.length(),tt=o.v[a],rt=o.v[et],nt=getPerpendicularVector(tt,rt);return Math.atan2(0,1)-Math.atan2(nt[1],nt[0])}function zigZagCorner(o,s,a,et,tt,rt,nt){var it=getProjectingAngle(s,a),st=s.v[a%s._length],ot=s.v[a===0?s._length-1:a-1],at=s.v[(a+1)%s._length],lt=rt===2?Math.sqrt(Math.pow(st[0]-ot[0],2)+Math.pow(st[1]-ot[1],2)):0,ct=rt===2?Math.sqrt(Math.pow(st[0]-at[0],2)+Math.pow(st[1]-at[1],2)):0;setPoint(o,s.v[a%s._length],it,nt,et,ct/((tt+1)*2),lt/((tt+1)*2))}function zigZagSegment(o,s,a,et,tt,rt){for(var nt=0;nt<et;nt+=1){var it=(nt+1)/(et+1),st=tt===2?Math.sqrt(Math.pow(s.points[3][0]-s.points[0][0],2)+Math.pow(s.points[3][1]-s.points[0][1],2)):0,ot=s.normalAngle(it),at=s.point(it);setPoint(o,at,ot,rt,a,st/((et+1)*2),st/((et+1)*2)),rt=-rt}return rt}ZigZagModifier.prototype.processPath=function(o,s,a,et){var tt=o._length,rt=shapePool.newElement();if(rt.c=o.c,o.c||(tt-=1),tt===0)return rt;var nt=-1,it=PolynomialBezier.shapeSegment(o,0);zigZagCorner(rt,o,0,s,a,et,nt);for(var st=0;st<tt;st+=1)nt=zigZagSegment(rt,it,s,a,et,-nt),st===tt-1&&!o.c?it=null:it=PolynomialBezier.shapeSegment(o,(st+1)%tt),zigZagCorner(rt,o,st+1,s,a,et,nt);return rt},ZigZagModifier.prototype.processShapes=function(o){var s,a,et=this.shapes.length,tt,rt,nt=this.amplitude.v,it=Math.max(0,Math.round(this.frequency.v)),st=this.pointsType.v;if(nt!==0){var ot,at;for(a=0;a<et;a+=1){if(ot=this.shapes[a],at=ot.localShapeCollection,!(!ot.shape._mdf&&!this._mdf&&!o))for(at.releaseShapes(),ot.shape._mdf=!0,s=ot.shape.paths.shapes,rt=ot.shape.paths._length,tt=0;tt<rt;tt+=1)at.addShape(this.processPath(s[tt],nt,it,st));ot.shape.paths=ot.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function linearOffset(o,s,a){var et=Math.atan2(s[0]-o[0],s[1]-o[1]);return[polarOffset(o,et,a),polarOffset(s,et,a)]}function offsetSegment(o,s){var a,et,tt,rt,nt,it,st;st=linearOffset(o.points[0],o.points[1],s),a=st[0],et=st[1],st=linearOffset(o.points[1],o.points[2],s),tt=st[0],rt=st[1],st=linearOffset(o.points[2],o.points[3],s),nt=st[0],it=st[1];var ot=lineIntersection(a,et,tt,rt);ot===null&&(ot=et);var at=lineIntersection(nt,it,tt,rt);return at===null&&(at=nt),new PolynomialBezier(a,ot,at,it)}function joinLines(o,s,a,et,tt){var rt=s.points[3],nt=a.points[0];if(et===3||pointEqual(rt,nt))return rt;if(et===2){var it=-s.tangentAngle(1),st=-a.tangentAngle(0)+Math.PI,ot=lineIntersection(rt,polarOffset(rt,it+Math.PI/2,100),nt,polarOffset(nt,it+Math.PI/2,100)),at=ot?pointDistance(ot,rt):pointDistance(rt,nt)/2,lt=polarOffset(rt,it,2*at*roundCorner);return o.setXYAt(lt[0],lt[1],"o",o.length()-1),lt=polarOffset(nt,st,2*at*roundCorner),o.setTripleAt(nt[0],nt[1],nt[0],nt[1],lt[0],lt[1],o.length()),nt}var ct=pointEqual(rt,s.points[2])?s.points[0]:s.points[2],ht=pointEqual(nt,a.points[1])?a.points[3]:a.points[1],ft=lineIntersection(ct,rt,nt,ht);return ft&&pointDistance(ft,rt)<tt?(o.setTripleAt(ft[0],ft[1],ft[0],ft[1],ft[0],ft[1],o.length()),ft):rt}function getIntersection(o,s){var a=o.intersections(s);return a.length&&floatEqual(a[0][0],1)&&a.shift(),a.length?a[0]:null}function pruneSegmentIntersection(o,s){var a=o.slice(),et=s.slice(),tt=getIntersection(o[o.length-1],s[0]);return tt&&(a[o.length-1]=o[o.length-1].split(tt[0])[0],et[0]=s[0].split(tt[1])[1]),o.length>1&&s.length>1&&(tt=getIntersection(o[0],s[s.length-1]),tt)?[[o[0].split(tt[0])[0]],[s[s.length-1].split(tt[1])[1]]]:[a,et]}function pruneIntersections(o){for(var s,a=1;a<o.length;a+=1)s=pruneSegmentIntersection(o[a-1],o[a]),o[a-1]=s[0],o[a]=s[1];return o.length>1&&(s=pruneSegmentIntersection(o[o.length-1],o[0]),o[o.length-1]=s[0],o[0]=s[1]),o}function offsetSegmentSplit(o,s){var a=o.inflectionPoints(),et,tt,rt,nt;if(a.length===0)return[offsetSegment(o,s)];if(a.length===1||floatEqual(a[1],1))return rt=o.split(a[0]),et=rt[0],tt=rt[1],[offsetSegment(et,s),offsetSegment(tt,s)];rt=o.split(a[0]),et=rt[0];var it=(a[1]-a[0])/(1-a[0]);return rt=rt[1].split(it),nt=rt[0],tt=rt[1],[offsetSegment(et,s),offsetSegment(nt,s),offsetSegment(tt,s)]}function OffsetPathModifier(){}extendPrototype([ShapeModifier],OffsetPathModifier),OffsetPathModifier.prototype.initModifierProperties=function(o,s){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(o,s.a,0,null,this),this.miterLimit=PropertyFactory.getProp(o,s.ml,0,null,this),this.lineJoin=s.lj,this._isAnimated=this.amount.effectsSequence.length!==0},OffsetPathModifier.prototype.processPath=function(o,s,a,et){var tt=shapePool.newElement();tt.c=o.c;var rt=o.length();o.c||(rt-=1);var nt,it,st,ot=[];for(nt=0;nt<rt;nt+=1)st=PolynomialBezier.shapeSegment(o,nt),ot.push(offsetSegmentSplit(st,s));if(!o.c)for(nt=rt-1;nt>=0;nt-=1)st=PolynomialBezier.shapeSegmentInverted(o,nt),ot.push(offsetSegmentSplit(st,s));ot=pruneIntersections(ot);var at=null,lt=null;for(nt=0;nt<ot.length;nt+=1){var ct=ot[nt];for(lt&&(at=joinLines(tt,lt,ct[0],a,et)),lt=ct[ct.length-1],it=0;it<ct.length;it+=1)st=ct[it],at&&pointEqual(st.points[0],at)?tt.setXYAt(st.points[1][0],st.points[1][1],"o",tt.length()-1):tt.setTripleAt(st.points[0][0],st.points[0][1],st.points[1][0],st.points[1][1],st.points[0][0],st.points[0][1],tt.length()),tt.setTripleAt(st.points[3][0],st.points[3][1],st.points[3][0],st.points[3][1],st.points[2][0],st.points[2][1],tt.length()),at=st.points[3]}return ot.length&&joinLines(tt,lt,ot[0][0],a,et),tt},OffsetPathModifier.prototype.processShapes=function(o){var s,a,et=this.shapes.length,tt,rt,nt=this.amount.v,it=this.miterLimit.v,st=this.lineJoin;if(nt!==0){var ot,at;for(a=0;a<et;a+=1){if(ot=this.shapes[a],at=ot.localShapeCollection,!(!ot.shape._mdf&&!this._mdf&&!o))for(at.releaseShapes(),ot.shape._mdf=!0,s=ot.shape.paths.shapes,rt=ot.shape.paths._length,tt=0;tt<rt;tt+=1)at.addShape(this.processPath(s[tt],nt,st,it));ot.shape.paths=ot.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function getFontProperties(o){for(var s=o.fStyle?o.fStyle.split(" "):[],a="normal",et="normal",tt=s.length,rt,nt=0;nt<tt;nt+=1)switch(rt=s[nt].toLowerCase(),rt){case"italic":et="italic";break;case"bold":a="700";break;case"black":a="900";break;case"medium":a="500";break;case"regular":case"normal":a="400";break;case"light":case"thin":a="200";break}return{style:et,weight:o.fWeight||a}}var FontManager=function(){var o=5e3,s={w:0,size:0,shapes:[],data:{shapes:[]}},a=[];a=a.concat([2304,2305,2306,2307,2362,2363,2364,2364,2366,2367,2368,2369,2370,2371,2372,2373,2374,2375,2376,2377,2378,2379,2380,2381,2382,2383,2387,2388,2389,2390,2391,2402,2403]);var et=127988,tt=917631,rt=917601,nt=917626,it=65039,st=8205,ot=127462,at=127487,lt=["d83cdffb","d83cdffc","d83cdffd","d83cdffe","d83cdfff"];function ct(Pt){var Dt=Pt.split(","),Tt,St=Dt.length,Mt=[];for(Tt=0;Tt<St;Tt+=1)Dt[Tt]!=="sans-serif"&&Dt[Tt]!=="monospace"&&Mt.push(Dt[Tt]);return Mt.join(",")}function ht(Pt,Dt){var Tt=createTag("span");Tt.setAttribute("aria-hidden",!0),Tt.style.fontFamily=Dt;var St=createTag("span");St.innerText="giItT1WQy@!-/#",Tt.style.position="absolute",Tt.style.left="-10000px",Tt.style.top="-10000px",Tt.style.fontSize="300px",Tt.style.fontVariant="normal",Tt.style.fontStyle="normal",Tt.style.fontWeight="normal",Tt.style.letterSpacing="0",Tt.appendChild(St),document.body.appendChild(Tt);var Mt=St.offsetWidth;return St.style.fontFamily=ct(Pt)+", "+Dt,{node:St,w:Mt,parent:Tt}}function ft(){var Pt,Dt=this.fonts.length,Tt,St,Mt=Dt;for(Pt=0;Pt<Dt;Pt+=1)this.fonts[Pt].loaded?Mt-=1:this.fonts[Pt].fOrigin==="n"||this.fonts[Pt].origin===0?this.fonts[Pt].loaded=!0:(Tt=this.fonts[Pt].monoCase.node,St=this.fonts[Pt].monoCase.w,Tt.offsetWidth!==St?(Mt-=1,this.fonts[Pt].loaded=!0):(Tt=this.fonts[Pt].sansCase.node,St=this.fonts[Pt].sansCase.w,Tt.offsetWidth!==St&&(Mt-=1,this.fonts[Pt].loaded=!0)),this.fonts[Pt].loaded&&(this.fonts[Pt].sansCase.parent.parentNode.removeChild(this.fonts[Pt].sansCase.parent),this.fonts[Pt].monoCase.parent.parentNode.removeChild(this.fonts[Pt].monoCase.parent)));Mt!==0&&Date.now()-this.initTime<o?setTimeout(this.checkLoadedFontsBinded,20):setTimeout(this.setIsLoadedBinded,10)}function dt(Pt,Dt){var Tt=document.body&&Dt?"svg":"canvas",St,Mt=getFontProperties(Pt);if(Tt==="svg"){var jt=createNS("text");jt.style.fontSize="100px",jt.setAttribute("font-family",Pt.fFamily),jt.setAttribute("font-style",Mt.style),jt.setAttribute("font-weight",Mt.weight),jt.textContent="1",Pt.fClass?(jt.style.fontFamily="inherit",jt.setAttribute("class",Pt.fClass)):jt.style.fontFamily=Pt.fFamily,Dt.appendChild(jt),St=jt}else{var Gt=new OffscreenCanvas(500,500).getContext("2d");Gt.font=Mt.style+" "+Mt.weight+" 100px "+Pt.fFamily,St=Gt}function Ht(At){return Tt==="svg"?(St.textContent=At,St.getComputedTextLength()):St.measureText(At).width}return{measureText:Ht}}function pt(Pt,Dt){if(!Pt){this.isLoaded=!0;return}if(this.chars){this.isLoaded=!0,this.fonts=Pt.list;return}if(!document.body){this.isLoaded=!0,Pt.list.forEach(function(bt){bt.helper=dt(bt),bt.cache={}}),this.fonts=Pt.list;return}var Tt=Pt.list,St,Mt=Tt.length,jt=Mt;for(St=0;St<Mt;St+=1){var Gt=!0,Ht,At;if(Tt[St].loaded=!1,Tt[St].monoCase=ht(Tt[St].fFamily,"monospace"),Tt[St].sansCase=ht(Tt[St].fFamily,"sans-serif"),!Tt[St].fPath)Tt[St].loaded=!0,jt-=1;else if(Tt[St].fOrigin==="p"||Tt[St].origin===3){if(Ht=document.querySelectorAll('style[f-forigin="p"][f-family="'+Tt[St].fFamily+'"], style[f-origin="3"][f-family="'+Tt[St].fFamily+'"]'),Ht.length>0&&(Gt=!1),Gt){var $t=createTag("style");$t.setAttribute("f-forigin",Tt[St].fOrigin),$t.setAttribute("f-origin",Tt[St].origin),$t.setAttribute("f-family",Tt[St].fFamily),$t.type="text/css",$t.innerText="@font-face {font-family: "+Tt[St].fFamily+"; font-style: normal; src: url('"+Tt[St].fPath+"');}",Dt.appendChild($t)}}else if(Tt[St].fOrigin==="g"||Tt[St].origin===1){for(Ht=document.querySelectorAll('link[f-forigin="g"], link[f-origin="1"]'),At=0;At<Ht.length;At+=1)Ht[At].href.indexOf(Tt[St].fPath)!==-1&&(Gt=!1);if(Gt){var kt=createTag("link");kt.setAttribute("f-forigin",Tt[St].fOrigin),kt.setAttribute("f-origin",Tt[St].origin),kt.type="text/css",kt.rel="stylesheet",kt.href=Tt[St].fPath,document.body.appendChild(kt)}}else if(Tt[St].fOrigin==="t"||Tt[St].origin===2){for(Ht=document.querySelectorAll('script[f-forigin="t"], script[f-origin="2"]'),At=0;At<Ht.length;At+=1)Tt[St].fPath===Ht[At].src&&(Gt=!1);if(Gt){var Lt=createTag("link");Lt.setAttribute("f-forigin",Tt[St].fOrigin),Lt.setAttribute("f-origin",Tt[St].origin),Lt.setAttribute("rel","stylesheet"),Lt.setAttribute("href",Tt[St].fPath),Dt.appendChild(Lt)}}Tt[St].helper=dt(Tt[St],Dt),Tt[St].cache={},this.fonts.push(Tt[St])}jt===0?this.isLoaded=!0:setTimeout(this.checkLoadedFonts.bind(this),100)}function gt(Pt){if(Pt){this.chars||(this.chars=[]);var Dt,Tt=Pt.length,St,Mt=this.chars.length,jt;for(Dt=0;Dt<Tt;Dt+=1){for(St=0,jt=!1;St<Mt;)this.chars[St].style===Pt[Dt].style&&this.chars[St].fFamily===Pt[Dt].fFamily&&this.chars[St].ch===Pt[Dt].ch&&(jt=!0),St+=1;jt||(this.chars.push(Pt[Dt]),Mt+=1)}}}function mt(Pt,Dt,Tt){for(var St=0,Mt=this.chars.length;St<Mt;){if(this.chars[St].ch===Pt&&this.chars[St].style===Dt&&this.chars[St].fFamily===Tt)return this.chars[St];St+=1}return(typeof Pt=="string"&&Pt.charCodeAt(0)!==13||!Pt)&&console&&console.warn&&!this._warned&&(this._warned=!0,console.warn("Missing character from exported characters list: ",Pt,Dt,Tt)),s}function yt(Pt,Dt,Tt){var St=this.getFontByName(Dt),Mt=Pt;if(!St.cache[Mt]){var jt=St.helper;if(Pt===" "){var Gt=jt.measureText("|"+Pt+"|"),Ht=jt.measureText("||");St.cache[Mt]=(Gt-Ht)/100}else St.cache[Mt]=jt.measureText(Pt)/100}return St.cache[Mt]*Tt}function vt(Pt){for(var Dt=0,Tt=this.fonts.length;Dt<Tt;){if(this.fonts[Dt].fName===Pt)return this.fonts[Dt];Dt+=1}return this.fonts[0]}function Et(Pt){var Dt=0,Tt=Pt.charCodeAt(0);if(Tt>=55296&&Tt<=56319){var St=Pt.charCodeAt(1);St>=56320&&St<=57343&&(Dt=(Tt-55296)*1024+St-56320+65536)}return Dt}function xt(Pt,Dt){var Tt=Pt.toString(16)+Dt.toString(16);return lt.indexOf(Tt)!==-1}function wt(Pt){return Pt===st}function Rt(Pt){return Pt===it}function Ct(Pt){var Dt=Et(Pt);return Dt>=ot&&Dt<=at}function Ft(Pt){return Ct(Pt.substr(0,2))&&Ct(Pt.substr(2,2))}function zt(Pt){return a.indexOf(Pt)!==-1}function Nt(Pt,Dt){var Tt=Et(Pt.substr(Dt,2));if(Tt!==et)return!1;var St=0;for(Dt+=2;St<5;){if(Tt=Et(Pt.substr(Dt,2)),Tt<rt||Tt>nt)return!1;St+=1,Dt+=2}return Et(Pt.substr(Dt,2))===tt}function Kt(){this.isLoaded=!0}var Yt=function(){this.fonts=[],this.chars=null,this.typekitLoaded=0,this.isLoaded=!1,this._warned=!1,this.initTime=Date.now(),this.setIsLoadedBinded=this.setIsLoaded.bind(this),this.checkLoadedFontsBinded=this.checkLoadedFonts.bind(this)};Yt.isModifier=xt,Yt.isZeroWidthJoiner=wt,Yt.isFlagEmoji=Ft,Yt.isRegionalCode=Ct,Yt.isCombinedCharacter=zt,Yt.isRegionalFlag=Nt,Yt.isVariationSelector=Rt,Yt.BLACK_FLAG_CODE_POINT=et;var Bt={addChars:gt,addFonts:pt,getCharData:mt,getFontByName:vt,measureText:yt,checkLoadedFonts:ft,setIsLoaded:Kt};return Yt.prototype=Bt,Yt}();function SlotManager(o){this.animationData=o}SlotManager.prototype.getProp=function(o){return this.animationData.slots&&this.animationData.slots[o.sid]?Object.assign(o,this.animationData.slots[o.sid].p):o};function slotFactory(o){return new SlotManager(o)}function RenderableElement(){}RenderableElement.prototype={initRenderable:function(){this.isInRange=!1,this.hidden=!1,this.isTransparent=!1,this.renderableComponents=[]},addRenderableComponent:function(s){this.renderableComponents.indexOf(s)===-1&&this.renderableComponents.push(s)},removeRenderableComponent:function(s){this.renderableComponents.indexOf(s)!==-1&&this.renderableComponents.splice(this.renderableComponents.indexOf(s),1)},prepareRenderableFrame:function(s){this.checkLayerLimits(s)},checkTransparency:function(){this.finalTransform.mProp.o.v<=0?!this.isTransparent&&this.globalData.renderConfig.hideOnTransparent&&(this.isTransparent=!0,this.hide()):this.isTransparent&&(this.isTransparent=!1,this.show())},checkLayerLimits:function(s){this.data.ip-this.data.st<=s&&this.data.op-this.data.st>s?this.isInRange!==!0&&(this.globalData._mdf=!0,this._mdf=!0,this.isInRange=!0,this.show()):this.isInRange!==!1&&(this.globalData._mdf=!0,this.isInRange=!1,this.hide())},renderRenderable:function(){var s,a=this.renderableComponents.length;for(s=0;s<a;s+=1)this.renderableComponents[s].renderFrame(this._isFirstFrame)},sourceRectAtTime:function(){return{top:0,left:0,width:100,height:100}},getLayerSize:function(){return this.data.ty===5?{w:this.data.textData.width,h:this.data.textData.height}:{w:this.data.width,h:this.data.height}}};var getBlendMode=function(){var o={0:"source-over",1:"multiply",2:"screen",3:"overlay",4:"darken",5:"lighten",6:"color-dodge",7:"color-burn",8:"hard-light",9:"soft-light",10:"difference",11:"exclusion",12:"hue",13:"saturation",14:"color",15:"luminosity"};return function(s){return o[s]||""}}();function SliderEffect(o,s,a){this.p=PropertyFactory.getProp(s,o.v,0,0,a)}function AngleEffect(o,s,a){this.p=PropertyFactory.getProp(s,o.v,0,0,a)}function ColorEffect(o,s,a){this.p=PropertyFactory.getProp(s,o.v,1,0,a)}function PointEffect(o,s,a){this.p=PropertyFactory.getProp(s,o.v,1,0,a)}function LayerIndexEffect(o,s,a){this.p=PropertyFactory.getProp(s,o.v,0,0,a)}function MaskIndexEffect(o,s,a){this.p=PropertyFactory.getProp(s,o.v,0,0,a)}function CheckboxEffect(o,s,a){this.p=PropertyFactory.getProp(s,o.v,0,0,a)}function NoValueEffect(){this.p={}}function EffectsManager(o,s){var a=o.ef||[];this.effectElements=[];var et,tt=a.length,rt;for(et=0;et<tt;et+=1)rt=new GroupEffect(a[et],s),this.effectElements.push(rt)}function GroupEffect(o,s){this.init(o,s)}extendPrototype([DynamicPropertyContainer],GroupEffect),GroupEffect.prototype.getValue=GroupEffect.prototype.iterateDynamicProperties,GroupEffect.prototype.init=function(o,s){this.data=o,this.effectElements=[],this.initDynamicPropertyContainer(s);var a,et=this.data.ef.length,tt,rt=this.data.ef;for(a=0;a<et;a+=1){switch(tt=null,rt[a].ty){case 0:tt=new SliderEffect(rt[a],s,this);break;case 1:tt=new AngleEffect(rt[a],s,this);break;case 2:tt=new ColorEffect(rt[a],s,this);break;case 3:tt=new PointEffect(rt[a],s,this);break;case 4:case 7:tt=new CheckboxEffect(rt[a],s,this);break;case 10:tt=new LayerIndexEffect(rt[a],s,this);break;case 11:tt=new MaskIndexEffect(rt[a],s,this);break;case 5:tt=new EffectsManager(rt[a],s);break;default:tt=new NoValueEffect(rt[a]);break}tt&&this.effectElements.push(tt)}};function BaseElement(){}BaseElement.prototype={checkMasks:function(){if(!this.data.hasMask)return!1;for(var s=0,a=this.data.masksProperties.length;s<a;){if(this.data.masksProperties[s].mode!=="n"&&this.data.masksProperties[s].cl!==!1)return!0;s+=1}return!1},initExpressions:function(){var s=getExpressionInterfaces();if(s){var a=s("layer"),et=s("effects"),tt=s("shape"),rt=s("text"),nt=s("comp");this.layerInterface=a(this),this.data.hasMask&&this.maskManager&&this.layerInterface.registerMaskInterface(this.maskManager);var it=et.createEffectsInterface(this,this.layerInterface);this.layerInterface.registerEffectsInterface(it),this.data.ty===0||this.data.xt?this.compInterface=nt(this):this.data.ty===4?(this.layerInterface.shapeInterface=tt(this.shapesData,this.itemsData,this.layerInterface),this.layerInterface.content=this.layerInterface.shapeInterface):this.data.ty===5&&(this.layerInterface.textInterface=rt(this),this.layerInterface.text=this.layerInterface.textInterface)}},setBlendMode:function(){var s=getBlendMode(this.data.bm),a=this.baseElement||this.layerElement;a.style["mix-blend-mode"]=s},initBaseData:function(s,a,et){this.globalData=a,this.comp=et,this.data=s,this.layerId=createElementID(),this.data.sr||(this.data.sr=1),this.effectsManager=new EffectsManager(this.data,this,this.dynamicProperties)},getType:function(){return this.type},sourceRectAtTime:function(){}};function FrameElement(){}FrameElement.prototype={initFrame:function(){this._isFirstFrame=!1,this.dynamicProperties=[],this._mdf=!1},prepareProperties:function(s,a){var et,tt=this.dynamicProperties.length;for(et=0;et<tt;et+=1)(a||this._isParent&&this.dynamicProperties[et].propType==="transform")&&(this.dynamicProperties[et].getValue(),this.dynamicProperties[et]._mdf&&(this.globalData._mdf=!0,this._mdf=!0))},addDynamicProperty:function(s){this.dynamicProperties.indexOf(s)===-1&&this.dynamicProperties.push(s)}};function FootageElement(o,s,a){this.initFrame(),this.initRenderable(),this.assetData=s.getAssetData(o.refId),this.footageData=s.imageLoader.getAsset(this.assetData),this.initBaseData(o,s,a)}FootageElement.prototype.prepareFrame=function(){},extendPrototype([RenderableElement,BaseElement,FrameElement],FootageElement),FootageElement.prototype.getBaseElement=function(){return null},FootageElement.prototype.renderFrame=function(){},FootageElement.prototype.destroy=function(){},FootageElement.prototype.initExpressions=function(){var o=getExpressionInterfaces();if(o){var s=o("footage");this.layerInterface=s(this)}},FootageElement.prototype.getFootageData=function(){return this.footageData};function AudioElement(o,s,a){this.initFrame(),this.initRenderable(),this.assetData=s.getAssetData(o.refId),this.initBaseData(o,s,a),this._isPlaying=!1,this._canPlay=!1;var et=this.globalData.getAssetsPath(this.assetData);this.audio=this.globalData.audioController.createAudio(et),this._currentTime=0,this.globalData.audioController.addAudio(this),this._volumeMultiplier=1,this._volume=1,this._previousVolume=null,this.tm=o.tm?PropertyFactory.getProp(this,o.tm,0,s.frameRate,this):{_placeholder:!0},this.lv=PropertyFactory.getProp(this,o.au&&o.au.lv?o.au.lv:{k:[100]},1,.01,this)}AudioElement.prototype.prepareFrame=function(o){if(this.prepareRenderableFrame(o,!0),this.prepareProperties(o,!0),this.tm._placeholder)this._currentTime=o/this.data.sr;else{var s=this.tm.v;this._currentTime=s}this._volume=this.lv.v[0];var a=this._volume*this._volumeMultiplier;this._previousVolume!==a&&(this._previousVolume=a,this.audio.volume(a))},extendPrototype([RenderableElement,BaseElement,FrameElement],AudioElement),AudioElement.prototype.renderFrame=function(){this.isInRange&&this._canPlay&&(this._isPlaying?(!this.audio.playing()||Math.abs(this._currentTime/this.globalData.frameRate-this.audio.seek())>.1)&&this.audio.seek(this._currentTime/this.globalData.frameRate):(this.audio.play(),this.audio.seek(this._currentTime/this.globalData.frameRate),this._isPlaying=!0))},AudioElement.prototype.show=function(){},AudioElement.prototype.hide=function(){this.audio.pause(),this._isPlaying=!1},AudioElement.prototype.pause=function(){this.audio.pause(),this._isPlaying=!1,this._canPlay=!1},AudioElement.prototype.resume=function(){this._canPlay=!0},AudioElement.prototype.setRate=function(o){this.audio.rate(o)},AudioElement.prototype.volume=function(o){this._volumeMultiplier=o,this._previousVolume=o*this._volume,this.audio.volume(this._previousVolume)},AudioElement.prototype.getBaseElement=function(){return null},AudioElement.prototype.destroy=function(){},AudioElement.prototype.sourceRectAtTime=function(){},AudioElement.prototype.initExpressions=function(){};function BaseRenderer(){}BaseRenderer.prototype.checkLayers=function(o){var s,a=this.layers.length,et;for(this.completeLayers=!0,s=a-1;s>=0;s-=1)this.elements[s]||(et=this.layers[s],et.ip-et.st<=o-this.layers[s].st&&et.op-et.st>o-this.layers[s].st&&this.buildItem(s)),this.completeLayers=this.elements[s]?this.completeLayers:!1;this.checkPendingElements()},BaseRenderer.prototype.createItem=function(o){switch(o.ty){case 2:return this.createImage(o);case 0:return this.createComp(o);case 1:return this.createSolid(o);case 3:return this.createNull(o);case 4:return this.createShape(o);case 5:return this.createText(o);case 6:return this.createAudio(o);case 13:return this.createCamera(o);case 15:return this.createFootage(o);default:return this.createNull(o)}},BaseRenderer.prototype.createCamera=function(){throw new Error("You're using a 3d camera. Try the html renderer.")},BaseRenderer.prototype.createAudio=function(o){return new AudioElement(o,this.globalData,this)},BaseRenderer.prototype.createFootage=function(o){return new FootageElement(o,this.globalData,this)},BaseRenderer.prototype.buildAllItems=function(){var o,s=this.layers.length;for(o=0;o<s;o+=1)this.buildItem(o);this.checkPendingElements()},BaseRenderer.prototype.includeLayers=function(o){this.completeLayers=!1;var s,a=o.length,et,tt=this.layers.length;for(s=0;s<a;s+=1)for(et=0;et<tt;){if(this.layers[et].id===o[s].id){this.layers[et]=o[s];break}et+=1}},BaseRenderer.prototype.setProjectInterface=function(o){this.globalData.projectInterface=o},BaseRenderer.prototype.initItems=function(){this.globalData.progressiveLoad||this.buildAllItems()},BaseRenderer.prototype.buildElementParenting=function(o,s,a){for(var et=this.elements,tt=this.layers,rt=0,nt=tt.length;rt<nt;)tt[rt].ind==s&&(!et[rt]||et[rt]===!0?(this.buildItem(rt),this.addPendingElement(o)):(a.push(et[rt]),et[rt].setAsParent(),tt[rt].parent!==void 0?this.buildElementParenting(o,tt[rt].parent,a):o.setHierarchy(a))),rt+=1},BaseRenderer.prototype.addPendingElement=function(o){this.pendingElements.push(o)},BaseRenderer.prototype.searchExtraCompositions=function(o){var s,a=o.length;for(s=0;s<a;s+=1)if(o[s].xt){var et=this.createComp(o[s]);et.initExpressions(),this.globalData.projectInterface.registerComposition(et)}},BaseRenderer.prototype.getElementById=function(o){var s,a=this.elements.length;for(s=0;s<a;s+=1)if(this.elements[s].data.ind===o)return this.elements[s];return null},BaseRenderer.prototype.getElementByPath=function(o){var s=o.shift(),a;if(typeof s=="number")a=this.elements[s];else{var et,tt=this.elements.length;for(et=0;et<tt;et+=1)if(this.elements[et].data.nm===s){a=this.elements[et];break}}return o.length===0?a:a.getElementByPath(o)},BaseRenderer.prototype.setupGlobalData=function(o,s){this.globalData.fontManager=new FontManager,this.globalData.slotManager=slotFactory(o),this.globalData.fontManager.addChars(o.chars),this.globalData.fontManager.addFonts(o.fonts,s),this.globalData.getAssetData=this.animationItem.getAssetData.bind(this.animationItem),this.globalData.getAssetsPath=this.animationItem.getAssetsPath.bind(this.animationItem),this.globalData.imageLoader=this.animationItem.imagePreloader,this.globalData.audioController=this.animationItem.audioController,this.globalData.frameId=0,this.globalData.frameRate=o.fr,this.globalData.nm=o.nm,this.globalData.compSize={w:o.w,h:o.h}};var effectTypes={TRANSFORM_EFFECT:"transformEFfect"};function TransformElement(){}TransformElement.prototype={initTransform:function(){var s=new Matrix;this.finalTransform={mProp:this.data.ks?TransformPropertyFactory.getTransformProperty(this,this.data.ks,this):{o:0},_matMdf:!1,_localMatMdf:!1,_opMdf:!1,mat:s,localMat:s,localOpacity:1},this.data.ao&&(this.finalTransform.mProp.autoOriented=!0),this.data.ty},renderTransform:function(){if(this.finalTransform._opMdf=this.finalTransform.mProp.o._mdf||this._isFirstFrame,this.finalTransform._matMdf=this.finalTransform.mProp._mdf||this._isFirstFrame,this.hierarchy){var s,a=this.finalTransform.mat,et=0,tt=this.hierarchy.length;if(!this.finalTransform._matMdf)for(;et<tt;){if(this.hierarchy[et].finalTransform.mProp._mdf){this.finalTransform._matMdf=!0;break}et+=1}if(this.finalTransform._matMdf)for(s=this.finalTransform.mProp.v.props,a.cloneFromProps(s),et=0;et<tt;et+=1)a.multiply(this.hierarchy[et].finalTransform.mProp.v)}this.finalTransform._matMdf&&(this.finalTransform._localMatMdf=this.finalTransform._matMdf),this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v)},renderLocalTransform:function(){if(this.localTransforms){var s=0,a=this.localTransforms.length;if(this.finalTransform._localMatMdf=this.finalTransform._matMdf,!this.finalTransform._localMatMdf||!this.finalTransform._opMdf)for(;s<a;)this.localTransforms[s]._mdf&&(this.finalTransform._localMatMdf=!0),this.localTransforms[s]._opMdf&&!this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v,this.finalTransform._opMdf=!0),s+=1;if(this.finalTransform._localMatMdf){var et=this.finalTransform.localMat;for(this.localTransforms[0].matrix.clone(et),s=1;s<a;s+=1){var tt=this.localTransforms[s].matrix;et.multiply(tt)}et.multiply(this.finalTransform.mat)}if(this.finalTransform._opMdf){var rt=this.finalTransform.localOpacity;for(s=0;s<a;s+=1)rt*=this.localTransforms[s].opacity*.01;this.finalTransform.localOpacity=rt}}},searchEffectTransforms:function(){if(this.renderableEffectsManager){var s=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT);if(s.length){this.localTransforms=[],this.finalTransform.localMat=new Matrix;var a=0,et=s.length;for(a=0;a<et;a+=1)this.localTransforms.push(s[a])}}},globalToLocal:function(s){var a=[];a.push(this.finalTransform);for(var et=!0,tt=this.comp;et;)tt.finalTransform?(tt.data.hasMask&&a.splice(0,0,tt.finalTransform),tt=tt.comp):et=!1;var rt,nt=a.length,it;for(rt=0;rt<nt;rt+=1)it=a[rt].mat.applyToPointArray(0,0,0),s=[s[0]-it[0],s[1]-it[1],0];return s},mHelper:new Matrix};function MaskElement(o,s,a){this.data=o,this.element=s,this.globalData=a,this.storedData=[],this.masksProperties=this.data.masksProperties||[],this.maskElement=null;var et=this.globalData.defs,tt,rt=this.masksProperties?this.masksProperties.length:0;this.viewData=createSizedArray(rt),this.solidPath="";var nt,it=this.masksProperties,st=0,ot=[],at,lt,ct=createElementID(),ht,ft,dt,pt,gt="clipPath",mt="clip-path";for(tt=0;tt<rt;tt+=1)if((it[tt].mode!=="a"&&it[tt].mode!=="n"||it[tt].inv||it[tt].o.k!==100||it[tt].o.x)&&(gt="mask",mt="mask"),(it[tt].mode==="s"||it[tt].mode==="i")&&st===0?(ht=createNS("rect"),ht.setAttribute("fill","#ffffff"),ht.setAttribute("width",this.element.comp.data.w||0),ht.setAttribute("height",this.element.comp.data.h||0),ot.push(ht)):ht=null,nt=createNS("path"),it[tt].mode==="n")this.viewData[tt]={op:PropertyFactory.getProp(this.element,it[tt].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,it[tt],3),elem:nt,lastPath:""},et.appendChild(nt);else{st+=1,nt.setAttribute("fill",it[tt].mode==="s"?"#000000":"#ffffff"),nt.setAttribute("clip-rule","nonzero");var yt;if(it[tt].x.k!==0?(gt="mask",mt="mask",pt=PropertyFactory.getProp(this.element,it[tt].x,0,null,this.element),yt=createElementID(),ft=createNS("filter"),ft.setAttribute("id",yt),dt=createNS("feMorphology"),dt.setAttribute("operator","erode"),dt.setAttribute("in","SourceGraphic"),dt.setAttribute("radius","0"),ft.appendChild(dt),et.appendChild(ft),nt.setAttribute("stroke",it[tt].mode==="s"?"#000000":"#ffffff")):(dt=null,pt=null),this.storedData[tt]={elem:nt,x:pt,expan:dt,lastPath:"",lastOperator:"",filterId:yt,lastRadius:0},it[tt].mode==="i"){lt=ot.length;var vt=createNS("g");for(at=0;at<lt;at+=1)vt.appendChild(ot[at]);var Et=createNS("mask");Et.setAttribute("mask-type","alpha"),Et.setAttribute("id",ct+"_"+st),Et.appendChild(nt),et.appendChild(Et),vt.setAttribute("mask","url("+getLocationHref()+"#"+ct+"_"+st+")"),ot.length=0,ot.push(vt)}else ot.push(nt);it[tt].inv&&!this.solidPath&&(this.solidPath=this.createLayerSolidPath()),this.viewData[tt]={elem:nt,lastPath:"",op:PropertyFactory.getProp(this.element,it[tt].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,it[tt],3),invRect:ht},this.viewData[tt].prop.k||this.drawPath(it[tt],this.viewData[tt].prop.v,this.viewData[tt])}for(this.maskElement=createNS(gt),rt=ot.length,tt=0;tt<rt;tt+=1)this.maskElement.appendChild(ot[tt]);st>0&&(this.maskElement.setAttribute("id",ct),this.element.maskedElement.setAttribute(mt,"url("+getLocationHref()+"#"+ct+")"),et.appendChild(this.maskElement)),this.viewData.length&&this.element.addRenderableComponent(this)}MaskElement.prototype.getMaskProperty=function(o){return this.viewData[o].prop},MaskElement.prototype.renderFrame=function(o){var s=this.element.finalTransform.mat,a,et=this.masksProperties.length;for(a=0;a<et;a+=1)if((this.viewData[a].prop._mdf||o)&&this.drawPath(this.masksProperties[a],this.viewData[a].prop.v,this.viewData[a]),(this.viewData[a].op._mdf||o)&&this.viewData[a].elem.setAttribute("fill-opacity",this.viewData[a].op.v),this.masksProperties[a].mode!=="n"&&(this.viewData[a].invRect&&(this.element.finalTransform.mProp._mdf||o)&&this.viewData[a].invRect.setAttribute("transform",s.getInverseMatrix().to2dCSS()),this.storedData[a].x&&(this.storedData[a].x._mdf||o))){var tt=this.storedData[a].expan;this.storedData[a].x.v<0?(this.storedData[a].lastOperator!=="erode"&&(this.storedData[a].lastOperator="erode",this.storedData[a].elem.setAttribute("filter","url("+getLocationHref()+"#"+this.storedData[a].filterId+")")),tt.setAttribute("radius",-this.storedData[a].x.v)):(this.storedData[a].lastOperator!=="dilate"&&(this.storedData[a].lastOperator="dilate",this.storedData[a].elem.setAttribute("filter",null)),this.storedData[a].elem.setAttribute("stroke-width",this.storedData[a].x.v*2))}},MaskElement.prototype.getMaskelement=function(){return this.maskElement},MaskElement.prototype.createLayerSolidPath=function(){var o="M0,0 ";return o+=" h"+this.globalData.compSize.w,o+=" v"+this.globalData.compSize.h,o+=" h-"+this.globalData.compSize.w,o+=" v-"+this.globalData.compSize.h+" ",o},MaskElement.prototype.drawPath=function(o,s,a){var et=" M"+s.v[0][0]+","+s.v[0][1],tt,rt;for(rt=s._length,tt=1;tt<rt;tt+=1)et+=" C"+s.o[tt-1][0]+","+s.o[tt-1][1]+" "+s.i[tt][0]+","+s.i[tt][1]+" "+s.v[tt][0]+","+s.v[tt][1];if(s.c&&rt>1&&(et+=" C"+s.o[tt-1][0]+","+s.o[tt-1][1]+" "+s.i[0][0]+","+s.i[0][1]+" "+s.v[0][0]+","+s.v[0][1]),a.lastPath!==et){var nt="";a.elem&&(s.c&&(nt=o.inv?this.solidPath+et:et),a.elem.setAttribute("d",nt)),a.lastPath=et}},MaskElement.prototype.destroy=function(){this.element=null,this.globalData=null,this.maskElement=null,this.data=null,this.masksProperties=null};var filtersFactory=function(){var o={};o.createFilter=s,o.createAlphaToLuminanceFilter=a;function s(et,tt){var rt=createNS("filter");return rt.setAttribute("id",et),tt!==!0&&(rt.setAttribute("filterUnits","objectBoundingBox"),rt.setAttribute("x","0%"),rt.setAttribute("y","0%"),rt.setAttribute("width","100%"),rt.setAttribute("height","100%")),rt}function a(){var et=createNS("feColorMatrix");return et.setAttribute("type","matrix"),et.setAttribute("color-interpolation-filters","sRGB"),et.setAttribute("values","0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 1"),et}return o}(),featureSupport=function(){var o={maskType:!0,svgLumaHidden:!0,offscreenCanvas:typeof OffscreenCanvas<"u"};return(/MSIE 10/i.test(navigator.userAgent)||/MSIE 9/i.test(navigator.userAgent)||/rv:11.0/i.test(navigator.userAgent)||/Edge\/\d./i.test(navigator.userAgent))&&(o.maskType=!1),/firefox/i.test(navigator.userAgent)&&(o.svgLumaHidden=!1),o}(),registeredEffects$1={},idPrefix="filter_result_";function SVGEffects(o){var s,a="SourceGraphic",et=o.data.ef?o.data.ef.length:0,tt=createElementID(),rt=filtersFactory.createFilter(tt,!0),nt=0;this.filters=[];var it;for(s=0;s<et;s+=1){it=null;var st=o.data.ef[s].ty;if(registeredEffects$1[st]){var ot=registeredEffects$1[st].effect;it=new ot(rt,o.effectsManager.effectElements[s],o,idPrefix+nt,a),a=idPrefix+nt,registeredEffects$1[st].countsAsEffect&&(nt+=1)}it&&this.filters.push(it)}nt&&(o.globalData.defs.appendChild(rt),o.layerElement.setAttribute("filter","url("+getLocationHref()+"#"+tt+")")),this.filters.length&&o.addRenderableComponent(this)}SVGEffects.prototype.renderFrame=function(o){var s,a=this.filters.length;for(s=0;s<a;s+=1)this.filters[s].renderFrame(o)},SVGEffects.prototype.getEffects=function(o){var s,a=this.filters.length,et=[];for(s=0;s<a;s+=1)this.filters[s].type===o&&et.push(this.filters[s]);return et};function registerEffect$1(o,s,a){registeredEffects$1[o]={effect:s,countsAsEffect:a}}function SVGBaseElement(){}SVGBaseElement.prototype={initRendererElement:function(){this.layerElement=createNS("g")},createContainerElements:function(){this.matteElement=createNS("g"),this.transformedElement=this.layerElement,this.maskedElement=this.layerElement,this._sizeChanged=!1;var s=null;if(this.data.td){this.matteMasks={};var a=createNS("g");a.setAttribute("id",this.layerId),a.appendChild(this.layerElement),s=a,this.globalData.defs.appendChild(a)}else this.data.tt?(this.matteElement.appendChild(this.layerElement),s=this.matteElement,this.baseElement=this.matteElement):this.baseElement=this.layerElement;if(this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),this.data.ty===0&&!this.data.hd){var et=createNS("clipPath"),tt=createNS("path");tt.setAttribute("d","M0,0 L"+this.data.w+",0 L"+this.data.w+","+this.data.h+" L0,"+this.data.h+"z");var rt=createElementID();if(et.setAttribute("id",rt),et.appendChild(tt),this.globalData.defs.appendChild(et),this.checkMasks()){var nt=createNS("g");nt.setAttribute("clip-path","url("+getLocationHref()+"#"+rt+")"),nt.appendChild(this.layerElement),this.transformedElement=nt,s?s.appendChild(this.transformedElement):this.baseElement=this.transformedElement}else this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+rt+")")}this.data.bm!==0&&this.setBlendMode()},renderElement:function(){this.finalTransform._localMatMdf&&this.transformedElement.setAttribute("transform",this.finalTransform.localMat.to2dCSS()),this.finalTransform._opMdf&&this.transformedElement.setAttribute("opacity",this.finalTransform.localOpacity)},destroyBaseElement:function(){this.layerElement=null,this.matteElement=null,this.maskManager.destroy()},getBaseElement:function(){return this.data.hd?null:this.baseElement},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData),this.renderableEffectsManager=new SVGEffects(this),this.searchEffectTransforms()},getMatte:function(s){if(this.matteMasks||(this.matteMasks={}),!this.matteMasks[s]){var a=this.layerId+"_"+s,et,tt,rt,nt;if(s===1||s===3){var it=createNS("mask");it.setAttribute("id",a),it.setAttribute("mask-type",s===3?"luminance":"alpha"),rt=createNS("use"),rt.setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),it.appendChild(rt),this.globalData.defs.appendChild(it),!featureSupport.maskType&&s===1&&(it.setAttribute("mask-type","luminance"),et=createElementID(),tt=filtersFactory.createFilter(et),this.globalData.defs.appendChild(tt),tt.appendChild(filtersFactory.createAlphaToLuminanceFilter()),nt=createNS("g"),nt.appendChild(rt),it.appendChild(nt),nt.setAttribute("filter","url("+getLocationHref()+"#"+et+")"))}else if(s===2){var st=createNS("mask");st.setAttribute("id",a),st.setAttribute("mask-type","alpha");var ot=createNS("g");st.appendChild(ot),et=createElementID(),tt=filtersFactory.createFilter(et);var at=createNS("feComponentTransfer");at.setAttribute("in","SourceGraphic"),tt.appendChild(at);var lt=createNS("feFuncA");lt.setAttribute("type","table"),lt.setAttribute("tableValues","1.0 0.0"),at.appendChild(lt),this.globalData.defs.appendChild(tt);var ct=createNS("rect");ct.setAttribute("width",this.comp.data.w),ct.setAttribute("height",this.comp.data.h),ct.setAttribute("x","0"),ct.setAttribute("y","0"),ct.setAttribute("fill","#ffffff"),ct.setAttribute("opacity","0"),ot.setAttribute("filter","url("+getLocationHref()+"#"+et+")"),ot.appendChild(ct),rt=createNS("use"),rt.setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),ot.appendChild(rt),featureSupport.maskType||(st.setAttribute("mask-type","luminance"),tt.appendChild(filtersFactory.createAlphaToLuminanceFilter()),nt=createNS("g"),ot.appendChild(ct),nt.appendChild(this.layerElement),ot.appendChild(nt)),this.globalData.defs.appendChild(st)}this.matteMasks[s]=a}return this.matteMasks[s]},setMatte:function(s){this.matteElement&&this.matteElement.setAttribute("mask","url("+getLocationHref()+"#"+s+")")}};function HierarchyElement(){}HierarchyElement.prototype={initHierarchy:function(){this.hierarchy=[],this._isParent=!1,this.checkParenting()},setHierarchy:function(s){this.hierarchy=s},setAsParent:function(){this._isParent=!0},checkParenting:function(){this.data.parent!==void 0&&this.comp.buildElementParenting(this,this.data.parent,[])}};function RenderableDOMElement(){}(function(){var o={initElement:function(a,et,tt){this.initFrame(),this.initBaseData(a,et,tt),this.initTransform(a,et,tt),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide()},hide:function(){if(!this.hidden&&(!this.isInRange||this.isTransparent)){var a=this.baseElement||this.layerElement;a.style.display="none",this.hidden=!0}},show:function(){if(this.isInRange&&!this.isTransparent){if(!this.data.hd){var a=this.baseElement||this.layerElement;a.style.display="block"}this.hidden=!1,this._isFirstFrame=!0}},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},renderInnerContent:function(){},prepareFrame:function(a){this._mdf=!1,this.prepareRenderableFrame(a),this.prepareProperties(a,this.isInRange),this.checkTransparency()},destroy:function(){this.innerElem=null,this.destroyBaseElement()}};extendPrototype([RenderableElement,createProxyFunction(o)],RenderableDOMElement)})();function IImageElement(o,s,a){this.assetData=s.getAssetData(o.refId),this.assetData&&this.assetData.sid&&(this.assetData=s.slotManager.getProp(this.assetData)),this.initElement(o,s,a),this.sourceRect={top:0,left:0,width:this.assetData.w,height:this.assetData.h}}extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],IImageElement),IImageElement.prototype.createContent=function(){var o=this.globalData.getAssetsPath(this.assetData);this.innerElem=createNS("image"),this.innerElem.setAttribute("width",this.assetData.w+"px"),this.innerElem.setAttribute("height",this.assetData.h+"px"),this.innerElem.setAttribute("preserveAspectRatio",this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio),this.innerElem.setAttributeNS("http://www.w3.org/1999/xlink","href",o),this.layerElement.appendChild(this.innerElem)},IImageElement.prototype.sourceRectAtTime=function(){return this.sourceRect};function ProcessedElement(o,s){this.elem=o,this.pos=s}function IShapeElement(){}IShapeElement.prototype={addShapeToModifiers:function(s){var a,et=this.shapeModifiers.length;for(a=0;a<et;a+=1)this.shapeModifiers[a].addShape(s)},isShapeInAnimatedModifiers:function(s){for(var a=0,et=this.shapeModifiers.length;a<et;)if(this.shapeModifiers[a].isAnimatedWithShape(s))return!0;return!1},renderModifiers:function(){if(this.shapeModifiers.length){var s,a=this.shapes.length;for(s=0;s<a;s+=1)this.shapes[s].sh.reset();a=this.shapeModifiers.length;var et;for(s=a-1;s>=0&&(et=this.shapeModifiers[s].processShapes(this._isFirstFrame),!et);s-=1);}},searchProcessedElement:function(s){for(var a=this.processedElements,et=0,tt=a.length;et<tt;){if(a[et].elem===s)return a[et].pos;et+=1}return 0},addProcessedElement:function(s,a){for(var et=this.processedElements,tt=et.length;tt;)if(tt-=1,et[tt].elem===s){et[tt].pos=a;return}et.push(new ProcessedElement(s,a))},prepareFrame:function(s){this.prepareRenderableFrame(s),this.prepareProperties(s,this.isInRange)}};var lineCapEnum={1:"butt",2:"round",3:"square"},lineJoinEnum={1:"miter",2:"round",3:"bevel"};function SVGShapeData(o,s,a){this.caches=[],this.styles=[],this.transformers=o,this.lStr="",this.sh=a,this.lvl=s,this._isAnimated=!!a.k;for(var et=0,tt=o.length;et<tt;){if(o[et].mProps.dynamicProperties.length){this._isAnimated=!0;break}et+=1}}SVGShapeData.prototype.setAsAnimated=function(){this._isAnimated=!0};function SVGStyleData(o,s){this.data=o,this.type=o.ty,this.d="",this.lvl=s,this._mdf=!1,this.closed=o.hd===!0,this.pElem=createNS("path"),this.msElem=null}SVGStyleData.prototype.reset=function(){this.d="",this._mdf=!1};function DashProperty(o,s,a,et){this.elem=o,this.frameId=-1,this.dataProps=createSizedArray(s.length),this.renderer=a,this.k=!1,this.dashStr="",this.dashArray=createTypedArray("float32",s.length?s.length-1:0),this.dashoffset=createTypedArray("float32",1),this.initDynamicPropertyContainer(et);var tt,rt=s.length||0,nt;for(tt=0;tt<rt;tt+=1)nt=PropertyFactory.getProp(o,s[tt].v,0,0,this),this.k=nt.k||this.k,this.dataProps[tt]={n:s[tt].n,p:nt};this.k||this.getValue(!0),this._isAnimated=this.k}DashProperty.prototype.getValue=function(o){if(!(this.elem.globalData.frameId===this.frameId&&!o)&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf=this._mdf||o,this._mdf)){var s=0,a=this.dataProps.length;for(this.renderer==="svg"&&(this.dashStr=""),s=0;s<a;s+=1)this.dataProps[s].n!=="o"?this.renderer==="svg"?this.dashStr+=" "+this.dataProps[s].p.v:this.dashArray[s]=this.dataProps[s].p.v:this.dashoffset[0]=this.dataProps[s].p.v}},extendPrototype([DynamicPropertyContainer],DashProperty);function SVGStrokeStyleData(o,s,a){this.initDynamicPropertyContainer(o),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(o,s.o,0,.01,this),this.w=PropertyFactory.getProp(o,s.w,0,null,this),this.d=new DashProperty(o,s.d||{},"svg",this),this.c=PropertyFactory.getProp(o,s.c,1,255,this),this.style=a,this._isAnimated=!!this._isAnimated}extendPrototype([DynamicPropertyContainer],SVGStrokeStyleData);function SVGFillStyleData(o,s,a){this.initDynamicPropertyContainer(o),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(o,s.o,0,.01,this),this.c=PropertyFactory.getProp(o,s.c,1,255,this),this.style=a}extendPrototype([DynamicPropertyContainer],SVGFillStyleData);function SVGNoStyleData(o,s,a){this.initDynamicPropertyContainer(o),this.getValue=this.iterateDynamicProperties,this.style=a}extendPrototype([DynamicPropertyContainer],SVGNoStyleData);function GradientProperty(o,s,a){this.data=s,this.c=createTypedArray("uint8c",s.p*4);var et=s.k.k[0].s?s.k.k[0].s.length-s.p*4:s.k.k.length-s.p*4;this.o=createTypedArray("float32",et),this._cmdf=!1,this._omdf=!1,this._collapsable=this.checkCollapsable(),this._hasOpacity=et,this.initDynamicPropertyContainer(a),this.prop=PropertyFactory.getProp(o,s.k,1,null,this),this.k=this.prop.k,this.getValue(!0)}GradientProperty.prototype.comparePoints=function(o,s){for(var a=0,et=this.o.length/2,tt;a<et;){if(tt=Math.abs(o[a*4]-o[s*4+a*2]),tt>.01)return!1;a+=1}return!0},GradientProperty.prototype.checkCollapsable=function(){if(this.o.length/2!==this.c.length/4)return!1;if(this.data.k.k[0].s)for(var o=0,s=this.data.k.k.length;o<s;){if(!this.comparePoints(this.data.k.k[o].s,this.data.p))return!1;o+=1}else if(!this.comparePoints(this.data.k.k,this.data.p))return!1;return!0},GradientProperty.prototype.getValue=function(o){if(this.prop.getValue(),this._mdf=!1,this._cmdf=!1,this._omdf=!1,this.prop._mdf||o){var s,a=this.data.p*4,et,tt;for(s=0;s<a;s+=1)et=s%4===0?100:255,tt=Math.round(this.prop.v[s]*et),this.c[s]!==tt&&(this.c[s]=tt,this._cmdf=!o);if(this.o.length)for(a=this.prop.v.length,s=this.data.p*4;s<a;s+=1)et=s%2===0?100:1,tt=s%2===0?Math.round(this.prop.v[s]*100):this.prop.v[s],this.o[s-this.data.p*4]!==tt&&(this.o[s-this.data.p*4]=tt,this._omdf=!o);this._mdf=!o}},extendPrototype([DynamicPropertyContainer],GradientProperty);function SVGGradientFillStyleData(o,s,a){this.initDynamicPropertyContainer(o),this.getValue=this.iterateDynamicProperties,this.initGradientData(o,s,a)}SVGGradientFillStyleData.prototype.initGradientData=function(o,s,a){this.o=PropertyFactory.getProp(o,s.o,0,.01,this),this.s=PropertyFactory.getProp(o,s.s,1,null,this),this.e=PropertyFactory.getProp(o,s.e,1,null,this),this.h=PropertyFactory.getProp(o,s.h||{k:0},0,.01,this),this.a=PropertyFactory.getProp(o,s.a||{k:0},0,degToRads,this),this.g=new GradientProperty(o,s.g,this),this.style=a,this.stops=[],this.setGradientData(a.pElem,s),this.setGradientOpacity(s,a),this._isAnimated=!!this._isAnimated},SVGGradientFillStyleData.prototype.setGradientData=function(o,s){var a=createElementID(),et=createNS(s.t===1?"linearGradient":"radialGradient");et.setAttribute("id",a),et.setAttribute("spreadMethod","pad"),et.setAttribute("gradientUnits","userSpaceOnUse");var tt=[],rt,nt,it;for(it=s.g.p*4,nt=0;nt<it;nt+=4)rt=createNS("stop"),et.appendChild(rt),tt.push(rt);o.setAttribute(s.ty==="gf"?"fill":"stroke","url("+getLocationHref()+"#"+a+")"),this.gf=et,this.cst=tt},SVGGradientFillStyleData.prototype.setGradientOpacity=function(o,s){if(this.g._hasOpacity&&!this.g._collapsable){var a,et,tt,rt=createNS("mask"),nt=createNS("path");rt.appendChild(nt);var it=createElementID(),st=createElementID();rt.setAttribute("id",st);var ot=createNS(o.t===1?"linearGradient":"radialGradient");ot.setAttribute("id",it),ot.setAttribute("spreadMethod","pad"),ot.setAttribute("gradientUnits","userSpaceOnUse"),tt=o.g.k.k[0].s?o.g.k.k[0].s.length:o.g.k.k.length;var at=this.stops;for(et=o.g.p*4;et<tt;et+=2)a=createNS("stop"),a.setAttribute("stop-color","rgb(255,255,255)"),ot.appendChild(a),at.push(a);nt.setAttribute(o.ty==="gf"?"fill":"stroke","url("+getLocationHref()+"#"+it+")"),o.ty==="gs"&&(nt.setAttribute("stroke-linecap",lineCapEnum[o.lc||2]),nt.setAttribute("stroke-linejoin",lineJoinEnum[o.lj||2]),o.lj===1&&nt.setAttribute("stroke-miterlimit",o.ml)),this.of=ot,this.ms=rt,this.ost=at,this.maskId=st,s.msElem=nt}},extendPrototype([DynamicPropertyContainer],SVGGradientFillStyleData);function SVGGradientStrokeStyleData(o,s,a){this.initDynamicPropertyContainer(o),this.getValue=this.iterateDynamicProperties,this.w=PropertyFactory.getProp(o,s.w,0,null,this),this.d=new DashProperty(o,s.d||{},"svg",this),this.initGradientData(o,s,a),this._isAnimated=!!this._isAnimated}extendPrototype([SVGGradientFillStyleData,DynamicPropertyContainer],SVGGradientStrokeStyleData);function ShapeGroupData(){this.it=[],this.prevViewData=[],this.gr=createNS("g")}function SVGTransformData(o,s,a){this.transform={mProps:o,op:s,container:a},this.elements=[],this._isAnimated=this.transform.mProps.dynamicProperties.length||this.transform.op.effectsSequence.length}var buildShapeString=function(s,a,et,tt){if(a===0)return"";var rt=s.o,nt=s.i,it=s.v,st,ot=" M"+tt.applyToPointStringified(it[0][0],it[0][1]);for(st=1;st<a;st+=1)ot+=" C"+tt.applyToPointStringified(rt[st-1][0],rt[st-1][1])+" "+tt.applyToPointStringified(nt[st][0],nt[st][1])+" "+tt.applyToPointStringified(it[st][0],it[st][1]);return et&&a&&(ot+=" C"+tt.applyToPointStringified(rt[st-1][0],rt[st-1][1])+" "+tt.applyToPointStringified(nt[0][0],nt[0][1])+" "+tt.applyToPointStringified(it[0][0],it[0][1]),ot+="z"),ot},SVGElementsRenderer=function(){var o=new Matrix,s=new Matrix,a={createRenderFunction:et};function et(lt){switch(lt.ty){case"fl":return it;case"gf":return ot;case"gs":return st;case"st":return at;case"sh":case"el":case"rc":case"sr":return nt;case"tr":return tt;case"no":return rt;default:return null}}function tt(lt,ct,ht){(ht||ct.transform.op._mdf)&&ct.transform.container.setAttribute("opacity",ct.transform.op.v),(ht||ct.transform.mProps._mdf)&&ct.transform.container.setAttribute("transform",ct.transform.mProps.v.to2dCSS())}function rt(){}function nt(lt,ct,ht){var ft,dt,pt,gt,mt,yt,vt=ct.styles.length,Et=ct.lvl,xt,wt,Rt,Ct;for(yt=0;yt<vt;yt+=1){if(gt=ct.sh._mdf||ht,ct.styles[yt].lvl<Et){for(wt=s.reset(),Rt=Et-ct.styles[yt].lvl,Ct=ct.transformers.length-1;!gt&&Rt>0;)gt=ct.transformers[Ct].mProps._mdf||gt,Rt-=1,Ct-=1;if(gt)for(Rt=Et-ct.styles[yt].lvl,Ct=ct.transformers.length-1;Rt>0;)wt.multiply(ct.transformers[Ct].mProps.v),Rt-=1,Ct-=1}else wt=o;if(xt=ct.sh.paths,dt=xt._length,gt){for(pt="",ft=0;ft<dt;ft+=1)mt=xt.shapes[ft],mt&&mt._length&&(pt+=buildShapeString(mt,mt._length,mt.c,wt));ct.caches[yt]=pt}else pt=ct.caches[yt];ct.styles[yt].d+=lt.hd===!0?"":pt,ct.styles[yt]._mdf=gt||ct.styles[yt]._mdf}}function it(lt,ct,ht){var ft=ct.style;(ct.c._mdf||ht)&&ft.pElem.setAttribute("fill","rgb("+bmFloor(ct.c.v[0])+","+bmFloor(ct.c.v[1])+","+bmFloor(ct.c.v[2])+")"),(ct.o._mdf||ht)&&ft.pElem.setAttribute("fill-opacity",ct.o.v)}function st(lt,ct,ht){ot(lt,ct,ht),at(lt,ct,ht)}function ot(lt,ct,ht){var ft=ct.gf,dt=ct.g._hasOpacity,pt=ct.s.v,gt=ct.e.v;if(ct.o._mdf||ht){var mt=lt.ty==="gf"?"fill-opacity":"stroke-opacity";ct.style.pElem.setAttribute(mt,ct.o.v)}if(ct.s._mdf||ht){var yt=lt.t===1?"x1":"cx",vt=yt==="x1"?"y1":"cy";ft.setAttribute(yt,pt[0]),ft.setAttribute(vt,pt[1]),dt&&!ct.g._collapsable&&(ct.of.setAttribute(yt,pt[0]),ct.of.setAttribute(vt,pt[1]))}var Et,xt,wt,Rt;if(ct.g._cmdf||ht){Et=ct.cst;var Ct=ct.g.c;for(wt=Et.length,xt=0;xt<wt;xt+=1)Rt=Et[xt],Rt.setAttribute("offset",Ct[xt*4]+"%"),Rt.setAttribute("stop-color","rgb("+Ct[xt*4+1]+","+Ct[xt*4+2]+","+Ct[xt*4+3]+")")}if(dt&&(ct.g._omdf||ht)){var Ft=ct.g.o;for(ct.g._collapsable?Et=ct.cst:Et=ct.ost,wt=Et.length,xt=0;xt<wt;xt+=1)Rt=Et[xt],ct.g._collapsable||Rt.setAttribute("offset",Ft[xt*2]+"%"),Rt.setAttribute("stop-opacity",Ft[xt*2+1])}if(lt.t===1)(ct.e._mdf||ht)&&(ft.setAttribute("x2",gt[0]),ft.setAttribute("y2",gt[1]),dt&&!ct.g._collapsable&&(ct.of.setAttribute("x2",gt[0]),ct.of.setAttribute("y2",gt[1])));else{var zt;if((ct.s._mdf||ct.e._mdf||ht)&&(zt=Math.sqrt(Math.pow(pt[0]-gt[0],2)+Math.pow(pt[1]-gt[1],2)),ft.setAttribute("r",zt),dt&&!ct.g._collapsable&&ct.of.setAttribute("r",zt)),ct.e._mdf||ct.h._mdf||ct.a._mdf||ht){zt||(zt=Math.sqrt(Math.pow(pt[0]-gt[0],2)+Math.pow(pt[1]-gt[1],2)));var Nt=Math.atan2(gt[1]-pt[1],gt[0]-pt[0]),Kt=ct.h.v;Kt>=1?Kt=.99:Kt<=-1&&(Kt=-.99);var Yt=zt*Kt,Bt=Math.cos(Nt+ct.a.v)*Yt+pt[0],Pt=Math.sin(Nt+ct.a.v)*Yt+pt[1];ft.setAttribute("fx",Bt),ft.setAttribute("fy",Pt),dt&&!ct.g._collapsable&&(ct.of.setAttribute("fx",Bt),ct.of.setAttribute("fy",Pt))}}}function at(lt,ct,ht){var ft=ct.style,dt=ct.d;dt&&(dt._mdf||ht)&&dt.dashStr&&(ft.pElem.setAttribute("stroke-dasharray",dt.dashStr),ft.pElem.setAttribute("stroke-dashoffset",dt.dashoffset[0])),ct.c&&(ct.c._mdf||ht)&&ft.pElem.setAttribute("stroke","rgb("+bmFloor(ct.c.v[0])+","+bmFloor(ct.c.v[1])+","+bmFloor(ct.c.v[2])+")"),(ct.o._mdf||ht)&&ft.pElem.setAttribute("stroke-opacity",ct.o.v),(ct.w._mdf||ht)&&(ft.pElem.setAttribute("stroke-width",ct.w.v),ft.msElem&&ft.msElem.setAttribute("stroke-width",ct.w.v))}return a}();function SVGShapeElement(o,s,a){this.shapes=[],this.shapesData=o.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.initElement(o,s,a),this.prevViewData=[]}extendPrototype([BaseElement,TransformElement,SVGBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableDOMElement],SVGShapeElement),SVGShapeElement.prototype.initSecondaryElement=function(){},SVGShapeElement.prototype.identityMatrix=new Matrix,SVGShapeElement.prototype.buildExpressionInterface=function(){},SVGShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes()},SVGShapeElement.prototype.filterUniqueShapes=function(){var o,s=this.shapes.length,a,et,tt=this.stylesList.length,rt,nt=[],it=!1;for(et=0;et<tt;et+=1){for(rt=this.stylesList[et],it=!1,nt.length=0,o=0;o<s;o+=1)a=this.shapes[o],a.styles.indexOf(rt)!==-1&&(nt.push(a),it=a._isAnimated||it);nt.length>1&&it&&this.setShapesAsAnimated(nt)}},SVGShapeElement.prototype.setShapesAsAnimated=function(o){var s,a=o.length;for(s=0;s<a;s+=1)o[s].setAsAnimated()},SVGShapeElement.prototype.createStyleElement=function(o,s){var a,et=new SVGStyleData(o,s),tt=et.pElem;if(o.ty==="st")a=new SVGStrokeStyleData(this,o,et);else if(o.ty==="fl")a=new SVGFillStyleData(this,o,et);else if(o.ty==="gf"||o.ty==="gs"){var rt=o.ty==="gf"?SVGGradientFillStyleData:SVGGradientStrokeStyleData;a=new rt(this,o,et),this.globalData.defs.appendChild(a.gf),a.maskId&&(this.globalData.defs.appendChild(a.ms),this.globalData.defs.appendChild(a.of),tt.setAttribute("mask","url("+getLocationHref()+"#"+a.maskId+")"))}else o.ty==="no"&&(a=new SVGNoStyleData(this,o,et));return(o.ty==="st"||o.ty==="gs")&&(tt.setAttribute("stroke-linecap",lineCapEnum[o.lc||2]),tt.setAttribute("stroke-linejoin",lineJoinEnum[o.lj||2]),tt.setAttribute("fill-opacity","0"),o.lj===1&&tt.setAttribute("stroke-miterlimit",o.ml)),o.r===2&&tt.setAttribute("fill-rule","evenodd"),o.ln&&tt.setAttribute("id",o.ln),o.cl&&tt.setAttribute("class",o.cl),o.bm&&(tt.style["mix-blend-mode"]=getBlendMode(o.bm)),this.stylesList.push(et),this.addToAnimatedContents(o,a),a},SVGShapeElement.prototype.createGroupElement=function(o){var s=new ShapeGroupData;return o.ln&&s.gr.setAttribute("id",o.ln),o.cl&&s.gr.setAttribute("class",o.cl),o.bm&&(s.gr.style["mix-blend-mode"]=getBlendMode(o.bm)),s},SVGShapeElement.prototype.createTransformElement=function(o,s){var a=TransformPropertyFactory.getTransformProperty(this,o,this),et=new SVGTransformData(a,a.o,s);return this.addToAnimatedContents(o,et),et},SVGShapeElement.prototype.createShapeElement=function(o,s,a){var et=4;o.ty==="rc"?et=5:o.ty==="el"?et=6:o.ty==="sr"&&(et=7);var tt=ShapePropertyFactory.getShapeProp(this,o,et,this),rt=new SVGShapeData(s,a,tt);return this.shapes.push(rt),this.addShapeToModifiers(rt),this.addToAnimatedContents(o,rt),rt},SVGShapeElement.prototype.addToAnimatedContents=function(o,s){for(var a=0,et=this.animatedContents.length;a<et;){if(this.animatedContents[a].element===s)return;a+=1}this.animatedContents.push({fn:SVGElementsRenderer.createRenderFunction(o),element:s,data:o})},SVGShapeElement.prototype.setElementStyles=function(o){var s=o.styles,a,et=this.stylesList.length;for(a=0;a<et;a+=1)this.stylesList[a].closed||s.push(this.stylesList[a])},SVGShapeElement.prototype.reloadShapes=function(){this._isFirstFrame=!0;var o,s=this.itemsData.length;for(o=0;o<s;o+=1)this.prevViewData[o]=this.itemsData[o];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes(),s=this.dynamicProperties.length,o=0;o<s;o+=1)this.dynamicProperties[o].getValue();this.renderModifiers()},SVGShapeElement.prototype.searchShapes=function(o,s,a,et,tt,rt,nt){var it=[].concat(rt),st,ot=o.length-1,at,lt,ct=[],ht=[],ft,dt,pt;for(st=ot;st>=0;st-=1){if(pt=this.searchProcessedElement(o[st]),pt?s[st]=a[pt-1]:o[st]._render=nt,o[st].ty==="fl"||o[st].ty==="st"||o[st].ty==="gf"||o[st].ty==="gs"||o[st].ty==="no")pt?s[st].style.closed=!1:s[st]=this.createStyleElement(o[st],tt),o[st]._render&&s[st].style.pElem.parentNode!==et&&et.appendChild(s[st].style.pElem),ct.push(s[st].style);else if(o[st].ty==="gr"){if(!pt)s[st]=this.createGroupElement(o[st]);else for(lt=s[st].it.length,at=0;at<lt;at+=1)s[st].prevViewData[at]=s[st].it[at];this.searchShapes(o[st].it,s[st].it,s[st].prevViewData,s[st].gr,tt+1,it,nt),o[st]._render&&s[st].gr.parentNode!==et&&et.appendChild(s[st].gr)}else o[st].ty==="tr"?(pt||(s[st]=this.createTransformElement(o[st],et)),ft=s[st].transform,it.push(ft)):o[st].ty==="sh"||o[st].ty==="rc"||o[st].ty==="el"||o[st].ty==="sr"?(pt||(s[st]=this.createShapeElement(o[st],it,tt)),this.setElementStyles(s[st])):o[st].ty==="tm"||o[st].ty==="rd"||o[st].ty==="ms"||o[st].ty==="pb"||o[st].ty==="zz"||o[st].ty==="op"?(pt?(dt=s[st],dt.closed=!1):(dt=ShapeModifiers.getModifier(o[st].ty),dt.init(this,o[st]),s[st]=dt,this.shapeModifiers.push(dt)),ht.push(dt)):o[st].ty==="rp"&&(pt?(dt=s[st],dt.closed=!0):(dt=ShapeModifiers.getModifier(o[st].ty),s[st]=dt,dt.init(this,o,st,s),this.shapeModifiers.push(dt),nt=!1),ht.push(dt));this.addProcessedElement(o[st],st+1)}for(ot=ct.length,st=0;st<ot;st+=1)ct[st].closed=!0;for(ot=ht.length,st=0;st<ot;st+=1)ht[st].closed=!0},SVGShapeElement.prototype.renderInnerContent=function(){this.renderModifiers();var o,s=this.stylesList.length;for(o=0;o<s;o+=1)this.stylesList[o].reset();for(this.renderShape(),o=0;o<s;o+=1)(this.stylesList[o]._mdf||this._isFirstFrame)&&(this.stylesList[o].msElem&&(this.stylesList[o].msElem.setAttribute("d",this.stylesList[o].d),this.stylesList[o].d="M0 0"+this.stylesList[o].d),this.stylesList[o].pElem.setAttribute("d",this.stylesList[o].d||"M0 0"))},SVGShapeElement.prototype.renderShape=function(){var o,s=this.animatedContents.length,a;for(o=0;o<s;o+=1)a=this.animatedContents[o],(this._isFirstFrame||a.element._isAnimated)&&a.data!==!0&&a.fn(a.data,a.element,this._isFirstFrame)},SVGShapeElement.prototype.destroy=function(){this.destroyBaseElement(),this.shapesData=null,this.itemsData=null};function LetterProps(o,s,a,et,tt,rt){this.o=o,this.sw=s,this.sc=a,this.fc=et,this.m=tt,this.p=rt,this._mdf={o:!0,sw:!!s,sc:!!a,fc:!!et,m:!0,p:!0}}LetterProps.prototype.update=function(o,s,a,et,tt,rt){this._mdf.o=!1,this._mdf.sw=!1,this._mdf.sc=!1,this._mdf.fc=!1,this._mdf.m=!1,this._mdf.p=!1;var nt=!1;return this.o!==o&&(this.o=o,this._mdf.o=!0,nt=!0),this.sw!==s&&(this.sw=s,this._mdf.sw=!0,nt=!0),this.sc!==a&&(this.sc=a,this._mdf.sc=!0,nt=!0),this.fc!==et&&(this.fc=et,this._mdf.fc=!0,nt=!0),this.m!==tt&&(this.m=tt,this._mdf.m=!0,nt=!0),rt.length&&(this.p[0]!==rt[0]||this.p[1]!==rt[1]||this.p[4]!==rt[4]||this.p[5]!==rt[5]||this.p[12]!==rt[12]||this.p[13]!==rt[13])&&(this.p=rt,this._mdf.p=!0,nt=!0),nt};function TextProperty(o,s){this._frameId=initialDefaultFrame,this.pv="",this.v="",this.kf=!1,this._isFirstFrame=!0,this._mdf=!1,s.d&&s.d.sid&&(s.d=o.globalData.slotManager.getProp(s.d)),this.data=s,this.elem=o,this.comp=this.elem.comp,this.keysIndex=0,this.canResize=!1,this.minimumFontSize=1,this.effectsSequence=[],this.currentData={ascent:0,boxWidth:this.defaultBoxWidth,f:"",fStyle:"",fWeight:"",fc:"",j:"",justifyOffset:"",l:[],lh:0,lineWidths:[],ls:"",of:"",s:"",sc:"",sw:0,t:0,tr:0,sz:0,ps:null,fillColorAnim:!1,strokeColorAnim:!1,strokeWidthAnim:!1,yOffset:0,finalSize:0,finalText:[],finalLineHeight:0,__complete:!1},this.copyData(this.currentData,this.data.d.k[0].s),this.searchProperty()||this.completeTextData(this.currentData)}TextProperty.prototype.defaultBoxWidth=[0,0],TextProperty.prototype.copyData=function(o,s){for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(o[a]=s[a]);return o},TextProperty.prototype.setCurrentData=function(o){o.__complete||this.completeTextData(o),this.currentData=o,this.currentData.boxWidth=this.currentData.boxWidth||this.defaultBoxWidth,this._mdf=!0},TextProperty.prototype.searchProperty=function(){return this.searchKeyframes()},TextProperty.prototype.searchKeyframes=function(){return this.kf=this.data.d.k.length>1,this.kf&&this.addEffect(this.getKeyframeValue.bind(this)),this.kf},TextProperty.prototype.addEffect=function(o){this.effectsSequence.push(o),this.elem.addDynamicProperty(this)},TextProperty.prototype.getValue=function(o){if(!((this.elem.globalData.frameId===this.frameId||!this.effectsSequence.length)&&!o)){this.currentData.t=this.data.d.k[this.keysIndex].s.t;var s=this.currentData,a=this.keysIndex;if(this.lock){this.setCurrentData(this.currentData);return}this.lock=!0,this._mdf=!1;var et,tt=this.effectsSequence.length,rt=o||this.data.d.k[this.keysIndex].s;for(et=0;et<tt;et+=1)a!==this.keysIndex?rt=this.effectsSequence[et](rt,rt.t):rt=this.effectsSequence[et](this.currentData,rt.t);s!==rt&&this.setCurrentData(rt),this.v=this.currentData,this.pv=this.v,this.lock=!1,this.frameId=this.elem.globalData.frameId}},TextProperty.prototype.getKeyframeValue=function(){for(var o=this.data.d.k,s=this.elem.comp.renderedFrame,a=0,et=o.length;a<=et-1&&!(a===et-1||o[a+1].t>s);)a+=1;return this.keysIndex!==a&&(this.keysIndex=a),this.data.d.k[this.keysIndex].s},TextProperty.prototype.buildFinalText=function(o){for(var s=[],a=0,et=o.length,tt,rt,nt=!1,it=!1,st="";a<et;)nt=it,it=!1,tt=o.charCodeAt(a),st=o.charAt(a),FontManager.isCombinedCharacter(tt)?nt=!0:tt>=55296&&tt<=56319?FontManager.isRegionalFlag(o,a)?st=o.substr(a,14):(rt=o.charCodeAt(a+1),rt>=56320&&rt<=57343&&(FontManager.isModifier(tt,rt)?(st=o.substr(a,2),nt=!0):FontManager.isFlagEmoji(o.substr(a,4))?st=o.substr(a,4):st=o.substr(a,2))):tt>56319?(rt=o.charCodeAt(a+1),FontManager.isVariationSelector(tt)&&(nt=!0)):FontManager.isZeroWidthJoiner(tt)&&(nt=!0,it=!0),nt?(s[s.length-1]+=st,nt=!1):s.push(st),a+=st.length;return s},TextProperty.prototype.completeTextData=function(o){o.__complete=!0;var s=this.elem.globalData.fontManager,a=this.data,et=[],tt,rt,nt,it=0,st,ot=a.m.g,at=0,lt=0,ct=0,ht=[],ft=0,dt=0,pt,gt,mt=s.getFontByName(o.f),yt,vt=0,Et=getFontProperties(mt);o.fWeight=Et.weight,o.fStyle=Et.style,o.finalSize=o.s,o.finalText=this.buildFinalText(o.t),rt=o.finalText.length,o.finalLineHeight=o.lh;var xt=o.tr/1e3*o.finalSize,wt;if(o.sz)for(var Rt=!0,Ct=o.sz[0],Ft=o.sz[1],zt,Nt;Rt;){Nt=this.buildFinalText(o.t),zt=0,ft=0,rt=Nt.length,xt=o.tr/1e3*o.finalSize;var Kt=-1;for(tt=0;tt<rt;tt+=1)wt=Nt[tt].charCodeAt(0),nt=!1,Nt[tt]===" "?Kt=tt:(wt===13||wt===3)&&(ft=0,nt=!0,zt+=o.finalLineHeight||o.finalSize*1.2),s.chars?(yt=s.getCharData(Nt[tt],mt.fStyle,mt.fFamily),vt=nt?0:yt.w*o.finalSize/100):vt=s.measureText(Nt[tt],o.f,o.finalSize),ft+vt>Ct&&Nt[tt]!==" "?(Kt===-1?rt+=1:tt=Kt,zt+=o.finalLineHeight||o.finalSize*1.2,Nt.splice(tt,Kt===tt?1:0,"\r"),Kt=-1,ft=0):(ft+=vt,ft+=xt);zt+=mt.ascent*o.finalSize/100,this.canResize&&o.finalSize>this.minimumFontSize&&Ft<zt?(o.finalSize-=1,o.finalLineHeight=o.finalSize*o.lh/o.s):(o.finalText=Nt,rt=o.finalText.length,Rt=!1)}ft=-xt,vt=0;var Yt=0,Bt;for(tt=0;tt<rt;tt+=1)if(nt=!1,Bt=o.finalText[tt],wt=Bt.charCodeAt(0),wt===13||wt===3?(Yt=0,ht.push(ft),dt=ft>dt?ft:dt,ft=-2*xt,st="",nt=!0,ct+=1):st=Bt,s.chars?(yt=s.getCharData(Bt,mt.fStyle,s.getFontByName(o.f).fFamily),vt=nt?0:yt.w*o.finalSize/100):vt=s.measureText(st,o.f,o.finalSize),Bt===" "?Yt+=vt+xt:(ft+=vt+xt+Yt,Yt=0),et.push({l:vt,an:vt,add:at,n:nt,anIndexes:[],val:st,line:ct,animatorJustifyOffset:0}),ot==2){if(at+=vt,st===""||st===" "||tt===rt-1){for((st===""||st===" ")&&(at-=vt);lt<=tt;)et[lt].an=at,et[lt].ind=it,et[lt].extra=vt,lt+=1;it+=1,at=0}}else if(ot==3){if(at+=vt,st===""||tt===rt-1){for(st===""&&(at-=vt);lt<=tt;)et[lt].an=at,et[lt].ind=it,et[lt].extra=vt,lt+=1;at=0,it+=1}}else et[it].ind=it,et[it].extra=0,it+=1;if(o.l=et,dt=ft>dt?ft:dt,ht.push(ft),o.sz)o.boxWidth=o.sz[0],o.justifyOffset=0;else switch(o.boxWidth=dt,o.j){case 1:o.justifyOffset=-o.boxWidth;break;case 2:o.justifyOffset=-o.boxWidth/2;break;default:o.justifyOffset=0}o.lineWidths=ht;var Pt=a.a,Dt,Tt;gt=Pt.length;var St,Mt,jt=[];for(pt=0;pt<gt;pt+=1){for(Dt=Pt[pt],Dt.a.sc&&(o.strokeColorAnim=!0),Dt.a.sw&&(o.strokeWidthAnim=!0),(Dt.a.fc||Dt.a.fh||Dt.a.fs||Dt.a.fb)&&(o.fillColorAnim=!0),Mt=0,St=Dt.s.b,tt=0;tt<rt;tt+=1)Tt=et[tt],Tt.anIndexes[pt]=Mt,(St==1&&Tt.val!==""||St==2&&Tt.val!==""&&Tt.val!==" "||St==3&&(Tt.n||Tt.val==" "||tt==rt-1)||St==4&&(Tt.n||tt==rt-1))&&(Dt.s.rn===1&&jt.push(Mt),Mt+=1);a.a[pt].s.totalChars=Mt;var Gt=-1,Ht;if(Dt.s.rn===1)for(tt=0;tt<rt;tt+=1)Tt=et[tt],Gt!=Tt.anIndexes[pt]&&(Gt=Tt.anIndexes[pt],Ht=jt.splice(Math.floor(Math.random()*jt.length),1)[0]),Tt.anIndexes[pt]=Ht}o.yOffset=o.finalLineHeight||o.finalSize*1.2,o.ls=o.ls||0,o.ascent=mt.ascent*o.finalSize/100},TextProperty.prototype.updateDocumentData=function(o,s){s=s===void 0?this.keysIndex:s;var a=this.copyData({},this.data.d.k[s].s);a=this.copyData(a,o),this.data.d.k[s].s=a,this.recalculate(s),this.setCurrentData(a),this.elem.addDynamicProperty(this)},TextProperty.prototype.recalculate=function(o){var s=this.data.d.k[o].s;s.__complete=!1,this.keysIndex=0,this._isFirstFrame=!0,this.getValue(s)},TextProperty.prototype.canResizeFont=function(o){this.canResize=o,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)},TextProperty.prototype.setMinimumFontSize=function(o){this.minimumFontSize=Math.floor(o)||1,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)};var TextSelectorProp=function(){var o=Math.max,s=Math.min,a=Math.floor;function et(rt,nt){this._currentTextLength=-1,this.k=!1,this.data=nt,this.elem=rt,this.comp=rt.comp,this.finalS=0,this.finalE=0,this.initDynamicPropertyContainer(rt),this.s=PropertyFactory.getProp(rt,nt.s||{k:0},0,0,this),"e"in nt?this.e=PropertyFactory.getProp(rt,nt.e,0,0,this):this.e={v:100},this.o=PropertyFactory.getProp(rt,nt.o||{k:0},0,0,this),this.xe=PropertyFactory.getProp(rt,nt.xe||{k:0},0,0,this),this.ne=PropertyFactory.getProp(rt,nt.ne||{k:0},0,0,this),this.sm=PropertyFactory.getProp(rt,nt.sm||{k:100},0,0,this),this.a=PropertyFactory.getProp(rt,nt.a,0,.01,this),this.dynamicProperties.length||this.getValue()}et.prototype={getMult:function(nt){this._currentTextLength!==this.elem.textProperty.currentData.l.length&&this.getValue();var it=0,st=0,ot=1,at=1;this.ne.v>0?it=this.ne.v/100:st=-this.ne.v/100,this.xe.v>0?ot=1-this.xe.v/100:at=1+this.xe.v/100;var lt=BezierFactory.getBezierEasing(it,st,ot,at).get,ct=0,ht=this.finalS,ft=this.finalE,dt=this.data.sh;if(dt===2)ft===ht?ct=nt>=ft?1:0:ct=o(0,s(.5/(ft-ht)+(nt-ht)/(ft-ht),1)),ct=lt(ct);else if(dt===3)ft===ht?ct=nt>=ft?0:1:ct=1-o(0,s(.5/(ft-ht)+(nt-ht)/(ft-ht),1)),ct=lt(ct);else if(dt===4)ft===ht?ct=0:(ct=o(0,s(.5/(ft-ht)+(nt-ht)/(ft-ht),1)),ct<.5?ct*=2:ct=1-2*(ct-.5)),ct=lt(ct);else if(dt===5){if(ft===ht)ct=0;else{var pt=ft-ht;nt=s(o(0,nt+.5-ht),ft-ht);var gt=-pt/2+nt,mt=pt/2;ct=Math.sqrt(1-gt*gt/(mt*mt))}ct=lt(ct)}else dt===6?(ft===ht?ct=0:(nt=s(o(0,nt+.5-ht),ft-ht),ct=(1+Math.cos(Math.PI+Math.PI*2*nt/(ft-ht)))/2),ct=lt(ct)):(nt>=a(ht)&&(nt-ht<0?ct=o(0,s(s(ft,1)-(ht-nt),1)):ct=o(0,s(ft-nt,1))),ct=lt(ct));if(this.sm.v!==100){var yt=this.sm.v*.01;yt===0&&(yt=1e-8);var vt=.5-yt*.5;ct<vt?ct=0:(ct=(ct-vt)/yt,ct>1&&(ct=1))}return ct*this.a.v},getValue:function(nt){this.iterateDynamicProperties(),this._mdf=nt||this._mdf,this._currentTextLength=this.elem.textProperty.currentData.l.length||0,nt&&this.data.r===2&&(this.e.v=this._currentTextLength);var it=this.data.r===2?1:100/this.data.totalChars,st=this.o.v/it,ot=this.s.v/it+st,at=this.e.v/it+st;if(ot>at){var lt=ot;ot=at,at=lt}this.finalS=ot,this.finalE=at}},extendPrototype([DynamicPropertyContainer],et);function tt(rt,nt,it){return new et(rt,nt)}return{getTextSelectorProp:tt}}();function TextAnimatorDataProperty(o,s,a){var et={propType:!1},tt=PropertyFactory.getProp,rt=s.a;this.a={r:rt.r?tt(o,rt.r,0,degToRads,a):et,rx:rt.rx?tt(o,rt.rx,0,degToRads,a):et,ry:rt.ry?tt(o,rt.ry,0,degToRads,a):et,sk:rt.sk?tt(o,rt.sk,0,degToRads,a):et,sa:rt.sa?tt(o,rt.sa,0,degToRads,a):et,s:rt.s?tt(o,rt.s,1,.01,a):et,a:rt.a?tt(o,rt.a,1,0,a):et,o:rt.o?tt(o,rt.o,0,.01,a):et,p:rt.p?tt(o,rt.p,1,0,a):et,sw:rt.sw?tt(o,rt.sw,0,0,a):et,sc:rt.sc?tt(o,rt.sc,1,0,a):et,fc:rt.fc?tt(o,rt.fc,1,0,a):et,fh:rt.fh?tt(o,rt.fh,0,0,a):et,fs:rt.fs?tt(o,rt.fs,0,.01,a):et,fb:rt.fb?tt(o,rt.fb,0,.01,a):et,t:rt.t?tt(o,rt.t,0,0,a):et},this.s=TextSelectorProp.getTextSelectorProp(o,s.s,a),this.s.t=s.s.t}function TextAnimatorProperty(o,s,a){this._isFirstFrame=!0,this._hasMaskedPath=!1,this._frameId=-1,this._textData=o,this._renderType=s,this._elem=a,this._animatorsData=createSizedArray(this._textData.a.length),this._pathData={},this._moreOptions={alignment:{}},this.renderedLetters=[],this.lettersChangedFlag=!1,this.initDynamicPropertyContainer(a)}TextAnimatorProperty.prototype.searchProperties=function(){var o,s=this._textData.a.length,a,et=PropertyFactory.getProp;for(o=0;o<s;o+=1)a=this._textData.a[o],this._animatorsData[o]=new TextAnimatorDataProperty(this._elem,a,this);this._textData.p&&"m"in this._textData.p?(this._pathData={a:et(this._elem,this._textData.p.a,0,0,this),f:et(this._elem,this._textData.p.f,0,0,this),l:et(this._elem,this._textData.p.l,0,0,this),r:et(this._elem,this._textData.p.r,0,0,this),p:et(this._elem,this._textData.p.p,0,0,this),m:this._elem.maskManager.getMaskProperty(this._textData.p.m)},this._hasMaskedPath=!0):this._hasMaskedPath=!1,this._moreOptions.alignment=et(this._elem,this._textData.m.a,1,0,this)},TextAnimatorProperty.prototype.getMeasures=function(o,s){if(this.lettersChangedFlag=s,!(!this._mdf&&!this._isFirstFrame&&!s&&(!this._hasMaskedPath||!this._pathData.m._mdf))){this._isFirstFrame=!1;var a=this._moreOptions.alignment.v,et=this._animatorsData,tt=this._textData,rt=this.mHelper,nt=this._renderType,it=this.renderedLetters.length,st,ot,at,lt,ct=o.l,ht,ft,dt,pt,gt,mt,yt,vt,Et,xt,wt,Rt,Ct,Ft,zt;if(this._hasMaskedPath){if(zt=this._pathData.m,!this._pathData.n||this._pathData._mdf){var Nt=zt.v;this._pathData.r.v&&(Nt=Nt.reverse()),ht={tLength:0,segments:[]},lt=Nt._length-1;var Kt;for(Rt=0,at=0;at<lt;at+=1)Kt=bez.buildBezierData(Nt.v[at],Nt.v[at+1],[Nt.o[at][0]-Nt.v[at][0],Nt.o[at][1]-Nt.v[at][1]],[Nt.i[at+1][0]-Nt.v[at+1][0],Nt.i[at+1][1]-Nt.v[at+1][1]]),ht.tLength+=Kt.segmentLength,ht.segments.push(Kt),Rt+=Kt.segmentLength;at=lt,zt.v.c&&(Kt=bez.buildBezierData(Nt.v[at],Nt.v[0],[Nt.o[at][0]-Nt.v[at][0],Nt.o[at][1]-Nt.v[at][1]],[Nt.i[0][0]-Nt.v[0][0],Nt.i[0][1]-Nt.v[0][1]]),ht.tLength+=Kt.segmentLength,ht.segments.push(Kt),Rt+=Kt.segmentLength),this._pathData.pi=ht}if(ht=this._pathData.pi,ft=this._pathData.f.v,yt=0,mt=1,pt=0,gt=!0,xt=ht.segments,ft<0&&zt.v.c)for(ht.tLength<Math.abs(ft)&&(ft=-Math.abs(ft)%ht.tLength),yt=xt.length-1,Et=xt[yt].points,mt=Et.length-1;ft<0;)ft+=Et[mt].partialLength,mt-=1,mt<0&&(yt-=1,Et=xt[yt].points,mt=Et.length-1);Et=xt[yt].points,vt=Et[mt-1],dt=Et[mt],wt=dt.partialLength}lt=ct.length,st=0,ot=0;var Yt=o.finalSize*1.2*.714,Bt=!0,Pt,Dt,Tt,St,Mt;St=et.length;var jt,Gt=-1,Ht,At,$t,kt=ft,Lt=yt,bt=mt,It=-1,Ut,Wt,Xt,Qt,er,lr,pr,gr,wr="",cr=this.defaultPropsArray,Cr;if(o.j===2||o.j===1){var _r=0,kr=0,Ir=o.j===2?-.5:-1,tr=0,sr=!0;for(at=0;at<lt;at+=1)if(ct[at].n){for(_r&&(_r+=kr);tr<at;)ct[tr].animatorJustifyOffset=_r,tr+=1;_r=0,sr=!0}else{for(Tt=0;Tt<St;Tt+=1)Pt=et[Tt].a,Pt.t.propType&&(sr&&o.j===2&&(kr+=Pt.t.v*Ir),Dt=et[Tt].s,jt=Dt.getMult(ct[at].anIndexes[Tt],tt.a[Tt].s.totalChars),jt.length?_r+=Pt.t.v*jt[0]*Ir:_r+=Pt.t.v*jt*Ir);sr=!1}for(_r&&(_r+=kr);tr<at;)ct[tr].animatorJustifyOffset=_r,tr+=1}for(at=0;at<lt;at+=1){if(rt.reset(),Ut=1,ct[at].n)st=0,ot+=o.yOffset,ot+=Bt?1:0,ft=kt,Bt=!1,this._hasMaskedPath&&(yt=Lt,mt=bt,Et=xt[yt].points,vt=Et[mt-1],dt=Et[mt],wt=dt.partialLength,pt=0),wr="",gr="",lr="",Cr="",cr=this.defaultPropsArray;else{if(this._hasMaskedPath){if(It!==ct[at].line){switch(o.j){case 1:ft+=Rt-o.lineWidths[ct[at].line];break;case 2:ft+=(Rt-o.lineWidths[ct[at].line])/2;break}It=ct[at].line}Gt!==ct[at].ind&&(ct[Gt]&&(ft+=ct[Gt].extra),ft+=ct[at].an/2,Gt=ct[at].ind),ft+=a[0]*ct[at].an*.005;var vr=0;for(Tt=0;Tt<St;Tt+=1)Pt=et[Tt].a,Pt.p.propType&&(Dt=et[Tt].s,jt=Dt.getMult(ct[at].anIndexes[Tt],tt.a[Tt].s.totalChars),jt.length?vr+=Pt.p.v[0]*jt[0]:vr+=Pt.p.v[0]*jt),Pt.a.propType&&(Dt=et[Tt].s,jt=Dt.getMult(ct[at].anIndexes[Tt],tt.a[Tt].s.totalChars),jt.length?vr+=Pt.a.v[0]*jt[0]:vr+=Pt.a.v[0]*jt);for(gt=!0,this._pathData.a.v&&(ft=ct[0].an*.5+(Rt-this._pathData.f.v-ct[0].an*.5-ct[ct.length-1].an*.5)*Gt/(lt-1),ft+=this._pathData.f.v);gt;)pt+wt>=ft+vr||!Et?(Ct=(ft+vr-pt)/dt.partialLength,At=vt.point[0]+(dt.point[0]-vt.point[0])*Ct,$t=vt.point[1]+(dt.point[1]-vt.point[1])*Ct,rt.translate(-a[0]*ct[at].an*.005,-(a[1]*Yt)*.01),gt=!1):Et&&(pt+=dt.partialLength,mt+=1,mt>=Et.length&&(mt=0,yt+=1,xt[yt]?Et=xt[yt].points:zt.v.c?(mt=0,yt=0,Et=xt[yt].points):(pt-=dt.partialLength,Et=null)),Et&&(vt=dt,dt=Et[mt],wt=dt.partialLength));Ht=ct[at].an/2-ct[at].add,rt.translate(-Ht,0,0)}else Ht=ct[at].an/2-ct[at].add,rt.translate(-Ht,0,0),rt.translate(-a[0]*ct[at].an*.005,-a[1]*Yt*.01,0);for(Tt=0;Tt<St;Tt+=1)Pt=et[Tt].a,Pt.t.propType&&(Dt=et[Tt].s,jt=Dt.getMult(ct[at].anIndexes[Tt],tt.a[Tt].s.totalChars),(st!==0||o.j!==0)&&(this._hasMaskedPath?jt.length?ft+=Pt.t.v*jt[0]:ft+=Pt.t.v*jt:jt.length?st+=Pt.t.v*jt[0]:st+=Pt.t.v*jt));for(o.strokeWidthAnim&&(Xt=o.sw||0),o.strokeColorAnim&&(o.sc?Wt=[o.sc[0],o.sc[1],o.sc[2]]:Wt=[0,0,0]),o.fillColorAnim&&o.fc&&(Qt=[o.fc[0],o.fc[1],o.fc[2]]),Tt=0;Tt<St;Tt+=1)Pt=et[Tt].a,Pt.a.propType&&(Dt=et[Tt].s,jt=Dt.getMult(ct[at].anIndexes[Tt],tt.a[Tt].s.totalChars),jt.length?rt.translate(-Pt.a.v[0]*jt[0],-Pt.a.v[1]*jt[1],Pt.a.v[2]*jt[2]):rt.translate(-Pt.a.v[0]*jt,-Pt.a.v[1]*jt,Pt.a.v[2]*jt));for(Tt=0;Tt<St;Tt+=1)Pt=et[Tt].a,Pt.s.propType&&(Dt=et[Tt].s,jt=Dt.getMult(ct[at].anIndexes[Tt],tt.a[Tt].s.totalChars),jt.length?rt.scale(1+(Pt.s.v[0]-1)*jt[0],1+(Pt.s.v[1]-1)*jt[1],1):rt.scale(1+(Pt.s.v[0]-1)*jt,1+(Pt.s.v[1]-1)*jt,1));for(Tt=0;Tt<St;Tt+=1){if(Pt=et[Tt].a,Dt=et[Tt].s,jt=Dt.getMult(ct[at].anIndexes[Tt],tt.a[Tt].s.totalChars),Pt.sk.propType&&(jt.length?rt.skewFromAxis(-Pt.sk.v*jt[0],Pt.sa.v*jt[1]):rt.skewFromAxis(-Pt.sk.v*jt,Pt.sa.v*jt)),Pt.r.propType&&(jt.length?rt.rotateZ(-Pt.r.v*jt[2]):rt.rotateZ(-Pt.r.v*jt)),Pt.ry.propType&&(jt.length?rt.rotateY(Pt.ry.v*jt[1]):rt.rotateY(Pt.ry.v*jt)),Pt.rx.propType&&(jt.length?rt.rotateX(Pt.rx.v*jt[0]):rt.rotateX(Pt.rx.v*jt)),Pt.o.propType&&(jt.length?Ut+=(Pt.o.v*jt[0]-Ut)*jt[0]:Ut+=(Pt.o.v*jt-Ut)*jt),o.strokeWidthAnim&&Pt.sw.propType&&(jt.length?Xt+=Pt.sw.v*jt[0]:Xt+=Pt.sw.v*jt),o.strokeColorAnim&&Pt.sc.propType)for(er=0;er<3;er+=1)jt.length?Wt[er]+=(Pt.sc.v[er]-Wt[er])*jt[0]:Wt[er]+=(Pt.sc.v[er]-Wt[er])*jt;if(o.fillColorAnim&&o.fc){if(Pt.fc.propType)for(er=0;er<3;er+=1)jt.length?Qt[er]+=(Pt.fc.v[er]-Qt[er])*jt[0]:Qt[er]+=(Pt.fc.v[er]-Qt[er])*jt;Pt.fh.propType&&(jt.length?Qt=addHueToRGB(Qt,Pt.fh.v*jt[0]):Qt=addHueToRGB(Qt,Pt.fh.v*jt)),Pt.fs.propType&&(jt.length?Qt=addSaturationToRGB(Qt,Pt.fs.v*jt[0]):Qt=addSaturationToRGB(Qt,Pt.fs.v*jt)),Pt.fb.propType&&(jt.length?Qt=addBrightnessToRGB(Qt,Pt.fb.v*jt[0]):Qt=addBrightnessToRGB(Qt,Pt.fb.v*jt))}}for(Tt=0;Tt<St;Tt+=1)Pt=et[Tt].a,Pt.p.propType&&(Dt=et[Tt].s,jt=Dt.getMult(ct[at].anIndexes[Tt],tt.a[Tt].s.totalChars),this._hasMaskedPath?jt.length?rt.translate(0,Pt.p.v[1]*jt[0],-Pt.p.v[2]*jt[1]):rt.translate(0,Pt.p.v[1]*jt,-Pt.p.v[2]*jt):jt.length?rt.translate(Pt.p.v[0]*jt[0],Pt.p.v[1]*jt[1],-Pt.p.v[2]*jt[2]):rt.translate(Pt.p.v[0]*jt,Pt.p.v[1]*jt,-Pt.p.v[2]*jt));if(o.strokeWidthAnim&&(lr=Xt<0?0:Xt),o.strokeColorAnim&&(pr="rgb("+Math.round(Wt[0]*255)+","+Math.round(Wt[1]*255)+","+Math.round(Wt[2]*255)+")"),o.fillColorAnim&&o.fc&&(gr="rgb("+Math.round(Qt[0]*255)+","+Math.round(Qt[1]*255)+","+Math.round(Qt[2]*255)+")"),this._hasMaskedPath){if(rt.translate(0,-o.ls),rt.translate(0,a[1]*Yt*.01+ot,0),this._pathData.p.v){Ft=(dt.point[1]-vt.point[1])/(dt.point[0]-vt.point[0]);var xr=Math.atan(Ft)*180/Math.PI;dt.point[0]<vt.point[0]&&(xr+=180),rt.rotate(-xr*Math.PI/180)}rt.translate(At,$t,0),ft-=a[0]*ct[at].an*.005,ct[at+1]&&Gt!==ct[at+1].ind&&(ft+=ct[at].an/2,ft+=o.tr*.001*o.finalSize)}else{switch(rt.translate(st,ot,0),o.ps&&rt.translate(o.ps[0],o.ps[1]+o.ascent,0),o.j){case 1:rt.translate(ct[at].animatorJustifyOffset+o.justifyOffset+(o.boxWidth-o.lineWidths[ct[at].line]),0,0);break;case 2:rt.translate(ct[at].animatorJustifyOffset+o.justifyOffset+(o.boxWidth-o.lineWidths[ct[at].line])/2,0,0);break}rt.translate(0,-o.ls),rt.translate(Ht,0,0),rt.translate(a[0]*ct[at].an*.005,a[1]*Yt*.01,0),st+=ct[at].l+o.tr*.001*o.finalSize}nt==="html"?wr=rt.toCSS():nt==="svg"?wr=rt.to2dCSS():cr=[rt.props[0],rt.props[1],rt.props[2],rt.props[3],rt.props[4],rt.props[5],rt.props[6],rt.props[7],rt.props[8],rt.props[9],rt.props[10],rt.props[11],rt.props[12],rt.props[13],rt.props[14],rt.props[15]],Cr=Ut}it<=at?(Mt=new LetterProps(Cr,lr,pr,gr,wr,cr),this.renderedLetters.push(Mt),it+=1,this.lettersChangedFlag=!0):(Mt=this.renderedLetters[at],this.lettersChangedFlag=Mt.update(Cr,lr,pr,gr,wr,cr)||this.lettersChangedFlag)}}},TextAnimatorProperty.prototype.getValue=function(){this._elem.globalData.frameId!==this._frameId&&(this._frameId=this._elem.globalData.frameId,this.iterateDynamicProperties())},TextAnimatorProperty.prototype.mHelper=new Matrix,TextAnimatorProperty.prototype.defaultPropsArray=[],extendPrototype([DynamicPropertyContainer],TextAnimatorProperty);function ITextElement(){}ITextElement.prototype.initElement=function(o,s,a){this.lettersChangedFlag=!0,this.initFrame(),this.initBaseData(o,s,a),this.textProperty=new TextProperty(this,o.t,this.dynamicProperties),this.textAnimator=new TextAnimatorProperty(o.t,this.renderType,this),this.initTransform(o,s,a),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide(),this.textAnimator.searchProperties(this.dynamicProperties)},ITextElement.prototype.prepareFrame=function(o){this._mdf=!1,this.prepareRenderableFrame(o),this.prepareProperties(o,this.isInRange)},ITextElement.prototype.createPathShape=function(o,s){var a,et=s.length,tt,rt="";for(a=0;a<et;a+=1)s[a].ty==="sh"&&(tt=s[a].ks.k,rt+=buildShapeString(tt,tt.i.length,!0,o));return rt},ITextElement.prototype.updateDocumentData=function(o,s){this.textProperty.updateDocumentData(o,s)},ITextElement.prototype.canResizeFont=function(o){this.textProperty.canResizeFont(o)},ITextElement.prototype.setMinimumFontSize=function(o){this.textProperty.setMinimumFontSize(o)},ITextElement.prototype.applyTextPropertiesToMatrix=function(o,s,a,et,tt){switch(o.ps&&s.translate(o.ps[0],o.ps[1]+o.ascent,0),s.translate(0,-o.ls,0),o.j){case 1:s.translate(o.justifyOffset+(o.boxWidth-o.lineWidths[a]),0,0);break;case 2:s.translate(o.justifyOffset+(o.boxWidth-o.lineWidths[a])/2,0,0);break}s.translate(et,tt,0)},ITextElement.prototype.buildColor=function(o){return"rgb("+Math.round(o[0]*255)+","+Math.round(o[1]*255)+","+Math.round(o[2]*255)+")"},ITextElement.prototype.emptyProp=new LetterProps,ITextElement.prototype.destroy=function(){},ITextElement.prototype.validateText=function(){(this.textProperty._mdf||this.textProperty._isFirstFrame)&&(this.buildNewText(),this.textProperty._isFirstFrame=!1,this.textProperty._mdf=!1)};var emptyShapeData={shapes:[]};function SVGTextLottieElement(o,s,a){this.textSpans=[],this.renderType="svg",this.initElement(o,s,a)}extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],SVGTextLottieElement),SVGTextLottieElement.prototype.createContent=function(){this.data.singleShape&&!this.globalData.fontManager.chars&&(this.textContainer=createNS("text"))},SVGTextLottieElement.prototype.buildTextContents=function(o){for(var s=0,a=o.length,et=[],tt="";s<a;)o[s]==="\r"||o[s]===""?(et.push(tt),tt=""):tt+=o[s],s+=1;return et.push(tt),et},SVGTextLottieElement.prototype.buildShapeData=function(o,s){if(o.shapes&&o.shapes.length){var a=o.shapes[0];if(a.it){var et=a.it[a.it.length-1];et.s&&(et.s.k[0]=s,et.s.k[1]=s)}}return o},SVGTextLottieElement.prototype.buildNewText=function(){this.addDynamicProperty(this);var o,s,a=this.textProperty.currentData;this.renderedLetters=createSizedArray(a?a.l.length:0),a.fc?this.layerElement.setAttribute("fill",this.buildColor(a.fc)):this.layerElement.setAttribute("fill","rgba(0,0,0,0)"),a.sc&&(this.layerElement.setAttribute("stroke",this.buildColor(a.sc)),this.layerElement.setAttribute("stroke-width",a.sw)),this.layerElement.setAttribute("font-size",a.finalSize);var et=this.globalData.fontManager.getFontByName(a.f);if(et.fClass)this.layerElement.setAttribute("class",et.fClass);else{this.layerElement.setAttribute("font-family",et.fFamily);var tt=a.fWeight,rt=a.fStyle;this.layerElement.setAttribute("font-style",rt),this.layerElement.setAttribute("font-weight",tt)}this.layerElement.setAttribute("aria-label",a.t);var nt=a.l||[],it=!!this.globalData.fontManager.chars;s=nt.length;var st,ot=this.mHelper,at="",lt=this.data.singleShape,ct=0,ht=0,ft=!0,dt=a.tr*.001*a.finalSize;if(lt&&!it&&!a.sz){var pt=this.textContainer,gt="start";switch(a.j){case 1:gt="end";break;case 2:gt="middle";break;default:gt="start";break}pt.setAttribute("text-anchor",gt),pt.setAttribute("letter-spacing",dt);var mt=this.buildTextContents(a.finalText);for(s=mt.length,ht=a.ps?a.ps[1]+a.ascent:0,o=0;o<s;o+=1)st=this.textSpans[o].span||createNS("tspan"),st.textContent=mt[o],st.setAttribute("x",0),st.setAttribute("y",ht),st.style.display="inherit",pt.appendChild(st),this.textSpans[o]||(this.textSpans[o]={span:null,glyph:null}),this.textSpans[o].span=st,ht+=a.finalLineHeight;this.layerElement.appendChild(pt)}else{var yt=this.textSpans.length,vt;for(o=0;o<s;o+=1){if(this.textSpans[o]||(this.textSpans[o]={span:null,childSpan:null,glyph:null}),!it||!lt||o===0){if(st=yt>o?this.textSpans[o].span:createNS(it?"g":"text"),yt<=o){if(st.setAttribute("stroke-linecap","butt"),st.setAttribute("stroke-linejoin","round"),st.setAttribute("stroke-miterlimit","4"),this.textSpans[o].span=st,it){var Et=createNS("g");st.appendChild(Et),this.textSpans[o].childSpan=Et}this.textSpans[o].span=st,this.layerElement.appendChild(st)}st.style.display="inherit"}if(ot.reset(),lt&&(nt[o].n&&(ct=-dt,ht+=a.yOffset,ht+=ft?1:0,ft=!1),this.applyTextPropertiesToMatrix(a,ot,nt[o].line,ct,ht),ct+=nt[o].l||0,ct+=dt),it){vt=this.globalData.fontManager.getCharData(a.finalText[o],et.fStyle,this.globalData.fontManager.getFontByName(a.f).fFamily);var xt;if(vt.t===1)xt=new SVGCompElement(vt.data,this.globalData,this);else{var wt=emptyShapeData;vt.data&&vt.data.shapes&&(wt=this.buildShapeData(vt.data,a.finalSize)),xt=new SVGShapeElement(wt,this.globalData,this)}if(this.textSpans[o].glyph){var Rt=this.textSpans[o].glyph;this.textSpans[o].childSpan.removeChild(Rt.layerElement),Rt.destroy()}this.textSpans[o].glyph=xt,xt._debug=!0,xt.prepareFrame(0),xt.renderFrame(),this.textSpans[o].childSpan.appendChild(xt.layerElement),vt.t===1&&this.textSpans[o].childSpan.setAttribute("transform","scale("+a.finalSize/100+","+a.finalSize/100+")")}else lt&&st.setAttribute("transform","translate("+ot.props[12]+","+ot.props[13]+")"),st.textContent=nt[o].val,st.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve")}lt&&st&&st.setAttribute("d",at)}for(;o<this.textSpans.length;)this.textSpans[o].span.style.display="none",o+=1;this._sizeChanged=!0},SVGTextLottieElement.prototype.sourceRectAtTime=function(){if(this.prepareFrame(this.comp.renderedFrame-this.data.st),this.renderInnerContent(),this._sizeChanged){this._sizeChanged=!1;var o=this.layerElement.getBBox();this.bbox={top:o.y,left:o.x,width:o.width,height:o.height}}return this.bbox},SVGTextLottieElement.prototype.getValue=function(){var o,s=this.textSpans.length,a;for(this.renderedFrame=this.comp.renderedFrame,o=0;o<s;o+=1)a=this.textSpans[o].glyph,a&&(a.prepareFrame(this.comp.renderedFrame-this.data.st),a._mdf&&(this._mdf=!0))},SVGTextLottieElement.prototype.renderInnerContent=function(){if(this.validateText(),(!this.data.singleShape||this._mdf)&&(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),this.lettersChangedFlag||this.textAnimator.lettersChangedFlag)){this._sizeChanged=!0;var o,s,a=this.textAnimator.renderedLetters,et=this.textProperty.currentData.l;s=et.length;var tt,rt,nt;for(o=0;o<s;o+=1)et[o].n||(tt=a[o],rt=this.textSpans[o].span,nt=this.textSpans[o].glyph,nt&&nt.renderFrame(),tt._mdf.m&&rt.setAttribute("transform",tt.m),tt._mdf.o&&rt.setAttribute("opacity",tt.o),tt._mdf.sw&&rt.setAttribute("stroke-width",tt.sw),tt._mdf.sc&&rt.setAttribute("stroke",tt.sc),tt._mdf.fc&&rt.setAttribute("fill",tt.fc))}};function ISolidElement(o,s,a){this.initElement(o,s,a)}extendPrototype([IImageElement],ISolidElement),ISolidElement.prototype.createContent=function(){var o=createNS("rect");o.setAttribute("width",this.data.sw),o.setAttribute("height",this.data.sh),o.setAttribute("fill",this.data.sc),this.layerElement.appendChild(o)};function NullElement(o,s,a){this.initFrame(),this.initBaseData(o,s,a),this.initFrame(),this.initTransform(o,s,a),this.initHierarchy()}NullElement.prototype.prepareFrame=function(o){this.prepareProperties(o,!0)},NullElement.prototype.renderFrame=function(){},NullElement.prototype.getBaseElement=function(){return null},NullElement.prototype.destroy=function(){},NullElement.prototype.sourceRectAtTime=function(){},NullElement.prototype.hide=function(){},extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement],NullElement);function SVGRendererBase(){}extendPrototype([BaseRenderer],SVGRendererBase),SVGRendererBase.prototype.createNull=function(o){return new NullElement(o,this.globalData,this)},SVGRendererBase.prototype.createShape=function(o){return new SVGShapeElement(o,this.globalData,this)},SVGRendererBase.prototype.createText=function(o){return new SVGTextLottieElement(o,this.globalData,this)},SVGRendererBase.prototype.createImage=function(o){return new IImageElement(o,this.globalData,this)},SVGRendererBase.prototype.createSolid=function(o){return new ISolidElement(o,this.globalData,this)},SVGRendererBase.prototype.configAnimation=function(o){this.svgElement.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.svgElement.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),this.renderConfig.viewBoxSize?this.svgElement.setAttribute("viewBox",this.renderConfig.viewBoxSize):this.svgElement.setAttribute("viewBox","0 0 "+o.w+" "+o.h),this.renderConfig.viewBoxOnly||(this.svgElement.setAttribute("width",o.w),this.svgElement.setAttribute("height",o.h),this.svgElement.style.width="100%",this.svgElement.style.height="100%",this.svgElement.style.transform="translate3d(0,0,0)",this.svgElement.style.contentVisibility=this.renderConfig.contentVisibility),this.renderConfig.width&&this.svgElement.setAttribute("width",this.renderConfig.width),this.renderConfig.height&&this.svgElement.setAttribute("height",this.renderConfig.height),this.renderConfig.className&&this.svgElement.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.svgElement.setAttribute("id",this.renderConfig.id),this.renderConfig.focusable!==void 0&&this.svgElement.setAttribute("focusable",this.renderConfig.focusable),this.svgElement.setAttribute("preserveAspectRatio",this.renderConfig.preserveAspectRatio),this.animationItem.wrapper.appendChild(this.svgElement);var s=this.globalData.defs;this.setupGlobalData(o,s),this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.data=o;var a=createNS("clipPath"),et=createNS("rect");et.setAttribute("width",o.w),et.setAttribute("height",o.h),et.setAttribute("x",0),et.setAttribute("y",0);var tt=createElementID();a.setAttribute("id",tt),a.appendChild(et),this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+tt+")"),s.appendChild(a),this.layers=o.layers,this.elements=createSizedArray(o.layers.length)},SVGRendererBase.prototype.destroy=function(){this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.layerElement=null,this.globalData.defs=null;var o,s=this.layers?this.layers.length:0;for(o=0;o<s;o+=1)this.elements[o]&&this.elements[o].destroy&&this.elements[o].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},SVGRendererBase.prototype.updateContainerSize=function(){},SVGRendererBase.prototype.findIndexByInd=function(o){var s=0,a=this.layers.length;for(s=0;s<a;s+=1)if(this.layers[s].ind===o)return s;return-1},SVGRendererBase.prototype.buildItem=function(o){var s=this.elements;if(!(s[o]||this.layers[o].ty===99)){s[o]=!0;var a=this.createItem(this.layers[o]);if(s[o]=a,getExpressionsPlugin()&&(this.layers[o].ty===0&&this.globalData.projectInterface.registerComposition(a),a.initExpressions()),this.appendElementInPos(a,o),this.layers[o].tt){var et="tp"in this.layers[o]?this.findIndexByInd(this.layers[o].tp):o-1;if(et===-1)return;if(!this.elements[et]||this.elements[et]===!0)this.buildItem(et),this.addPendingElement(a);else{var tt=s[et],rt=tt.getMatte(this.layers[o].tt);a.setMatte(rt)}}}},SVGRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var o=this.pendingElements.pop();if(o.checkParenting(),o.data.tt)for(var s=0,a=this.elements.length;s<a;){if(this.elements[s]===o){var et="tp"in o.data?this.findIndexByInd(o.data.tp):s-1,tt=this.elements[et],rt=tt.getMatte(this.layers[s].tt);o.setMatte(rt);break}s+=1}}},SVGRendererBase.prototype.renderFrame=function(o){if(!(this.renderedFrame===o||this.destroyed)){o===null?o=this.renderedFrame:this.renderedFrame=o,this.globalData.frameNum=o,this.globalData.frameId+=1,this.globalData.projectInterface.currentFrame=o,this.globalData._mdf=!1;var s,a=this.layers.length;for(this.completeLayers||this.checkLayers(o),s=a-1;s>=0;s-=1)(this.completeLayers||this.elements[s])&&this.elements[s].prepareFrame(o-this.layers[s].st);if(this.globalData._mdf)for(s=0;s<a;s+=1)(this.completeLayers||this.elements[s])&&this.elements[s].renderFrame()}},SVGRendererBase.prototype.appendElementInPos=function(o,s){var a=o.getBaseElement();if(a){for(var et=0,tt;et<s;)this.elements[et]&&this.elements[et]!==!0&&this.elements[et].getBaseElement()&&(tt=this.elements[et].getBaseElement()),et+=1;tt?this.layerElement.insertBefore(a,tt):this.layerElement.appendChild(a)}},SVGRendererBase.prototype.hide=function(){this.layerElement.style.display="none"},SVGRendererBase.prototype.show=function(){this.layerElement.style.display="block"};function ICompElement(){}extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement,RenderableDOMElement],ICompElement),ICompElement.prototype.initElement=function(o,s,a){this.initFrame(),this.initBaseData(o,s,a),this.initTransform(o,s,a),this.initRenderable(),this.initHierarchy(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),(this.data.xt||!s.progressiveLoad)&&this.buildAllItems(),this.hide()},ICompElement.prototype.prepareFrame=function(o){if(this._mdf=!1,this.prepareRenderableFrame(o),this.prepareProperties(o,this.isInRange),!(!this.isInRange&&!this.data.xt)){if(this.tm._placeholder)this.renderedFrame=o/this.data.sr;else{var s=this.tm.v;s===this.data.op&&(s=this.data.op-1),this.renderedFrame=s}var a,et=this.elements.length;for(this.completeLayers||this.checkLayers(this.renderedFrame),a=et-1;a>=0;a-=1)(this.completeLayers||this.elements[a])&&(this.elements[a].prepareFrame(this.renderedFrame-this.layers[a].st),this.elements[a]._mdf&&(this._mdf=!0))}},ICompElement.prototype.renderInnerContent=function(){var o,s=this.layers.length;for(o=0;o<s;o+=1)(this.completeLayers||this.elements[o])&&this.elements[o].renderFrame()},ICompElement.prototype.setElements=function(o){this.elements=o},ICompElement.prototype.getElements=function(){return this.elements},ICompElement.prototype.destroyElements=function(){var o,s=this.layers.length;for(o=0;o<s;o+=1)this.elements[o]&&this.elements[o].destroy()},ICompElement.prototype.destroy=function(){this.destroyElements(),this.destroyBaseElement()};function SVGCompElement(o,s,a){this.layers=o.layers,this.supports3d=!0,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(o,s,a),this.tm=o.tm?PropertyFactory.getProp(this,o.tm,0,s.frameRate,this):{_placeholder:!0}}extendPrototype([SVGRendererBase,ICompElement,SVGBaseElement],SVGCompElement),SVGCompElement.prototype.createComp=function(o){return new SVGCompElement(o,this.globalData,this)};function SVGRenderer(o,s){this.animationItem=o,this.layers=null,this.renderedFrame=-1,this.svgElement=createNS("svg");var a="";if(s&&s.title){var et=createNS("title"),tt=createElementID();et.setAttribute("id",tt),et.textContent=s.title,this.svgElement.appendChild(et),a+=tt}if(s&&s.description){var rt=createNS("desc"),nt=createElementID();rt.setAttribute("id",nt),rt.textContent=s.description,this.svgElement.appendChild(rt),a+=" "+nt}a&&this.svgElement.setAttribute("aria-labelledby",a);var it=createNS("defs");this.svgElement.appendChild(it);var st=createNS("g");this.svgElement.appendChild(st),this.layerElement=st,this.renderConfig={preserveAspectRatio:s&&s.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:s&&s.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:s&&s.contentVisibility||"visible",progressiveLoad:s&&s.progressiveLoad||!1,hideOnTransparent:!(s&&s.hideOnTransparent===!1),viewBoxOnly:s&&s.viewBoxOnly||!1,viewBoxSize:s&&s.viewBoxSize||!1,className:s&&s.className||"",id:s&&s.id||"",focusable:s&&s.focusable,filterSize:{width:s&&s.filterSize&&s.filterSize.width||"100%",height:s&&s.filterSize&&s.filterSize.height||"100%",x:s&&s.filterSize&&s.filterSize.x||"0%",y:s&&s.filterSize&&s.filterSize.y||"0%"},width:s&&s.width,height:s&&s.height,runExpressions:!s||s.runExpressions===void 0||s.runExpressions},this.globalData={_mdf:!1,frameNum:-1,defs:it,renderConfig:this.renderConfig},this.elements=[],this.pendingElements=[],this.destroyed=!1,this.rendererType="svg"}extendPrototype([SVGRendererBase],SVGRenderer),SVGRenderer.prototype.createComp=function(o){return new SVGCompElement(o,this.globalData,this)};function ShapeTransformManager(){this.sequences={},this.sequenceList=[],this.transform_key_count=0}ShapeTransformManager.prototype={addTransformSequence:function(s){var a,et=s.length,tt="_";for(a=0;a<et;a+=1)tt+=s[a].transform.key+"_";var rt=this.sequences[tt];return rt||(rt={transforms:[].concat(s),finalTransform:new Matrix,_mdf:!1},this.sequences[tt]=rt,this.sequenceList.push(rt)),rt},processSequence:function(s,a){for(var et=0,tt=s.transforms.length,rt=a;et<tt&&!a;){if(s.transforms[et].transform.mProps._mdf){rt=!0;break}et+=1}if(rt)for(s.finalTransform.reset(),et=tt-1;et>=0;et-=1)s.finalTransform.multiply(s.transforms[et].transform.mProps.v);s._mdf=rt},processSequences:function(s){var a,et=this.sequenceList.length;for(a=0;a<et;a+=1)this.processSequence(this.sequenceList[a],s)},getNewKey:function(){return this.transform_key_count+=1,"_"+this.transform_key_count}};var lumaLoader=function(){var s="__lottie_element_luma_buffer",a=null,et=null,tt=null;function rt(){var st=createNS("svg"),ot=createNS("filter"),at=createNS("feColorMatrix");return ot.setAttribute("id",s),at.setAttribute("type","matrix"),at.setAttribute("color-interpolation-filters","sRGB"),at.setAttribute("values","0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0"),ot.appendChild(at),st.appendChild(ot),st.setAttribute("id",s+"_svg"),featureSupport.svgLumaHidden&&(st.style.display="none"),st}function nt(){a||(tt=rt(),document.body.appendChild(tt),a=createTag("canvas"),et=a.getContext("2d"),et.filter="url(#"+s+")",et.fillStyle="rgba(0,0,0,0)",et.fillRect(0,0,1,1))}function it(st){return a||nt(),a.width=st.width,a.height=st.height,et.filter="url(#"+s+")",a}return{load:nt,get:it}};function createCanvas(o,s){if(featureSupport.offscreenCanvas)return new OffscreenCanvas(o,s);var a=createTag("canvas");return a.width=o,a.height=s,a}var assetLoader=function(){return{loadLumaCanvas:lumaLoader.load,getLumaCanvas:lumaLoader.get,createCanvas}}(),registeredEffects={};function CVEffects(o){var s,a=o.data.ef?o.data.ef.length:0;this.filters=[];var et;for(s=0;s<a;s+=1){et=null;var tt=o.data.ef[s].ty;if(registeredEffects[tt]){var rt=registeredEffects[tt].effect;et=new rt(o.effectsManager.effectElements[s],o)}et&&this.filters.push(et)}this.filters.length&&o.addRenderableComponent(this)}CVEffects.prototype.renderFrame=function(o){var s,a=this.filters.length;for(s=0;s<a;s+=1)this.filters[s].renderFrame(o)},CVEffects.prototype.getEffects=function(o){var s,a=this.filters.length,et=[];for(s=0;s<a;s+=1)this.filters[s].type===o&&et.push(this.filters[s]);return et};function registerEffect(o,s){registeredEffects[o]={effect:s}}function CVMaskElement(o,s){this.data=o,this.element=s,this.masksProperties=this.data.masksProperties||[],this.viewData=createSizedArray(this.masksProperties.length);var a,et=this.masksProperties.length,tt=!1;for(a=0;a<et;a+=1)this.masksProperties[a].mode!=="n"&&(tt=!0),this.viewData[a]=ShapePropertyFactory.getShapeProp(this.element,this.masksProperties[a],3);this.hasMasks=tt,tt&&this.element.addRenderableComponent(this)}CVMaskElement.prototype.renderFrame=function(){if(this.hasMasks){var o=this.element.finalTransform.mat,s=this.element.canvasContext,a,et=this.masksProperties.length,tt,rt,nt;for(s.beginPath(),a=0;a<et;a+=1)if(this.masksProperties[a].mode!=="n"){this.masksProperties[a].inv&&(s.moveTo(0,0),s.lineTo(this.element.globalData.compSize.w,0),s.lineTo(this.element.globalData.compSize.w,this.element.globalData.compSize.h),s.lineTo(0,this.element.globalData.compSize.h),s.lineTo(0,0)),nt=this.viewData[a].v,tt=o.applyToPointArray(nt.v[0][0],nt.v[0][1],0),s.moveTo(tt[0],tt[1]);var it,st=nt._length;for(it=1;it<st;it+=1)rt=o.applyToTriplePoints(nt.o[it-1],nt.i[it],nt.v[it]),s.bezierCurveTo(rt[0],rt[1],rt[2],rt[3],rt[4],rt[5]);rt=o.applyToTriplePoints(nt.o[it-1],nt.i[0],nt.v[0]),s.bezierCurveTo(rt[0],rt[1],rt[2],rt[3],rt[4],rt[5])}this.element.globalData.renderer.save(!0),s.clip()}},CVMaskElement.prototype.getMaskProperty=MaskElement.prototype.getMaskProperty,CVMaskElement.prototype.destroy=function(){this.element=null};function CVBaseElement(){}var operationsMap={1:"source-in",2:"source-out",3:"source-in",4:"source-out"};CVBaseElement.prototype={createElements:function(){},initRendererElement:function(){},createContainerElements:function(){if(this.data.tt>=1){this.buffers=[];var s=this.globalData.canvasContext,a=assetLoader.createCanvas(s.canvas.width,s.canvas.height);this.buffers.push(a);var et=assetLoader.createCanvas(s.canvas.width,s.canvas.height);this.buffers.push(et),this.data.tt>=3&&!document._isProxy&&assetLoader.loadLumaCanvas()}this.canvasContext=this.globalData.canvasContext,this.transformCanvas=this.globalData.transformCanvas,this.renderableEffectsManager=new CVEffects(this),this.searchEffectTransforms()},createContent:function(){},setBlendMode:function(){var s=this.globalData;if(s.blendMode!==this.data.bm){s.blendMode=this.data.bm;var a=getBlendMode(this.data.bm);s.canvasContext.globalCompositeOperation=a}},createRenderableComponents:function(){this.maskManager=new CVMaskElement(this.data,this),this.transformEffects=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT)},hideElement:function(){!this.hidden&&(!this.isInRange||this.isTransparent)&&(this.hidden=!0)},showElement:function(){this.isInRange&&!this.isTransparent&&(this.hidden=!1,this._isFirstFrame=!0,this.maskManager._isFirstFrame=!0)},clearCanvas:function(s){s.clearRect(this.transformCanvas.tx,this.transformCanvas.ty,this.transformCanvas.w*this.transformCanvas.sx,this.transformCanvas.h*this.transformCanvas.sy)},prepareLayer:function(){if(this.data.tt>=1){var s=this.buffers[0],a=s.getContext("2d");this.clearCanvas(a),a.drawImage(this.canvasContext.canvas,0,0),this.currentTransform=this.canvasContext.getTransform(),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform)}},exitLayer:function(){if(this.data.tt>=1){var s=this.buffers[1],a=s.getContext("2d");this.clearCanvas(a),a.drawImage(this.canvasContext.canvas,0,0),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform);var et=this.comp.getElementById("tp"in this.data?this.data.tp:this.data.ind-1);if(et.renderFrame(!0),this.canvasContext.setTransform(1,0,0,1,0,0),this.data.tt>=3&&!document._isProxy){var tt=assetLoader.getLumaCanvas(this.canvasContext.canvas),rt=tt.getContext("2d");rt.drawImage(this.canvasContext.canvas,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.drawImage(tt,0,0)}this.canvasContext.globalCompositeOperation=operationsMap[this.data.tt],this.canvasContext.drawImage(s,0,0),this.canvasContext.globalCompositeOperation="destination-over",this.canvasContext.drawImage(this.buffers[0],0,0),this.canvasContext.setTransform(this.currentTransform),this.canvasContext.globalCompositeOperation="source-over"}},renderFrame:function(s){if(!(this.hidden||this.data.hd)&&!(this.data.td===1&&!s)){this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.setBlendMode();var a=this.data.ty===0;this.prepareLayer(),this.globalData.renderer.save(a),this.globalData.renderer.ctxTransform(this.finalTransform.localMat.props),this.globalData.renderer.ctxOpacity(this.finalTransform.localOpacity),this.renderInnerContent(),this.globalData.renderer.restore(a),this.exitLayer(),this.maskManager.hasMasks&&this.globalData.renderer.restore(!0),this._isFirstFrame&&(this._isFirstFrame=!1)}},destroy:function(){this.canvasContext=null,this.data=null,this.globalData=null,this.maskManager.destroy()},mHelper:new Matrix},CVBaseElement.prototype.hide=CVBaseElement.prototype.hideElement,CVBaseElement.prototype.show=CVBaseElement.prototype.showElement;function CVShapeData(o,s,a,et){this.styledShapes=[],this.tr=[0,0,0,0,0,0];var tt=4;s.ty==="rc"?tt=5:s.ty==="el"?tt=6:s.ty==="sr"&&(tt=7),this.sh=ShapePropertyFactory.getShapeProp(o,s,tt,o);var rt,nt=a.length,it;for(rt=0;rt<nt;rt+=1)a[rt].closed||(it={transforms:et.addTransformSequence(a[rt].transforms),trNodes:[]},this.styledShapes.push(it),a[rt].elements.push(it))}CVShapeData.prototype.setAsAnimated=SVGShapeData.prototype.setAsAnimated;function CVShapeElement(o,s,a){this.shapes=[],this.shapesData=o.shapes,this.stylesList=[],this.itemsData=[],this.prevViewData=[],this.shapeModifiers=[],this.processedElements=[],this.transformsManager=new ShapeTransformManager,this.initElement(o,s,a)}extendPrototype([BaseElement,TransformElement,CVBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableElement],CVShapeElement),CVShapeElement.prototype.initElement=RenderableDOMElement.prototype.initElement,CVShapeElement.prototype.transformHelper={opacity:1,_opMdf:!1},CVShapeElement.prototype.dashResetter=[],CVShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[])},CVShapeElement.prototype.createStyleElement=function(o,s){var a={data:o,type:o.ty,preTransforms:this.transformsManager.addTransformSequence(s),transforms:[],elements:[],closed:o.hd===!0},et={};if(o.ty==="fl"||o.ty==="st"?(et.c=PropertyFactory.getProp(this,o.c,1,255,this),et.c.k||(a.co="rgb("+bmFloor(et.c.v[0])+","+bmFloor(et.c.v[1])+","+bmFloor(et.c.v[2])+")")):(o.ty==="gf"||o.ty==="gs")&&(et.s=PropertyFactory.getProp(this,o.s,1,null,this),et.e=PropertyFactory.getProp(this,o.e,1,null,this),et.h=PropertyFactory.getProp(this,o.h||{k:0},0,.01,this),et.a=PropertyFactory.getProp(this,o.a||{k:0},0,degToRads,this),et.g=new GradientProperty(this,o.g,this)),et.o=PropertyFactory.getProp(this,o.o,0,.01,this),o.ty==="st"||o.ty==="gs"){if(a.lc=lineCapEnum[o.lc||2],a.lj=lineJoinEnum[o.lj||2],o.lj==1&&(a.ml=o.ml),et.w=PropertyFactory.getProp(this,o.w,0,null,this),et.w.k||(a.wi=et.w.v),o.d){var tt=new DashProperty(this,o.d,"canvas",this);et.d=tt,et.d.k||(a.da=et.d.dashArray,a.do=et.d.dashoffset[0])}}else a.r=o.r===2?"evenodd":"nonzero";return this.stylesList.push(a),et.style=a,et},CVShapeElement.prototype.createGroupElement=function(){var o={it:[],prevViewData:[]};return o},CVShapeElement.prototype.createTransformElement=function(o){var s={transform:{opacity:1,_opMdf:!1,key:this.transformsManager.getNewKey(),op:PropertyFactory.getProp(this,o.o,0,.01,this),mProps:TransformPropertyFactory.getTransformProperty(this,o,this)}};return s},CVShapeElement.prototype.createShapeElement=function(o){var s=new CVShapeData(this,o,this.stylesList,this.transformsManager);return this.shapes.push(s),this.addShapeToModifiers(s),s},CVShapeElement.prototype.reloadShapes=function(){this._isFirstFrame=!0;var o,s=this.itemsData.length;for(o=0;o<s;o+=1)this.prevViewData[o]=this.itemsData[o];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[]),s=this.dynamicProperties.length,o=0;o<s;o+=1)this.dynamicProperties[o].getValue();this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame)},CVShapeElement.prototype.addTransformToStyleList=function(o){var s,a=this.stylesList.length;for(s=0;s<a;s+=1)this.stylesList[s].closed||this.stylesList[s].transforms.push(o)},CVShapeElement.prototype.removeTransformFromStyleList=function(){var o,s=this.stylesList.length;for(o=0;o<s;o+=1)this.stylesList[o].closed||this.stylesList[o].transforms.pop()},CVShapeElement.prototype.closeStyles=function(o){var s,a=o.length;for(s=0;s<a;s+=1)o[s].closed=!0},CVShapeElement.prototype.searchShapes=function(o,s,a,et,tt){var rt,nt=o.length-1,it,st,ot=[],at=[],lt,ct,ht,ft=[].concat(tt);for(rt=nt;rt>=0;rt-=1){if(lt=this.searchProcessedElement(o[rt]),lt?s[rt]=a[lt-1]:o[rt]._shouldRender=et,o[rt].ty==="fl"||o[rt].ty==="st"||o[rt].ty==="gf"||o[rt].ty==="gs")lt?s[rt].style.closed=!1:s[rt]=this.createStyleElement(o[rt],ft),ot.push(s[rt].style);else if(o[rt].ty==="gr"){if(!lt)s[rt]=this.createGroupElement(o[rt]);else for(st=s[rt].it.length,it=0;it<st;it+=1)s[rt].prevViewData[it]=s[rt].it[it];this.searchShapes(o[rt].it,s[rt].it,s[rt].prevViewData,et,ft)}else o[rt].ty==="tr"?(lt||(ht=this.createTransformElement(o[rt]),s[rt]=ht),ft.push(s[rt]),this.addTransformToStyleList(s[rt])):o[rt].ty==="sh"||o[rt].ty==="rc"||o[rt].ty==="el"||o[rt].ty==="sr"?lt||(s[rt]=this.createShapeElement(o[rt])):o[rt].ty==="tm"||o[rt].ty==="rd"||o[rt].ty==="pb"||o[rt].ty==="zz"||o[rt].ty==="op"?(lt?(ct=s[rt],ct.closed=!1):(ct=ShapeModifiers.getModifier(o[rt].ty),ct.init(this,o[rt]),s[rt]=ct,this.shapeModifiers.push(ct)),at.push(ct)):o[rt].ty==="rp"&&(lt?(ct=s[rt],ct.closed=!0):(ct=ShapeModifiers.getModifier(o[rt].ty),s[rt]=ct,ct.init(this,o,rt,s),this.shapeModifiers.push(ct),et=!1),at.push(ct));this.addProcessedElement(o[rt],rt+1)}for(this.removeTransformFromStyleList(),this.closeStyles(ot),nt=at.length,rt=0;rt<nt;rt+=1)at[rt].closed=!0},CVShapeElement.prototype.renderInnerContent=function(){this.transformHelper.opacity=1,this.transformHelper._opMdf=!1,this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame),this.renderShape(this.transformHelper,this.shapesData,this.itemsData,!0)},CVShapeElement.prototype.renderShapeTransform=function(o,s){(o._opMdf||s.op._mdf||this._isFirstFrame)&&(s.opacity=o.opacity,s.opacity*=s.op.v,s._opMdf=!0)},CVShapeElement.prototype.drawLayer=function(){var o,s=this.stylesList.length,a,et,tt,rt,nt,it,st=this.globalData.renderer,ot=this.globalData.canvasContext,at,lt;for(o=0;o<s;o+=1)if(lt=this.stylesList[o],at=lt.type,!((at==="st"||at==="gs")&&lt.wi===0||!lt.data._shouldRender||lt.coOp===0||this.globalData.currentGlobalAlpha===0)){for(st.save(),nt=lt.elements,at==="st"||at==="gs"?(st.ctxStrokeStyle(at==="st"?lt.co:lt.grd),st.ctxLineWidth(lt.wi),st.ctxLineCap(lt.lc),st.ctxLineJoin(lt.lj),st.ctxMiterLimit(lt.ml||0)):st.ctxFillStyle(at==="fl"?lt.co:lt.grd),st.ctxOpacity(lt.coOp),at!=="st"&&at!=="gs"&&ot.beginPath(),st.ctxTransform(lt.preTransforms.finalTransform.props),et=nt.length,a=0;a<et;a+=1){for((at==="st"||at==="gs")&&(ot.beginPath(),lt.da&&(ot.setLineDash(lt.da),ot.lineDashOffset=lt.do)),it=nt[a].trNodes,rt=it.length,tt=0;tt<rt;tt+=1)it[tt].t==="m"?ot.moveTo(it[tt].p[0],it[tt].p[1]):it[tt].t==="c"?ot.bezierCurveTo(it[tt].pts[0],it[tt].pts[1],it[tt].pts[2],it[tt].pts[3],it[tt].pts[4],it[tt].pts[5]):ot.closePath();(at==="st"||at==="gs")&&(st.ctxStroke(),lt.da&&ot.setLineDash(this.dashResetter))}at!=="st"&&at!=="gs"&&this.globalData.renderer.ctxFill(lt.r),st.restore()}},CVShapeElement.prototype.renderShape=function(o,s,a,et){var tt,rt=s.length-1,nt;for(nt=o,tt=rt;tt>=0;tt-=1)s[tt].ty==="tr"?(nt=a[tt].transform,this.renderShapeTransform(o,nt)):s[tt].ty==="sh"||s[tt].ty==="el"||s[tt].ty==="rc"||s[tt].ty==="sr"?this.renderPath(s[tt],a[tt]):s[tt].ty==="fl"?this.renderFill(s[tt],a[tt],nt):s[tt].ty==="st"?this.renderStroke(s[tt],a[tt],nt):s[tt].ty==="gf"||s[tt].ty==="gs"?this.renderGradientFill(s[tt],a[tt],nt):s[tt].ty==="gr"?this.renderShape(nt,s[tt].it,a[tt].it):s[tt].ty;et&&this.drawLayer()},CVShapeElement.prototype.renderStyledShape=function(o,s){if(this._isFirstFrame||s._mdf||o.transforms._mdf){var a=o.trNodes,et=s.paths,tt,rt,nt,it=et._length;a.length=0;var st=o.transforms.finalTransform;for(nt=0;nt<it;nt+=1){var ot=et.shapes[nt];if(ot&&ot.v){for(rt=ot._length,tt=1;tt<rt;tt+=1)tt===1&&a.push({t:"m",p:st.applyToPointArray(ot.v[0][0],ot.v[0][1],0)}),a.push({t:"c",pts:st.applyToTriplePoints(ot.o[tt-1],ot.i[tt],ot.v[tt])});rt===1&&a.push({t:"m",p:st.applyToPointArray(ot.v[0][0],ot.v[0][1],0)}),ot.c&&rt&&(a.push({t:"c",pts:st.applyToTriplePoints(ot.o[tt-1],ot.i[0],ot.v[0])}),a.push({t:"z"}))}}o.trNodes=a}},CVShapeElement.prototype.renderPath=function(o,s){if(o.hd!==!0&&o._shouldRender){var a,et=s.styledShapes.length;for(a=0;a<et;a+=1)this.renderStyledShape(s.styledShapes[a],s.sh)}},CVShapeElement.prototype.renderFill=function(o,s,a){var et=s.style;(s.c._mdf||this._isFirstFrame)&&(et.co="rgb("+bmFloor(s.c.v[0])+","+bmFloor(s.c.v[1])+","+bmFloor(s.c.v[2])+")"),(s.o._mdf||a._opMdf||this._isFirstFrame)&&(et.coOp=s.o.v*a.opacity)},CVShapeElement.prototype.renderGradientFill=function(o,s,a){var et=s.style,tt;if(!et.grd||s.g._mdf||s.s._mdf||s.e._mdf||o.t!==1&&(s.h._mdf||s.a._mdf)){var rt=this.globalData.canvasContext,nt=s.s.v,it=s.e.v;if(o.t===1)tt=rt.createLinearGradient(nt[0],nt[1],it[0],it[1]);else{var st=Math.sqrt(Math.pow(nt[0]-it[0],2)+Math.pow(nt[1]-it[1],2)),ot=Math.atan2(it[1]-nt[1],it[0]-nt[0]),at=s.h.v;at>=1?at=.99:at<=-1&&(at=-.99);var lt=st*at,ct=Math.cos(ot+s.a.v)*lt+nt[0],ht=Math.sin(ot+s.a.v)*lt+nt[1];tt=rt.createRadialGradient(ct,ht,0,nt[0],nt[1],st)}var ft,dt=o.g.p,pt=s.g.c,gt=1;for(ft=0;ft<dt;ft+=1)s.g._hasOpacity&&s.g._collapsable&&(gt=s.g.o[ft*2+1]),tt.addColorStop(pt[ft*4]/100,"rgba("+pt[ft*4+1]+","+pt[ft*4+2]+","+pt[ft*4+3]+","+gt+")");et.grd=tt}et.coOp=s.o.v*a.opacity},CVShapeElement.prototype.renderStroke=function(o,s,a){var et=s.style,tt=s.d;tt&&(tt._mdf||this._isFirstFrame)&&(et.da=tt.dashArray,et.do=tt.dashoffset[0]),(s.c._mdf||this._isFirstFrame)&&(et.co="rgb("+bmFloor(s.c.v[0])+","+bmFloor(s.c.v[1])+","+bmFloor(s.c.v[2])+")"),(s.o._mdf||a._opMdf||this._isFirstFrame)&&(et.coOp=s.o.v*a.opacity),(s.w._mdf||this._isFirstFrame)&&(et.wi=s.w.v)},CVShapeElement.prototype.destroy=function(){this.shapesData=null,this.globalData=null,this.canvasContext=null,this.stylesList.length=0,this.itemsData.length=0};function CVTextElement(o,s,a){this.textSpans=[],this.yOffset=0,this.fillColorAnim=!1,this.strokeColorAnim=!1,this.strokeWidthAnim=!1,this.stroke=!1,this.fill=!1,this.justifyOffset=0,this.currentRender=null,this.renderType="canvas",this.values={fill:"rgba(0,0,0,0)",stroke:"rgba(0,0,0,0)",sWidth:0,fValue:""},this.initElement(o,s,a)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement,ITextElement],CVTextElement),CVTextElement.prototype.tHelper=createTag("canvas").getContext("2d"),CVTextElement.prototype.buildNewText=function(){var o=this.textProperty.currentData;this.renderedLetters=createSizedArray(o.l?o.l.length:0);var s=!1;o.fc?(s=!0,this.values.fill=this.buildColor(o.fc)):this.values.fill="rgba(0,0,0,0)",this.fill=s;var a=!1;o.sc&&(a=!0,this.values.stroke=this.buildColor(o.sc),this.values.sWidth=o.sw);var et=this.globalData.fontManager.getFontByName(o.f),tt,rt,nt=o.l,it=this.mHelper;this.stroke=a,this.values.fValue=o.finalSize+"px "+this.globalData.fontManager.getFontByName(o.f).fFamily,rt=o.finalText.length;var st,ot,at,lt,ct,ht,ft,dt,pt,gt,mt=this.data.singleShape,yt=o.tr*.001*o.finalSize,vt=0,Et=0,xt=!0,wt=0;for(tt=0;tt<rt;tt+=1){st=this.globalData.fontManager.getCharData(o.finalText[tt],et.fStyle,this.globalData.fontManager.getFontByName(o.f).fFamily),ot=st&&st.data||{},it.reset(),mt&&nt[tt].n&&(vt=-yt,Et+=o.yOffset,Et+=xt?1:0,xt=!1),ct=ot.shapes?ot.shapes[0].it:[],ft=ct.length,it.scale(o.finalSize/100,o.finalSize/100),mt&&this.applyTextPropertiesToMatrix(o,it,nt[tt].line,vt,Et),pt=createSizedArray(ft-1);var Rt=0;for(ht=0;ht<ft;ht+=1)if(ct[ht].ty==="sh"){for(lt=ct[ht].ks.k.i.length,dt=ct[ht].ks.k,gt=[],at=1;at<lt;at+=1)at===1&&gt.push(it.applyToX(dt.v[0][0],dt.v[0][1],0),it.applyToY(dt.v[0][0],dt.v[0][1],0)),gt.push(it.applyToX(dt.o[at-1][0],dt.o[at-1][1],0),it.applyToY(dt.o[at-1][0],dt.o[at-1][1],0),it.applyToX(dt.i[at][0],dt.i[at][1],0),it.applyToY(dt.i[at][0],dt.i[at][1],0),it.applyToX(dt.v[at][0],dt.v[at][1],0),it.applyToY(dt.v[at][0],dt.v[at][1],0));gt.push(it.applyToX(dt.o[at-1][0],dt.o[at-1][1],0),it.applyToY(dt.o[at-1][0],dt.o[at-1][1],0),it.applyToX(dt.i[0][0],dt.i[0][1],0),it.applyToY(dt.i[0][0],dt.i[0][1],0),it.applyToX(dt.v[0][0],dt.v[0][1],0),it.applyToY(dt.v[0][0],dt.v[0][1],0)),pt[Rt]=gt,Rt+=1}mt&&(vt+=nt[tt].l,vt+=yt),this.textSpans[wt]?this.textSpans[wt].elem=pt:this.textSpans[wt]={elem:pt},wt+=1}},CVTextElement.prototype.renderInnerContent=function(){this.validateText();var o=this.canvasContext;o.font=this.values.fValue,this.globalData.renderer.ctxLineCap("butt"),this.globalData.renderer.ctxLineJoin("miter"),this.globalData.renderer.ctxMiterLimit(4),this.data.singleShape||this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag);var s,a,et,tt,rt,nt,it=this.textAnimator.renderedLetters,st=this.textProperty.currentData.l;a=st.length;var ot,at=null,lt=null,ct=null,ht,ft,dt=this.globalData.renderer;for(s=0;s<a;s+=1)if(!st[s].n){if(ot=it[s],ot&&(dt.save(),dt.ctxTransform(ot.p),dt.ctxOpacity(ot.o)),this.fill){for(ot&&ot.fc?at!==ot.fc&&(dt.ctxFillStyle(ot.fc),at=ot.fc):at!==this.values.fill&&(at=this.values.fill,dt.ctxFillStyle(this.values.fill)),ht=this.textSpans[s].elem,tt=ht.length,this.globalData.canvasContext.beginPath(),et=0;et<tt;et+=1)for(ft=ht[et],nt=ft.length,this.globalData.canvasContext.moveTo(ft[0],ft[1]),rt=2;rt<nt;rt+=6)this.globalData.canvasContext.bezierCurveTo(ft[rt],ft[rt+1],ft[rt+2],ft[rt+3],ft[rt+4],ft[rt+5]);this.globalData.canvasContext.closePath(),dt.ctxFill()}if(this.stroke){for(ot&&ot.sw?ct!==ot.sw&&(ct=ot.sw,dt.ctxLineWidth(ot.sw)):ct!==this.values.sWidth&&(ct=this.values.sWidth,dt.ctxLineWidth(this.values.sWidth)),ot&&ot.sc?lt!==ot.sc&&(lt=ot.sc,dt.ctxStrokeStyle(ot.sc)):lt!==this.values.stroke&&(lt=this.values.stroke,dt.ctxStrokeStyle(this.values.stroke)),ht=this.textSpans[s].elem,tt=ht.length,this.globalData.canvasContext.beginPath(),et=0;et<tt;et+=1)for(ft=ht[et],nt=ft.length,this.globalData.canvasContext.moveTo(ft[0],ft[1]),rt=2;rt<nt;rt+=6)this.globalData.canvasContext.bezierCurveTo(ft[rt],ft[rt+1],ft[rt+2],ft[rt+3],ft[rt+4],ft[rt+5]);this.globalData.canvasContext.closePath(),dt.ctxStroke()}ot&&this.globalData.renderer.restore()}};function CVImageElement(o,s,a){this.assetData=s.getAssetData(o.refId),this.img=s.imageLoader.getAsset(this.assetData),this.initElement(o,s,a)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVImageElement),CVImageElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVImageElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVImageElement.prototype.createContent=function(){if(this.img.width&&(this.assetData.w!==this.img.width||this.assetData.h!==this.img.height)){var o=createTag("canvas");o.width=this.assetData.w,o.height=this.assetData.h;var s=o.getContext("2d"),a=this.img.width,et=this.img.height,tt=a/et,rt=this.assetData.w/this.assetData.h,nt,it,st=this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio;tt>rt&&st==="xMidYMid slice"||tt<rt&&st!=="xMidYMid slice"?(it=et,nt=it*rt):(nt=a,it=nt/rt),s.drawImage(this.img,(a-nt)/2,(et-it)/2,nt,it,0,0,this.assetData.w,this.assetData.h),this.img=o}},CVImageElement.prototype.renderInnerContent=function(){this.canvasContext.drawImage(this.img,0,0)},CVImageElement.prototype.destroy=function(){this.img=null};function CVSolidElement(o,s,a){this.initElement(o,s,a)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVSolidElement),CVSolidElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVSolidElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVSolidElement.prototype.renderInnerContent=function(){this.globalData.renderer.ctxFillStyle(this.data.sc),this.globalData.renderer.ctxFillRect(0,0,this.data.sw,this.data.sh)};function CanvasRendererBase(){}extendPrototype([BaseRenderer],CanvasRendererBase),CanvasRendererBase.prototype.createShape=function(o){return new CVShapeElement(o,this.globalData,this)},CanvasRendererBase.prototype.createText=function(o){return new CVTextElement(o,this.globalData,this)},CanvasRendererBase.prototype.createImage=function(o){return new CVImageElement(o,this.globalData,this)},CanvasRendererBase.prototype.createSolid=function(o){return new CVSolidElement(o,this.globalData,this)},CanvasRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,CanvasRendererBase.prototype.ctxTransform=function(o){o[0]===1&&o[1]===0&&o[4]===0&&o[5]===1&&o[12]===0&&o[13]===0||this.canvasContext.transform(o[0],o[1],o[4],o[5],o[12],o[13])},CanvasRendererBase.prototype.ctxOpacity=function(o){this.canvasContext.globalAlpha*=o<0?0:o},CanvasRendererBase.prototype.ctxFillStyle=function(o){this.canvasContext.fillStyle=o},CanvasRendererBase.prototype.ctxStrokeStyle=function(o){this.canvasContext.strokeStyle=o},CanvasRendererBase.prototype.ctxLineWidth=function(o){this.canvasContext.lineWidth=o},CanvasRendererBase.prototype.ctxLineCap=function(o){this.canvasContext.lineCap=o},CanvasRendererBase.prototype.ctxLineJoin=function(o){this.canvasContext.lineJoin=o},CanvasRendererBase.prototype.ctxMiterLimit=function(o){this.canvasContext.miterLimit=o},CanvasRendererBase.prototype.ctxFill=function(o){this.canvasContext.fill(o)},CanvasRendererBase.prototype.ctxFillRect=function(o,s,a,et){this.canvasContext.fillRect(o,s,a,et)},CanvasRendererBase.prototype.ctxStroke=function(){this.canvasContext.stroke()},CanvasRendererBase.prototype.reset=function(){if(!this.renderConfig.clearCanvas){this.canvasContext.restore();return}this.contextData.reset()},CanvasRendererBase.prototype.save=function(){this.canvasContext.save()},CanvasRendererBase.prototype.restore=function(o){if(!this.renderConfig.clearCanvas){this.canvasContext.restore();return}o&&(this.globalData.blendMode="source-over"),this.contextData.restore(o)},CanvasRendererBase.prototype.configAnimation=function(o){if(this.animationItem.wrapper){this.animationItem.container=createTag("canvas");var s=this.animationItem.container.style;s.width="100%",s.height="100%";var a="0px 0px 0px";s.transformOrigin=a,s.mozTransformOrigin=a,s.webkitTransformOrigin=a,s["-webkit-transform"]=a,s.contentVisibility=this.renderConfig.contentVisibility,this.animationItem.wrapper.appendChild(this.animationItem.container),this.canvasContext=this.animationItem.container.getContext("2d"),this.renderConfig.className&&this.animationItem.container.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.animationItem.container.setAttribute("id",this.renderConfig.id)}else this.canvasContext=this.renderConfig.context;this.contextData.setContext(this.canvasContext),this.data=o,this.layers=o.layers,this.transformCanvas={w:o.w,h:o.h,sx:0,sy:0,tx:0,ty:0},this.setupGlobalData(o,document.body),this.globalData.canvasContext=this.canvasContext,this.globalData.renderer=this,this.globalData.isDashed=!1,this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.globalData.transformCanvas=this.transformCanvas,this.elements=createSizedArray(o.layers.length),this.updateContainerSize()},CanvasRendererBase.prototype.updateContainerSize=function(o,s){this.reset();var a,et;o?(a=o,et=s,this.canvasContext.canvas.width=a,this.canvasContext.canvas.height=et):(this.animationItem.wrapper&&this.animationItem.container?(a=this.animationItem.wrapper.offsetWidth,et=this.animationItem.wrapper.offsetHeight):(a=this.canvasContext.canvas.width,et=this.canvasContext.canvas.height),this.canvasContext.canvas.width=a*this.renderConfig.dpr,this.canvasContext.canvas.height=et*this.renderConfig.dpr);var tt,rt;if(this.renderConfig.preserveAspectRatio.indexOf("meet")!==-1||this.renderConfig.preserveAspectRatio.indexOf("slice")!==-1){var nt=this.renderConfig.preserveAspectRatio.split(" "),it=nt[1]||"meet",st=nt[0]||"xMidYMid",ot=st.substr(0,4),at=st.substr(4);tt=a/et,rt=this.transformCanvas.w/this.transformCanvas.h,rt>tt&&it==="meet"||rt<tt&&it==="slice"?(this.transformCanvas.sx=a/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=a/(this.transformCanvas.w/this.renderConfig.dpr)):(this.transformCanvas.sx=et/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.sy=et/(this.transformCanvas.h/this.renderConfig.dpr)),ot==="xMid"&&(rt<tt&&it==="meet"||rt>tt&&it==="slice")?this.transformCanvas.tx=(a-this.transformCanvas.w*(et/this.transformCanvas.h))/2*this.renderConfig.dpr:ot==="xMax"&&(rt<tt&&it==="meet"||rt>tt&&it==="slice")?this.transformCanvas.tx=(a-this.transformCanvas.w*(et/this.transformCanvas.h))*this.renderConfig.dpr:this.transformCanvas.tx=0,at==="YMid"&&(rt>tt&&it==="meet"||rt<tt&&it==="slice")?this.transformCanvas.ty=(et-this.transformCanvas.h*(a/this.transformCanvas.w))/2*this.renderConfig.dpr:at==="YMax"&&(rt>tt&&it==="meet"||rt<tt&&it==="slice")?this.transformCanvas.ty=(et-this.transformCanvas.h*(a/this.transformCanvas.w))*this.renderConfig.dpr:this.transformCanvas.ty=0}else this.renderConfig.preserveAspectRatio==="none"?(this.transformCanvas.sx=a/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=et/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.tx=0,this.transformCanvas.ty=0):(this.transformCanvas.sx=this.renderConfig.dpr,this.transformCanvas.sy=this.renderConfig.dpr,this.transformCanvas.tx=0,this.transformCanvas.ty=0);this.transformCanvas.props=[this.transformCanvas.sx,0,0,0,0,this.transformCanvas.sy,0,0,0,0,1,0,this.transformCanvas.tx,this.transformCanvas.ty,0,1],this.ctxTransform(this.transformCanvas.props),this.canvasContext.beginPath(),this.canvasContext.rect(0,0,this.transformCanvas.w,this.transformCanvas.h),this.canvasContext.closePath(),this.canvasContext.clip(),this.renderFrame(this.renderedFrame,!0)},CanvasRendererBase.prototype.destroy=function(){this.renderConfig.clearCanvas&&this.animationItem.wrapper&&(this.animationItem.wrapper.innerText="");var o,s=this.layers?this.layers.length:0;for(o=s-1;o>=0;o-=1)this.elements[o]&&this.elements[o].destroy&&this.elements[o].destroy();this.elements.length=0,this.globalData.canvasContext=null,this.animationItem.container=null,this.destroyed=!0},CanvasRendererBase.prototype.renderFrame=function(o,s){if(!(this.renderedFrame===o&&this.renderConfig.clearCanvas===!0&&!s||this.destroyed||o===-1)){this.renderedFrame=o,this.globalData.frameNum=o-this.animationItem._isFirstFrame,this.globalData.frameId+=1,this.globalData._mdf=!this.renderConfig.clearCanvas||s,this.globalData.projectInterface.currentFrame=o;var a,et=this.layers.length;for(this.completeLayers||this.checkLayers(o),a=et-1;a>=0;a-=1)(this.completeLayers||this.elements[a])&&this.elements[a].prepareFrame(o-this.layers[a].st);if(this.globalData._mdf){for(this.renderConfig.clearCanvas===!0?this.canvasContext.clearRect(0,0,this.transformCanvas.w,this.transformCanvas.h):this.save(),a=et-1;a>=0;a-=1)(this.completeLayers||this.elements[a])&&this.elements[a].renderFrame();this.renderConfig.clearCanvas!==!0&&this.restore()}}},CanvasRendererBase.prototype.buildItem=function(o){var s=this.elements;if(!(s[o]||this.layers[o].ty===99)){var a=this.createItem(this.layers[o],this,this.globalData);s[o]=a,a.initExpressions()}},CanvasRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var o=this.pendingElements.pop();o.checkParenting()}},CanvasRendererBase.prototype.hide=function(){this.animationItem.container.style.display="none"},CanvasRendererBase.prototype.show=function(){this.animationItem.container.style.display="block"};function CanvasContext(){this.opacity=-1,this.transform=createTypedArray("float32",16),this.fillStyle="",this.strokeStyle="",this.lineWidth="",this.lineCap="",this.lineJoin="",this.miterLimit="",this.id=Math.random()}function CVContextData(){this.stack=[],this.cArrPos=0,this.cTr=new Matrix;var o,s=15;for(o=0;o<s;o+=1){var a=new CanvasContext;this.stack[o]=a}this._length=s,this.nativeContext=null,this.transformMat=new Matrix,this.currentOpacity=1,this.currentFillStyle="",this.appliedFillStyle="",this.currentStrokeStyle="",this.appliedStrokeStyle="",this.currentLineWidth="",this.appliedLineWidth="",this.currentLineCap="",this.appliedLineCap="",this.currentLineJoin="",this.appliedLineJoin="",this.appliedMiterLimit="",this.currentMiterLimit=""}CVContextData.prototype.duplicate=function(){var o=this._length*2,s=0;for(s=this._length;s<o;s+=1)this.stack[s]=new CanvasContext;this._length=o},CVContextData.prototype.reset=function(){this.cArrPos=0,this.cTr.reset(),this.stack[this.cArrPos].opacity=1},CVContextData.prototype.restore=function(o){this.cArrPos-=1;var s=this.stack[this.cArrPos],a=s.transform,et,tt=this.cTr.props;for(et=0;et<16;et+=1)tt[et]=a[et];if(o){this.nativeContext.restore();var rt=this.stack[this.cArrPos+1];this.appliedFillStyle=rt.fillStyle,this.appliedStrokeStyle=rt.strokeStyle,this.appliedLineWidth=rt.lineWidth,this.appliedLineCap=rt.lineCap,this.appliedLineJoin=rt.lineJoin,this.appliedMiterLimit=rt.miterLimit}this.nativeContext.setTransform(a[0],a[1],a[4],a[5],a[12],a[13]),(o||s.opacity!==-1&&this.currentOpacity!==s.opacity)&&(this.nativeContext.globalAlpha=s.opacity,this.currentOpacity=s.opacity),this.currentFillStyle=s.fillStyle,this.currentStrokeStyle=s.strokeStyle,this.currentLineWidth=s.lineWidth,this.currentLineCap=s.lineCap,this.currentLineJoin=s.lineJoin,this.currentMiterLimit=s.miterLimit},CVContextData.prototype.save=function(o){o&&this.nativeContext.save();var s=this.cTr.props;this._length<=this.cArrPos&&this.duplicate();var a=this.stack[this.cArrPos],et;for(et=0;et<16;et+=1)a.transform[et]=s[et];this.cArrPos+=1;var tt=this.stack[this.cArrPos];tt.opacity=a.opacity,tt.fillStyle=a.fillStyle,tt.strokeStyle=a.strokeStyle,tt.lineWidth=a.lineWidth,tt.lineCap=a.lineCap,tt.lineJoin=a.lineJoin,tt.miterLimit=a.miterLimit},CVContextData.prototype.setOpacity=function(o){this.stack[this.cArrPos].opacity=o},CVContextData.prototype.setContext=function(o){this.nativeContext=o},CVContextData.prototype.fillStyle=function(o){this.stack[this.cArrPos].fillStyle!==o&&(this.currentFillStyle=o,this.stack[this.cArrPos].fillStyle=o)},CVContextData.prototype.strokeStyle=function(o){this.stack[this.cArrPos].strokeStyle!==o&&(this.currentStrokeStyle=o,this.stack[this.cArrPos].strokeStyle=o)},CVContextData.prototype.lineWidth=function(o){this.stack[this.cArrPos].lineWidth!==o&&(this.currentLineWidth=o,this.stack[this.cArrPos].lineWidth=o)},CVContextData.prototype.lineCap=function(o){this.stack[this.cArrPos].lineCap!==o&&(this.currentLineCap=o,this.stack[this.cArrPos].lineCap=o)},CVContextData.prototype.lineJoin=function(o){this.stack[this.cArrPos].lineJoin!==o&&(this.currentLineJoin=o,this.stack[this.cArrPos].lineJoin=o)},CVContextData.prototype.miterLimit=function(o){this.stack[this.cArrPos].miterLimit!==o&&(this.currentMiterLimit=o,this.stack[this.cArrPos].miterLimit=o)},CVContextData.prototype.transform=function(o){this.transformMat.cloneFromProps(o);var s=this.cTr;this.transformMat.multiply(s),s.cloneFromProps(this.transformMat.props);var a=s.props;this.nativeContext.setTransform(a[0],a[1],a[4],a[5],a[12],a[13])},CVContextData.prototype.opacity=function(o){var s=this.stack[this.cArrPos].opacity;s*=o<0?0:o,this.stack[this.cArrPos].opacity!==s&&(this.currentOpacity!==o&&(this.nativeContext.globalAlpha=o,this.currentOpacity=o),this.stack[this.cArrPos].opacity=s)},CVContextData.prototype.fill=function(o){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fill(o)},CVContextData.prototype.fillRect=function(o,s,a,et){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fillRect(o,s,a,et)},CVContextData.prototype.stroke=function(){this.appliedStrokeStyle!==this.currentStrokeStyle&&(this.appliedStrokeStyle=this.currentStrokeStyle,this.nativeContext.strokeStyle=this.appliedStrokeStyle),this.appliedLineWidth!==this.currentLineWidth&&(this.appliedLineWidth=this.currentLineWidth,this.nativeContext.lineWidth=this.appliedLineWidth),this.appliedLineCap!==this.currentLineCap&&(this.appliedLineCap=this.currentLineCap,this.nativeContext.lineCap=this.appliedLineCap),this.appliedLineJoin!==this.currentLineJoin&&(this.appliedLineJoin=this.currentLineJoin,this.nativeContext.lineJoin=this.appliedLineJoin),this.appliedMiterLimit!==this.currentMiterLimit&&(this.appliedMiterLimit=this.currentMiterLimit,this.nativeContext.miterLimit=this.appliedMiterLimit),this.nativeContext.stroke()};function CVCompElement(o,s,a){this.completeLayers=!1,this.layers=o.layers,this.pendingElements=[],this.elements=createSizedArray(this.layers.length),this.initElement(o,s,a),this.tm=o.tm?PropertyFactory.getProp(this,o.tm,0,s.frameRate,this):{_placeholder:!0}}extendPrototype([CanvasRendererBase,ICompElement,CVBaseElement],CVCompElement),CVCompElement.prototype.renderInnerContent=function(){var o=this.canvasContext;o.beginPath(),o.moveTo(0,0),o.lineTo(this.data.w,0),o.lineTo(this.data.w,this.data.h),o.lineTo(0,this.data.h),o.lineTo(0,0),o.clip();var s,a=this.layers.length;for(s=a-1;s>=0;s-=1)(this.completeLayers||this.elements[s])&&this.elements[s].renderFrame()},CVCompElement.prototype.destroy=function(){var o,s=this.layers.length;for(o=s-1;o>=0;o-=1)this.elements[o]&&this.elements[o].destroy();this.layers=null,this.elements=null},CVCompElement.prototype.createComp=function(o){return new CVCompElement(o,this.globalData,this)};function CanvasRenderer(o,s){this.animationItem=o,this.renderConfig={clearCanvas:s&&s.clearCanvas!==void 0?s.clearCanvas:!0,context:s&&s.context||null,progressiveLoad:s&&s.progressiveLoad||!1,preserveAspectRatio:s&&s.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:s&&s.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:s&&s.contentVisibility||"visible",className:s&&s.className||"",id:s&&s.id||"",runExpressions:!s||s.runExpressions===void 0||s.runExpressions},this.renderConfig.dpr=s&&s.dpr||1,this.animationItem.wrapper&&(this.renderConfig.dpr=s&&s.dpr||window.devicePixelRatio||1),this.renderedFrame=-1,this.globalData={frameNum:-1,_mdf:!1,renderConfig:this.renderConfig,currentGlobalAlpha:-1},this.contextData=new CVContextData,this.elements=[],this.pendingElements=[],this.transformMat=new Matrix,this.completeLayers=!1,this.rendererType="canvas",this.renderConfig.clearCanvas&&(this.ctxTransform=this.contextData.transform.bind(this.contextData),this.ctxOpacity=this.contextData.opacity.bind(this.contextData),this.ctxFillStyle=this.contextData.fillStyle.bind(this.contextData),this.ctxStrokeStyle=this.contextData.strokeStyle.bind(this.contextData),this.ctxLineWidth=this.contextData.lineWidth.bind(this.contextData),this.ctxLineCap=this.contextData.lineCap.bind(this.contextData),this.ctxLineJoin=this.contextData.lineJoin.bind(this.contextData),this.ctxMiterLimit=this.contextData.miterLimit.bind(this.contextData),this.ctxFill=this.contextData.fill.bind(this.contextData),this.ctxFillRect=this.contextData.fillRect.bind(this.contextData),this.ctxStroke=this.contextData.stroke.bind(this.contextData),this.save=this.contextData.save.bind(this.contextData))}extendPrototype([CanvasRendererBase],CanvasRenderer),CanvasRenderer.prototype.createComp=function(o){return new CVCompElement(o,this.globalData,this)};function HBaseElement(){}HBaseElement.prototype={checkBlendMode:function(){},initRendererElement:function(){this.baseElement=createTag(this.data.tg||"div"),this.data.hasMask?(this.svgElement=createNS("svg"),this.layerElement=createNS("g"),this.maskedElement=this.layerElement,this.svgElement.appendChild(this.layerElement),this.baseElement.appendChild(this.svgElement)):this.layerElement=this.baseElement,styleDiv(this.baseElement)},createContainerElements:function(){this.renderableEffectsManager=new CVEffects(this),this.transformedElement=this.baseElement,this.maskedElement=this.layerElement,this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),this.data.bm!==0&&this.setBlendMode()},renderElement:function(){var s=this.transformedElement?this.transformedElement.style:{};if(this.finalTransform._matMdf){var a=this.finalTransform.mat.toCSS();s.transform=a,s.webkitTransform=a}this.finalTransform._opMdf&&(s.opacity=this.finalTransform.mProp.o.v)},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},destroy:function(){this.layerElement=null,this.transformedElement=null,this.matteElement&&(this.matteElement=null),this.maskManager&&(this.maskManager.destroy(),this.maskManager=null)},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData)},addEffects:function(){},setMatte:function(){}},HBaseElement.prototype.getBaseElement=SVGBaseElement.prototype.getBaseElement,HBaseElement.prototype.destroyBaseElement=HBaseElement.prototype.destroy,HBaseElement.prototype.buildElementParenting=BaseRenderer.prototype.buildElementParenting;function HSolidElement(o,s,a){this.initElement(o,s,a)}extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],HSolidElement),HSolidElement.prototype.createContent=function(){var o;this.data.hasMask?(o=createNS("rect"),o.setAttribute("width",this.data.sw),o.setAttribute("height",this.data.sh),o.setAttribute("fill",this.data.sc),this.svgElement.setAttribute("width",this.data.sw),this.svgElement.setAttribute("height",this.data.sh)):(o=createTag("div"),o.style.width=this.data.sw+"px",o.style.height=this.data.sh+"px",o.style.backgroundColor=this.data.sc),this.layerElement.appendChild(o)};function HShapeElement(o,s,a){this.shapes=[],this.shapesData=o.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.shapesContainer=createNS("g"),this.initElement(o,s,a),this.prevViewData=[],this.currentBBox={x:999999,y:-999999,h:0,w:0}}extendPrototype([BaseElement,TransformElement,HSolidElement,SVGShapeElement,HBaseElement,HierarchyElement,FrameElement,RenderableElement],HShapeElement),HShapeElement.prototype._renderShapeFrame=HShapeElement.prototype.renderInnerContent,HShapeElement.prototype.createContent=function(){var o;if(this.baseElement.style.fontSize=0,this.data.hasMask)this.layerElement.appendChild(this.shapesContainer),o=this.svgElement;else{o=createNS("svg");var s=this.comp.data?this.comp.data:this.globalData.compSize;o.setAttribute("width",s.w),o.setAttribute("height",s.h),o.appendChild(this.shapesContainer),this.layerElement.appendChild(o)}this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.shapesContainer,0,[],!0),this.filterUniqueShapes(),this.shapeCont=o},HShapeElement.prototype.getTransformedPoint=function(o,s){var a,et=o.length;for(a=0;a<et;a+=1)s=o[a].mProps.v.applyToPointArray(s[0],s[1],0);return s},HShapeElement.prototype.calculateShapeBoundingBox=function(o,s){var a=o.sh.v,et=o.transformers,tt,rt=a._length,nt,it,st,ot;if(!(rt<=1)){for(tt=0;tt<rt-1;tt+=1)nt=this.getTransformedPoint(et,a.v[tt]),it=this.getTransformedPoint(et,a.o[tt]),st=this.getTransformedPoint(et,a.i[tt+1]),ot=this.getTransformedPoint(et,a.v[tt+1]),this.checkBounds(nt,it,st,ot,s);a.c&&(nt=this.getTransformedPoint(et,a.v[tt]),it=this.getTransformedPoint(et,a.o[tt]),st=this.getTransformedPoint(et,a.i[0]),ot=this.getTransformedPoint(et,a.v[0]),this.checkBounds(nt,it,st,ot,s))}},HShapeElement.prototype.checkBounds=function(o,s,a,et,tt){this.getBoundsOfCurve(o,s,a,et);var rt=this.shapeBoundingBox;tt.x=bmMin(rt.left,tt.x),tt.xMax=bmMax(rt.right,tt.xMax),tt.y=bmMin(rt.top,tt.y),tt.yMax=bmMax(rt.bottom,tt.yMax)},HShapeElement.prototype.shapeBoundingBox={left:0,right:0,top:0,bottom:0},HShapeElement.prototype.tempBoundingBox={x:0,xMax:0,y:0,yMax:0,width:0,height:0},HShapeElement.prototype.getBoundsOfCurve=function(o,s,a,et){for(var tt=[[o[0],et[0]],[o[1],et[1]]],rt,nt,it,st,ot,at,lt,ct=0;ct<2;++ct)nt=6*o[ct]-12*s[ct]+6*a[ct],rt=-3*o[ct]+9*s[ct]-9*a[ct]+3*et[ct],it=3*s[ct]-3*o[ct],nt|=0,rt|=0,it|=0,rt===0&&nt===0||(rt===0?(st=-it/nt,st>0&&st<1&&tt[ct].push(this.calculateF(st,o,s,a,et,ct))):(ot=nt*nt-4*it*rt,ot>=0&&(at=(-nt+bmSqrt(ot))/(2*rt),at>0&&at<1&&tt[ct].push(this.calculateF(at,o,s,a,et,ct)),lt=(-nt-bmSqrt(ot))/(2*rt),lt>0&&lt<1&&tt[ct].push(this.calculateF(lt,o,s,a,et,ct)))));this.shapeBoundingBox.left=bmMin.apply(null,tt[0]),this.shapeBoundingBox.top=bmMin.apply(null,tt[1]),this.shapeBoundingBox.right=bmMax.apply(null,tt[0]),this.shapeBoundingBox.bottom=bmMax.apply(null,tt[1])},HShapeElement.prototype.calculateF=function(o,s,a,et,tt,rt){return bmPow(1-o,3)*s[rt]+3*bmPow(1-o,2)*o*a[rt]+3*(1-o)*bmPow(o,2)*et[rt]+bmPow(o,3)*tt[rt]},HShapeElement.prototype.calculateBoundingBox=function(o,s){var a,et=o.length;for(a=0;a<et;a+=1)o[a]&&o[a].sh?this.calculateShapeBoundingBox(o[a],s):o[a]&&o[a].it?this.calculateBoundingBox(o[a].it,s):o[a]&&o[a].style&&o[a].w&&this.expandStrokeBoundingBox(o[a].w,s)},HShapeElement.prototype.expandStrokeBoundingBox=function(o,s){var a=0;if(o.keyframes){for(var et=0;et<o.keyframes.length;et+=1){var tt=o.keyframes[et].s;tt>a&&(a=tt)}a*=o.mult}else a=o.v*o.mult;s.x-=a,s.xMax+=a,s.y-=a,s.yMax+=a},HShapeElement.prototype.currentBoxContains=function(o){return this.currentBBox.x<=o.x&&this.currentBBox.y<=o.y&&this.currentBBox.width+this.currentBBox.x>=o.x+o.width&&this.currentBBox.height+this.currentBBox.y>=o.y+o.height},HShapeElement.prototype.renderInnerContent=function(){if(this._renderShapeFrame(),!this.hidden&&(this._isFirstFrame||this._mdf)){var o=this.tempBoundingBox,s=999999;if(o.x=s,o.xMax=-s,o.y=s,o.yMax=-s,this.calculateBoundingBox(this.itemsData,o),o.width=o.xMax<o.x?0:o.xMax-o.x,o.height=o.yMax<o.y?0:o.yMax-o.y,this.currentBoxContains(o))return;var a=!1;if(this.currentBBox.w!==o.width&&(this.currentBBox.w=o.width,this.shapeCont.setAttribute("width",o.width),a=!0),this.currentBBox.h!==o.height&&(this.currentBBox.h=o.height,this.shapeCont.setAttribute("height",o.height),a=!0),a||this.currentBBox.x!==o.x||this.currentBBox.y!==o.y){this.currentBBox.w=o.width,this.currentBBox.h=o.height,this.currentBBox.x=o.x,this.currentBBox.y=o.y,this.shapeCont.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h);var et=this.shapeCont.style,tt="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";et.transform=tt,et.webkitTransform=tt}}};function HTextElement(o,s,a){this.textSpans=[],this.textPaths=[],this.currentBBox={x:999999,y:-999999,h:0,w:0},this.renderType="svg",this.isMasked=!1,this.initElement(o,s,a)}extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],HTextElement),HTextElement.prototype.createContent=function(){if(this.isMasked=this.checkMasks(),this.isMasked){this.renderType="svg",this.compW=this.comp.data.w,this.compH=this.comp.data.h,this.svgElement.setAttribute("width",this.compW),this.svgElement.setAttribute("height",this.compH);var o=createNS("g");this.maskedElement.appendChild(o),this.innerElem=o}else this.renderType="html",this.innerElem=this.layerElement;this.checkParenting()},HTextElement.prototype.buildNewText=function(){var o=this.textProperty.currentData;this.renderedLetters=createSizedArray(o.l?o.l.length:0);var s=this.innerElem.style,a=o.fc?this.buildColor(o.fc):"rgba(0,0,0,0)";s.fill=a,s.color=a,o.sc&&(s.stroke=this.buildColor(o.sc),s.strokeWidth=o.sw+"px");var et=this.globalData.fontManager.getFontByName(o.f);if(!this.globalData.fontManager.chars)if(s.fontSize=o.finalSize+"px",s.lineHeight=o.finalSize+"px",et.fClass)this.innerElem.className=et.fClass;else{s.fontFamily=et.fFamily;var tt=o.fWeight,rt=o.fStyle;s.fontStyle=rt,s.fontWeight=tt}var nt,it,st=o.l;it=st.length;var ot,at,lt,ct=this.mHelper,ht,ft="",dt=0;for(nt=0;nt<it;nt+=1){if(this.globalData.fontManager.chars?(this.textPaths[dt]?ot=this.textPaths[dt]:(ot=createNS("path"),ot.setAttribute("stroke-linecap",lineCapEnum[1]),ot.setAttribute("stroke-linejoin",lineJoinEnum[2]),ot.setAttribute("stroke-miterlimit","4")),this.isMasked||(this.textSpans[dt]?(at=this.textSpans[dt],lt=at.children[0]):(at=createTag("div"),at.style.lineHeight=0,lt=createNS("svg"),lt.appendChild(ot),styleDiv(at)))):this.isMasked?ot=this.textPaths[dt]?this.textPaths[dt]:createNS("text"):this.textSpans[dt]?(at=this.textSpans[dt],ot=this.textPaths[dt]):(at=createTag("span"),styleDiv(at),ot=createTag("span"),styleDiv(ot),at.appendChild(ot)),this.globalData.fontManager.chars){var pt=this.globalData.fontManager.getCharData(o.finalText[nt],et.fStyle,this.globalData.fontManager.getFontByName(o.f).fFamily),gt;if(pt?gt=pt.data:gt=null,ct.reset(),gt&&gt.shapes&&gt.shapes.length&&(ht=gt.shapes[0].it,ct.scale(o.finalSize/100,o.finalSize/100),ft=this.createPathShape(ct,ht),ot.setAttribute("d",ft)),this.isMasked)this.innerElem.appendChild(ot);else{if(this.innerElem.appendChild(at),gt&&gt.shapes){document.body.appendChild(lt);var mt=lt.getBBox();lt.setAttribute("width",mt.width+2),lt.setAttribute("height",mt.height+2),lt.setAttribute("viewBox",mt.x-1+" "+(mt.y-1)+" "+(mt.width+2)+" "+(mt.height+2));var yt=lt.style,vt="translate("+(mt.x-1)+"px,"+(mt.y-1)+"px)";yt.transform=vt,yt.webkitTransform=vt,st[nt].yOffset=mt.y-1}else lt.setAttribute("width",1),lt.setAttribute("height",1);at.appendChild(lt)}}else if(ot.textContent=st[nt].val,ot.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),this.isMasked)this.innerElem.appendChild(ot);else{this.innerElem.appendChild(at);var Et=ot.style,xt="translate3d(0,"+-o.finalSize/1.2+"px,0)";Et.transform=xt,Et.webkitTransform=xt}this.isMasked?this.textSpans[dt]=ot:this.textSpans[dt]=at,this.textSpans[dt].style.display="block",this.textPaths[dt]=ot,dt+=1}for(;dt<this.textSpans.length;)this.textSpans[dt].style.display="none",dt+=1},HTextElement.prototype.renderInnerContent=function(){this.validateText();var o;if(this.data.singleShape){if(!this._isFirstFrame&&!this.lettersChangedFlag)return;if(this.isMasked&&this.finalTransform._matMdf){this.svgElement.setAttribute("viewBox",-this.finalTransform.mProp.p.v[0]+" "+-this.finalTransform.mProp.p.v[1]+" "+this.compW+" "+this.compH),o=this.svgElement.style;var s="translate("+-this.finalTransform.mProp.p.v[0]+"px,"+-this.finalTransform.mProp.p.v[1]+"px)";o.transform=s,o.webkitTransform=s}}if(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),!(!this.lettersChangedFlag&&!this.textAnimator.lettersChangedFlag)){var a,et,tt=0,rt=this.textAnimator.renderedLetters,nt=this.textProperty.currentData.l;et=nt.length;var it,st,ot;for(a=0;a<et;a+=1)nt[a].n?tt+=1:(st=this.textSpans[a],ot=this.textPaths[a],it=rt[tt],tt+=1,it._mdf.m&&(this.isMasked?st.setAttribute("transform",it.m):(st.style.webkitTransform=it.m,st.style.transform=it.m)),st.style.opacity=it.o,it.sw&&it._mdf.sw&&ot.setAttribute("stroke-width",it.sw),it.sc&&it._mdf.sc&&ot.setAttribute("stroke",it.sc),it.fc&&it._mdf.fc&&(ot.setAttribute("fill",it.fc),ot.style.color=it.fc));if(this.innerElem.getBBox&&!this.hidden&&(this._isFirstFrame||this._mdf)){var at=this.innerElem.getBBox();this.currentBBox.w!==at.width&&(this.currentBBox.w=at.width,this.svgElement.setAttribute("width",at.width)),this.currentBBox.h!==at.height&&(this.currentBBox.h=at.height,this.svgElement.setAttribute("height",at.height));var lt=1;if(this.currentBBox.w!==at.width+lt*2||this.currentBBox.h!==at.height+lt*2||this.currentBBox.x!==at.x-lt||this.currentBBox.y!==at.y-lt){this.currentBBox.w=at.width+lt*2,this.currentBBox.h=at.height+lt*2,this.currentBBox.x=at.x-lt,this.currentBBox.y=at.y-lt,this.svgElement.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h),o=this.svgElement.style;var ct="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";o.transform=ct,o.webkitTransform=ct}}}};function HCameraElement(o,s,a){this.initFrame(),this.initBaseData(o,s,a),this.initHierarchy();var et=PropertyFactory.getProp;if(this.pe=et(this,o.pe,0,0,this),o.ks.p.s?(this.px=et(this,o.ks.p.x,1,0,this),this.py=et(this,o.ks.p.y,1,0,this),this.pz=et(this,o.ks.p.z,1,0,this)):this.p=et(this,o.ks.p,1,0,this),o.ks.a&&(this.a=et(this,o.ks.a,1,0,this)),o.ks.or.k.length&&o.ks.or.k[0].to){var tt,rt=o.ks.or.k.length;for(tt=0;tt<rt;tt+=1)o.ks.or.k[tt].to=null,o.ks.or.k[tt].ti=null}this.or=et(this,o.ks.or,1,degToRads,this),this.or.sh=!0,this.rx=et(this,o.ks.rx,0,degToRads,this),this.ry=et(this,o.ks.ry,0,degToRads,this),this.rz=et(this,o.ks.rz,0,degToRads,this),this.mat=new Matrix,this._prevMat=new Matrix,this._isFirstFrame=!0,this.finalTransform={mProp:this}}extendPrototype([BaseElement,FrameElement,HierarchyElement],HCameraElement),HCameraElement.prototype.setup=function(){var o,s=this.comp.threeDElements.length,a,et,tt;for(o=0;o<s;o+=1)if(a=this.comp.threeDElements[o],a.type==="3d"){et=a.perspectiveElem.style,tt=a.container.style;var rt=this.pe.v+"px",nt="0px 0px 0px",it="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";et.perspective=rt,et.webkitPerspective=rt,tt.transformOrigin=nt,tt.mozTransformOrigin=nt,tt.webkitTransformOrigin=nt,et.transform=it,et.webkitTransform=it}},HCameraElement.prototype.createElements=function(){},HCameraElement.prototype.hide=function(){},HCameraElement.prototype.renderFrame=function(){var o=this._isFirstFrame,s,a;if(this.hierarchy)for(a=this.hierarchy.length,s=0;s<a;s+=1)o=this.hierarchy[s].finalTransform.mProp._mdf||o;if(o||this.pe._mdf||this.p&&this.p._mdf||this.px&&(this.px._mdf||this.py._mdf||this.pz._mdf)||this.rx._mdf||this.ry._mdf||this.rz._mdf||this.or._mdf||this.a&&this.a._mdf){if(this.mat.reset(),this.hierarchy)for(a=this.hierarchy.length-1,s=a;s>=0;s-=1){var et=this.hierarchy[s].finalTransform.mProp;this.mat.translate(-et.p.v[0],-et.p.v[1],et.p.v[2]),this.mat.rotateX(-et.or.v[0]).rotateY(-et.or.v[1]).rotateZ(et.or.v[2]),this.mat.rotateX(-et.rx.v).rotateY(-et.ry.v).rotateZ(et.rz.v),this.mat.scale(1/et.s.v[0],1/et.s.v[1],1/et.s.v[2]),this.mat.translate(et.a.v[0],et.a.v[1],et.a.v[2])}if(this.p?this.mat.translate(-this.p.v[0],-this.p.v[1],this.p.v[2]):this.mat.translate(-this.px.v,-this.py.v,this.pz.v),this.a){var tt;this.p?tt=[this.p.v[0]-this.a.v[0],this.p.v[1]-this.a.v[1],this.p.v[2]-this.a.v[2]]:tt=[this.px.v-this.a.v[0],this.py.v-this.a.v[1],this.pz.v-this.a.v[2]];var rt=Math.sqrt(Math.pow(tt[0],2)+Math.pow(tt[1],2)+Math.pow(tt[2],2)),nt=[tt[0]/rt,tt[1]/rt,tt[2]/rt],it=Math.sqrt(nt[2]*nt[2]+nt[0]*nt[0]),st=Math.atan2(nt[1],it),ot=Math.atan2(nt[0],-nt[2]);this.mat.rotateY(ot).rotateX(-st)}this.mat.rotateX(-this.rx.v).rotateY(-this.ry.v).rotateZ(this.rz.v),this.mat.rotateX(-this.or.v[0]).rotateY(-this.or.v[1]).rotateZ(this.or.v[2]),this.mat.translate(this.globalData.compSize.w/2,this.globalData.compSize.h/2,0),this.mat.translate(0,0,this.pe.v);var at=!this._prevMat.equals(this.mat);if((at||this.pe._mdf)&&this.comp.threeDElements){a=this.comp.threeDElements.length;var lt,ct,ht;for(s=0;s<a;s+=1)if(lt=this.comp.threeDElements[s],lt.type==="3d"){if(at){var ft=this.mat.toCSS();ht=lt.container.style,ht.transform=ft,ht.webkitTransform=ft}this.pe._mdf&&(ct=lt.perspectiveElem.style,ct.perspective=this.pe.v+"px",ct.webkitPerspective=this.pe.v+"px")}this.mat.clone(this._prevMat)}}this._isFirstFrame=!1},HCameraElement.prototype.prepareFrame=function(o){this.prepareProperties(o,!0)},HCameraElement.prototype.destroy=function(){},HCameraElement.prototype.getBaseElement=function(){return null};function HImageElement(o,s,a){this.assetData=s.getAssetData(o.refId),this.initElement(o,s,a)}extendPrototype([BaseElement,TransformElement,HBaseElement,HSolidElement,HierarchyElement,FrameElement,RenderableElement],HImageElement),HImageElement.prototype.createContent=function(){var o=this.globalData.getAssetsPath(this.assetData),s=new Image;this.data.hasMask?(this.imageElem=createNS("image"),this.imageElem.setAttribute("width",this.assetData.w+"px"),this.imageElem.setAttribute("height",this.assetData.h+"px"),this.imageElem.setAttributeNS("http://www.w3.org/1999/xlink","href",o),this.layerElement.appendChild(this.imageElem),this.baseElement.setAttribute("width",this.assetData.w),this.baseElement.setAttribute("height",this.assetData.h)):this.layerElement.appendChild(s),s.crossOrigin="anonymous",s.src=o,this.data.ln&&this.baseElement.setAttribute("id",this.data.ln)};function HybridRendererBase(o,s){this.animationItem=o,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:s&&s.className||"",imagePreserveAspectRatio:s&&s.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(s&&s.hideOnTransparent===!1),filterSize:{width:s&&s.filterSize&&s.filterSize.width||"400%",height:s&&s.filterSize&&s.filterSize.height||"400%",x:s&&s.filterSize&&s.filterSize.x||"-100%",y:s&&s.filterSize&&s.filterSize.y||"-100%"}},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}extendPrototype([BaseRenderer],HybridRendererBase),HybridRendererBase.prototype.buildItem=SVGRenderer.prototype.buildItem,HybridRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var o=this.pendingElements.pop();o.checkParenting()}},HybridRendererBase.prototype.appendElementInPos=function(o,s){var a=o.getBaseElement();if(a){var et=this.layers[s];if(!et.ddd||!this.supports3d)if(this.threeDElements)this.addTo3dContainer(a,s);else{for(var tt=0,rt,nt,it;tt<s;)this.elements[tt]&&this.elements[tt]!==!0&&this.elements[tt].getBaseElement&&(nt=this.elements[tt],it=this.layers[tt].ddd?this.getThreeDContainerByPos(tt):nt.getBaseElement(),rt=it||rt),tt+=1;rt?(!et.ddd||!this.supports3d)&&this.layerElement.insertBefore(a,rt):(!et.ddd||!this.supports3d)&&this.layerElement.appendChild(a)}else this.addTo3dContainer(a,s)}},HybridRendererBase.prototype.createShape=function(o){return this.supports3d?new HShapeElement(o,this.globalData,this):new SVGShapeElement(o,this.globalData,this)},HybridRendererBase.prototype.createText=function(o){return this.supports3d?new HTextElement(o,this.globalData,this):new SVGTextLottieElement(o,this.globalData,this)},HybridRendererBase.prototype.createCamera=function(o){return this.camera=new HCameraElement(o,this.globalData,this),this.camera},HybridRendererBase.prototype.createImage=function(o){return this.supports3d?new HImageElement(o,this.globalData,this):new IImageElement(o,this.globalData,this)},HybridRendererBase.prototype.createSolid=function(o){return this.supports3d?new HSolidElement(o,this.globalData,this):new ISolidElement(o,this.globalData,this)},HybridRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,HybridRendererBase.prototype.getThreeDContainerByPos=function(o){for(var s=0,a=this.threeDElements.length;s<a;){if(this.threeDElements[s].startPos<=o&&this.threeDElements[s].endPos>=o)return this.threeDElements[s].perspectiveElem;s+=1}return null},HybridRendererBase.prototype.createThreeDContainer=function(o,s){var a=createTag("div"),et,tt;styleDiv(a);var rt=createTag("div");if(styleDiv(rt),s==="3d"){et=a.style,et.width=this.globalData.compSize.w+"px",et.height=this.globalData.compSize.h+"px";var nt="50% 50%";et.webkitTransformOrigin=nt,et.mozTransformOrigin=nt,et.transformOrigin=nt,tt=rt.style;var it="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";tt.transform=it,tt.webkitTransform=it}a.appendChild(rt);var st={container:rt,perspectiveElem:a,startPos:o,endPos:o,type:s};return this.threeDElements.push(st),st},HybridRendererBase.prototype.build3dContainers=function(){var o,s=this.layers.length,a,et="";for(o=0;o<s;o+=1)this.layers[o].ddd&&this.layers[o].ty!==3?(et!=="3d"&&(et="3d",a=this.createThreeDContainer(o,"3d")),a.endPos=Math.max(a.endPos,o)):(et!=="2d"&&(et="2d",a=this.createThreeDContainer(o,"2d")),a.endPos=Math.max(a.endPos,o));for(s=this.threeDElements.length,o=s-1;o>=0;o-=1)this.resizerElem.appendChild(this.threeDElements[o].perspectiveElem)},HybridRendererBase.prototype.addTo3dContainer=function(o,s){for(var a=0,et=this.threeDElements.length;a<et;){if(s<=this.threeDElements[a].endPos){for(var tt=this.threeDElements[a].startPos,rt;tt<s;)this.elements[tt]&&this.elements[tt].getBaseElement&&(rt=this.elements[tt].getBaseElement()),tt+=1;rt?this.threeDElements[a].container.insertBefore(o,rt):this.threeDElements[a].container.appendChild(o);break}a+=1}},HybridRendererBase.prototype.configAnimation=function(o){var s=createTag("div"),a=this.animationItem.wrapper,et=s.style;et.width=o.w+"px",et.height=o.h+"px",this.resizerElem=s,styleDiv(s),et.transformStyle="flat",et.mozTransformStyle="flat",et.webkitTransformStyle="flat",this.renderConfig.className&&s.setAttribute("class",this.renderConfig.className),a.appendChild(s),et.overflow="hidden";var tt=createNS("svg");tt.setAttribute("width","1"),tt.setAttribute("height","1"),styleDiv(tt),this.resizerElem.appendChild(tt);var rt=createNS("defs");tt.appendChild(rt),this.data=o,this.setupGlobalData(o,tt),this.globalData.defs=rt,this.layers=o.layers,this.layerElement=this.resizerElem,this.build3dContainers(),this.updateContainerSize()},HybridRendererBase.prototype.destroy=function(){this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.animationItem.container=null,this.globalData.defs=null;var o,s=this.layers?this.layers.length:0;for(o=0;o<s;o+=1)this.elements[o]&&this.elements[o].destroy&&this.elements[o].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},HybridRendererBase.prototype.updateContainerSize=function(){var o=this.animationItem.wrapper.offsetWidth,s=this.animationItem.wrapper.offsetHeight,a=o/s,et=this.globalData.compSize.w/this.globalData.compSize.h,tt,rt,nt,it;et>a?(tt=o/this.globalData.compSize.w,rt=o/this.globalData.compSize.w,nt=0,it=(s-this.globalData.compSize.h*(o/this.globalData.compSize.w))/2):(tt=s/this.globalData.compSize.h,rt=s/this.globalData.compSize.h,nt=(o-this.globalData.compSize.w*(s/this.globalData.compSize.h))/2,it=0);var st=this.resizerElem.style;st.webkitTransform="matrix3d("+tt+",0,0,0,0,"+rt+",0,0,0,0,1,0,"+nt+","+it+",0,1)",st.transform=st.webkitTransform},HybridRendererBase.prototype.renderFrame=SVGRenderer.prototype.renderFrame,HybridRendererBase.prototype.hide=function(){this.resizerElem.style.display="none"},HybridRendererBase.prototype.show=function(){this.resizerElem.style.display="block"},HybridRendererBase.prototype.initItems=function(){if(this.buildAllItems(),this.camera)this.camera.setup();else{var o=this.globalData.compSize.w,s=this.globalData.compSize.h,a,et=this.threeDElements.length;for(a=0;a<et;a+=1){var tt=this.threeDElements[a].perspectiveElem.style;tt.webkitPerspective=Math.sqrt(Math.pow(o,2)+Math.pow(s,2))+"px",tt.perspective=tt.webkitPerspective}}},HybridRendererBase.prototype.searchExtraCompositions=function(o){var s,a=o.length,et=createTag("div");for(s=0;s<a;s+=1)if(o[s].xt){var tt=this.createComp(o[s],et,this.globalData.comp,null);tt.initExpressions(),this.globalData.projectInterface.registerComposition(tt)}};function HCompElement(o,s,a){this.layers=o.layers,this.supports3d=!o.hasMask,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(o,s,a),this.tm=o.tm?PropertyFactory.getProp(this,o.tm,0,s.frameRate,this):{_placeholder:!0}}extendPrototype([HybridRendererBase,ICompElement,HBaseElement],HCompElement),HCompElement.prototype._createBaseContainerElements=HCompElement.prototype.createContainerElements,HCompElement.prototype.createContainerElements=function(){this._createBaseContainerElements(),this.data.hasMask?(this.svgElement.setAttribute("width",this.data.w),this.svgElement.setAttribute("height",this.data.h),this.transformedElement=this.baseElement):this.transformedElement=this.layerElement},HCompElement.prototype.addTo3dContainer=function(o,s){for(var a=0,et;a<s;)this.elements[a]&&this.elements[a].getBaseElement&&(et=this.elements[a].getBaseElement()),a+=1;et?this.layerElement.insertBefore(o,et):this.layerElement.appendChild(o)},HCompElement.prototype.createComp=function(o){return this.supports3d?new HCompElement(o,this.globalData,this):new SVGCompElement(o,this.globalData,this)};function HybridRenderer(o,s){this.animationItem=o,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:s&&s.className||"",imagePreserveAspectRatio:s&&s.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(s&&s.hideOnTransparent===!1),filterSize:{width:s&&s.filterSize&&s.filterSize.width||"400%",height:s&&s.filterSize&&s.filterSize.height||"400%",x:s&&s.filterSize&&s.filterSize.x||"-100%",y:s&&s.filterSize&&s.filterSize.y||"-100%"},runExpressions:!s||s.runExpressions===void 0||s.runExpressions},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}extendPrototype([HybridRendererBase],HybridRenderer),HybridRenderer.prototype.createComp=function(o){return this.supports3d?new HCompElement(o,this.globalData,this):new SVGCompElement(o,this.globalData,this)};var CompExpressionInterface=function(){return function(o){function s(a){for(var et=0,tt=o.layers.length;et<tt;){if(o.layers[et].nm===a||o.layers[et].ind===a)return o.elements[et].layerInterface;et+=1}return null}return Object.defineProperty(s,"_name",{value:o.data.nm}),s.layer=s,s.pixelAspect=1,s.height=o.data.h||o.globalData.compSize.h,s.width=o.data.w||o.globalData.compSize.w,s.pixelAspect=1,s.frameDuration=1/o.globalData.frameRate,s.displayStartTime=0,s.numLayers=o.layers.length,s}}();function _typeof$2(o){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof$2=function(a){return typeof a}:_typeof$2=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof$2(o)}function seedRandom(o,s){var a=this,et=256,tt=6,rt=52,nt="random",it=s.pow(et,tt),st=s.pow(2,rt),ot=st*2,at=et-1,lt;function ct(yt,vt,Et){var xt=[];vt=vt===!0?{entropy:!0}:vt||{};var wt=pt(dt(vt.entropy?[yt,mt(o)]:yt===null?gt():yt,3),xt),Rt=new ht(xt),Ct=function(){for(var zt=Rt.g(tt),Nt=it,Kt=0;zt<st;)zt=(zt+Kt)*et,Nt*=et,Kt=Rt.g(1);for(;zt>=ot;)zt/=2,Nt/=2,Kt>>>=1;return(zt+Kt)/Nt};return Ct.int32=function(){return Rt.g(4)|0},Ct.quick=function(){return Rt.g(4)/4294967296},Ct.double=Ct,pt(mt(Rt.S),o),(vt.pass||Et||function(Ft,zt,Nt,Kt){return Kt&&(Kt.S&&ft(Kt,Rt),Ft.state=function(){return ft(Rt,{})}),Nt?(s[nt]=Ft,zt):Ft})(Ct,wt,"global"in vt?vt.global:this==s,vt.state)}s["seed"+nt]=ct;function ht(yt){var vt,Et=yt.length,xt=this,wt=0,Rt=xt.i=xt.j=0,Ct=xt.S=[];for(Et||(yt=[Et++]);wt<et;)Ct[wt]=wt++;for(wt=0;wt<et;wt++)Ct[wt]=Ct[Rt=at&Rt+yt[wt%Et]+(vt=Ct[wt])],Ct[Rt]=vt;xt.g=function(Ft){for(var zt,Nt=0,Kt=xt.i,Yt=xt.j,Bt=xt.S;Ft--;)zt=Bt[Kt=at&Kt+1],Nt=Nt*et+Bt[at&(Bt[Kt]=Bt[Yt=at&Yt+zt])+(Bt[Yt]=zt)];return xt.i=Kt,xt.j=Yt,Nt}}function ft(yt,vt){return vt.i=yt.i,vt.j=yt.j,vt.S=yt.S.slice(),vt}function dt(yt,vt){var Et=[],xt=_typeof$2(yt),wt;if(vt&&xt=="object")for(wt in yt)try{Et.push(dt(yt[wt],vt-1))}catch{}return Et.length?Et:xt=="string"?yt:yt+"\0"}function pt(yt,vt){for(var Et=yt+"",xt,wt=0;wt<Et.length;)vt[at&wt]=at&(xt^=vt[at&wt]*19)+Et.charCodeAt(wt++);return mt(vt)}function gt(){try{var yt=new Uint8Array(et);return(a.crypto||a.msCrypto).getRandomValues(yt),mt(yt)}catch{var vt=a.navigator,Et=vt&&vt.plugins;return[+new Date,a,Et,a.screen,mt(o)]}}function mt(yt){return String.fromCharCode.apply(0,yt)}pt(s.random(),o)}function initialize$2(o){seedRandom([],o)}var propTypes={SHAPE:"shape"};function _typeof$1(o){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof$1=function(a){return typeof a}:_typeof$1=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof$1(o)}var ExpressionManager=function(){var ob={},Math=BMMath,window=null,document=null,XMLHttpRequest=null,fetch=null,frames=null,_lottieGlobal={};initialize$2(BMMath);function resetFrame(){_lottieGlobal={}}function $bm_isInstanceOfArray(o){return o.constructor===Array||o.constructor===Float32Array}function isNumerable(o,s){return o==="number"||s instanceof Number||o==="boolean"||o==="string"}function $bm_neg(o){var s=_typeof$1(o);if(s==="number"||o instanceof Number||s==="boolean")return-o;if($bm_isInstanceOfArray(o)){var a,et=o.length,tt=[];for(a=0;a<et;a+=1)tt[a]=-o[a];return tt}return o.propType?o.v:-o}var easeInBez=BezierFactory.getBezierEasing(.333,0,.833,.833,"easeIn").get,easeOutBez=BezierFactory.getBezierEasing(.167,.167,.667,1,"easeOut").get,easeInOutBez=BezierFactory.getBezierEasing(.33,0,.667,1,"easeInOut").get;function sum(o,s){var a=_typeof$1(o),et=_typeof$1(s);if(isNumerable(a,o)&&isNumerable(et,s)||a==="string"||et==="string")return o+s;if($bm_isInstanceOfArray(o)&&isNumerable(et,s))return o=o.slice(0),o[0]+=s,o;if(isNumerable(a,o)&&$bm_isInstanceOfArray(s))return s=s.slice(0),s[0]=o+s[0],s;if($bm_isInstanceOfArray(o)&&$bm_isInstanceOfArray(s)){for(var tt=0,rt=o.length,nt=s.length,it=[];tt<rt||tt<nt;)(typeof o[tt]=="number"||o[tt]instanceof Number)&&(typeof s[tt]=="number"||s[tt]instanceof Number)?it[tt]=o[tt]+s[tt]:it[tt]=s[tt]===void 0?o[tt]:o[tt]||s[tt],tt+=1;return it}return 0}var add=sum;function sub(o,s){var a=_typeof$1(o),et=_typeof$1(s);if(isNumerable(a,o)&&isNumerable(et,s))return a==="string"&&(o=parseInt(o,10)),et==="string"&&(s=parseInt(s,10)),o-s;if($bm_isInstanceOfArray(o)&&isNumerable(et,s))return o=o.slice(0),o[0]-=s,o;if(isNumerable(a,o)&&$bm_isInstanceOfArray(s))return s=s.slice(0),s[0]=o-s[0],s;if($bm_isInstanceOfArray(o)&&$bm_isInstanceOfArray(s)){for(var tt=0,rt=o.length,nt=s.length,it=[];tt<rt||tt<nt;)(typeof o[tt]=="number"||o[tt]instanceof Number)&&(typeof s[tt]=="number"||s[tt]instanceof Number)?it[tt]=o[tt]-s[tt]:it[tt]=s[tt]===void 0?o[tt]:o[tt]||s[tt],tt+=1;return it}return 0}function mul(o,s){var a=_typeof$1(o),et=_typeof$1(s),tt;if(isNumerable(a,o)&&isNumerable(et,s))return o*s;var rt,nt;if($bm_isInstanceOfArray(o)&&isNumerable(et,s)){for(nt=o.length,tt=createTypedArray("float32",nt),rt=0;rt<nt;rt+=1)tt[rt]=o[rt]*s;return tt}if(isNumerable(a,o)&&$bm_isInstanceOfArray(s)){for(nt=s.length,tt=createTypedArray("float32",nt),rt=0;rt<nt;rt+=1)tt[rt]=o*s[rt];return tt}return 0}function div(o,s){var a=_typeof$1(o),et=_typeof$1(s),tt;if(isNumerable(a,o)&&isNumerable(et,s))return o/s;var rt,nt;if($bm_isInstanceOfArray(o)&&isNumerable(et,s)){for(nt=o.length,tt=createTypedArray("float32",nt),rt=0;rt<nt;rt+=1)tt[rt]=o[rt]/s;return tt}if(isNumerable(a,o)&&$bm_isInstanceOfArray(s)){for(nt=s.length,tt=createTypedArray("float32",nt),rt=0;rt<nt;rt+=1)tt[rt]=o/s[rt];return tt}return 0}function mod(o,s){return typeof o=="string"&&(o=parseInt(o,10)),typeof s=="string"&&(s=parseInt(s,10)),o%s}var $bm_sum=sum,$bm_sub=sub,$bm_mul=mul,$bm_div=div,$bm_mod=mod;function clamp(o,s,a){if(s>a){var et=a;a=s,s=et}return Math.min(Math.max(o,s),a)}function radiansToDegrees(o){return o/degToRads}var radians_to_degrees=radiansToDegrees;function degreesToRadians(o){return o*degToRads}var degrees_to_radians=radiansToDegrees,helperLengthArray=[0,0,0,0,0,0];function length(o,s){if(typeof o=="number"||o instanceof Number)return s=s||0,Math.abs(o-s);s||(s=helperLengthArray);var a,et=Math.min(o.length,s.length),tt=0;for(a=0;a<et;a+=1)tt+=Math.pow(s[a]-o[a],2);return Math.sqrt(tt)}function normalize(o){return div(o,length(o))}function rgbToHsl(o){var s=o[0],a=o[1],et=o[2],tt=Math.max(s,a,et),rt=Math.min(s,a,et),nt,it,st=(tt+rt)/2;if(tt===rt)nt=0,it=0;else{var ot=tt-rt;switch(it=st>.5?ot/(2-tt-rt):ot/(tt+rt),tt){case s:nt=(a-et)/ot+(a<et?6:0);break;case a:nt=(et-s)/ot+2;break;case et:nt=(s-a)/ot+4;break}nt/=6}return[nt,it,st,o[3]]}function hue2rgb(o,s,a){return a<0&&(a+=1),a>1&&(a-=1),a<1/6?o+(s-o)*6*a:a<1/2?s:a<2/3?o+(s-o)*(2/3-a)*6:o}function hslToRgb(o){var s=o[0],a=o[1],et=o[2],tt,rt,nt;if(a===0)tt=et,nt=et,rt=et;else{var it=et<.5?et*(1+a):et+a-et*a,st=2*et-it;tt=hue2rgb(st,it,s+1/3),rt=hue2rgb(st,it,s),nt=hue2rgb(st,it,s-1/3)}return[tt,rt,nt,o[3]]}function linear(o,s,a,et,tt){if((et===void 0||tt===void 0)&&(et=s,tt=a,s=0,a=1),a<s){var rt=a;a=s,s=rt}if(o<=s)return et;if(o>=a)return tt;var nt=a===s?0:(o-s)/(a-s);if(!et.length)return et+(tt-et)*nt;var it,st=et.length,ot=createTypedArray("float32",st);for(it=0;it<st;it+=1)ot[it]=et[it]+(tt[it]-et[it])*nt;return ot}function random(o,s){if(s===void 0&&(o===void 0?(o=0,s=1):(s=o,o=void 0)),s.length){var a,et=s.length;o||(o=createTypedArray("float32",et));var tt=createTypedArray("float32",et),rt=BMMath.random();for(a=0;a<et;a+=1)tt[a]=o[a]+rt*(s[a]-o[a]);return tt}o===void 0&&(o=0);var nt=BMMath.random();return o+nt*(s-o)}function createPath(o,s,a,et){var tt,rt=o.length,nt=shapePool.newElement();nt.setPathData(!!et,rt);var it=[0,0],st,ot;for(tt=0;tt<rt;tt+=1)st=s&&s[tt]?s[tt]:it,ot=a&&a[tt]?a[tt]:it,nt.setTripleAt(o[tt][0],o[tt][1],ot[0]+o[tt][0],ot[1]+o[tt][1],st[0]+o[tt][0],st[1]+o[tt][1],tt,!0);return nt}function initiateExpression(elem,data,property){function noOp(o){return o}if(!elem.globalData.renderConfig.runExpressions)return noOp;var val=data.x,needsVelocity=/velocity(?![\w\d])/.test(val),_needsRandom=val.indexOf("random")!==-1,elemType=elem.data.ty,transform,$bm_transform,content,effect,thisProperty=property;thisProperty.valueAtTime=thisProperty.getValueAtTime,Object.defineProperty(thisProperty,"value",{get:function(){return thisProperty.v}}),elem.comp.frameDuration=1/elem.comp.globalData.frameRate,elem.comp.displayStartTime=0;var inPoint=elem.data.ip/elem.comp.globalData.frameRate,outPoint=elem.data.op/elem.comp.globalData.frameRate,width=elem.data.sw?elem.data.sw:0,height=elem.data.sh?elem.data.sh:0,name=elem.data.nm,loopIn,loop_in,loopOut,loop_out,smooth,toWorld,fromWorld,fromComp,toComp,fromCompToSurface,position,rotation,anchorPoint,scale,thisLayer,thisComp,mask,valueAtTime,velocityAtTime,scoped_bm_rt,expression_function=eval("[function _expression_function(){"+val+";scoped_bm_rt=$bm_rt}]")[0],numKeys=property.kf?data.k.length:0,active=!this.data||this.data.hd!==!0,wiggle=function o(s,a){var et,tt,rt=this.pv.length?this.pv.length:1,nt=createTypedArray("float32",rt);s=5;var it=Math.floor(time*s);for(et=0,tt=0;et<it;){for(tt=0;tt<rt;tt+=1)nt[tt]+=-a+a*2*BMMath.random();et+=1}var st=time*s,ot=st-Math.floor(st),at=createTypedArray("float32",rt);if(rt>1){for(tt=0;tt<rt;tt+=1)at[tt]=this.pv[tt]+nt[tt]+(-a+a*2*BMMath.random())*ot;return at}return this.pv+nt[0]+(-a+a*2*BMMath.random())*ot}.bind(this);thisProperty.loopIn&&(loopIn=thisProperty.loopIn.bind(thisProperty),loop_in=loopIn),thisProperty.loopOut&&(loopOut=thisProperty.loopOut.bind(thisProperty),loop_out=loopOut),thisProperty.smooth&&(smooth=thisProperty.smooth.bind(thisProperty));function loopInDuration(o,s){return loopIn(o,s,!0)}function loopOutDuration(o,s){return loopOut(o,s,!0)}this.getValueAtTime&&(valueAtTime=this.getValueAtTime.bind(this)),this.getVelocityAtTime&&(velocityAtTime=this.getVelocityAtTime.bind(this));var comp=elem.comp.globalData.projectInterface.bind(elem.comp.globalData.projectInterface);function lookAt(o,s){var a=[s[0]-o[0],s[1]-o[1],s[2]-o[2]],et=Math.atan2(a[0],Math.sqrt(a[1]*a[1]+a[2]*a[2]))/degToRads,tt=-Math.atan2(a[1],a[2])/degToRads;return[tt,et,0]}function easeOut(o,s,a,et,tt){return applyEase(easeOutBez,o,s,a,et,tt)}function easeIn(o,s,a,et,tt){return applyEase(easeInBez,o,s,a,et,tt)}function ease(o,s,a,et,tt){return applyEase(easeInOutBez,o,s,a,et,tt)}function applyEase(o,s,a,et,tt,rt){tt===void 0?(tt=a,rt=et):s=(s-a)/(et-a),s>1?s=1:s<0&&(s=0);var nt=o(s);if($bm_isInstanceOfArray(tt)){var it,st=tt.length,ot=createTypedArray("float32",st);for(it=0;it<st;it+=1)ot[it]=(rt[it]-tt[it])*nt+tt[it];return ot}return(rt-tt)*nt+tt}function nearestKey(o){var s,a=data.k.length,et,tt;if(!data.k.length||typeof data.k[0]=="number")et=0,tt=0;else if(et=-1,o*=elem.comp.globalData.frameRate,o<data.k[0].t)et=1,tt=data.k[0].t;else{for(s=0;s<a-1;s+=1)if(o===data.k[s].t){et=s+1,tt=data.k[s].t;break}else if(o>data.k[s].t&&o<data.k[s+1].t){o-data.k[s].t>data.k[s+1].t-o?(et=s+2,tt=data.k[s+1].t):(et=s+1,tt=data.k[s].t);break}et===-1&&(et=s+1,tt=data.k[s].t)}var rt={};return rt.index=et,rt.time=tt/elem.comp.globalData.frameRate,rt}function key(o){var s,a,et;if(!data.k.length||typeof data.k[0]=="number")throw new Error("The property has no keyframe at index "+o);o-=1,s={time:data.k[o].t/elem.comp.globalData.frameRate,value:[]};var tt=Object.prototype.hasOwnProperty.call(data.k[o],"s")?data.k[o].s:data.k[o-1].e;for(et=tt.length,a=0;a<et;a+=1)s[a]=tt[a],s.value[a]=tt[a];return s}function framesToTime(o,s){return s||(s=elem.comp.globalData.frameRate),o/s}function timeToFrames(o,s){return!o&&o!==0&&(o=time),s||(s=elem.comp.globalData.frameRate),o*s}function seedRandom(o){BMMath.seedrandom(randSeed+o)}function sourceRectAtTime(){return elem.sourceRectAtTime()}function substring(o,s){return typeof value=="string"?s===void 0?value.substring(o):value.substring(o,s):""}function substr(o,s){return typeof value=="string"?s===void 0?value.substr(o):value.substr(o,s):""}function posterizeTime(o){time=o===0?0:Math.floor(time*o)/o,value=valueAtTime(time)}var time,velocity,value,text,textIndex,textTotal,selectorValue,index=elem.data.ind,hasParent=!!(elem.hierarchy&&elem.hierarchy.length),parent,randSeed=Math.floor(Math.random()*1e6),globalData=elem.globalData;function executeExpression(o){return value=o,this.frameExpressionId===elem.globalData.frameId&&this.propType!=="textSelector"?value:(this.propType==="textSelector"&&(textIndex=this.textIndex,textTotal=this.textTotal,selectorValue=this.selectorValue),thisLayer||(text=elem.layerInterface.text,thisLayer=elem.layerInterface,thisComp=elem.comp.compInterface,toWorld=thisLayer.toWorld.bind(thisLayer),fromWorld=thisLayer.fromWorld.bind(thisLayer),fromComp=thisLayer.fromComp.bind(thisLayer),toComp=thisLayer.toComp.bind(thisLayer),mask=thisLayer.mask?thisLayer.mask.bind(thisLayer):null,fromCompToSurface=fromComp),transform||(transform=elem.layerInterface("ADBE Transform Group"),$bm_transform=transform,transform&&(anchorPoint=transform.anchorPoint)),elemType===4&&!content&&(content=thisLayer("ADBE Root Vectors Group")),effect||(effect=thisLayer(4)),hasParent=!!(elem.hierarchy&&elem.hierarchy.length),hasParent&&!parent&&(parent=elem.hierarchy[0].layerInterface),time=this.comp.renderedFrame/this.comp.globalData.frameRate,_needsRandom&&seedRandom(randSeed+time),needsVelocity&&(velocity=velocityAtTime(time)),expression_function(),this.frameExpressionId=elem.globalData.frameId,scoped_bm_rt=scoped_bm_rt.propType===propTypes.SHAPE?scoped_bm_rt.v:scoped_bm_rt,scoped_bm_rt)}return executeExpression.__preventDeadCodeRemoval=[$bm_transform,anchorPoint,time,velocity,inPoint,outPoint,width,height,name,loop_in,loop_out,smooth,toComp,fromCompToSurface,toWorld,fromWorld,mask,position,rotation,scale,thisComp,numKeys,active,wiggle,loopInDuration,loopOutDuration,comp,lookAt,easeOut,easeIn,ease,nearestKey,key,text,textIndex,textTotal,selectorValue,framesToTime,timeToFrames,sourceRectAtTime,substring,substr,posterizeTime,index,globalData],executeExpression}return ob.initiateExpression=initiateExpression,ob.__preventDeadCodeRemoval=[window,document,XMLHttpRequest,fetch,frames,$bm_neg,add,$bm_sum,$bm_sub,$bm_mul,$bm_div,$bm_mod,clamp,radians_to_degrees,degreesToRadians,degrees_to_radians,normalize,rgbToHsl,hslToRgb,linear,random,createPath,_lottieGlobal],ob.resetFrame=resetFrame,ob}(),Expressions=function(){var o={};o.initExpressions=s,o.resetFrame=ExpressionManager.resetFrame;function s(a){var et=0,tt=[];function rt(){et+=1}function nt(){et-=1,et===0&&st()}function it(ot){tt.indexOf(ot)===-1&&tt.push(ot)}function st(){var ot,at=tt.length;for(ot=0;ot<at;ot+=1)tt[ot].release();tt.length=0}a.renderer.compInterface=CompExpressionInterface(a.renderer),a.renderer.globalData.projectInterface.registerComposition(a.renderer),a.renderer.globalData.pushExpression=rt,a.renderer.globalData.popExpression=nt,a.renderer.globalData.registerExpressionProperty=it}return o}(),MaskManagerInterface=function(){function o(a,et){this._mask=a,this._data=et}Object.defineProperty(o.prototype,"maskPath",{get:function(){return this._mask.prop.k&&this._mask.prop.getValue(),this._mask.prop}}),Object.defineProperty(o.prototype,"maskOpacity",{get:function(){return this._mask.op.k&&this._mask.op.getValue(),this._mask.op.v*100}});var s=function(et){var tt=createSizedArray(et.viewData.length),rt,nt=et.viewData.length;for(rt=0;rt<nt;rt+=1)tt[rt]=new o(et.viewData[rt],et.masksProperties[rt]);var it=function(ot){for(rt=0;rt<nt;){if(et.masksProperties[rt].nm===ot)return tt[rt];rt+=1}return null};return it};return s}(),ExpressionPropertyInterface=function(){var o={pv:0,v:0,mult:1},s={pv:[0,0,0],v:[0,0,0],mult:1};function a(nt,it,st){Object.defineProperty(nt,"velocity",{get:function(){return it.getVelocityAtTime(it.comp.currentFrame)}}),nt.numKeys=it.keyframes?it.keyframes.length:0,nt.key=function(ot){if(!nt.numKeys)return 0;var at="";"s"in it.keyframes[ot-1]?at=it.keyframes[ot-1].s:"e"in it.keyframes[ot-2]?at=it.keyframes[ot-2].e:at=it.keyframes[ot-2].s;var lt=st==="unidimensional"?new Number(at):Object.assign({},at);return lt.time=it.keyframes[ot-1].t/it.elem.comp.globalData.frameRate,lt.value=st==="unidimensional"?at[0]:at,lt},nt.valueAtTime=it.getValueAtTime,nt.speedAtTime=it.getSpeedAtTime,nt.velocityAtTime=it.getVelocityAtTime,nt.propertyGroup=it.propertyGroup}function et(nt){(!nt||!("pv"in nt))&&(nt=o);var it=1/nt.mult,st=nt.pv*it,ot=new Number(st);return ot.value=st,a(ot,nt,"unidimensional"),function(){return nt.k&&nt.getValue(),st=nt.v*it,ot.value!==st&&(ot=new Number(st),ot.value=st,a(ot,nt,"unidimensional")),ot}}function tt(nt){(!nt||!("pv"in nt))&&(nt=s);var it=1/nt.mult,st=nt.data&&nt.data.l||nt.pv.length,ot=createTypedArray("float32",st),at=createTypedArray("float32",st);return ot.value=at,a(ot,nt,"multidimensional"),function(){nt.k&&nt.getValue();for(var lt=0;lt<st;lt+=1)at[lt]=nt.v[lt]*it,ot[lt]=at[lt];return ot}}function rt(){return o}return function(nt){return nt?nt.propType==="unidimensional"?et(nt):tt(nt):rt}}(),TransformExpressionInterface=function(){return function(o){function s(nt){switch(nt){case"scale":case"Scale":case"ADBE Scale":case 6:return s.scale;case"rotation":case"Rotation":case"ADBE Rotation":case"ADBE Rotate Z":case 10:return s.rotation;case"ADBE Rotate X":return s.xRotation;case"ADBE Rotate Y":return s.yRotation;case"position":case"Position":case"ADBE Position":case 2:return s.position;case"ADBE Position_0":return s.xPosition;case"ADBE Position_1":return s.yPosition;case"ADBE Position_2":return s.zPosition;case"anchorPoint":case"AnchorPoint":case"Anchor Point":case"ADBE AnchorPoint":case 1:return s.anchorPoint;case"opacity":case"Opacity":case 11:return s.opacity;default:return null}}Object.defineProperty(s,"rotation",{get:ExpressionPropertyInterface(o.r||o.rz)}),Object.defineProperty(s,"zRotation",{get:ExpressionPropertyInterface(o.rz||o.r)}),Object.defineProperty(s,"xRotation",{get:ExpressionPropertyInterface(o.rx)}),Object.defineProperty(s,"yRotation",{get:ExpressionPropertyInterface(o.ry)}),Object.defineProperty(s,"scale",{get:ExpressionPropertyInterface(o.s)});var a,et,tt,rt;return o.p?rt=ExpressionPropertyInterface(o.p):(a=ExpressionPropertyInterface(o.px),et=ExpressionPropertyInterface(o.py),o.pz&&(tt=ExpressionPropertyInterface(o.pz))),Object.defineProperty(s,"position",{get:function(){return o.p?rt():[a(),et(),tt?tt():0]}}),Object.defineProperty(s,"xPosition",{get:ExpressionPropertyInterface(o.px)}),Object.defineProperty(s,"yPosition",{get:ExpressionPropertyInterface(o.py)}),Object.defineProperty(s,"zPosition",{get:ExpressionPropertyInterface(o.pz)}),Object.defineProperty(s,"anchorPoint",{get:ExpressionPropertyInterface(o.a)}),Object.defineProperty(s,"opacity",{get:ExpressionPropertyInterface(o.o)}),Object.defineProperty(s,"skew",{get:ExpressionPropertyInterface(o.sk)}),Object.defineProperty(s,"skewAxis",{get:ExpressionPropertyInterface(o.sa)}),Object.defineProperty(s,"orientation",{get:ExpressionPropertyInterface(o.or)}),s}}(),LayerExpressionInterface=function(){function o(ot){var at=new Matrix;if(ot!==void 0){var lt=this._elem.finalTransform.mProp.getValueAtTime(ot);lt.clone(at)}else{var ct=this._elem.finalTransform.mProp;ct.applyToMatrix(at)}return at}function s(ot,at){var lt=this.getMatrix(at);return lt.props[12]=0,lt.props[13]=0,lt.props[14]=0,this.applyPoint(lt,ot)}function a(ot,at){var lt=this.getMatrix(at);return this.applyPoint(lt,ot)}function et(ot,at){var lt=this.getMatrix(at);return lt.props[12]=0,lt.props[13]=0,lt.props[14]=0,this.invertPoint(lt,ot)}function tt(ot,at){var lt=this.getMatrix(at);return this.invertPoint(lt,ot)}function rt(ot,at){if(this._elem.hierarchy&&this._elem.hierarchy.length){var lt,ct=this._elem.hierarchy.length;for(lt=0;lt<ct;lt+=1)this._elem.hierarchy[lt].finalTransform.mProp.applyToMatrix(ot)}return ot.applyToPointArray(at[0],at[1],at[2]||0)}function nt(ot,at){if(this._elem.hierarchy&&this._elem.hierarchy.length){var lt,ct=this._elem.hierarchy.length;for(lt=0;lt<ct;lt+=1)this._elem.hierarchy[lt].finalTransform.mProp.applyToMatrix(ot)}return ot.inversePoint(at)}function it(ot){var at=new Matrix;if(at.reset(),this._elem.finalTransform.mProp.applyToMatrix(at),this._elem.hierarchy&&this._elem.hierarchy.length){var lt,ct=this._elem.hierarchy.length;for(lt=0;lt<ct;lt+=1)this._elem.hierarchy[lt].finalTransform.mProp.applyToMatrix(at);return at.inversePoint(ot)}return at.inversePoint(ot)}function st(){return[1,1,1,1]}return function(ot){var at;function lt(dt){ht.mask=new MaskManagerInterface(dt,ot)}function ct(dt){ht.effect=dt}function ht(dt){switch(dt){case"ADBE Root Vectors Group":case"Contents":case 2:return ht.shapeInterface;case 1:case 6:case"Transform":case"transform":case"ADBE Transform Group":return at;case 4:case"ADBE Effect Parade":case"effects":case"Effects":return ht.effect;case"ADBE Text Properties":return ht.textInterface;default:return null}}ht.getMatrix=o,ht.invertPoint=nt,ht.applyPoint=rt,ht.toWorld=a,ht.toWorldVec=s,ht.fromWorld=tt,ht.fromWorldVec=et,ht.toComp=a,ht.fromComp=it,ht.sampleImage=st,ht.sourceRectAtTime=ot.sourceRectAtTime.bind(ot),ht._elem=ot,at=TransformExpressionInterface(ot.finalTransform.mProp);var ft=getDescriptor(at,"anchorPoint");return Object.defineProperties(ht,{hasParent:{get:function(){return ot.hierarchy.length}},parent:{get:function(){return ot.hierarchy[0].layerInterface}},rotation:getDescriptor(at,"rotation"),scale:getDescriptor(at,"scale"),position:getDescriptor(at,"position"),opacity:getDescriptor(at,"opacity"),anchorPoint:ft,anchor_point:ft,transform:{get:function(){return at}},active:{get:function(){return ot.isInRange}}}),ht.startTime=ot.data.st,ht.index=ot.data.ind,ht.source=ot.data.refId,ht.height=ot.data.ty===0?ot.data.h:100,ht.width=ot.data.ty===0?ot.data.w:100,ht.inPoint=ot.data.ip/ot.comp.globalData.frameRate,ht.outPoint=ot.data.op/ot.comp.globalData.frameRate,ht._name=ot.data.nm,ht.registerMaskInterface=lt,ht.registerEffectsInterface=ct,ht}}(),propertyGroupFactory=function(){return function(o,s){return function(a){return a=a===void 0?1:a,a<=0?o:s(a-1)}}}(),PropertyInterface=function(){return function(o,s){var a={_name:o};function et(tt){return tt=tt===void 0?1:tt,tt<=0?a:s(tt-1)}return et}}(),EffectsExpressionInterface=function(){var o={createEffectsInterface:s};function s(tt,rt){if(tt.effectsManager){var nt=[],it=tt.data.ef,st,ot=tt.effectsManager.effectElements.length;for(st=0;st<ot;st+=1)nt.push(a(it[st],tt.effectsManager.effectElements[st],rt,tt));var at=tt.data.ef||[],lt=function(ht){for(st=0,ot=at.length;st<ot;){if(ht===at[st].nm||ht===at[st].mn||ht===at[st].ix)return nt[st];st+=1}return null};return Object.defineProperty(lt,"numProperties",{get:function(){return at.length}}),lt}return null}function a(tt,rt,nt,it){function st(ht){for(var ft=tt.ef,dt=0,pt=ft.length;dt<pt;){if(ht===ft[dt].nm||ht===ft[dt].mn||ht===ft[dt].ix)return ft[dt].ty===5?at[dt]:at[dt]();dt+=1}throw new Error}var ot=propertyGroupFactory(st,nt),at=[],lt,ct=tt.ef.length;for(lt=0;lt<ct;lt+=1)tt.ef[lt].ty===5?at.push(a(tt.ef[lt],rt.effectElements[lt],rt.effectElements[lt].propertyGroup,it)):at.push(et(rt.effectElements[lt],tt.ef[lt].ty,it,ot));return tt.mn==="ADBE Color Control"&&Object.defineProperty(st,"color",{get:function(){return at[0]()}}),Object.defineProperties(st,{numProperties:{get:function(){return tt.np}},_name:{value:tt.nm},propertyGroup:{value:ot}}),st.enabled=tt.en!==0,st.active=st.enabled,st}function et(tt,rt,nt,it){var st=ExpressionPropertyInterface(tt.p);function ot(){return rt===10?nt.comp.compInterface(tt.p.v):st()}return tt.p.setGroupProperty&&tt.p.setGroupProperty(PropertyInterface("",it)),ot}return o}(),ShapePathInterface=function(){return function(s,a,et){var tt=a.sh;function rt(it){return it==="Shape"||it==="shape"||it==="Path"||it==="path"||it==="ADBE Vector Shape"||it===2?rt.path:null}var nt=propertyGroupFactory(rt,et);return tt.setGroupProperty(PropertyInterface("Path",nt)),Object.defineProperties(rt,{path:{get:function(){return tt.k&&tt.getValue(),tt}},shape:{get:function(){return tt.k&&tt.getValue(),tt}},_name:{value:s.nm},ix:{value:s.ix},propertyIndex:{value:s.ix},mn:{value:s.mn},propertyGroup:{value:et}}),rt}}(),ShapeExpressionInterface=function(){function o(ft,dt,pt){var gt=[],mt,yt=ft?ft.length:0;for(mt=0;mt<yt;mt+=1)ft[mt].ty==="gr"?gt.push(a(ft[mt],dt[mt],pt)):ft[mt].ty==="fl"?gt.push(et(ft[mt],dt[mt],pt)):ft[mt].ty==="st"?gt.push(nt(ft[mt],dt[mt],pt)):ft[mt].ty==="tm"?gt.push(it(ft[mt],dt[mt],pt)):ft[mt].ty==="tr"||(ft[mt].ty==="el"?gt.push(ot(ft[mt],dt[mt],pt)):ft[mt].ty==="sr"?gt.push(at(ft[mt],dt[mt],pt)):ft[mt].ty==="sh"?gt.push(ShapePathInterface(ft[mt],dt[mt],pt)):ft[mt].ty==="rc"?gt.push(lt(ft[mt],dt[mt],pt)):ft[mt].ty==="rd"?gt.push(ct(ft[mt],dt[mt],pt)):ft[mt].ty==="rp"?gt.push(ht(ft[mt],dt[mt],pt)):ft[mt].ty==="gf"?gt.push(tt(ft[mt],dt[mt],pt)):gt.push(rt(ft[mt],dt[mt])));return gt}function s(ft,dt,pt){var gt,mt=function(Et){for(var xt=0,wt=gt.length;xt<wt;){if(gt[xt]._name===Et||gt[xt].mn===Et||gt[xt].propertyIndex===Et||gt[xt].ix===Et||gt[xt].ind===Et)return gt[xt];xt+=1}return typeof Et=="number"?gt[Et-1]:null};mt.propertyGroup=propertyGroupFactory(mt,pt),gt=o(ft.it,dt.it,mt.propertyGroup),mt.numProperties=gt.length;var yt=st(ft.it[ft.it.length-1],dt.it[dt.it.length-1],mt.propertyGroup);return mt.transform=yt,mt.propertyIndex=ft.cix,mt._name=ft.nm,mt}function a(ft,dt,pt){var gt=function(Et){switch(Et){case"ADBE Vectors Group":case"Contents":case 2:return gt.content;default:return gt.transform}};gt.propertyGroup=propertyGroupFactory(gt,pt);var mt=s(ft,dt,gt.propertyGroup),yt=st(ft.it[ft.it.length-1],dt.it[dt.it.length-1],gt.propertyGroup);return gt.content=mt,gt.transform=yt,Object.defineProperty(gt,"_name",{get:function(){return ft.nm}}),gt.numProperties=ft.np,gt.propertyIndex=ft.ix,gt.nm=ft.nm,gt.mn=ft.mn,gt}function et(ft,dt,pt){function gt(mt){return mt==="Color"||mt==="color"?gt.color:mt==="Opacity"||mt==="opacity"?gt.opacity:null}return Object.defineProperties(gt,{color:{get:ExpressionPropertyInterface(dt.c)},opacity:{get:ExpressionPropertyInterface(dt.o)},_name:{value:ft.nm},mn:{value:ft.mn}}),dt.c.setGroupProperty(PropertyInterface("Color",pt)),dt.o.setGroupProperty(PropertyInterface("Opacity",pt)),gt}function tt(ft,dt,pt){function gt(mt){return mt==="Start Point"||mt==="start point"?gt.startPoint:mt==="End Point"||mt==="end point"?gt.endPoint:mt==="Opacity"||mt==="opacity"?gt.opacity:null}return Object.defineProperties(gt,{startPoint:{get:ExpressionPropertyInterface(dt.s)},endPoint:{get:ExpressionPropertyInterface(dt.e)},opacity:{get:ExpressionPropertyInterface(dt.o)},type:{get:function(){return"a"}},_name:{value:ft.nm},mn:{value:ft.mn}}),dt.s.setGroupProperty(PropertyInterface("Start Point",pt)),dt.e.setGroupProperty(PropertyInterface("End Point",pt)),dt.o.setGroupProperty(PropertyInterface("Opacity",pt)),gt}function rt(){function ft(){return null}return ft}function nt(ft,dt,pt){var gt=propertyGroupFactory(wt,pt),mt=propertyGroupFactory(xt,gt);function yt(Rt){Object.defineProperty(xt,ft.d[Rt].nm,{get:ExpressionPropertyInterface(dt.d.dataProps[Rt].p)})}var vt,Et=ft.d?ft.d.length:0,xt={};for(vt=0;vt<Et;vt+=1)yt(vt),dt.d.dataProps[vt].p.setGroupProperty(mt);function wt(Rt){return Rt==="Color"||Rt==="color"?wt.color:Rt==="Opacity"||Rt==="opacity"?wt.opacity:Rt==="Stroke Width"||Rt==="stroke width"?wt.strokeWidth:null}return Object.defineProperties(wt,{color:{get:ExpressionPropertyInterface(dt.c)},opacity:{get:ExpressionPropertyInterface(dt.o)},strokeWidth:{get:ExpressionPropertyInterface(dt.w)},dash:{get:function(){return xt}},_name:{value:ft.nm},mn:{value:ft.mn}}),dt.c.setGroupProperty(PropertyInterface("Color",gt)),dt.o.setGroupProperty(PropertyInterface("Opacity",gt)),dt.w.setGroupProperty(PropertyInterface("Stroke Width",gt)),wt}function it(ft,dt,pt){function gt(yt){return yt===ft.e.ix||yt==="End"||yt==="end"?gt.end:yt===ft.s.ix?gt.start:yt===ft.o.ix?gt.offset:null}var mt=propertyGroupFactory(gt,pt);return gt.propertyIndex=ft.ix,dt.s.setGroupProperty(PropertyInterface("Start",mt)),dt.e.setGroupProperty(PropertyInterface("End",mt)),dt.o.setGroupProperty(PropertyInterface("Offset",mt)),gt.propertyIndex=ft.ix,gt.propertyGroup=pt,Object.defineProperties(gt,{start:{get:ExpressionPropertyInterface(dt.s)},end:{get:ExpressionPropertyInterface(dt.e)},offset:{get:ExpressionPropertyInterface(dt.o)},_name:{value:ft.nm}}),gt.mn=ft.mn,gt}function st(ft,dt,pt){function gt(yt){return ft.a.ix===yt||yt==="Anchor Point"?gt.anchorPoint:ft.o.ix===yt||yt==="Opacity"?gt.opacity:ft.p.ix===yt||yt==="Position"?gt.position:ft.r.ix===yt||yt==="Rotation"||yt==="ADBE Vector Rotation"?gt.rotation:ft.s.ix===yt||yt==="Scale"?gt.scale:ft.sk&&ft.sk.ix===yt||yt==="Skew"?gt.skew:ft.sa&&ft.sa.ix===yt||yt==="Skew Axis"?gt.skewAxis:null}var mt=propertyGroupFactory(gt,pt);return dt.transform.mProps.o.setGroupProperty(PropertyInterface("Opacity",mt)),dt.transform.mProps.p.setGroupProperty(PropertyInterface("Position",mt)),dt.transform.mProps.a.setGroupProperty(PropertyInterface("Anchor Point",mt)),dt.transform.mProps.s.setGroupProperty(PropertyInterface("Scale",mt)),dt.transform.mProps.r.setGroupProperty(PropertyInterface("Rotation",mt)),dt.transform.mProps.sk&&(dt.transform.mProps.sk.setGroupProperty(PropertyInterface("Skew",mt)),dt.transform.mProps.sa.setGroupProperty(PropertyInterface("Skew Angle",mt))),dt.transform.op.setGroupProperty(PropertyInterface("Opacity",mt)),Object.defineProperties(gt,{opacity:{get:ExpressionPropertyInterface(dt.transform.mProps.o)},position:{get:ExpressionPropertyInterface(dt.transform.mProps.p)},anchorPoint:{get:ExpressionPropertyInterface(dt.transform.mProps.a)},scale:{get:ExpressionPropertyInterface(dt.transform.mProps.s)},rotation:{get:ExpressionPropertyInterface(dt.transform.mProps.r)},skew:{get:ExpressionPropertyInterface(dt.transform.mProps.sk)},skewAxis:{get:ExpressionPropertyInterface(dt.transform.mProps.sa)},_name:{value:ft.nm}}),gt.ty="tr",gt.mn=ft.mn,gt.propertyGroup=pt,gt}function ot(ft,dt,pt){function gt(vt){return ft.p.ix===vt?gt.position:ft.s.ix===vt?gt.size:null}var mt=propertyGroupFactory(gt,pt);gt.propertyIndex=ft.ix;var yt=dt.sh.ty==="tm"?dt.sh.prop:dt.sh;return yt.s.setGroupProperty(PropertyInterface("Size",mt)),yt.p.setGroupProperty(PropertyInterface("Position",mt)),Object.defineProperties(gt,{size:{get:ExpressionPropertyInterface(yt.s)},position:{get:ExpressionPropertyInterface(yt.p)},_name:{value:ft.nm}}),gt.mn=ft.mn,gt}function at(ft,dt,pt){function gt(vt){return ft.p.ix===vt?gt.position:ft.r.ix===vt?gt.rotation:ft.pt.ix===vt?gt.points:ft.or.ix===vt||vt==="ADBE Vector Star Outer Radius"?gt.outerRadius:ft.os.ix===vt?gt.outerRoundness:ft.ir&&(ft.ir.ix===vt||vt==="ADBE Vector Star Inner Radius")?gt.innerRadius:ft.is&&ft.is.ix===vt?gt.innerRoundness:null}var mt=propertyGroupFactory(gt,pt),yt=dt.sh.ty==="tm"?dt.sh.prop:dt.sh;return gt.propertyIndex=ft.ix,yt.or.setGroupProperty(PropertyInterface("Outer Radius",mt)),yt.os.setGroupProperty(PropertyInterface("Outer Roundness",mt)),yt.pt.setGroupProperty(PropertyInterface("Points",mt)),yt.p.setGroupProperty(PropertyInterface("Position",mt)),yt.r.setGroupProperty(PropertyInterface("Rotation",mt)),ft.ir&&(yt.ir.setGroupProperty(PropertyInterface("Inner Radius",mt)),yt.is.setGroupProperty(PropertyInterface("Inner Roundness",mt))),Object.defineProperties(gt,{position:{get:ExpressionPropertyInterface(yt.p)},rotation:{get:ExpressionPropertyInterface(yt.r)},points:{get:ExpressionPropertyInterface(yt.pt)},outerRadius:{get:ExpressionPropertyInterface(yt.or)},outerRoundness:{get:ExpressionPropertyInterface(yt.os)},innerRadius:{get:ExpressionPropertyInterface(yt.ir)},innerRoundness:{get:ExpressionPropertyInterface(yt.is)},_name:{value:ft.nm}}),gt.mn=ft.mn,gt}function lt(ft,dt,pt){function gt(vt){return ft.p.ix===vt?gt.position:ft.r.ix===vt?gt.roundness:ft.s.ix===vt||vt==="Size"||vt==="ADBE Vector Rect Size"?gt.size:null}var mt=propertyGroupFactory(gt,pt),yt=dt.sh.ty==="tm"?dt.sh.prop:dt.sh;return gt.propertyIndex=ft.ix,yt.p.setGroupProperty(PropertyInterface("Position",mt)),yt.s.setGroupProperty(PropertyInterface("Size",mt)),yt.r.setGroupProperty(PropertyInterface("Rotation",mt)),Object.defineProperties(gt,{position:{get:ExpressionPropertyInterface(yt.p)},roundness:{get:ExpressionPropertyInterface(yt.r)},size:{get:ExpressionPropertyInterface(yt.s)},_name:{value:ft.nm}}),gt.mn=ft.mn,gt}function ct(ft,dt,pt){function gt(vt){return ft.r.ix===vt||vt==="Round Corners 1"?gt.radius:null}var mt=propertyGroupFactory(gt,pt),yt=dt;return gt.propertyIndex=ft.ix,yt.rd.setGroupProperty(PropertyInterface("Radius",mt)),Object.defineProperties(gt,{radius:{get:ExpressionPropertyInterface(yt.rd)},_name:{value:ft.nm}}),gt.mn=ft.mn,gt}function ht(ft,dt,pt){function gt(vt){return ft.c.ix===vt||vt==="Copies"?gt.copies:ft.o.ix===vt||vt==="Offset"?gt.offset:null}var mt=propertyGroupFactory(gt,pt),yt=dt;return gt.propertyIndex=ft.ix,yt.c.setGroupProperty(PropertyInterface("Copies",mt)),yt.o.setGroupProperty(PropertyInterface("Offset",mt)),Object.defineProperties(gt,{copies:{get:ExpressionPropertyInterface(yt.c)},offset:{get:ExpressionPropertyInterface(yt.o)},_name:{value:ft.nm}}),gt.mn=ft.mn,gt}return function(ft,dt,pt){var gt;function mt(vt){if(typeof vt=="number")return vt=vt===void 0?1:vt,vt===0?pt:gt[vt-1];for(var Et=0,xt=gt.length;Et<xt;){if(gt[Et]._name===vt)return gt[Et];Et+=1}return null}function yt(){return pt}return mt.propertyGroup=propertyGroupFactory(mt,yt),gt=o(ft,dt,mt.propertyGroup),mt.numProperties=gt.length,mt._name="Contents",mt}}(),TextExpressionInterface=function(){return function(o){var s;function a(et){switch(et){case"ADBE Text Document":return a.sourceText;default:return null}}return Object.defineProperty(a,"sourceText",{get:function(){o.textProperty.getValue();var tt=o.textProperty.currentData.t;return(!s||tt!==s.value)&&(s=new String(tt),s.value=tt||new String(tt),Object.defineProperty(s,"style",{get:function(){return{fillColor:o.textProperty.currentData.fc}}})),s}}),a}}();function _typeof(o){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof=function(a){return typeof a}:_typeof=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(o)}var FootageInterface=function(){var o=function(et){var tt="",rt=et.getFootageData();function nt(){return tt="",rt=et.getFootageData(),it}function it(st){if(rt[st])return tt=st,rt=rt[st],_typeof(rt)==="object"?it:rt;var ot=st.indexOf(tt);if(ot!==-1){var at=parseInt(st.substr(ot+tt.length),10);return rt=rt[at],_typeof(rt)==="object"?it:rt}return""}return nt},s=function(et){function tt(rt){return rt==="Outline"?tt.outlineInterface():null}return tt._name="Outline",tt.outlineInterface=o(et),tt};return function(a){function et(tt){return tt==="Data"?et.dataInterface:null}return et._name="Data",et.dataInterface=s(a),et}}(),interfaces={layer:LayerExpressionInterface,effects:EffectsExpressionInterface,comp:CompExpressionInterface,shape:ShapeExpressionInterface,text:TextExpressionInterface,footage:FootageInterface};function getInterface(o){return interfaces[o]||null}var expressionHelpers=function(){function o(nt,it,st){it.x&&(st.k=!0,st.x=!0,st.initiateExpression=ExpressionManager.initiateExpression,st.effectsSequence.push(st.initiateExpression(nt,it,st).bind(st)))}function s(nt){return nt*=this.elem.globalData.frameRate,nt-=this.offsetTime,nt!==this._cachingAtTime.lastFrame&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastFrame<nt?this._cachingAtTime.lastIndex:0,this._cachingAtTime.value=this.interpolateValue(nt,this._cachingAtTime),this._cachingAtTime.lastFrame=nt),this._cachingAtTime.value}function a(nt){var it=-.01,st=this.getValueAtTime(nt),ot=this.getValueAtTime(nt+it),at=0;if(st.length){var lt;for(lt=0;lt<st.length;lt+=1)at+=Math.pow(ot[lt]-st[lt],2);at=Math.sqrt(at)*100}else at=0;return at}function et(nt){if(this.vel!==void 0)return this.vel;var it=-.001,st=this.getValueAtTime(nt),ot=this.getValueAtTime(nt+it),at;if(st.length){at=createTypedArray("float32",st.length);var lt;for(lt=0;lt<st.length;lt+=1)at[lt]=(ot[lt]-st[lt])/it}else at=(ot-st)/it;return at}function tt(){return this.pv}function rt(nt){this.propertyGroup=nt}return{searchExpressions:o,getSpeedAtTime:a,getVelocityAtTime:et,getValueAtTime:s,getStaticValueAtTime:tt,setGroupProperty:rt}}();function addPropertyDecorator(){function o(ct,ht,ft){if(!this.k||!this.keyframes)return this.pv;ct=ct?ct.toLowerCase():"";var dt=this.comp.renderedFrame,pt=this.keyframes,gt=pt[pt.length-1].t;if(dt<=gt)return this.pv;var mt,yt;ft?(ht?mt=Math.abs(gt-this.elem.comp.globalData.frameRate*ht):mt=Math.max(0,gt-this.elem.data.ip),yt=gt-mt):((!ht||ht>pt.length-1)&&(ht=pt.length-1),yt=pt[pt.length-1-ht].t,mt=gt-yt);var vt,Et,xt;if(ct==="pingpong"){var wt=Math.floor((dt-yt)/mt);if(wt%2!==0)return this.getValueAtTime((mt-(dt-yt)%mt+yt)/this.comp.globalData.frameRate,0)}else if(ct==="offset"){var Rt=this.getValueAtTime(yt/this.comp.globalData.frameRate,0),Ct=this.getValueAtTime(gt/this.comp.globalData.frameRate,0),Ft=this.getValueAtTime(((dt-yt)%mt+yt)/this.comp.globalData.frameRate,0),zt=Math.floor((dt-yt)/mt);if(this.pv.length){for(xt=new Array(Rt.length),Et=xt.length,vt=0;vt<Et;vt+=1)xt[vt]=(Ct[vt]-Rt[vt])*zt+Ft[vt];return xt}return(Ct-Rt)*zt+Ft}else if(ct==="continue"){var Nt=this.getValueAtTime(gt/this.comp.globalData.frameRate,0),Kt=this.getValueAtTime((gt-.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(xt=new Array(Nt.length),Et=xt.length,vt=0;vt<Et;vt+=1)xt[vt]=Nt[vt]+(Nt[vt]-Kt[vt])*((dt-gt)/this.comp.globalData.frameRate)/5e-4;return xt}return Nt+(Nt-Kt)*((dt-gt)/.001)}return this.getValueAtTime(((dt-yt)%mt+yt)/this.comp.globalData.frameRate,0)}function s(ct,ht,ft){if(!this.k)return this.pv;ct=ct?ct.toLowerCase():"";var dt=this.comp.renderedFrame,pt=this.keyframes,gt=pt[0].t;if(dt>=gt)return this.pv;var mt,yt;ft?(ht?mt=Math.abs(this.elem.comp.globalData.frameRate*ht):mt=Math.max(0,this.elem.data.op-gt),yt=gt+mt):((!ht||ht>pt.length-1)&&(ht=pt.length-1),yt=pt[ht].t,mt=yt-gt);var vt,Et,xt;if(ct==="pingpong"){var wt=Math.floor((gt-dt)/mt);if(wt%2===0)return this.getValueAtTime(((gt-dt)%mt+gt)/this.comp.globalData.frameRate,0)}else if(ct==="offset"){var Rt=this.getValueAtTime(gt/this.comp.globalData.frameRate,0),Ct=this.getValueAtTime(yt/this.comp.globalData.frameRate,0),Ft=this.getValueAtTime((mt-(gt-dt)%mt+gt)/this.comp.globalData.frameRate,0),zt=Math.floor((gt-dt)/mt)+1;if(this.pv.length){for(xt=new Array(Rt.length),Et=xt.length,vt=0;vt<Et;vt+=1)xt[vt]=Ft[vt]-(Ct[vt]-Rt[vt])*zt;return xt}return Ft-(Ct-Rt)*zt}else if(ct==="continue"){var Nt=this.getValueAtTime(gt/this.comp.globalData.frameRate,0),Kt=this.getValueAtTime((gt+.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(xt=new Array(Nt.length),Et=xt.length,vt=0;vt<Et;vt+=1)xt[vt]=Nt[vt]+(Nt[vt]-Kt[vt])*(gt-dt)/.001;return xt}return Nt+(Nt-Kt)*(gt-dt)/.001}return this.getValueAtTime((mt-((gt-dt)%mt+gt))/this.comp.globalData.frameRate,0)}function a(ct,ht){if(!this.k)return this.pv;if(ct=(ct||.4)*.5,ht=Math.floor(ht||5),ht<=1)return this.pv;var ft=this.comp.renderedFrame/this.comp.globalData.frameRate,dt=ft-ct,pt=ft+ct,gt=ht>1?(pt-dt)/(ht-1):1,mt=0,yt=0,vt;this.pv.length?vt=createTypedArray("float32",this.pv.length):vt=0;for(var Et;mt<ht;){if(Et=this.getValueAtTime(dt+mt*gt),this.pv.length)for(yt=0;yt<this.pv.length;yt+=1)vt[yt]+=Et[yt];else vt+=Et;mt+=1}if(this.pv.length)for(yt=0;yt<this.pv.length;yt+=1)vt[yt]/=ht;else vt/=ht;return vt}function et(ct){this._transformCachingAtTime||(this._transformCachingAtTime={v:new Matrix});var ht=this._transformCachingAtTime.v;if(ht.cloneFromProps(this.pre.props),this.appliedTransformations<1){var ft=this.a.getValueAtTime(ct);ht.translate(-ft[0]*this.a.mult,-ft[1]*this.a.mult,ft[2]*this.a.mult)}if(this.appliedTransformations<2){var dt=this.s.getValueAtTime(ct);ht.scale(dt[0]*this.s.mult,dt[1]*this.s.mult,dt[2]*this.s.mult)}if(this.sk&&this.appliedTransformations<3){var pt=this.sk.getValueAtTime(ct),gt=this.sa.getValueAtTime(ct);ht.skewFromAxis(-pt*this.sk.mult,gt*this.sa.mult)}if(this.r&&this.appliedTransformations<4){var mt=this.r.getValueAtTime(ct);ht.rotate(-mt*this.r.mult)}else if(!this.r&&this.appliedTransformations<4){var yt=this.rz.getValueAtTime(ct),vt=this.ry.getValueAtTime(ct),Et=this.rx.getValueAtTime(ct),xt=this.or.getValueAtTime(ct);ht.rotateZ(-yt*this.rz.mult).rotateY(vt*this.ry.mult).rotateX(Et*this.rx.mult).rotateZ(-xt[2]*this.or.mult).rotateY(xt[1]*this.or.mult).rotateX(xt[0]*this.or.mult)}if(this.data.p&&this.data.p.s){var wt=this.px.getValueAtTime(ct),Rt=this.py.getValueAtTime(ct);if(this.data.p.z){var Ct=this.pz.getValueAtTime(ct);ht.translate(wt*this.px.mult,Rt*this.py.mult,-Ct*this.pz.mult)}else ht.translate(wt*this.px.mult,Rt*this.py.mult,0)}else{var Ft=this.p.getValueAtTime(ct);ht.translate(Ft[0]*this.p.mult,Ft[1]*this.p.mult,-Ft[2]*this.p.mult)}return ht}function tt(){return this.v.clone(new Matrix)}var rt=TransformPropertyFactory.getTransformProperty;TransformPropertyFactory.getTransformProperty=function(ct,ht,ft){var dt=rt(ct,ht,ft);return dt.dynamicProperties.length?dt.getValueAtTime=et.bind(dt):dt.getValueAtTime=tt.bind(dt),dt.setGroupProperty=expressionHelpers.setGroupProperty,dt};var nt=PropertyFactory.getProp;PropertyFactory.getProp=function(ct,ht,ft,dt,pt){var gt=nt(ct,ht,ft,dt,pt);gt.kf?gt.getValueAtTime=expressionHelpers.getValueAtTime.bind(gt):gt.getValueAtTime=expressionHelpers.getStaticValueAtTime.bind(gt),gt.setGroupProperty=expressionHelpers.setGroupProperty,gt.loopOut=o,gt.loopIn=s,gt.smooth=a,gt.getVelocityAtTime=expressionHelpers.getVelocityAtTime.bind(gt),gt.getSpeedAtTime=expressionHelpers.getSpeedAtTime.bind(gt),gt.numKeys=ht.a===1?ht.k.length:0,gt.propertyIndex=ht.ix;var mt=0;return ft!==0&&(mt=createTypedArray("float32",ht.a===1?ht.k[0].s.length:ht.k.length)),gt._cachingAtTime={lastFrame:initialDefaultFrame,lastIndex:0,value:mt},expressionHelpers.searchExpressions(ct,ht,gt),gt.k&&pt.addDynamicProperty(gt),gt};function it(ct){return this._cachingAtTime||(this._cachingAtTime={shapeValue:shapePool.clone(this.pv),lastIndex:0,lastTime:initialDefaultFrame}),ct*=this.elem.globalData.frameRate,ct-=this.offsetTime,ct!==this._cachingAtTime.lastTime&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastTime<ct?this._caching.lastIndex:0,this._cachingAtTime.lastTime=ct,this.interpolateShape(ct,this._cachingAtTime.shapeValue,this._cachingAtTime)),this._cachingAtTime.shapeValue}var st=ShapePropertyFactory.getConstructorFunction(),ot=ShapePropertyFactory.getKeyframedConstructorFunction();function at(){}at.prototype={vertices:function(ht,ft){this.k&&this.getValue();var dt=this.v;ft!==void 0&&(dt=this.getValueAtTime(ft,0));var pt,gt=dt._length,mt=dt[ht],yt=dt.v,vt=createSizedArray(gt);for(pt=0;pt<gt;pt+=1)ht==="i"||ht==="o"?vt[pt]=[mt[pt][0]-yt[pt][0],mt[pt][1]-yt[pt][1]]:vt[pt]=[mt[pt][0],mt[pt][1]];return vt},points:function(ht){return this.vertices("v",ht)},inTangents:function(ht){return this.vertices("i",ht)},outTangents:function(ht){return this.vertices("o",ht)},isClosed:function(){return this.v.c},pointOnPath:function(ht,ft){var dt=this.v;ft!==void 0&&(dt=this.getValueAtTime(ft,0)),this._segmentsLength||(this._segmentsLength=bez.getSegmentsLength(dt));for(var pt=this._segmentsLength,gt=pt.lengths,mt=pt.totalLength*ht,yt=0,vt=gt.length,Et=0,xt;yt<vt;){if(Et+gt[yt].addedLength>mt){var wt=yt,Rt=dt.c&&yt===vt-1?0:yt+1,Ct=(mt-Et)/gt[yt].addedLength;xt=bez.getPointInSegment(dt.v[wt],dt.v[Rt],dt.o[wt],dt.i[Rt],Ct,gt[yt]);break}else Et+=gt[yt].addedLength;yt+=1}return xt||(xt=dt.c?[dt.v[0][0],dt.v[0][1]]:[dt.v[dt._length-1][0],dt.v[dt._length-1][1]]),xt},vectorOnPath:function(ht,ft,dt){ht==1?ht=this.v.c:ht==0&&(ht=.999);var pt=this.pointOnPath(ht,ft),gt=this.pointOnPath(ht+.001,ft),mt=gt[0]-pt[0],yt=gt[1]-pt[1],vt=Math.sqrt(Math.pow(mt,2)+Math.pow(yt,2));if(vt===0)return[0,0];var Et=dt==="tangent"?[mt/vt,yt/vt]:[-yt/vt,mt/vt];return Et},tangentOnPath:function(ht,ft){return this.vectorOnPath(ht,ft,"tangent")},normalOnPath:function(ht,ft){return this.vectorOnPath(ht,ft,"normal")},setGroupProperty:expressionHelpers.setGroupProperty,getValueAtTime:expressionHelpers.getStaticValueAtTime},extendPrototype([at],st),extendPrototype([at],ot),ot.prototype.getValueAtTime=it,ot.prototype.initiateExpression=ExpressionManager.initiateExpression;var lt=ShapePropertyFactory.getShapeProp;ShapePropertyFactory.getShapeProp=function(ct,ht,ft,dt,pt){var gt=lt(ct,ht,ft,dt,pt);return gt.propertyIndex=ht.ix,gt.lock=!1,ft===3?expressionHelpers.searchExpressions(ct,ht.pt,gt):ft===4&&expressionHelpers.searchExpressions(ct,ht.ks,gt),gt.k&&ct.addDynamicProperty(gt),gt}}function initialize$1(){addPropertyDecorator()}function addDecorator(){function o(){return this.data.d.x?(this.calculateExpression=ExpressionManager.initiateExpression.bind(this)(this.elem,this.data.d,this),this.addEffect(this.getExpressionValue.bind(this)),!0):null}TextProperty.prototype.getExpressionValue=function(s,a){var et=this.calculateExpression(a);if(s.t!==et){var tt={};return this.copyData(tt,s),tt.t=et.toString(),tt.__complete=!1,tt}return s},TextProperty.prototype.searchProperty=function(){var s=this.searchKeyframes(),a=this.searchExpressions();return this.kf=s||a,this.kf},TextProperty.prototype.searchExpressions=o}function initialize(){addDecorator()}function SVGComposableEffect(){}SVGComposableEffect.prototype={createMergeNode:function o(s,a){var et=createNS("feMerge");et.setAttribute("result",s);var tt,rt;for(rt=0;rt<a.length;rt+=1)tt=createNS("feMergeNode"),tt.setAttribute("in",a[rt]),et.appendChild(tt),et.appendChild(tt);return et}};var linearFilterValue="0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0";function SVGTintFilter(o,s,a,et,tt){this.filterManager=s;var rt=createNS("feColorMatrix");rt.setAttribute("type","matrix"),rt.setAttribute("color-interpolation-filters","linearRGB"),rt.setAttribute("values",linearFilterValue+" 1 0"),this.linearFilter=rt,rt.setAttribute("result",et+"_tint_1"),o.appendChild(rt),rt=createNS("feColorMatrix"),rt.setAttribute("type","matrix"),rt.setAttribute("color-interpolation-filters","sRGB"),rt.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),rt.setAttribute("result",et+"_tint_2"),o.appendChild(rt),this.matrixFilter=rt;var nt=this.createMergeNode(et,[tt,et+"_tint_1",et+"_tint_2"]);o.appendChild(nt)}extendPrototype([SVGComposableEffect],SVGTintFilter),SVGTintFilter.prototype.renderFrame=function(o){if(o||this.filterManager._mdf){var s=this.filterManager.effectElements[0].p.v,a=this.filterManager.effectElements[1].p.v,et=this.filterManager.effectElements[2].p.v/100;this.linearFilter.setAttribute("values",linearFilterValue+" "+et+" 0"),this.matrixFilter.setAttribute("values",a[0]-s[0]+" 0 0 0 "+s[0]+" "+(a[1]-s[1])+" 0 0 0 "+s[1]+" "+(a[2]-s[2])+" 0 0 0 "+s[2]+" 0 0 0 1 0")}};function SVGFillFilter(o,s,a,et){this.filterManager=s;var tt=createNS("feColorMatrix");tt.setAttribute("type","matrix"),tt.setAttribute("color-interpolation-filters","sRGB"),tt.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),tt.setAttribute("result",et),o.appendChild(tt),this.matrixFilter=tt}SVGFillFilter.prototype.renderFrame=function(o){if(o||this.filterManager._mdf){var s=this.filterManager.effectElements[2].p.v,a=this.filterManager.effectElements[6].p.v;this.matrixFilter.setAttribute("values","0 0 0 0 "+s[0]+" 0 0 0 0 "+s[1]+" 0 0 0 0 "+s[2]+" 0 0 0 "+a+" 0")}};function SVGStrokeEffect(o,s,a){this.initialized=!1,this.filterManager=s,this.elem=a,this.paths=[]}SVGStrokeEffect.prototype.initialize=function(){var o=this.elem.layerElement.children||this.elem.layerElement.childNodes,s,a,et,tt;for(this.filterManager.effectElements[1].p.v===1?(tt=this.elem.maskManager.masksProperties.length,et=0):(et=this.filterManager.effectElements[0].p.v-1,tt=et+1),a=createNS("g"),a.setAttribute("fill","none"),a.setAttribute("stroke-linecap","round"),a.setAttribute("stroke-dashoffset",1),et;et<tt;et+=1)s=createNS("path"),a.appendChild(s),this.paths.push({p:s,m:et});if(this.filterManager.effectElements[10].p.v===3){var rt=createNS("mask"),nt=createElementID();rt.setAttribute("id",nt),rt.setAttribute("mask-type","alpha"),rt.appendChild(a),this.elem.globalData.defs.appendChild(rt);var it=createNS("g");for(it.setAttribute("mask","url("+getLocationHref()+"#"+nt+")");o[0];)it.appendChild(o[0]);this.elem.layerElement.appendChild(it),this.masker=rt,a.setAttribute("stroke","#fff")}else if(this.filterManager.effectElements[10].p.v===1||this.filterManager.effectElements[10].p.v===2){if(this.filterManager.effectElements[10].p.v===2)for(o=this.elem.layerElement.children||this.elem.layerElement.childNodes;o.length;)this.elem.layerElement.removeChild(o[0]);this.elem.layerElement.appendChild(a),this.elem.layerElement.removeAttribute("mask"),a.setAttribute("stroke","#fff")}this.initialized=!0,this.pathMasker=a},SVGStrokeEffect.prototype.renderFrame=function(o){this.initialized||this.initialize();var s,a=this.paths.length,et,tt;for(s=0;s<a;s+=1)if(this.paths[s].m!==-1&&(et=this.elem.maskManager.viewData[this.paths[s].m],tt=this.paths[s].p,(o||this.filterManager._mdf||et.prop._mdf)&&tt.setAttribute("d",et.lastPath),o||this.filterManager.effectElements[9].p._mdf||this.filterManager.effectElements[4].p._mdf||this.filterManager.effectElements[7].p._mdf||this.filterManager.effectElements[8].p._mdf||et.prop._mdf)){var rt;if(this.filterManager.effectElements[7].p.v!==0||this.filterManager.effectElements[8].p.v!==100){var nt=Math.min(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v)*.01,it=Math.max(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v)*.01,st=tt.getTotalLength();rt="0 0 0 "+st*nt+" ";var ot=st*(it-nt),at=1+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01,lt=Math.floor(ot/at),ct;for(ct=0;ct<lt;ct+=1)rt+="1 "+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01+" ";rt+="0 "+st*10+" 0 0"}else rt="1 "+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01;tt.setAttribute("stroke-dasharray",rt)}if((o||this.filterManager.effectElements[4].p._mdf)&&this.pathMasker.setAttribute("stroke-width",this.filterManager.effectElements[4].p.v*2),(o||this.filterManager.effectElements[6].p._mdf)&&this.pathMasker.setAttribute("opacity",this.filterManager.effectElements[6].p.v),(this.filterManager.effectElements[10].p.v===1||this.filterManager.effectElements[10].p.v===2)&&(o||this.filterManager.effectElements[3].p._mdf)){var ht=this.filterManager.effectElements[3].p.v;this.pathMasker.setAttribute("stroke","rgb("+bmFloor(ht[0]*255)+","+bmFloor(ht[1]*255)+","+bmFloor(ht[2]*255)+")")}};function SVGTritoneFilter(o,s,a,et){this.filterManager=s;var tt=createNS("feColorMatrix");tt.setAttribute("type","matrix"),tt.setAttribute("color-interpolation-filters","linearRGB"),tt.setAttribute("values","0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0"),o.appendChild(tt);var rt=createNS("feComponentTransfer");rt.setAttribute("color-interpolation-filters","sRGB"),rt.setAttribute("result",et),this.matrixFilter=rt;var nt=createNS("feFuncR");nt.setAttribute("type","table"),rt.appendChild(nt),this.feFuncR=nt;var it=createNS("feFuncG");it.setAttribute("type","table"),rt.appendChild(it),this.feFuncG=it;var st=createNS("feFuncB");st.setAttribute("type","table"),rt.appendChild(st),this.feFuncB=st,o.appendChild(rt)}SVGTritoneFilter.prototype.renderFrame=function(o){if(o||this.filterManager._mdf){var s=this.filterManager.effectElements[0].p.v,a=this.filterManager.effectElements[1].p.v,et=this.filterManager.effectElements[2].p.v,tt=et[0]+" "+a[0]+" "+s[0],rt=et[1]+" "+a[1]+" "+s[1],nt=et[2]+" "+a[2]+" "+s[2];this.feFuncR.setAttribute("tableValues",tt),this.feFuncG.setAttribute("tableValues",rt),this.feFuncB.setAttribute("tableValues",nt)}};function SVGProLevelsFilter(o,s,a,et){this.filterManager=s;var tt=this.filterManager.effectElements,rt=createNS("feComponentTransfer");(tt[10].p.k||tt[10].p.v!==0||tt[11].p.k||tt[11].p.v!==1||tt[12].p.k||tt[12].p.v!==1||tt[13].p.k||tt[13].p.v!==0||tt[14].p.k||tt[14].p.v!==1)&&(this.feFuncR=this.createFeFunc("feFuncR",rt)),(tt[17].p.k||tt[17].p.v!==0||tt[18].p.k||tt[18].p.v!==1||tt[19].p.k||tt[19].p.v!==1||tt[20].p.k||tt[20].p.v!==0||tt[21].p.k||tt[21].p.v!==1)&&(this.feFuncG=this.createFeFunc("feFuncG",rt)),(tt[24].p.k||tt[24].p.v!==0||tt[25].p.k||tt[25].p.v!==1||tt[26].p.k||tt[26].p.v!==1||tt[27].p.k||tt[27].p.v!==0||tt[28].p.k||tt[28].p.v!==1)&&(this.feFuncB=this.createFeFunc("feFuncB",rt)),(tt[31].p.k||tt[31].p.v!==0||tt[32].p.k||tt[32].p.v!==1||tt[33].p.k||tt[33].p.v!==1||tt[34].p.k||tt[34].p.v!==0||tt[35].p.k||tt[35].p.v!==1)&&(this.feFuncA=this.createFeFunc("feFuncA",rt)),(this.feFuncR||this.feFuncG||this.feFuncB||this.feFuncA)&&(rt.setAttribute("color-interpolation-filters","sRGB"),o.appendChild(rt)),(tt[3].p.k||tt[3].p.v!==0||tt[4].p.k||tt[4].p.v!==1||tt[5].p.k||tt[5].p.v!==1||tt[6].p.k||tt[6].p.v!==0||tt[7].p.k||tt[7].p.v!==1)&&(rt=createNS("feComponentTransfer"),rt.setAttribute("color-interpolation-filters","sRGB"),rt.setAttribute("result",et),o.appendChild(rt),this.feFuncRComposed=this.createFeFunc("feFuncR",rt),this.feFuncGComposed=this.createFeFunc("feFuncG",rt),this.feFuncBComposed=this.createFeFunc("feFuncB",rt))}SVGProLevelsFilter.prototype.createFeFunc=function(o,s){var a=createNS(o);return a.setAttribute("type","table"),s.appendChild(a),a},SVGProLevelsFilter.prototype.getTableValue=function(o,s,a,et,tt){for(var rt=0,nt=256,it,st=Math.min(o,s),ot=Math.max(o,s),at=Array.call(null,{length:nt}),lt,ct=0,ht=tt-et,ft=s-o;rt<=256;)it=rt/256,it<=st?lt=ft<0?tt:et:it>=ot?lt=ft<0?et:tt:lt=et+ht*Math.pow((it-o)/ft,1/a),at[ct]=lt,ct+=1,rt+=256/(nt-1);return at.join(" ")},SVGProLevelsFilter.prototype.renderFrame=function(o){if(o||this.filterManager._mdf){var s,a=this.filterManager.effectElements;this.feFuncRComposed&&(o||a[3].p._mdf||a[4].p._mdf||a[5].p._mdf||a[6].p._mdf||a[7].p._mdf)&&(s=this.getTableValue(a[3].p.v,a[4].p.v,a[5].p.v,a[6].p.v,a[7].p.v),this.feFuncRComposed.setAttribute("tableValues",s),this.feFuncGComposed.setAttribute("tableValues",s),this.feFuncBComposed.setAttribute("tableValues",s)),this.feFuncR&&(o||a[10].p._mdf||a[11].p._mdf||a[12].p._mdf||a[13].p._mdf||a[14].p._mdf)&&(s=this.getTableValue(a[10].p.v,a[11].p.v,a[12].p.v,a[13].p.v,a[14].p.v),this.feFuncR.setAttribute("tableValues",s)),this.feFuncG&&(o||a[17].p._mdf||a[18].p._mdf||a[19].p._mdf||a[20].p._mdf||a[21].p._mdf)&&(s=this.getTableValue(a[17].p.v,a[18].p.v,a[19].p.v,a[20].p.v,a[21].p.v),this.feFuncG.setAttribute("tableValues",s)),this.feFuncB&&(o||a[24].p._mdf||a[25].p._mdf||a[26].p._mdf||a[27].p._mdf||a[28].p._mdf)&&(s=this.getTableValue(a[24].p.v,a[25].p.v,a[26].p.v,a[27].p.v,a[28].p.v),this.feFuncB.setAttribute("tableValues",s)),this.feFuncA&&(o||a[31].p._mdf||a[32].p._mdf||a[33].p._mdf||a[34].p._mdf||a[35].p._mdf)&&(s=this.getTableValue(a[31].p.v,a[32].p.v,a[33].p.v,a[34].p.v,a[35].p.v),this.feFuncA.setAttribute("tableValues",s))}};function SVGDropShadowEffect(o,s,a,et,tt){var rt=s.container.globalData.renderConfig.filterSize,nt=s.data.fs||rt;o.setAttribute("x",nt.x||rt.x),o.setAttribute("y",nt.y||rt.y),o.setAttribute("width",nt.width||rt.width),o.setAttribute("height",nt.height||rt.height),this.filterManager=s;var it=createNS("feGaussianBlur");it.setAttribute("in","SourceAlpha"),it.setAttribute("result",et+"_drop_shadow_1"),it.setAttribute("stdDeviation","0"),this.feGaussianBlur=it,o.appendChild(it);var st=createNS("feOffset");st.setAttribute("dx","25"),st.setAttribute("dy","0"),st.setAttribute("in",et+"_drop_shadow_1"),st.setAttribute("result",et+"_drop_shadow_2"),this.feOffset=st,o.appendChild(st);var ot=createNS("feFlood");ot.setAttribute("flood-color","#00ff00"),ot.setAttribute("flood-opacity","1"),ot.setAttribute("result",et+"_drop_shadow_3"),this.feFlood=ot,o.appendChild(ot);var at=createNS("feComposite");at.setAttribute("in",et+"_drop_shadow_3"),at.setAttribute("in2",et+"_drop_shadow_2"),at.setAttribute("operator","in"),at.setAttribute("result",et+"_drop_shadow_4"),o.appendChild(at);var lt=this.createMergeNode(et,[et+"_drop_shadow_4",tt]);o.appendChild(lt)}extendPrototype([SVGComposableEffect],SVGDropShadowEffect),SVGDropShadowEffect.prototype.renderFrame=function(o){if(o||this.filterManager._mdf){if((o||this.filterManager.effectElements[4].p._mdf)&&this.feGaussianBlur.setAttribute("stdDeviation",this.filterManager.effectElements[4].p.v/4),o||this.filterManager.effectElements[0].p._mdf){var s=this.filterManager.effectElements[0].p.v;this.feFlood.setAttribute("flood-color",rgbToHex(Math.round(s[0]*255),Math.round(s[1]*255),Math.round(s[2]*255)))}if((o||this.filterManager.effectElements[1].p._mdf)&&this.feFlood.setAttribute("flood-opacity",this.filterManager.effectElements[1].p.v/255),o||this.filterManager.effectElements[2].p._mdf||this.filterManager.effectElements[3].p._mdf){var a=this.filterManager.effectElements[3].p.v,et=(this.filterManager.effectElements[2].p.v-90)*degToRads,tt=a*Math.cos(et),rt=a*Math.sin(et);this.feOffset.setAttribute("dx",tt),this.feOffset.setAttribute("dy",rt)}}};var _svgMatteSymbols=[];function SVGMatte3Effect(o,s,a){this.initialized=!1,this.filterManager=s,this.filterElem=o,this.elem=a,a.matteElement=createNS("g"),a.matteElement.appendChild(a.layerElement),a.matteElement.appendChild(a.transformedElement),a.baseElement=a.matteElement}SVGMatte3Effect.prototype.findSymbol=function(o){for(var s=0,a=_svgMatteSymbols.length;s<a;){if(_svgMatteSymbols[s]===o)return _svgMatteSymbols[s];s+=1}return null},SVGMatte3Effect.prototype.replaceInParent=function(o,s){var a=o.layerElement.parentNode;if(a){for(var et=a.children,tt=0,rt=et.length;tt<rt&&et[tt]!==o.layerElement;)tt+=1;var nt;tt<=rt-2&&(nt=et[tt+1]);var it=createNS("use");it.setAttribute("href","#"+s),nt?a.insertBefore(it,nt):a.appendChild(it)}},SVGMatte3Effect.prototype.setElementAsMask=function(o,s){if(!this.findSymbol(s)){var a=createElementID(),et=createNS("mask");et.setAttribute("id",s.layerId),et.setAttribute("mask-type","alpha"),_svgMatteSymbols.push(s);var tt=o.globalData.defs;tt.appendChild(et);var rt=createNS("symbol");rt.setAttribute("id",a),this.replaceInParent(s,a),rt.appendChild(s.layerElement),tt.appendChild(rt);var nt=createNS("use");nt.setAttribute("href","#"+a),et.appendChild(nt),s.data.hd=!1,s.show()}o.setMatte(s.layerId)},SVGMatte3Effect.prototype.initialize=function(){for(var o=this.filterManager.effectElements[0].p.v,s=this.elem.comp.elements,a=0,et=s.length;a<et;)s[a]&&s[a].data.ind===o&&this.setElementAsMask(this.elem,s[a]),a+=1;this.initialized=!0},SVGMatte3Effect.prototype.renderFrame=function(){this.initialized||this.initialize()};function SVGGaussianBlurEffect(o,s,a,et){o.setAttribute("x","-100%"),o.setAttribute("y","-100%"),o.setAttribute("width","300%"),o.setAttribute("height","300%"),this.filterManager=s;var tt=createNS("feGaussianBlur");tt.setAttribute("result",et),o.appendChild(tt),this.feGaussianBlur=tt}SVGGaussianBlurEffect.prototype.renderFrame=function(o){if(o||this.filterManager._mdf){var s=.3,a=this.filterManager.effectElements[0].p.v*s,et=this.filterManager.effectElements[1].p.v,tt=et==3?0:a,rt=et==2?0:a;this.feGaussianBlur.setAttribute("stdDeviation",tt+" "+rt);var nt=this.filterManager.effectElements[2].p.v==1?"wrap":"duplicate";this.feGaussianBlur.setAttribute("edgeMode",nt)}};function TransformEffect(){}TransformEffect.prototype.init=function(o){this.effectsManager=o,this.type=effectTypes.TRANSFORM_EFFECT,this.matrix=new Matrix,this.opacity=-1,this._mdf=!1,this._opMdf=!1},TransformEffect.prototype.renderFrame=function(o){if(this._opMdf=!1,this._mdf=!1,o||this.effectsManager._mdf){var s=this.effectsManager.effectElements,a=s[0].p.v,et=s[1].p.v,tt=s[2].p.v===1,rt=s[3].p.v,nt=tt?rt:s[4].p.v,it=s[5].p.v,st=s[6].p.v,ot=s[7].p.v;this.matrix.reset(),this.matrix.translate(-a[0],-a[1],a[2]),this.matrix.scale(nt*.01,rt*.01,1),this.matrix.rotate(-ot*degToRads),this.matrix.skewFromAxis(-it*degToRads,(st+90)*degToRads),this.matrix.translate(et[0],et[1],0),this._mdf=!0,this.opacity!==s[8].p.v&&(this.opacity=s[8].p.v,this._opMdf=!0)}};function SVGTransformEffect(o,s){this.init(s)}extendPrototype([TransformEffect],SVGTransformEffect);function CVTransformEffect(o){this.init(o)}return extendPrototype([TransformEffect],CVTransformEffect),registerRenderer("canvas",CanvasRenderer),registerRenderer("html",HybridRenderer),registerRenderer("svg",SVGRenderer),ShapeModifiers.registerModifier("tm",TrimModifier),ShapeModifiers.registerModifier("pb",PuckerAndBloatModifier),ShapeModifiers.registerModifier("rp",RepeaterModifier),ShapeModifiers.registerModifier("rd",RoundCornersModifier),ShapeModifiers.registerModifier("zz",ZigZagModifier),ShapeModifiers.registerModifier("op",OffsetPathModifier),setExpressionsPlugin(Expressions),setExpressionInterfaces(getInterface),initialize$1(),initialize(),registerEffect$1(20,SVGTintFilter,!0),registerEffect$1(21,SVGFillFilter,!0),registerEffect$1(22,SVGStrokeEffect,!1),registerEffect$1(23,SVGTritoneFilter,!0),registerEffect$1(24,SVGProLevelsFilter,!0),registerEffect$1(25,SVGDropShadowEffect,!0),registerEffect$1(28,SVGMatte3Effect,!1),registerEffect$1(29,SVGGaussianBlurEffect,!0),registerEffect$1(35,SVGTransformEffect,!1),registerEffect(35,CVTransformEffect),lottie})})(lottie$1,lottie$1.exports);var lottieExports=lottie$1.exports;const lottie=getDefaultExportFromCjs$2(lottieExports);function _iterableToArrayLimit(o,s){var a=o==null?null:typeof Symbol<"u"&&o[Symbol.iterator]||o["@@iterator"];if(a!=null){var et,tt,rt,nt,it=[],st=!0,ot=!1;try{if(rt=(a=a.call(o)).next,s!==0)for(;!(st=(et=rt.call(a)).done)&&(it.push(et.value),it.length!==s);st=!0);}catch(at){ot=!0,tt=at}finally{try{if(!st&&a.return!=null&&(nt=a.return(),Object(nt)!==nt))return}finally{if(ot)throw tt}}return it}}function ownKeys$2(o,s){var a=Object.keys(o);if(Object.getOwnPropertySymbols){var et=Object.getOwnPropertySymbols(o);s&&(et=et.filter(function(tt){return Object.getOwnPropertyDescriptor(o,tt).enumerable})),a.push.apply(a,et)}return a}function _objectSpread2$2(o){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?ownKeys$2(Object(a),!0).forEach(function(et){_defineProperty$3(o,et,a[et])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(a)):ownKeys$2(Object(a)).forEach(function(et){Object.defineProperty(o,et,Object.getOwnPropertyDescriptor(a,et))})}return o}function _defineProperty$3(o,s,a){return s=_toPropertyKey$2(s),s in o?Object.defineProperty(o,s,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[s]=a,o}function _objectWithoutPropertiesLoose(o,s){if(o==null)return{};var a={},et=Object.keys(o),tt,rt;for(rt=0;rt<et.length;rt++)tt=et[rt],!(s.indexOf(tt)>=0)&&(a[tt]=o[tt]);return a}function _objectWithoutProperties$1(o,s){if(o==null)return{};var a=_objectWithoutPropertiesLoose(o,s),et,tt;if(Object.getOwnPropertySymbols){var rt=Object.getOwnPropertySymbols(o);for(tt=0;tt<rt.length;tt++)et=rt[tt],!(s.indexOf(et)>=0)&&Object.prototype.propertyIsEnumerable.call(o,et)&&(a[et]=o[et])}return a}function _slicedToArray(o,s){return _arrayWithHoles(o)||_iterableToArrayLimit(o,s)||_unsupportedIterableToArray(o,s)||_nonIterableRest()}function _arrayWithHoles(o){if(Array.isArray(o))return o}function _unsupportedIterableToArray(o,s){if(o){if(typeof o=="string")return _arrayLikeToArray(o,s);var a=Object.prototype.toString.call(o).slice(8,-1);if(a==="Object"&&o.constructor&&(a=o.constructor.name),a==="Map"||a==="Set")return Array.from(o);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _arrayLikeToArray(o,s)}}function _arrayLikeToArray(o,s){(s==null||s>o.length)&&(s=o.length);for(var a=0,et=new Array(s);a<s;a++)et[a]=o[a];return et}function _nonIterableRest(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _toPrimitive$2(o,s){if(typeof o!="object"||o===null)return o;var a=o[Symbol.toPrimitive];if(a!==void 0){var et=a.call(o,s||"default");if(typeof et!="object")return et;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(o)}function _toPropertyKey$2(o){var s=_toPrimitive$2(o,"string");return typeof s=="symbol"?s:String(s)}var _excluded$1=["animationData","loop","autoplay","initialSegment","onComplete","onLoopComplete","onEnterFrame","onSegmentStart","onConfigReady","onDataReady","onDataFailed","onLoadedImages","onDOMLoaded","onDestroy","lottieRef","renderer","name","assetsPath","rendererSettings"],useLottie=function o(s,a){var et=s.animationData,tt=s.loop,rt=s.autoplay,nt=s.initialSegment,it=s.onComplete,st=s.onLoopComplete,ot=s.onEnterFrame,at=s.onSegmentStart,lt=s.onConfigReady,ct=s.onDataReady,ht=s.onDataFailed,ft=s.onLoadedImages,dt=s.onDOMLoaded,pt=s.onDestroy;s.lottieRef,s.renderer,s.name,s.assetsPath,s.rendererSettings;var gt=_objectWithoutProperties$1(s,_excluded$1),mt=reactExports.useState(!1),yt=_slicedToArray(mt,2),vt=yt[0],Et=yt[1],xt=reactExports.useRef(),wt=reactExports.useRef(null),Rt=function(){var Gt;(Gt=xt.current)===null||Gt===void 0||Gt.play()},Ct=function(){var Gt;(Gt=xt.current)===null||Gt===void 0||Gt.stop()},Ft=function(){var Gt;(Gt=xt.current)===null||Gt===void 0||Gt.pause()},zt=function(Gt){var Ht;(Ht=xt.current)===null||Ht===void 0||Ht.setSpeed(Gt)},Nt=function(Gt,Ht){var At;(At=xt.current)===null||At===void 0||At.goToAndPlay(Gt,Ht)},Kt=function(Gt,Ht){var At;(At=xt.current)===null||At===void 0||At.goToAndStop(Gt,Ht)},Yt=function(Gt){var Ht;(Ht=xt.current)===null||Ht===void 0||Ht.setDirection(Gt)},Bt=function(Gt,Ht){var At;(At=xt.current)===null||At===void 0||At.playSegments(Gt,Ht)},Pt=function(Gt){var Ht;(Ht=xt.current)===null||Ht===void 0||Ht.setSubframe(Gt)},Dt=function(Gt){var Ht;return(Ht=xt.current)===null||Ht===void 0?void 0:Ht.getDuration(Gt)},Tt=function(){var Gt;(Gt=xt.current)===null||Gt===void 0||Gt.destroy(),xt.current=void 0},St=function(){var Gt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Ht;if(wt.current){(Ht=xt.current)===null||Ht===void 0||Ht.destroy();var At=_objectSpread2$2(_objectSpread2$2(_objectSpread2$2({},s),Gt),{},{container:wt.current});return xt.current=lottie.loadAnimation(At),Et(!!xt.current),function(){var $t;($t=xt.current)===null||$t===void 0||$t.destroy(),xt.current=void 0}}};reactExports.useEffect(function(){var jt=St();return function(){return jt?.()}},[et,tt]),reactExports.useEffect(function(){xt.current&&(xt.current.autoplay=!!rt)},[rt]),reactExports.useEffect(function(){if(xt.current){if(!nt){xt.current.resetSegments(!0);return}!Array.isArray(nt)||!nt.length||((xt.current.currentRawFrame<nt[0]||xt.current.currentRawFrame>nt[1])&&(xt.current.currentRawFrame=nt[0]),xt.current.setSegment(nt[0],nt[1]))}},[nt]),reactExports.useEffect(function(){var jt=[{name:"complete",handler:it},{name:"loopComplete",handler:st},{name:"enterFrame",handler:ot},{name:"segmentStart",handler:at},{name:"config_ready",handler:lt},{name:"data_ready",handler:ct},{name:"data_failed",handler:ht},{name:"loaded_images",handler:ft},{name:"DOMLoaded",handler:dt},{name:"destroy",handler:pt}],Gt=jt.filter(function(At){return At.handler!=null});if(Gt.length){var Ht=Gt.map(function(At){var $t;return($t=xt.current)===null||$t===void 0||$t.addEventListener(At.name,At.handler),function(){var kt;(kt=xt.current)===null||kt===void 0||kt.removeEventListener(At.name,At.handler)}});return function(){Ht.forEach(function(At){return At()})}}},[it,st,ot,at,lt,ct,ht,ft,dt,pt]);var Mt=React.createElement("div",_objectSpread2$2({style:a,ref:wt},gt));return{View:Mt,play:Rt,stop:Ct,pause:Ft,setSpeed:zt,goToAndStop:Kt,goToAndPlay:Nt,setDirection:Yt,playSegments:Bt,setSubframe:Pt,getDuration:Dt,destroy:Tt,animationContainerRef:wt,animationLoaded:vt,animationItem:xt.current}};function getContainerVisibility(o){var s=o.getBoundingClientRect(),a=s.top,et=s.height,tt=window.innerHeight-a,rt=window.innerHeight+et;return tt/rt}function getContainerCursorPosition(o,s,a){var et=o.getBoundingClientRect(),tt=et.top,rt=et.left,nt=et.width,it=et.height,st=(s-rt)/nt,ot=(a-tt)/it;return{x:st,y:ot}}var useInitInteractivity=function o(s){var a=s.wrapperRef,et=s.animationItem,tt=s.mode,rt=s.actions;reactExports.useEffect(function(){var nt=a.current;if(!(!nt||!et||!rt.length)){et.stop();var it=function(){var at=null,lt=function(){var ht=getContainerVisibility(nt),ft=rt.find(function(pt){var gt=pt.visibility;return gt&&ht>=gt[0]&&ht<=gt[1]});if(ft){if(ft.type==="seek"&&ft.visibility&&ft.frames.length===2){var dt=ft.frames[0]+Math.ceil((ht-ft.visibility[0])/(ft.visibility[1]-ft.visibility[0])*ft.frames[1]);//! goToAndStop must be relative to the start of the current segment
et.goToAndStop(dt-et.firstFrame-1,!0)}ft.type==="loop"&&(at===null||at!==ft.frames||et.isPaused)&&(et.playSegments(ft.frames,!0),at=ft.frames),ft.type==="play"&&et.isPaused&&(et.resetSegments(!0),et.play()),ft.type==="stop"&&et.goToAndStop(ft.frames[0]-et.firstFrame-1,!0)}};return document.addEventListener("scroll",lt),function(){document.removeEventListener("scroll",lt)}},st=function(){var at=function(ft,dt){var pt=ft,gt=dt;if(pt!==-1&&gt!==-1){var mt=getContainerCursorPosition(nt,pt,gt);pt=mt.x,gt=mt.y}var yt=rt.find(function(xt){var wt=xt.position;return wt&&Array.isArray(wt.x)&&Array.isArray(wt.y)?pt>=wt.x[0]&&pt<=wt.x[1]&&gt>=wt.y[0]&&gt<=wt.y[1]:wt&&!Number.isNaN(wt.x)&&!Number.isNaN(wt.y)?pt===wt.x&&gt===wt.y:!1});if(yt){if(yt.type==="seek"&&yt.position&&Array.isArray(yt.position.x)&&Array.isArray(yt.position.y)&&yt.frames.length===2){var vt=(pt-yt.position.x[0])/(yt.position.x[1]-yt.position.x[0]),Et=(gt-yt.position.y[0])/(yt.position.y[1]-yt.position.y[0]);et.playSegments(yt.frames,!0),et.goToAndStop(Math.ceil((vt+Et)/2*(yt.frames[1]-yt.frames[0])),!0)}yt.type==="loop"&&et.playSegments(yt.frames,!0),yt.type==="play"&&(et.isPaused&&et.resetSegments(!1),et.playSegments(yt.frames)),yt.type==="stop"&&et.goToAndStop(yt.frames[0],!0)}},lt=function(ft){at(ft.clientX,ft.clientY)},ct=function(){at(-1,-1)};return nt.addEventListener("mousemove",lt),nt.addEventListener("mouseout",ct),function(){nt.removeEventListener("mousemove",lt),nt.removeEventListener("mouseout",ct)}};switch(tt){case"scroll":return it();case"cursor":return st()}}},[tt,et])},useLottieInteractivity=function o(s){var a=s.actions,et=s.mode,tt=s.lottieObj,rt=tt.animationItem,nt=tt.View,it=tt.animationContainerRef;return useInitInteractivity({actions:a,animationItem:rt,mode:et,wrapperRef:it}),nt},_excluded=["style","interactivity"],Lottie=function o(s){var a,et,tt,rt=s.style,nt=s.interactivity,it=_objectWithoutProperties$1(s,_excluded),st=useLottie(it,rt),ot=st.View,at=st.play,lt=st.stop,ct=st.pause,ht=st.setSpeed,ft=st.goToAndStop,dt=st.goToAndPlay,pt=st.setDirection,gt=st.playSegments,mt=st.setSubframe,yt=st.getDuration,vt=st.destroy,Et=st.animationContainerRef,xt=st.animationLoaded,wt=st.animationItem;return reactExports.useEffect(function(){s.lottieRef&&(s.lottieRef.current={play:at,stop:lt,pause:ct,setSpeed:ht,goToAndPlay:dt,goToAndStop:ft,setDirection:pt,playSegments:gt,setSubframe:mt,getDuration:yt,destroy:vt,animationContainerRef:Et,animationLoaded:xt,animationItem:wt})},[(a=s.lottieRef)===null||a===void 0?void 0:a.current]),useLottieInteractivity({lottieObj:{View:ot,play:at,stop:lt,pause:ct,setSpeed:ht,goToAndStop:ft,goToAndPlay:dt,setDirection:pt,playSegments:gt,setSubframe:mt,getDuration:yt,destroy:vt,animationContainerRef:Et,animationLoaded:xt,animationItem:wt},actions:(et=nt?.actions)!==null&&et!==void 0?et:[],mode:(tt=nt?.mode)!==null&&tt!==void 0?tt:"scroll"})};class BarLoader extends React.PureComponent{static get propTypes(){return{showText:PropTypes.bool,stateText:PropTypes.string,statePercent:PropTypes.number.isRequired}}render(){return jsxRuntimeExports.jsxs("div",{className:"center-block valign loading_progress",children:[jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("h3",{className:"font-type-titles align-center white-text loading_title",children:this.props.stateText})}),this.props.statePercent>0&&jsxRuntimeExports.jsx("div",{className:"absolute full-width no-left progress-wrapper",children:jsxRuntimeExports.jsx("div",{className:"progress lighten-1 width-"+this.props.statePercent+"-p",children:jsxRuntimeExports.jsx("div",{className:"determinate amber darken-4"})})}),this.props.statePercent>0&&this.props.showText&&jsxRuntimeExports.jsx("div",{className:"relative top-10 text-center",children:jsxRuntimeExports.jsxs("h3",{className:"font-type-titles white-text loading_subtitle",children:[this.props.statePercent,"%"]})})]})}}const nm="Slack Logo 2",ddd=0,h=444.73,w$1=760.47,meta={g:"LottieFiles Figma v61"},layers=[{ty:0,nm:"Grupo 2",sr:1,st:0,op:193.12,ip:0,hd:!1,ddd:0,bm:0,hasMask:!1,ao:0,ks:{a:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[201.76,142.28],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[201.76,142.28],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[128.5,125.5],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[14,14],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[201.76,142.28],t:192},{s:[201.76,142.28],t:240}]},s:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[100,100],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100,100],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100,100],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100,100],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[100,100],t:192},{s:[100,100],t:240}]},sk:{a:0,k:0},p:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[380.36,223],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[380.36,223],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[379.63,223.22],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[380.36,222.72],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[380.36,223],t:192},{s:[380.36,223],t:240}]},r:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[0],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[180],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[0],t:192},{s:[0],t:240}]},sa:{a:0,k:0},o:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[100],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[100],t:192},{s:[100],t:240}]}},w:760.47,h:444.73,refId:"1",ind:1}],v$1="5.7.0",fr=60,op=192.12,ip=0,assets=[{nm:"[Asset] Grupo 2",id:"1",layers:[{ty:0,nm:"Group 1",sr:1,st:0,op:193.12,ip:0,hd:!1,ddd:0,bm:0,hasMask:!1,ao:0,ks:{a:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[201.76,142.28],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[201.76,142.28],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[128.5,125.5],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[14,14],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[201.76,142.28],t:192},{s:[201.76,142.28],t:240}]},s:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[100,100],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100,100],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100,100],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100,100],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[100,100],t:192},{s:[100,100],t:240}]},sk:{a:0,k:0},p:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[201.76,142.28],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[201.76,142.28],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[128.5,125.5],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[14,14],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[201.76,142.28],t:192},{s:[201.76,142.28],t:240}]},r:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[0],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[0],t:192},{s:[0],t:240}]},sa:{a:0,k:0},o:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[100],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[100],t:192},{s:[100],t:240}]}},ef:[],w:760.47,h:444.73,refId:"2",ind:1}]},{nm:"[Asset] Group 1",id:"2",layers:[{ty:4,nm:"Trazado 7",sr:1,st:0,op:193.12,ip:0,hd:!1,ddd:0,bm:0,hasMask:!1,ao:0,ks:{a:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[53.16,82.09],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[53.16,82.09],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[14,14],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[14,14],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[53.16,82.09],t:192},{s:[53.16,82.09],t:240}]},s:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[100,100],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100,100],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100,100],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100,100],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[100,100],t:192},{s:[100,100],t:240}]},sk:{a:0,k:0},p:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[203.73,82.09],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[203.73,82.09],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[134,14],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[14,14],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[203.73,82.09],t:192},{s:[203.73,82.09],t:240}]},r:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[0],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[0],t:192},{s:[0],t:240}]},sa:{a:0,k:0},o:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[90],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[90],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[90],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[90],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[90],t:192},{s:[90],t:240}]}},ef:[],shapes:[{ty:"sh",bm:0,hd:!1,nm:"",d:1,ks:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[{c:!0,i:[[0,0],[0,0],[.89,2.77],[.89,2.77],[0,0],[-10.85,0],[0,0],[3.37,-10.34],[0,0]],o:[[-.9,2.77],[-.9,2.77],[0,0],[0,0],[-3.32,-10.33],[0,0],[10.88,0],[0,0],[0,0]],v:[[55.69,155.37],[55.69,155.37],[49.98,155.36],[49.98,155.36],[6.72,20.9],[21.95,0],[84.28,0],[99.49,20.96],[55.69,155.37]]}],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[{c:!0,i:[[0,0],[0,0],[.89,2.77],[.89,2.77],[0,0],[-10.85,0],[0,0],[3.37,-10.34],[0,0]],o:[[-.9,2.77],[-.9,2.77],[0,0],[0,0],[-3.32,-10.33],[0,0],[10.88,0],[0,0],[0,0]],v:[[55.69,155.37],[55.69,155.37],[49.98,155.36],[49.98,155.36],[6.72,20.9],[21.95,0],[84.28,0],[99.49,20.96],[55.69,155.37]]}],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[{c:!0,i:[[0,0],[0,7.73],[0,0],[-7.73,0],[0,0],[0,-7.73],[0,0],[7.73,0],[0,0]],o:[[-7.73,0],[0,0],[0,-7.73],[0,0],[7.73,0],[0,0],[0,7.73],[0,0],[0,0]],v:[[14,28],[0,14],[0,14],[14,0],[14,0],[28,14],[28,14],[14,28],[14,28]]}],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[{c:!0,i:[[0,0],[0,7.73],[0,0],[-7.73,0],[0,0],[0,-7.73],[0,0],[7.73,0],[0,0]],o:[[-7.73,0],[0,0],[0,-7.73],[0,0],[7.73,0],[0,0],[0,7.73],[0,0],[0,0]],v:[[14,28],[0,14],[0,14],[14,0],[14,0],[28,14],[28,14],[14,28],[14,28]]}],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[{c:!0,i:[[0,0],[0,0],[.89,2.77],[.89,2.77],[0,0],[-10.85,0],[0,0],[3.37,-10.34],[0,0]],o:[[-.9,2.77],[-.9,2.77],[0,0],[0,0],[-3.32,-10.33],[0,0],[10.88,0],[0,0],[0,0]],v:[[55.69,155.37],[55.69,155.37],[49.98,155.36],[49.98,155.36],[6.72,20.9],[21.95,0],[84.28,0],[99.49,20.96],[55.69,155.37]]}],t:192},{s:[{c:!0,i:[[0,0],[0,0],[.89,2.77],[.89,2.77],[0,0],[-10.85,0],[0,0],[3.37,-10.34],[0,0]],o:[[-.9,2.77],[-.9,2.77],[0,0],[0,0],[-3.32,-10.33],[0,0],[10.88,0],[0,0],[0,0]],v:[[55.69,155.37],[55.69,155.37],[49.98,155.36],[49.98,155.36],[6.72,20.9],[21.95,0],[84.28,0],[99.49,20.96],[55.69,155.37]]}],t:240}]}},{ty:"gf",bm:0,hd:!1,nm:"",e:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[48.25749969482422,136.05499267578125],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[48.25749969482422,136.05499267578125],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[14.024999618530273,23.539899826049805],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[14.024999618530273,23.539899826049805],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[48.25749969482422,136.05499267578125],t:192},{s:[48.25749969482422,136.05499267578125],t:240}]},g:{p:2,k:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[0,.13729412436719032,.5725882607721815,.7569019752764234,1,.203960787060214,.6000392395281324,.5843529659533033],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0,.13729412436719032,.5725882607721815,.7569019752764234,1,.203960787060214,.6000392395281324,.5843529659533033],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0,.13729412436719032,.5725882607721815,.7569019752764234,1,.203960787060214,.6000392395281324,.5843529659533033],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0,.13729412436719032,.5725882607721815,.7569019752764234,1,.203960787060214,.6000392395281324,.5843529659533033],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[0,.13729412436719032,.5725882607721815,.7569019752764234,1,.203960787060214,.6000392395281324,.5843529659533033],t:192},{s:[0,.13729412436719032,.5725882607721815,.7569019752764234,1,.203960787060214,.6000392395281324,.5843529659533033],t:240}]}},t:1,a:{a:0,k:0},h:{a:0,k:0},s:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[48.25749969482422,9.161930084228516],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[48.25749969482422,9.161930084228516],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[14.024999618530273,1.5851800441741943],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[14.024999618530273,1.5851800441741943],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[48.25749969482422,9.161930084228516],t:192},{s:[48.25749969482422,9.161930084228516],t:240}]},r:1,o:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[100],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[100],t:192},{s:[100],t:240}]}}],ind:1},{ty:4,nm:"Trazado 5",sr:1,st:0,op:193.12,ip:0,hd:!1,ddd:0,bm:0,hasMask:!1,ao:0,ks:{a:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[89.92,142.28],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[89.92,142.28],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[14,14],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[14,14],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[89.92,142.28],t:192},{s:[89.92,142.28],t:240}]},s:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[100,100],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100,100],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100,100],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100,100],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[100,100],t:192},{s:[100,100],t:240}]},sk:{a:0,k:0},p:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[89.92,142.28],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[89.92,142.28],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[14,110],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[14,14],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[89.92,142.28],t:192},{s:[89.92,142.28],t:240}]},r:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[0],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[0],t:192},{s:[0],t:240}]},sa:{a:0,k:0},o:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[90],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[90],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[90],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[90],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[90],t:192},{s:[90],t:240}]}},ef:[],shapes:[{ty:"sh",bm:0,hd:!1,nm:"",d:1,ks:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[{c:!0,i:[[0,0],[0,0],[-4.03,-12.88],[0,0],[-8.75,0],[0,0],[4.07,12.89],[0,0],[8.72,0],[0,0]],o:[[-13.49,0],[-13.49,0],[0,0],[2.61,8.35],[0,0],[13.52,0],[0,0],[-2.63,-8.32],[0,0],[0,0]],v:[[27.2,0],[27.2,0],[8.12,25.97],[84.55,270.52],[103.64,284.55],[152.54,284.55],[171.61,258.53],[94.32,13.97],[75.25,0],[27.2,0]]}],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[{c:!0,i:[[0,0],[0,0],[-4.03,-12.88],[0,0],[-8.75,0],[0,0],[4.07,12.89],[0,0],[8.72,0],[0,0]],o:[[-13.49,0],[-13.49,0],[0,0],[2.61,8.35],[0,0],[13.52,0],[0,0],[-2.63,-8.32],[0,0],[0,0]],v:[[27.2,0],[27.2,0],[8.12,25.97],[84.55,270.52],[103.64,284.55],[152.54,284.55],[171.61,258.53],[94.32,13.97],[75.25,0],[27.2,0]]}],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[{c:!0,i:[[0,0],[0,-7.73],[0,0],[-7.73,0],[0,0],[0,0],[0,7.73],[0,0],[7.73,0],[0,0]],o:[[-7.73,0],[0,0],[0,7.73],[0,0],[0,0],[7.73,0],[0,0],[0,-7.73],[0,0],[0,0]],v:[[14,0],[0,14],[0,14],[14,28],[14,28],[14,28],[28,14],[28,14],[14,0],[14,0]]}],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[{c:!0,i:[[0,0],[0,-7.73],[0,0],[-7.73,0],[0,0],[0,0],[0,7.73],[0,0],[7.73,0],[0,0]],o:[[-7.73,0],[0,0],[0,7.73],[0,0],[0,0],[7.73,0],[0,0],[0,-7.73],[0,0],[0,0]],v:[[14,0],[0,14],[0,14],[14,28],[14,28],[14,28],[28,14],[28,14],[14,0],[14,0]]}],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[{c:!0,i:[[0,0],[0,0],[-4.03,-12.88],[0,0],[-8.75,0],[0,0],[4.07,12.89],[0,0],[8.72,0],[0,0]],o:[[-13.49,0],[-13.49,0],[0,0],[2.61,8.35],[0,0],[13.52,0],[0,0],[-2.63,-8.32],[0,0],[0,0]],v:[[27.2,0],[27.2,0],[8.12,25.97],[84.55,270.52],[103.64,284.55],[152.54,284.55],[171.61,258.53],[94.32,13.97],[75.25,0],[27.2,0]]}],t:192},{s:[{c:!0,i:[[0,0],[0,0],[-4.03,-12.88],[0,0],[-8.75,0],[0,0],[4.07,12.89],[0,0],[8.72,0],[0,0]],o:[[-13.49,0],[-13.49,0],[0,0],[2.61,8.35],[0,0],[13.52,0],[0,0],[-2.63,-8.32],[0,0],[0,0]],v:[[27.2,0],[27.2,0],[8.12,25.97],[84.55,270.52],[103.64,284.55],[152.54,284.55],[171.61,258.53],[94.32,13.97],[75.25,0],[27.2,0]]}],t:240}]}},{ty:"gf",bm:0,hd:!1,nm:"",e:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[116.76200103759766,263.3290100097656],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[116.76200103759766,263.3290100097656],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[-9.580479621887207,27.907499313354492],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[-9.580479621887207,27.907499313354492],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[116.76200103759766,263.3290100097656],t:192},{s:[116.76200103759766,263.3290100097656],t:240}]},g:{p:2,k:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[0,.14905882954831215,.6980784493708143,.99219607889886,1,.6470980602526197,.08631372779841517,.5294510084414015],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0,.14905882954831215,.6980784493708143,.99219607889886,1,.6470980602526197,.08631372779841517,.5294510084414015],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0,.14905882954831215,.6980784493708143,.99219607889886,1,.6470980602526197,.08631372779841517,.5294510084414015],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0,.14905882954831215,.6980784493708143,.99219607889886,1,.6470980602526197,.08631372779841517,.5294510084414015],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[0,.14905882954831215,.6980784493708143,.99219607889886,1,.6470980602526197,.08631372779841517,.5294510084414015],t:192},{s:[0,.14905882954831215,.6980784493708143,.99219607889886,1,.6470980602526197,.08631372779841517,.5294510084414015],t:240}]}},t:1,a:{a:0,k:0},h:{a:0,k:0},s:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[42.62710189819336,22.370399475097656],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[42.62710189819336,22.370399475097656],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[-12.107000350952148,2.201230049133301],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[-12.107000350952148,2.201230049133301],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[42.62710189819336,22.370399475097656],t:192},{s:[42.62710189819336,22.370399475097656],t:240}]},r:1,o:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[100],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[100],t:192},{s:[100],t:240}]}}],ind:2},{ty:4,nm:"Trazado 3",sr:1,st:0,op:193.12,ip:0,hd:!1,ddd:0,bm:0,hasMask:!1,ao:0,ks:{a:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[88.44,142.28],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[88.44,142.28],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[14,14],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[14,14],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[88.44,142.28],t:192},{s:[88.44,142.28],t:240}]},s:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[100,100],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100,100],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100,100],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100,100],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[100,100],t:192},{s:[100,100],t:240}]},sk:{a:0,k:0},p:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[315.08,142.28],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[315.08,142.28],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[243,96],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[14,14],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[315.08,142.28],t:192},{s:[315.08,142.28],t:240}]},r:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[0],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[0],t:192},{s:[0],t:240}]},sa:{a:0,k:0},o:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[90],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[90],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[90],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[90],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[90],t:192},{s:[90],t:240}]}},ef:[],shapes:[{ty:"sh",bm:0,hd:!1,nm:"",d:1,ks:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[{c:!0,i:[[0,0],[3.9,-12.84],[0,0],[8.81,0],[0,0],[-4.08,12.89],[0,0],[-8.72,0],[0,0]],o:[[13.42,0],[0,0],[-2.56,8.43],[0,0],[-13.52,0],[0,0],[2.63,-8.32],[0,0],[0,0]],v:[[149.92,0],[169.05,25.81],[94.88,270.36],[75.74,284.55],[27.3,284.55],[8.23,258.52],[85.6,13.97],[104.66,0],[149.92,0]]}],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[{c:!0,i:[[0,0],[3.9,-12.84],[0,0],[8.81,0],[0,0],[-4.08,12.89],[0,0],[-8.72,0],[0,0]],o:[[13.42,0],[0,0],[-2.56,8.43],[0,0],[-13.52,0],[0,0],[2.63,-8.32],[0,0],[0,0]],v:[[149.92,0],[169.05,25.81],[94.88,270.36],[75.74,284.55],[27.3,284.55],[8.23,258.52],[85.6,13.97],[104.66,0],[149.92,0]]}],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[{c:!0,i:[[0,0],[0,-7.73],[0,0],[7.73,0],[0,0],[0,7.73],[0,0],[-7.73,0],[0,0]],o:[[7.73,0],[0,0],[0,7.73],[0,0],[-7.73,0],[0,0],[0,-7.73],[0,0],[0,0]],v:[[14,0],[28,14],[28,14],[14,28],[14,28],[0,14],[0,14],[14,0],[14,0]]}],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[{c:!0,i:[[0,0],[0,-7.73],[0,0],[7.73,0],[0,0],[0,7.73],[0,0],[-7.73,0],[0,0]],o:[[7.73,0],[0,0],[0,7.73],[0,0],[-7.73,0],[0,0],[0,-7.73],[0,0],[0,0]],v:[[14,0],[28,14],[28,14],[14,28],[14,28],[0,14],[0,14],[14,0],[14,0]]}],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[{c:!0,i:[[0,0],[3.9,-12.84],[0,0],[8.81,0],[0,0],[-4.08,12.89],[0,0],[-8.72,0],[0,0]],o:[[13.42,0],[0,0],[-2.56,8.43],[0,0],[-13.52,0],[0,0],[2.63,-8.32],[0,0],[0,0]],v:[[149.92,0],[169.05,25.81],[94.88,270.36],[75.74,284.55],[27.3,284.55],[8.23,258.52],[85.6,13.97],[104.66,0],[149.92,0]]}],t:192},{s:[{c:!0,i:[[0,0],[3.9,-12.84],[0,0],[8.81,0],[0,0],[-4.08,12.89],[0,0],[-8.72,0],[0,0]],o:[[13.42,0],[0,0],[-2.56,8.43],[0,0],[-13.52,0],[0,0],[2.63,-8.32],[0,0],[0,0]],v:[[149.92,0],[169.05,25.81],[94.88,270.36],[75.74,284.55],[27.3,284.55],[8.23,258.52],[85.6,13.97],[104.66,0],[149.92,0]]}],t:240}]}},{ty:"gf",bm:0,hd:!1,nm:"",e:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[53.29999923706055,266.61199951171875],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[53.29999923706055,266.61199951171875],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[32.12689971923828,29.94529914855957],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[32.12689971923828,29.94529914855957],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[53.29999923706055,266.61199951171875],t:192},{s:[53.29999923706055,266.61199951171875],t:240}]},g:{p:2,k:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[0,.9961176472925672,.6000392395281324,39215686274509805e-21,1,.7451372700953016,39215686274509805e-21,.4784705895208845],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0,.9961176472925672,.6000392395281324,39215686274509805e-21,1,.7451372700953016,39215686274509805e-21,.4784705895208845],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0,.9961176472925672,.6000392395281324,39215686274509805e-21,1,.7451372700953016,39215686274509805e-21,.4784705895208845],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0,.9961176472925672,.6000392395281324,39215686274509805e-21,1,.7451372700953016,39215686274509805e-21,.4784705895208845],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[0,.9961176472925672,.6000392395281324,39215686274509805e-21,1,.7451372700953016,39215686274509805e-21,.4784705895208845],t:192},{s:[0,.9961176472925672,.6000392395281324,39215686274509805e-21,1,.7451372700953016,39215686274509805e-21,.4784705895208845],t:240}]}},t:1,a:{a:0,k:0},h:{a:0,k:0},s:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[118.73100280761719,15.804300308227539],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[118.73100280761719,15.804300308227539],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[33.93899917602539,1.6747599840164185],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[33.93899917602539,1.6747599840164185],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[118.73100280761719,15.804300308227539],t:192},{s:[118.73100280761719,15.804300308227539],t:240}]},r:1,o:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[100],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[100],t:192},{s:[100],t:240}]}}],ind:3},{ty:4,nm:"Trazado 4",sr:1,st:0,op:193.12,ip:0,hd:!1,ddd:0,bm:0,hasMask:!1,ao:0,ks:{a:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[84.86,142.28],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[84.86,142.28],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[14,14],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[14,14],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[84.86,142.28],t:192},{s:[84.86,142.28],t:240}]},s:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[100,100],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100,100],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100,100],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100,100],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[100,100],t:192},{s:[100,100],t:240}]},sk:{a:0,k:0},p:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[243.94,142.28],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[243.94,142.28],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[229,223],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[14,14],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[243.94,142.28],t:192},{s:[243.94,142.28],t:240}]},r:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[0],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[0],t:192},{s:[0],t:240}]},sa:{a:0,k:0},o:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[90],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[90],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[90],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[90],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[90],t:192},{s:[90],t:240}]}},ef:[],shapes:[{ty:"sh",bm:0,hd:!1,nm:"",d:1,ks:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[{c:!0,i:[[0,0],[3.6,12.76],[0,0],[8.95,0],[0,0],[-3.57,-12.75],[0,0],[-8.97,0],[0,0]],o:[[13.26,0],[0,0],[-2.43,-8.62],[0,0],[-13.24,0],[0,0],[2.42,8.64],[0,0],[0,0]],v:[[143.3,284.55],[162.55,259.12],[93.52,14.57],[74.27,0],[26.37,0],[7.11,25.39],[75.54,269.94],[94.8,284.55],[143.3,284.55]]}],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[{c:!0,i:[[0,0],[3.6,12.76],[0,0],[8.95,0],[0,0],[-3.57,-12.75],[0,0],[-8.97,0],[0,0]],o:[[13.26,0],[0,0],[-2.43,-8.62],[0,0],[-13.24,0],[0,0],[2.42,8.64],[0,0],[0,0]],v:[[143.3,284.55],[162.55,259.12],[93.52,14.57],[74.27,0],[26.37,0],[7.11,25.39],[75.54,269.94],[94.8,284.55],[143.3,284.55]]}],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[{c:!0,i:[[0,0],[0,7.73],[0,0],[7.73,0],[0,0],[0,-7.73],[0,0],[-7.73,0],[0,0]],o:[[7.73,0],[0,0],[0,-7.73],[0,0],[-7.73,0],[0,0],[0,7.73],[0,0],[0,0]],v:[[14,28],[28,14],[28,14],[14,0],[14,0],[0,14],[0,14],[14,28],[14,28]]}],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[{c:!0,i:[[0,0],[0,7.73],[0,0],[7.73,0],[0,0],[0,-7.73],[0,0],[-7.73,0],[0,0]],o:[[7.73,0],[0,0],[0,-7.73],[0,0],[-7.73,0],[0,0],[0,7.73],[0,0],[0,0]],v:[[14,28],[28,14],[28,14],[14,0],[14,0],[0,14],[0,14],[14,28],[14,28]]}],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[{c:!0,i:[[0,0],[3.6,12.76],[0,0],[8.95,0],[0,0],[-3.57,-12.75],[0,0],[-8.97,0],[0,0]],o:[[13.26,0],[0,0],[-2.43,-8.62],[0,0],[-13.24,0],[0,0],[2.42,8.64],[0,0],[0,0]],v:[[143.3,284.55],[162.55,259.12],[93.52,14.57],[74.27,0],[26.37,0],[7.11,25.39],[75.54,269.94],[94.8,284.55],[143.3,284.55]]}],t:192},{s:[{c:!0,i:[[0,0],[3.6,12.76],[0,0],[8.95,0],[0,0],[-3.57,-12.75],[0,0],[-8.97,0],[0,0]],o:[[13.26,0],[0,0],[-2.43,-8.62],[0,0],[-13.24,0],[0,0],[2.42,8.64],[0,0],[0,0]],v:[[143.3,284.55],[162.55,259.12],[93.52,14.57],[74.27,0],[26.37,0],[7.11,25.39],[75.54,269.94],[94.8,284.55],[143.3,284.55]]}],t:240}]}},{ty:"gf",bm:0,hd:!1,nm:"",e:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[116.00599670410156,265.5429992675781],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[116.00599670410156,265.5429992675781],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[-5.288020133972168,27.727399826049805],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[-5.288020133972168,27.727399826049805],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[116.00599670410156,265.5429992675781],t:192},{s:[116.00599670410156,265.5429992675781],t:240}]},g:{p:2,k:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[0,.25101962268586253,.7294509965204725,.7098431545519361,1,.40788235843415355,.7804313856386671,.286313738229228],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0,.25101962268586253,.7294509965204725,.7098431545519361,1,.40788235843415355,.7804313856386671,.286313738229228],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0,.25101962268586253,.7294509965204725,.7098431545519361,1,.40788235843415355,.7804313856386671,.286313738229228],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0,.25101962268586253,.7294509965204725,.7098431545519361,1,.40788235843415355,.7804313856386671,.286313738229228],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[0,.25101962268586253,.7294509965204725,.7098431545519361,1,.40788235843415355,.7804313856386671,.286313738229228],t:192},{s:[0,.25101962268586253,.7294509965204725,.7098431545519361,1,.40788235843415355,.7804313856386671,.286313738229228],t:240}]}},t:1,a:{a:0,k:0},h:{a:0,k:0},s:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[49.50600051879883,22.370399475097656],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[49.50600051879883,22.370399475097656],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[-7.498149871826172,2.201230049133301],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[-7.498149871826172,2.201230049133301],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[49.50600051879883,22.370399475097656],t:192},{s:[49.50600051879883,22.370399475097656],t:240}]},r:1,o:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[100],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[100],t:192},{s:[100],t:240}]}}],ind:4},{ty:4,nm:"Trazado 6",sr:1,st:0,op:193.12,ip:0,hd:!1,ddd:0,bm:0,hasMask:!1,ao:0,ks:{a:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[85.66,142.28],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[85.66,142.28],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[14,14],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[14,14],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[85.66,142.28],t:192},{s:[85.66,142.28],t:240}]},s:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[100,100],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100,100],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100,100],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100,100],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[100,100],t:192},{s:[100,100],t:240}]},sk:{a:0,k:0},p:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[162.82,142.28],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[162.82,142.28],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[74,237],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[14,14],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[162.82,142.28],t:192},{s:[162.82,142.28],t:240}]},r:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[0],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[0],t:192},{s:[0],t:240}]},sa:{a:0,k:0},o:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[90],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[90],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[90],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[90],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[90],t:192},{s:[90],t:240}]}},ef:[],shapes:[{ty:"sh",bm:0,hd:!1,nm:"",d:1,ks:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[{c:!0,i:[[0,0],[-3.68,12.79],[0,0],[-8.91,0],[0,0],[3.64,-12.77],[0,0],[8.93,-.01],[0,0]],o:[[-13.31,.01],[0,0],[2.47,-8.57],[0,0],[13.28,0],[0,0],[-2.45,8.59],[0,0],[0,0]],v:[[26.59,284.53],[7.36,259],[77.76,14.47],[96.98,0],[144.83,0],[164.07,25.48],[94.38,269.97],[75.16,284.49],[26.59,284.53]]}],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[{c:!0,i:[[0,0],[-3.68,12.79],[0,0],[-8.91,0],[0,0],[3.64,-12.77],[0,0],[8.93,-.01],[0,0]],o:[[-13.31,.01],[0,0],[2.47,-8.57],[0,0],[13.28,0],[0,0],[-2.45,8.59],[0,0],[0,0]],v:[[26.59,284.53],[7.36,259],[77.76,14.47],[96.98,0],[144.83,0],[164.07,25.48],[94.38,269.97],[75.16,284.49],[26.59,284.53]]}],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[{c:!0,i:[[0,0],[0,7.73],[0,0],[-7.73,0],[0,0],[0,-7.73],[0,0],[7.73,0],[0,0]],o:[[-7.73,0],[0,0],[0,-7.73],[0,0],[7.73,0],[0,0],[0,7.73],[0,0],[0,0]],v:[[14,28],[0,14],[0,14],[14,0],[14,0],[28,14],[28,14],[14,28],[14,28]]}],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[{c:!0,i:[[0,0],[0,7.73],[0,0],[-7.73,0],[0,0],[0,-7.73],[0,0],[7.73,0],[0,0]],o:[[-7.73,0],[0,0],[0,-7.73],[0,0],[7.73,0],[0,0],[0,7.73],[0,0],[0,0]],v:[[14,28],[0,14],[0,14],[14,0],[14,0],[28,14],[28,14],[14,28],[14,28]]}],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[{c:!0,i:[[0,0],[-3.68,12.79],[0,0],[-8.91,0],[0,0],[3.64,-12.77],[0,0],[8.93,-.01],[0,0]],o:[[-13.31,.01],[0,0],[2.47,-8.57],[0,0],[13.28,0],[0,0],[-2.45,8.59],[0,0],[0,0]],v:[[26.59,284.53],[7.36,259],[77.76,14.47],[96.98,0],[144.83,0],[164.07,25.48],[94.38,269.97],[75.16,284.49],[26.59,284.53]]}],t:192},{s:[{c:!0,i:[[0,0],[-3.68,12.79],[0,0],[-8.91,0],[0,0],[3.64,-12.77],[0,0],[8.93,-.01],[0,0]],o:[[-13.31,.01],[0,0],[2.47,-8.57],[0,0],[13.28,0],[0,0],[-2.45,8.59],[0,0],[0,0]],v:[[26.59,284.53],[7.36,259],[77.76,14.47],[96.98,0],[144.83,0],[164.07,25.48],[94.38,269.97],[75.16,284.49],[26.59,284.53]]}],t:240}]}},{ty:"gf",bm:0,hd:!1,nm:"",e:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[44.23789978027344,266.61199951171875],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[44.23789978027344,266.61199951171875],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[26.26849937438965,27.93079948425293],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[26.26849937438965,27.93079948425293],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[44.23789978027344,266.61199951171875],t:192},{s:[44.23789978027344,266.61199951171875],t:240}]},g:{p:2,k:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[0,.28239216983552073,.7333725649141798,.8274902063631544,1,.7569019752764234,.851019616725398,.2745490330481062],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0,.28239216983552073,.7333725649141798,.8274902063631544,1,.7569019752764234,.851019616725398,.2745490330481062],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0,.28239216983552073,.7333725649141798,.8274902063631544,1,.7569019752764234,.851019616725398,.2745490330481062],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[0,.28239216983552073,.7333725649141798,.8274902063631544,1,.7569019752764234,.851019616725398,.2745490330481062],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[0,.28239216983552073,.7333725649141798,.8274902063631544,1,.7569019752764234,.851019616725398,.2745490330481062],t:192},{s:[0,.28239216983552073,.7333725649141798,.8274902063631544,1,.7569019752764234,.851019616725398,.2745490330481062],t:240}]}},t:1,a:{a:0,k:0},h:{a:0,k:0},s:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[115.08999633789062,21.30150032043457],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[115.08999633789062,21.30150032043457],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[28.977699279785156,3.6565299034118652],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[28.977699279785156,3.6565299034118652],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[115.08999633789062,21.30150032043457],t:192},{s:[115.08999633789062,21.30150032043457],t:240}]},r:1,o:{a:1,k:[{o:{x:.87,y:0},i:{x:.13,y:1},s:[100],t:0},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100],t:48},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100],t:108},{o:{x:.87,y:0},i:{x:.13,y:1},s:[100],t:132},{o:{x:0,y:0},i:{x:1,y:1},s:[100],t:192},{s:[100],t:240}]}}],ind:5}]}],loaderAnimation={nm,ddd,h,w:w$1,meta,layers,v:v$1,fr,op,ip,assets};class MainLoader extends React.Component{shouldComponentUpdate(s){return!Object.is(s?.percent,this.props.percent)||!Object.is(s.content,this.props.content)}render(){return jsxRuntimeExports.jsxs("div",{className:"absolute full-height full-width loading-box has-main-background valign-wrapper",children:[this.props.percent?jsxRuntimeExports.jsx("div",{className:"main-loader-bar",children:jsxRuntimeExports.jsx(BarLoader,{statePercent:this.props.percent})}):jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{}),jsxRuntimeExports.jsx("div",{className:"center-block valign",children:jsxRuntimeExports.jsxs("div",{className:"main-loader-content",children:[jsxRuntimeExports.jsx(Lottie,{animationData:loaderAnimation,loop:!0,autoPlay:!0,style:{width:200,height:200}}),this.props.content?jsxRuntimeExports.jsx(Typography,{variant:"h5",color:"#D1D2D3",sx:{marginTop:-5},children:this.props.content}):jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{})]})})]})}}var Close$1={},createSvgIcon={};const require$$0=getAugmentedNamespace(utils);var hasRequiredCreateSvgIcon;function requireCreateSvgIcon(){return hasRequiredCreateSvgIcon||(hasRequiredCreateSvgIcon=1,function(o){"use client";Object.defineProperty(o,"__esModule",{value:!0}),Object.defineProperty(o,"default",{enumerable:!0,get:function(){return s.createSvgIcon}});var s=require$$0}(createSvgIcon)),createSvgIcon}var _interopRequireDefault$1=interopRequireDefaultExports;Object.defineProperty(Close$1,"__esModule",{value:!0});var default_1=Close$1.default=void 0,_createSvgIcon=_interopRequireDefault$1(requireCreateSvgIcon()),_jsxRuntime=jsxRuntimeExports;default_1=Close$1.default=(0,_createSvgIcon.default)((0,_jsxRuntime.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");function _defineProperty$1(o,s,a){return(s=_toPropertyKey$1(s))in o?Object.defineProperty(o,s,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[s]=a,o}function _toPrimitive$1(o,s){if(typeof o!="object"||o===null)return o;var a=o[Symbol.toPrimitive];if(a!==void 0){var et=a.call(o,s||"default");if(typeof et!="object")return et;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(o)}function _toPropertyKey$1(o){var s=_toPrimitive$1(o,"string");return typeof s=="symbol"?s:String(s)}function _classCallCheck(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")}function _defineProperties(o,s){for(var a=0;a<s.length;a++){var et=s[a];et.enumerable=et.enumerable||!1,et.configurable=!0,"value"in et&&(et.writable=!0),Object.defineProperty(o,et.key,et)}}function _createClass(o,s,a){return s&&_defineProperties(o.prototype,s),a&&_defineProperties(o,a),o}function _defineProperty$2(o,s,a){return s in o?Object.defineProperty(o,s,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[s]=a,o}function ownKeys$1(o,s){var a=Object.keys(o);if(Object.getOwnPropertySymbols){var et=Object.getOwnPropertySymbols(o);s&&(et=et.filter(function(tt){return Object.getOwnPropertyDescriptor(o,tt).enumerable})),a.push.apply(a,et)}return a}function _objectSpread2$1(o){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?ownKeys$1(Object(a),!0).forEach(function(et){_defineProperty$2(o,et,a[et])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(a)):ownKeys$1(Object(a)).forEach(function(et){Object.defineProperty(o,et,Object.getOwnPropertyDescriptor(a,et))})}return o}var defaults$1={addCSS:!0,thumbWidth:15,watch:!0};function matches$1(o,s){return function(){return Array.from(document.querySelectorAll(s)).includes(this)}.call(o,s)}function trigger(o,s){if(o&&s){var a=new Event(s,{bubbles:!0});o.dispatchEvent(a)}}var getConstructor$1=function(o){return o!=null?o.constructor:null},instanceOf$1=function(o,s){return!!(o&&s&&o instanceof s)},isNullOrUndefined$1=function(o){return o==null},isObject$1=function(o){return getConstructor$1(o)===Object},isNumber$1=function(o){return getConstructor$1(o)===Number&&!Number.isNaN(o)},isString$1=function(o){return getConstructor$1(o)===String},isBoolean$1=function(o){return getConstructor$1(o)===Boolean},isFunction$1=function(o){return getConstructor$1(o)===Function},isArray$1=function(o){return Array.isArray(o)},isNodeList$1=function(o){return instanceOf$1(o,NodeList)},isElement$1=function(o){return instanceOf$1(o,Element)},isEvent$1=function(o){return instanceOf$1(o,Event)},isEmpty$1=function(o){return isNullOrUndefined$1(o)||(isString$1(o)||isArray$1(o)||isNodeList$1(o))&&!o.length||isObject$1(o)&&!Object.keys(o).length},is$1={nullOrUndefined:isNullOrUndefined$1,object:isObject$1,number:isNumber$1,string:isString$1,boolean:isBoolean$1,function:isFunction$1,array:isArray$1,nodeList:isNodeList$1,element:isElement$1,event:isEvent$1,empty:isEmpty$1};function getDecimalPlaces(o){var s="".concat(o).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return s?Math.max(0,(s[1]?s[1].length:0)-(s[2]?+s[2]:0)):0}function round(o,s){if(1>s){var a=getDecimalPlaces(s);return parseFloat(o.toFixed(a))}return Math.round(o/s)*s}var RangeTouch=function(){function o(s,a){_classCallCheck(this,o),is$1.element(s)?this.element=s:is$1.string(s)&&(this.element=document.querySelector(s)),is$1.element(this.element)&&is$1.empty(this.element.rangeTouch)&&(this.config=_objectSpread2$1({},defaults$1,{},a),this.init())}return _createClass(o,[{key:"init",value:function(){o.enabled&&(this.config.addCSS&&(this.element.style.userSelect="none",this.element.style.webKitUserSelect="none",this.element.style.touchAction="manipulation"),this.listeners(!0),this.element.rangeTouch=this)}},{key:"destroy",value:function(){o.enabled&&(this.config.addCSS&&(this.element.style.userSelect="",this.element.style.webKitUserSelect="",this.element.style.touchAction=""),this.listeners(!1),this.element.rangeTouch=null)}},{key:"listeners",value:function(s){var a=this,et=s?"addEventListener":"removeEventListener";["touchstart","touchmove","touchend"].forEach(function(tt){a.element[et](tt,function(rt){return a.set(rt)},!1)})}},{key:"get",value:function(s){if(!o.enabled||!is$1.event(s))return null;var a,et=s.target,tt=s.changedTouches[0],rt=parseFloat(et.getAttribute("min"))||0,nt=parseFloat(et.getAttribute("max"))||100,it=parseFloat(et.getAttribute("step"))||1,st=et.getBoundingClientRect(),ot=100/st.width*(this.config.thumbWidth/2)/100;return 0>(a=100/st.width*(tt.clientX-st.left))?a=0:100<a&&(a=100),50>a?a-=(100-2*a)*ot:50<a&&(a+=2*(a-50)*ot),rt+round(a/100*(nt-rt),it)}},{key:"set",value:function(s){o.enabled&&is$1.event(s)&&!s.target.disabled&&(s.preventDefault(),s.target.value=this.get(s),trigger(s.target,s.type==="touchend"?"change":"input"))}}],[{key:"setup",value:function(s){var a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},et=null;if(is$1.empty(s)||is$1.string(s)?et=Array.from(document.querySelectorAll(is$1.string(s)?s:'input[type="range"]')):is$1.element(s)?et=[s]:is$1.nodeList(s)?et=Array.from(s):is$1.array(s)&&(et=s.filter(is$1.element)),is$1.empty(et))return null;var tt=_objectSpread2$1({},defaults$1,{},a);if(is$1.string(s)&&tt.watch){var rt=new MutationObserver(function(nt){Array.from(nt).forEach(function(it){Array.from(it.addedNodes).forEach(function(st){is$1.element(st)&&matches$1(st,s)&&new o(st,tt)})})});rt.observe(document.body,{childList:!0,subtree:!0})}return et.map(function(nt){return new o(nt,a)})}},{key:"enabled",get:function(){return"ontouchstart"in document.documentElement}}]),o}();const getConstructor=o=>o!=null?o.constructor:null,instanceOf=(o,s)=>!!(o&&s&&o instanceof s),isNullOrUndefined=o=>o==null,isObject=o=>getConstructor(o)===Object,isNumber=o=>getConstructor(o)===Number&&!Number.isNaN(o),isString$2=o=>getConstructor(o)===String,isBoolean=o=>getConstructor(o)===Boolean,isFunction=o=>typeof o=="function",isArray=o=>Array.isArray(o),isWeakMap=o=>instanceOf(o,WeakMap),isNodeList=o=>instanceOf(o,NodeList),isTextNode=o=>getConstructor(o)===Text,isEvent=o=>instanceOf(o,Event),isKeyboardEvent=o=>instanceOf(o,KeyboardEvent),isCue=o=>instanceOf(o,window.TextTrackCue)||instanceOf(o,window.VTTCue),isTrack=o=>instanceOf(o,TextTrack)||!isNullOrUndefined(o)&&isString$2(o.kind),isPromise$1=o=>instanceOf(o,Promise)&&isFunction(o.then),isElement=o=>o!==null&&typeof o=="object"&&o.nodeType===1&&typeof o.style=="object"&&typeof o.ownerDocument=="object",isEmpty=o=>isNullOrUndefined(o)||(isString$2(o)||isArray(o)||isNodeList(o))&&!o.length||isObject(o)&&!Object.keys(o).length,isUrl=o=>{if(instanceOf(o,window.URL))return!0;if(!isString$2(o))return!1;let s=o;o.startsWith("http://")&&o.startsWith("https://")||(s=`http://${o}`);try{return!isEmpty(new URL(s).hostname)}catch{return!1}};var is={nullOrUndefined:isNullOrUndefined,object:isObject,number:isNumber,string:isString$2,boolean:isBoolean,function:isFunction,array:isArray,weakMap:isWeakMap,nodeList:isNodeList,element:isElement,textNode:isTextNode,event:isEvent,keyboardEvent:isKeyboardEvent,cue:isCue,track:isTrack,promise:isPromise$1,url:isUrl,empty:isEmpty};const transitionEndEvent=(()=>{const o=document.createElement("span"),s={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},a=Object.keys(s).find(et=>o.style[et]!==void 0);return!!is.string(a)&&s[a]})();function repaint(o,s){setTimeout(()=>{try{o.hidden=!0,o.offsetHeight,o.hidden=!1}catch{}},s)}const isIE=!!window.document.documentMode,isEdge=/Edge/g.test(navigator.userAgent),isWebKit="WebkitAppearance"in document.documentElement.style&&!/Edge/g.test(navigator.userAgent),isIPhone=/iPhone|iPod/gi.test(navigator.userAgent)&&navigator.maxTouchPoints>1,isIPadOS=navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1,isIos=/iPad|iPhone|iPod/gi.test(navigator.userAgent)&&navigator.maxTouchPoints>1;var browser={isIE,isEdge,isWebKit,isIPhone,isIPadOS,isIos};function cloneDeep(o){return JSON.parse(JSON.stringify(o))}function getDeep(o,s){return s.split(".").reduce((a,et)=>a&&a[et],o)}function extend(o={},...s){if(!s.length)return o;const a=s.shift();return is.object(a)?(Object.keys(a).forEach(et=>{is.object(a[et])?(Object.keys(o).includes(et)||Object.assign(o,{[et]:{}}),extend(o[et],a[et])):Object.assign(o,{[et]:a[et]})}),extend(o,...s)):o}function wrap(o,s){const a=o.length?o:[o];Array.from(a).reverse().forEach((et,tt)=>{const rt=tt>0?s.cloneNode(!0):s,nt=et.parentNode,it=et.nextSibling;rt.appendChild(et),it?nt.insertBefore(rt,it):nt.appendChild(rt)})}function setAttributes(o,s){is.element(o)&&!is.empty(s)&&Object.entries(s).filter(([,a])=>!is.nullOrUndefined(a)).forEach(([a,et])=>o.setAttribute(a,et))}function createElement(o,s,a){const et=document.createElement(o);return is.object(s)&&setAttributes(et,s),is.string(a)&&(et.innerText=a),et}function insertAfter(o,s){is.element(o)&&is.element(s)&&s.parentNode.insertBefore(o,s.nextSibling)}function insertElement(o,s,a,et){is.element(s)&&s.appendChild(createElement(o,a,et))}function removeElement(o){is.nodeList(o)||is.array(o)?Array.from(o).forEach(removeElement):is.element(o)&&is.element(o.parentNode)&&o.parentNode.removeChild(o)}function emptyElement(o){if(!is.element(o))return;let{length:s}=o.childNodes;for(;s>0;)o.removeChild(o.lastChild),s-=1}function replaceElement(o,s){return is.element(s)&&is.element(s.parentNode)&&is.element(o)?(s.parentNode.replaceChild(o,s),o):null}function getAttributesFromSelector(o,s){if(!is.string(o)||is.empty(o))return{};const a={},et=extend({},s);return o.split(",").forEach(tt=>{const rt=tt.trim(),nt=rt.replace(".",""),it=rt.replace(/[[\]]/g,"").split("="),[st]=it,ot=it.length>1?it[1].replace(/["']/g,""):"";switch(rt.charAt(0)){case".":is.string(et.class)?a.class=`${et.class} ${nt}`:a.class=nt;break;case"#":a.id=rt.replace("#","");break;case"[":a[st]=ot}}),extend(et,a)}function toggleHidden(o,s){if(!is.element(o))return;let a=s;is.boolean(a)||(a=!o.hidden),o.hidden=a}function toggleClass(o,s,a){if(is.nodeList(o))return Array.from(o).map(et=>toggleClass(et,s,a));if(is.element(o)){let et="toggle";return a!==void 0&&(et=a?"add":"remove"),o.classList[et](s),o.classList.contains(s)}return!1}function hasClass(o,s){return is.element(o)&&o.classList.contains(s)}function matches(o,s){const{prototype:a}=Element;return(a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector||function(){return Array.from(document.querySelectorAll(s)).includes(this)}).call(o,s)}function closest$1(o,s){const{prototype:a}=Element;return(a.closest||function(){let et=this;do{if(matches.matches(et,s))return et;et=et.parentElement||et.parentNode}while(et!==null&&et.nodeType===1);return null}).call(o,s)}function getElements(o){return this.elements.container.querySelectorAll(o)}function getElement(o){return this.elements.container.querySelector(o)}function setFocus(o=null,s=!1){is.element(o)&&o.focus({preventScroll:!0,focusVisible:s})}const defaultCodecs={"audio/ogg":"vorbis","audio/wav":"1","video/webm":"vp8, vorbis","video/mp4":"avc1.42E01E, mp4a.40.2","video/ogg":"theora"},support={audio:"canPlayType"in document.createElement("audio"),video:"canPlayType"in document.createElement("video"),check(o,s){const a=support[o]||s!=="html5";return{api:a,ui:a&&support.rangeInput}},pip:!(browser.isIPhone||!is.function(createElement("video").webkitSetPresentationMode)&&(!document.pictureInPictureEnabled||createElement("video").disablePictureInPicture)),airplay:is.function(window.WebKitPlaybackTargetAvailabilityEvent),playsinline:"playsInline"in document.createElement("video"),mime(o){if(is.empty(o))return!1;const[s]=o.split("/");let a=o;if(!this.isHTML5||s!==this.type)return!1;Object.keys(defaultCodecs).includes(a)&&(a+=`; codecs="${defaultCodecs[o]}"`);try{return!!(a&&this.media.canPlayType(a).replace(/no/,""))}catch{return!1}},textTracks:"textTracks"in document.createElement("video"),rangeInput:(()=>{const o=document.createElement("input");return o.type="range",o.type==="range"})(),touch:"ontouchstart"in document.documentElement,transitions:transitionEndEvent!==!1,reducedMotion:"matchMedia"in window&&window.matchMedia("(prefers-reduced-motion)").matches},supportsPassiveListeners=(()=>{let o=!1;try{const s=Object.defineProperty({},"passive",{get:()=>(o=!0,null)});window.addEventListener("test",null,s),window.removeEventListener("test",null,s)}catch{}return o})();function toggleListener(o,s,a,et=!1,tt=!0,rt=!1){if(!o||!("addEventListener"in o)||is.empty(s)||!is.function(a))return;const nt=s.split(" ");let it=rt;supportsPassiveListeners&&(it={passive:tt,capture:rt}),nt.forEach(st=>{this&&this.eventListeners&&et&&this.eventListeners.push({element:o,type:st,callback:a,options:it}),o[et?"addEventListener":"removeEventListener"](st,a,it)})}function on(o,s="",a,et=!0,tt=!1){toggleListener.call(this,o,s,a,!0,et,tt)}function off(o,s="",a,et=!0,tt=!1){toggleListener.call(this,o,s,a,!1,et,tt)}function once(o,s="",a,et=!0,tt=!1){const rt=(...nt)=>{off(o,s,rt,et,tt),a.apply(this,nt)};toggleListener.call(this,o,s,rt,!0,et,tt)}function triggerEvent(o,s="",a=!1,et={}){if(!is.element(o)||is.empty(s))return;const tt=new CustomEvent(s,{bubbles:a,detail:{...et,plyr:this}});o.dispatchEvent(tt)}function unbindListeners(){this&&this.eventListeners&&(this.eventListeners.forEach(o=>{const{element:s,type:a,callback:et,options:tt}=o;s.removeEventListener(a,et,tt)}),this.eventListeners=[])}function ready(){return new Promise(o=>this.ready?setTimeout(o,0):on.call(this,this.elements.container,"ready",o)).then(()=>{})}function silencePromise(o){is.promise(o)&&o.then(null,()=>{})}function dedupe(o){return is.array(o)?o.filter((s,a)=>o.indexOf(s)===a):o}function closest(o,s){return is.array(o)&&o.length?o.reduce((a,et)=>Math.abs(et-s)<Math.abs(a-s)?et:a):null}function supportsCSS(o){return!(!window||!window.CSS)&&window.CSS.supports(o)}const standardRatios=[[1,1],[4,3],[3,4],[5,4],[4,5],[3,2],[2,3],[16,10],[10,16],[16,9],[9,16],[21,9],[9,21],[32,9],[9,32]].reduce((o,[s,a])=>({...o,[s/a]:[s,a]}),{});function validateAspectRatio(o){return is.array(o)||is.string(o)&&o.includes(":")?(is.array(o)?o:o.split(":")).map(Number).every(is.number):!1}function reduceAspectRatio(o){if(!is.array(o)||!o.every(is.number))return null;const[s,a]=o,et=(rt,nt)=>nt===0?rt:et(nt,rt%nt),tt=et(s,a);return[s/tt,a/tt]}function getAspectRatio(o){const s=et=>validateAspectRatio(et)?et.split(":").map(Number):null;let a=s(o);if(a===null&&(a=s(this.config.ratio)),a===null&&!is.empty(this.embed)&&is.array(this.embed.ratio)&&({ratio:a}=this.embed),a===null&&this.isHTML5){const{videoWidth:et,videoHeight:tt}=this.media;a=[et,tt]}return reduceAspectRatio(a)}function setAspectRatio(o){if(!this.isVideo)return{};const{wrapper:s}=this.elements,a=getAspectRatio.call(this,o);if(!is.array(a))return{};const[et,tt]=reduceAspectRatio(a),rt=100/et*tt;if(supportsCSS(`aspect-ratio: ${et}/${tt}`)?s.style.aspectRatio=`${et}/${tt}`:s.style.paddingBottom=`${rt}%`,this.isVimeo&&!this.config.vimeo.premium&&this.supported.ui){const nt=100/this.media.offsetWidth*parseInt(window.getComputedStyle(this.media).paddingBottom,10),it=(nt-rt)/(nt/50);this.fullscreen.active?s.style.paddingBottom=null:this.media.style.transform=`translateY(-${it}%)`}else this.isHTML5&&s.classList.add(this.config.classNames.videoFixedRatio);return{padding:rt,ratio:a}}function roundAspectRatio(o,s,a=.05){const et=o/s,tt=closest(Object.keys(standardRatios),et);return Math.abs(tt-et)<=a?standardRatios[tt]:[o,s]}function getViewportSize(){return[Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),Math.max(document.documentElement.clientHeight||0,window.innerHeight||0)]}const html5={getSources(){return this.isHTML5?Array.from(this.media.querySelectorAll("source")).filter(o=>{const s=o.getAttribute("type");return!!is.empty(s)||support.mime.call(this,s)}):[]},getQualityOptions(){return this.config.quality.forced?this.config.quality.options:html5.getSources.call(this).map(o=>Number(o.getAttribute("size"))).filter(Boolean)},setup(){if(!this.isHTML5)return;const o=this;o.options.speed=o.config.speed.options,is.empty(this.config.ratio)||setAspectRatio.call(o),Object.defineProperty(o.media,"quality",{get(){const s=html5.getSources.call(o).find(a=>a.getAttribute("src")===o.source);return s&&Number(s.getAttribute("size"))},set(s){if(o.quality!==s){if(o.config.quality.forced&&is.function(o.config.quality.onChange))o.config.quality.onChange(s);else{const a=html5.getSources.call(o).find(st=>Number(st.getAttribute("size"))===s);if(!a)return;const{currentTime:et,paused:tt,preload:rt,readyState:nt,playbackRate:it}=o.media;o.media.src=a.getAttribute("src"),(rt!=="none"||nt)&&(o.once("loadedmetadata",()=>{o.speed=it,o.currentTime=et,tt||silencePromise(o.play())}),o.media.load())}triggerEvent.call(o,o.media,"qualitychange",!1,{quality:s})}}})},cancelRequests(){this.isHTML5&&(removeElement(html5.getSources.call(this)),this.media.setAttribute("src",this.config.blankVideo),this.media.load(),this.debug.log("Cancelled network requests"))}};function generateId(o){return`${o}-${Math.floor(1e4*Math.random())}`}function format$2(o,...s){return is.empty(o)?o:o.toString().replace(/{(\d+)}/g,(a,et)=>s[et].toString())}function getPercentage(o,s){return o===0||s===0||Number.isNaN(o)||Number.isNaN(s)?0:(o/s*100).toFixed(2)}const replaceAll=(o="",s="",a="")=>o.replace(new RegExp(s.toString().replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1"),"g"),a.toString()),toTitleCase=(o="")=>o.toString().replace(/\w\S*/g,s=>s.charAt(0).toUpperCase()+s.slice(1).toLowerCase());function toPascalCase(o=""){let s=o.toString();return s=replaceAll(s,"-"," "),s=replaceAll(s,"_"," "),s=toTitleCase(s),replaceAll(s," ","")}function toCamelCase$2(o=""){let s=o.toString();return s=toPascalCase(s),s.charAt(0).toLowerCase()+s.slice(1)}function stripHTML(o){const s=document.createDocumentFragment(),a=document.createElement("div");return s.appendChild(a),a.innerHTML=o,s.firstChild.innerText}function getHTML(o){const s=document.createElement("div");return s.appendChild(o),s.innerHTML}const resources={pip:"PIP",airplay:"AirPlay",html5:"HTML5",vimeo:"Vimeo",youtube:"YouTube"},i18n={get(o="",s={}){if(is.empty(o)||is.empty(s))return"";let a=getDeep(s.i18n,o);if(is.empty(a))return Object.keys(resources).includes(o)?resources[o]:"";const et={"{seektime}":s.seekTime,"{title}":s.title};return Object.entries(et).forEach(([tt,rt])=>{a=replaceAll(a,tt,rt)}),a}};class Storage{constructor(s){_defineProperty$1(this,"get",a=>{if(!Storage.supported||!this.enabled)return null;const et=window.localStorage.getItem(this.key);if(is.empty(et))return null;const tt=JSON.parse(et);return is.string(a)&&a.length?tt[a]:tt}),_defineProperty$1(this,"set",a=>{if(!Storage.supported||!this.enabled||!is.object(a))return;let et=this.get();is.empty(et)&&(et={}),extend(et,a);try{window.localStorage.setItem(this.key,JSON.stringify(et))}catch{}}),this.enabled=s.config.storage.enabled,this.key=s.config.storage.key}static get supported(){try{if(!("localStorage"in window))return!1;const s="___test";return window.localStorage.setItem(s,s),window.localStorage.removeItem(s),!0}catch{return!1}}}function fetch$1(o,s="text"){return new Promise((a,et)=>{try{const tt=new XMLHttpRequest;if(!("withCredentials"in tt))return;tt.addEventListener("load",()=>{if(s==="text")try{a(JSON.parse(tt.responseText))}catch{a(tt.responseText)}else a(tt.response)}),tt.addEventListener("error",()=>{throw new Error(tt.status)}),tt.open("GET",o,!0),tt.responseType=s,tt.send()}catch(tt){et(tt)}})}function loadSprite(o,s){if(!is.string(o))return;const a="cache",et=is.string(s);let tt=!1;const rt=()=>document.getElementById(s)!==null,nt=(it,st)=>{it.innerHTML=st,et&&rt()||document.body.insertAdjacentElement("afterbegin",it)};if(!et||!rt()){const it=Storage.supported,st=document.createElement("div");if(st.setAttribute("hidden",""),et&&st.setAttribute("id",s),it){const ot=window.localStorage.getItem(`${a}-${s}`);if(tt=ot!==null,tt){const at=JSON.parse(ot);nt(st,at.content)}}fetch$1(o).then(ot=>{if(!is.empty(ot)){if(it)try{window.localStorage.setItem(`${a}-${s}`,JSON.stringify({content:ot}))}catch{}nt(st,ot)}}).catch(()=>{})}}const getHours=o=>Math.trunc(o/60/60%60,10),getMinutes=o=>Math.trunc(o/60%60,10),getSeconds=o=>Math.trunc(o%60,10);function formatTime(o=0,s=!1,a=!1){if(!is.number(o))return formatTime(void 0,s,a);const et=it=>`0${it}`.slice(-2);let tt=getHours(o);const rt=getMinutes(o),nt=getSeconds(o);return tt=s||tt>0?`${tt}:`:"",`${a&&o>0?"-":""}${tt}${et(rt)}:${et(nt)}`}const controls={getIconUrl(){const o=new URL(this.config.iconUrl,window.location),s=window.location.host?window.location.host:window.top.location.host,a=o.host!==s||browser.isIE&&!window.svg4everybody;return{url:this.config.iconUrl,cors:a}},findElements(){try{return this.elements.controls=getElement.call(this,this.config.selectors.controls.wrapper),this.elements.buttons={play:getElements.call(this,this.config.selectors.buttons.play),pause:getElement.call(this,this.config.selectors.buttons.pause),restart:getElement.call(this,this.config.selectors.buttons.restart),rewind:getElement.call(this,this.config.selectors.buttons.rewind),fastForward:getElement.call(this,this.config.selectors.buttons.fastForward),mute:getElement.call(this,this.config.selectors.buttons.mute),pip:getElement.call(this,this.config.selectors.buttons.pip),airplay:getElement.call(this,this.config.selectors.buttons.airplay),settings:getElement.call(this,this.config.selectors.buttons.settings),captions:getElement.call(this,this.config.selectors.buttons.captions),fullscreen:getElement.call(this,this.config.selectors.buttons.fullscreen)},this.elements.progress=getElement.call(this,this.config.selectors.progress),this.elements.inputs={seek:getElement.call(this,this.config.selectors.inputs.seek),volume:getElement.call(this,this.config.selectors.inputs.volume)},this.elements.display={buffer:getElement.call(this,this.config.selectors.display.buffer),currentTime:getElement.call(this,this.config.selectors.display.currentTime),duration:getElement.call(this,this.config.selectors.display.duration)},is.element(this.elements.progress)&&(this.elements.display.seekTooltip=this.elements.progress.querySelector(`.${this.config.classNames.tooltip}`)),!0}catch(o){return this.debug.warn("It looks like there is a problem with your custom controls HTML",o),this.toggleNativeControls(!0),!1}},createIcon(o,s){const a="http://www.w3.org/2000/svg",et=controls.getIconUrl.call(this),tt=`${et.cors?"":et.url}#${this.config.iconPrefix}`,rt=document.createElementNS(a,"svg");setAttributes(rt,extend(s,{"aria-hidden":"true",focusable:"false"}));const nt=document.createElementNS(a,"use"),it=`${tt}-${o}`;return"href"in nt&&nt.setAttributeNS("http://www.w3.org/1999/xlink","href",it),nt.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",it),rt.appendChild(nt),rt},createLabel(o,s={}){const a=i18n.get(o,this.config);return createElement("span",{...s,class:[s.class,this.config.classNames.hidden].filter(Boolean).join(" ")},a)},createBadge(o){if(is.empty(o))return null;const s=createElement("span",{class:this.config.classNames.menu.value});return s.appendChild(createElement("span",{class:this.config.classNames.menu.badge},o)),s},createButton(o,s){const a=extend({},s);let et=toCamelCase$2(o);const tt={element:"button",toggle:!1,label:null,icon:null,labelPressed:null,iconPressed:null};switch(["element","icon","label"].forEach(nt=>{Object.keys(a).includes(nt)&&(tt[nt]=a[nt],delete a[nt])}),tt.element!=="button"||Object.keys(a).includes("type")||(a.type="button"),Object.keys(a).includes("class")?a.class.split(" ").some(nt=>nt===this.config.classNames.control)||extend(a,{class:`${a.class} ${this.config.classNames.control}`}):a.class=this.config.classNames.control,o){case"play":tt.toggle=!0,tt.label="play",tt.labelPressed="pause",tt.icon="play",tt.iconPressed="pause";break;case"mute":tt.toggle=!0,tt.label="mute",tt.labelPressed="unmute",tt.icon="volume",tt.iconPressed="muted";break;case"captions":tt.toggle=!0,tt.label="enableCaptions",tt.labelPressed="disableCaptions",tt.icon="captions-off",tt.iconPressed="captions-on";break;case"fullscreen":tt.toggle=!0,tt.label="enterFullscreen",tt.labelPressed="exitFullscreen",tt.icon="enter-fullscreen",tt.iconPressed="exit-fullscreen";break;case"play-large":a.class+=` ${this.config.classNames.control}--overlaid`,et="play",tt.label="play",tt.icon="play";break;default:is.empty(tt.label)&&(tt.label=et),is.empty(tt.icon)&&(tt.icon=o)}const rt=createElement(tt.element);return tt.toggle?(rt.appendChild(controls.createIcon.call(this,tt.iconPressed,{class:"icon--pressed"})),rt.appendChild(controls.createIcon.call(this,tt.icon,{class:"icon--not-pressed"})),rt.appendChild(controls.createLabel.call(this,tt.labelPressed,{class:"label--pressed"})),rt.appendChild(controls.createLabel.call(this,tt.label,{class:"label--not-pressed"}))):(rt.appendChild(controls.createIcon.call(this,tt.icon)),rt.appendChild(controls.createLabel.call(this,tt.label))),extend(a,getAttributesFromSelector(this.config.selectors.buttons[et],a)),setAttributes(rt,a),et==="play"?(is.array(this.elements.buttons[et])||(this.elements.buttons[et]=[]),this.elements.buttons[et].push(rt)):this.elements.buttons[et]=rt,rt},createRange(o,s){const a=createElement("input",extend(getAttributesFromSelector(this.config.selectors.inputs[o]),{type:"range",min:0,max:100,step:.01,value:0,autocomplete:"off",role:"slider","aria-label":i18n.get(o,this.config),"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":0},s));return this.elements.inputs[o]=a,controls.updateRangeFill.call(this,a),RangeTouch.setup(a),a},createProgress(o,s){const a=createElement("progress",extend(getAttributesFromSelector(this.config.selectors.display[o]),{min:0,max:100,value:0,role:"progressbar","aria-hidden":!0},s));if(o!=="volume"){a.appendChild(createElement("span",null,"0"));const et={played:"played",buffer:"buffered"}[o],tt=et?i18n.get(et,this.config):"";a.innerText=`% ${tt.toLowerCase()}`}return this.elements.display[o]=a,a},createTime(o,s){const a=getAttributesFromSelector(this.config.selectors.display[o],s),et=createElement("div",extend(a,{class:`${a.class?a.class:""} ${this.config.classNames.display.time} `.trim(),"aria-label":i18n.get(o,this.config),role:"timer"}),"00:00");return this.elements.display[o]=et,et},bindMenuItemShortcuts(o,s){on.call(this,o,"keydown keyup",a=>{if(![" ","ArrowUp","ArrowDown","ArrowRight"].includes(a.key)||(a.preventDefault(),a.stopPropagation(),a.type==="keydown"))return;const et=matches(o,'[role="menuitemradio"]');if(!et&&[" ","ArrowRight"].includes(a.key))controls.showMenuPanel.call(this,s,!0);else{let tt;a.key!==" "&&(a.key==="ArrowDown"||et&&a.key==="ArrowRight"?(tt=o.nextElementSibling,is.element(tt)||(tt=o.parentNode.firstElementChild)):(tt=o.previousElementSibling,is.element(tt)||(tt=o.parentNode.lastElementChild)),setFocus.call(this,tt,!0))}},!1),on.call(this,o,"keyup",a=>{a.key==="Return"&&controls.focusFirstMenuItem.call(this,null,!0)})},createMenuItem({value:o,list:s,type:a,title:et,badge:tt=null,checked:rt=!1}){const nt=getAttributesFromSelector(this.config.selectors.inputs[a]),it=createElement("button",extend(nt,{type:"button",role:"menuitemradio",class:`${this.config.classNames.control} ${nt.class?nt.class:""}`.trim(),"aria-checked":rt,value:o})),st=createElement("span");st.innerHTML=et,is.element(tt)&&st.appendChild(tt),it.appendChild(st),Object.defineProperty(it,"checked",{enumerable:!0,get:()=>it.getAttribute("aria-checked")==="true",set(ot){ot&&Array.from(it.parentNode.children).filter(at=>matches(at,'[role="menuitemradio"]')).forEach(at=>at.setAttribute("aria-checked","false")),it.setAttribute("aria-checked",ot?"true":"false")}}),this.listeners.bind(it,"click keyup",ot=>{if(!is.keyboardEvent(ot)||ot.key===" "){switch(ot.preventDefault(),ot.stopPropagation(),it.checked=!0,a){case"language":this.currentTrack=Number(o);break;case"quality":this.quality=o;break;case"speed":this.speed=parseFloat(o)}controls.showMenuPanel.call(this,"home",is.keyboardEvent(ot))}},a,!1),controls.bindMenuItemShortcuts.call(this,it,a),s.appendChild(it)},formatTime(o=0,s=!1){return is.number(o)?formatTime(o,getHours(this.duration)>0,s):o},updateTimeDisplay(o=null,s=0,a=!1){is.element(o)&&is.number(s)&&(o.innerText=controls.formatTime(s,a))},updateVolume(){this.supported.ui&&(is.element(this.elements.inputs.volume)&&controls.setRange.call(this,this.elements.inputs.volume,this.muted?0:this.volume),is.element(this.elements.buttons.mute)&&(this.elements.buttons.mute.pressed=this.muted||this.volume===0))},setRange(o,s=0){is.element(o)&&(o.value=s,controls.updateRangeFill.call(this,o))},updateProgress(o){if(!this.supported.ui||!is.event(o))return;let s=0;const a=(et,tt)=>{const rt=is.number(tt)?tt:0,nt=is.element(et)?et:this.elements.display.buffer;if(is.element(nt)){nt.value=rt;const it=nt.getElementsByTagName("span")[0];is.element(it)&&(it.childNodes[0].nodeValue=rt)}};if(o)switch(o.type){case"timeupdate":case"seeking":case"seeked":s=getPercentage(this.currentTime,this.duration),o.type==="timeupdate"&&controls.setRange.call(this,this.elements.inputs.seek,s);break;case"playing":case"progress":a(this.elements.display.buffer,100*this.buffered)}},updateRangeFill(o){const s=is.event(o)?o.target:o;if(is.element(s)&&s.getAttribute("type")==="range"){if(matches(s,this.config.selectors.inputs.seek)){s.setAttribute("aria-valuenow",this.currentTime);const a=controls.formatTime(this.currentTime),et=controls.formatTime(this.duration),tt=i18n.get("seekLabel",this.config);s.setAttribute("aria-valuetext",tt.replace("{currentTime}",a).replace("{duration}",et))}else if(matches(s,this.config.selectors.inputs.volume)){const a=100*s.value;s.setAttribute("aria-valuenow",a),s.setAttribute("aria-valuetext",`${a.toFixed(1)}%`)}else s.setAttribute("aria-valuenow",s.value);(browser.isWebKit||browser.isIPadOS)&&s.style.setProperty("--value",s.value/s.max*100+"%")}},updateSeekTooltip(o){var s,a;if(!this.config.tooltips.seek||!is.element(this.elements.inputs.seek)||!is.element(this.elements.display.seekTooltip)||this.duration===0)return;const et=this.elements.display.seekTooltip,tt=`${this.config.classNames.tooltip}--visible`,rt=at=>toggleClass(et,tt,at);if(this.touch)return void rt(!1);let nt=0;const it=this.elements.progress.getBoundingClientRect();if(is.event(o))nt=100/it.width*(o.pageX-it.left);else{if(!hasClass(et,tt))return;nt=parseFloat(et.style.left,10)}nt<0?nt=0:nt>100&&(nt=100);const st=this.duration/100*nt;et.innerText=controls.formatTime(st);const ot=(s=this.config.markers)===null||s===void 0||(a=s.points)===null||a===void 0?void 0:a.find(({time:at})=>at===Math.round(st));ot&&et.insertAdjacentHTML("afterbegin",`${ot.label}<br>`),et.style.left=`${nt}%`,is.event(o)&&["mouseenter","mouseleave"].includes(o.type)&&rt(o.type==="mouseenter")},timeUpdate(o){const s=!is.element(this.elements.display.duration)&&this.config.invertTime;controls.updateTimeDisplay.call(this,this.elements.display.currentTime,s?this.duration-this.currentTime:this.currentTime,s),o&&o.type==="timeupdate"&&this.media.seeking||controls.updateProgress.call(this,o)},durationUpdate(){if(!this.supported.ui||!this.config.invertTime&&this.currentTime)return;if(this.duration>=2**32)return toggleHidden(this.elements.display.currentTime,!0),void toggleHidden(this.elements.progress,!0);is.element(this.elements.inputs.seek)&&this.elements.inputs.seek.setAttribute("aria-valuemax",this.duration);const o=is.element(this.elements.display.duration);!o&&this.config.displayDuration&&this.paused&&controls.updateTimeDisplay.call(this,this.elements.display.currentTime,this.duration),o&&controls.updateTimeDisplay.call(this,this.elements.display.duration,this.duration),this.config.markers.enabled&&controls.setMarkers.call(this),controls.updateSeekTooltip.call(this)},toggleMenuButton(o,s){toggleHidden(this.elements.settings.buttons[o],!s)},updateSetting(o,s,a){const et=this.elements.settings.panels[o];let tt=null,rt=s;if(o==="captions")tt=this.currentTrack;else{if(tt=is.empty(a)?this[o]:a,is.empty(tt)&&(tt=this.config[o].default),!is.empty(this.options[o])&&!this.options[o].includes(tt))return void this.debug.warn(`Unsupported value of '${tt}' for ${o}`);if(!this.config[o].options.includes(tt))return void this.debug.warn(`Disabled value of '${tt}' for ${o}`)}if(is.element(rt)||(rt=et&&et.querySelector('[role="menu"]')),!is.element(rt))return;this.elements.settings.buttons[o].querySelector(`.${this.config.classNames.menu.value}`).innerHTML=controls.getLabel.call(this,o,tt);const nt=rt&&rt.querySelector(`[value="${tt}"]`);is.element(nt)&&(nt.checked=!0)},getLabel(o,s){switch(o){case"speed":return s===1?i18n.get("normal",this.config):`${s}&times;`;case"quality":if(is.number(s)){const a=i18n.get(`qualityLabel.${s}`,this.config);return a.length?a:`${s}p`}return toTitleCase(s);case"captions":return captions.getLabel.call(this);default:return null}},setQualityMenu(o){if(!is.element(this.elements.settings.panels.quality))return;const s="quality",a=this.elements.settings.panels.quality.querySelector('[role="menu"]');is.array(o)&&(this.options.quality=dedupe(o).filter(rt=>this.config.quality.options.includes(rt)));const et=!is.empty(this.options.quality)&&this.options.quality.length>1;if(controls.toggleMenuButton.call(this,s,et),emptyElement(a),controls.checkMenu.call(this),!et)return;const tt=rt=>{const nt=i18n.get(`qualityBadge.${rt}`,this.config);return nt.length?controls.createBadge.call(this,nt):null};this.options.quality.sort((rt,nt)=>{const it=this.config.quality.options;return it.indexOf(rt)>it.indexOf(nt)?1:-1}).forEach(rt=>{controls.createMenuItem.call(this,{value:rt,list:a,type:s,title:controls.getLabel.call(this,"quality",rt),badge:tt(rt)})}),controls.updateSetting.call(this,s,a)},setCaptionsMenu(){if(!is.element(this.elements.settings.panels.captions))return;const o="captions",s=this.elements.settings.panels.captions.querySelector('[role="menu"]'),a=captions.getTracks.call(this),et=!!a.length;if(controls.toggleMenuButton.call(this,o,et),emptyElement(s),controls.checkMenu.call(this),!et)return;const tt=a.map((rt,nt)=>({value:nt,checked:this.captions.toggled&&this.currentTrack===nt,title:captions.getLabel.call(this,rt),badge:rt.language&&controls.createBadge.call(this,rt.language.toUpperCase()),list:s,type:"language"}));tt.unshift({value:-1,checked:!this.captions.toggled,title:i18n.get("disabled",this.config),list:s,type:"language"}),tt.forEach(controls.createMenuItem.bind(this)),controls.updateSetting.call(this,o,s)},setSpeedMenu(){if(!is.element(this.elements.settings.panels.speed))return;const o="speed",s=this.elements.settings.panels.speed.querySelector('[role="menu"]');this.options.speed=this.options.speed.filter(et=>et>=this.minimumSpeed&&et<=this.maximumSpeed);const a=!is.empty(this.options.speed)&&this.options.speed.length>1;controls.toggleMenuButton.call(this,o,a),emptyElement(s),controls.checkMenu.call(this),a&&(this.options.speed.forEach(et=>{controls.createMenuItem.call(this,{value:et,list:s,type:o,title:controls.getLabel.call(this,"speed",et)})}),controls.updateSetting.call(this,o,s))},checkMenu(){const{buttons:o}=this.elements.settings,s=!is.empty(o)&&Object.values(o).some(a=>!a.hidden);toggleHidden(this.elements.settings.menu,!s)},focusFirstMenuItem(o,s=!1){if(this.elements.settings.popup.hidden)return;let a=o;is.element(a)||(a=Object.values(this.elements.settings.panels).find(tt=>!tt.hidden));const et=a.querySelector('[role^="menuitem"]');setFocus.call(this,et,s)},toggleMenu(o){const{popup:s}=this.elements.settings,a=this.elements.buttons.settings;if(!is.element(s)||!is.element(a))return;const{hidden:et}=s;let tt=et;if(is.boolean(o))tt=o;else if(is.keyboardEvent(o)&&o.key==="Escape")tt=!1;else if(is.event(o)){const rt=is.function(o.composedPath)?o.composedPath()[0]:o.target,nt=s.contains(rt);if(nt||!nt&&o.target!==a&&tt)return}a.setAttribute("aria-expanded",tt),toggleHidden(s,!tt),toggleClass(this.elements.container,this.config.classNames.menu.open,tt),tt&&is.keyboardEvent(o)?controls.focusFirstMenuItem.call(this,null,!0):tt||et||setFocus.call(this,a,is.keyboardEvent(o))},getMenuSize(o){const s=o.cloneNode(!0);s.style.position="absolute",s.style.opacity=0,s.removeAttribute("hidden"),o.parentNode.appendChild(s);const a=s.scrollWidth,et=s.scrollHeight;return removeElement(s),{width:a,height:et}},showMenuPanel(o="",s=!1){const a=this.elements.container.querySelector(`#plyr-settings-${this.id}-${o}`);if(!is.element(a))return;const et=a.parentNode,tt=Array.from(et.children).find(rt=>!rt.hidden);if(support.transitions&&!support.reducedMotion){et.style.width=`${tt.scrollWidth}px`,et.style.height=`${tt.scrollHeight}px`;const rt=controls.getMenuSize.call(this,a),nt=it=>{it.target===et&&["width","height"].includes(it.propertyName)&&(et.style.width="",et.style.height="",off.call(this,et,transitionEndEvent,nt))};on.call(this,et,transitionEndEvent,nt),et.style.width=`${rt.width}px`,et.style.height=`${rt.height}px`}toggleHidden(tt,!0),toggleHidden(a,!1),controls.focusFirstMenuItem.call(this,a,s)},setDownloadUrl(){const o=this.elements.buttons.download;is.element(o)&&o.setAttribute("href",this.download)},create(o){const{bindMenuItemShortcuts:s,createButton:a,createProgress:et,createRange:tt,createTime:rt,setQualityMenu:nt,setSpeedMenu:it,showMenuPanel:st}=controls;this.elements.controls=null,is.array(this.config.controls)&&this.config.controls.includes("play-large")&&this.elements.container.appendChild(a.call(this,"play-large"));const ot=createElement("div",getAttributesFromSelector(this.config.selectors.controls.wrapper));this.elements.controls=ot;const at={class:"plyr__controls__item"};return dedupe(is.array(this.config.controls)?this.config.controls:[]).forEach(lt=>{if(lt==="restart"&&ot.appendChild(a.call(this,"restart",at)),lt==="rewind"&&ot.appendChild(a.call(this,"rewind",at)),lt==="play"&&ot.appendChild(a.call(this,"play",at)),lt==="fast-forward"&&ot.appendChild(a.call(this,"fast-forward",at)),lt==="progress"){const ct=createElement("div",{class:`${at.class} plyr__progress__container`}),ht=createElement("div",getAttributesFromSelector(this.config.selectors.progress));if(ht.appendChild(tt.call(this,"seek",{id:`plyr-seek-${o.id}`})),ht.appendChild(et.call(this,"buffer")),this.config.tooltips.seek){const ft=createElement("span",{class:this.config.classNames.tooltip},"00:00");ht.appendChild(ft),this.elements.display.seekTooltip=ft}this.elements.progress=ht,ct.appendChild(this.elements.progress),ot.appendChild(ct)}if(lt==="current-time"&&ot.appendChild(rt.call(this,"currentTime",at)),lt==="duration"&&ot.appendChild(rt.call(this,"duration",at)),lt==="mute"||lt==="volume"){let{volume:ct}=this.elements;if(is.element(ct)&&ot.contains(ct)||(ct=createElement("div",extend({},at,{class:`${at.class} plyr__volume`.trim()})),this.elements.volume=ct,ot.appendChild(ct)),lt==="mute"&&ct.appendChild(a.call(this,"mute")),lt==="volume"&&!browser.isIos&&!browser.isIPadOS){const ht={max:1,step:.05,value:this.config.volume};ct.appendChild(tt.call(this,"volume",extend(ht,{id:`plyr-volume-${o.id}`})))}}if(lt==="captions"&&ot.appendChild(a.call(this,"captions",at)),lt==="settings"&&!is.empty(this.config.settings)){const ct=createElement("div",extend({},at,{class:`${at.class} plyr__menu`.trim(),hidden:""}));ct.appendChild(a.call(this,"settings",{"aria-haspopup":!0,"aria-controls":`plyr-settings-${o.id}`,"aria-expanded":!1}));const ht=createElement("div",{class:"plyr__menu__container",id:`plyr-settings-${o.id}`,hidden:""}),ft=createElement("div"),dt=createElement("div",{id:`plyr-settings-${o.id}-home`}),pt=createElement("div",{role:"menu"});dt.appendChild(pt),ft.appendChild(dt),this.elements.settings.panels.home=dt,this.config.settings.forEach(gt=>{const mt=createElement("button",extend(getAttributesFromSelector(this.config.selectors.buttons.settings),{type:"button",class:`${this.config.classNames.control} ${this.config.classNames.control}--forward`,role:"menuitem","aria-haspopup":!0,hidden:""}));s.call(this,mt,gt),on.call(this,mt,"click",()=>{st.call(this,gt,!1)});const yt=createElement("span",null,i18n.get(gt,this.config)),vt=createElement("span",{class:this.config.classNames.menu.value});vt.innerHTML=o[gt],yt.appendChild(vt),mt.appendChild(yt),pt.appendChild(mt);const Et=createElement("div",{id:`plyr-settings-${o.id}-${gt}`,hidden:""}),xt=createElement("button",{type:"button",class:`${this.config.classNames.control} ${this.config.classNames.control}--back`});xt.appendChild(createElement("span",{"aria-hidden":!0},i18n.get(gt,this.config))),xt.appendChild(createElement("span",{class:this.config.classNames.hidden},i18n.get("menuBack",this.config))),on.call(this,Et,"keydown",wt=>{wt.key==="ArrowLeft"&&(wt.preventDefault(),wt.stopPropagation(),st.call(this,"home",!0))},!1),on.call(this,xt,"click",()=>{st.call(this,"home",!1)}),Et.appendChild(xt),Et.appendChild(createElement("div",{role:"menu"})),ft.appendChild(Et),this.elements.settings.buttons[gt]=mt,this.elements.settings.panels[gt]=Et}),ht.appendChild(ft),ct.appendChild(ht),ot.appendChild(ct),this.elements.settings.popup=ht,this.elements.settings.menu=ct}if(lt==="pip"&&support.pip&&ot.appendChild(a.call(this,"pip",at)),lt==="airplay"&&support.airplay&&ot.appendChild(a.call(this,"airplay",at)),lt==="download"){const ct=extend({},at,{element:"a",href:this.download,target:"_blank"});this.isHTML5&&(ct.download="");const{download:ht}=this.config.urls;!is.url(ht)&&this.isEmbed&&extend(ct,{icon:`logo-${this.provider}`,label:this.provider}),ot.appendChild(a.call(this,"download",ct))}lt==="fullscreen"&&ot.appendChild(a.call(this,"fullscreen",at))}),this.isHTML5&&nt.call(this,html5.getQualityOptions.call(this)),it.call(this),ot},inject(){if(this.config.loadSprite){const tt=controls.getIconUrl.call(this);tt.cors&&loadSprite(tt.url,"sprite-plyr")}this.id=Math.floor(1e4*Math.random());let o=null;this.elements.controls=null;const s={id:this.id,seektime:this.config.seekTime,title:this.config.title};let a=!0;is.function(this.config.controls)&&(this.config.controls=this.config.controls.call(this,s)),this.config.controls||(this.config.controls=[]),is.element(this.config.controls)||is.string(this.config.controls)?o=this.config.controls:(o=controls.create.call(this,{id:this.id,seektime:this.config.seekTime,speed:this.speed,quality:this.quality,captions:captions.getLabel.call(this)}),a=!1);let et;if(a&&is.string(this.config.controls)&&(o=(tt=>{let rt=tt;return Object.entries(s).forEach(([nt,it])=>{rt=replaceAll(rt,`{${nt}}`,it)}),rt})(o)),is.string(this.config.selectors.controls.container)&&(et=document.querySelector(this.config.selectors.controls.container)),is.element(et)||(et=this.elements.container),et[is.element(o)?"insertAdjacentElement":"insertAdjacentHTML"]("afterbegin",o),is.element(this.elements.controls)||controls.findElements.call(this),!is.empty(this.elements.buttons)){const tt=rt=>{const nt=this.config.classNames.controlPressed;rt.setAttribute("aria-pressed","false"),Object.defineProperty(rt,"pressed",{configurable:!0,enumerable:!0,get:()=>hasClass(rt,nt),set(it=!1){toggleClass(rt,nt,it),rt.setAttribute("aria-pressed",it?"true":"false")}})};Object.values(this.elements.buttons).filter(Boolean).forEach(rt=>{is.array(rt)||is.nodeList(rt)?Array.from(rt).filter(Boolean).forEach(tt):tt(rt)})}if(browser.isEdge&&repaint(et),this.config.tooltips.controls){const{classNames:tt,selectors:rt}=this.config,nt=`${rt.controls.wrapper} ${rt.labels} .${tt.hidden}`,it=getElements.call(this,nt);Array.from(it).forEach(st=>{toggleClass(st,this.config.classNames.hidden,!1),toggleClass(st,this.config.classNames.tooltip,!0)})}},setMediaMetadata(){try{"mediaSession"in navigator&&(navigator.mediaSession.metadata=new window.MediaMetadata({title:this.config.mediaMetadata.title,artist:this.config.mediaMetadata.artist,album:this.config.mediaMetadata.album,artwork:this.config.mediaMetadata.artwork}))}catch{}},setMarkers(){var o,s;if(!this.duration||this.elements.markers)return;const a=(o=this.config.markers)===null||o===void 0||(s=o.points)===null||s===void 0?void 0:s.filter(({time:st})=>st>0&&st<this.duration);if(a==null||!a.length)return;const et=document.createDocumentFragment(),tt=document.createDocumentFragment();let rt=null;const nt=`${this.config.classNames.tooltip}--visible`,it=st=>toggleClass(rt,nt,st);a.forEach(st=>{const ot=createElement("span",{class:this.config.classNames.marker},""),at=st.time/this.duration*100+"%";rt&&(ot.addEventListener("mouseenter",()=>{st.label||(rt.style.left=at,rt.innerHTML=st.label,it(!0))}),ot.addEventListener("mouseleave",()=>{it(!1)})),ot.addEventListener("click",()=>{this.currentTime=st.time}),ot.style.left=at,tt.appendChild(ot)}),et.appendChild(tt),this.config.tooltips.seek||(rt=createElement("span",{class:this.config.classNames.tooltip},""),et.appendChild(rt)),this.elements.markers={points:tt,tip:rt},this.elements.progress.appendChild(et)}};function parseUrl(o,s=!0){let a=o;if(s){const et=document.createElement("a");et.href=a,a=et.href}try{return new URL(a)}catch{return null}}function buildUrlParams(o){const s=new URLSearchParams;return is.object(o)&&Object.entries(o).forEach(([a,et])=>{s.set(a,et)}),s}const captions={setup(){if(!this.supported.ui)return;if(!this.isVideo||this.isYouTube||this.isHTML5&&!support.textTracks)return void(is.array(this.config.controls)&&this.config.controls.includes("settings")&&this.config.settings.includes("captions")&&controls.setCaptionsMenu.call(this));if(is.element(this.elements.captions)||(this.elements.captions=createElement("div",getAttributesFromSelector(this.config.selectors.captions)),this.elements.captions.setAttribute("dir","auto"),insertAfter(this.elements.captions,this.elements.wrapper)),browser.isIE&&window.URL){const et=this.media.querySelectorAll("track");Array.from(et).forEach(tt=>{const rt=tt.getAttribute("src"),nt=parseUrl(rt);nt!==null&&nt.hostname!==window.location.href.hostname&&["http:","https:"].includes(nt.protocol)&&fetch$1(rt,"blob").then(it=>{tt.setAttribute("src",window.URL.createObjectURL(it))}).catch(()=>{removeElement(tt)})})}const o=dedupe((navigator.languages||[navigator.language||navigator.userLanguage||"en"]).map(et=>et.split("-")[0]));let s=(this.storage.get("language")||this.config.captions.language||"auto").toLowerCase();s==="auto"&&([s]=o);let a=this.storage.get("captions");if(is.boolean(a)||({active:a}=this.config.captions),Object.assign(this.captions,{toggled:!1,active:a,language:s,languages:o}),this.isHTML5){const et=this.config.captions.update?"addtrack removetrack":"removetrack";on.call(this,this.media.textTracks,et,captions.update.bind(this))}setTimeout(captions.update.bind(this),0)},update(){const o=captions.getTracks.call(this,!0),{active:s,language:a,meta:et,currentTrackNode:tt}=this.captions,rt=!!o.find(nt=>nt.language===a);this.isHTML5&&this.isVideo&&o.filter(nt=>!et.get(nt)).forEach(nt=>{this.debug.log("Track added",nt),et.set(nt,{default:nt.mode==="showing"}),nt.mode==="showing"&&(nt.mode="hidden"),on.call(this,nt,"cuechange",()=>captions.updateCues.call(this))}),(rt&&this.language!==a||!o.includes(tt))&&(captions.setLanguage.call(this,a),captions.toggle.call(this,s&&rt)),this.elements&&toggleClass(this.elements.container,this.config.classNames.captions.enabled,!is.empty(o)),is.array(this.config.controls)&&this.config.controls.includes("settings")&&this.config.settings.includes("captions")&&controls.setCaptionsMenu.call(this)},toggle(o,s=!0){if(!this.supported.ui)return;const{toggled:a}=this.captions,et=this.config.classNames.captions.active,tt=is.nullOrUndefined(o)?!a:o;if(tt!==a){if(s||(this.captions.active=tt,this.storage.set({captions:tt})),!this.language&&tt&&!s){const rt=captions.getTracks.call(this),nt=captions.findTrack.call(this,[this.captions.language,...this.captions.languages],!0);return this.captions.language=nt.language,void captions.set.call(this,rt.indexOf(nt))}this.elements.buttons.captions&&(this.elements.buttons.captions.pressed=tt),toggleClass(this.elements.container,et,tt),this.captions.toggled=tt,controls.updateSetting.call(this,"captions"),triggerEvent.call(this,this.media,tt?"captionsenabled":"captionsdisabled")}setTimeout(()=>{tt&&this.captions.toggled&&(this.captions.currentTrackNode.mode="hidden")})},set(o,s=!0){const a=captions.getTracks.call(this);if(o!==-1)if(is.number(o))if(o in a){if(this.captions.currentTrack!==o){this.captions.currentTrack=o;const et=a[o],{language:tt}=et||{};this.captions.currentTrackNode=et,controls.updateSetting.call(this,"captions"),s||(this.captions.language=tt,this.storage.set({language:tt})),this.isVimeo&&this.embed.enableTextTrack(tt),triggerEvent.call(this,this.media,"languagechange")}captions.toggle.call(this,!0,s),this.isHTML5&&this.isVideo&&captions.updateCues.call(this)}else this.debug.warn("Track not found",o);else this.debug.warn("Invalid caption argument",o);else captions.toggle.call(this,!1,s)},setLanguage(o,s=!0){if(!is.string(o))return void this.debug.warn("Invalid language argument",o);const a=o.toLowerCase();this.captions.language=a;const et=captions.getTracks.call(this),tt=captions.findTrack.call(this,[a]);captions.set.call(this,et.indexOf(tt),s)},getTracks(o=!1){return Array.from((this.media||{}).textTracks||[]).filter(s=>!this.isHTML5||o||this.captions.meta.has(s)).filter(s=>["captions","subtitles"].includes(s.kind))},findTrack(o,s=!1){const a=captions.getTracks.call(this),et=nt=>Number((this.captions.meta.get(nt)||{}).default),tt=Array.from(a).sort((nt,it)=>et(it)-et(nt));let rt;return o.every(nt=>(rt=tt.find(it=>it.language===nt),!rt)),rt||(s?tt[0]:void 0)},getCurrentTrack(){return captions.getTracks.call(this)[this.currentTrack]},getLabel(o){let s=o;return!is.track(s)&&support.textTracks&&this.captions.toggled&&(s=captions.getCurrentTrack.call(this)),is.track(s)?is.empty(s.label)?is.empty(s.language)?i18n.get("enabled",this.config):o.language.toUpperCase():s.label:i18n.get("disabled",this.config)},updateCues(o){if(!this.supported.ui)return;if(!is.element(this.elements.captions))return void this.debug.warn("No captions element to render to");if(!is.nullOrUndefined(o)&&!Array.isArray(o))return void this.debug.warn("updateCues: Invalid input",o);let s=o;if(!s){const et=captions.getCurrentTrack.call(this);s=Array.from((et||{}).activeCues||[]).map(tt=>tt.getCueAsHTML()).map(getHTML)}const a=s.map(et=>et.trim()).join(`
`);if(a!==this.elements.captions.innerHTML){emptyElement(this.elements.captions);const et=createElement("span",getAttributesFromSelector(this.config.selectors.caption));et.innerHTML=a,this.elements.captions.appendChild(et),triggerEvent.call(this,this.media,"cuechange")}}},defaults$2={enabled:!0,title:"",debug:!1,autoplay:!1,autopause:!0,playsinline:!0,seekTime:10,volume:1,muted:!1,duration:null,displayDuration:!0,invertTime:!0,toggleInvert:!0,ratio:null,clickToPlay:!0,hideControls:!0,resetOnEnd:!1,disableContextMenu:!0,loadSprite:!0,iconPrefix:"plyr",iconUrl:"https://cdn.plyr.io/3.7.8/plyr.svg",blankVideo:"https://cdn.plyr.io/static/blank.mp4",quality:{default:576,options:[4320,2880,2160,1440,1080,720,576,480,360,240],forced:!1,onChange:null},loop:{active:!1},speed:{selected:1,options:[.5,.75,1,1.25,1.5,1.75,2,4]},keyboard:{focused:!0,global:!1},tooltips:{controls:!1,seek:!0},captions:{active:!1,language:"auto",update:!1},fullscreen:{enabled:!0,fallback:!0,iosNative:!1},storage:{enabled:!0,key:"plyr"},controls:["play-large","play","progress","current-time","mute","volume","captions","settings","pip","airplay","fullscreen"],settings:["captions","quality","speed"],i18n:{restart:"Restart",rewind:"Rewind {seektime}s",play:"Play",pause:"Pause",fastForward:"Forward {seektime}s",seek:"Seek",seekLabel:"{currentTime} of {duration}",played:"Played",buffered:"Buffered",currentTime:"Current time",duration:"Duration",volume:"Volume",mute:"Mute",unmute:"Unmute",enableCaptions:"Enable captions",disableCaptions:"Disable captions",download:"Download",enterFullscreen:"Enter fullscreen",exitFullscreen:"Exit fullscreen",frameTitle:"Player for {title}",captions:"Captions",settings:"Settings",pip:"PIP",menuBack:"Go back to previous menu",speed:"Speed",normal:"Normal",quality:"Quality",loop:"Loop",start:"Start",end:"End",all:"All",reset:"Reset",disabled:"Disabled",enabled:"Enabled",advertisement:"Ad",qualityBadge:{2160:"4K",1440:"HD",1080:"HD",720:"HD",576:"SD",480:"SD"}},urls:{download:null,vimeo:{sdk:"https://player.vimeo.com/api/player.js",iframe:"https://player.vimeo.com/video/{0}?{1}",api:"https://vimeo.com/api/oembed.json?url={0}"},youtube:{sdk:"https://www.youtube.com/iframe_api",api:"https://noembed.com/embed?url=https://www.youtube.com/watch?v={0}"},googleIMA:{sdk:"https://imasdk.googleapis.com/js/sdkloader/ima3.js"}},listeners:{seek:null,play:null,pause:null,restart:null,rewind:null,fastForward:null,mute:null,volume:null,captions:null,download:null,fullscreen:null,pip:null,airplay:null,speed:null,quality:null,loop:null,language:null},events:["ended","progress","stalled","playing","waiting","canplay","canplaythrough","loadstart","loadeddata","loadedmetadata","timeupdate","volumechange","play","pause","error","seeking","seeked","emptied","ratechange","cuechange","download","enterfullscreen","exitfullscreen","captionsenabled","captionsdisabled","languagechange","controlshidden","controlsshown","ready","statechange","qualitychange","adsloaded","adscontentpause","adscontentresume","adstarted","adsmidpoint","adscomplete","adsallcomplete","adsimpression","adsclick"],selectors:{editable:"input, textarea, select, [contenteditable]",container:".plyr",controls:{container:null,wrapper:".plyr__controls"},labels:"[data-plyr]",buttons:{play:'[data-plyr="play"]',pause:'[data-plyr="pause"]',restart:'[data-plyr="restart"]',rewind:'[data-plyr="rewind"]',fastForward:'[data-plyr="fast-forward"]',mute:'[data-plyr="mute"]',captions:'[data-plyr="captions"]',download:'[data-plyr="download"]',fullscreen:'[data-plyr="fullscreen"]',pip:'[data-plyr="pip"]',airplay:'[data-plyr="airplay"]',settings:'[data-plyr="settings"]',loop:'[data-plyr="loop"]'},inputs:{seek:'[data-plyr="seek"]',volume:'[data-plyr="volume"]',speed:'[data-plyr="speed"]',language:'[data-plyr="language"]',quality:'[data-plyr="quality"]'},display:{currentTime:".plyr__time--current",duration:".plyr__time--duration",buffer:".plyr__progress__buffer",loop:".plyr__progress__loop",volume:".plyr__volume--display"},progress:".plyr__progress",captions:".plyr__captions",caption:".plyr__caption"},classNames:{type:"plyr--{0}",provider:"plyr--{0}",video:"plyr__video-wrapper",embed:"plyr__video-embed",videoFixedRatio:"plyr__video-wrapper--fixed-ratio",embedContainer:"plyr__video-embed__container",poster:"plyr__poster",posterEnabled:"plyr__poster-enabled",ads:"plyr__ads",control:"plyr__control",controlPressed:"plyr__control--pressed",playing:"plyr--playing",paused:"plyr--paused",stopped:"plyr--stopped",loading:"plyr--loading",hover:"plyr--hover",tooltip:"plyr__tooltip",cues:"plyr__cues",marker:"plyr__progress__marker",hidden:"plyr__sr-only",hideControls:"plyr--hide-controls",isTouch:"plyr--is-touch",uiSupported:"plyr--full-ui",noTransition:"plyr--no-transition",display:{time:"plyr__time"},menu:{value:"plyr__menu__value",badge:"plyr__badge",open:"plyr--menu-open"},captions:{enabled:"plyr--captions-enabled",active:"plyr--captions-active"},fullscreen:{enabled:"plyr--fullscreen-enabled",fallback:"plyr--fullscreen-fallback"},pip:{supported:"plyr--pip-supported",active:"plyr--pip-active"},airplay:{supported:"plyr--airplay-supported",active:"plyr--airplay-active"},previewThumbnails:{thumbContainer:"plyr__preview-thumb",thumbContainerShown:"plyr__preview-thumb--is-shown",imageContainer:"plyr__preview-thumb__image-container",timeContainer:"plyr__preview-thumb__time-container",scrubbingContainer:"plyr__preview-scrubbing",scrubbingContainerShown:"plyr__preview-scrubbing--is-shown"}},attributes:{embed:{provider:"data-plyr-provider",id:"data-plyr-embed-id",hash:"data-plyr-embed-hash"}},ads:{enabled:!1,publisherId:"",tagUrl:""},previewThumbnails:{enabled:!1,src:""},vimeo:{byline:!1,portrait:!1,title:!1,speed:!0,transparent:!1,customControls:!0,referrerPolicy:null,premium:!1},youtube:{rel:0,showinfo:0,iv_load_policy:3,modestbranding:1,customControls:!0,noCookie:!1},mediaMetadata:{title:"",artist:"",album:"",artwork:[]},markers:{enabled:!1,points:[]}},pip={active:"picture-in-picture",inactive:"inline"},providers={html5:"html5",youtube:"youtube",vimeo:"vimeo"},types={audio:"audio",video:"video"};function getProviderByUrl(o){return/^(https?:\/\/)?(www\.)?(youtube\.com|youtube-nocookie\.com|youtu\.?be)\/.+$/.test(o)?providers.youtube:/^https?:\/\/player.vimeo.com\/video\/\d{0,9}(?=\b|\/)/.test(o)?providers.vimeo:null}const noop$2=()=>{};class Console{constructor(s=!1){this.enabled=window.console&&s,this.enabled&&this.log("Debugging enabled")}get log(){return this.enabled?Function.prototype.bind.call(console.log,console):noop$2}get warn(){return this.enabled?Function.prototype.bind.call(console.warn,console):noop$2}get error(){return this.enabled?Function.prototype.bind.call(console.error,console):noop$2}}class Fullscreen{constructor(s){_defineProperty$1(this,"onChange",()=>{if(!this.supported)return;const a=this.player.elements.buttons.fullscreen;is.element(a)&&(a.pressed=this.active);const et=this.target===this.player.media?this.target:this.player.elements.container;triggerEvent.call(this.player,et,this.active?"enterfullscreen":"exitfullscreen",!0)}),_defineProperty$1(this,"toggleFallback",(a=!1)=>{if(a?this.scrollPosition={x:window.scrollX??0,y:window.scrollY??0}:window.scrollTo(this.scrollPosition.x,this.scrollPosition.y),document.body.style.overflow=a?"hidden":"",toggleClass(this.target,this.player.config.classNames.fullscreen.fallback,a),browser.isIos){let et=document.head.querySelector('meta[name="viewport"]');const tt="viewport-fit=cover";et||(et=document.createElement("meta"),et.setAttribute("name","viewport"));const rt=is.string(et.content)&&et.content.includes(tt);a?(this.cleanupViewport=!rt,rt||(et.content+=`,${tt}`)):this.cleanupViewport&&(et.content=et.content.split(",").filter(nt=>nt.trim()!==tt).join(","))}this.onChange()}),_defineProperty$1(this,"trapFocus",a=>{if(browser.isIos||browser.isIPadOS||!this.active||a.key!=="Tab")return;const et=document.activeElement,tt=getElements.call(this.player,"a[href], button:not(:disabled), input:not(:disabled), [tabindex]"),[rt]=tt,nt=tt[tt.length-1];et!==nt||a.shiftKey?et===rt&&a.shiftKey&&(nt.focus(),a.preventDefault()):(rt.focus(),a.preventDefault())}),_defineProperty$1(this,"update",()=>{if(this.supported){let a;a=this.forceFallback?"Fallback (forced)":Fullscreen.nativeSupported?"Native":"Fallback",this.player.debug.log(`${a} fullscreen enabled`)}else this.player.debug.log("Fullscreen not supported and fallback disabled");toggleClass(this.player.elements.container,this.player.config.classNames.fullscreen.enabled,this.supported)}),_defineProperty$1(this,"enter",()=>{this.supported&&(browser.isIos&&this.player.config.fullscreen.iosNative?this.player.isVimeo?this.player.embed.requestFullscreen():this.target.webkitEnterFullscreen():!Fullscreen.nativeSupported||this.forceFallback?this.toggleFallback(!0):this.prefix?is.empty(this.prefix)||this.target[`${this.prefix}Request${this.property}`]():this.target.requestFullscreen({navigationUI:"hide"}))}),_defineProperty$1(this,"exit",()=>{if(this.supported)if(browser.isIos&&this.player.config.fullscreen.iosNative)this.player.isVimeo?this.player.embed.exitFullscreen():this.target.webkitEnterFullscreen(),silencePromise(this.player.play());else if(!Fullscreen.nativeSupported||this.forceFallback)this.toggleFallback(!1);else if(this.prefix){if(!is.empty(this.prefix)){const a=this.prefix==="moz"?"Cancel":"Exit";document[`${this.prefix}${a}${this.property}`]()}}else(document.cancelFullScreen||document.exitFullscreen).call(document)}),_defineProperty$1(this,"toggle",()=>{this.active?this.exit():this.enter()}),this.player=s,this.prefix=Fullscreen.prefix,this.property=Fullscreen.property,this.scrollPosition={x:0,y:0},this.forceFallback=s.config.fullscreen.fallback==="force",this.player.elements.fullscreen=s.config.fullscreen.container&&closest$1(this.player.elements.container,s.config.fullscreen.container),on.call(this.player,document,this.prefix==="ms"?"MSFullscreenChange":`${this.prefix}fullscreenchange`,()=>{this.onChange()}),on.call(this.player,this.player.elements.container,"dblclick",a=>{is.element(this.player.elements.controls)&&this.player.elements.controls.contains(a.target)||this.player.listeners.proxy(a,this.toggle,"fullscreen")}),on.call(this,this.player.elements.container,"keydown",a=>this.trapFocus(a)),this.update()}static get nativeSupported(){return!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)}get useNative(){return Fullscreen.nativeSupported&&!this.forceFallback}static get prefix(){if(is.function(document.exitFullscreen))return"";let s="";return["webkit","moz","ms"].some(a=>!(!is.function(document[`${a}ExitFullscreen`])&&!is.function(document[`${a}CancelFullScreen`]))&&(s=a,!0)),s}static get property(){return this.prefix==="moz"?"FullScreen":"Fullscreen"}get supported(){return[this.player.config.fullscreen.enabled,this.player.isVideo,Fullscreen.nativeSupported||this.player.config.fullscreen.fallback,!this.player.isYouTube||Fullscreen.nativeSupported||!browser.isIos||this.player.config.playsinline&&!this.player.config.fullscreen.iosNative].every(Boolean)}get active(){if(!this.supported)return!1;if(!Fullscreen.nativeSupported||this.forceFallback)return hasClass(this.target,this.player.config.classNames.fullscreen.fallback);const s=this.prefix?this.target.getRootNode()[`${this.prefix}${this.property}Element`]:this.target.getRootNode().fullscreenElement;return s&&s.shadowRoot?s===this.target.getRootNode().host:s===this.target}get target(){return browser.isIos&&this.player.config.fullscreen.iosNative?this.player.media:this.player.elements.fullscreen??this.player.elements.container}}function loadImage(o,s=1){return new Promise((a,et)=>{const tt=new Image,rt=()=>{delete tt.onload,delete tt.onerror,(tt.naturalWidth>=s?a:et)(tt)};Object.assign(tt,{onload:rt,onerror:rt,src:o})})}const ui={addStyleHook(){toggleClass(this.elements.container,this.config.selectors.container.replace(".",""),!0),toggleClass(this.elements.container,this.config.classNames.uiSupported,this.supported.ui)},toggleNativeControls(o=!1){o&&this.isHTML5?this.media.setAttribute("controls",""):this.media.removeAttribute("controls")},build(){if(this.listeners.media(),!this.supported.ui)return this.debug.warn(`Basic support only for ${this.provider} ${this.type}`),void ui.toggleNativeControls.call(this,!0);is.element(this.elements.controls)||(controls.inject.call(this),this.listeners.controls()),ui.toggleNativeControls.call(this),this.isHTML5&&captions.setup.call(this),this.volume=null,this.muted=null,this.loop=null,this.quality=null,this.speed=null,controls.updateVolume.call(this),controls.timeUpdate.call(this),controls.durationUpdate.call(this),ui.checkPlaying.call(this),toggleClass(this.elements.container,this.config.classNames.pip.supported,support.pip&&this.isHTML5&&this.isVideo),toggleClass(this.elements.container,this.config.classNames.airplay.supported,support.airplay&&this.isHTML5),toggleClass(this.elements.container,this.config.classNames.isTouch,this.touch),this.ready=!0,setTimeout(()=>{triggerEvent.call(this,this.media,"ready")},0),ui.setTitle.call(this),this.poster&&ui.setPoster.call(this,this.poster,!1).catch(()=>{}),this.config.duration&&controls.durationUpdate.call(this),this.config.mediaMetadata&&controls.setMediaMetadata.call(this)},setTitle(){let o=i18n.get("play",this.config);if(is.string(this.config.title)&&!is.empty(this.config.title)&&(o+=`, ${this.config.title}`),Array.from(this.elements.buttons.play||[]).forEach(s=>{s.setAttribute("aria-label",o)}),this.isEmbed){const s=getElement.call(this,"iframe");if(!is.element(s))return;const a=is.empty(this.config.title)?"video":this.config.title,et=i18n.get("frameTitle",this.config);s.setAttribute("title",et.replace("{title}",a))}},togglePoster(o){toggleClass(this.elements.container,this.config.classNames.posterEnabled,o)},setPoster(o,s=!0){return s&&this.poster?Promise.reject(new Error("Poster already set")):(this.media.setAttribute("data-poster",o),this.elements.poster.removeAttribute("hidden"),ready.call(this).then(()=>loadImage(o)).catch(a=>{throw o===this.poster&&ui.togglePoster.call(this,!1),a}).then(()=>{if(o!==this.poster)throw new Error("setPoster cancelled by later call to setPoster")}).then(()=>(Object.assign(this.elements.poster.style,{backgroundImage:`url('${o}')`,backgroundSize:""}),ui.togglePoster.call(this,!0),o)))},checkPlaying(o){toggleClass(this.elements.container,this.config.classNames.playing,this.playing),toggleClass(this.elements.container,this.config.classNames.paused,this.paused),toggleClass(this.elements.container,this.config.classNames.stopped,this.stopped),Array.from(this.elements.buttons.play||[]).forEach(s=>{Object.assign(s,{pressed:this.playing}),s.setAttribute("aria-label",i18n.get(this.playing?"pause":"play",this.config))}),is.event(o)&&o.type==="timeupdate"||ui.toggleControls.call(this)},checkLoading(o){this.loading=["stalled","waiting"].includes(o.type),clearTimeout(this.timers.loading),this.timers.loading=setTimeout(()=>{toggleClass(this.elements.container,this.config.classNames.loading,this.loading),ui.toggleControls.call(this)},this.loading?250:0)},toggleControls(o){const{controls:s}=this.elements;if(s&&this.config.hideControls){const a=this.touch&&this.lastSeekTime+2e3>Date.now();this.toggleControls(!!(o||this.loading||this.paused||s.pressed||s.hover||a))}},migrateStyles(){Object.values({...this.media.style}).filter(o=>!is.empty(o)&&is.string(o)&&o.startsWith("--plyr")).forEach(o=>{this.elements.container.style.setProperty(o,this.media.style.getPropertyValue(o)),this.media.style.removeProperty(o)}),is.empty(this.media.style)&&this.media.removeAttribute("style")}};class Listeners{constructor(s){_defineProperty$1(this,"firstTouch",()=>{const{player:a}=this,{elements:et}=a;a.touch=!0,toggleClass(et.container,a.config.classNames.isTouch,!0)}),_defineProperty$1(this,"global",(a=!0)=>{const{player:et}=this;et.config.keyboard.global&&toggleListener.call(et,window,"keydown keyup",this.handleKey,a,!1),toggleListener.call(et,document.body,"click",this.toggleMenu,a),once.call(et,document.body,"touchstart",this.firstTouch)}),_defineProperty$1(this,"container",()=>{const{player:a}=this,{config:et,elements:tt,timers:rt}=a;!et.keyboard.global&&et.keyboard.focused&&on.call(a,tt.container,"keydown keyup",this.handleKey,!1),on.call(a,tt.container,"mousemove mouseleave touchstart touchmove enterfullscreen exitfullscreen",st=>{const{controls:ot}=tt;ot&&st.type==="enterfullscreen"&&(ot.pressed=!1,ot.hover=!1);let at=0;["touchstart","touchmove","mousemove"].includes(st.type)&&(ui.toggleControls.call(a,!0),at=a.touch?3e3:2e3),clearTimeout(rt.controls),rt.controls=setTimeout(()=>ui.toggleControls.call(a,!1),at)});const nt=()=>{if(!a.isVimeo||a.config.vimeo.premium)return;const st=tt.wrapper,{active:ot}=a.fullscreen,[at,lt]=getAspectRatio.call(a),ct=supportsCSS(`aspect-ratio: ${at} / ${lt}`);if(!ot)return void(ct?(st.style.width=null,st.style.height=null):(st.style.maxWidth=null,st.style.margin=null));const[ht,ft]=getViewportSize(),dt=ht/ft>at/lt;ct?(st.style.width=dt?"auto":"100%",st.style.height=dt?"100%":"auto"):(st.style.maxWidth=dt?ft/lt*at+"px":null,st.style.margin=dt?"0 auto":null)},it=()=>{clearTimeout(rt.resized),rt.resized=setTimeout(nt,50)};on.call(a,tt.container,"enterfullscreen exitfullscreen",st=>{const{target:ot}=a.fullscreen;ot===tt.container&&(!a.isEmbed&&is.empty(a.config.ratio)||(nt(),(st.type==="enterfullscreen"?on:off).call(a,window,"resize",it)))})}),_defineProperty$1(this,"media",()=>{const{player:a}=this,{elements:et}=a;if(on.call(a,a.media,"timeupdate seeking seeked",rt=>controls.timeUpdate.call(a,rt)),on.call(a,a.media,"durationchange loadeddata loadedmetadata",rt=>controls.durationUpdate.call(a,rt)),on.call(a,a.media,"ended",()=>{a.isHTML5&&a.isVideo&&a.config.resetOnEnd&&(a.restart(),a.pause())}),on.call(a,a.media,"progress playing seeking seeked",rt=>controls.updateProgress.call(a,rt)),on.call(a,a.media,"volumechange",rt=>controls.updateVolume.call(a,rt)),on.call(a,a.media,"playing play pause ended emptied timeupdate",rt=>ui.checkPlaying.call(a,rt)),on.call(a,a.media,"waiting canplay seeked playing",rt=>ui.checkLoading.call(a,rt)),a.supported.ui&&a.config.clickToPlay&&!a.isAudio){const rt=getElement.call(a,`.${a.config.classNames.video}`);if(!is.element(rt))return;on.call(a,et.container,"click",nt=>{([et.container,rt].includes(nt.target)||rt.contains(nt.target))&&(a.touch&&a.config.hideControls||(a.ended?(this.proxy(nt,a.restart,"restart"),this.proxy(nt,()=>{silencePromise(a.play())},"play")):this.proxy(nt,()=>{silencePromise(a.togglePlay())},"play")))})}a.supported.ui&&a.config.disableContextMenu&&on.call(a,et.wrapper,"contextmenu",rt=>{rt.preventDefault()},!1),on.call(a,a.media,"volumechange",()=>{a.storage.set({volume:a.volume,muted:a.muted})}),on.call(a,a.media,"ratechange",()=>{controls.updateSetting.call(a,"speed"),a.storage.set({speed:a.speed})}),on.call(a,a.media,"qualitychange",rt=>{controls.updateSetting.call(a,"quality",null,rt.detail.quality)}),on.call(a,a.media,"ready qualitychange",()=>{controls.setDownloadUrl.call(a)});const tt=a.config.events.concat(["keyup","keydown"]).join(" ");on.call(a,a.media,tt,rt=>{let{detail:nt={}}=rt;rt.type==="error"&&(nt=a.media.error),triggerEvent.call(a,et.container,rt.type,!0,nt)})}),_defineProperty$1(this,"proxy",(a,et,tt)=>{const{player:rt}=this,nt=rt.config.listeners[tt];let it=!0;is.function(nt)&&(it=nt.call(rt,a)),it!==!1&&is.function(et)&&et.call(rt,a)}),_defineProperty$1(this,"bind",(a,et,tt,rt,nt=!0)=>{const{player:it}=this,st=it.config.listeners[rt],ot=is.function(st);on.call(it,a,et,at=>this.proxy(at,tt,rt),nt&&!ot)}),_defineProperty$1(this,"controls",()=>{const{player:a}=this,{elements:et}=a,tt=browser.isIE?"change":"input";if(et.buttons.play&&Array.from(et.buttons.play).forEach(rt=>{this.bind(rt,"click",()=>{silencePromise(a.togglePlay())},"play")}),this.bind(et.buttons.restart,"click",a.restart,"restart"),this.bind(et.buttons.rewind,"click",()=>{a.lastSeekTime=Date.now(),a.rewind()},"rewind"),this.bind(et.buttons.fastForward,"click",()=>{a.lastSeekTime=Date.now(),a.forward()},"fastForward"),this.bind(et.buttons.mute,"click",()=>{a.muted=!a.muted},"mute"),this.bind(et.buttons.captions,"click",()=>a.toggleCaptions()),this.bind(et.buttons.download,"click",()=>{triggerEvent.call(a,a.media,"download")},"download"),this.bind(et.buttons.fullscreen,"click",()=>{a.fullscreen.toggle()},"fullscreen"),this.bind(et.buttons.pip,"click",()=>{a.pip="toggle"},"pip"),this.bind(et.buttons.airplay,"click",a.airplay,"airplay"),this.bind(et.buttons.settings,"click",rt=>{rt.stopPropagation(),rt.preventDefault(),controls.toggleMenu.call(a,rt)},null,!1),this.bind(et.buttons.settings,"keyup",rt=>{[" ","Enter"].includes(rt.key)&&(rt.key!=="Enter"?(rt.preventDefault(),rt.stopPropagation(),controls.toggleMenu.call(a,rt)):controls.focusFirstMenuItem.call(a,null,!0))},null,!1),this.bind(et.settings.menu,"keydown",rt=>{rt.key==="Escape"&&controls.toggleMenu.call(a,rt)}),this.bind(et.inputs.seek,"mousedown mousemove",rt=>{const nt=et.progress.getBoundingClientRect(),it=100/nt.width*(rt.pageX-nt.left);rt.currentTarget.setAttribute("seek-value",it)}),this.bind(et.inputs.seek,"mousedown mouseup keydown keyup touchstart touchend",rt=>{const nt=rt.currentTarget,it="play-on-seeked";if(is.keyboardEvent(rt)&&!["ArrowLeft","ArrowRight"].includes(rt.key))return;a.lastSeekTime=Date.now();const st=nt.hasAttribute(it),ot=["mouseup","touchend","keyup"].includes(rt.type);st&&ot?(nt.removeAttribute(it),silencePromise(a.play())):!ot&&a.playing&&(nt.setAttribute(it,""),a.pause())}),browser.isIos){const rt=getElements.call(a,'input[type="range"]');Array.from(rt).forEach(nt=>this.bind(nt,tt,it=>repaint(it.target)))}this.bind(et.inputs.seek,tt,rt=>{const nt=rt.currentTarget;let it=nt.getAttribute("seek-value");is.empty(it)&&(it=nt.value),nt.removeAttribute("seek-value"),a.currentTime=it/nt.max*a.duration},"seek"),this.bind(et.progress,"mouseenter mouseleave mousemove",rt=>controls.updateSeekTooltip.call(a,rt)),this.bind(et.progress,"mousemove touchmove",rt=>{const{previewThumbnails:nt}=a;nt&&nt.loaded&&nt.startMove(rt)}),this.bind(et.progress,"mouseleave touchend click",()=>{const{previewThumbnails:rt}=a;rt&&rt.loaded&&rt.endMove(!1,!0)}),this.bind(et.progress,"mousedown touchstart",rt=>{const{previewThumbnails:nt}=a;nt&&nt.loaded&&nt.startScrubbing(rt)}),this.bind(et.progress,"mouseup touchend",rt=>{const{previewThumbnails:nt}=a;nt&&nt.loaded&&nt.endScrubbing(rt)}),browser.isWebKit&&Array.from(getElements.call(a,'input[type="range"]')).forEach(rt=>{this.bind(rt,"input",nt=>controls.updateRangeFill.call(a,nt.target))}),a.config.toggleInvert&&!is.element(et.display.duration)&&this.bind(et.display.currentTime,"click",()=>{a.currentTime!==0&&(a.config.invertTime=!a.config.invertTime,controls.timeUpdate.call(a))}),this.bind(et.inputs.volume,tt,rt=>{a.volume=rt.target.value},"volume"),this.bind(et.controls,"mouseenter mouseleave",rt=>{et.controls.hover=!a.touch&&rt.type==="mouseenter"}),et.fullscreen&&Array.from(et.fullscreen.children).filter(rt=>!rt.contains(et.container)).forEach(rt=>{this.bind(rt,"mouseenter mouseleave",nt=>{et.controls&&(et.controls.hover=!a.touch&&nt.type==="mouseenter")})}),this.bind(et.controls,"mousedown mouseup touchstart touchend touchcancel",rt=>{et.controls.pressed=["mousedown","touchstart"].includes(rt.type)}),this.bind(et.controls,"focusin",()=>{const{config:rt,timers:nt}=a;toggleClass(et.controls,rt.classNames.noTransition,!0),ui.toggleControls.call(a,!0),setTimeout(()=>{toggleClass(et.controls,rt.classNames.noTransition,!1)},0);const it=this.touch?3e3:4e3;clearTimeout(nt.controls),nt.controls=setTimeout(()=>ui.toggleControls.call(a,!1),it)}),this.bind(et.inputs.volume,"wheel",rt=>{const nt=rt.webkitDirectionInvertedFromDevice,[it,st]=[rt.deltaX,-rt.deltaY].map(lt=>nt?-lt:lt),ot=Math.sign(Math.abs(it)>Math.abs(st)?it:st);a.increaseVolume(ot/50);const{volume:at}=a.media;(ot===1&&at<1||ot===-1&&at>0)&&rt.preventDefault()},"volume",!1)}),this.player=s,this.lastKey=null,this.focusTimer=null,this.lastKeyDown=null,this.handleKey=this.handleKey.bind(this),this.toggleMenu=this.toggleMenu.bind(this),this.firstTouch=this.firstTouch.bind(this)}handleKey(s){const{player:a}=this,{elements:et}=a,{key:tt,type:rt,altKey:nt,ctrlKey:it,metaKey:st,shiftKey:ot}=s,at=rt==="keydown",lt=at&&tt===this.lastKey;if(!(nt||it||st||ot)&&tt){if(at){const ht=document.activeElement;if(is.element(ht)){const{editable:ft}=a.config.selectors,{seek:dt}=et.inputs;if(ht!==dt&&matches(ht,ft)||s.key===" "&&matches(ht,'button, [role^="menuitem"]'))return}switch([" ","ArrowLeft","ArrowUp","ArrowRight","ArrowDown","0","1","2","3","4","5","6","7","8","9","c","f","k","l","m"].includes(tt)&&(s.preventDefault(),s.stopPropagation()),tt){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":lt||(ct=parseInt(tt,10),a.currentTime=a.duration/10*ct);break;case" ":case"k":lt||silencePromise(a.togglePlay());break;case"ArrowUp":a.increaseVolume(.1);break;case"ArrowDown":a.decreaseVolume(.1);break;case"m":lt||(a.muted=!a.muted);break;case"ArrowRight":a.forward();break;case"ArrowLeft":a.rewind();break;case"f":a.fullscreen.toggle();break;case"c":lt||a.toggleCaptions();break;case"l":a.loop=!a.loop}tt==="Escape"&&!a.fullscreen.usingNative&&a.fullscreen.active&&a.fullscreen.toggle(),this.lastKey=tt}else this.lastKey=null;var ct}}toggleMenu(s){controls.toggleMenu.call(this.player,s)}}function createCommonjsModule(o,s){return o(s={exports:{}},s.exports),s.exports}var loadjs_umd=createCommonjsModule(function(o,s){o.exports=function(){var a=function(){},et={},tt={},rt={};function nt(ct,ht){ct=ct.push?ct:[ct];var ft,dt,pt,gt=[],mt=ct.length,yt=mt;for(ft=function(vt,Et){Et.length&&gt.push(vt),--yt||ht(gt)};mt--;)dt=ct[mt],(pt=tt[dt])?ft(dt,pt):(rt[dt]=rt[dt]||[]).push(ft)}function it(ct,ht){if(ct){var ft=rt[ct];if(tt[ct]=ht,ft)for(;ft.length;)ft[0](ct,ht),ft.splice(0,1)}}function st(ct,ht){ct.call&&(ct={success:ct}),ht.length?(ct.error||a)(ht):(ct.success||a)(ct)}function ot(ct,ht,ft,dt){var pt,gt,mt=document,yt=ft.async,vt=(ft.numRetries||0)+1,Et=ft.before||a,xt=ct.replace(/[\?|#].*$/,""),wt=ct.replace(/^(css|img)!/,"");dt=dt||0,/(^css!|\.css$)/.test(xt)?((gt=mt.createElement("link")).rel="stylesheet",gt.href=wt,(pt="hideFocus"in gt)&&gt.relList&&(pt=0,gt.rel="preload",gt.as="style")):/(^img!|\.(png|gif|jpg|svg|webp)$)/.test(xt)?(gt=mt.createElement("img")).src=wt:((gt=mt.createElement("script")).src=ct,gt.async=yt===void 0||yt),gt.onload=gt.onerror=gt.onbeforeload=function(Rt){var Ct=Rt.type[0];if(pt)try{gt.sheet.cssText.length||(Ct="e")}catch(Ft){Ft.code!=18&&(Ct="e")}if(Ct=="e"){if((dt+=1)<vt)return ot(ct,ht,ft,dt)}else if(gt.rel=="preload"&&gt.as=="style")return gt.rel="stylesheet";ht(ct,Ct,Rt.defaultPrevented)},Et(ct,gt)!==!1&&mt.head.appendChild(gt)}function at(ct,ht,ft){var dt,pt,gt=(ct=ct.push?ct:[ct]).length,mt=gt,yt=[];for(dt=function(vt,Et,xt){if(Et=="e"&&yt.push(vt),Et=="b"){if(!xt)return;yt.push(vt)}--gt||ht(yt)},pt=0;pt<mt;pt++)ot(ct[pt],dt,ft)}function lt(ct,ht,ft){var dt,pt;if(ht&&ht.trim&&(dt=ht),pt=(dt?ft:ht)||{},dt){if(dt in et)throw"LoadJS";et[dt]=!0}function gt(mt,yt){at(ct,function(vt){st(pt,vt),mt&&st({success:mt,error:yt},vt),it(dt,vt)},pt)}if(pt.returnPromise)return new Promise(gt);gt()}return lt.ready=function(ct,ht){return nt(ct,function(ft){st(ht,ft)}),lt},lt.done=function(ct){it(ct,[])},lt.reset=function(){et={},tt={},rt={}},lt.isDefined=function(ct){return ct in et},lt}()});function loadScript(o){return new Promise((s,a)=>{loadjs_umd(o,{success:s,error:a})})}function parseId$1(o){return is.empty(o)?null:is.number(Number(o))?o:o.match(/^.*(vimeo.com\/|video\/)(\d+).*/)?RegExp.$2:o}function parseHash(o){const s=o.match(/^.*(vimeo.com\/|video\/)(\d+)(\?.*&*h=|\/)+([\d,a-f]+)/);return s&&s.length===5?s[4]:null}function assurePlaybackState$1(o){o&&!this.embed.hasPlayed&&(this.embed.hasPlayed=!0),this.media.paused===o&&(this.media.paused=!o,triggerEvent.call(this,this.media,o?"play":"pause"))}const vimeo={setup(){const o=this;toggleClass(o.elements.wrapper,o.config.classNames.embed,!0),o.options.speed=o.config.speed.options,setAspectRatio.call(o),is.object(window.Vimeo)?vimeo.ready.call(o):loadScript(o.config.urls.vimeo.sdk).then(()=>{vimeo.ready.call(o)}).catch(s=>{o.debug.warn("Vimeo SDK (player.js) failed to load",s)})},ready(){const o=this,s=o.config.vimeo,{premium:a,referrerPolicy:et,...tt}=s;let rt=o.media.getAttribute("src"),nt="";is.empty(rt)?(rt=o.media.getAttribute(o.config.attributes.embed.id),nt=o.media.getAttribute(o.config.attributes.embed.hash)):nt=parseHash(rt);const it=nt?{h:nt}:{};a&&Object.assign(tt,{controls:!1,sidedock:!1});const st=buildUrlParams({loop:o.config.loop.active,autoplay:o.autoplay,muted:o.muted,gesture:"media",playsinline:o.config.playsinline,...it,...tt}),ot=parseId$1(rt),at=createElement("iframe"),lt=format$2(o.config.urls.vimeo.iframe,ot,st);if(at.setAttribute("src",lt),at.setAttribute("allowfullscreen",""),at.setAttribute("allow",["autoplay","fullscreen","picture-in-picture","encrypted-media","accelerometer","gyroscope"].join("; ")),is.empty(et)||at.setAttribute("referrerPolicy",et),a||!s.customControls)at.setAttribute("data-poster",o.poster),o.media=replaceElement(at,o.media);else{const mt=createElement("div",{class:o.config.classNames.embedContainer,"data-poster":o.poster});mt.appendChild(at),o.media=replaceElement(mt,o.media)}s.customControls||fetch$1(format$2(o.config.urls.vimeo.api,lt)).then(mt=>{!is.empty(mt)&&mt.thumbnail_url&&ui.setPoster.call(o,mt.thumbnail_url).catch(()=>{})}),o.embed=new window.Vimeo.Player(at,{autopause:o.config.autopause,muted:o.muted}),o.media.paused=!0,o.media.currentTime=0,o.supported.ui&&o.embed.disableTextTrack(),o.media.play=()=>(assurePlaybackState$1.call(o,!0),o.embed.play()),o.media.pause=()=>(assurePlaybackState$1.call(o,!1),o.embed.pause()),o.media.stop=()=>{o.pause(),o.currentTime=0};let{currentTime:ct}=o.media;Object.defineProperty(o.media,"currentTime",{get:()=>ct,set(mt){const{embed:yt,media:vt,paused:Et,volume:xt}=o,wt=Et&&!yt.hasPlayed;vt.seeking=!0,triggerEvent.call(o,vt,"seeking"),Promise.resolve(wt&&yt.setVolume(0)).then(()=>yt.setCurrentTime(mt)).then(()=>wt&&yt.pause()).then(()=>wt&&yt.setVolume(xt)).catch(()=>{})}});let ht=o.config.speed.selected;Object.defineProperty(o.media,"playbackRate",{get:()=>ht,set(mt){o.embed.setPlaybackRate(mt).then(()=>{ht=mt,triggerEvent.call(o,o.media,"ratechange")}).catch(()=>{o.options.speed=[1]})}});let{volume:ft}=o.config;Object.defineProperty(o.media,"volume",{get:()=>ft,set(mt){o.embed.setVolume(mt).then(()=>{ft=mt,triggerEvent.call(o,o.media,"volumechange")})}});let{muted:dt}=o.config;Object.defineProperty(o.media,"muted",{get:()=>dt,set(mt){const yt=!!is.boolean(mt)&&mt;o.embed.setMuted(!!yt||o.config.muted).then(()=>{dt=yt,triggerEvent.call(o,o.media,"volumechange")})}});let pt,{loop:gt}=o.config;Object.defineProperty(o.media,"loop",{get:()=>gt,set(mt){const yt=is.boolean(mt)?mt:o.config.loop.active;o.embed.setLoop(yt).then(()=>{gt=yt})}}),o.embed.getVideoUrl().then(mt=>{pt=mt,controls.setDownloadUrl.call(o)}).catch(mt=>{this.debug.warn(mt)}),Object.defineProperty(o.media,"currentSrc",{get:()=>pt}),Object.defineProperty(o.media,"ended",{get:()=>o.currentTime===o.duration}),Promise.all([o.embed.getVideoWidth(),o.embed.getVideoHeight()]).then(mt=>{const[yt,vt]=mt;o.embed.ratio=roundAspectRatio(yt,vt),setAspectRatio.call(this)}),o.embed.setAutopause(o.config.autopause).then(mt=>{o.config.autopause=mt}),o.embed.getVideoTitle().then(mt=>{o.config.title=mt,ui.setTitle.call(this)}),o.embed.getCurrentTime().then(mt=>{ct=mt,triggerEvent.call(o,o.media,"timeupdate")}),o.embed.getDuration().then(mt=>{o.media.duration=mt,triggerEvent.call(o,o.media,"durationchange")}),o.embed.getTextTracks().then(mt=>{o.media.textTracks=mt,captions.setup.call(o)}),o.embed.on("cuechange",({cues:mt=[]})=>{const yt=mt.map(vt=>stripHTML(vt.text));captions.updateCues.call(o,yt)}),o.embed.on("loaded",()=>{o.embed.getPaused().then(mt=>{assurePlaybackState$1.call(o,!mt),mt||triggerEvent.call(o,o.media,"playing")}),is.element(o.embed.element)&&o.supported.ui&&o.embed.element.setAttribute("tabindex",-1)}),o.embed.on("bufferstart",()=>{triggerEvent.call(o,o.media,"waiting")}),o.embed.on("bufferend",()=>{triggerEvent.call(o,o.media,"playing")}),o.embed.on("play",()=>{assurePlaybackState$1.call(o,!0),triggerEvent.call(o,o.media,"playing")}),o.embed.on("pause",()=>{assurePlaybackState$1.call(o,!1)}),o.embed.on("timeupdate",mt=>{o.media.seeking=!1,ct=mt.seconds,triggerEvent.call(o,o.media,"timeupdate")}),o.embed.on("progress",mt=>{o.media.buffered=mt.percent,triggerEvent.call(o,o.media,"progress"),parseInt(mt.percent,10)===1&&triggerEvent.call(o,o.media,"canplaythrough"),o.embed.getDuration().then(yt=>{yt!==o.media.duration&&(o.media.duration=yt,triggerEvent.call(o,o.media,"durationchange"))})}),o.embed.on("seeked",()=>{o.media.seeking=!1,triggerEvent.call(o,o.media,"seeked")}),o.embed.on("ended",()=>{o.media.paused=!0,triggerEvent.call(o,o.media,"ended")}),o.embed.on("error",mt=>{o.media.error=mt,triggerEvent.call(o,o.media,"error")}),s.customControls&&setTimeout(()=>ui.build.call(o),0)}};function parseId(o){return is.empty(o)?null:o.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/)?RegExp.$2:o}function assurePlaybackState(o){o&&!this.embed.hasPlayed&&(this.embed.hasPlayed=!0),this.media.paused===o&&(this.media.paused=!o,triggerEvent.call(this,this.media,o?"play":"pause"))}function getHost(o){return o.noCookie?"https://www.youtube-nocookie.com":window.location.protocol==="http:"?"http://www.youtube.com":void 0}const youtube={setup(){if(toggleClass(this.elements.wrapper,this.config.classNames.embed,!0),is.object(window.YT)&&is.function(window.YT.Player))youtube.ready.call(this);else{const o=window.onYouTubeIframeAPIReady;window.onYouTubeIframeAPIReady=()=>{is.function(o)&&o(),youtube.ready.call(this)},loadScript(this.config.urls.youtube.sdk).catch(s=>{this.debug.warn("YouTube API failed to load",s)})}},getTitle(o){fetch$1(format$2(this.config.urls.youtube.api,o)).then(s=>{if(is.object(s)){const{title:a,height:et,width:tt}=s;this.config.title=a,ui.setTitle.call(this),this.embed.ratio=roundAspectRatio(tt,et)}setAspectRatio.call(this)}).catch(()=>{setAspectRatio.call(this)})},ready(){const o=this,s=o.config.youtube,a=o.media&&o.media.getAttribute("id");if(!is.empty(a)&&a.startsWith("youtube-"))return;let et=o.media.getAttribute("src");is.empty(et)&&(et=o.media.getAttribute(this.config.attributes.embed.id));const tt=parseId(et),rt=createElement("div",{id:generateId(o.provider),"data-poster":s.customControls?o.poster:void 0});if(o.media=replaceElement(rt,o.media),s.customControls){const nt=it=>`https://i.ytimg.com/vi/${tt}/${it}default.jpg`;loadImage(nt("maxres"),121).catch(()=>loadImage(nt("sd"),121)).catch(()=>loadImage(nt("hq"))).then(it=>ui.setPoster.call(o,it.src)).then(it=>{it.includes("maxres")||(o.elements.poster.style.backgroundSize="cover")}).catch(()=>{})}o.embed=new window.YT.Player(o.media,{videoId:tt,host:getHost(s),playerVars:extend({},{autoplay:o.config.autoplay?1:0,hl:o.config.hl,controls:o.supported.ui&&s.customControls?0:1,disablekb:1,playsinline:o.config.playsinline&&!o.config.fullscreen.iosNative?1:0,cc_load_policy:o.captions.active?1:0,cc_lang_pref:o.config.captions.language,widget_referrer:window?window.location.href:null},s),events:{onError(nt){if(!o.media.error){const it=nt.data,st={2:"The request contains an invalid parameter value. For example, this error occurs if you specify a video ID that does not have 11 characters, or if the video ID contains invalid characters, such as exclamation points or asterisks.",5:"The requested content cannot be played in an HTML5 player or another error related to the HTML5 player has occurred.",100:"The video requested was not found. This error occurs when a video has been removed (for any reason) or has been marked as private.",101:"The owner of the requested video does not allow it to be played in embedded players.",150:"The owner of the requested video does not allow it to be played in embedded players."}[it]||"An unknown error occurred";o.media.error={code:it,message:st},triggerEvent.call(o,o.media,"error")}},onPlaybackRateChange(nt){const it=nt.target;o.media.playbackRate=it.getPlaybackRate(),triggerEvent.call(o,o.media,"ratechange")},onReady(nt){if(is.function(o.media.play))return;const it=nt.target;youtube.getTitle.call(o,tt),o.media.play=()=>{assurePlaybackState.call(o,!0),it.playVideo()},o.media.pause=()=>{assurePlaybackState.call(o,!1),it.pauseVideo()},o.media.stop=()=>{it.stopVideo()},o.media.duration=it.getDuration(),o.media.paused=!0,o.media.currentTime=0,Object.defineProperty(o.media,"currentTime",{get:()=>Number(it.getCurrentTime()),set(lt){o.paused&&!o.embed.hasPlayed&&o.embed.mute(),o.media.seeking=!0,triggerEvent.call(o,o.media,"seeking"),it.seekTo(lt)}}),Object.defineProperty(o.media,"playbackRate",{get:()=>it.getPlaybackRate(),set(lt){it.setPlaybackRate(lt)}});let{volume:st}=o.config;Object.defineProperty(o.media,"volume",{get:()=>st,set(lt){st=lt,it.setVolume(100*st),triggerEvent.call(o,o.media,"volumechange")}});let{muted:ot}=o.config;Object.defineProperty(o.media,"muted",{get:()=>ot,set(lt){const ct=is.boolean(lt)?lt:ot;ot=ct,it[ct?"mute":"unMute"](),it.setVolume(100*st),triggerEvent.call(o,o.media,"volumechange")}}),Object.defineProperty(o.media,"currentSrc",{get:()=>it.getVideoUrl()}),Object.defineProperty(o.media,"ended",{get:()=>o.currentTime===o.duration});const at=it.getAvailablePlaybackRates();o.options.speed=at.filter(lt=>o.config.speed.options.includes(lt)),o.supported.ui&&s.customControls&&o.media.setAttribute("tabindex",-1),triggerEvent.call(o,o.media,"timeupdate"),triggerEvent.call(o,o.media,"durationchange"),clearInterval(o.timers.buffering),o.timers.buffering=setInterval(()=>{o.media.buffered=it.getVideoLoadedFraction(),(o.media.lastBuffered===null||o.media.lastBuffered<o.media.buffered)&&triggerEvent.call(o,o.media,"progress"),o.media.lastBuffered=o.media.buffered,o.media.buffered===1&&(clearInterval(o.timers.buffering),triggerEvent.call(o,o.media,"canplaythrough"))},200),s.customControls&&setTimeout(()=>ui.build.call(o),50)},onStateChange(nt){const it=nt.target;switch(clearInterval(o.timers.playing),o.media.seeking&&[1,2].includes(nt.data)&&(o.media.seeking=!1,triggerEvent.call(o,o.media,"seeked")),nt.data){case-1:triggerEvent.call(o,o.media,"timeupdate"),o.media.buffered=it.getVideoLoadedFraction(),triggerEvent.call(o,o.media,"progress");break;case 0:assurePlaybackState.call(o,!1),o.media.loop?(it.stopVideo(),it.playVideo()):triggerEvent.call(o,o.media,"ended");break;case 1:s.customControls&&!o.config.autoplay&&o.media.paused&&!o.embed.hasPlayed?o.media.pause():(assurePlaybackState.call(o,!0),triggerEvent.call(o,o.media,"playing"),o.timers.playing=setInterval(()=>{triggerEvent.call(o,o.media,"timeupdate")},50),o.media.duration!==it.getDuration()&&(o.media.duration=it.getDuration(),triggerEvent.call(o,o.media,"durationchange")));break;case 2:o.muted||o.embed.unMute(),assurePlaybackState.call(o,!1);break;case 3:triggerEvent.call(o,o.media,"waiting")}triggerEvent.call(o,o.elements.container,"statechange",!1,{code:nt.data})}}})}},media={setup(){this.media?(toggleClass(this.elements.container,this.config.classNames.type.replace("{0}",this.type),!0),toggleClass(this.elements.container,this.config.classNames.provider.replace("{0}",this.provider),!0),this.isEmbed&&toggleClass(this.elements.container,this.config.classNames.type.replace("{0}","video"),!0),this.isVideo&&(this.elements.wrapper=createElement("div",{class:this.config.classNames.video}),wrap(this.media,this.elements.wrapper),this.elements.poster=createElement("div",{class:this.config.classNames.poster}),this.elements.wrapper.appendChild(this.elements.poster)),this.isHTML5?html5.setup.call(this):this.isYouTube?youtube.setup.call(this):this.isVimeo&&vimeo.setup.call(this)):this.debug.warn("No media element found!")}};class Ads{constructor(s){_defineProperty$1(this,"load",()=>{this.enabled&&(is.object(window.google)&&is.object(window.google.ima)?this.ready():loadScript(this.player.config.urls.googleIMA.sdk).then(()=>{this.ready()}).catch(()=>{this.trigger("error",new Error("Google IMA SDK failed to load"))}))}),_defineProperty$1(this,"ready",()=>{var a;this.enabled||((a=this).manager&&a.manager.destroy(),a.elements.displayContainer&&a.elements.displayContainer.destroy(),a.elements.container.remove()),this.startSafetyTimer(12e3,"ready()"),this.managerPromise.then(()=>{this.clearSafetyTimer("onAdsManagerLoaded()")}),this.listeners(),this.setupIMA()}),_defineProperty$1(this,"setupIMA",()=>{this.elements.container=createElement("div",{class:this.player.config.classNames.ads}),this.player.elements.container.appendChild(this.elements.container),google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),google.ima.settings.setLocale(this.player.config.ads.language),google.ima.settings.setDisableCustomPlaybackForIOS10Plus(this.player.config.playsinline),this.elements.displayContainer=new google.ima.AdDisplayContainer(this.elements.container,this.player.media),this.loader=new google.ima.AdsLoader(this.elements.displayContainer),this.loader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,a=>this.onAdsManagerLoaded(a),!1),this.loader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,a=>this.onAdError(a),!1),this.requestAds()}),_defineProperty$1(this,"requestAds",()=>{const{container:a}=this.player.elements;try{const et=new google.ima.AdsRequest;et.adTagUrl=this.tagUrl,et.linearAdSlotWidth=a.offsetWidth,et.linearAdSlotHeight=a.offsetHeight,et.nonLinearAdSlotWidth=a.offsetWidth,et.nonLinearAdSlotHeight=a.offsetHeight,et.forceNonLinearFullSlot=!1,et.setAdWillPlayMuted(!this.player.muted),this.loader.requestAds(et)}catch(et){this.onAdError(et)}}),_defineProperty$1(this,"pollCountdown",(a=!1)=>{if(!a)return clearInterval(this.countdownTimer),void this.elements.container.removeAttribute("data-badge-text");this.countdownTimer=setInterval(()=>{const et=formatTime(Math.max(this.manager.getRemainingTime(),0)),tt=`${i18n.get("advertisement",this.player.config)} - ${et}`;this.elements.container.setAttribute("data-badge-text",tt)},100)}),_defineProperty$1(this,"onAdsManagerLoaded",a=>{if(!this.enabled)return;const et=new google.ima.AdsRenderingSettings;et.restoreCustomPlaybackStateOnAdBreakComplete=!0,et.enablePreloading=!0,this.manager=a.getAdsManager(this.player,et),this.cuePoints=this.manager.getCuePoints(),this.manager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,tt=>this.onAdError(tt)),Object.keys(google.ima.AdEvent.Type).forEach(tt=>{this.manager.addEventListener(google.ima.AdEvent.Type[tt],rt=>this.onAdEvent(rt))}),this.trigger("loaded")}),_defineProperty$1(this,"addCuePoints",()=>{is.empty(this.cuePoints)||this.cuePoints.forEach(a=>{if(a!==0&&a!==-1&&a<this.player.duration){const et=this.player.elements.progress;if(is.element(et)){const tt=100/this.player.duration*a,rt=createElement("span",{class:this.player.config.classNames.cues});rt.style.left=`${tt.toString()}%`,et.appendChild(rt)}}})}),_defineProperty$1(this,"onAdEvent",a=>{const{container:et}=this.player.elements,tt=a.getAd(),rt=a.getAdData();switch((nt=>{triggerEvent.call(this.player,this.player.media,`ads${nt.replace(/_/g,"").toLowerCase()}`)})(a.type),a.type){case google.ima.AdEvent.Type.LOADED:this.trigger("loaded"),this.pollCountdown(!0),tt.isLinear()||(tt.width=et.offsetWidth,tt.height=et.offsetHeight);break;case google.ima.AdEvent.Type.STARTED:this.manager.setVolume(this.player.volume);break;case google.ima.AdEvent.Type.ALL_ADS_COMPLETED:this.player.ended?this.loadAds():this.loader.contentComplete();break;case google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED:this.pauseContent();break;case google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED:this.pollCountdown(),this.resumeContent();break;case google.ima.AdEvent.Type.LOG:rt.adError&&this.player.debug.warn(`Non-fatal ad error: ${rt.adError.getMessage()}`)}}),_defineProperty$1(this,"onAdError",a=>{this.cancel(),this.player.debug.warn("Ads error",a)}),_defineProperty$1(this,"listeners",()=>{const{container:a}=this.player.elements;let et;this.player.on("canplay",()=>{this.addCuePoints()}),this.player.on("ended",()=>{this.loader.contentComplete()}),this.player.on("timeupdate",()=>{et=this.player.currentTime}),this.player.on("seeked",()=>{const tt=this.player.currentTime;is.empty(this.cuePoints)||this.cuePoints.forEach((rt,nt)=>{et<rt&&rt<tt&&(this.manager.discardAdBreak(),this.cuePoints.splice(nt,1))})}),window.addEventListener("resize",()=>{this.manager&&this.manager.resize(a.offsetWidth,a.offsetHeight,google.ima.ViewMode.NORMAL)})}),_defineProperty$1(this,"play",()=>{const{container:a}=this.player.elements;this.managerPromise||this.resumeContent(),this.managerPromise.then(()=>{this.manager.setVolume(this.player.volume),this.elements.displayContainer.initialize();try{this.initialized||(this.manager.init(a.offsetWidth,a.offsetHeight,google.ima.ViewMode.NORMAL),this.manager.start()),this.initialized=!0}catch(et){this.onAdError(et)}}).catch(()=>{})}),_defineProperty$1(this,"resumeContent",()=>{this.elements.container.style.zIndex="",this.playing=!1,silencePromise(this.player.media.play())}),_defineProperty$1(this,"pauseContent",()=>{this.elements.container.style.zIndex=3,this.playing=!0,this.player.media.pause()}),_defineProperty$1(this,"cancel",()=>{this.initialized&&this.resumeContent(),this.trigger("error"),this.loadAds()}),_defineProperty$1(this,"loadAds",()=>{this.managerPromise.then(()=>{this.manager&&this.manager.destroy(),this.managerPromise=new Promise(a=>{this.on("loaded",a),this.player.debug.log(this.manager)}),this.initialized=!1,this.requestAds()}).catch(()=>{})}),_defineProperty$1(this,"trigger",(a,...et)=>{const tt=this.events[a];is.array(tt)&&tt.forEach(rt=>{is.function(rt)&&rt.apply(this,et)})}),_defineProperty$1(this,"on",(a,et)=>(is.array(this.events[a])||(this.events[a]=[]),this.events[a].push(et),this)),_defineProperty$1(this,"startSafetyTimer",(a,et)=>{this.player.debug.log(`Safety timer invoked from: ${et}`),this.safetyTimer=setTimeout(()=>{this.cancel(),this.clearSafetyTimer("startSafetyTimer()")},a)}),_defineProperty$1(this,"clearSafetyTimer",a=>{is.nullOrUndefined(this.safetyTimer)||(this.player.debug.log(`Safety timer cleared from: ${a}`),clearTimeout(this.safetyTimer),this.safetyTimer=null)}),this.player=s,this.config=s.config.ads,this.playing=!1,this.initialized=!1,this.elements={container:null,displayContainer:null},this.manager=null,this.loader=null,this.cuePoints=null,this.events={},this.safetyTimer=null,this.countdownTimer=null,this.managerPromise=new Promise((a,et)=>{this.on("loaded",a),this.on("error",et)}),this.load()}get enabled(){const{config:s}=this;return this.player.isHTML5&&this.player.isVideo&&s.enabled&&(!is.empty(s.publisherId)||is.url(s.tagUrl))}get tagUrl(){const{config:s}=this;return is.url(s.tagUrl)?s.tagUrl:`https://go.aniview.com/api/adserver6/vast/?${buildUrlParams({AV_PUBLISHERID:"58c25bb0073ef448b1087ad6",AV_CHANNELID:"5a0458dc28a06145e4519d21",AV_URL:window.location.hostname,cb:Date.now(),AV_WIDTH:640,AV_HEIGHT:480,AV_CDIM2:s.publisherId})}`}}function clamp(o=0,s=0,a=255){return Math.min(Math.max(o,s),a)}const parseVtt=o=>{const s=[];return o.split(/\r\n\r\n|\n\n|\r\r/).forEach(a=>{const et={};a.split(/\r\n|\n|\r/).forEach(tt=>{if(is.number(et.startTime)){if(!is.empty(tt.trim())&&is.empty(et.text)){const rt=tt.trim().split("#xywh=");[et.text]=rt,rt[1]&&([et.x,et.y,et.w,et.h]=rt[1].split(","))}}else{const rt=tt.match(/([0-9]{2})?:?([0-9]{2}):([0-9]{2}).([0-9]{2,3})( ?--> ?)([0-9]{2})?:?([0-9]{2}):([0-9]{2}).([0-9]{2,3})/);rt&&(et.startTime=60*Number(rt[1]||0)*60+60*Number(rt[2])+Number(rt[3])+ +`0.${rt[4]}`,et.endTime=60*Number(rt[6]||0)*60+60*Number(rt[7])+Number(rt[8])+ +`0.${rt[9]}`)}}),et.text&&s.push(et)}),s},fitRatio=(o,s)=>{const a={};return o>s.width/s.height?(a.width=s.width,a.height=1/o*s.width):(a.height=s.height,a.width=o*s.height),a};class PreviewThumbnails{constructor(s){_defineProperty$1(this,"load",()=>{this.player.elements.display.seekTooltip&&(this.player.elements.display.seekTooltip.hidden=this.enabled),this.enabled&&this.getThumbnails().then(()=>{this.enabled&&(this.render(),this.determineContainerAutoSizing(),this.listeners(),this.loaded=!0)})}),_defineProperty$1(this,"getThumbnails",()=>new Promise(a=>{const{src:et}=this.player.config.previewThumbnails;if(is.empty(et))throw new Error("Missing previewThumbnails.src config attribute");const tt=()=>{this.thumbnails.sort((rt,nt)=>rt.height-nt.height),this.player.debug.log("Preview thumbnails",this.thumbnails),a()};if(is.function(et))et(rt=>{this.thumbnails=rt,tt()});else{const rt=(is.string(et)?[et]:et).map(nt=>this.getThumbnail(nt));Promise.all(rt).then(tt)}})),_defineProperty$1(this,"getThumbnail",a=>new Promise(et=>{fetch$1(a).then(tt=>{const rt={frames:parseVtt(tt),height:null,urlPrefix:""};rt.frames[0].text.startsWith("/")||rt.frames[0].text.startsWith("http://")||rt.frames[0].text.startsWith("https://")||(rt.urlPrefix=a.substring(0,a.lastIndexOf("/")+1));const nt=new Image;nt.onload=()=>{rt.height=nt.naturalHeight,rt.width=nt.naturalWidth,this.thumbnails.push(rt),et()},nt.src=rt.urlPrefix+rt.frames[0].text})})),_defineProperty$1(this,"startMove",a=>{if(this.loaded&&is.event(a)&&["touchmove","mousemove"].includes(a.type)&&this.player.media.duration){if(a.type==="touchmove")this.seekTime=this.player.media.duration*(this.player.elements.inputs.seek.value/100);else{var et,tt;const rt=this.player.elements.progress.getBoundingClientRect(),nt=100/rt.width*(a.pageX-rt.left);this.seekTime=this.player.media.duration*(nt/100),this.seekTime<0&&(this.seekTime=0),this.seekTime>this.player.media.duration-1&&(this.seekTime=this.player.media.duration-1),this.mousePosX=a.pageX,this.elements.thumb.time.innerText=formatTime(this.seekTime);const it=(et=this.player.config.markers)===null||et===void 0||(tt=et.points)===null||tt===void 0?void 0:tt.find(({time:st})=>st===Math.round(this.seekTime));it&&this.elements.thumb.time.insertAdjacentHTML("afterbegin",`${it.label}<br>`)}this.showImageAtCurrentTime()}}),_defineProperty$1(this,"endMove",()=>{this.toggleThumbContainer(!1,!0)}),_defineProperty$1(this,"startScrubbing",a=>{(is.nullOrUndefined(a.button)||a.button===!1||a.button===0)&&(this.mouseDown=!0,this.player.media.duration&&(this.toggleScrubbingContainer(!0),this.toggleThumbContainer(!1,!0),this.showImageAtCurrentTime()))}),_defineProperty$1(this,"endScrubbing",()=>{this.mouseDown=!1,Math.ceil(this.lastTime)===Math.ceil(this.player.media.currentTime)?this.toggleScrubbingContainer(!1):once.call(this.player,this.player.media,"timeupdate",()=>{this.mouseDown||this.toggleScrubbingContainer(!1)})}),_defineProperty$1(this,"listeners",()=>{this.player.on("play",()=>{this.toggleThumbContainer(!1,!0)}),this.player.on("seeked",()=>{this.toggleThumbContainer(!1)}),this.player.on("timeupdate",()=>{this.lastTime=this.player.media.currentTime})}),_defineProperty$1(this,"render",()=>{this.elements.thumb.container=createElement("div",{class:this.player.config.classNames.previewThumbnails.thumbContainer}),this.elements.thumb.imageContainer=createElement("div",{class:this.player.config.classNames.previewThumbnails.imageContainer}),this.elements.thumb.container.appendChild(this.elements.thumb.imageContainer);const a=createElement("div",{class:this.player.config.classNames.previewThumbnails.timeContainer});this.elements.thumb.time=createElement("span",{},"00:00"),a.appendChild(this.elements.thumb.time),this.elements.thumb.imageContainer.appendChild(a),is.element(this.player.elements.progress)&&this.player.elements.progress.appendChild(this.elements.thumb.container),this.elements.scrubbing.container=createElement("div",{class:this.player.config.classNames.previewThumbnails.scrubbingContainer}),this.player.elements.wrapper.appendChild(this.elements.scrubbing.container)}),_defineProperty$1(this,"destroy",()=>{this.elements.thumb.container&&this.elements.thumb.container.remove(),this.elements.scrubbing.container&&this.elements.scrubbing.container.remove()}),_defineProperty$1(this,"showImageAtCurrentTime",()=>{this.mouseDown?this.setScrubbingContainerSize():this.setThumbContainerSizeAndPos();const a=this.thumbnails[0].frames.findIndex(rt=>this.seekTime>=rt.startTime&&this.seekTime<=rt.endTime),et=a>=0;let tt=0;this.mouseDown||this.toggleThumbContainer(et),et&&(this.thumbnails.forEach((rt,nt)=>{this.loadedImages.includes(rt.frames[a].text)&&(tt=nt)}),a!==this.showingThumb&&(this.showingThumb=a,this.loadImage(tt)))}),_defineProperty$1(this,"loadImage",(a=0)=>{const et=this.showingThumb,tt=this.thumbnails[a],{urlPrefix:rt}=tt,nt=tt.frames[et],it=tt.frames[et].text,st=rt+it;if(this.currentImageElement&&this.currentImageElement.dataset.filename===it)this.showImage(this.currentImageElement,nt,a,et,it,!1),this.currentImageElement.dataset.index=et,this.removeOldImages(this.currentImageElement);else{this.loadingImage&&this.usingSprites&&(this.loadingImage.onload=null);const ot=new Image;ot.src=st,ot.dataset.index=et,ot.dataset.filename=it,this.showingThumbFilename=it,this.player.debug.log(`Loading image: ${st}`),ot.onload=()=>this.showImage(ot,nt,a,et,it,!0),this.loadingImage=ot,this.removeOldImages(ot)}}),_defineProperty$1(this,"showImage",(a,et,tt,rt,nt,it=!0)=>{this.player.debug.log(`Showing thumb: ${nt}. num: ${rt}. qual: ${tt}. newimg: ${it}`),this.setImageSizeAndOffset(a,et),it&&(this.currentImageContainer.appendChild(a),this.currentImageElement=a,this.loadedImages.includes(nt)||this.loadedImages.push(nt)),this.preloadNearby(rt,!0).then(this.preloadNearby(rt,!1)).then(this.getHigherQuality(tt,a,et,nt))}),_defineProperty$1(this,"removeOldImages",a=>{Array.from(this.currentImageContainer.children).forEach(et=>{if(et.tagName.toLowerCase()!=="img")return;const tt=this.usingSprites?500:1e3;if(et.dataset.index!==a.dataset.index&&!et.dataset.deleting){et.dataset.deleting=!0;const{currentImageContainer:rt}=this;setTimeout(()=>{rt.removeChild(et),this.player.debug.log(`Removing thumb: ${et.dataset.filename}`)},tt)}})}),_defineProperty$1(this,"preloadNearby",(a,et=!0)=>new Promise(tt=>{setTimeout(()=>{const rt=this.thumbnails[0].frames[a].text;if(this.showingThumbFilename===rt){let nt;nt=et?this.thumbnails[0].frames.slice(a):this.thumbnails[0].frames.slice(0,a).reverse();let it=!1;nt.forEach(st=>{const ot=st.text;if(ot!==rt&&!this.loadedImages.includes(ot)){it=!0,this.player.debug.log(`Preloading thumb filename: ${ot}`);const{urlPrefix:at}=this.thumbnails[0],lt=at+ot,ct=new Image;ct.src=lt,ct.onload=()=>{this.player.debug.log(`Preloaded thumb filename: ${ot}`),this.loadedImages.includes(ot)||this.loadedImages.push(ot),tt()}}}),it||tt()}},300)})),_defineProperty$1(this,"getHigherQuality",(a,et,tt,rt)=>{if(a<this.thumbnails.length-1){let nt=et.naturalHeight;this.usingSprites&&(nt=tt.h),nt<this.thumbContainerHeight&&setTimeout(()=>{this.showingThumbFilename===rt&&(this.player.debug.log(`Showing higher quality thumb for: ${rt}`),this.loadImage(a+1))},300)}}),_defineProperty$1(this,"toggleThumbContainer",(a=!1,et=!1)=>{const tt=this.player.config.classNames.previewThumbnails.thumbContainerShown;this.elements.thumb.container.classList.toggle(tt,a),!a&&et&&(this.showingThumb=null,this.showingThumbFilename=null)}),_defineProperty$1(this,"toggleScrubbingContainer",(a=!1)=>{const et=this.player.config.classNames.previewThumbnails.scrubbingContainerShown;this.elements.scrubbing.container.classList.toggle(et,a),a||(this.showingThumb=null,this.showingThumbFilename=null)}),_defineProperty$1(this,"determineContainerAutoSizing",()=>{(this.elements.thumb.imageContainer.clientHeight>20||this.elements.thumb.imageContainer.clientWidth>20)&&(this.sizeSpecifiedInCSS=!0)}),_defineProperty$1(this,"setThumbContainerSizeAndPos",()=>{const{imageContainer:a}=this.elements.thumb;if(this.sizeSpecifiedInCSS){if(a.clientHeight>20&&a.clientWidth<20){const et=Math.floor(a.clientHeight*this.thumbAspectRatio);a.style.width=`${et}px`}else if(a.clientHeight<20&&a.clientWidth>20){const et=Math.floor(a.clientWidth/this.thumbAspectRatio);a.style.height=`${et}px`}}else{const et=Math.floor(this.thumbContainerHeight*this.thumbAspectRatio);a.style.height=`${this.thumbContainerHeight}px`,a.style.width=`${et}px`}this.setThumbContainerPos()}),_defineProperty$1(this,"setThumbContainerPos",()=>{const a=this.player.elements.progress.getBoundingClientRect(),et=this.player.elements.container.getBoundingClientRect(),{container:tt}=this.elements.thumb,rt=et.left-a.left+10,nt=et.right-a.left-tt.clientWidth-10,it=this.mousePosX-a.left-tt.clientWidth/2,st=clamp(it,rt,nt);tt.style.left=`${st}px`,tt.style.setProperty("--preview-arrow-offset",it-st+"px")}),_defineProperty$1(this,"setScrubbingContainerSize",()=>{const{width:a,height:et}=fitRatio(this.thumbAspectRatio,{width:this.player.media.clientWidth,height:this.player.media.clientHeight});this.elements.scrubbing.container.style.width=`${a}px`,this.elements.scrubbing.container.style.height=`${et}px`}),_defineProperty$1(this,"setImageSizeAndOffset",(a,et)=>{if(!this.usingSprites)return;const tt=this.thumbContainerHeight/et.h;a.style.height=a.naturalHeight*tt+"px",a.style.width=a.naturalWidth*tt+"px",a.style.left=`-${et.x*tt}px`,a.style.top=`-${et.y*tt}px`}),this.player=s,this.thumbnails=[],this.loaded=!1,this.lastMouseMoveTime=Date.now(),this.mouseDown=!1,this.loadedImages=[],this.elements={thumb:{},scrubbing:{}},this.load()}get enabled(){return this.player.isHTML5&&this.player.isVideo&&this.player.config.previewThumbnails.enabled}get currentImageContainer(){return this.mouseDown?this.elements.scrubbing.container:this.elements.thumb.imageContainer}get usingSprites(){return Object.keys(this.thumbnails[0].frames[0]).includes("w")}get thumbAspectRatio(){return this.usingSprites?this.thumbnails[0].frames[0].w/this.thumbnails[0].frames[0].h:this.thumbnails[0].width/this.thumbnails[0].height}get thumbContainerHeight(){if(this.mouseDown){const{height:s}=fitRatio(this.thumbAspectRatio,{width:this.player.media.clientWidth,height:this.player.media.clientHeight});return s}return this.sizeSpecifiedInCSS?this.elements.thumb.imageContainer.clientHeight:Math.floor(this.player.media.clientWidth/this.thumbAspectRatio/4)}get currentImageElement(){return this.mouseDown?this.currentScrubbingImageElement:this.currentThumbnailImageElement}set currentImageElement(s){this.mouseDown?this.currentScrubbingImageElement=s:this.currentThumbnailImageElement=s}}const source={insertElements(o,s){is.string(s)?insertElement(o,this.media,{src:s}):is.array(s)&&s.forEach(a=>{insertElement(o,this.media,a)})},change(o){getDeep(o,"sources.length")?(html5.cancelRequests.call(this),this.destroy.call(this,()=>{this.options.quality=[],removeElement(this.media),this.media=null,is.element(this.elements.container)&&this.elements.container.removeAttribute("class");const{sources:s,type:a}=o,[{provider:et=providers.html5,src:tt}]=s,rt=et==="html5"?a:"div",nt=et==="html5"?{}:{src:tt};Object.assign(this,{provider:et,type:a,supported:support.check(a,et,this.config.playsinline),media:createElement(rt,nt)}),this.elements.container.appendChild(this.media),is.boolean(o.autoplay)&&(this.config.autoplay=o.autoplay),this.isHTML5&&(this.config.crossorigin&&this.media.setAttribute("crossorigin",""),this.config.autoplay&&this.media.setAttribute("autoplay",""),is.empty(o.poster)||(this.poster=o.poster),this.config.loop.active&&this.media.setAttribute("loop",""),this.config.muted&&this.media.setAttribute("muted",""),this.config.playsinline&&this.media.setAttribute("playsinline","")),ui.addStyleHook.call(this),this.isHTML5&&source.insertElements.call(this,"source",s),this.config.title=o.title,media.setup.call(this),this.isHTML5&&Object.keys(o).includes("tracks")&&source.insertElements.call(this,"track",o.tracks),(this.isHTML5||this.isEmbed&&!this.supported.ui)&&ui.build.call(this),this.isHTML5&&this.media.load(),is.empty(o.previewThumbnails)||(Object.assign(this.config.previewThumbnails,o.previewThumbnails),this.previewThumbnails&&this.previewThumbnails.loaded&&(this.previewThumbnails.destroy(),this.previewThumbnails=null),this.config.previewThumbnails.enabled&&(this.previewThumbnails=new PreviewThumbnails(this))),this.fullscreen.update()},!0)):this.debug.warn("Invalid source format")}};let Plyr$1=class ws{constructor(s,a){if(_defineProperty$1(this,"play",()=>is.function(this.media.play)?(this.ads&&this.ads.enabled&&this.ads.managerPromise.then(()=>this.ads.play()).catch(()=>silencePromise(this.media.play())),this.media.play()):null),_defineProperty$1(this,"pause",()=>this.playing&&is.function(this.media.pause)?this.media.pause():null),_defineProperty$1(this,"togglePlay",it=>(is.boolean(it)?it:!this.playing)?this.play():this.pause()),_defineProperty$1(this,"stop",()=>{this.isHTML5?(this.pause(),this.restart()):is.function(this.media.stop)&&this.media.stop()}),_defineProperty$1(this,"restart",()=>{this.currentTime=0}),_defineProperty$1(this,"rewind",it=>{this.currentTime-=is.number(it)?it:this.config.seekTime}),_defineProperty$1(this,"forward",it=>{this.currentTime+=is.number(it)?it:this.config.seekTime}),_defineProperty$1(this,"increaseVolume",it=>{const st=this.media.muted?0:this.volume;this.volume=st+(is.number(it)?it:0)}),_defineProperty$1(this,"decreaseVolume",it=>{this.increaseVolume(-it)}),_defineProperty$1(this,"airplay",()=>{support.airplay&&this.media.webkitShowPlaybackTargetPicker()}),_defineProperty$1(this,"toggleControls",it=>{if(this.supported.ui&&!this.isAudio){const st=hasClass(this.elements.container,this.config.classNames.hideControls),ot=it===void 0?void 0:!it,at=toggleClass(this.elements.container,this.config.classNames.hideControls,ot);if(at&&is.array(this.config.controls)&&this.config.controls.includes("settings")&&!is.empty(this.config.settings)&&controls.toggleMenu.call(this,!1),at!==st){const lt=at?"controlshidden":"controlsshown";triggerEvent.call(this,this.media,lt)}return!at}return!1}),_defineProperty$1(this,"on",(it,st)=>{on.call(this,this.elements.container,it,st)}),_defineProperty$1(this,"once",(it,st)=>{once.call(this,this.elements.container,it,st)}),_defineProperty$1(this,"off",(it,st)=>{off(this.elements.container,it,st)}),_defineProperty$1(this,"destroy",(it,st=!1)=>{if(!this.ready)return;const ot=()=>{document.body.style.overflow="",this.embed=null,st?(Object.keys(this.elements).length&&(removeElement(this.elements.buttons.play),removeElement(this.elements.captions),removeElement(this.elements.controls),removeElement(this.elements.wrapper),this.elements.buttons.play=null,this.elements.captions=null,this.elements.controls=null,this.elements.wrapper=null),is.function(it)&&it()):(unbindListeners.call(this),html5.cancelRequests.call(this),replaceElement(this.elements.original,this.elements.container),triggerEvent.call(this,this.elements.original,"destroyed",!0),is.function(it)&&it.call(this.elements.original),this.ready=!1,setTimeout(()=>{this.elements=null,this.media=null},200))};this.stop(),clearTimeout(this.timers.loading),clearTimeout(this.timers.controls),clearTimeout(this.timers.resized),this.isHTML5?(ui.toggleNativeControls.call(this,!0),ot()):this.isYouTube?(clearInterval(this.timers.buffering),clearInterval(this.timers.playing),this.embed!==null&&is.function(this.embed.destroy)&&this.embed.destroy(),ot()):this.isVimeo&&(this.embed!==null&&this.embed.unload().then(ot),setTimeout(ot,200))}),_defineProperty$1(this,"supports",it=>support.mime.call(this,it)),this.timers={},this.ready=!1,this.loading=!1,this.failed=!1,this.touch=support.touch,this.media=s,is.string(this.media)&&(this.media=document.querySelectorAll(this.media)),(window.jQuery&&this.media instanceof jQuery||is.nodeList(this.media)||is.array(this.media))&&(this.media=this.media[0]),this.config=extend({},defaults$2,ws.defaults,a||{},(()=>{try{return JSON.parse(this.media.getAttribute("data-plyr-config"))}catch{return{}}})()),this.elements={container:null,fullscreen:null,captions:null,buttons:{},display:{},progress:{},inputs:{},settings:{popup:null,menu:null,panels:{},buttons:{}}},this.captions={active:null,currentTrack:-1,meta:new WeakMap},this.fullscreen={active:!1},this.options={speed:[],quality:[]},this.debug=new Console(this.config.debug),this.debug.log("Config",this.config),this.debug.log("Support",support),is.nullOrUndefined(this.media)||!is.element(this.media))return void this.debug.error("Setup failed: no suitable element passed");if(this.media.plyr)return void this.debug.warn("Target already setup");if(!this.config.enabled)return void this.debug.error("Setup failed: disabled by config");if(!support.check().api)return void this.debug.error("Setup failed: no support");const et=this.media.cloneNode(!0);et.autoplay=!1,this.elements.original=et;const tt=this.media.tagName.toLowerCase();let rt=null,nt=null;switch(tt){case"div":if(rt=this.media.querySelector("iframe"),is.element(rt)){if(nt=parseUrl(rt.getAttribute("src")),this.provider=getProviderByUrl(nt.toString()),this.elements.container=this.media,this.media=rt,this.elements.container.className="",nt.search.length){const it=["1","true"];it.includes(nt.searchParams.get("autoplay"))&&(this.config.autoplay=!0),it.includes(nt.searchParams.get("loop"))&&(this.config.loop.active=!0),this.isYouTube?(this.config.playsinline=it.includes(nt.searchParams.get("playsinline")),this.config.youtube.hl=nt.searchParams.get("hl")):this.config.playsinline=!0}}else this.provider=this.media.getAttribute(this.config.attributes.embed.provider),this.media.removeAttribute(this.config.attributes.embed.provider);if(is.empty(this.provider)||!Object.values(providers).includes(this.provider))return void this.debug.error("Setup failed: Invalid provider");this.type=types.video;break;case"video":case"audio":this.type=tt,this.provider=providers.html5,this.media.hasAttribute("crossorigin")&&(this.config.crossorigin=!0),this.media.hasAttribute("autoplay")&&(this.config.autoplay=!0),(this.media.hasAttribute("playsinline")||this.media.hasAttribute("webkit-playsinline"))&&(this.config.playsinline=!0),this.media.hasAttribute("muted")&&(this.config.muted=!0),this.media.hasAttribute("loop")&&(this.config.loop.active=!0);break;default:return void this.debug.error("Setup failed: unsupported type")}this.supported=support.check(this.type,this.provider),this.supported.api?(this.eventListeners=[],this.listeners=new Listeners(this),this.storage=new Storage(this),this.media.plyr=this,is.element(this.elements.container)||(this.elements.container=createElement("div"),wrap(this.media,this.elements.container)),ui.migrateStyles.call(this),ui.addStyleHook.call(this),media.setup.call(this),this.config.debug&&on.call(this,this.elements.container,this.config.events.join(" "),it=>{this.debug.log(`event: ${it.type}`)}),this.fullscreen=new Fullscreen(this),(this.isHTML5||this.isEmbed&&!this.supported.ui)&&ui.build.call(this),this.listeners.container(),this.listeners.global(),this.config.ads.enabled&&(this.ads=new Ads(this)),this.isHTML5&&this.config.autoplay&&this.once("canplay",()=>silencePromise(this.play())),this.lastSeekTime=0,this.config.previewThumbnails.enabled&&(this.previewThumbnails=new PreviewThumbnails(this))):this.debug.error("Setup failed: no support")}get isHTML5(){return this.provider===providers.html5}get isEmbed(){return this.isYouTube||this.isVimeo}get isYouTube(){return this.provider===providers.youtube}get isVimeo(){return this.provider===providers.vimeo}get isVideo(){return this.type===types.video}get isAudio(){return this.type===types.audio}get playing(){return!!(this.ready&&!this.paused&&!this.ended)}get paused(){return!!this.media.paused}get stopped(){return!!(this.paused&&this.currentTime===0)}get ended(){return!!this.media.ended}set currentTime(s){if(!this.duration)return;const a=is.number(s)&&s>0;this.media.currentTime=a?Math.min(s,this.duration):0,this.debug.log(`Seeking to ${this.currentTime} seconds`)}get currentTime(){return Number(this.media.currentTime)}get buffered(){const{buffered:s}=this.media;return is.number(s)?s:s&&s.length&&this.duration>0?s.end(0)/this.duration:0}get seeking(){return!!this.media.seeking}get duration(){const s=parseFloat(this.config.duration),a=(this.media||{}).duration,et=is.number(a)&&a!==1/0?a:0;return s||et}set volume(s){let a=s;is.string(a)&&(a=Number(a)),is.number(a)||(a=this.storage.get("volume")),is.number(a)||({volume:a}=this.config),a>1&&(a=1),a<0&&(a=0),this.config.volume=a,this.media.volume=a,!is.empty(s)&&this.muted&&a>0&&(this.muted=!1)}get volume(){return Number(this.media.volume)}set muted(s){let a=s;is.boolean(a)||(a=this.storage.get("muted")),is.boolean(a)||(a=this.config.muted),this.config.muted=a,this.media.muted=a}get muted(){return!!this.media.muted}get hasAudio(){return!this.isHTML5||!!this.isAudio||!!this.media.mozHasAudio||!!this.media.webkitAudioDecodedByteCount||!!(this.media.audioTracks&&this.media.audioTracks.length)}set speed(s){let a=null;is.number(s)&&(a=s),is.number(a)||(a=this.storage.get("speed")),is.number(a)||(a=this.config.speed.selected);const{minimumSpeed:et,maximumSpeed:tt}=this;a=clamp(a,et,tt),this.config.speed.selected=a,setTimeout(()=>{this.media&&(this.media.playbackRate=a)},0)}get speed(){return Number(this.media.playbackRate)}get minimumSpeed(){return this.isYouTube?Math.min(...this.options.speed):this.isVimeo?.5:.0625}get maximumSpeed(){return this.isYouTube?Math.max(...this.options.speed):this.isVimeo?2:16}set quality(s){const a=this.config.quality,et=this.options.quality;if(!et.length)return;let tt=[!is.empty(s)&&Number(s),this.storage.get("quality"),a.selected,a.default].find(is.number),rt=!0;if(!et.includes(tt)){const nt=closest(et,tt);this.debug.warn(`Unsupported quality option: ${tt}, using ${nt} instead`),tt=nt,rt=!1}a.selected=tt,this.media.quality=tt,rt&&this.storage.set({quality:tt})}get quality(){return this.media.quality}set loop(s){const a=is.boolean(s)?s:this.config.loop.active;this.config.loop.active=a,this.media.loop=a}get loop(){return!!this.media.loop}set source(s){source.change.call(this,s)}get source(){return this.media.currentSrc}get download(){const{download:s}=this.config.urls;return is.url(s)?s:this.source}set download(s){is.url(s)&&(this.config.urls.download=s,controls.setDownloadUrl.call(this))}set poster(s){this.isVideo?ui.setPoster.call(this,s,!1).catch(()=>{}):this.debug.warn("Poster can only be set for video")}get poster(){return this.isVideo?this.media.getAttribute("poster")||this.media.getAttribute("data-poster"):null}get ratio(){if(!this.isVideo)return null;const s=reduceAspectRatio(getAspectRatio.call(this));return is.array(s)?s.join(":"):s}set ratio(s){this.isVideo?is.string(s)&&validateAspectRatio(s)?(this.config.ratio=reduceAspectRatio(s),setAspectRatio.call(this)):this.debug.error(`Invalid aspect ratio specified (${s})`):this.debug.warn("Aspect ratio can only be set for video")}set autoplay(s){this.config.autoplay=is.boolean(s)?s:this.config.autoplay}get autoplay(){return!!this.config.autoplay}toggleCaptions(s){captions.toggle.call(this,s,!1)}set currentTrack(s){captions.set.call(this,s,!1),captions.setup.call(this)}get currentTrack(){const{toggled:s,currentTrack:a}=this.captions;return s?a:-1}set language(s){captions.setLanguage.call(this,s,!1)}get language(){return(captions.getCurrentTrack.call(this)||{}).language}set pip(s){if(!support.pip)return;const a=is.boolean(s)?s:!this.pip;is.function(this.media.webkitSetPresentationMode)&&this.media.webkitSetPresentationMode(a?pip.active:pip.inactive),is.function(this.media.requestPictureInPicture)&&(!this.pip&&a?this.media.requestPictureInPicture():this.pip&&!a&&document.exitPictureInPicture())}get pip(){return support.pip?is.empty(this.media.webkitPresentationMode)?this.media===document.pictureInPictureElement:this.media.webkitPresentationMode===pip.active:null}setPreviewThumbnails(s){this.previewThumbnails&&this.previewThumbnails.loaded&&(this.previewThumbnails.destroy(),this.previewThumbnails=null),Object.assign(this.config.previewThumbnails,s),this.config.previewThumbnails.enabled&&(this.previewThumbnails=new PreviewThumbnails(this))}static supported(s,a){return support.check(s,a)}static loadSprite(s,a){return loadSprite(s,a)}static setup(s,a={}){let et=null;return is.string(s)?et=Array.from(document.querySelectorAll(s)):is.nodeList(s)?et=Array.from(s):is.array(s)&&(et=s.filter(is.element)),is.empty(et)?null:et.map(tt=>new ws(tt,a))}};Plyr$1.defaults=cloneDeep(defaults$2);function useAptor(o,s,a=[]){const[et,tt]=reactExports.useState(null),rt=reactExports.useRef(null),{instantiate:nt,destroy:it,getAPI:st,params:ot}=s;reactExports.useEffect(()=>{const lt=nt(rt.current,ot);return tt(lt),()=>{it&&it(lt,ot)}},a);const at=reactExports.useMemo(()=>st(et,ot),[et]);return reactExports.useImperativeHandle(o,at,[at]),rt}var define_import_meta_env_default$2={WATCHIT_DEFAULT_PDM_KEY:"bafkreiaenzlqmc34crc7sfsr3wanvbdwovsgfgggm2am7lafeejn6orghi",WATCHIT_DEFAULT_PDM_LABEL:"Public Domain",WATCHIT_PUBSUB_PEER_DISCOVERY:"watchit-pubsub-discovery",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const instantiate=(o,s)=>{const a=new Plyr$1(".plyr-react",s.options||{});return s.source&&(a.source=s.source),a},destroy=o=>{o&&o.destroy()},noop$1=()=>{},getAPI=o=>o?()=>({plyr:o}):()=>new Proxy({plyr:{source:null}},{get:(s,a)=>a==="plyr"?s[a]:noop$1});function usePlyr(o,s,a=null){return useAptor(o,{instantiate,getAPI,destroy,params:s},a||[s.options,s.source])}const Plyr=reactExports.forwardRef((o,s)=>{const{source:a,options:et=null,...tt}=o,rt=usePlyr(s,{source:a,options:et});return jsxRuntimeExports.jsx("video",{ref:rt,className:"plyr-react plyr",...tt})});(define_import_meta_env_default$2&&"production")!=="production"&&(Plyr.displayName="Plyr",Plyr.defaultProps={options:{controls:["rewind","play","fast-forward","progress","current-time","duration","mute","volume","settings","fullscreen"],i18n:{restart:"Restart",rewind:"Rewind {seektime}s",play:"Play",pause:"Pause",fastForward:"Forward {seektime}s",seek:"Seek",seekLabel:"{currentTime} of {duration}",played:"Played",buffered:"Buffered",currentTime:"Current time",duration:"Duration",volume:"Volume",mute:"Mute",unmute:"Unmute",enableCaptions:"Enable captions",disableCaptions:"Disable captions",download:"Download",enterFullscreen:"Enter fullscreen",exitFullscreen:"Exit fullscreen",frameTitle:"Player for {title}",captions:"Captions",settings:"Settings",menuBack:"Go back to previous menu",speed:"Speed",normal:"Normal",quality:"Quality",loop:"Loop"}},source:{type:"video",sources:[{src:"https://cdn.plyr.io/static/blank.mp4",type:"video/mp4",size:720},{src:"https://cdn.plyr.io/static/blank.mp4",type:"video/mp4",size:1080}]}},Plyr.propTypes={options:PropTypes.object,source:PropTypes.any});const VideoModal=({videoId:o,open:s,handleClose:a})=>{const[et,tt]=reactExports.useState(0),rt=reactExports.useMemo(()=>({position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"80%",bgcolor:"background.paper",boxShadow:24,borderRadius:"1rem",maxHeight:"90%",overflow:"hidden"}),[]),nt=reactExports.useMemo(()=>({type:"video",sources:[{src:o,provider:"youtube"}]}),[o]),it=reactExports.useCallback(()=>{a()},[a]),st=()=>{tt(ot=>ot+1)};return reactExports.useEffect(()=>{const ot=document.querySelector(".plyr__video-embed");return ot&&ot.addEventListener("error",st),()=>{ot&&ot.removeEventListener("error",st)}},[et]),jsxRuntimeExports.jsx(Modal,{open:s,onClose:it,"aria-labelledby":"modal-title","aria-describedby":"modal-description",children:jsxRuntimeExports.jsxs(Box,{sx:rt,children:[jsxRuntimeExports.jsx(IconButton,{"aria-label":"close",onClick:it,sx:{position:"absolute",right:8,top:8,color:ot=>ot.palette.grey[500]},children:jsxRuntimeExports.jsx(default_1,{})}),jsxRuntimeExports.jsx(Box,{sx:{position:"relative",paddingTop:"56.25%",height:"90%"},children:jsxRuntimeExports.jsx(Box,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:jsxRuntimeExports.jsx(Plyr,{source:nt,options:{autoplay:!0}},et)})})]})})},VideoModal$1=reactExports.memo(VideoModal);var lib$1={},Scrollbars={},raf$1={exports:{}},performanceNow={exports:{}};(function(){var o,s,a,et,tt,rt;typeof performance<"u"&&performance!==null&&performance.now?performanceNow.exports=function(){return performance.now()}:typeof process$1<"u"&&process$1!==null&&process$1.hrtime?(performanceNow.exports=function(){return(o()-tt)/1e6},s=process$1.hrtime,o=function(){var nt;return nt=s(),nt[0]*1e9+nt[1]},et=o(),rt=process$1.uptime()*1e9,tt=et-rt):Date.now?(performanceNow.exports=function(){return Date.now()-a},a=Date.now()):(performanceNow.exports=function(){return new Date().getTime()-a},a=new Date().getTime())}).call(commonjsGlobal);var performanceNowExports=performanceNow.exports,now$2=performanceNowExports,root=typeof window>"u"?commonjsGlobal:window,vendors=["moz","webkit"],suffix="AnimationFrame",raf=root["request"+suffix],caf=root["cancel"+suffix]||root["cancelRequest"+suffix];for(var i=0;!raf&&i<vendors.length;i++)raf=root[vendors[i]+"Request"+suffix],caf=root[vendors[i]+"Cancel"+suffix]||root[vendors[i]+"CancelRequest"+suffix];if(!raf||!caf){var last=0,id=0,queue=[],frameDuration=1e3/60;raf=function(o){if(queue.length===0){var s=now$2(),a=Math.max(0,frameDuration-(s-last));last=a+s,setTimeout(function(){var et=queue.slice(0);queue.length=0;for(var tt=0;tt<et.length;tt++)if(!et[tt].cancelled)try{et[tt].callback(last)}catch(rt){setTimeout(function(){throw rt},0)}},Math.round(a))}return queue.push({handle:++id,callback:o,cancelled:!1}),id},caf=function(o){for(var s=0;s<queue.length;s++)queue[s].handle===o&&(queue[s].cancelled=!0)}}raf$1.exports=function(o){return raf.call(root,o)};raf$1.exports.cancel=function(){caf.apply(root,arguments)};raf$1.exports.polyfill=function(o){o||(o=root),o.requestAnimationFrame=raf,o.cancelAnimationFrame=caf};var rafExports=raf$1.exports,domCss={exports:{}},div=null,prefixes=["Webkit","Moz","O","ms"],prefixStyle=function o(s){div||(div=document.createElement("div"));var a=div.style;if(s in a)return s;for(var et=s.charAt(0).toUpperCase()+s.slice(1),tt=prefixes.length;tt>=0;tt--){var rt=prefixes[tt]+et;if(rt in a)return rt}return!1},toNoCase_1=toNoCase,hasSpace=/\s/,hasSeparator=/(_|-|\.|:)/,hasCamel=/([a-z][A-Z]|[A-Z][a-z])/;function toNoCase(o){return hasSpace.test(o)?o.toLowerCase():hasSeparator.test(o)?(unseparate(o)||o).toLowerCase():hasCamel.test(o)?uncamelize(o).toLowerCase():o.toLowerCase()}var separatorSplitter=/[\W_]+(.|$)/g;function unseparate(o){return o.replace(separatorSplitter,function(s,a){return a?" "+a:""})}var camelSplitter=/(.)([A-Z]+)/g;function uncamelize(o){return o.replace(camelSplitter,function(s,a,et){return a+" "+et.toLowerCase().split("").join(" ")})}var clean=toNoCase_1,toSpaceCase_1=toSpaceCase;function toSpaceCase(o){return clean(o).replace(/[\W_]+(.|$)/g,function(s,a){return a?" "+a:""}).trim()}var space=toSpaceCase_1,toCamelCase_1=toCamelCase$1;function toCamelCase$1(o){return space(o).replace(/\s(\w)/g,function(s,a){return a.toUpperCase()})}var IS_UNITLESS={animationIterationCount:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridColumn:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,stopOpacity:!0,strokeDashoffset:!0,strokeOpacity:!0,strokeWidth:!0},addPxToStyle$1=function(o,s){return typeof s=="number"&&!IS_UNITLESS[o]?s+"px":s},prefix=prefixStyle,toCamelCase=toCamelCase_1,cache={float:"cssFloat"},addPxToStyle=addPxToStyle$1;function style(o,s,a){var et=cache[s];if(typeof et>"u"&&(et=detect(s)),et){if(a===void 0)return o.style[et];o.style[et]=addPxToStyle(et,a)}}function each(o,s){for(var a in s)s.hasOwnProperty(a)&&style(o,a,s[a])}function detect(o){var s=toCamelCase(o),a=prefix(s);return cache[s]=cache[o]=cache[a]=a,a}function set(){arguments.length===2?typeof arguments[1]=="string"?arguments[0].style.cssText=arguments[1]:each(arguments[0],arguments[1]):style(arguments[0],arguments[1],arguments[2])}domCss.exports=set;domCss.exports.set=set;domCss.exports.get=function(o,s){return Array.isArray(s)?s.reduce(function(a,et){return a[et]=style(o,et||""),a},{}):style(o,s||"")};var domCssExports=domCss.exports,isString={};(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.default=s;function s(a){return typeof a=="string"}})(isString);var getScrollbarWidth={};(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.default=rt;var s=domCssExports,a=et(s);function et(nt){return nt&&nt.__esModule?nt:{default:nt}}var tt=!1;function rt(){if(tt!==!1)return tt;if(typeof document<"u"){var nt=document.createElement("div");(0,a.default)(nt,{width:100,height:100,position:"absolute",top:-9999,overflow:"scroll",MsOverflowStyle:"scrollbar"}),document.body.appendChild(nt),tt=nt.offsetWidth-nt.clientWidth,document.body.removeChild(nt)}else tt=0;return tt||0}})(getScrollbarWidth);var returnFalse={};(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.default=s;function s(){return!1}})(returnFalse);var getInnerWidth={};(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.default=s;function s(a){var et=a.clientWidth,tt=getComputedStyle(a),rt=tt.paddingLeft,nt=tt.paddingRight;return et-parseFloat(rt)-parseFloat(nt)}})(getInnerWidth);var getInnerHeight={};(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.default=s;function s(a){var et=a.clientHeight,tt=getComputedStyle(a),rt=tt.paddingTop,nt=tt.paddingBottom;return et-parseFloat(rt)-parseFloat(nt)}})(getInnerHeight);var styles={};Object.defineProperty(styles,"__esModule",{value:!0});styles.containerStyleDefault={position:"relative",overflow:"hidden",width:"100%",height:"100%"};styles.containerStyleAutoHeight={height:"auto"};styles.viewStyleDefault={position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"scroll",WebkitOverflowScrolling:"touch"};styles.viewStyleAutoHeight={position:"relative",top:void 0,left:void 0,right:void 0,bottom:void 0};styles.viewStyleUniversalInitial={overflow:"hidden",marginRight:0,marginBottom:0};styles.trackHorizontalStyleDefault={position:"absolute",height:6};styles.trackVerticalStyleDefault={position:"absolute",width:6};styles.thumbHorizontalStyleDefault={position:"relative",display:"block",height:"100%"};styles.thumbVerticalStyleDefault={position:"relative",display:"block",width:"100%"};styles.disableSelectStyle={userSelect:"none"};styles.disableSelectStyleReset={userSelect:""};var defaultRenderElements={};Object.defineProperty(defaultRenderElements,"__esModule",{value:!0});var _extends$1=Object.assign||function(o){for(var s=1;s<arguments.length;s++){var a=arguments[s];for(var et in a)Object.prototype.hasOwnProperty.call(a,et)&&(o[et]=a[et])}return o};defaultRenderElements.renderViewDefault=renderViewDefault;defaultRenderElements.renderTrackHorizontalDefault=renderTrackHorizontalDefault;defaultRenderElements.renderTrackVerticalDefault=renderTrackVerticalDefault;defaultRenderElements.renderThumbHorizontalDefault=renderThumbHorizontalDefault;defaultRenderElements.renderThumbVerticalDefault=renderThumbVerticalDefault;var _react=reactExports,_react2=_interopRequireDefault(_react);function _interopRequireDefault(o){return o&&o.__esModule?o:{default:o}}function _objectWithoutProperties(o,s){var a={};for(var et in o)s.indexOf(et)>=0||Object.prototype.hasOwnProperty.call(o,et)&&(a[et]=o[et]);return a}function renderViewDefault(o){return _react2.default.createElement("div",o)}function renderTrackHorizontalDefault(o){var s=o.style,a=_objectWithoutProperties(o,["style"]),et=_extends$1({},s,{right:2,bottom:2,left:2,borderRadius:3});return _react2.default.createElement("div",_extends$1({style:et},a))}function renderTrackVerticalDefault(o){var s=o.style,a=_objectWithoutProperties(o,["style"]),et=_extends$1({},s,{right:2,bottom:2,top:2,borderRadius:3});return _react2.default.createElement("div",_extends$1({style:et},a))}function renderThumbHorizontalDefault(o){var s=o.style,a=_objectWithoutProperties(o,["style"]),et=_extends$1({},s,{cursor:"pointer",borderRadius:"inherit",backgroundColor:"rgba(0,0,0,.2)"});return _react2.default.createElement("div",_extends$1({style:et},a))}function renderThumbVerticalDefault(o){var s=o.style,a=_objectWithoutProperties(o,["style"]),et=_extends$1({},s,{cursor:"pointer",borderRadius:"inherit",backgroundColor:"rgba(0,0,0,.2)"});return _react2.default.createElement("div",_extends$1({style:et},a))}(function(o){Object.defineProperty(o,"__esModule",{value:!0});var s=Object.assign||function(Nt){for(var Kt=1;Kt<arguments.length;Kt++){var Yt=arguments[Kt];for(var Bt in Yt)Object.prototype.hasOwnProperty.call(Yt,Bt)&&(Nt[Bt]=Yt[Bt])}return Nt},a=function(){function Nt(Kt,Yt){for(var Bt=0;Bt<Yt.length;Bt++){var Pt=Yt[Bt];Pt.enumerable=Pt.enumerable||!1,Pt.configurable=!0,"value"in Pt&&(Pt.writable=!0),Object.defineProperty(Kt,Pt.key,Pt)}}return function(Kt,Yt,Bt){return Yt&&Nt(Kt.prototype,Yt),Bt&&Nt(Kt,Bt),Kt}}(),et=rafExports,tt=xt(et),rt=domCssExports,nt=xt(rt),it=reactExports,st=propTypesExports,ot=xt(st),at=isString,lt=xt(at),ct=getScrollbarWidth,ht=xt(ct),ft=returnFalse,dt=xt(ft),pt=getInnerWidth,gt=xt(pt),mt=getInnerHeight,yt=xt(mt),vt=styles,Et=defaultRenderElements;function xt(Nt){return Nt&&Nt.__esModule?Nt:{default:Nt}}function wt(Nt,Kt){var Yt={};for(var Bt in Nt)Kt.indexOf(Bt)>=0||Object.prototype.hasOwnProperty.call(Nt,Bt)&&(Yt[Bt]=Nt[Bt]);return Yt}function Rt(Nt,Kt){if(!(Nt instanceof Kt))throw new TypeError("Cannot call a class as a function")}function Ct(Nt,Kt){if(!Nt)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Kt&&(typeof Kt=="object"||typeof Kt=="function")?Kt:Nt}function Ft(Nt,Kt){if(typeof Kt!="function"&&Kt!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof Kt);Nt.prototype=Object.create(Kt&&Kt.prototype,{constructor:{value:Nt,enumerable:!1,writable:!0,configurable:!0}}),Kt&&(Object.setPrototypeOf?Object.setPrototypeOf(Nt,Kt):Nt.__proto__=Kt)}var zt=function(Nt){Ft(Kt,Nt);function Kt(Yt){var Bt;Rt(this,Kt);for(var Pt=arguments.length,Dt=Array(Pt>1?Pt-1:0),Tt=1;Tt<Pt;Tt++)Dt[Tt-1]=arguments[Tt];var St=Ct(this,(Bt=Kt.__proto__||Object.getPrototypeOf(Kt)).call.apply(Bt,[this,Yt].concat(Dt)));return St.getScrollLeft=St.getScrollLeft.bind(St),St.getScrollTop=St.getScrollTop.bind(St),St.getScrollWidth=St.getScrollWidth.bind(St),St.getScrollHeight=St.getScrollHeight.bind(St),St.getClientWidth=St.getClientWidth.bind(St),St.getClientHeight=St.getClientHeight.bind(St),St.getValues=St.getValues.bind(St),St.getThumbHorizontalWidth=St.getThumbHorizontalWidth.bind(St),St.getThumbVerticalHeight=St.getThumbVerticalHeight.bind(St),St.getScrollLeftForOffset=St.getScrollLeftForOffset.bind(St),St.getScrollTopForOffset=St.getScrollTopForOffset.bind(St),St.scrollLeft=St.scrollLeft.bind(St),St.scrollTop=St.scrollTop.bind(St),St.scrollToLeft=St.scrollToLeft.bind(St),St.scrollToTop=St.scrollToTop.bind(St),St.scrollToRight=St.scrollToRight.bind(St),St.scrollToBottom=St.scrollToBottom.bind(St),St.handleTrackMouseEnter=St.handleTrackMouseEnter.bind(St),St.handleTrackMouseLeave=St.handleTrackMouseLeave.bind(St),St.handleHorizontalTrackMouseDown=St.handleHorizontalTrackMouseDown.bind(St),St.handleVerticalTrackMouseDown=St.handleVerticalTrackMouseDown.bind(St),St.handleHorizontalThumbMouseDown=St.handleHorizontalThumbMouseDown.bind(St),St.handleVerticalThumbMouseDown=St.handleVerticalThumbMouseDown.bind(St),St.handleWindowResize=St.handleWindowResize.bind(St),St.handleScroll=St.handleScroll.bind(St),St.handleDrag=St.handleDrag.bind(St),St.handleDragEnd=St.handleDragEnd.bind(St),St.state={didMountUniversal:!1},St}return a(Kt,[{key:"componentDidMount",value:function(){this.addListeners(),this.update(),this.componentDidMountUniversal()}},{key:"componentDidMountUniversal",value:function(){var Bt=this.props.universal;Bt&&this.setState({didMountUniversal:!0})}},{key:"componentDidUpdate",value:function(){this.update()}},{key:"componentWillUnmount",value:function(){this.removeListeners(),(0,et.cancel)(this.requestFrame),clearTimeout(this.hideTracksTimeout),clearInterval(this.detectScrollingInterval)}},{key:"getScrollLeft",value:function(){return this.view?this.view.scrollLeft:0}},{key:"getScrollTop",value:function(){return this.view?this.view.scrollTop:0}},{key:"getScrollWidth",value:function(){return this.view?this.view.scrollWidth:0}},{key:"getScrollHeight",value:function(){return this.view?this.view.scrollHeight:0}},{key:"getClientWidth",value:function(){return this.view?this.view.clientWidth:0}},{key:"getClientHeight",value:function(){return this.view?this.view.clientHeight:0}},{key:"getValues",value:function(){var Bt=this.view||{},Pt=Bt.scrollLeft,Dt=Pt===void 0?0:Pt,Tt=Bt.scrollTop,St=Tt===void 0?0:Tt,Mt=Bt.scrollWidth,jt=Mt===void 0?0:Mt,Gt=Bt.scrollHeight,Ht=Gt===void 0?0:Gt,At=Bt.clientWidth,$t=At===void 0?0:At,kt=Bt.clientHeight,Lt=kt===void 0?0:kt;return{left:Dt/(jt-$t)||0,top:St/(Ht-Lt)||0,scrollLeft:Dt,scrollTop:St,scrollWidth:jt,scrollHeight:Ht,clientWidth:$t,clientHeight:Lt}}},{key:"getThumbHorizontalWidth",value:function(){var Bt=this.props,Pt=Bt.thumbSize,Dt=Bt.thumbMinSize,Tt=this.view,St=Tt.scrollWidth,Mt=Tt.clientWidth,jt=(0,gt.default)(this.trackHorizontal),Gt=Math.ceil(Mt/St*jt);return jt===Gt?0:Pt||Math.max(Gt,Dt)}},{key:"getThumbVerticalHeight",value:function(){var Bt=this.props,Pt=Bt.thumbSize,Dt=Bt.thumbMinSize,Tt=this.view,St=Tt.scrollHeight,Mt=Tt.clientHeight,jt=(0,yt.default)(this.trackVertical),Gt=Math.ceil(Mt/St*jt);return jt===Gt?0:Pt||Math.max(Gt,Dt)}},{key:"getScrollLeftForOffset",value:function(Bt){var Pt=this.view,Dt=Pt.scrollWidth,Tt=Pt.clientWidth,St=(0,gt.default)(this.trackHorizontal),Mt=this.getThumbHorizontalWidth();return Bt/(St-Mt)*(Dt-Tt)}},{key:"getScrollTopForOffset",value:function(Bt){var Pt=this.view,Dt=Pt.scrollHeight,Tt=Pt.clientHeight,St=(0,yt.default)(this.trackVertical),Mt=this.getThumbVerticalHeight();return Bt/(St-Mt)*(Dt-Tt)}},{key:"scrollLeft",value:function(){var Bt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;this.view&&(this.view.scrollLeft=Bt)}},{key:"scrollTop",value:function(){var Bt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;this.view&&(this.view.scrollTop=Bt)}},{key:"scrollToLeft",value:function(){this.view&&(this.view.scrollLeft=0)}},{key:"scrollToTop",value:function(){this.view&&(this.view.scrollTop=0)}},{key:"scrollToRight",value:function(){this.view&&(this.view.scrollLeft=this.view.scrollWidth)}},{key:"scrollToBottom",value:function(){this.view&&(this.view.scrollTop=this.view.scrollHeight)}},{key:"addListeners",value:function(){if(!(typeof document>"u"||!this.view)){var Bt=this.view,Pt=this.trackHorizontal,Dt=this.trackVertical,Tt=this.thumbHorizontal,St=this.thumbVertical;Bt.addEventListener("scroll",this.handleScroll),(0,ht.default)()&&(Pt.addEventListener("mouseenter",this.handleTrackMouseEnter),Pt.addEventListener("mouseleave",this.handleTrackMouseLeave),Pt.addEventListener("mousedown",this.handleHorizontalTrackMouseDown),Dt.addEventListener("mouseenter",this.handleTrackMouseEnter),Dt.addEventListener("mouseleave",this.handleTrackMouseLeave),Dt.addEventListener("mousedown",this.handleVerticalTrackMouseDown),Tt.addEventListener("mousedown",this.handleHorizontalThumbMouseDown),St.addEventListener("mousedown",this.handleVerticalThumbMouseDown),window.addEventListener("resize",this.handleWindowResize))}}},{key:"removeListeners",value:function(){if(!(typeof document>"u"||!this.view)){var Bt=this.view,Pt=this.trackHorizontal,Dt=this.trackVertical,Tt=this.thumbHorizontal,St=this.thumbVertical;Bt.removeEventListener("scroll",this.handleScroll),(0,ht.default)()&&(Pt.removeEventListener("mouseenter",this.handleTrackMouseEnter),Pt.removeEventListener("mouseleave",this.handleTrackMouseLeave),Pt.removeEventListener("mousedown",this.handleHorizontalTrackMouseDown),Dt.removeEventListener("mouseenter",this.handleTrackMouseEnter),Dt.removeEventListener("mouseleave",this.handleTrackMouseLeave),Dt.removeEventListener("mousedown",this.handleVerticalTrackMouseDown),Tt.removeEventListener("mousedown",this.handleHorizontalThumbMouseDown),St.removeEventListener("mousedown",this.handleVerticalThumbMouseDown),window.removeEventListener("resize",this.handleWindowResize),this.teardownDragging())}}},{key:"handleScroll",value:function(Bt){var Pt=this,Dt=this.props,Tt=Dt.onScroll,St=Dt.onScrollFrame;Tt&&Tt(Bt),this.update(function(Mt){var jt=Mt.scrollLeft,Gt=Mt.scrollTop;Pt.viewScrollLeft=jt,Pt.viewScrollTop=Gt,St&&St(Mt)}),this.detectScrolling()}},{key:"handleScrollStart",value:function(){var Bt=this.props.onScrollStart;Bt&&Bt(),this.handleScrollStartAutoHide()}},{key:"handleScrollStartAutoHide",value:function(){var Bt=this.props.autoHide;Bt&&this.showTracks()}},{key:"handleScrollStop",value:function(){var Bt=this.props.onScrollStop;Bt&&Bt(),this.handleScrollStopAutoHide()}},{key:"handleScrollStopAutoHide",value:function(){var Bt=this.props.autoHide;Bt&&this.hideTracks()}},{key:"handleWindowResize",value:function(){this.update()}},{key:"handleHorizontalTrackMouseDown",value:function(Bt){Bt.preventDefault();var Pt=Bt.target,Dt=Bt.clientX,Tt=Pt.getBoundingClientRect(),St=Tt.left,Mt=this.getThumbHorizontalWidth(),jt=Math.abs(St-Dt)-Mt/2;this.view.scrollLeft=this.getScrollLeftForOffset(jt)}},{key:"handleVerticalTrackMouseDown",value:function(Bt){Bt.preventDefault();var Pt=Bt.target,Dt=Bt.clientY,Tt=Pt.getBoundingClientRect(),St=Tt.top,Mt=this.getThumbVerticalHeight(),jt=Math.abs(St-Dt)-Mt/2;this.view.scrollTop=this.getScrollTopForOffset(jt)}},{key:"handleHorizontalThumbMouseDown",value:function(Bt){Bt.preventDefault(),this.handleDragStart(Bt);var Pt=Bt.target,Dt=Bt.clientX,Tt=Pt.offsetWidth,St=Pt.getBoundingClientRect(),Mt=St.left;this.prevPageX=Tt-(Dt-Mt)}},{key:"handleVerticalThumbMouseDown",value:function(Bt){Bt.preventDefault(),this.handleDragStart(Bt);var Pt=Bt.target,Dt=Bt.clientY,Tt=Pt.offsetHeight,St=Pt.getBoundingClientRect(),Mt=St.top;this.prevPageY=Tt-(Dt-Mt)}},{key:"setupDragging",value:function(){(0,nt.default)(document.body,vt.disableSelectStyle),document.addEventListener("mousemove",this.handleDrag),document.addEventListener("mouseup",this.handleDragEnd),document.onselectstart=dt.default}},{key:"teardownDragging",value:function(){(0,nt.default)(document.body,vt.disableSelectStyleReset),document.removeEventListener("mousemove",this.handleDrag),document.removeEventListener("mouseup",this.handleDragEnd),document.onselectstart=void 0}},{key:"handleDragStart",value:function(Bt){this.dragging=!0,Bt.stopImmediatePropagation(),this.setupDragging()}},{key:"handleDrag",value:function(Bt){if(this.prevPageX){var Pt=Bt.clientX,Dt=this.trackHorizontal.getBoundingClientRect(),Tt=Dt.left,St=this.getThumbHorizontalWidth(),Mt=St-this.prevPageX,jt=-Tt+Pt-Mt;this.view.scrollLeft=this.getScrollLeftForOffset(jt)}if(this.prevPageY){var Gt=Bt.clientY,Ht=this.trackVertical.getBoundingClientRect(),At=Ht.top,$t=this.getThumbVerticalHeight(),kt=$t-this.prevPageY,Lt=-At+Gt-kt;this.view.scrollTop=this.getScrollTopForOffset(Lt)}return!1}},{key:"handleDragEnd",value:function(){this.dragging=!1,this.prevPageX=this.prevPageY=0,this.teardownDragging(),this.handleDragEndAutoHide()}},{key:"handleDragEndAutoHide",value:function(){var Bt=this.props.autoHide;Bt&&this.hideTracks()}},{key:"handleTrackMouseEnter",value:function(){this.trackMouseOver=!0,this.handleTrackMouseEnterAutoHide()}},{key:"handleTrackMouseEnterAutoHide",value:function(){var Bt=this.props.autoHide;Bt&&this.showTracks()}},{key:"handleTrackMouseLeave",value:function(){this.trackMouseOver=!1,this.handleTrackMouseLeaveAutoHide()}},{key:"handleTrackMouseLeaveAutoHide",value:function(){var Bt=this.props.autoHide;Bt&&this.hideTracks()}},{key:"showTracks",value:function(){clearTimeout(this.hideTracksTimeout),(0,nt.default)(this.trackHorizontal,{opacity:1}),(0,nt.default)(this.trackVertical,{opacity:1})}},{key:"hideTracks",value:function(){var Bt=this;if(!this.dragging&&!this.scrolling&&!this.trackMouseOver){var Pt=this.props.autoHideTimeout;clearTimeout(this.hideTracksTimeout),this.hideTracksTimeout=setTimeout(function(){(0,nt.default)(Bt.trackHorizontal,{opacity:0}),(0,nt.default)(Bt.trackVertical,{opacity:0})},Pt)}}},{key:"detectScrolling",value:function(){var Bt=this;this.scrolling||(this.scrolling=!0,this.handleScrollStart(),this.detectScrollingInterval=setInterval(function(){Bt.lastViewScrollLeft===Bt.viewScrollLeft&&Bt.lastViewScrollTop===Bt.viewScrollTop&&(clearInterval(Bt.detectScrollingInterval),Bt.scrolling=!1,Bt.handleScrollStop()),Bt.lastViewScrollLeft=Bt.viewScrollLeft,Bt.lastViewScrollTop=Bt.viewScrollTop},100))}},{key:"raf",value:function(Bt){var Pt=this;this.requestFrame&&tt.default.cancel(this.requestFrame),this.requestFrame=(0,tt.default)(function(){Pt.requestFrame=void 0,Bt()})}},{key:"update",value:function(Bt){var Pt=this;this.raf(function(){return Pt._update(Bt)})}},{key:"_update",value:function(Bt){var Pt=this.props,Dt=Pt.onUpdate,Tt=Pt.hideTracksWhenNotNeeded,St=this.getValues();if((0,ht.default)()){var Mt=St.scrollLeft,jt=St.clientWidth,Gt=St.scrollWidth,Ht=(0,gt.default)(this.trackHorizontal),At=this.getThumbHorizontalWidth(),$t=Mt/(Gt-jt)*(Ht-At),kt={width:At,transform:"translateX("+$t+"px)"},Lt=St.scrollTop,bt=St.clientHeight,It=St.scrollHeight,Ut=(0,yt.default)(this.trackVertical),Wt=this.getThumbVerticalHeight(),Xt=Lt/(It-bt)*(Ut-Wt),Qt={height:Wt,transform:"translateY("+Xt+"px)"};if(Tt){var er={visibility:Gt>jt?"visible":"hidden"},lr={visibility:It>bt?"visible":"hidden"};(0,nt.default)(this.trackHorizontal,er),(0,nt.default)(this.trackVertical,lr)}(0,nt.default)(this.thumbHorizontal,kt),(0,nt.default)(this.thumbVertical,Qt)}Dt&&Dt(St),typeof Bt=="function"&&Bt(St)}},{key:"render",value:function(){var Bt=this,Pt=(0,ht.default)(),Dt=this.props;Dt.onScroll,Dt.onScrollFrame,Dt.onScrollStart,Dt.onScrollStop,Dt.onUpdate;var Tt=Dt.renderView,St=Dt.renderTrackHorizontal,Mt=Dt.renderTrackVertical,jt=Dt.renderThumbHorizontal,Gt=Dt.renderThumbVertical,Ht=Dt.tagName;Dt.hideTracksWhenNotNeeded;var At=Dt.autoHide;Dt.autoHideTimeout;var $t=Dt.autoHideDuration;Dt.thumbSize,Dt.thumbMinSize;var kt=Dt.universal,Lt=Dt.autoHeight,bt=Dt.autoHeightMin,It=Dt.autoHeightMax,Ut=Dt.style,Wt=Dt.children,Xt=wt(Dt,["onScroll","onScrollFrame","onScrollStart","onScrollStop","onUpdate","renderView","renderTrackHorizontal","renderTrackVertical","renderThumbHorizontal","renderThumbVertical","tagName","hideTracksWhenNotNeeded","autoHide","autoHideTimeout","autoHideDuration","thumbSize","thumbMinSize","universal","autoHeight","autoHeightMin","autoHeightMax","style","children"]),Qt=this.state.didMountUniversal,er=s({},vt.containerStyleDefault,Lt&&s({},vt.containerStyleAutoHeight,{minHeight:bt,maxHeight:It}),Ut),lr=s({},vt.viewStyleDefault,{marginRight:Pt?-Pt:0,marginBottom:Pt?-Pt:0},Lt&&s({},vt.viewStyleAutoHeight,{minHeight:(0,lt.default)(bt)?"calc("+bt+" + "+Pt+"px)":bt+Pt,maxHeight:(0,lt.default)(It)?"calc("+It+" + "+Pt+"px)":It+Pt}),Lt&&kt&&!Qt&&{minHeight:bt,maxHeight:It},kt&&!Qt&&vt.viewStyleUniversalInitial),pr={transition:"opacity "+$t+"ms",opacity:0},gr=s({},vt.trackHorizontalStyleDefault,At&&pr,(!Pt||kt&&!Qt)&&{display:"none"}),wr=s({},vt.trackVerticalStyleDefault,At&&pr,(!Pt||kt&&!Qt)&&{display:"none"});return(0,it.createElement)(Ht,s({},Xt,{style:er,ref:function(Cr){Bt.container=Cr}}),[(0,it.cloneElement)(Tt({style:lr}),{key:"view",ref:function(Cr){Bt.view=Cr}},Wt),(0,it.cloneElement)(St({style:gr}),{key:"trackHorizontal",ref:function(Cr){Bt.trackHorizontal=Cr}},(0,it.cloneElement)(jt({style:vt.thumbHorizontalStyleDefault}),{ref:function(Cr){Bt.thumbHorizontal=Cr}})),(0,it.cloneElement)(Mt({style:wr}),{key:"trackVertical",ref:function(Cr){Bt.trackVertical=Cr}},(0,it.cloneElement)(Gt({style:vt.thumbVerticalStyleDefault}),{ref:function(Cr){Bt.thumbVertical=Cr}}))])}}]),Kt}(it.Component);o.default=zt,zt.propTypes={onScroll:ot.default.func,onScrollFrame:ot.default.func,onScrollStart:ot.default.func,onScrollStop:ot.default.func,onUpdate:ot.default.func,renderView:ot.default.func,renderTrackHorizontal:ot.default.func,renderTrackVertical:ot.default.func,renderThumbHorizontal:ot.default.func,renderThumbVertical:ot.default.func,tagName:ot.default.string,thumbSize:ot.default.number,thumbMinSize:ot.default.number,hideTracksWhenNotNeeded:ot.default.bool,autoHide:ot.default.bool,autoHideTimeout:ot.default.number,autoHideDuration:ot.default.number,autoHeight:ot.default.bool,autoHeightMin:ot.default.oneOfType([ot.default.number,ot.default.string]),autoHeightMax:ot.default.oneOfType([ot.default.number,ot.default.string]),universal:ot.default.bool,style:ot.default.object,children:ot.default.node},zt.defaultProps={renderView:Et.renderViewDefault,renderTrackHorizontal:Et.renderTrackHorizontalDefault,renderTrackVertical:Et.renderTrackVerticalDefault,renderThumbHorizontal:Et.renderThumbHorizontalDefault,renderThumbVertical:Et.renderThumbVerticalDefault,tagName:"div",thumbMinSize:30,hideTracksWhenNotNeeded:!1,autoHide:!1,autoHideTimeout:1e3,autoHideDuration:200,autoHeight:!1,autoHeightMin:0,autoHeightMax:200,universal:!1}})(Scrollbars);(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.Scrollbars=void 0;var s=Scrollbars,a=et(s);function et(tt){return tt&&tt.__esModule?tt:{default:tt}}o.default=a.default,o.Scrollbars=a.default})(lib$1);class CustomScrollbars extends React.PureComponent{constructor(s){super(s);const{getRef:a}=s;this.getRef=a}renderThumbVertical({style:s,...a}){const et={backgroundColor:"rgba(167, 201, 235, 0.6)",width:"5px",borderRadius:"5px"};return jsxRuntimeExports.jsx("div",{style:{...s,...et},...a})}renderThumbHorizontal({style:s,...a}){const et={marginRight:"-1px",backgroundColor:"rgba(167, 201, 235, 0.6)",width:"5px",borderRadius:"5px"};return a.viewHorizontal||(et.display="none"),jsxRuntimeExports.jsx("div",{style:{...s,...et},...a})}render(){const s=Object.assign({},this.props);return delete s.getRef,jsxRuntimeExports.jsx(lib$1.Scrollbars,{ref:a=>{this.scroll=a,this.getRef&&this.getRef(a)},renderView:this.renderView,renderThumbVertical:this.renderThumbVertical,renderThumbHorizontal:this.renderThumbHorizontal,autoHide:!0,hideTracksWhenNotNeeded:!0,autoHideTimeout:1e3,autoHideDuration:200,...s,children:this.props.children})}}const Add=createSvgIcon$1(jsxRuntimeExports.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add"),Close=createSvgIcon$1(jsxRuntimeExports.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),CustomButton=o=>jsxRuntimeExports.jsx(CustomButtonWrapper,{className:`${o.variant}`,onClick:o.onClick,sx:{backgroundColor:o.backgroundColor,border:o.border,borderRadius:o.borderRadius,padding:o.padding,height:o.height,width:o.width,minWidth:o.width,margin:o.margin},children:jsxRuntimeExports.jsxs(Box,{display:"flex",alignItems:"center",justifyContent:"center",children:[o.icon?jsxRuntimeExports.jsx(Box,{display:"flex",alignItems:"center",justifyContent:"center",sx:{mr:o.children?"0.5rem":"0"},"data-testid":"icon",children:o.icon}):jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{}),o.children?o.children:jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{})]})}),CustomButtonWrapper=styled(Button)(()=>({background:"transparent",color:"#D1D2D3 !important",fontWeight:"500 !important",textTransform:"capitalize","&.primary":{background:"rgba(26,28,32,0.2) !important",border:"1px solid #D1D2D3 !important",boxShadow:"0px 2px 4px -1px rgba(0,0,0,0.2), 0px 4px 5px 0px rgba(0,0,0,0.14), 0px 1px 10px 0px rgba(0,0,0,0.12) !important","&:hover":{backgroundColor:"#1c1d21 !important"}},"&.secondary":{background:"transparent !important",border:"1px solid #D1D2D3 !important","&:hover":{backgroundColor:"#1c1d21 !important"}},"&.filled":{background:"#44bd32 !important",border:"none !important",color:"#fff !important","&:hover":{backgroundColor:"#44bd32 !important"}},"&.flat":{background:"transparent",border:"none !important","&:hover":{backgroundColor:"#1c1d21 !important"}}}));class ButtonClose extends React.Component{shouldComponentUpdate(){return!1}render(){return jsxRuntimeExports.jsx(CustomButton,{variant:"flat btn-close",height:"30px",width:"30px",margin:"0 0.5rem 0 0",backgroundColor:"rgba(28,29,33,0.4) !important",icon:jsxRuntimeExports.jsx(Close,{style:{color:"#D1D2D3"}}),onClick:this.props.onClose})}}const Context=React.createContext(!0),ContextProvider=Context.Provider;Context.Consumer;console.log(import.meta);const settings={streaming:["hls"],gateways:()=>["https://ipfs.io","https://storry.tv","https://nftstorage.link","https://4everland.io","https://dweb.link","https://gw.watchit.movie"],featuredCollections:[{cid:"bafkreiaenzlqmc34crc7sfsr3wanvbdwovsgfgggm2am7lafeejn6orghi",label:"Public Domain"}],subs:{hash:{spanish:"es",english:"en"},get revHash(){const o=Object.values(this.hash),s=Object.keys(this.hash);return o.reduce((a,et,tt)=>(a[et]=s[tt],a),{})},get available(){return Object.keys(this.hash)}},styles:{devices:{mobileS:"only screen and (min-width: 320px)",mobileM:"only screen and (min-width: 375px)",mobileL:"only screen and (min-width: 425px)",tablet:"only screen and (min-width: 768px)",laptop:"only screen and (min-width: 992px)",laptopAndLow:"only screen and (max-width: 992px)",laptopL:"only screen and (min-width: 1440px)",desktop:"only screen and (min-width: 1900px)",desktopL:"only screen and (min-width: 2560px)"},colors:{primary:"#03a9f3",danger:"#E57373",dangerDark:"#F44336",success:"#81C784",successDark:"#4CAF50",warning:"#ca6005",warningDark:"#ff9800",default:"rgba(0,0,0,0.5)"}}},gateway={parse(o){const s=settings.gateways(),a=Math.floor(Math.random()*s.length);return`${s[a]}/ipfs/${o}`}};var define_import_meta_env_default$1={WATCHIT_DEFAULT_PDM_KEY:"bafkreiaenzlqmc34crc7sfsr3wanvbdwovsgfgggm2am7lafeejn6orghi",WATCHIT_DEFAULT_PDM_LABEL:"Public Domain",WATCHIT_PUBSUB_PEER_DISCOVERY:"watchit-pubsub-discovery",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const runtime$1=define_import_meta_env_default$1.WATCHIT_RUNTIME,MovieDetails=o=>{const s=reactExports.useContext(Context),[a,et]=reactExports.useState(!1),[tt,rt]=reactExports.useState(!1),[nt,it]=reactExports.useState({});reactExports.useEffect(()=>{(async()=>{const lt=await s.db.connect(o.cid).get(o.id);it(lt),rt(!0)})()},[o.id]);const st=()=>et(!0),ot=()=>et(!1);return!tt&&jsxRuntimeExports.jsx(MainLoader,{})||jsxRuntimeExports.jsxs(MovieDetailsContainer,{sx:{borderTopLeftRadius:runtime$1==="browser"?"0":"1rem"},children:[jsxRuntimeExports.jsxs(MovieDetailsWrapper,{className:"background movie-details",children:[jsxRuntimeExports.jsx(ButtonClose,{onClose:o.onClose}),jsxRuntimeExports.jsxs(Grid,{sx:{zIndex:"99",height:"100%",background:"#000"},children:[jsxRuntimeExports.jsx(Grid,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"calc(100% + 16px)",background:"linear-gradient(to right, rgba(0, 0, 0, 0.8) 0, rgba(0, 0, 0, 0) 100%, rgba(0, 0, 0, 0.3) 90%, rgba(0, 0, 0, 0) 100%)"},container:!0,spacing:2,children:jsxRuntimeExports.jsxs(Grid,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},className:"movie__wrapper",container:!0,spacing:2,children:[jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:7,sx:{display:"flex",alignItems:"center",justifyContent:"flex-end",pb:2,position:"relative",zIndex:2,height:"100%"},children:jsxRuntimeExports.jsxs(Grid,{container:!0,spacing:1,sx:{padding:"1rem 2rem",position:"relative",width:"100%"},children:[jsxRuntimeExports.jsx(Grid,{sx:{display:"flex",alignItems:"center",padding:"0 1rem",marginBottom:"0.5rem"},item:!0,xs:12,children:jsxRuntimeExports.jsx("p",{className:"movie__year slide-in-left",children:nt?.meta?.genres?.join("  |  ").toUpperCase()})}),jsxRuntimeExports.jsx(Grid,{sx:{display:"flex",alignItems:"center",padding:"0 1rem"},item:!0,xs:12,children:jsxRuntimeExports.jsx("h3",{className:"movie__name slide-in-top",children:jsxRuntimeExports.jsx("span",{children:nt.meta.title})})}),jsxRuntimeExports.jsxs(Grid,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0 1rem",marginTop:"0.5rem",gap:"1rem"},item:!0,xs:12,className:"slide-in-right",children:[jsxRuntimeExports.jsx("p",{className:"movie__year",children:nt?.meta?.year}),jsxRuntimeExports.jsx("p",{className:"movie__year",children:"|"}),jsxRuntimeExports.jsxs("p",{className:"movie__year",children:[nt?.meta?.runtime," min"]}),jsxRuntimeExports.jsx("p",{className:"movie__year",children:"|"}),jsxRuntimeExports.jsx("p",{className:"movie__year",children:nt?.meta?.language?.toUpperCase()}),jsxRuntimeExports.jsx("p",{className:"movie__year",children:"|"}),jsxRuntimeExports.jsxs("p",{className:"movie__year",children:[nt?.meta?.rating," / 10"]})]}),jsxRuntimeExports.jsx(Grid,{className:"slide-in-left",sx:{display:"flex",alignItems:"start",justifyContent:"center",padding:"0 1rem",maxHeight:"auto",overflow:"auto",marginTop:"0.5rem"},item:!0,xs:12,children:jsxRuntimeExports.jsx(CustomScrollbars,{autoHide:!0,autoHeight:!0,autoHeightMax:400,autoHideTimeout:1e3,autoHideDuration:200,thumbMinSize:20,universal:!0,children:jsxRuntimeExports.jsx("p",{className:"movie__text slide-in-left",children:nt?.meta?.synopsis})})}),jsxRuntimeExports.jsxs(Box,{className:"slide-in-bottom",sx:{display:"flex",marginTop:"1rem",alignItems:"center",justifyContent:"space-between",gap:"1rem",width:{xs:"100%",sm:"75%",md:"50%"}},children:[nt?.meta?.trailerUrl?jsxRuntimeExports.jsx(ButtonTrailer,{onClick:st,children:"Trailer"}):jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{}),jsxRuntimeExports.jsx(GradientBorderButton,{onClick:()=>{o.onPlay(nt?._id)},children:"Watch IT"})]})]})}),jsxRuntimeExports.jsx(Grid,{sx:{display:"flex",position:"relative",zIndex:2,alignItems:"center",justifyContent:"flex-start",padding:"0",height:"100%"},item:!0,xs:12,md:5,children:jsxRuntimeExports.jsx("figure",{className:"detail__image slide-in-right",children:jsxRuntimeExports.jsx(Image$1,{src:gateway.parse(nt.images.large),preload:!0})})})]})}),jsxRuntimeExports.jsx(Box,{sx:{top:"-130%",zIndex:"1",left:"-50%",position:"absolute",height:"170%",pointerEvents:"none",width:"150%",background:"radial-gradient(circle, rgba(0, 0, 0, 0.6) 22%, rgba(0, 0, 0, 0) 100%)"}}),jsxRuntimeExports.jsx(Box,{sx:{top:"0",zIndex:"1",left:"-75%",position:"absolute",height:"100%",pointerEvents:"none",width:"175%",background:"radial-gradient(circle, rgba(0, 0, 0, 0.7) 22%, rgba(0, 0, 0, 0) 100%)"}}),jsxRuntimeExports.jsx(Box,{sx:{top:"40%",zIndex:"1",left:"-50%",position:"absolute",height:"170%",pointerEvents:"none",width:"150%",background:"radial-gradient(circle, rgba(0, 0, 0, 0.6) 22%, rgba(0, 0, 0, 0) 100%)"}}),jsxRuntimeExports.jsx("figure",{className:"background__detail__image",children:jsxRuntimeExports.jsx(Image$1,{src:gateway.parse(nt.images.medium)})})]})]}),jsxRuntimeExports.jsx(VideoModal$1,{videoId:nt?.meta?.trailerUrl,open:a,handleClose:ot})]})},Details=reactExports.memo(MovieDetails),GradientBorderButton=styled(Button)(({theme:o})=>({position:"relative",overflow:"hidden",padding:"0.5rem 1.5rem",color:o.palette.common.white,backgroundColor:"transparent",fontWeight:700,width:"100%",marginTop:"1rem",borderRadius:"2rem","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"inherit",padding:"2px",background:"linear-gradient(45deg, rgb(248,244,135), rgb(53,176,182))",WebkitMask:"linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)",mask:"linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)",WebkitMaskComposite:"destination-out",maskComposite:"exclude"},"&:hover":{backgroundColor:o.palette.action.hover}})),ButtonTrailer=styled(Button)(({theme:o})=>({position:"relative",overflow:"hidden",padding:"0.5rem 1.5rem",color:o.palette.common.white,backgroundColor:"transparent !important",fontWeight:700,width:"100%",marginTop:"1rem",borderRadius:"2rem",border:"2px solid #ff0200"})),MovieDetailsContainer=styled(Box)(()=>({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",height:"100%",width:"100%",zIndex:"97",position:"absolute",top:"0",left:"0",backgroundColor:"#22232a",overflow:"hidden"})),MovieDetailsWrapper=styled(Box)(()=>({display:"flex",flexDirection:"column",height:"100%",width:"100%",zIndex:"10",position:"relative",overflow:"hidden",backgroundColor:"transparent","&::-webkit-scrollbar":{width:"0",background:"transparent "},"&::-webkit-scrollbar-thumb":{background:"transparent"}}));function stylis_min(o){function s(Gt,Ht,At,$t,kt){for(var Lt=0,bt=0,It=0,Ut=0,Wt,Xt,Qt=0,er=0,lr,pr=lr=Wt=0,gr=0,wr=0,cr=0,Cr=0,_r=At.length,kr=_r-1,Ir,tr="",sr="",vr="",xr="",Er;gr<_r;){if(Xt=At.charCodeAt(gr),gr===kr&&bt+Ut+It+Lt!==0&&(bt!==0&&(Xt=bt===47?10:47),Ut=It=Lt=0,_r++,kr++),bt+Ut+It+Lt===0){if(gr===kr&&(0<wr&&(tr=tr.replace(ct,"")),0<tr.trim().length)){switch(Xt){case 32:case 9:case 59:case 13:case 10:break;default:tr+=At.charAt(gr)}Xt=59}switch(Xt){case 123:for(tr=tr.trim(),Wt=tr.charCodeAt(0),lr=1,Cr=++gr;gr<_r;){switch(Xt=At.charCodeAt(gr)){case 123:lr++;break;case 125:lr--;break;case 47:switch(Xt=At.charCodeAt(gr+1)){case 42:case 47:e:{for(pr=gr+1;pr<kr;++pr)switch(At.charCodeAt(pr)){case 47:if(Xt===42&&At.charCodeAt(pr-1)===42&&gr+2!==pr){gr=pr+1;break e}break;case 10:if(Xt===47){gr=pr+1;break e}}gr=pr}}break;case 91:Xt++;case 40:Xt++;case 34:case 39:for(;gr++<kr&&At.charCodeAt(gr)!==Xt;);}if(lr===0)break;gr++}switch(lr=At.substring(Cr,gr),Wt===0&&(Wt=(tr=tr.replace(lt,"").trim()).charCodeAt(0)),Wt){case 64:switch(0<wr&&(tr=tr.replace(ct,"")),Xt=tr.charCodeAt(1),Xt){case 100:case 109:case 115:case 45:wr=Ht;break;default:wr=Pt}if(lr=s(Ht,wr,lr,Xt,kt+1),Cr=lr.length,0<Tt&&(wr=a(Pt,tr,cr),Er=it(3,lr,wr,Ht,Kt,Nt,Cr,Xt,kt,$t),tr=wr.join(""),Er!==void 0&&(Cr=(lr=Er.trim()).length)===0&&(Xt=0,lr="")),0<Cr)switch(Xt){case 115:tr=tr.replace(xt,nt);case 100:case 109:case 45:lr=tr+"{"+lr+"}";break;case 107:tr=tr.replace(mt,"$1 $2"),lr=tr+"{"+lr+"}",lr=Bt===1||Bt===2&&rt("@"+lr,3)?"@-webkit-"+lr+"@"+lr:"@"+lr;break;default:lr=tr+lr,$t===112&&(lr=(sr+=lr,""))}else lr="";break;default:lr=s(Ht,a(Ht,tr,cr),lr,$t,kt+1)}vr+=lr,lr=cr=wr=pr=Wt=0,tr="",Xt=At.charCodeAt(++gr);break;case 125:case 59:if(tr=(0<wr?tr.replace(ct,""):tr).trim(),1<(Cr=tr.length))switch(pr===0&&(Wt=tr.charCodeAt(0),Wt===45||96<Wt&&123>Wt)&&(Cr=(tr=tr.replace(" ",":")).length),0<Tt&&(Er=it(1,tr,Ht,Gt,Kt,Nt,sr.length,$t,kt,$t))!==void 0&&(Cr=(tr=Er.trim()).length)===0&&(tr="\0\0"),Wt=tr.charCodeAt(0),Xt=tr.charCodeAt(1),Wt){case 0:break;case 64:if(Xt===105||Xt===99){xr+=tr+At.charAt(gr);break}default:tr.charCodeAt(Cr-1)!==58&&(sr+=tt(tr,Wt,Xt,tr.charCodeAt(2)))}cr=wr=pr=Wt=0,tr="",Xt=At.charCodeAt(++gr)}}switch(Xt){case 13:case 10:bt===47?bt=0:1+Wt===0&&$t!==107&&0<tr.length&&(wr=1,tr+="\0"),0<Tt*Mt&&it(0,tr,Ht,Gt,Kt,Nt,sr.length,$t,kt,$t),Nt=1,Kt++;break;case 59:case 125:if(bt+Ut+It+Lt===0){Nt++;break}default:switch(Nt++,Ir=At.charAt(gr),Xt){case 9:case 32:if(Ut+Lt+bt===0)switch(Qt){case 44:case 58:case 9:case 32:Ir="";break;default:Xt!==32&&(Ir=" ")}break;case 0:Ir="\\0";break;case 12:Ir="\\f";break;case 11:Ir="\\v";break;case 38:Ut+bt+Lt===0&&(wr=cr=1,Ir="\f"+Ir);break;case 108:if(Ut+bt+Lt+Yt===0&&0<pr)switch(gr-pr){case 2:Qt===112&&At.charCodeAt(gr-3)===58&&(Yt=Qt);case 8:er===111&&(Yt=er)}break;case 58:Ut+bt+Lt===0&&(pr=gr);break;case 44:bt+It+Ut+Lt===0&&(wr=1,Ir+="\r");break;case 34:case 39:bt===0&&(Ut=Ut===Xt?0:Ut===0?Xt:Ut);break;case 91:Ut+bt+It===0&&Lt++;break;case 93:Ut+bt+It===0&&Lt--;break;case 41:Ut+bt+Lt===0&&It--;break;case 40:if(Ut+bt+Lt===0){if(Wt===0)switch(2*Qt+3*er){case 533:break;default:Wt=1}It++}break;case 64:bt+It+Ut+Lt+pr+lr===0&&(lr=1);break;case 42:case 47:if(!(0<Ut+Lt+It))switch(bt){case 0:switch(2*Xt+3*At.charCodeAt(gr+1)){case 235:bt=47;break;case 220:Cr=gr,bt=42}break;case 42:Xt===47&&Qt===42&&Cr+2!==gr&&(At.charCodeAt(Cr+2)===33&&(sr+=At.substring(Cr,gr+1)),Ir="",bt=0)}}bt===0&&(tr+=Ir)}er=Qt,Qt=Xt,gr++}if(Cr=sr.length,0<Cr){if(wr=Ht,0<Tt&&(Er=it(2,sr,wr,Gt,Kt,Nt,Cr,$t,kt,$t),Er!==void 0&&(sr=Er).length===0))return xr+sr+vr;if(sr=wr.join(",")+"{"+sr+"}",Bt*Yt!==0){switch(Bt!==2||rt(sr,2)||(Yt=0),Yt){case 111:sr=sr.replace(vt,":-moz-$1")+sr;break;case 112:sr=sr.replace(yt,"::-webkit-input-$1")+sr.replace(yt,"::-moz-$1")+sr.replace(yt,":-ms-input-$1")+sr}Yt=0}}return xr+sr+vr}function a(Gt,Ht,At){var $t=Ht.trim().split(pt);Ht=$t;var kt=$t.length,Lt=Gt.length;switch(Lt){case 0:case 1:var bt=0;for(Gt=Lt===0?"":Gt[0]+" ";bt<kt;++bt)Ht[bt]=et(Gt,Ht[bt],At).trim();break;default:var It=bt=0;for(Ht=[];bt<kt;++bt)for(var Ut=0;Ut<Lt;++Ut)Ht[It++]=et(Gt[Ut]+" ",$t[bt],At).trim()}return Ht}function et(Gt,Ht,At){var $t=Ht.charCodeAt(0);switch(33>$t&&($t=(Ht=Ht.trim()).charCodeAt(0)),$t){case 38:return Ht.replace(gt,"$1"+Gt.trim());case 58:return Gt.trim()+Ht.replace(gt,"$1"+Gt.trim());default:if(0<1*At&&0<Ht.indexOf("\f"))return Ht.replace(gt,(Gt.charCodeAt(0)===58?"":"$1")+Gt.trim())}return Gt+Ht}function tt(Gt,Ht,At,$t){var kt=Gt+";",Lt=2*Ht+3*At+4*$t;if(Lt===944){Gt=kt.indexOf(":",9)+1;var bt=kt.substring(Gt,kt.length-1).trim();return bt=kt.substring(0,Gt).trim()+bt+";",Bt===1||Bt===2&&rt(bt,1)?"-webkit-"+bt+bt:bt}if(Bt===0||Bt===2&&!rt(kt,1))return kt;switch(Lt){case 1015:return kt.charCodeAt(10)===97?"-webkit-"+kt+kt:kt;case 951:return kt.charCodeAt(3)===116?"-webkit-"+kt+kt:kt;case 963:return kt.charCodeAt(5)===110?"-webkit-"+kt+kt:kt;case 1009:if(kt.charCodeAt(4)!==100)break;case 969:case 942:return"-webkit-"+kt+kt;case 978:return"-webkit-"+kt+"-moz-"+kt+kt;case 1019:case 983:return"-webkit-"+kt+"-moz-"+kt+"-ms-"+kt+kt;case 883:if(kt.charCodeAt(8)===45)return"-webkit-"+kt+kt;if(0<kt.indexOf("image-set(",11))return kt.replace(zt,"$1-webkit-$2")+kt;break;case 932:if(kt.charCodeAt(4)===45)switch(kt.charCodeAt(5)){case 103:return"-webkit-box-"+kt.replace("-grow","")+"-webkit-"+kt+"-ms-"+kt.replace("grow","positive")+kt;case 115:return"-webkit-"+kt+"-ms-"+kt.replace("shrink","negative")+kt;case 98:return"-webkit-"+kt+"-ms-"+kt.replace("basis","preferred-size")+kt}return"-webkit-"+kt+"-ms-"+kt+kt;case 964:return"-webkit-"+kt+"-ms-flex-"+kt+kt;case 1023:if(kt.charCodeAt(8)!==99)break;return bt=kt.substring(kt.indexOf(":",15)).replace("flex-","").replace("space-between","justify"),"-webkit-box-pack"+bt+"-webkit-"+kt+"-ms-flex-pack"+bt+kt;case 1005:return ft.test(kt)?kt.replace(ht,":-webkit-")+kt.replace(ht,":-moz-")+kt:kt;case 1e3:switch(bt=kt.substring(13).trim(),Ht=bt.indexOf("-")+1,bt.charCodeAt(0)+bt.charCodeAt(Ht)){case 226:bt=kt.replace(Et,"tb");break;case 232:bt=kt.replace(Et,"tb-rl");break;case 220:bt=kt.replace(Et,"lr");break;default:return kt}return"-webkit-"+kt+"-ms-"+bt+kt;case 1017:if(kt.indexOf("sticky",9)===-1)break;case 975:switch(Ht=(kt=Gt).length-10,bt=(kt.charCodeAt(Ht)===33?kt.substring(0,Ht):kt).substring(Gt.indexOf(":",7)+1).trim(),Lt=bt.charCodeAt(0)+(bt.charCodeAt(7)|0)){case 203:if(111>bt.charCodeAt(8))break;case 115:kt=kt.replace(bt,"-webkit-"+bt)+";"+kt;break;case 207:case 102:kt=kt.replace(bt,"-webkit-"+(102<Lt?"inline-":"")+"box")+";"+kt.replace(bt,"-webkit-"+bt)+";"+kt.replace(bt,"-ms-"+bt+"box")+";"+kt}return kt+";";case 938:if(kt.charCodeAt(5)===45)switch(kt.charCodeAt(6)){case 105:return bt=kt.replace("-items",""),"-webkit-"+kt+"-webkit-box-"+bt+"-ms-flex-"+bt+kt;case 115:return"-webkit-"+kt+"-ms-flex-item-"+kt.replace(Rt,"")+kt;default:return"-webkit-"+kt+"-ms-flex-line-pack"+kt.replace("align-content","").replace(Rt,"")+kt}break;case 973:case 989:if(kt.charCodeAt(3)!==45||kt.charCodeAt(4)===122)break;case 931:case 953:if(Ft.test(Gt)===!0)return(bt=Gt.substring(Gt.indexOf(":")+1)).charCodeAt(0)===115?tt(Gt.replace("stretch","fill-available"),Ht,At,$t).replace(":fill-available",":stretch"):kt.replace(bt,"-webkit-"+bt)+kt.replace(bt,"-moz-"+bt.replace("fill-",""))+kt;break;case 962:if(kt="-webkit-"+kt+(kt.charCodeAt(5)===102?"-ms-"+kt:"")+kt,At+$t===211&&kt.charCodeAt(13)===105&&0<kt.indexOf("transform",10))return kt.substring(0,kt.indexOf(";",27)+1).replace(dt,"$1-webkit-$2")+kt}return kt}function rt(Gt,Ht){var At=Gt.indexOf(Ht===1?":":"{"),$t=Gt.substring(0,Ht!==3?At:10);return At=Gt.substring(At+1,Gt.length-1),St(Ht!==2?$t:$t.replace(Ct,"$1"),At,Ht)}function nt(Gt,Ht){var At=tt(Ht,Ht.charCodeAt(0),Ht.charCodeAt(1),Ht.charCodeAt(2));return At!==Ht+";"?At.replace(wt," or ($1)").substring(4):"("+Ht+")"}function it(Gt,Ht,At,$t,kt,Lt,bt,It,Ut,Wt){for(var Xt=0,Qt=Ht,er;Xt<Tt;++Xt)switch(er=Dt[Xt].call(at,Gt,Qt,At,$t,kt,Lt,bt,It,Ut,Wt)){case void 0:case!1:case!0:case null:break;default:Qt=er}if(Qt!==Ht)return Qt}function st(Gt){switch(Gt){case void 0:case null:Tt=Dt.length=0;break;default:if(typeof Gt=="function")Dt[Tt++]=Gt;else if(typeof Gt=="object")for(var Ht=0,At=Gt.length;Ht<At;++Ht)st(Gt[Ht]);else Mt=!!Gt|0}return st}function ot(Gt){return Gt=Gt.prefix,Gt!==void 0&&(St=null,Gt?typeof Gt!="function"?Bt=1:(Bt=2,St=Gt):Bt=0),ot}function at(Gt,Ht){var At=Gt;if(33>At.charCodeAt(0)&&(At=At.trim()),jt=At,At=[jt],0<Tt){var $t=it(-1,Ht,At,At,Kt,Nt,0,0,0,0);$t!==void 0&&typeof $t=="string"&&(Ht=$t)}var kt=s(Pt,At,Ht,0,0);return 0<Tt&&($t=it(-2,kt,At,At,Kt,Nt,kt.length,0,0,0),$t!==void 0&&(kt=$t)),jt="",Yt=0,Nt=Kt=1,kt}var lt=/^\0+/g,ct=/[\0\r\f]/g,ht=/: */g,ft=/zoo|gra/,dt=/([,: ])(transform)/g,pt=/,\r+?/g,gt=/([\t\r\n ])*\f?&/g,mt=/@(k\w+)\s*(\S*)\s*/,yt=/::(place)/g,vt=/:(read-only)/g,Et=/[svh]\w+-[tblr]{2}/,xt=/\(\s*(.*)\s*\)/g,wt=/([\s\S]*?);/g,Rt=/-self|flex-/g,Ct=/[^]*?(:[rp][el]a[\w-]+)[^]*/,Ft=/stretch|:\s*\w+\-(?:conte|avail)/,zt=/([^-])(image-set\()/,Nt=1,Kt=1,Yt=0,Bt=1,Pt=[],Dt=[],Tt=0,St=null,Mt=0,jt="";return at.use=st,at.set=ot,o!==void 0&&ot(o),at}var unitlessKeys={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},define_process_env_default={};function y(){return(y=Object.assign||function(o){for(var s=1;s<arguments.length;s++){var a=arguments[s];for(var et in a)Object.prototype.hasOwnProperty.call(a,et)&&(o[et]=a[et])}return o}).apply(this,arguments)}var v=function(o,s){for(var a=[o[0]],et=0,tt=s.length;et<tt;et+=1)a.push(s[et],o[et+1]);return a},g=function(o){return o!==null&&typeof o=="object"&&(o.toString?o.toString():Object.prototype.toString.call(o))==="[object Object]"&&!reactIsExports.typeOf(o)},S=Object.freeze([]),w=Object.freeze({});function E(o){return typeof o=="function"}function b(o){return o.displayName||o.name||"Component"}function _(o){return o&&typeof o.styledComponentId=="string"}var N=typeof process$1<"u"&&define_process_env_default!==void 0&&(define_process_env_default.REACT_APP_SC_ATTR||define_process_env_default.SC_ATTR)||"data-styled",C=typeof window<"u"&&"HTMLElement"in window,I=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process$1<"u"&&define_process_env_default!==void 0&&(define_process_env_default.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&define_process_env_default.REACT_APP_SC_DISABLE_SPEEDY!==""?define_process_env_default.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&define_process_env_default.REACT_APP_SC_DISABLE_SPEEDY:define_process_env_default.SC_DISABLE_SPEEDY!==void 0&&define_process_env_default.SC_DISABLE_SPEEDY!==""&&define_process_env_default.SC_DISABLE_SPEEDY!=="false"&&define_process_env_default.SC_DISABLE_SPEEDY));function D(o){for(var s=arguments.length,a=new Array(s>1?s-1:0),et=1;et<s;et++)a[et-1]=arguments[et];throw new Error("An error occurred. See https://git.io/JUIaE#"+o+" for more information."+(a.length>0?" Args: "+a.join(", "):""))}var j=function(){function o(a){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=a}var s=o.prototype;return s.indexOfGroup=function(a){for(var et=0,tt=0;tt<a;tt++)et+=this.groupSizes[tt];return et},s.insertRules=function(a,et){if(a>=this.groupSizes.length){for(var tt=this.groupSizes,rt=tt.length,nt=rt;a>=nt;)(nt<<=1)<0&&D(16,""+a);this.groupSizes=new Uint32Array(nt),this.groupSizes.set(tt),this.length=nt;for(var it=rt;it<nt;it++)this.groupSizes[it]=0}for(var st=this.indexOfGroup(a+1),ot=0,at=et.length;ot<at;ot++)this.tag.insertRule(st,et[ot])&&(this.groupSizes[a]++,st++)},s.clearGroup=function(a){if(a<this.length){var et=this.groupSizes[a],tt=this.indexOfGroup(a),rt=tt+et;this.groupSizes[a]=0;for(var nt=tt;nt<rt;nt++)this.tag.deleteRule(tt)}},s.getGroup=function(a){var et="";if(a>=this.length||this.groupSizes[a]===0)return et;for(var tt=this.groupSizes[a],rt=this.indexOfGroup(a),nt=rt+tt,it=rt;it<nt;it++)et+=this.tag.getRule(it)+`/*!sc*/
`;return et},o}(),T=new Map,x=new Map,k=1,V=function(o){if(T.has(o))return T.get(o);for(;x.has(k);)k++;var s=k++;return T.set(o,s),x.set(s,o),s},B=function(o){return x.get(o)},z=function(o,s){s>=k&&(k=s+1),T.set(o,s),x.set(s,o)},M="style["+N+'][data-styled-version="5.3.11"]',G=new RegExp("^"+N+'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)'),L=function(o,s,a){for(var et,tt=a.split(","),rt=0,nt=tt.length;rt<nt;rt++)(et=tt[rt])&&o.registerName(s,et)},F=function(o,s){for(var a=(s.textContent||"").split(`/*!sc*/
`),et=[],tt=0,rt=a.length;tt<rt;tt++){var nt=a[tt].trim();if(nt){var it=nt.match(G);if(it){var st=0|parseInt(it[1],10),ot=it[2];st!==0&&(z(ot,st),L(o,ot,it[3]),o.getTag().insertRules(st,et)),et.length=0}else et.push(nt)}}},Y=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null},q=function(o){var s=document.head,a=o||s,et=document.createElement("style"),tt=function(it){for(var st=it.childNodes,ot=st.length;ot>=0;ot--){var at=st[ot];if(at&&at.nodeType===1&&at.hasAttribute(N))return at}}(a),rt=tt!==void 0?tt.nextSibling:null;et.setAttribute(N,"active"),et.setAttribute("data-styled-version","5.3.11");var nt=Y();return nt&&et.setAttribute("nonce",nt),a.insertBefore(et,rt),et},H=function(){function o(a){var et=this.element=q(a);et.appendChild(document.createTextNode("")),this.sheet=function(tt){if(tt.sheet)return tt.sheet;for(var rt=document.styleSheets,nt=0,it=rt.length;nt<it;nt++){var st=rt[nt];if(st.ownerNode===tt)return st}D(17)}(et),this.length=0}var s=o.prototype;return s.insertRule=function(a,et){try{return this.sheet.insertRule(et,a),this.length++,!0}catch{return!1}},s.deleteRule=function(a){this.sheet.deleteRule(a),this.length--},s.getRule=function(a){var et=this.sheet.cssRules[a];return et!==void 0&&typeof et.cssText=="string"?et.cssText:""},o}(),$=function(){function o(a){var et=this.element=q(a);this.nodes=et.childNodes,this.length=0}var s=o.prototype;return s.insertRule=function(a,et){if(a<=this.length&&a>=0){var tt=document.createTextNode(et),rt=this.nodes[a];return this.element.insertBefore(tt,rt||null),this.length++,!0}return!1},s.deleteRule=function(a){this.element.removeChild(this.nodes[a]),this.length--},s.getRule=function(a){return a<this.length?this.nodes[a].textContent:""},o}(),W=function(){function o(a){this.rules=[],this.length=0}var s=o.prototype;return s.insertRule=function(a,et){return a<=this.length&&(this.rules.splice(a,0,et),this.length++,!0)},s.deleteRule=function(a){this.rules.splice(a,1),this.length--},s.getRule=function(a){return a<this.length?this.rules[a]:""},o}(),U=C,J={isServer:!C,useCSSOMInjection:!I},X=function(){function o(a,et,tt){a===void 0&&(a=w),et===void 0&&(et={}),this.options=y({},J,{},a),this.gs=et,this.names=new Map(tt),this.server=!!a.isServer,!this.server&&C&&U&&(U=!1,function(rt){for(var nt=document.querySelectorAll(M),it=0,st=nt.length;it<st;it++){var ot=nt[it];ot&&ot.getAttribute(N)!=="active"&&(F(rt,ot),ot.parentNode&&ot.parentNode.removeChild(ot))}}(this))}o.registerId=function(a){return V(a)};var s=o.prototype;return s.reconstructWithOptions=function(a,et){return et===void 0&&(et=!0),new o(y({},this.options,{},a),this.gs,et&&this.names||void 0)},s.allocateGSInstance=function(a){return this.gs[a]=(this.gs[a]||0)+1},s.getTag=function(){return this.tag||(this.tag=(tt=(et=this.options).isServer,rt=et.useCSSOMInjection,nt=et.target,a=tt?new W(nt):rt?new H(nt):new $(nt),new j(a)));var a,et,tt,rt,nt},s.hasNameForId=function(a,et){return this.names.has(a)&&this.names.get(a).has(et)},s.registerName=function(a,et){if(V(a),this.names.has(a))this.names.get(a).add(et);else{var tt=new Set;tt.add(et),this.names.set(a,tt)}},s.insertRules=function(a,et,tt){this.registerName(a,et),this.getTag().insertRules(V(a),tt)},s.clearNames=function(a){this.names.has(a)&&this.names.get(a).clear()},s.clearRules=function(a){this.getTag().clearGroup(V(a)),this.clearNames(a)},s.clearTag=function(){this.tag=void 0},s.toString=function(){return function(a){for(var et=a.getTag(),tt=et.length,rt="",nt=0;nt<tt;nt++){var it=B(nt);if(it!==void 0){var st=a.names.get(it),ot=et.getGroup(nt);if(st&&ot&&st.size){var at=N+".g"+nt+'[id="'+it+'"]',lt="";st!==void 0&&st.forEach(function(ct){ct.length>0&&(lt+=ct+",")}),rt+=""+ot+at+'{content:"'+lt+`"}/*!sc*/
`}}}return rt}(this)},o}(),Z=/(a)(d)/gi,K=function(o){return String.fromCharCode(o+(o>25?39:97))};function Q(o){var s,a="";for(s=Math.abs(o);s>52;s=s/52|0)a=K(s%52)+a;return(K(s%52)+a).replace(Z,"$1-$2")}var ee=function(o,s){for(var a=s.length;a;)o=33*o^s.charCodeAt(--a);return o},te=function(o){return ee(5381,o)};function ne(o){for(var s=0;s<o.length;s+=1){var a=o[s];if(E(a)&&!_(a))return!1}return!0}var re=te("5.3.11"),oe=function(){function o(s,a,et){this.rules=s,this.staticRulesId="",this.isStatic=(et===void 0||et.isStatic)&&ne(s),this.componentId=a,this.baseHash=ee(re,a),this.baseStyle=et,X.registerId(a)}return o.prototype.generateAndInjectStyles=function(s,a,et){var tt=this.componentId,rt=[];if(this.baseStyle&&rt.push(this.baseStyle.generateAndInjectStyles(s,a,et)),this.isStatic&&!et.hash)if(this.staticRulesId&&a.hasNameForId(tt,this.staticRulesId))rt.push(this.staticRulesId);else{var nt=_e(this.rules,s,a,et).join(""),it=Q(ee(this.baseHash,nt)>>>0);if(!a.hasNameForId(tt,it)){var st=et(nt,"."+it,void 0,tt);a.insertRules(tt,it,st)}rt.push(it),this.staticRulesId=it}else{for(var ot=this.rules.length,at=ee(this.baseHash,et.hash),lt="",ct=0;ct<ot;ct++){var ht=this.rules[ct];if(typeof ht=="string")lt+=ht;else if(ht){var ft=_e(ht,s,a,et),dt=Array.isArray(ft)?ft.join(""):ft;at=ee(at,dt+ct),lt+=dt}}if(lt){var pt=Q(at>>>0);if(!a.hasNameForId(tt,pt)){var gt=et(lt,"."+pt,void 0,tt);a.insertRules(tt,pt,gt)}rt.push(pt)}}return rt.join(" ")},o}(),se=/^\s*\/\/.*$/gm,ie=[":","[",".","#"];function ae(o){var s,a,et,tt,rt=w,nt=rt.options,it=nt===void 0?w:nt,st=rt.plugins,ot=st===void 0?S:st,at=new stylis_min(it),lt=[],ct=function(dt){function pt(gt){if(gt)try{dt(gt+"}")}catch{}}return function(gt,mt,yt,vt,Et,xt,wt,Rt,Ct,Ft){switch(gt){case 1:if(Ct===0&&mt.charCodeAt(0)===64)return dt(mt+";"),"";break;case 2:if(Rt===0)return mt+"/*|*/";break;case 3:switch(Rt){case 102:case 112:return dt(yt[0]+mt),"";default:return mt+(Ft===0?"/*|*/":"")}case-2:mt.split("/*|*/}").forEach(pt)}}}(function(dt){lt.push(dt)}),ht=function(dt,pt,gt){return pt===0&&ie.indexOf(gt[a.length])!==-1||gt.match(tt)?dt:"."+s};function ft(dt,pt,gt,mt){mt===void 0&&(mt="&");var yt=dt.replace(se,""),vt=pt&&gt?gt+" "+pt+" { "+yt+" }":yt;return s=mt,a=pt,et=new RegExp("\\"+a+"\\b","g"),tt=new RegExp("(\\"+a+"\\b){2,}"),at(gt||!pt?"":pt,vt)}return at.use([].concat(ot,[function(dt,pt,gt){dt===2&&gt.length&&gt[0].lastIndexOf(a)>0&&(gt[0]=gt[0].replace(et,ht))},ct,function(dt){if(dt===-2){var pt=lt;return lt=[],pt}}])),ft.hash=ot.length?ot.reduce(function(dt,pt){return pt.name||D(15),ee(dt,pt.name)},5381).toString():"",ft}var ce=React.createContext();ce.Consumer;var le=React.createContext(),de=(le.Consumer,new X),he=ae();function pe(){return reactExports.useContext(ce)||de}function fe(){return reactExports.useContext(le)||he}var ye=function(){function o(s,a){var et=this;this.inject=function(tt,rt){rt===void 0&&(rt=he);var nt=et.name+rt.hash;tt.hasNameForId(et.id,nt)||tt.insertRules(et.id,nt,rt(et.rules,nt,"@keyframes"))},this.toString=function(){return D(12,String(et.name))},this.name=s,this.id="sc-keyframes-"+s,this.rules=a}return o.prototype.getName=function(s){return s===void 0&&(s=he),this.name+s.hash},o}(),ve=/([A-Z])/,ge=/([A-Z])/g,Se=/^ms-/,we=function(o){return"-"+o.toLowerCase()};function Ee(o){return ve.test(o)?o.replace(ge,we).replace(Se,"-ms-"):o}var be=function(o){return o==null||o===!1||o===""};function _e(o,s,a,et){if(Array.isArray(o)){for(var tt,rt=[],nt=0,it=o.length;nt<it;nt+=1)(tt=_e(o[nt],s,a,et))!==""&&(Array.isArray(tt)?rt.push.apply(rt,tt):rt.push(tt));return rt}if(be(o))return"";if(_(o))return"."+o.styledComponentId;if(E(o)){if(typeof(ot=o)!="function"||ot.prototype&&ot.prototype.isReactComponent||!s)return o;var st=o(s);return _e(st,s,a,et)}var ot;return o instanceof ye?a?(o.inject(a,et),o.getName(et)):o:g(o)?function at(lt,ct){var ht,ft,dt=[];for(var pt in lt)lt.hasOwnProperty(pt)&&!be(lt[pt])&&(Array.isArray(lt[pt])&&lt[pt].isCss||E(lt[pt])?dt.push(Ee(pt)+":",lt[pt],";"):g(lt[pt])?dt.push.apply(dt,at(lt[pt],pt)):dt.push(Ee(pt)+": "+(ht=pt,(ft=lt[pt])==null||typeof ft=="boolean"||ft===""?"":typeof ft!="number"||ft===0||ht in unitlessKeys||ht.startsWith("--")?String(ft).trim():ft+"px")+";"));return ct?[ct+" {"].concat(dt,["}"]):dt}(o):o.toString()}var Ne=function(o){return Array.isArray(o)&&(o.isCss=!0),o};function Ae(o){for(var s=arguments.length,a=new Array(s>1?s-1:0),et=1;et<s;et++)a[et-1]=arguments[et];return E(o)||g(o)?Ne(_e(v(S,[o].concat(a)))):a.length===0&&o.length===1&&typeof o[0]=="string"?o:Ne(_e(v(o,a)))}var Oe=function(o,s,a){return a===void 0&&(a=w),o.theme!==a.theme&&o.theme||s||a.theme},Re=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,De=/(^-|-$)/g;function je(o){return o.replace(Re,"-").replace(De,"")}var Te=function(o){return Q(te(o)>>>0)};function xe(o){return typeof o=="string"&&!0}var ke=function(o){return typeof o=="function"||typeof o=="object"&&o!==null&&!Array.isArray(o)},Ve=function(o){return o!=="__proto__"&&o!=="constructor"&&o!=="prototype"};function Be(o,s,a){var et=o[a];ke(s)&&ke(et)?ze(et,s):o[a]=s}function ze(o){for(var s=arguments.length,a=new Array(s>1?s-1:0),et=1;et<s;et++)a[et-1]=arguments[et];for(var tt=0,rt=a;tt<rt.length;tt++){var nt=rt[tt];if(ke(nt))for(var it in nt)Ve(it)&&Be(o,nt[it],it)}return o}var Me=React.createContext();Me.Consumer;var Fe={};function Ye(o,s,a){var et=_(o),tt=!xe(o),rt=s.attrs,nt=rt===void 0?S:rt,it=s.componentId,st=it===void 0?function(mt,yt){var vt=typeof mt!="string"?"sc":je(mt);Fe[vt]=(Fe[vt]||0)+1;var Et=vt+"-"+Te("5.3.11"+vt+Fe[vt]);return yt?yt+"-"+Et:Et}(s.displayName,s.parentComponentId):it,ot=s.displayName,at=ot===void 0?function(mt){return xe(mt)?"styled."+mt:"Styled("+b(mt)+")"}(o):ot,lt=s.displayName&&s.componentId?je(s.displayName)+"-"+s.componentId:s.componentId||st,ct=et&&o.attrs?Array.prototype.concat(o.attrs,nt).filter(Boolean):nt,ht=s.shouldForwardProp;et&&o.shouldForwardProp&&(ht=s.shouldForwardProp?function(mt,yt,vt){return o.shouldForwardProp(mt,yt,vt)&&s.shouldForwardProp(mt,yt,vt)}:o.shouldForwardProp);var ft,dt=new oe(a,lt,et?o.componentStyle:void 0),pt=dt.isStatic&&nt.length===0,gt=function(mt,yt){return function(vt,Et,xt,wt){var Rt=vt.attrs,Ct=vt.componentStyle,Ft=vt.defaultProps,zt=vt.foldedComponentIds,Nt=vt.shouldForwardProp,Kt=vt.styledComponentId,Yt=vt.target,Bt=function($t,kt,Lt){$t===void 0&&($t=w);var bt=y({},kt,{theme:$t}),It={};return Lt.forEach(function(Ut){var Wt,Xt,Qt,er=Ut;for(Wt in E(er)&&(er=er(bt)),er)bt[Wt]=It[Wt]=Wt==="className"?(Xt=It[Wt],Qt=er[Wt],Xt&&Qt?Xt+" "+Qt:Xt||Qt):er[Wt]}),[bt,It]}(Oe(Et,reactExports.useContext(Me),Ft)||w,Et,Rt),Pt=Bt[0],Dt=Bt[1],Tt=function($t,kt,Lt,bt){var It=pe(),Ut=fe(),Wt=kt?$t.generateAndInjectStyles(w,It,Ut):$t.generateAndInjectStyles(Lt,It,Ut);return Wt}(Ct,wt,Pt),St=xt,Mt=Dt.$as||Et.$as||Dt.as||Et.as||Yt,jt=xe(Mt),Gt=Dt!==Et?y({},Et,{},Dt):Et,Ht={};for(var At in Gt)At[0]!=="$"&&At!=="as"&&(At==="forwardedAs"?Ht.as=Gt[At]:(Nt?Nt(At,isPropValid,Mt):!jt||isPropValid(At))&&(Ht[At]=Gt[At]));return Et.style&&Dt.style!==Et.style&&(Ht.style=y({},Et.style,{},Dt.style)),Ht.className=Array.prototype.concat(zt,Kt,Tt!==Kt?Tt:null,Et.className,Dt.className).filter(Boolean).join(" "),Ht.ref=St,reactExports.createElement(Mt,Ht)}(ft,mt,yt,pt)};return gt.displayName=at,(ft=React.forwardRef(gt)).attrs=ct,ft.componentStyle=dt,ft.displayName=at,ft.shouldForwardProp=ht,ft.foldedComponentIds=et?Array.prototype.concat(o.foldedComponentIds,o.styledComponentId):S,ft.styledComponentId=lt,ft.target=et?o.target:o,ft.withComponent=function(mt){var yt=s.componentId,vt=function(xt,wt){if(xt==null)return{};var Rt,Ct,Ft={},zt=Object.keys(xt);for(Ct=0;Ct<zt.length;Ct++)Rt=zt[Ct],wt.indexOf(Rt)>=0||(Ft[Rt]=xt[Rt]);return Ft}(s,["componentId"]),Et=yt&&yt+"-"+(xe(mt)?mt:je(b(mt)));return Ye(mt,y({},vt,{attrs:ct,componentId:Et}),a)},Object.defineProperty(ft,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(mt){this._foldedDefaultProps=et?ze({},o.defaultProps,mt):mt}}),Object.defineProperty(ft,"toString",{value:function(){return"."+ft.styledComponentId}}),tt&&m$1(ft,o,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0,withComponent:!0}),ft}var qe=function(o){return function s(a,et,tt){if(tt===void 0&&(tt=w),!reactIsExports.isValidElementType(et))return D(1,String(et));var rt=function(){return a(et,tt,Ae.apply(void 0,arguments))};return rt.withConfig=function(nt){return s(a,et,y({},tt,{},nt))},rt.attrs=function(nt){return s(a,et,y({},tt,{attrs:Array.prototype.concat(tt.attrs,nt).filter(Boolean)}))},rt}(Ye,o)};["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","textPath","tspan"].forEach(function(o){qe[o]=qe(o)});const StatWrapper=qe.div`
  display: flex;
`;qe.div`
  display: inline-block;

  @media (max-width: 800px) {
    display: none;
  }
`;qe.i`
  margin: 0 0.5rem 0 1.2rem;
  transform: translateY(1px);
  display: inline-block;
  font-size: 1rem;
  color: #fff;
`;qe.span`
  font-size: 1rem;
  color: #fff;
`;const LogOut=qe.a`
  padding: 0 1rem 0 2rem;
  cursor: pointer;
`,LogOutIcon=qe.i`
  font-size: 1rem;
  color: #fff;
`,Stats=o=>jsxRuntimeExports.jsx(StatWrapper,{children:jsxRuntimeExports.jsx(LogOut,{onClick:o.onSignOut,href:"/",children:jsxRuntimeExports.jsx(LogOutIcon,{className:"icon-log-out"})})});Stats.propTypes={onSignOut:PropTypes.func};const Stats$1=React.memo(Stats),InputWrapper=qe.div`
  width: 100%;
  border-radius: 5px;
  background-color: rgba(0, 0, 0, 0.5) !important;
  padding: 0 0.75rem;
  position: relative;
`,InputElement=qe.input`
  background-color: transparent;
  border: none;
  border-radius: 0;
  outline: none;
  height: 3rem;
  width: 100%;
  font-size: 1rem;
  padding: 0;
  box-sizing: content-box;
  transition: all .3s;
  color: #fff;
  margin: 0 !important;
  border-bottom: 1px solid transparent !important;
  border-bottom: ${o=>o.invalid?"1px solid #F44336 !important":"none"};
  box-shadow: ${o=>o.invalid?"0 1px 0 0 #F44336 !important":"none"};

  &:focus {
    border-bottom: 1px solid #26a69a !important;
    box-shadow: 0 1px 0 0 #26a69a !important;
  }

  &::placeholder {
    color: #999;
  }
`,InputIcon=qe.i`
  position: absolute !important;
  top: 1rem;
  right: 1.3rem;
  color: #555555;
`,Input=(o={type:"text",autoComplete:"off",placeholder:"Please enter some text",onInput:()=>{},onChange:()=>{},onInvalid:()=>{},onKeyDown:()=>{}})=>{const[s,a]=reactExports.useState(0),[et,tt]=reactExports.useState(""),rt=st=>{o.onInput(st),a(!1)},nt=st=>{o.onInvalid(st),a(!0)},it=st=>{tt(st.target.value)};return jsxRuntimeExports.jsxs(InputWrapper,{className:"input-wrapper",children:[o.icon&&jsxRuntimeExports.jsx(InputIcon,{className:o.icon}),jsxRuntimeExports.jsx(InputElement,{value:et,...o,onKeyDown:o.onKeyDown,invalid:s,onInput:rt,onInvalid:nt,onChange:it})]})},Input$1=React.memo(Input),util={getMemoryLogWebFrame(o){const s=a=>{const et=tt=>(tt/1e6).toFixed(2);console.log("object",a[0]),console.log("count",a[1].count),console.log("size",et(a[1].size)+"MB"),console.log("liveSize",et(a[1].liveSize)+"MB")};Object.entries(o.getResourceUsage()).map(s),console.log("------")},calcHealth:({peers:o,seeds:s})=>{const a=o>0?s/o:s,et=Math.min(a/5*100,100),tt=Math.min(s/30*100,100),rt=et*.6,nt=tt*.4;return(rt+nt)*3/100|0},calcScreenSize:({width:o=window.screen.width,height:s=window.screen.height,minWidth:a=170,maxWidth:et=210,aspectRatio:tt=1.5,containerPadding:rt=16,itemGap:nt=16}={})=>{const it=o-2*rt;let st=Math.floor(it/(a+nt));st=Math.max(st,1);let ot=(it-(st-1)*nt)/st;st===1?ot=it:ot>et?(ot=et,st=Math.floor(it/(ot+nt))):ot<a&&(ot=a,st=Math.floor(it/(ot+nt)));const at=ot*tt;return{width:o,height:s,chunkSize:st,chunkHeight:at+nt,itemWidth:ot,itemHeight:at}},sanitizeSubIndex:o=>o.split(" ")[0].trim(),invalidString:o=>typeof o!="string"||!o||/^\s*$/.test(o)||o.length===0,reduceByIndex:(o,s)=>o.reduce((a,et)=>(a.push(et[s]),a),[]),groupBy:(o,s,a={})=>o.reduce((et,tt)=>((et[tt[s]]=et[tt[s]]||[]).push(tt),et),a),isMobile:()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)||/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.platform)},Dots="data:image/svg+xml,%3c!--%20By%20Sam%20Herbert%20(@sherb),%20for%20everyone.%20More%20@%20http://goo.gl/7AJzbL%20--%3e%3csvg%20width='120'%20height='30'%20viewBox='0%200%20120%2030'%20xmlns='http://www.w3.org/2000/svg'%20fill='%23fff'%3e%3ccircle%20cx='15'%20cy='15'%20r='15'%3e%3canimate%20attributeName='r'%20from='15'%20to='15'%20begin='0s'%20dur='0.8s'%20values='15;9;15'%20calcMode='linear'%20repeatCount='indefinite'%20/%3e%3canimate%20attributeName='fill-opacity'%20from='1'%20to='1'%20begin='0s'%20dur='0.8s'%20values='1;.5;1'%20calcMode='linear'%20repeatCount='indefinite'%20/%3e%3c/circle%3e%3ccircle%20cx='60'%20cy='15'%20r='9'%20fill-opacity='0.3'%3e%3canimate%20attributeName='r'%20from='9'%20to='9'%20begin='0s'%20dur='0.8s'%20values='9;15;9'%20calcMode='linear'%20repeatCount='indefinite'%20/%3e%3canimate%20attributeName='fill-opacity'%20from='0.5'%20to='0.5'%20begin='0s'%20dur='0.8s'%20values='.5;1;.5'%20calcMode='linear'%20repeatCount='indefinite'%20/%3e%3c/circle%3e%3ccircle%20cx='105'%20cy='15'%20r='15'%3e%3canimate%20attributeName='r'%20from='15'%20to='15'%20begin='0s'%20dur='0.8s'%20values='15;9;15'%20calcMode='linear'%20repeatCount='indefinite'%20/%3e%3canimate%20attributeName='fill-opacity'%20from='1'%20to='1'%20begin='0s'%20dur='0.8s'%20values='1;.5;1'%20calcMode='linear'%20repeatCount='indefinite'%20/%3e%3c/circle%3e%3c/svg%3e",PointsLoader=qe.img`
  height: 0.8rem;
`;PointsLoader.defaultProps={src:Dots};const PointsLoader$1=React.memo(PointsLoader),ResultWrapper=qe.li`
  display: flex;
  background-color: transparent;
  list-style-type: none;
  line-height: 1.5rem;
  padding: 10px 20px;
  margin: 0;
  border-bottom: 1px solid rgba(53, 60, 57, 0.4);
  cursor: pointer;
`,ResultContent=qe.div`
  margin-left: 1rem;
  max-width: calc(100% - 3rem);
  flex-grow: 1;
  display: flex;
  flex-direction: column;
`,ResultTitle=qe.strong`
  display: -webkit-box;
  -webkit-line-clamp: 2;
  white-space: pre-wrap;
  -webkit-box-orient: vertical;
  height: auto;
  overflow: hidden;
  text-overflow: ellipsis;
  font-style: normal;
  font-size: 1.2rem;
  word-break: break-all;
  color: #FFF;
  font-weight: 500;
`,ResultDetails=qe.div`
  margin-top: 0.4rem;
`,ResultDetailsItem$1=qe.span`
  font-size: 1rem;
  margin-right: 1rem;
  color: ${o=>o.color};
`,ResultDetailsItemIcon=qe.i`
  font-size: 1rem;
  margin-right: 0.3rem;
  color: ${o=>o.color};
`,ImageWrapper=qe.figure`
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1;
    width: 2.5rem;
    -webkit-transition: all 0.65s ease;
    transition: all 0.65s ease;
`,SearchResultItem=o=>{const s=()=>{o.onClick&&o.onClick(o._id)};return jsxRuntimeExports.jsxs(ResultWrapper,{onClick:s,children:[jsxRuntimeExports.jsx(ImageWrapper,{className:"slide-in-right",children:jsxRuntimeExports.jsx(Image$1,{src:o.image,preload:!0,pulseStyle:{position:"relative"}})}),jsxRuntimeExports.jsxs(ResultContent,{children:[jsxRuntimeExports.jsx(ResultTitle,{children:o.meta.title}),jsxRuntimeExports.jsxs(ResultDetails,{children:[jsxRuntimeExports.jsxs(ResultDetailsItem$1,{color:settings.styles.colors.successDark,children:[jsxRuntimeExports.jsx(ResultDetailsItemIcon,{className:"icon-calendar"}),o.meta.year]}),jsxRuntimeExports.jsxs(ResultDetailsItem$1,{color:settings.styles.colors.warningDark,children:[jsxRuntimeExports.jsx(ResultDetailsItemIcon,{className:"icon-star"}),o.meta.rating]}),jsxRuntimeExports.jsxs(ResultDetailsItem$1,{color:settings.styles.colors.dangerDark,children:[jsxRuntimeExports.jsx(ResultDetailsItemIcon,{className:"icon-back-in-time"}),o.meta.runtime," m"]})]})]})]})},SearchResultItem$1=React.memo(SearchResultItem),ResultsWrapper=qe.div`
  width: 100%;
  position: absolute;
  z-index: 100;
  left: 0;
  top: 100%;
  border-radius: 5px;
  overflow: hidden;
`,ResultsContent=qe.div`
  border-radius: 5px;
  background-color: rgba(0, 0, 0, 0.9);
  width: 100%;
`,ResultsCollection=qe.ul`
  margin: 0.5rem 0 1rem 0;
  border-radius: 2px;
  overflow: hidden;
  position: relative;
  list-style-type: none;
  padding: 0;
  border: none;
`,ResultsEmpty=qe.ul`
  border-radius: 5px;
  background-color: rgba(0, 0, 0, 0.9);
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 1rem;
`,NoResultsText=qe.span`
  font-weight: bold;
  color: #fff;
  font-size: 1rem;
`,SearchResult=o=>jsxRuntimeExports.jsx(ResultsWrapper,{children:o.searching&&jsxRuntimeExports.jsx(ResultsEmpty,{children:jsxRuntimeExports.jsx(PointsLoader$1,{})})||jsxRuntimeExports.jsx(CustomScrollbars,{autoHide:!0,autoHeight:!0,autoHeightMax:500,autoHideTimeout:1e3,autoHideDuration:200,thumbMinSize:30,universal:!0,children:o.result?.length>0&&jsxRuntimeExports.jsx(ResultsContent,{children:jsxRuntimeExports.jsx(ResultsCollection,{children:o.result.map(s=>jsxRuntimeExports.jsx(SearchResultItem$1,{onClick:o.onClick,...Object.assign(s,{image:gateway.parse(s.images?.small)})},s._id))})})||jsxRuntimeExports.jsx(ResultsEmpty,{children:jsxRuntimeExports.jsx(NoResultsText,{children:"No results were found"})})})}),SearchResult$1=React.memo(SearchResult),SearchWrapper=qe.div`
  width: 45%;
  position: relative;

  @media (max-width: 800px) {
    width: 100%;
  }
`;let searchTimeout=null;const Search=o=>{const s=reactExports.useContext(Context),[a,et]=reactExports.useState(!1),[tt,rt]=reactExports.useState(!1),nt=reactExports.useCallback(st=>{const ot=st.target.value,at=util.invalidString(ot);searchTimeout&&clearTimeout(searchTimeout),at?(rt(!1),et(!1)):et(!0),searchTimeout=setTimeout(()=>{at||s.db.connect(o.cid).search(ot).then(lt=>{rt(lt),et(!1)}).catch(()=>{rt([]),et(!1)})},1e3)},[]),it=st=>{rt(!1),et(!1),o.onClick&&o.onClick(st)};return jsxRuntimeExports.jsxs(SearchWrapper,{children:[jsxRuntimeExports.jsx(Input$1,{icon:"icon-tv",onInput:nt,required:!0,autoComplete:"off",type:"text",placeholder:"Search...",name:"search",...!a&&!tt?{value:""}:{}}),(a||tt)&&jsxRuntimeExports.jsx(SearchResult$1,{searching:a,result:tt,onClick:it})]})};Search.propTypes={cid:PropTypes.string.isRequired};const Search$1=React.memo(Search);var lib={exports:{}},seed=1;function getNextValue(){return seed=(seed*9301+49297)%233280,seed/233280}function setSeed$1(o){seed=o}var randomFromSeed$1={nextValue:getNextValue,seed:setSeed$1},randomFromSeed=randomFromSeed$1,ORIGINAL="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-",alphabet$2,previousSeed,shuffled;function reset(){shuffled=!1}function setCharacters(o){if(!o){alphabet$2!==ORIGINAL&&(alphabet$2=ORIGINAL,reset());return}if(o!==alphabet$2){if(o.length!==ORIGINAL.length)throw new Error("Custom alphabet for shortid must be "+ORIGINAL.length+" unique characters. You submitted "+o.length+" characters: "+o);var s=o.split("").filter(function(a,et,tt){return et!==tt.lastIndexOf(a)});if(s.length)throw new Error("Custom alphabet for shortid must be "+ORIGINAL.length+" unique characters. These characters were not unique: "+s.join(", "));alphabet$2=o,reset()}}function characters(o){return setCharacters(o),alphabet$2}function setSeed(o){randomFromSeed.seed(o),previousSeed!==o&&(reset(),previousSeed=o)}function shuffle(){alphabet$2||setCharacters(ORIGINAL);for(var o=alphabet$2.split(""),s=[],a=randomFromSeed.nextValue(),et;o.length>0;)a=randomFromSeed.nextValue(),et=Math.floor(a*o.length),s.push(o.splice(et,1)[0]);return s.join("")}function getShuffled(){return shuffled||(shuffled=shuffle(),shuffled)}function lookup(o){var s=getShuffled();return s[o]}function get(){return alphabet$2||ORIGINAL}var alphabet_1={get,characters,seed:setSeed,lookup,shuffled:getShuffled},crypto$1=typeof window=="object"&&(window.crypto||window.msCrypto),randomByte;!crypto$1||!crypto$1.getRandomValues?randomByte=function(o){for(var s=[],a=0;a<o;a++)s.push(Math.floor(Math.random()*256));return s}:randomByte=function(o){return crypto$1.getRandomValues(new Uint8Array(o))};var randomByteBrowser=randomByte,format_browser=function(o,s,a){for(var et=(2<<Math.log(s.length-1)/Math.LN2)-1,tt=-~(1.6*et*a/s.length),rt="";;)for(var nt=o(tt),it=tt;it--;)if(rt+=s[nt[it]&et]||"",rt.length===+a)return rt},alphabet$1=alphabet_1,random=randomByteBrowser,format$1=format_browser;function generate$1(o){for(var s=0,a,et="";!a;)et=et+format$1(random,alphabet$1.get(),1),a=o<Math.pow(16,s+1),s++;return et}var generate_1=generate$1,generate=generate_1,REDUCE_TIME=1567752802062,version$1=7,counter,previousSeconds;function build$1(o){var s="",a=Math.floor((Date.now()-REDUCE_TIME)*.001);return a===previousSeconds?counter++:(counter=0,previousSeconds=a),s=s+generate(version$1),s=s+generate(o),counter>0&&(s=s+generate(counter)),s=s+generate(a),s}var build_1=build$1,alphabet=alphabet_1;function isShortId(o){if(!o||typeof o!="string"||o.length<6)return!1;var s=new RegExp("[^"+alphabet.get().replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&")+"]");return!s.test(o)}var isValid$1=isShortId;(function(o){var s=alphabet_1,a=build_1,et=isValid$1,tt=0;function rt(ot){return s.seed(ot),o.exports}function nt(ot){return tt=ot,o.exports}function it(ot){return ot!==void 0&&s.characters(ot),s.shuffled()}function st(){return a(tt)}o.exports=st,o.exports.generate=st,o.exports.seed=rt,o.exports.worker=nt,o.exports.characters=it,o.exports.isValid=et})(lib);var libExports=lib.exports,shortid=libExports;const uid=getDefaultExportFromCjs$2(shortid);function isRangeVisible(o){var s=o.lastRenderedStartIndex,a=o.lastRenderedStopIndex,et=o.startIndex,tt=o.stopIndex;return!(et>a||tt<s)}function scanForUnloadedRanges(o){for(var s=o.isItemLoaded,a=o.itemCount,et=o.minimumBatchSize,tt=o.startIndex,rt=o.stopIndex,nt=[],it=null,st=null,ot=tt;ot<=rt;ot++){var at=s(ot);at?st!==null&&(nt.push(it,st),it=st=null):(st=ot,it===null&&(it=ot))}if(st!==null){for(var lt=Math.min(Math.max(st,it+et-1),a-1),ct=st+1;ct<=lt&&!s(ct);ct++)st=ct;nt.push(it,st)}if(nt.length)for(;nt[1]-nt[0]+1<et&&nt[0]>0;){var ht=nt[0]-1;if(!s(ht))nt[0]=ht;else break}return nt}var classCallCheck=function(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")},createClass=function(){function o(s,a){for(var et=0;et<a.length;et++){var tt=a[et];tt.enumerable=tt.enumerable||!1,tt.configurable=!0,"value"in tt&&(tt.writable=!0),Object.defineProperty(s,tt.key,tt)}}return function(s,a,et){return a&&o(s.prototype,a),et&&o(s,et),s}}(),inherits=function(o,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof s);o.prototype=Object.create(s&&s.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(o,s):o.__proto__=s)},possibleConstructorReturn=function(o,s){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s&&(typeof s=="object"||typeof s=="function")?s:o},InfiniteLoader=function(o){inherits(s,o);function s(){var a,et,tt,rt;classCallCheck(this,s);for(var nt=arguments.length,it=Array(nt),st=0;st<nt;st++)it[st]=arguments[st];return rt=(et=(tt=possibleConstructorReturn(this,(a=s.__proto__||Object.getPrototypeOf(s)).call.apply(a,[this].concat(it))),tt),tt._lastRenderedStartIndex=-1,tt._lastRenderedStopIndex=-1,tt._memoizedUnloadedRanges=[],tt._onItemsRendered=function(ot){var at=ot.visibleStartIndex,lt=ot.visibleStopIndex;tt._lastRenderedStartIndex=at,tt._lastRenderedStopIndex=lt,tt._ensureRowsLoaded(at,lt)},tt._setRef=function(ot){tt._listRef=ot},et),possibleConstructorReturn(tt,rt)}return createClass(s,[{key:"resetloadMoreItemsCache",value:function(){var et=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;this._memoizedUnloadedRanges=[],et&&this._ensureRowsLoaded(this._lastRenderedStartIndex,this._lastRenderedStopIndex)}},{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var et=this.props.children;return et({onItemsRendered:this._onItemsRendered,ref:this._setRef})}},{key:"_ensureRowsLoaded",value:function(et,tt){var rt=this.props,nt=rt.isItemLoaded,it=rt.itemCount,st=rt.minimumBatchSize,ot=st===void 0?10:st,at=rt.threshold,lt=at===void 0?15:at,ct=scanForUnloadedRanges({isItemLoaded:nt,itemCount:it,minimumBatchSize:ot,startIndex:Math.max(0,et-lt),stopIndex:Math.min(it-1,tt+lt)});(this._memoizedUnloadedRanges.length!==ct.length||this._memoizedUnloadedRanges.some(function(ht,ft){return ct[ft]!==ht}))&&(this._memoizedUnloadedRanges=ct,this._loadUnloadedRanges(ct))}},{key:"_loadUnloadedRanges",value:function(et){for(var tt=this,rt=this.props.loadMoreItems||this.props.loadMoreRows,nt=function(ot){var at=et[ot],lt=et[ot+1],ct=rt(at,lt);ct?.then(function(){if(isRangeVisible({lastRenderedStartIndex:tt._lastRenderedStartIndex,lastRenderedStopIndex:tt._lastRenderedStopIndex,startIndex:at,stopIndex:lt})){if(tt._listRef==null)return;typeof tt._listRef.resetAfterIndex=="function"?tt._listRef.resetAfterIndex(at,!0):(typeof tt._listRef._getItemStyleCache=="function"&&tt._listRef._getItemStyleCache(-1),tt._listRef.forceUpdate())}})},it=0;it<et.length;it+=2)nt(it)}}]),s}(reactExports.PureComponent),safeIsNaN=Number.isNaN||function o(s){return typeof s=="number"&&s!==s};function isEqual(o,s){return!!(o===s||safeIsNaN(o)&&safeIsNaN(s))}function areInputsEqual(o,s){if(o.length!==s.length)return!1;for(var a=0;a<o.length;a++)if(!isEqual(o[a],s[a]))return!1;return!0}function memoizeOne(o,s){s===void 0&&(s=areInputsEqual);var a,et=[],tt,rt=!1;function nt(){for(var it=[],st=0;st<arguments.length;st++)it[st]=arguments[st];return rt&&a===this&&s(it,et)||(tt=o.apply(this,it),rt=!0,a=this,et=it),tt}return nt}var hasNativePerformanceNow=typeof performance=="object"&&typeof performance.now=="function",now$1=hasNativePerformanceNow?function(){return performance.now()}:function(){return Date.now()};function cancelTimeout(o){cancelAnimationFrame(o.id)}function requestTimeout(o,s){var a=now$1();function et(){now$1()-a>=s?o.call(null):tt.id=requestAnimationFrame(et)}var tt={id:requestAnimationFrame(et)};return tt}var size=-1;function getScrollbarSize(o){if(o===void 0&&(o=!1),size===-1||o){var s=document.createElement("div"),a=s.style;a.width="50px",a.height="50px",a.overflow="scroll",document.body.appendChild(s),size=s.offsetWidth-s.clientWidth,document.body.removeChild(s)}return size}var cachedRTLResult=null;function getRTLOffsetType(o){if(o===void 0&&(o=!1),cachedRTLResult===null||o){var s=document.createElement("div"),a=s.style;a.width="50px",a.height="50px",a.overflow="scroll",a.direction="rtl";var et=document.createElement("div"),tt=et.style;return tt.width="100px",tt.height="100px",s.appendChild(et),document.body.appendChild(s),s.scrollLeft>0?cachedRTLResult="positive-descending":(s.scrollLeft=1,s.scrollLeft===0?cachedRTLResult="negative":cachedRTLResult="positive-ascending"),document.body.removeChild(s),cachedRTLResult}return cachedRTLResult}var IS_SCROLLING_DEBOUNCE_INTERVAL$1=150,defaultItemKey$1=function o(s,a){return s};function createListComponent(o){var s,a=o.getItemOffset,et=o.getEstimatedTotalSize,tt=o.getItemSize,rt=o.getOffsetForIndexAndAlignment,nt=o.getStartIndexForOffset,it=o.getStopIndexForStartIndex,st=o.initInstanceProps,ot=o.shouldResetStyleCacheOnItemSizeChange,at=o.validateProps;return s=function(lt){_inheritsLoose(ct,lt);function ct(ft){var dt;return dt=lt.call(this,ft)||this,dt._instanceProps=st(dt.props,_assertThisInitialized(dt)),dt._outerRef=void 0,dt._resetIsScrollingTimeoutId=null,dt.state={instance:_assertThisInitialized(dt),isScrolling:!1,scrollDirection:"forward",scrollOffset:typeof dt.props.initialScrollOffset=="number"?dt.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},dt._callOnItemsRendered=void 0,dt._callOnItemsRendered=memoizeOne(function(pt,gt,mt,yt){return dt.props.onItemsRendered({overscanStartIndex:pt,overscanStopIndex:gt,visibleStartIndex:mt,visibleStopIndex:yt})}),dt._callOnScroll=void 0,dt._callOnScroll=memoizeOne(function(pt,gt,mt){return dt.props.onScroll({scrollDirection:pt,scrollOffset:gt,scrollUpdateWasRequested:mt})}),dt._getItemStyle=void 0,dt._getItemStyle=function(pt){var gt=dt.props,mt=gt.direction,yt=gt.itemSize,vt=gt.layout,Et=dt._getItemStyleCache(ot&&yt,ot&&vt,ot&&mt),xt;if(Et.hasOwnProperty(pt))xt=Et[pt];else{var wt=a(dt.props,pt,dt._instanceProps),Rt=tt(dt.props,pt,dt._instanceProps),Ct=mt==="horizontal"||vt==="horizontal",Ft=mt==="rtl",zt=Ct?wt:0;Et[pt]=xt={position:"absolute",left:Ft?void 0:zt,right:Ft?zt:void 0,top:Ct?0:wt,height:Ct?"100%":Rt,width:Ct?Rt:"100%"}}return xt},dt._getItemStyleCache=void 0,dt._getItemStyleCache=memoizeOne(function(pt,gt,mt){return{}}),dt._onScrollHorizontal=function(pt){var gt=pt.currentTarget,mt=gt.clientWidth,yt=gt.scrollLeft,vt=gt.scrollWidth;dt.setState(function(Et){if(Et.scrollOffset===yt)return null;var xt=dt.props.direction,wt=yt;if(xt==="rtl")switch(getRTLOffsetType()){case"negative":wt=-yt;break;case"positive-descending":wt=vt-mt-yt;break}return wt=Math.max(0,Math.min(wt,vt-mt)),{isScrolling:!0,scrollDirection:Et.scrollOffset<wt?"forward":"backward",scrollOffset:wt,scrollUpdateWasRequested:!1}},dt._resetIsScrollingDebounced)},dt._onScrollVertical=function(pt){var gt=pt.currentTarget,mt=gt.clientHeight,yt=gt.scrollHeight,vt=gt.scrollTop;dt.setState(function(Et){if(Et.scrollOffset===vt)return null;var xt=Math.max(0,Math.min(vt,yt-mt));return{isScrolling:!0,scrollDirection:Et.scrollOffset<xt?"forward":"backward",scrollOffset:xt,scrollUpdateWasRequested:!1}},dt._resetIsScrollingDebounced)},dt._outerRefSetter=function(pt){var gt=dt.props.outerRef;dt._outerRef=pt,typeof gt=="function"?gt(pt):gt!=null&&typeof gt=="object"&&gt.hasOwnProperty("current")&&(gt.current=pt)},dt._resetIsScrollingDebounced=function(){dt._resetIsScrollingTimeoutId!==null&&cancelTimeout(dt._resetIsScrollingTimeoutId),dt._resetIsScrollingTimeoutId=requestTimeout(dt._resetIsScrolling,IS_SCROLLING_DEBOUNCE_INTERVAL$1)},dt._resetIsScrolling=function(){dt._resetIsScrollingTimeoutId=null,dt.setState({isScrolling:!1},function(){dt._getItemStyleCache(-1,null)})},dt}ct.getDerivedStateFromProps=function(dt,pt){return validateSharedProps$1(dt,pt),at(dt),null};var ht=ct.prototype;return ht.scrollTo=function(dt){dt=Math.max(0,dt),this.setState(function(pt){return pt.scrollOffset===dt?null:{scrollDirection:pt.scrollOffset<dt?"forward":"backward",scrollOffset:dt,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},ht.scrollToItem=function(dt,pt){pt===void 0&&(pt="auto");var gt=this.props,mt=gt.itemCount,yt=gt.layout,vt=this.state.scrollOffset;dt=Math.max(0,Math.min(dt,mt-1));var Et=0;if(this._outerRef){var xt=this._outerRef;yt==="vertical"?Et=xt.scrollWidth>xt.clientWidth?getScrollbarSize():0:Et=xt.scrollHeight>xt.clientHeight?getScrollbarSize():0}this.scrollTo(rt(this.props,dt,pt,vt,this._instanceProps,Et))},ht.componentDidMount=function(){var dt=this.props,pt=dt.direction,gt=dt.initialScrollOffset,mt=dt.layout;if(typeof gt=="number"&&this._outerRef!=null){var yt=this._outerRef;pt==="horizontal"||mt==="horizontal"?yt.scrollLeft=gt:yt.scrollTop=gt}this._callPropsCallbacks()},ht.componentDidUpdate=function(){var dt=this.props,pt=dt.direction,gt=dt.layout,mt=this.state,yt=mt.scrollOffset,vt=mt.scrollUpdateWasRequested;if(vt&&this._outerRef!=null){var Et=this._outerRef;if(pt==="horizontal"||gt==="horizontal")if(pt==="rtl")switch(getRTLOffsetType()){case"negative":Et.scrollLeft=-yt;break;case"positive-ascending":Et.scrollLeft=yt;break;default:var xt=Et.clientWidth,wt=Et.scrollWidth;Et.scrollLeft=wt-xt-yt;break}else Et.scrollLeft=yt;else Et.scrollTop=yt}this._callPropsCallbacks()},ht.componentWillUnmount=function(){this._resetIsScrollingTimeoutId!==null&&cancelTimeout(this._resetIsScrollingTimeoutId)},ht.render=function(){var dt=this.props,pt=dt.children,gt=dt.className,mt=dt.direction,yt=dt.height,vt=dt.innerRef,Et=dt.innerElementType,xt=dt.innerTagName,wt=dt.itemCount,Rt=dt.itemData,Ct=dt.itemKey,Ft=Ct===void 0?defaultItemKey$1:Ct,zt=dt.layout,Nt=dt.outerElementType,Kt=dt.outerTagName,Yt=dt.style,Bt=dt.useIsScrolling,Pt=dt.width,Dt=this.state.isScrolling,Tt=mt==="horizontal"||zt==="horizontal",St=Tt?this._onScrollHorizontal:this._onScrollVertical,Mt=this._getRangeToRender(),jt=Mt[0],Gt=Mt[1],Ht=[];if(wt>0)for(var At=jt;At<=Gt;At++)Ht.push(reactExports.createElement(pt,{data:Rt,key:Ft(At,Rt),index:At,isScrolling:Bt?Dt:void 0,style:this._getItemStyle(At)}));var $t=et(this.props,this._instanceProps);return reactExports.createElement(Nt||Kt||"div",{className:gt,onScroll:St,ref:this._outerRefSetter,style:_extends$3({position:"relative",height:yt,width:Pt,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:mt},Yt)},reactExports.createElement(Et||xt||"div",{children:Ht,ref:vt,style:{height:Tt?"100%":$t,pointerEvents:Dt?"none":void 0,width:Tt?$t:"100%"}}))},ht._callPropsCallbacks=function(){if(typeof this.props.onItemsRendered=="function"){var dt=this.props.itemCount;if(dt>0){var pt=this._getRangeToRender(),gt=pt[0],mt=pt[1],yt=pt[2],vt=pt[3];this._callOnItemsRendered(gt,mt,yt,vt)}}if(typeof this.props.onScroll=="function"){var Et=this.state,xt=Et.scrollDirection,wt=Et.scrollOffset,Rt=Et.scrollUpdateWasRequested;this._callOnScroll(xt,wt,Rt)}},ht._getRangeToRender=function(){var dt=this.props,pt=dt.itemCount,gt=dt.overscanCount,mt=this.state,yt=mt.isScrolling,vt=mt.scrollDirection,Et=mt.scrollOffset;if(pt===0)return[0,0,0,0];var xt=nt(this.props,Et,this._instanceProps),wt=it(this.props,xt,Et,this._instanceProps),Rt=!yt||vt==="backward"?Math.max(1,gt):1,Ct=!yt||vt==="forward"?Math.max(1,gt):1;return[Math.max(0,xt-Rt),Math.max(0,Math.min(pt-1,wt+Ct)),xt,wt]},ct}(reactExports.PureComponent),s.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},s}var validateSharedProps$1=function o(s,a){s.children,s.direction,s.height,s.layout,s.innerTagName,s.outerTagName,s.width,a.instance},FixedSizeList=createListComponent({getItemOffset:function o(s,a){var et=s.itemSize;return a*et},getItemSize:function o(s,a){var et=s.itemSize;return et},getEstimatedTotalSize:function o(s){var a=s.itemCount,et=s.itemSize;return et*a},getOffsetForIndexAndAlignment:function o(s,a,et,tt,rt,nt){var it=s.direction,st=s.height,ot=s.itemCount,at=s.itemSize,lt=s.layout,ct=s.width,ht=it==="horizontal"||lt==="horizontal",ft=ht?ct:st,dt=Math.max(0,ot*at-ft),pt=Math.min(dt,a*at),gt=Math.max(0,a*at-ft+at+nt);switch(et==="smart"&&(tt>=gt-ft&&tt<=pt+ft?et="auto":et="center"),et){case"start":return pt;case"end":return gt;case"center":{var mt=Math.round(gt+(pt-gt)/2);return mt<Math.ceil(ft/2)?0:mt>dt+Math.floor(ft/2)?dt:mt}case"auto":default:return tt>=gt&&tt<=pt?tt:tt<gt?gt:pt}},getStartIndexForOffset:function o(s,a){var et=s.itemCount,tt=s.itemSize;return Math.max(0,Math.min(et-1,Math.floor(a/tt)))},getStopIndexForStartIndex:function o(s,a,et){var tt=s.direction,rt=s.height,nt=s.itemCount,it=s.itemSize,st=s.layout,ot=s.width,at=tt==="horizontal"||st==="horizontal",lt=a*it,ct=at?ot:rt,ht=Math.ceil((ct+et-lt)/it);return Math.max(0,Math.min(nt-1,a+ht-1))},initInstanceProps:function o(s){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function o(s){s.itemSize}});const ResultDetailsItem=qe.span`
  font-size: 1rem;
  color: ${o=>o.color};
`,Poster=o=>o.empty?jsxRuntimeExports.jsx(Box,{sx:{width:`${o?.screen?.itemWidth}px`,height:`${o?.screen?.itemHeight}px`}}):jsxRuntimeExports.jsxs(Box,{className:"card","data-effect":"zoom",onClick:()=>o.onClick(o._id),sx:{width:`${o?.screen?.itemWidth}px`,height:`${o?.screen?.itemHeight}px`},children:[jsxRuntimeExports.jsx("figure",{className:"card__image",children:jsxRuntimeExports.jsx(Image$1,{src:o.image,preload:!0})}),jsxRuntimeExports.jsxs("div",{className:"card__body",children:[jsxRuntimeExports.jsx("h3",{className:"card__name card--slide-in-top",children:jsxRuntimeExports.jsx("span",{children:o.meta.title})}),jsxRuntimeExports.jsxs(Box,{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",sx:{width:"100%",bottom:0,left:0,p:1},children:[jsxRuntimeExports.jsxs(Box,{display:"flex",alignItems:"center",justifyContent:"space-between",sx:{width:"100%",margin:"0.5rem 0"},children:[jsxRuntimeExports.jsx(ResultDetailsItem,{className:"card--slide-in-left",color:settings.styles.colors.successDark,children:o.meta.year}),jsxRuntimeExports.jsxs(ResultDetailsItem,{className:"card--fade-in",color:settings.styles.colors.warningDark,children:[o.meta.rating," / 10"]}),jsxRuntimeExports.jsxs(ResultDetailsItem,{className:"card--slide-in-right",color:settings.styles.colors.dangerDark,children:[o.meta.runtime," m"]})]}),jsxRuntimeExports.jsx("p",{className:"card__desc card--slide-in-bottom",children:o.meta?.synopsis})]})]})]}),CatalogPoster=React.memo(Poster);class CatalogRow extends React.Component{static get propTypes(){return{chunk:PropTypes.array.isRequired}}shouldComponentUpdate(s){return s.chunk!==this.props.chunk||s.chunkSize!=this.props.chunkSize}render(){return jsxRuntimeExports.jsxs("div",{className:"clearfix row-img",style:this.props.style,children:[!this.props.empty&&this.props.chunk.map(s=>jsxRuntimeExports.jsx(CatalogPoster,{id:s._id,image:gateway.parse(s?.images?.medium),...this.props,...s},s._id||uid.generate())),this.props.chunk.length<this.props.chunkSize&&!this.props.empty&&Array(this.props.chunkSize-this.props.chunk.length).fill(0).map(()=>jsxRuntimeExports.jsx(CatalogPoster,{...this.props,empty:!0},uid.generate()))]})}}class CatalogList extends React.Component{constructor(s){super(s),this.state={movies:[],end:!1,chunkSize:0,count:0,screen:{}}}static getDerivedStateFromProps(s){if(!s.movies)return null;const a=s.movies,et=s.count,tt=s.end,rt=s.chunkSize,nt=s.screen;return{count:et,movies:a,end:tt,chunkSize:rt,screen:nt}}renderRow=({index:s,style:a})=>this.state.movies[s]?jsxRuntimeExports.jsx(CatalogRow,{style:a,chunk:this.state.movies[s],chunkSize:this.state.chunkSize,onClick:this.props.onClick,onPlay:this.props.onPlay,screen:this.props.screen,empty:!1,preload:!0},s):jsxRuntimeExports.jsx(CatalogRow,{style:a,chunk:Array(this.state.chunkSize).fill(0),chunkSize:this.state.chunkSize,empty:!0,onClick:()=>{},onPlay:()=>{}},uid.generate());alreadyLoaded=s=>!!this.state.movies[s];onScrollUpdate=(...s)=>{const[a,et]=s;return this.state.end?new Promise(()=>console.log("Finish")):this.props.loadOrder?.(a,et)};render(){return jsxRuntimeExports.jsx("div",{className:"movie-list-posters",children:jsxRuntimeExports.jsx(InfiniteLoader,{isItemLoaded:this.alreadyLoaded,loadMoreItems:this.onScrollUpdate,itemCount:this.state.count,children:({onItemsRendered:s,ref:a})=>jsxRuntimeExports.jsx(FixedSizeList,{className:"row-list",height:this.state.screen.height,itemCount:this.state.count,itemSize:this.state.screen.chunkHeight,onItemsRendered:s,width:this.state.screen.width,ref:a,children:this.renderRow})})})}}class NavBarMenu extends React.Component{constructor(s){super(s),this.state={label:!1}}shouldComponentUpdate(s,a,et){return!Object.is(a.label,this.state.label)}static get propTypes(){return{list:PropTypes.array.isRequired,btnText:PropTypes.string.isRequired}}componentDidMount(){this.props.onGetInitialItem&&this.props.list.map((s,a)=>s.default?(this.props.onGetInitialItem(this.props.list[a]),!1):!0)}handlePreventDefault(s){s.preventDefault()}handleClick=s=>{this.handlePreventDefault(s);const et=s.target.dataset,{label:tt}=et;this.setState({label:tt}),this.props.onChange&&this.props.onChange(et)};render(){return jsxRuntimeExports.jsx("ul",{className:"dropdown",children:this.props.list.length>0&&jsxRuntimeExports.jsxs("li",{children:[jsxRuntimeExports.jsxs("a",{className:"dropdown-button",onClick:this.handlePreventDefault,href:"/",children:[jsxRuntimeExports.jsx("i",{className:`${this.props.icon||"icon-triangle-down"} white-text nav-var-icon normalize-small-icon left margin-right-4`}),jsxRuntimeExports.jsx("span",{className:"white-text",children:this.props.btnText}),this.state.label&&jsxRuntimeExports.jsx("span",{className:"dropdown-result no-bold blue-text",children:this.state.label})||this.props.list.map(s=>s.default&&jsxRuntimeExports.jsx("span",{className:"dropdown-result no-bold blue-text",children:s.label},uid.generate()))]}),jsxRuntimeExports.jsx("div",{className:"dropdown-content",children:jsxRuntimeExports.jsx("ul",{children:this.props.list.map(s=>jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsxs("a",{onClick:this.handleClick,className:"drop-item",href:"/","data-action":s.action,"data-label":s.label,"data-type":s.type,children:[jsxRuntimeExports.jsx("span",{className:"pointer-events-none",children:s.label})," ",s.icon]})},uid.generate()))})})]})})}}class CatalogNavBar extends React.Component{constructor(s){super(s),this.state={sort:[{label:"Year",action:"meta.year",default:!0},{label:"Title",action:"meta.title"},{label:"Runtime",action:"meta.runtime"},{label:"Rating",action:"meta.rating"}],genres:[{label:"All",action:"All",default:!0},{label:"Action",action:"Action"},{label:"Adventure",action:"Adventure"},{label:"Animation",action:"Animation"},{label:"Biography",action:"Biography"},{label:"Comedy",action:"Comedy"},{label:"Crime",action:"Crime"},{label:"Documentary",action:"Documentary"},{label:"Drama",action:"Drama"},{label:"Family",action:"Family"},{label:"Fantasy",action:"Fantasy"},{label:"Film-Noir",action:"Film-Noir"},{label:"Game-Show",action:"Game-Show"},{label:"History",action:"History"},{label:"Horror",action:"Horror"},{label:"Music",action:"Music"},{label:"Musical",action:"Musical"},{label:"News",action:"News"},{label:"Mystery",action:"Mystery"},{label:"Romance",action:"Romance"},{label:"Reality-TV",action:"Reality-TV"},{label:"Sci-Fi",action:"Sci-Fi"},{label:"Sport",action:"Sport"},{label:"Talk-Show",action:"Talk-Show"},{label:"Thriller",action:"Thriller"},{label:"War",action:"War"},{label:"Western",action:"Western"}]}}shouldComponentUpdate(){return!1}onChange(s,a){this.props.onChange&&this.props.onChange(s,a)}handleSortBy=s=>this.onChange("sort_by",s);handleGenres=s=>this.onChange("genres",s);render(){return jsxRuntimeExports.jsxs("div",{className:"nav-wrapper main-nav-filter-movies",children:[jsxRuntimeExports.jsx(NavBarMenu,{btnText:"Sort By",list:this.state.sort,onChange:this.handleSortBy}),jsxRuntimeExports.jsx(NavBarMenu,{btnText:"Genre",list:this.state.genres,onChange:this.handleGenres})]})}}class Catalog extends React.Component{static contextType=Context;constructor(s){super(s),this.state={state:"Bootstrapping",percent:0,count:10,total:0,ready:!1,loading:!0,movies:[],screen:{},lock:!1,finishLoad:!1,sort:{sort_by:"meta.year",order:"asc"}},this.renderTimeout=null,this.resizeTimeout=null,this.moviesWrapper=React.createRef()}get db(){return this.context.db.connect(this.props.cid)}startRunning=s=>{this.setState({ready:!0,total:s,count:s})};storeCollections=async s=>{await this.db.insert(s).then(()=>{log$d.warn("Stored movies")})};startConnecting=async s=>{if(!s)return;const a=await this.db.count();if(a>0)return this.startRunning(a);this.context.broker.removeAllListeners(),this.context.broker.stopListeningIPC(),this.context.broker.startListeningIPC();const et=[];this.context.broker.on("notification",async(tt,rt)=>{const nt={...rt,_id:rt.meta.id};this.setState({percent:parseInt(nt.progress),count:nt.count,total:nt.count}),et.push(nt),nt.end&&(await this.storeCollections(et),this.startRunning(nt.count))}),this.context.broker.connect(s)};getRecalculatedScreen=()=>{const s=this.moviesWrapper.current?.offsetWidth,a=this.moviesWrapper.current?.offsetHeight,et=util.calcScreenSize({width:s,height:a});return log$d.info(`Recalculating Screen W:${s}, H:${a}`),et};moviesToRow(s,a){return new Array(Math.ceil(s.length/a)).fill(0).map((et,tt)=>s.slice(tt*a,tt*a+a))}removeExtraRow=(s,a)=>s.filter(et=>Object.is(et.length,a));recalculateScreen=()=>{if(!this.state.movies.length)return;const s=this.getRecalculatedScreen(),a=this.state.movies.flat(1),et=this.moviesToRow(a,s.chunkSize),tt=this.removeExtraRow(et,s.chunkSize);this.setState({loading:!1,lock:!1,movies:tt,screen:s})};handleResize=()=>{this.state.loading||this.setState({loading:!0}),this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(this.recalculateScreen,500)};componentWillUnmount(){window.removeEventListener("resize",this.handleResize),this.context.broker.removeAllListeners()}componentDidMount(){window.addEventListener("resize",this.handleResize);const s=this.getRecalculatedScreen();this.setState({screen:s}),this.startConnecting(this.props.cid)}handleClickMovie=s=>{this.props?.onClickMovie(s),this.setState({lock:!0})};filterMovies(s={},a=!1,et=null,tt=null){"genres"in s&&s.genres==="All"&&delete s.genres,s={limit:this.state.screen.limit,...s},"to"in s&&"start"in s&&(s.limit=s.to-s.start,s.skip=s.start,log$d.info("Skip:",s.skip),log$d.info("Chunk:",s.limit)),this.db.filter(s).then(rt=>{log$d.warn("Movies filtered");const nt=et||this.state.screen.chunkSize,it=this.moviesToRow(rt,nt),st=it.length,ot=[...this.state.movies,...it],at=ot.length;this.setState({scrolling:!1,loading:!1,count:at,finishLoad:a?!1:!st,movies:a?it:ot,lock:!1}),tt&&tt(this.state)})}loadOrder=(s,a,et=this.state.screen.chunkSize)=>(s=s*et,a=a*et,log$d.warn("Fetching movies from db"),new Promise(tt=>{this.renderTimeout&&clearTimeout(this.renderTimeout),this.renderTimeout=setTimeout(()=>{this.filterMovies({start:s,to:a,...this.state.sort},!1,!1,rt=>{log$d.info("Infinite movies loaded"),tt(rt)})},500)}));handleOnChange=(s,a)=>{log$d.warn(`Sorting by ${a.action}`),this.setState({loading:!0,sort:{...this.state.sort,[s]:a.action}},()=>{setTimeout(()=>this.filterMovies(this.state.sort,!0),0)})};handleSignOut=s=>{s.preventDefault(),this.props.onSignOut(this.props.cid)};render(){return jsxRuntimeExports.jsxs("div",{className:"relative full-height main-view",ref:this.moviesWrapper,children:[this.state.loading&&jsxRuntimeExports.jsx(MainLoader,{content:this.state.percent>0?`${this.state.percent} %`:null,percent:this.state.percent}),jsxRuntimeExports.jsx("section",{className:"row full-height",children:jsxRuntimeExports.jsxs("div",{className:"clearfix full-height",children:[jsxRuntimeExports.jsxs("header",{className:"no-margin vertical-padding transparent z-depth-1 d-flex align-items-center justify-content-between header-search",children:[jsxRuntimeExports.jsx(Search$1,{cid:this.props.cid,onClick:this.handleClickMovie}),jsxRuntimeExports.jsx("nav",{className:"col l6 m6 transparent z-depth-0",children:jsxRuntimeExports.jsx(CatalogNavBar,{onChange:this.handleOnChange})}),jsxRuntimeExports.jsx(Stats$1,{onSignOut:this.handleSignOut})]}),jsxRuntimeExports.jsx("section",{className:"row movies-box clearfix",children:this.state.ready&&jsxRuntimeExports.jsx(CatalogList,{movies:this.state.movies,loadOrder:this.loadOrder,count:this.state.count,loading:this.state.lock,end:this.state.finishLoad,chunkSize:this.state.screen.chunkSize,onClick:this.handleClickMovie,onPlay:this.props.onPlayMovie,screen:this.state.screen})})]})})]})}}class PlayerVideo extends React.PureComponent{constructor(s={type:""}){super(s),this.video=null}getRef=s=>{this.video=s};render(){return jsxRuntimeExports.jsx("video",{ref:this.getRef,autoPlay:!0,controls:!0,playsInline:!0,className:"vjs-theme-city video-js full-width full-height"})}}function getDefaultExportFromCjs(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var urlToolkit={exports:{}};(function(o,s){(function(a){var et=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,tt=/^(?=([^\/?#]*))\1([^]*)$/,rt=/(?:\/|^)\.(?=\/)/g,nt=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,it={buildAbsoluteURL:function(st,ot,at){if(at=at||{},st=st.trim(),ot=ot.trim(),!ot){if(!at.alwaysNormalize)return st;var lt=it.parseURL(st);if(!lt)throw new Error("Error trying to parse base URL.");return lt.path=it.normalizePath(lt.path),it.buildURLFromParts(lt)}var ct=it.parseURL(ot);if(!ct)throw new Error("Error trying to parse relative URL.");if(ct.scheme)return at.alwaysNormalize?(ct.path=it.normalizePath(ct.path),it.buildURLFromParts(ct)):ot;var ht=it.parseURL(st);if(!ht)throw new Error("Error trying to parse base URL.");if(!ht.netLoc&&ht.path&&ht.path[0]!=="/"){var ft=tt.exec(ht.path);ht.netLoc=ft[1],ht.path=ft[2]}ht.netLoc&&!ht.path&&(ht.path="/");var dt={scheme:ht.scheme,netLoc:ct.netLoc,path:null,params:ct.params,query:ct.query,fragment:ct.fragment};if(!ct.netLoc&&(dt.netLoc=ht.netLoc,ct.path[0]!=="/"))if(!ct.path)dt.path=ht.path,ct.params||(dt.params=ht.params,ct.query||(dt.query=ht.query));else{var pt=ht.path,gt=pt.substring(0,pt.lastIndexOf("/")+1)+ct.path;dt.path=it.normalizePath(gt)}return dt.path===null&&(dt.path=at.alwaysNormalize?it.normalizePath(ct.path):ct.path),it.buildURLFromParts(dt)},parseURL:function(st){var ot=et.exec(st);return ot?{scheme:ot[1]||"",netLoc:ot[2]||"",path:ot[3]||"",params:ot[4]||"",query:ot[5]||"",fragment:ot[6]||""}:null},normalizePath:function(st){for(st=st.split("").reverse().join("").replace(rt,"");st.length!==(st=st.replace(nt,"")).length;);return st.split("").reverse().join("")},buildURLFromParts:function(st){return st.scheme+st.netLoc+st.path+st.params+st.query+st.fragment}};o.exports=it})()})(urlToolkit);var urlToolkitExports=urlToolkit.exports;function ownKeys(o,s){var a=Object.keys(o);if(Object.getOwnPropertySymbols){var et=Object.getOwnPropertySymbols(o);s&&(et=et.filter(function(tt){return Object.getOwnPropertyDescriptor(o,tt).enumerable})),a.push.apply(a,et)}return a}function _objectSpread2(o){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?ownKeys(Object(a),!0).forEach(function(et){_defineProperty(o,et,a[et])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach(function(et){Object.defineProperty(o,et,Object.getOwnPropertyDescriptor(a,et))})}return o}function _toPrimitive(o,s){if(typeof o!="object"||!o)return o;var a=o[Symbol.toPrimitive];if(a!==void 0){var et=a.call(o,s||"default");if(typeof et!="object")return et;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(o)}function _toPropertyKey(o){var s=_toPrimitive(o,"string");return typeof s=="symbol"?s:String(s)}function _defineProperty(o,s,a){return s=_toPropertyKey(s),s in o?Object.defineProperty(o,s,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[s]=a,o}function _extends(){return _extends=Object.assign?Object.assign.bind():function(o){for(var s=1;s<arguments.length;s++){var a=arguments[s];for(var et in a)Object.prototype.hasOwnProperty.call(a,et)&&(o[et]=a[et])}return o},_extends.apply(this,arguments)}const isFiniteNumber=Number.isFinite||function(o){return typeof o=="number"&&isFinite(o)},isSafeInteger=Number.isSafeInteger||function(o){return typeof o=="number"&&Math.abs(o)<=MAX_SAFE_INTEGER},MAX_SAFE_INTEGER=Number.MAX_SAFE_INTEGER||9007199254740991;let Events=function(o){return o.MEDIA_ATTACHING="hlsMediaAttaching",o.MEDIA_ATTACHED="hlsMediaAttached",o.MEDIA_DETACHING="hlsMediaDetaching",o.MEDIA_DETACHED="hlsMediaDetached",o.BUFFER_RESET="hlsBufferReset",o.BUFFER_CODECS="hlsBufferCodecs",o.BUFFER_CREATED="hlsBufferCreated",o.BUFFER_APPENDING="hlsBufferAppending",o.BUFFER_APPENDED="hlsBufferAppended",o.BUFFER_EOS="hlsBufferEos",o.BUFFER_FLUSHING="hlsBufferFlushing",o.BUFFER_FLUSHED="hlsBufferFlushed",o.MANIFEST_LOADING="hlsManifestLoading",o.MANIFEST_LOADED="hlsManifestLoaded",o.MANIFEST_PARSED="hlsManifestParsed",o.LEVEL_SWITCHING="hlsLevelSwitching",o.LEVEL_SWITCHED="hlsLevelSwitched",o.LEVEL_LOADING="hlsLevelLoading",o.LEVEL_LOADED="hlsLevelLoaded",o.LEVEL_UPDATED="hlsLevelUpdated",o.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",o.LEVELS_UPDATED="hlsLevelsUpdated",o.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",o.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",o.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",o.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",o.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",o.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",o.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",o.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",o.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",o.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",o.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",o.CUES_PARSED="hlsCuesParsed",o.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",o.INIT_PTS_FOUND="hlsInitPtsFound",o.FRAG_LOADING="hlsFragLoading",o.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",o.FRAG_LOADED="hlsFragLoaded",o.FRAG_DECRYPTED="hlsFragDecrypted",o.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",o.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",o.FRAG_PARSING_METADATA="hlsFragParsingMetadata",o.FRAG_PARSED="hlsFragParsed",o.FRAG_BUFFERED="hlsFragBuffered",o.FRAG_CHANGED="hlsFragChanged",o.FPS_DROP="hlsFpsDrop",o.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",o.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",o.ERROR="hlsError",o.DESTROYING="hlsDestroying",o.KEY_LOADING="hlsKeyLoading",o.KEY_LOADED="hlsKeyLoaded",o.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",o.BACK_BUFFER_REACHED="hlsBackBufferReached",o.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",o}({}),ErrorTypes=function(o){return o.NETWORK_ERROR="networkError",o.MEDIA_ERROR="mediaError",o.KEY_SYSTEM_ERROR="keySystemError",o.MUX_ERROR="muxError",o.OTHER_ERROR="otherError",o}({}),ErrorDetails=function(o){return o.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",o.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",o.KEY_SYSTEM_NO_SESSION="keySystemNoSession",o.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",o.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",o.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",o.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",o.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",o.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",o.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",o.MANIFEST_LOAD_ERROR="manifestLoadError",o.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",o.MANIFEST_PARSING_ERROR="manifestParsingError",o.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",o.LEVEL_EMPTY_ERROR="levelEmptyError",o.LEVEL_LOAD_ERROR="levelLoadError",o.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",o.LEVEL_PARSING_ERROR="levelParsingError",o.LEVEL_SWITCH_ERROR="levelSwitchError",o.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",o.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",o.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",o.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",o.FRAG_LOAD_ERROR="fragLoadError",o.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",o.FRAG_DECRYPT_ERROR="fragDecryptError",o.FRAG_PARSING_ERROR="fragParsingError",o.FRAG_GAP="fragGap",o.REMUX_ALLOC_ERROR="remuxAllocError",o.KEY_LOAD_ERROR="keyLoadError",o.KEY_LOAD_TIMEOUT="keyLoadTimeOut",o.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",o.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",o.BUFFER_APPEND_ERROR="bufferAppendError",o.BUFFER_APPENDING_ERROR="bufferAppendingError",o.BUFFER_STALLED_ERROR="bufferStalledError",o.BUFFER_FULL_ERROR="bufferFullError",o.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",o.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",o.INTERNAL_EXCEPTION="internalException",o.INTERNAL_ABORTED="aborted",o.UNKNOWN="unknown",o}({});const noop=function o(){},fakeLogger={trace:noop,debug:noop,log:noop,warn:noop,info:noop,error:noop};let exportedLogger=fakeLogger;function consolePrintFn(o){const s=self.console[o];return s?s.bind(self.console,`[${o}] >`):noop}function exportLoggerFunctions(o,...s){s.forEach(function(a){exportedLogger[a]=o[a]?o[a].bind(o):consolePrintFn(a)})}function enableLogs(o,s){if(typeof console=="object"&&o===!0||typeof o=="object"){exportLoggerFunctions(o,"debug","log","info","warn","error");try{exportedLogger.log(`Debug logs enabled for "${s}" in hls.js version 1.5.11`)}catch{exportedLogger=fakeLogger}}else exportedLogger=fakeLogger}const logger=exportedLogger,DECIMAL_RESOLUTION_REGEX=/^(\d+)x(\d+)$/,ATTR_LIST_REGEX=/(.+?)=(".*?"|.*?)(?:,|$)/g;class AttrList{constructor(s){typeof s=="string"&&(s=AttrList.parseAttrList(s)),_extends(this,s)}get clientAttrs(){return Object.keys(this).filter(s=>s.substring(0,2)==="X-")}decimalInteger(s){const a=parseInt(this[s],10);return a>Number.MAX_SAFE_INTEGER?1/0:a}hexadecimalInteger(s){if(this[s]){let a=(this[s]||"0x").slice(2);a=(a.length&1?"0":"")+a;const et=new Uint8Array(a.length/2);for(let tt=0;tt<a.length/2;tt++)et[tt]=parseInt(a.slice(tt*2,tt*2+2),16);return et}else return null}hexadecimalIntegerAsNumber(s){const a=parseInt(this[s],16);return a>Number.MAX_SAFE_INTEGER?1/0:a}decimalFloatingPoint(s){return parseFloat(this[s])}optionalFloat(s,a){const et=this[s];return et?parseFloat(et):a}enumeratedString(s){return this[s]}bool(s){return this[s]==="YES"}decimalResolution(s){const a=DECIMAL_RESOLUTION_REGEX.exec(this[s]);if(a!==null)return{width:parseInt(a[1],10),height:parseInt(a[2],10)}}static parseAttrList(s){let a;const et={},tt='"';for(ATTR_LIST_REGEX.lastIndex=0;(a=ATTR_LIST_REGEX.exec(s))!==null;){let rt=a[2];rt.indexOf(tt)===0&&rt.lastIndexOf(tt)===rt.length-1&&(rt=rt.slice(1,-1));const nt=a[1].trim();et[nt]=rt}return et}}function isDateRangeCueAttribute(o){return o!=="ID"&&o!=="CLASS"&&o!=="START-DATE"&&o!=="DURATION"&&o!=="END-DATE"&&o!=="END-ON-NEXT"}function isSCTE35Attribute(o){return o==="SCTE35-OUT"||o==="SCTE35-IN"}class DateRange{constructor(s,a){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,a){const et=a.attr;for(const tt in et)if(Object.prototype.hasOwnProperty.call(s,tt)&&s[tt]!==et[tt]){logger.warn(`DATERANGE tag attribute: "${tt}" does not match for tags with ID: "${s.ID}"`),this._badValueForSameId=tt;break}s=_extends(new AttrList({}),et,s)}if(this.attr=s,this._startDate=new Date(s["START-DATE"]),"END-DATE"in this.attr){const et=new Date(this.attr["END-DATE"]);isFiniteNumber(et.getTime())&&(this._endDate=et)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const s=this.duration;return s!==null?new Date(this._startDate.getTime()+s*1e3):null}get duration(){if("DURATION"in this.attr){const s=this.attr.decimalFloatingPoint("DURATION");if(isFiniteNumber(s))return s}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&isFiniteNumber(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class LoadStats{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var ElementaryStreamTypes={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class BaseSegment{constructor(s){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[ElementaryStreamTypes.AUDIO]:null,[ElementaryStreamTypes.VIDEO]:null,[ElementaryStreamTypes.AUDIOVIDEO]:null},this.baseurl=s}setByteRange(s,a){const et=s.split("@",2);let tt;et.length===1?tt=a?.byteRangeEndOffset||0:tt=parseInt(et[1]),this._byteRange=[tt,parseInt(et[0])+tt]}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=urlToolkitExports.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(s){this._url=s}}class Fragment extends BaseSegment{constructor(s,a){super(a),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new LoadStats,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=s}get decryptdata(){const{levelkeys:s}=this;if(!s&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const a=this.levelkeys.identity;if(a)this._decryptdata=a.getDecryptData(this.sn);else{const et=Object.keys(this.levelkeys);if(et.length===1)return this._decryptdata=this.levelkeys[et[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null||!isFiniteNumber(this.programDateTime))return null;const s=isFiniteNumber(this.duration)?this.duration:0;return this.programDateTime+s*1e3}get encrypted(){var s;if((s=this._decryptdata)!=null&&s.encrypted)return!0;if(this.levelkeys){const a=Object.keys(this.levelkeys),et=a.length;if(et>1||et===1&&this.levelkeys[a[0]].encrypted)return!0}return!1}setKeyFormat(s){if(this.levelkeys){const a=this.levelkeys[s];a&&!this._decryptdata&&(this._decryptdata=a.getDecryptData(this.sn))}}abortRequests(){var s,a;(s=this.loader)==null||s.abort(),(a=this.keyLoader)==null||a.abort()}setElementaryStreamInfo(s,a,et,tt,rt,nt=!1){const{elementaryStreams:it}=this,st=it[s];if(!st){it[s]={startPTS:a,endPTS:et,startDTS:tt,endDTS:rt,partial:nt};return}st.startPTS=Math.min(st.startPTS,a),st.endPTS=Math.max(st.endPTS,et),st.startDTS=Math.min(st.startDTS,tt),st.endDTS=Math.max(st.endDTS,rt)}clearElementaryStreamInfo(){const{elementaryStreams:s}=this;s[ElementaryStreamTypes.AUDIO]=null,s[ElementaryStreamTypes.VIDEO]=null,s[ElementaryStreamTypes.AUDIOVIDEO]=null}}class Part extends BaseSegment{constructor(s,a,et,tt,rt){super(et),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new LoadStats,this.duration=s.decimalFloatingPoint("DURATION"),this.gap=s.bool("GAP"),this.independent=s.bool("INDEPENDENT"),this.relurl=s.enumeratedString("URI"),this.fragment=a,this.index=tt;const nt=s.enumeratedString("BYTERANGE");nt&&this.setByteRange(nt,rt),rt&&(this.fragOffset=rt.fragOffset+rt.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:s}=this;return!!(s.audio||s.video||s.audiovideo)}}const DEFAULT_TARGET_DURATION=10;class LevelDetails{constructor(s){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=s}reloaded(s){if(!s){this.advanced=!0,this.updated=!0;return}const a=this.lastPartSn-s.lastPartSn,et=this.lastPartIndex-s.lastPartIndex;this.updated=this.endSN!==s.endSN||!!et||!!a||!this.live,this.advanced=this.endSN>s.endSN||a>0||a===0&&et>0,this.updated||this.advanced?this.misses=Math.floor(s.misses*.6):this.misses=s.misses+1,this.availabilityDelay=s.availabilityDelay}get hasProgramDateTime(){return this.fragments.length?isFiniteNumber(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||DEFAULT_TARGET_DURATION}get drift(){const s=this.driftEndTime-this.driftStartTime;return s>0?(this.driftEnd-this.driftStart)*1e3/s:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var s;return(s=this.partList)!=null&&s.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var s;return(s=this.fragments)!=null&&s.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var s;return(s=this.partList)!=null&&s.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var s;return(s=this.partList)!=null&&s.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function base64Decode(o){return Uint8Array.from(atob(o),s=>s.charCodeAt(0))}function getKeyIdBytes(o){const s=strToUtf8array(o).subarray(0,16),a=new Uint8Array(16);return a.set(s,16-s.length),a}function changeEndianness(o){const s=function(et,tt,rt){const nt=et[tt];et[tt]=et[rt],et[rt]=nt};s(o,0,3),s(o,1,2),s(o,4,5),s(o,6,7)}function convertDataUriToArrayBytes(o){const s=o.split(":");let a=null;if(s[0]==="data"&&s.length===2){const et=s[1].split(";"),tt=et[et.length-1].split(",");if(tt.length===2){const rt=tt[0]==="base64",nt=tt[1];rt?(et.splice(-1,1),a=base64Decode(nt)):a=getKeyIdBytes(nt)}}return a}function strToUtf8array(o){return Uint8Array.from(unescape(encodeURIComponent(o)),s=>s.charCodeAt(0))}const optionalSelf=typeof self<"u"?self:void 0;var KeySystems={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},KeySystemFormats={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function keySystemFormatToKeySystemDomain(o){switch(o){case KeySystemFormats.FAIRPLAY:return KeySystems.FAIRPLAY;case KeySystemFormats.PLAYREADY:return KeySystems.PLAYREADY;case KeySystemFormats.WIDEVINE:return KeySystems.WIDEVINE;case KeySystemFormats.CLEARKEY:return KeySystems.CLEARKEY}}var KeySystemIds={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function keySystemIdToKeySystemDomain(o){if(o===KeySystemIds.WIDEVINE)return KeySystems.WIDEVINE}function keySystemDomainToKeySystemFormat(o){switch(o){case KeySystems.FAIRPLAY:return KeySystemFormats.FAIRPLAY;case KeySystems.PLAYREADY:return KeySystemFormats.PLAYREADY;case KeySystems.WIDEVINE:return KeySystemFormats.WIDEVINE;case KeySystems.CLEARKEY:return KeySystemFormats.CLEARKEY}}function getKeySystemsForConfig(o){const{drmSystems:s,widevineLicenseUrl:a}=o,et=s?[KeySystems.FAIRPLAY,KeySystems.WIDEVINE,KeySystems.PLAYREADY,KeySystems.CLEARKEY].filter(tt=>!!s[tt]):[];return!et[KeySystems.WIDEVINE]&&a&&et.push(KeySystems.WIDEVINE),et}const requestMediaKeySystemAccess=function(o){return optionalSelf!=null&&(o=optionalSelf.navigator)!=null&&o.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function getSupportedMediaKeySystemConfigurations(o,s,a,et){let tt;switch(o){case KeySystems.FAIRPLAY:tt=["cenc","sinf"];break;case KeySystems.WIDEVINE:case KeySystems.PLAYREADY:tt=["cenc"];break;case KeySystems.CLEARKEY:tt=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${o}`)}return createMediaKeySystemConfigurations(tt,s,a,et)}function createMediaKeySystemConfigurations(o,s,a,et){return[{initDataTypes:o,persistentState:et.persistentState||"optional",distinctiveIdentifier:et.distinctiveIdentifier||"optional",sessionTypes:et.sessionTypes||[et.sessionType||"temporary"],audioCapabilities:s.map(rt=>({contentType:`audio/mp4; codecs="${rt}"`,robustness:et.audioRobustness||"",encryptionScheme:et.audioEncryptionScheme||null})),videoCapabilities:a.map(rt=>({contentType:`video/mp4; codecs="${rt}"`,robustness:et.videoRobustness||"",encryptionScheme:et.videoEncryptionScheme||null}))}]}function sliceUint8(o,s,a){return Uint8Array.prototype.slice?o.slice(s,a):new Uint8Array(Array.prototype.slice.call(o,s,a))}const isHeader$2=(o,s)=>s+10<=o.length&&o[s]===73&&o[s+1]===68&&o[s+2]===51&&o[s+3]<255&&o[s+4]<255&&o[s+6]<128&&o[s+7]<128&&o[s+8]<128&&o[s+9]<128,isFooter=(o,s)=>s+10<=o.length&&o[s]===51&&o[s+1]===68&&o[s+2]===73&&o[s+3]<255&&o[s+4]<255&&o[s+6]<128&&o[s+7]<128&&o[s+8]<128&&o[s+9]<128,getID3Data=(o,s)=>{const a=s;let et=0;for(;isHeader$2(o,s);){et+=10;const tt=readSize(o,s+6);et+=tt,isFooter(o,s+10)&&(et+=10),s+=et}if(et>0)return o.subarray(a,a+et)},readSize=(o,s)=>{let a=0;return a=(o[s]&127)<<21,a|=(o[s+1]&127)<<14,a|=(o[s+2]&127)<<7,a|=o[s+3]&127,a},canParse$2=(o,s)=>isHeader$2(o,s)&&readSize(o,s+6)+10<=o.length-s,getTimeStamp=o=>{const s=getID3Frames(o);for(let a=0;a<s.length;a++){const et=s[a];if(isTimeStampFrame(et))return readTimeStamp(et)}},isTimeStampFrame=o=>o&&o.key==="PRIV"&&o.info==="com.apple.streaming.transportStreamTimestamp",getFrameData=o=>{const s=String.fromCharCode(o[0],o[1],o[2],o[3]),a=readSize(o,4),et=10;return{type:s,size:a,data:o.subarray(et,et+a)}},getID3Frames=o=>{let s=0;const a=[];for(;isHeader$2(o,s);){const et=readSize(o,s+6);s+=10;const tt=s+et;for(;s+8<tt;){const rt=getFrameData(o.subarray(s)),nt=decodeFrame(rt);nt&&a.push(nt),s+=rt.size+10}isFooter(o,s)&&(s+=10)}return a},decodeFrame=o=>o.type==="PRIV"?decodePrivFrame(o):o.type[0]==="W"?decodeURLFrame(o):decodeTextFrame(o),decodePrivFrame=o=>{if(o.size<2)return;const s=utf8ArrayToStr(o.data,!0),a=new Uint8Array(o.data.subarray(s.length+1));return{key:o.type,info:s,data:a.buffer}},decodeTextFrame=o=>{if(o.size<2)return;if(o.type==="TXXX"){let a=1;const et=utf8ArrayToStr(o.data.subarray(a),!0);a+=et.length+1;const tt=utf8ArrayToStr(o.data.subarray(a));return{key:o.type,info:et,data:tt}}const s=utf8ArrayToStr(o.data.subarray(1));return{key:o.type,data:s}},decodeURLFrame=o=>{if(o.type==="WXXX"){if(o.size<2)return;let a=1;const et=utf8ArrayToStr(o.data.subarray(a),!0);a+=et.length+1;const tt=utf8ArrayToStr(o.data.subarray(a));return{key:o.type,info:et,data:tt}}const s=utf8ArrayToStr(o.data);return{key:o.type,data:s}},readTimeStamp=o=>{if(o.data.byteLength===8){const s=new Uint8Array(o.data),a=s[3]&1;let et=(s[4]<<23)+(s[5]<<15)+(s[6]<<7)+s[7];return et/=45,a&&(et+=4772185884e-2),Math.round(et)}},utf8ArrayToStr=(o,s=!1)=>{const a=getTextDecoder();if(a){const ot=a.decode(o);if(s){const at=ot.indexOf("\0");return at!==-1?ot.substring(0,at):ot}return ot.replace(/\0/g,"")}const et=o.length;let tt,rt,nt,it="",st=0;for(;st<et;){if(tt=o[st++],tt===0&&s)return it;if(tt===0||tt===3)continue;switch(tt>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:it+=String.fromCharCode(tt);break;case 12:case 13:rt=o[st++],it+=String.fromCharCode((tt&31)<<6|rt&63);break;case 14:rt=o[st++],nt=o[st++],it+=String.fromCharCode((tt&15)<<12|(rt&63)<<6|(nt&63)<<0);break}}return it};let decoder;function getTextDecoder(){if(!navigator.userAgent.includes("PlayStation 4"))return!decoder&&typeof self.TextDecoder<"u"&&(decoder=new self.TextDecoder("utf-8")),decoder}const Hex={hexDump:function(o){let s="";for(let a=0;a<o.length;a++){let et=o[a].toString(16);et.length<2&&(et="0"+et),s+=et}return s}},UINT32_MAX$1=Math.pow(2,32)-1,push=[].push,RemuxerTrackIdConfig={video:1,audio:2,id3:3,text:4};function bin2str(o){return String.fromCharCode.apply(null,o)}function readUint16(o,s){const a=o[s]<<8|o[s+1];return a<0?65536+a:a}function readUint32(o,s){const a=readSint32(o,s);return a<0?4294967296+a:a}function readUint64(o,s){let a=readUint32(o,s);return a*=Math.pow(2,32),a+=readUint32(o,s+4),a}function readSint32(o,s){return o[s]<<24|o[s+1]<<16|o[s+2]<<8|o[s+3]}function writeUint32(o,s,a){o[s]=a>>24,o[s+1]=a>>16&255,o[s+2]=a>>8&255,o[s+3]=a&255}function hasMoofData(o){const s=o.byteLength;for(let a=0;a<s;){const et=readUint32(o,a);if(et>8&&o[a+4]===109&&o[a+5]===111&&o[a+6]===111&&o[a+7]===102)return!0;a=et>1?a+et:s}return!1}function findBox(o,s){const a=[];if(!s.length)return a;const et=o.byteLength;for(let tt=0;tt<et;){const rt=readUint32(o,tt),nt=bin2str(o.subarray(tt+4,tt+8)),it=rt>1?tt+rt:et;if(nt===s[0])if(s.length===1)a.push(o.subarray(tt+8,it));else{const st=findBox(o.subarray(tt+8,it),s.slice(1));st.length&&push.apply(a,st)}tt=it}return a}function parseSegmentIndex(o){const s=[],a=o[0];let et=8;const tt=readUint32(o,et);et+=4;let rt=0,nt=0;a===0?(rt=readUint32(o,et),nt=readUint32(o,et+4),et+=8):(rt=readUint64(o,et),nt=readUint64(o,et+8),et+=16),et+=2;let it=o.length+nt;const st=readUint16(o,et);et+=2;for(let ot=0;ot<st;ot++){let at=et;const lt=readUint32(o,at);at+=4;const ct=lt&2147483647;if((lt&2147483648)>>>31===1)return logger.warn("SIDX has hierarchical references (not supported)"),null;const ft=readUint32(o,at);at+=4,s.push({referenceSize:ct,subsegmentDuration:ft,info:{duration:ft/tt,start:it,end:it+ct-1}}),it+=ct,at+=4,et=at}return{earliestPresentationTime:rt,timescale:tt,version:a,referencesCount:st,references:s}}function parseInitSegment(o){const s=[],a=findBox(o,["moov","trak"]);for(let tt=0;tt<a.length;tt++){const rt=a[tt],nt=findBox(rt,["tkhd"])[0];if(nt){let it=nt[0];const st=readUint32(nt,it===0?12:20),ot=findBox(rt,["mdia","mdhd"])[0];if(ot){it=ot[0];const at=readUint32(ot,it===0?12:20),lt=findBox(rt,["mdia","hdlr"])[0];if(lt){const ct=bin2str(lt.subarray(8,12)),ht={soun:ElementaryStreamTypes.AUDIO,vide:ElementaryStreamTypes.VIDEO}[ct];if(ht){const ft=findBox(rt,["mdia","minf","stbl","stsd"])[0],dt=parseStsd(ft);s[st]={timescale:at,type:ht},s[ht]=_objectSpread2({timescale:at,id:st},dt)}}}}}return findBox(o,["moov","mvex","trex"]).forEach(tt=>{const rt=readUint32(tt,4),nt=s[rt];nt&&(nt.default={duration:readUint32(tt,12),flags:readUint32(tt,20)})}),s}function parseStsd(o){const s=o.subarray(8),a=s.subarray(86),et=bin2str(s.subarray(4,8));let tt=et;const rt=et==="enca"||et==="encv";if(rt){const it=findBox(s,[et])[0].subarray(et==="enca"?28:78);findBox(it,["sinf"]).forEach(ot=>{const at=findBox(ot,["schm"])[0];if(at){const lt=bin2str(at.subarray(4,8));if(lt==="cbcs"||lt==="cenc"){const ct=findBox(ot,["frma"])[0];ct&&(tt=bin2str(ct))}}})}switch(tt){case"avc1":case"avc2":case"avc3":case"avc4":{const nt=findBox(a,["avcC"])[0];tt+="."+toHex(nt[1])+toHex(nt[2])+toHex(nt[3]);break}case"mp4a":{const nt=findBox(s,[et])[0],it=findBox(nt.subarray(28),["esds"])[0];if(it&&it.length>12){let st=4;if(it[st++]!==3)break;st=skipBERInteger(it,st),st+=2;const ot=it[st++];if(ot&128&&(st+=2),ot&64&&(st+=it[st++]),it[st++]!==4)break;st=skipBERInteger(it,st);const at=it[st++];if(at===64)tt+="."+toHex(at);else break;if(st+=12,it[st++]!==5)break;st=skipBERInteger(it,st);const lt=it[st++];let ct=(lt&248)>>3;ct===31&&(ct+=1+((lt&7)<<3)+((it[st]&224)>>5)),tt+="."+ct}break}case"hvc1":case"hev1":{const nt=findBox(a,["hvcC"])[0],it=nt[1],st=["","A","B","C"][it>>6],ot=it&31,at=readUint32(nt,2),lt=(it&32)>>5?"H":"L",ct=nt[12],ht=nt.subarray(6,12);tt+="."+st+ot,tt+="."+at.toString(16).toUpperCase(),tt+="."+lt+ct;let ft="";for(let dt=ht.length;dt--;){const pt=ht[dt];(pt||ft)&&(ft="."+pt.toString(16).toUpperCase()+ft)}tt+=ft;break}case"dvh1":case"dvhe":{const nt=findBox(a,["dvcC"])[0],it=nt[2]>>1&127,st=nt[2]<<5&32|nt[3]>>3&31;tt+="."+addLeadingZero(it)+"."+addLeadingZero(st);break}case"vp09":{const nt=findBox(a,["vpcC"])[0],it=nt[4],st=nt[5],ot=nt[6]>>4&15;tt+="."+addLeadingZero(it)+"."+addLeadingZero(st)+"."+addLeadingZero(ot);break}case"av01":{const nt=findBox(a,["av1C"])[0],it=nt[1]>>>5,st=nt[1]&31,ot=nt[2]>>>7?"H":"M",at=(nt[2]&64)>>6,lt=(nt[2]&32)>>5,ct=it===2&&at?lt?12:10:at?10:8,ht=(nt[2]&16)>>4,ft=(nt[2]&8)>>3,dt=(nt[2]&4)>>2,pt=nt[2]&3;tt+="."+it+"."+addLeadingZero(st)+ot+"."+addLeadingZero(ct)+"."+ht+"."+ft+dt+pt+"."+addLeadingZero(1)+"."+addLeadingZero(1)+"."+addLeadingZero(1)+"."+0;break}}return{codec:tt,encrypted:rt}}function skipBERInteger(o,s){const a=s+5;for(;o[s++]&128&&s<a;);return s}function toHex(o){return("0"+o.toString(16).toUpperCase()).slice(-2)}function addLeadingZero(o){return(o<10?"0":"")+o}function patchEncyptionData(o,s){if(!o||!s)return o;const a=s.keyId;return a&&s.isCommonEncryption&&findBox(o,["moov","trak"]).forEach(tt=>{const nt=findBox(tt,["mdia","minf","stbl","stsd"])[0].subarray(8);let it=findBox(nt,["enca"]);const st=it.length>0;st||(it=findBox(nt,["encv"])),it.forEach(ot=>{const at=st?ot.subarray(28):ot.subarray(78);findBox(at,["sinf"]).forEach(ct=>{const ht=parseSinf(ct);if(ht){const ft=ht.subarray(8,24);ft.some(dt=>dt!==0)||(logger.log(`[eme] Patching keyId in 'enc${st?"a":"v"}>sinf>>tenc' box: ${Hex.hexDump(ft)} -> ${Hex.hexDump(a)}`),ht.set(a,8))}})})}),o}function parseSinf(o){const s=findBox(o,["schm"])[0];if(s){const a=bin2str(s.subarray(4,8));if(a==="cbcs"||a==="cenc")return findBox(o,["schi","tenc"])[0]}return logger.error("[eme] missing 'schm' box"),null}function getStartDTS(o,s){return findBox(s,["moof","traf"]).reduce((a,et)=>{const tt=findBox(et,["tfdt"])[0],rt=tt[0],nt=findBox(et,["tfhd"]).reduce((it,st)=>{const ot=readUint32(st,4),at=o[ot];if(at){let lt=readUint32(tt,4);if(rt===1){if(lt===UINT32_MAX$1)return logger.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),it;lt*=UINT32_MAX$1+1,lt+=readUint32(tt,8)}const ct=at.timescale||9e4,ht=lt/ct;if(isFiniteNumber(ht)&&(it===null||ht<it))return ht}return it},null);return nt!==null&&isFiniteNumber(nt)&&(a===null||nt<a)?nt:a},null)}function getDuration(o,s){let a=0,et=0,tt=0;const rt=findBox(o,["moof","traf"]);for(let nt=0;nt<rt.length;nt++){const it=rt[nt],st=findBox(it,["tfhd"])[0],ot=readUint32(st,4),at=s[ot];if(!at)continue;const lt=at.default,ct=readUint32(st,0)|lt?.flags;let ht=lt?.duration;ct&8&&(ct&2?ht=readUint32(st,12):ht=readUint32(st,8));const ft=at.timescale||9e4,dt=findBox(it,["trun"]);for(let pt=0;pt<dt.length;pt++){if(a=computeRawDurationFromSamples(dt[pt]),!a&&ht){const gt=readUint32(dt[pt],4);a=ht*gt}at.type===ElementaryStreamTypes.VIDEO?et+=a/ft:at.type===ElementaryStreamTypes.AUDIO&&(tt+=a/ft)}}if(et===0&&tt===0){let nt=1/0,it=0,st=0;const ot=findBox(o,["sidx"]);for(let at=0;at<ot.length;at++){const lt=parseSegmentIndex(ot[at]);if(lt!=null&&lt.references){nt=Math.min(nt,lt.earliestPresentationTime/lt.timescale);const ct=lt.references.reduce((ht,ft)=>ht+ft.info.duration||0,0);it=Math.max(it,ct+lt.earliestPresentationTime/lt.timescale),st=it-nt}}if(st&&isFiniteNumber(st))return st}return et||tt}function computeRawDurationFromSamples(o){const s=readUint32(o,0);let a=8;s&1&&(a+=4),s&4&&(a+=4);let et=0;const tt=readUint32(o,4);for(let rt=0;rt<tt;rt++){if(s&256){const nt=readUint32(o,a);et+=nt,a+=4}s&512&&(a+=4),s&1024&&(a+=4),s&2048&&(a+=4)}return et}function offsetStartDTS(o,s,a){findBox(s,["moof","traf"]).forEach(et=>{findBox(et,["tfhd"]).forEach(tt=>{const rt=readUint32(tt,4),nt=o[rt];if(!nt)return;const it=nt.timescale||9e4;findBox(et,["tfdt"]).forEach(st=>{const ot=st[0],at=a*it;if(at){let lt=readUint32(st,4);if(ot===0)lt-=at,lt=Math.max(lt,0),writeUint32(st,4,lt);else{lt*=Math.pow(2,32),lt+=readUint32(st,8),lt-=at,lt=Math.max(lt,0);const ct=Math.floor(lt/(UINT32_MAX$1+1)),ht=Math.floor(lt%(UINT32_MAX$1+1));writeUint32(st,4,ct),writeUint32(st,8,ht)}}})})})}function segmentValidRange(o){const s={valid:null,remainder:null},a=findBox(o,["moof"]);if(a.length<2)return s.remainder=o,s;const et=a[a.length-1];return s.valid=sliceUint8(o,0,et.byteOffset-8),s.remainder=sliceUint8(o,et.byteOffset-8),s}function appendUint8Array(o,s){const a=new Uint8Array(o.length+s.length);return a.set(o),a.set(s,o.length),a}function parseSamples(o,s){const a=[],et=s.samples,tt=s.timescale,rt=s.id;let nt=!1;return findBox(et,["moof"]).map(st=>{const ot=st.byteOffset-8;findBox(st,["traf"]).map(lt=>{const ct=findBox(lt,["tfdt"]).map(ht=>{const ft=ht[0];let dt=readUint32(ht,4);return ft===1&&(dt*=Math.pow(2,32),dt+=readUint32(ht,8)),dt/tt})[0];return ct!==void 0&&(o=ct),findBox(lt,["tfhd"]).map(ht=>{const ft=readUint32(ht,4),dt=readUint32(ht,0)&16777215,pt=(dt&1)!==0,gt=(dt&2)!==0,mt=(dt&8)!==0;let yt=0;const vt=(dt&16)!==0;let Et=0;const xt=(dt&32)!==0;let wt=8;ft===rt&&(pt&&(wt+=8),gt&&(wt+=4),mt&&(yt=readUint32(ht,wt),wt+=4),vt&&(Et=readUint32(ht,wt),wt+=4),xt&&(wt+=4),s.type==="video"&&(nt=isHEVC(s.codec)),findBox(lt,["trun"]).map(Rt=>{const Ct=Rt[0],Ft=readUint32(Rt,0)&16777215,zt=(Ft&1)!==0;let Nt=0;const Kt=(Ft&4)!==0,Yt=(Ft&256)!==0;let Bt=0;const Pt=(Ft&512)!==0;let Dt=0;const Tt=(Ft&1024)!==0,St=(Ft&2048)!==0;let Mt=0;const jt=readUint32(Rt,4);let Gt=8;zt&&(Nt=readUint32(Rt,Gt),Gt+=4),Kt&&(Gt+=4);let Ht=Nt+ot;for(let At=0;At<jt;At++){if(Yt?(Bt=readUint32(Rt,Gt),Gt+=4):Bt=yt,Pt?(Dt=readUint32(Rt,Gt),Gt+=4):Dt=Et,Tt&&(Gt+=4),St&&(Ct===0?Mt=readUint32(Rt,Gt):Mt=readSint32(Rt,Gt),Gt+=4),s.type===ElementaryStreamTypes.VIDEO){let $t=0;for(;$t<Dt;){const kt=readUint32(et,Ht);if(Ht+=4,isSEIMessage(nt,et[Ht])){const Lt=et.subarray(Ht,Ht+kt);parseSEIMessageFromNALu(Lt,nt?2:1,o+Mt/tt,a)}Ht+=kt,$t+=kt+4}}o+=Bt/tt}}))})})}),a}function isHEVC(o){if(!o)return!1;const s=o.indexOf("."),a=s<0?o:o.substring(0,s);return a==="hvc1"||a==="hev1"||a==="dvh1"||a==="dvhe"}function isSEIMessage(o,s){if(o){const a=s>>1&63;return a===39||a===40}else return(s&31)===6}function parseSEIMessageFromNALu(o,s,a,et){const tt=discardEPB(o);let rt=0;rt+=s;let nt=0,it=0,st=0;for(;rt<tt.length;){nt=0;do{if(rt>=tt.length)break;st=tt[rt++],nt+=st}while(st===255);it=0;do{if(rt>=tt.length)break;st=tt[rt++],it+=st}while(st===255);const ot=tt.length-rt;let at=rt;if(it<ot)rt+=it;else if(it>ot){logger.error(`Malformed SEI payload. ${it} is too small, only ${ot} bytes left to parse.`);break}if(nt===4){if(tt[at++]===181){const ct=readUint16(tt,at);if(at+=2,ct===49){const ht=readUint32(tt,at);if(at+=4,ht===1195456820){const ft=tt[at++];if(ft===3){const dt=tt[at++],pt=31&dt,gt=64&dt,mt=gt?2+pt*3:0,yt=new Uint8Array(mt);if(gt){yt[0]=dt;for(let vt=1;vt<mt;vt++)yt[vt]=tt[at++]}et.push({type:ft,payloadType:nt,pts:a,bytes:yt})}}}}}else if(nt===5&&it>16){const lt=[];for(let ft=0;ft<16;ft++){const dt=tt[at++].toString(16);lt.push(dt.length==1?"0"+dt:dt),(ft===3||ft===5||ft===7||ft===9)&&lt.push("-")}const ct=it-16,ht=new Uint8Array(ct);for(let ft=0;ft<ct;ft++)ht[ft]=tt[at++];et.push({payloadType:nt,pts:a,uuid:lt.join(""),userData:utf8ArrayToStr(ht),userDataBytes:ht})}}}function discardEPB(o){const s=o.byteLength,a=[];let et=1;for(;et<s-2;)o[et]===0&&o[et+1]===0&&o[et+2]===3?(a.push(et+2),et+=2):et++;if(a.length===0)return o;const tt=s-a.length,rt=new Uint8Array(tt);let nt=0;for(et=0;et<tt;nt++,et++)nt===a[0]&&(nt++,a.shift()),rt[et]=o[nt];return rt}function parseEmsg(o){const s=o[0];let a="",et="",tt=0,rt=0,nt=0,it=0,st=0,ot=0;if(s===0){for(;bin2str(o.subarray(ot,ot+1))!=="\0";)a+=bin2str(o.subarray(ot,ot+1)),ot+=1;for(a+=bin2str(o.subarray(ot,ot+1)),ot+=1;bin2str(o.subarray(ot,ot+1))!=="\0";)et+=bin2str(o.subarray(ot,ot+1)),ot+=1;et+=bin2str(o.subarray(ot,ot+1)),ot+=1,tt=readUint32(o,12),rt=readUint32(o,16),it=readUint32(o,20),st=readUint32(o,24),ot=28}else if(s===1){ot+=4,tt=readUint32(o,ot),ot+=4;const lt=readUint32(o,ot);ot+=4;const ct=readUint32(o,ot);for(ot+=4,nt=2**32*lt+ct,isSafeInteger(nt)||(nt=Number.MAX_SAFE_INTEGER,logger.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),it=readUint32(o,ot),ot+=4,st=readUint32(o,ot),ot+=4;bin2str(o.subarray(ot,ot+1))!=="\0";)a+=bin2str(o.subarray(ot,ot+1)),ot+=1;for(a+=bin2str(o.subarray(ot,ot+1)),ot+=1;bin2str(o.subarray(ot,ot+1))!=="\0";)et+=bin2str(o.subarray(ot,ot+1)),ot+=1;et+=bin2str(o.subarray(ot,ot+1)),ot+=1}const at=o.subarray(ot,o.byteLength);return{schemeIdUri:a,value:et,timeScale:tt,presentationTime:nt,presentationTimeDelta:rt,eventDuration:it,id:st,payload:at}}function mp4Box(o,...s){const a=s.length;let et=8,tt=a;for(;tt--;)et+=s[tt].byteLength;const rt=new Uint8Array(et);for(rt[0]=et>>24&255,rt[1]=et>>16&255,rt[2]=et>>8&255,rt[3]=et&255,rt.set(o,4),tt=0,et=8;tt<a;tt++)rt.set(s[tt],et),et+=s[tt].byteLength;return rt}function mp4pssh(o,s,a){if(o.byteLength!==16)throw new RangeError("Invalid system id");let et,tt;et=0,tt=new Uint8Array;let rt;et>0?(rt=new Uint8Array(4),s.length>0&&new DataView(rt.buffer).setUint32(0,s.length,!1)):rt=new Uint8Array;const nt=new Uint8Array(4);return a&&a.byteLength>0&&new DataView(nt.buffer).setUint32(0,a.byteLength,!1),mp4Box([112,115,115,104],new Uint8Array([et,0,0,0]),o,rt,tt,nt,a||new Uint8Array)}function parsePssh(o){if(!(o instanceof ArrayBuffer)||o.byteLength<32)return null;const s={version:0,systemId:"",kids:null,data:null},a=new DataView(o),et=a.getUint32(0);if(o.byteLength!==et&&et>44||a.getUint32(4)!==1886614376||(s.version=a.getUint32(8)>>>24,s.version>1))return null;s.systemId=Hex.hexDump(new Uint8Array(o,12,16));const rt=a.getUint32(28);if(s.version===0){if(et-32<rt)return null;s.data=new Uint8Array(o,32,rt)}else if(s.version===1){s.kids=[];for(let nt=0;nt<rt;nt++)s.kids.push(new Uint8Array(o,32+nt*16,16))}return s}let keyUriToKeyIdMap={};class LevelKey{static clearKeyUriToKeyIdMap(){keyUriToKeyIdMap={}}constructor(s,a,et,tt=[1],rt=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=s,this.uri=a,this.keyFormat=et,this.keyFormatVersions=tt,this.iv=rt,this.encrypted=s?s!=="NONE":!1,this.isCommonEncryption=this.encrypted&&s!=="AES-128"}isSupported(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case KeySystemFormats.FAIRPLAY:case KeySystemFormats.WIDEVINE:case KeySystemFormats.PLAYREADY:case KeySystemFormats.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(s){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof s!="number"&&(this.method==="AES-128"&&!this.iv&&logger.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),s=0);const et=createInitializationVector(s);return new LevelKey(this.method,this.uri,"identity",this.keyFormatVersions,et)}const a=convertDataUriToArrayBytes(this.uri);if(a)switch(this.keyFormat){case KeySystemFormats.WIDEVINE:this.pssh=a,a.length>=22&&(this.keyId=a.subarray(a.length-22,a.length-6));break;case KeySystemFormats.PLAYREADY:{const et=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=mp4pssh(et,null,a);const tt=new Uint16Array(a.buffer,a.byteOffset,a.byteLength/2),rt=String.fromCharCode.apply(null,Array.from(tt)),nt=rt.substring(rt.indexOf("<"),rt.length),ot=new DOMParser().parseFromString(nt,"text/xml").getElementsByTagName("KID")[0];if(ot){const at=ot.childNodes[0]?ot.childNodes[0].nodeValue:ot.getAttribute("VALUE");if(at){const lt=base64Decode(at).subarray(0,16);changeEndianness(lt),this.keyId=lt}}break}default:{let et=a.subarray(0,16);if(et.length!==16){const tt=new Uint8Array(16);tt.set(et,16-et.length),et=tt}this.keyId=et;break}}if(!this.keyId||this.keyId.byteLength!==16){let et=keyUriToKeyIdMap[this.uri];if(!et){const tt=Object.keys(keyUriToKeyIdMap).length%Number.MAX_SAFE_INTEGER;et=new Uint8Array(16),new DataView(et.buffer,12,4).setUint32(0,tt),keyUriToKeyIdMap[this.uri]=et}this.keyId=et}return this}}function createInitializationVector(o){const s=new Uint8Array(16);for(let a=12;a<16;a++)s[a]=o>>8*(15-a)&255;return s}const VARIABLE_REPLACEMENT_REGEX=/\{\$([a-zA-Z0-9-_]+)\}/g;function hasVariableReferences(o){return VARIABLE_REPLACEMENT_REGEX.test(o)}function substituteVariablesInAttributes(o,s,a){if(o.variableList!==null||o.hasVariableRefs)for(let et=a.length;et--;){const tt=a[et],rt=s[tt];rt&&(s[tt]=substituteVariables(o,rt))}}function substituteVariables(o,s){if(o.variableList!==null||o.hasVariableRefs){const a=o.variableList;return s.replace(VARIABLE_REPLACEMENT_REGEX,et=>{const tt=et.substring(2,et.length-1),rt=a?.[tt];return rt===void 0?(o.playlistParsingError||(o.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${tt}"`)),et):rt})}return s}function addVariableDefinition(o,s,a){let et=o.variableList;et||(o.variableList=et={});let tt,rt;if("QUERYPARAM"in s){tt=s.QUERYPARAM;try{const nt=new self.URL(a).searchParams;if(nt.has(tt))rt=nt.get(tt);else throw new Error(`"${tt}" does not match any query parameter in URI: "${a}"`)}catch(nt){o.playlistParsingError||(o.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${nt.message}`))}}else tt=s.NAME,rt=s.VALUE;tt in et?o.playlistParsingError||(o.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${tt}"`)):et[tt]=rt||""}function importVariableDefinition(o,s,a){const et=s.IMPORT;if(a&&et in a){let tt=o.variableList;tt||(o.variableList=tt={}),tt[et]=a[et]}else o.playlistParsingError||(o.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${et}"`))}function getMediaSource(o=!0){return typeof self>"u"?void 0:(o||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function isManagedMediaSource(o){return typeof self<"u"&&o===self.ManagedMediaSource}const sampleEntryCodesISO={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function isCodecType(o,s){const a=sampleEntryCodesISO[s];return!!a&&!!a[o.slice(0,4)]}function areCodecsMediaSourceSupported(o,s,a=!0){return!o.split(",").some(et=>!isCodecMediaSourceSupported(et,s,a))}function isCodecMediaSourceSupported(o,s,a=!0){var et;const tt=getMediaSource(a);return(et=tt?.isTypeSupported(mimeTypeForCodec(o,s)))!=null?et:!1}function mimeTypeForCodec(o,s){return`${s}/mp4;codecs="${o}"`}function videoCodecPreferenceValue(o){if(o){const s=o.substring(0,4);return sampleEntryCodesISO.video[s]}return 2}function codecsSetSelectionPreferenceValue(o){return o.split(",").reduce((s,a)=>{const et=sampleEntryCodesISO.video[a];return et?(et*2+s)/(s?3:2):(sampleEntryCodesISO.audio[a]+s)/(s?2:1)},0)}const CODEC_COMPATIBLE_NAMES={};function getCodecCompatibleNameLower(o,s=!0){if(CODEC_COMPATIBLE_NAMES[o])return CODEC_COMPATIBLE_NAMES[o];const a={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[o];for(let et=0;et<a.length;et++)if(isCodecMediaSourceSupported(a[et],"audio",s))return CODEC_COMPATIBLE_NAMES[o]=a[et],a[et];return o}const AUDIO_CODEC_REGEXP=/flac|opus/i;function getCodecCompatibleName(o,s=!0){return o.replace(AUDIO_CODEC_REGEXP,a=>getCodecCompatibleNameLower(a.toLowerCase(),s))}function pickMostCompleteCodecName(o,s){return o&&o!=="mp4a"?o:s&&s.split(",")[0]}function convertAVC1ToAVCOTI(o){const s=o.split(".");if(s.length>2){let a=s.shift()+".";return a+=parseInt(s.shift()).toString(16),a+=("000"+parseInt(s.shift()).toString(16)).slice(-4),a}return o}const MASTER_PLAYLIST_REGEX=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,MASTER_PLAYLIST_MEDIA_REGEX=/#EXT-X-MEDIA:(.*)/g,IS_MEDIA_PLAYLIST=/^#EXT(?:INF|-X-TARGETDURATION):/m,LEVEL_PLAYLIST_REGEX_FAST=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),LEVEL_PLAYLIST_REGEX_SLOW=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class M3U8Parser{static findGroup(s,a){for(let et=0;et<s.length;et++){const tt=s[et];if(tt.id===a)return tt}}static resolve(s,a){return urlToolkitExports.buildAbsoluteURL(a,s,{alwaysNormalize:!0})}static isMediaPlaylist(s){return IS_MEDIA_PLAYLIST.test(s)}static parseMasterPlaylist(s,a){const et=hasVariableReferences(s),tt={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:et},rt=[];MASTER_PLAYLIST_REGEX.lastIndex=0;let nt;for(;(nt=MASTER_PLAYLIST_REGEX.exec(s))!=null;)if(nt[1]){var it;const ot=new AttrList(nt[1]);substituteVariablesInAttributes(tt,ot,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const at=substituteVariables(tt,nt[2]),lt={attrs:ot,bitrate:ot.decimalInteger("BANDWIDTH")||ot.decimalInteger("AVERAGE-BANDWIDTH"),name:ot.NAME,url:M3U8Parser.resolve(at,a)},ct=ot.decimalResolution("RESOLUTION");ct&&(lt.width=ct.width,lt.height=ct.height),setCodecs(ot.CODECS,lt),(it=lt.unknownCodecs)!=null&&it.length||rt.push(lt),tt.levels.push(lt)}else if(nt[3]){const ot=nt[3],at=nt[4];switch(ot){case"SESSION-DATA":{const lt=new AttrList(at);substituteVariablesInAttributes(tt,lt,["DATA-ID","LANGUAGE","VALUE","URI"]);const ct=lt["DATA-ID"];ct&&(tt.sessionData===null&&(tt.sessionData={}),tt.sessionData[ct]=lt);break}case"SESSION-KEY":{const lt=parseKey(at,a,tt);lt.encrypted&&lt.isSupported()?(tt.sessionKeys===null&&(tt.sessionKeys=[]),tt.sessionKeys.push(lt)):logger.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${at}"`);break}case"DEFINE":{{const lt=new AttrList(at);substituteVariablesInAttributes(tt,lt,["NAME","VALUE","QUERYPARAM"]),addVariableDefinition(tt,lt,a)}break}case"CONTENT-STEERING":{const lt=new AttrList(at);substituteVariablesInAttributes(tt,lt,["SERVER-URI","PATHWAY-ID"]),tt.contentSteering={uri:M3U8Parser.resolve(lt["SERVER-URI"],a),pathwayId:lt["PATHWAY-ID"]||"."};break}case"START":{tt.startTimeOffset=parseStartTimeOffset(at);break}}}const st=rt.length>0&&rt.length<tt.levels.length;return tt.levels=st?rt:tt.levels,tt.levels.length===0&&(tt.playlistParsingError=new Error("no levels found in manifest")),tt}static parseMasterPlaylistMedia(s,a,et){let tt;const rt={},nt=et.levels,it={AUDIO:nt.map(ot=>({id:ot.attrs.AUDIO,audioCodec:ot.audioCodec})),SUBTITLES:nt.map(ot=>({id:ot.attrs.SUBTITLES,textCodec:ot.textCodec})),"CLOSED-CAPTIONS":[]};let st=0;for(MASTER_PLAYLIST_MEDIA_REGEX.lastIndex=0;(tt=MASTER_PLAYLIST_MEDIA_REGEX.exec(s))!==null;){const ot=new AttrList(tt[1]),at=ot.TYPE;if(at){const lt=it[at],ct=rt[at]||[];rt[at]=ct,substituteVariablesInAttributes(et,ot,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const ht=ot.LANGUAGE,ft=ot["ASSOC-LANGUAGE"],dt=ot.CHANNELS,pt=ot.CHARACTERISTICS,gt=ot["INSTREAM-ID"],mt={attrs:ot,bitrate:0,id:st++,groupId:ot["GROUP-ID"]||"",name:ot.NAME||ht||"",type:at,default:ot.bool("DEFAULT"),autoselect:ot.bool("AUTOSELECT"),forced:ot.bool("FORCED"),lang:ht,url:ot.URI?M3U8Parser.resolve(ot.URI,a):""};if(ft&&(mt.assocLang=ft),dt&&(mt.channels=dt),pt&&(mt.characteristics=pt),gt&&(mt.instreamId=gt),lt!=null&&lt.length){const yt=M3U8Parser.findGroup(lt,mt.groupId)||lt[0];assignCodec(mt,yt,"audioCodec"),assignCodec(mt,yt,"textCodec")}ct.push(mt)}}return rt}static parseLevelPlaylist(s,a,et,tt,rt,nt){const it=new LevelDetails(a),st=it.fragments;let ot=null,at=0,lt=0,ct=0,ht=0,ft=null,dt=new Fragment(tt,a),pt,gt,mt,yt=-1,vt=!1,Et=null;for(LEVEL_PLAYLIST_REGEX_FAST.lastIndex=0,it.m3u8=s,it.hasVariableRefs=hasVariableReferences(s);(pt=LEVEL_PLAYLIST_REGEX_FAST.exec(s))!==null;){vt&&(vt=!1,dt=new Fragment(tt,a),dt.start=ct,dt.sn=at,dt.cc=ht,dt.level=et,ot&&(dt.initSegment=ot,dt.rawProgramDateTime=ot.rawProgramDateTime,ot.rawProgramDateTime=null,Et&&(dt.setByteRange(Et),Et=null)));const Ct=pt[1];if(Ct){dt.duration=parseFloat(Ct);const Ft=(" "+pt[2]).slice(1);dt.title=Ft||null,dt.tagList.push(Ft?["INF",Ct,Ft]:["INF",Ct])}else if(pt[3]){if(isFiniteNumber(dt.duration)){dt.start=ct,mt&&setFragLevelKeys(dt,mt,it),dt.sn=at,dt.level=et,dt.cc=ht,st.push(dt);const Ft=(" "+pt[3]).slice(1);dt.relurl=substituteVariables(it,Ft),assignProgramDateTime(dt,ft),ft=dt,ct+=dt.duration,at++,lt=0,vt=!0}}else if(pt[4]){const Ft=(" "+pt[4]).slice(1);ft?dt.setByteRange(Ft,ft):dt.setByteRange(Ft)}else if(pt[5])dt.rawProgramDateTime=(" "+pt[5]).slice(1),dt.tagList.push(["PROGRAM-DATE-TIME",dt.rawProgramDateTime]),yt===-1&&(yt=st.length);else{if(pt=pt[0].match(LEVEL_PLAYLIST_REGEX_SLOW),!pt){logger.warn("No matches on slow regex match for level playlist!");continue}for(gt=1;gt<pt.length&&!(typeof pt[gt]<"u");gt++);const Ft=(" "+pt[gt]).slice(1),zt=(" "+pt[gt+1]).slice(1),Nt=pt[gt+2]?(" "+pt[gt+2]).slice(1):"";switch(Ft){case"PLAYLIST-TYPE":it.type=zt.toUpperCase();break;case"MEDIA-SEQUENCE":at=it.startSN=parseInt(zt);break;case"SKIP":{const Kt=new AttrList(zt);substituteVariablesInAttributes(it,Kt,["RECENTLY-REMOVED-DATERANGES"]);const Yt=Kt.decimalInteger("SKIPPED-SEGMENTS");if(isFiniteNumber(Yt)){it.skippedSegments=Yt;for(let Pt=Yt;Pt--;)st.unshift(null);at+=Yt}const Bt=Kt.enumeratedString("RECENTLY-REMOVED-DATERANGES");Bt&&(it.recentlyRemovedDateranges=Bt.split("	"));break}case"TARGETDURATION":it.targetduration=Math.max(parseInt(zt),1);break;case"VERSION":it.version=parseInt(zt);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":it.live=!1;break;case"#":(zt||Nt)&&dt.tagList.push(Nt?[zt,Nt]:[zt]);break;case"DISCONTINUITY":ht++,dt.tagList.push(["DIS"]);break;case"GAP":dt.gap=!0,dt.tagList.push([Ft]);break;case"BITRATE":dt.tagList.push([Ft,zt]);break;case"DATERANGE":{const Kt=new AttrList(zt);substituteVariablesInAttributes(it,Kt,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),substituteVariablesInAttributes(it,Kt,Kt.clientAttrs);const Yt=new DateRange(Kt,it.dateRanges[Kt.ID]);Yt.isValid||it.skippedSegments?it.dateRanges[Yt.id]=Yt:logger.warn(`Ignoring invalid DATERANGE tag: "${zt}"`),dt.tagList.push(["EXT-X-DATERANGE",zt]);break}case"DEFINE":{{const Kt=new AttrList(zt);substituteVariablesInAttributes(it,Kt,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in Kt?importVariableDefinition(it,Kt,nt):addVariableDefinition(it,Kt,a)}break}case"DISCONTINUITY-SEQUENCE":ht=parseInt(zt);break;case"KEY":{const Kt=parseKey(zt,a,it);if(Kt.isSupported()){if(Kt.method==="NONE"){mt=void 0;break}mt||(mt={}),mt[Kt.keyFormat]&&(mt=_extends({},mt)),mt[Kt.keyFormat]=Kt}else logger.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${zt}"`);break}case"START":it.startTimeOffset=parseStartTimeOffset(zt);break;case"MAP":{const Kt=new AttrList(zt);if(substituteVariablesInAttributes(it,Kt,["BYTERANGE","URI"]),dt.duration){const Yt=new Fragment(tt,a);setInitSegment(Yt,Kt,et,mt),ot=Yt,dt.initSegment=ot,ot.rawProgramDateTime&&!dt.rawProgramDateTime&&(dt.rawProgramDateTime=ot.rawProgramDateTime)}else{const Yt=dt.byteRangeEndOffset;if(Yt){const Bt=dt.byteRangeStartOffset;Et=`${Yt-Bt}@${Bt}`}else Et=null;setInitSegment(dt,Kt,et,mt),ot=dt,vt=!0}break}case"SERVER-CONTROL":{const Kt=new AttrList(zt);it.canBlockReload=Kt.bool("CAN-BLOCK-RELOAD"),it.canSkipUntil=Kt.optionalFloat("CAN-SKIP-UNTIL",0),it.canSkipDateRanges=it.canSkipUntil>0&&Kt.bool("CAN-SKIP-DATERANGES"),it.partHoldBack=Kt.optionalFloat("PART-HOLD-BACK",0),it.holdBack=Kt.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const Kt=new AttrList(zt);it.partTarget=Kt.decimalFloatingPoint("PART-TARGET");break}case"PART":{let Kt=it.partList;Kt||(Kt=it.partList=[]);const Yt=lt>0?Kt[Kt.length-1]:void 0,Bt=lt++,Pt=new AttrList(zt);substituteVariablesInAttributes(it,Pt,["BYTERANGE","URI"]);const Dt=new Part(Pt,dt,a,Bt,Yt);Kt.push(Dt),dt.duration+=Dt.duration;break}case"PRELOAD-HINT":{const Kt=new AttrList(zt);substituteVariablesInAttributes(it,Kt,["URI"]),it.preloadHint=Kt;break}case"RENDITION-REPORT":{const Kt=new AttrList(zt);substituteVariablesInAttributes(it,Kt,["URI"]),it.renditionReports=it.renditionReports||[],it.renditionReports.push(Kt);break}default:logger.warn(`line parsed but not handled: ${pt}`);break}}}ft&&!ft.relurl?(st.pop(),ct-=ft.duration,it.partList&&(it.fragmentHint=ft)):it.partList&&(assignProgramDateTime(dt,ft),dt.cc=ht,it.fragmentHint=dt,mt&&setFragLevelKeys(dt,mt,it));const xt=st.length,wt=st[0],Rt=st[xt-1];if(ct+=it.skippedSegments*it.targetduration,ct>0&&xt&&Rt){it.averagetargetduration=ct/xt;const Ct=Rt.sn;it.endSN=Ct!=="initSegment"?Ct:0,it.live||(Rt.endList=!0),wt&&(it.startCC=wt.cc)}else it.endSN=0,it.startCC=0;return it.fragmentHint&&(ct+=it.fragmentHint.duration),it.totalduration=ct,it.endCC=ht,yt>0&&backfillProgramDateTimes(st,yt),it}}function parseKey(o,s,a){var et,tt;const rt=new AttrList(o);substituteVariablesInAttributes(a,rt,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const nt=(et=rt.METHOD)!=null?et:"",it=rt.URI,st=rt.hexadecimalInteger("IV"),ot=rt.KEYFORMATVERSIONS,at=(tt=rt.KEYFORMAT)!=null?tt:"identity";it&&rt.IV&&!st&&logger.error(`Invalid IV: ${rt.IV}`);const lt=it?M3U8Parser.resolve(it,s):"",ct=(ot||"1").split("/").map(Number).filter(Number.isFinite);return new LevelKey(nt,lt,at,ct,st)}function parseStartTimeOffset(o){const a=new AttrList(o).decimalFloatingPoint("TIME-OFFSET");return isFiniteNumber(a)?a:null}function setCodecs(o,s){let a=(o||"").split(/[ ,]+/).filter(et=>et);["video","audio","text"].forEach(et=>{const tt=a.filter(rt=>isCodecType(rt,et));tt.length&&(s[`${et}Codec`]=tt.join(","),a=a.filter(rt=>tt.indexOf(rt)===-1))}),s.unknownCodecs=a}function assignCodec(o,s,a){const et=s[a];et&&(o[a]=et)}function backfillProgramDateTimes(o,s){let a=o[s];for(let et=s;et--;){const tt=o[et];if(!tt)return;tt.programDateTime=a.programDateTime-tt.duration*1e3,a=tt}}function assignProgramDateTime(o,s){o.rawProgramDateTime?o.programDateTime=Date.parse(o.rawProgramDateTime):s!=null&&s.programDateTime&&(o.programDateTime=s.endProgramDateTime),isFiniteNumber(o.programDateTime)||(o.programDateTime=null,o.rawProgramDateTime=null)}function setInitSegment(o,s,a,et){o.relurl=s.URI,s.BYTERANGE&&o.setByteRange(s.BYTERANGE),o.level=a,o.sn="initSegment",et&&(o.levelkeys=et),o.initSegment=null}function setFragLevelKeys(o,s,a){o.levelkeys=s;const{encryptedFragments:et}=a;(!et.length||et[et.length-1].levelkeys!==s)&&Object.keys(s).some(tt=>s[tt].isCommonEncryption)&&et.push(o)}var PlaylistContextType={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},PlaylistLevelType={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function mapContextToLevelType(o){const{type:s}=o;switch(s){case PlaylistContextType.AUDIO_TRACK:return PlaylistLevelType.AUDIO;case PlaylistContextType.SUBTITLE_TRACK:return PlaylistLevelType.SUBTITLE;default:return PlaylistLevelType.MAIN}}function getResponseUrl(o,s){let a=o.url;return(a===void 0||a.indexOf("data:")===0)&&(a=s.url),a}class PlaylistLoader{constructor(s){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=s,this.registerListeners()}startLoad(s){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:s}=this;s.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(Events.LEVEL_LOADING,this.onLevelLoading,this),s.on(Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),s.on(Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:s}=this;s.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(Events.LEVEL_LOADING,this.onLevelLoading,this),s.off(Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),s.off(Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(s){const a=this.hls.config,et=a.pLoader,tt=a.loader,rt=et||tt,nt=new rt(a);return this.loaders[s.type]=nt,nt}getInternalLoader(s){return this.loaders[s.type]}resetInternalLoader(s){this.loaders[s]&&delete this.loaders[s]}destroyInternalLoaders(){for(const s in this.loaders){const a=this.loaders[s];a&&a.destroy(),this.resetInternalLoader(s)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(s,a){const{url:et}=a;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:PlaylistContextType.MANIFEST,url:et,deliveryDirectives:null})}onLevelLoading(s,a){const{id:et,level:tt,pathwayId:rt,url:nt,deliveryDirectives:it}=a;this.load({id:et,level:tt,pathwayId:rt,responseType:"text",type:PlaylistContextType.LEVEL,url:nt,deliveryDirectives:it})}onAudioTrackLoading(s,a){const{id:et,groupId:tt,url:rt,deliveryDirectives:nt}=a;this.load({id:et,groupId:tt,level:null,responseType:"text",type:PlaylistContextType.AUDIO_TRACK,url:rt,deliveryDirectives:nt})}onSubtitleTrackLoading(s,a){const{id:et,groupId:tt,url:rt,deliveryDirectives:nt}=a;this.load({id:et,groupId:tt,level:null,responseType:"text",type:PlaylistContextType.SUBTITLE_TRACK,url:rt,deliveryDirectives:nt})}load(s){var a;const et=this.hls.config;let tt=this.getInternalLoader(s);if(tt){const ot=tt.context;if(ot&&ot.url===s.url&&ot.level===s.level){logger.trace("[playlist-loader]: playlist request ongoing");return}logger.log(`[playlist-loader]: aborting previous loader for type: ${s.type}`),tt.abort()}let rt;if(s.type===PlaylistContextType.MANIFEST?rt=et.manifestLoadPolicy.default:rt=_extends({},et.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),tt=this.createInternalLoader(s),isFiniteNumber((a=s.deliveryDirectives)==null?void 0:a.part)){let ot;if(s.type===PlaylistContextType.LEVEL&&s.level!==null?ot=this.hls.levels[s.level].details:s.type===PlaylistContextType.AUDIO_TRACK&&s.id!==null?ot=this.hls.audioTracks[s.id].details:s.type===PlaylistContextType.SUBTITLE_TRACK&&s.id!==null&&(ot=this.hls.subtitleTracks[s.id].details),ot){const at=ot.partTarget,lt=ot.targetduration;if(at&&lt){const ct=Math.max(at*3,lt*.8)*1e3;rt=_extends({},rt,{maxTimeToFirstByteMs:Math.min(ct,rt.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(ct,rt.maxTimeToFirstByteMs)})}}}const nt=rt.errorRetry||rt.timeoutRetry||{},it={loadPolicy:rt,timeout:rt.maxLoadTimeMs,maxRetry:nt.maxNumRetry||0,retryDelay:nt.retryDelayMs||0,maxRetryDelay:nt.maxRetryDelayMs||0},st={onSuccess:(ot,at,lt,ct)=>{const ht=this.getInternalLoader(lt);this.resetInternalLoader(lt.type);const ft=ot.data;if(ft.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(ot,lt,new Error("no EXTM3U delimiter"),ct||null,at);return}at.parsing.start=performance.now(),M3U8Parser.isMediaPlaylist(ft)?this.handleTrackOrLevelPlaylist(ot,at,lt,ct||null,ht):this.handleMasterPlaylist(ot,at,lt,ct)},onError:(ot,at,lt,ct)=>{this.handleNetworkError(at,lt,!1,ot,ct)},onTimeout:(ot,at,lt)=>{this.handleNetworkError(at,lt,!0,void 0,ot)}};tt.load(s,it,st)}handleMasterPlaylist(s,a,et,tt){const rt=this.hls,nt=s.data,it=getResponseUrl(s,et),st=M3U8Parser.parseMasterPlaylist(nt,it);if(st.playlistParsingError){this.handleManifestParsingError(s,et,st.playlistParsingError,tt,a);return}const{contentSteering:ot,levels:at,sessionData:lt,sessionKeys:ct,startTimeOffset:ht,variableList:ft}=st;this.variableList=ft;const{AUDIO:dt=[],SUBTITLES:pt,"CLOSED-CAPTIONS":gt}=M3U8Parser.parseMasterPlaylistMedia(nt,it,st);dt.length&&!dt.some(yt=>!yt.url)&&at[0].audioCodec&&!at[0].attrs.AUDIO&&(logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),dt.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new AttrList({}),bitrate:0,url:""})),rt.trigger(Events.MANIFEST_LOADED,{levels:at,audioTracks:dt,subtitles:pt,captions:gt,contentSteering:ot,url:it,stats:a,networkDetails:tt,sessionData:lt,sessionKeys:ct,startTimeOffset:ht,variableList:ft})}handleTrackOrLevelPlaylist(s,a,et,tt,rt){const nt=this.hls,{id:it,level:st,type:ot}=et,at=getResponseUrl(s,et),lt=0,ct=isFiniteNumber(st)?st:isFiniteNumber(it)?it:0,ht=mapContextToLevelType(et),ft=M3U8Parser.parseLevelPlaylist(s.data,at,ct,ht,lt,this.variableList);if(ot===PlaylistContextType.MANIFEST){const dt={attrs:new AttrList({}),bitrate:0,details:ft,name:"",url:at};nt.trigger(Events.MANIFEST_LOADED,{levels:[dt],audioTracks:[],url:at,stats:a,networkDetails:tt,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}a.parsing.end=performance.now(),et.levelDetails=ft,this.handlePlaylistLoaded(ft,s,a,et,tt,rt)}handleManifestParsingError(s,a,et,tt,rt){this.hls.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.MANIFEST_PARSING_ERROR,fatal:a.type===PlaylistContextType.MANIFEST,url:s.url,err:et,error:et,reason:et.message,response:s,context:a,networkDetails:tt,stats:rt})}handleNetworkError(s,a,et=!1,tt,rt){let nt=`A network ${et?"timeout":"error"+(tt?" (status "+tt.code+")":"")} occurred while loading ${s.type}`;s.type===PlaylistContextType.LEVEL?nt+=`: ${s.level} id: ${s.id}`:(s.type===PlaylistContextType.AUDIO_TRACK||s.type===PlaylistContextType.SUBTITLE_TRACK)&&(nt+=` id: ${s.id} group-id: "${s.groupId}"`);const it=new Error(nt);logger.warn(`[playlist-loader]: ${nt}`);let st=ErrorDetails.UNKNOWN,ot=!1;const at=this.getInternalLoader(s);switch(s.type){case PlaylistContextType.MANIFEST:st=et?ErrorDetails.MANIFEST_LOAD_TIMEOUT:ErrorDetails.MANIFEST_LOAD_ERROR,ot=!0;break;case PlaylistContextType.LEVEL:st=et?ErrorDetails.LEVEL_LOAD_TIMEOUT:ErrorDetails.LEVEL_LOAD_ERROR,ot=!1;break;case PlaylistContextType.AUDIO_TRACK:st=et?ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:ErrorDetails.AUDIO_TRACK_LOAD_ERROR,ot=!1;break;case PlaylistContextType.SUBTITLE_TRACK:st=et?ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:ErrorDetails.SUBTITLE_LOAD_ERROR,ot=!1;break}at&&this.resetInternalLoader(s.type);const lt={type:ErrorTypes.NETWORK_ERROR,details:st,fatal:ot,url:s.url,loader:at,context:s,error:it,networkDetails:a,stats:rt};if(tt){const ct=a?.url||s.url;lt.response=_objectSpread2({url:ct,data:void 0},tt)}this.hls.trigger(Events.ERROR,lt)}handlePlaylistLoaded(s,a,et,tt,rt,nt){const it=this.hls,{type:st,level:ot,id:at,groupId:lt,deliveryDirectives:ct}=tt,ht=getResponseUrl(a,tt),ft=mapContextToLevelType(tt),dt=typeof tt.level=="number"&&ft===PlaylistLevelType.MAIN?ot:void 0;if(!s.fragments.length){const gt=new Error("No Segments found in Playlist");it.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:ht,error:gt,reason:gt.message,response:a,context:tt,level:dt,parent:ft,networkDetails:rt,stats:et});return}s.targetduration||(s.playlistParsingError=new Error("Missing Target Duration"));const pt=s.playlistParsingError;if(pt){it.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.LEVEL_PARSING_ERROR,fatal:!1,url:ht,error:pt,reason:pt.message,response:a,context:tt,level:dt,parent:ft,networkDetails:rt,stats:et});return}switch(s.live&&nt&&(nt.getCacheAge&&(s.ageHeader=nt.getCacheAge()||0),(!nt.getCacheAge||isNaN(s.ageHeader))&&(s.ageHeader=0)),st){case PlaylistContextType.MANIFEST:case PlaylistContextType.LEVEL:it.trigger(Events.LEVEL_LOADED,{details:s,level:dt||0,id:at||0,stats:et,networkDetails:rt,deliveryDirectives:ct});break;case PlaylistContextType.AUDIO_TRACK:it.trigger(Events.AUDIO_TRACK_LOADED,{details:s,id:at||0,groupId:lt||"",stats:et,networkDetails:rt,deliveryDirectives:ct});break;case PlaylistContextType.SUBTITLE_TRACK:it.trigger(Events.SUBTITLE_TRACK_LOADED,{details:s,id:at||0,groupId:lt||"",stats:et,networkDetails:rt,deliveryDirectives:ct});break}}}function sendAddTrackEvent(o,s){let a;try{a=new Event("addtrack")}catch{a=document.createEvent("Event"),a.initEvent("addtrack",!1,!1)}a.track=o,s.dispatchEvent(a)}function addCueToTrack(o,s){const a=o.mode;if(a==="disabled"&&(o.mode="hidden"),o.cues&&!o.cues.getCueById(s.id))try{if(o.addCue(s),!o.cues.getCueById(s.id))throw new Error(`addCue is failed for: ${s}`)}catch(et){logger.debug(`[texttrack-utils]: ${et}`);try{const tt=new self.TextTrackCue(s.startTime,s.endTime,s.text);tt.id=s.id,o.addCue(tt)}catch(tt){logger.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${tt}`)}}a==="disabled"&&(o.mode=a)}function clearCurrentCues(o){const s=o.mode;if(s==="disabled"&&(o.mode="hidden"),o.cues)for(let a=o.cues.length;a--;)o.removeCue(o.cues[a]);s==="disabled"&&(o.mode=s)}function removeCuesInRange(o,s,a,et){const tt=o.mode;if(tt==="disabled"&&(o.mode="hidden"),o.cues&&o.cues.length>0){const rt=getCuesInRange(o.cues,s,a);for(let nt=0;nt<rt.length;nt++)(!et||et(rt[nt]))&&o.removeCue(rt[nt])}tt==="disabled"&&(o.mode=tt)}function getFirstCueIndexAfterTime(o,s){if(s<o[0].startTime)return 0;const a=o.length-1;if(s>o[a].endTime)return-1;let et=0,tt=a;for(;et<=tt;){const rt=Math.floor((tt+et)/2);if(s<o[rt].startTime)tt=rt-1;else if(s>o[rt].startTime&&et<a)et=rt+1;else return rt}return o[et].startTime-s<s-o[tt].startTime?et:tt}function getCuesInRange(o,s,a){const et=[],tt=getFirstCueIndexAfterTime(o,s);if(tt>-1)for(let rt=tt,nt=o.length;rt<nt;rt++){const it=o[rt];if(it.startTime>=s&&it.endTime<=a)et.push(it);else if(it.startTime>a)return et}return et}function filterSubtitleTracks(o){const s=[];for(let a=0;a<o.length;a++){const et=o[a];(et.kind==="subtitles"||et.kind==="captions")&&et.label&&s.push(o[a])}return s}var MetadataSchema={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};const MIN_CUE_DURATION=.25;function getCueClass(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function createCueWithDataFields(o,s,a,et,tt){let rt=new o(s,a,"");try{rt.value=et,tt&&(rt.type=tt)}catch{rt=new o(s,a,JSON.stringify(tt?_objectSpread2({type:tt},et):et))}return rt}const MAX_CUE_ENDTIME=(()=>{const o=getCueClass();try{o&&new o(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function dateRangeDateToTimelineSeconds(o,s){return o.getTime()/1e3-s}function hexToArrayBuffer(o){return Uint8Array.from(o.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class ID3TrackController{constructor(s){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=s,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:s}=this;s.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),s.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),s.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:s}=this;s.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),s.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),s.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(s,a){this.media=a.media}onMediaDetaching(){this.id3Track&&(clearCurrentCues(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(s){const a=this.getID3Track(s.textTracks);return a.mode="hidden",a}getID3Track(s){if(this.media){for(let a=0;a<s.length;a++){const et=s[a];if(et.kind==="metadata"&&et.label==="id3")return sendAddTrackEvent(et,this.media),et}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(s,a){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:et,enableID3MetadataCues:tt}}}=this;if(!et&&!tt)return;const{samples:rt}=a;this.id3Track||(this.id3Track=this.createTrack(this.media));const nt=getCueClass();if(nt)for(let it=0;it<rt.length;it++){const st=rt[it].type;if(st===MetadataSchema.emsg&&!et||!tt)continue;const ot=getID3Frames(rt[it].data);if(ot){const at=rt[it].pts;let lt=at+rt[it].duration;lt>MAX_CUE_ENDTIME&&(lt=MAX_CUE_ENDTIME),lt-at<=0&&(lt=at+MIN_CUE_DURATION);for(let ht=0;ht<ot.length;ht++){const ft=ot[ht];if(!isTimeStampFrame(ft)){this.updateId3CueEnds(at,st);const dt=createCueWithDataFields(nt,at,lt,ft,st);dt&&this.id3Track.addCue(dt)}}}}}updateId3CueEnds(s,a){var et;const tt=(et=this.id3Track)==null?void 0:et.cues;if(tt)for(let rt=tt.length;rt--;){const nt=tt[rt];nt.type===a&&nt.startTime<s&&nt.endTime===MAX_CUE_ENDTIME&&(nt.endTime=s)}}onBufferFlushing(s,{startOffset:a,endOffset:et,type:tt}){const{id3Track:rt,hls:nt}=this;if(!nt)return;const{config:{enableEmsgMetadataCues:it,enableID3MetadataCues:st}}=nt;if(rt&&(it||st)){let ot;tt==="audio"?ot=at=>at.type===MetadataSchema.audioId3&&st:tt==="video"?ot=at=>at.type===MetadataSchema.emsg&&it:ot=at=>at.type===MetadataSchema.audioId3&&st||at.type===MetadataSchema.emsg&&it,removeCuesInRange(rt,a,et,ot)}}onLevelUpdated(s,{details:a}){if(!this.media||!a.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:et,id3Track:tt}=this,{dateRanges:rt}=a,nt=Object.keys(rt);if(tt){const at=Object.keys(et).filter(lt=>!nt.includes(lt));for(let lt=at.length;lt--;){const ct=at[lt];Object.keys(et[ct].cues).forEach(ht=>{tt.removeCue(et[ct].cues[ht])}),delete et[ct]}}const it=a.fragments[a.fragments.length-1];if(nt.length===0||!isFiniteNumber(it?.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const st=it.programDateTime/1e3-it.start,ot=getCueClass();for(let at=0;at<nt.length;at++){const lt=nt[at],ct=rt[lt],ht=dateRangeDateToTimelineSeconds(ct.startDate,st),ft=et[lt],dt=ft?.cues||{};let pt=ft?.durationKnown||!1,gt=MAX_CUE_ENDTIME;const mt=ct.endDate;if(mt)gt=dateRangeDateToTimelineSeconds(mt,st),pt=!0;else if(ct.endOnNext&&!pt){const vt=nt.reduce((Et,xt)=>{if(xt!==ct.id){const wt=rt[xt];if(wt.class===ct.class&&wt.startDate>ct.startDate&&(!Et||ct.startDate<Et.startDate))return wt}return Et},null);vt&&(gt=dateRangeDateToTimelineSeconds(vt.startDate,st),pt=!0)}const yt=Object.keys(ct.attr);for(let vt=0;vt<yt.length;vt++){const Et=yt[vt];if(!isDateRangeCueAttribute(Et))continue;const xt=dt[Et];if(xt)pt&&!ft.durationKnown&&(xt.endTime=gt);else if(ot){let wt=ct.attr[Et];isSCTE35Attribute(Et)&&(wt=hexToArrayBuffer(wt));const Rt=createCueWithDataFields(ot,ht,gt,{key:Et,data:wt},MetadataSchema.dateRange);Rt&&(Rt.id=lt,this.id3Track.addCue(Rt),dt[Et]=Rt)}}et[lt]={cues:dt,dateRange:ct,durationKnown:pt}}}}class LatencyController{constructor(s){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=s,this.config=s.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:s,levelDetails:a}=this;return s.liveMaxLatencyDuration!==void 0?s.liveMaxLatencyDuration:a?s.liveMaxLatencyDurationCount*a.targetduration:0}get targetLatency(){const{levelDetails:s}=this;if(s===null)return null;const{holdBack:a,partHoldBack:et,targetduration:tt}=s,{liveSyncDuration:rt,liveSyncDurationCount:nt,lowLatencyMode:it}=this.config,st=this.hls.userConfig;let ot=it&&et||a;(st.liveSyncDuration||st.liveSyncDurationCount||ot===0)&&(ot=rt!==void 0?rt:nt*tt);const at=tt;return ot+Math.min(this.stallCount*1,at)}get liveSyncPosition(){const s=this.estimateLiveEdge(),a=this.targetLatency,et=this.levelDetails;if(s===null||a===null||et===null)return null;const tt=et.edge,rt=s-a-this.edgeStalled,nt=tt-et.totalduration,it=tt-(this.config.lowLatencyMode&&et.partTarget||et.targetduration);return Math.min(Math.max(nt,rt),it)}get drift(){const{levelDetails:s}=this;return s===null?1:s.drift}get edgeStalled(){const{levelDetails:s}=this;if(s===null)return 0;const a=(this.config.lowLatencyMode&&s.partTarget||s.targetduration)*3;return Math.max(s.age-a,0)}get forwardBufferLength(){const{media:s,levelDetails:a}=this;if(!s||!a)return 0;const et=s.buffered.length;return(et?s.buffered.end(et-1):a.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(Events.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(Events.ERROR,this.onError,this)}onMediaAttached(s,a){this.media=a.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(s,{details:a}){this.levelDetails=a,a.advanced&&this.timeupdate(),!a.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(s,a){var et;a.details===ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,(et=this.levelDetails)!=null&&et.live&&logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:s,levelDetails:a}=this;if(!s||!a)return;this.currentTime=s.currentTime;const et=this.computeLatency();if(et===null)return;this._latency=et;const{lowLatencyMode:tt,maxLiveSyncPlaybackRate:rt}=this.config;if(!tt||rt===1||!a.live)return;const nt=this.targetLatency;if(nt===null)return;const it=et-nt,st=Math.min(this.maxLatency,nt+a.targetduration);if(it<st&&it>.05&&this.forwardBufferLength>1){const at=Math.min(2,Math.max(1,rt)),lt=Math.round(2/(1+Math.exp(-.75*it-this.edgeStalled))*20)/20;s.playbackRate=Math.min(at,Math.max(1,lt))}else s.playbackRate!==1&&s.playbackRate!==0&&(s.playbackRate=1)}estimateLiveEdge(){const{levelDetails:s}=this;return s===null?null:s.edge+s.age}computeLatency(){const s=this.estimateLiveEdge();return s===null?null:s-this.currentTime}}const HdcpLevels=["NONE","TYPE-0","TYPE-1",null];function isHdcpLevel(o){return HdcpLevels.indexOf(o)>-1}const VideoRangeValues=["SDR","PQ","HLG"];function isVideoRange(o){return!!o&&VideoRangeValues.indexOf(o)>-1}var HlsSkip={No:"",Yes:"YES",v2:"v2"};function getSkipValue(o){const{canSkipUntil:s,canSkipDateRanges:a,age:et}=o,tt=et<s/2;return s&&tt?a?HlsSkip.v2:HlsSkip.Yes:HlsSkip.No}class HlsUrlParameters{constructor(s,a,et){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=s,this.part=a,this.skip=et}addDirectives(s){const a=new self.URL(s);return this.msn!==void 0&&a.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&a.searchParams.set("_HLS_part",this.part.toString()),this.skip&&a.searchParams.set("_HLS_skip",this.skip),a.href}}class Level{constructor(s){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[s.url],this._attrs=[s.attrs],this.bitrate=s.bitrate,s.details&&(this.details=s.details),this.id=s.id||0,this.name=s.name,this.width=s.width||0,this.height=s.height||0,this.frameRate=s.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=s.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=s.audioCodec,this.videoCodec=s.videoCodec,this.codecSet=[s.videoCodec,s.audioCodec].filter(a=>!!a).map(a=>a.substring(0,4)).join(","),this.addGroupId("audio",s.attrs.AUDIO),this.addGroupId("text",s.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(s){return hasGroup(this._audioGroups,s)}hasSubtitleGroup(s){return hasGroup(this._subtitleGroups,s)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(s,a){if(a){if(s==="audio"){let et=this._audioGroups;et||(et=this._audioGroups=[]),et.indexOf(a)===-1&&et.push(a)}else if(s==="text"){let et=this._subtitleGroups;et||(et=this._subtitleGroups=[]),et.indexOf(a)===-1&&et.push(a)}}}get urlId(){return 0}set urlId(s){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var s;return(s=this.audioGroups)==null?void 0:s[0]}get textGroupId(){var s;return(s=this.subtitleGroups)==null?void 0:s[0]}addFallback(){}}function hasGroup(o,s){return!s||!o?!1:o.indexOf(s)!==-1}function updateFromToPTS(o,s){const a=s.startPTS;if(isFiniteNumber(a)){let et=0,tt;s.sn>o.sn?(et=a-o.start,tt=o):(et=o.start-a,tt=s),tt.duration!==et&&(tt.duration=et)}else s.sn>o.sn?o.cc===s.cc&&o.minEndPTS?s.start=o.start+(o.minEndPTS-o.start):s.start=o.start+o.duration:s.start=Math.max(o.start-s.duration,0)}function updateFragPTSDTS(o,s,a,et,tt,rt){et-a<=0&&(logger.warn("Fragment should have a positive duration",s),et=a+s.duration,rt=tt+s.duration);let it=a,st=et;const ot=s.startPTS,at=s.endPTS;if(isFiniteNumber(ot)){const pt=Math.abs(ot-a);isFiniteNumber(s.deltaPTS)?s.deltaPTS=Math.max(pt,s.deltaPTS):s.deltaPTS=pt,it=Math.max(a,ot),a=Math.min(a,ot),tt=Math.min(tt,s.startDTS),st=Math.min(et,at),et=Math.max(et,at),rt=Math.max(rt,s.endDTS)}const lt=a-s.start;s.start!==0&&(s.start=a),s.duration=et-s.start,s.startPTS=a,s.maxStartPTS=it,s.startDTS=tt,s.endPTS=et,s.minEndPTS=st,s.endDTS=rt;const ct=s.sn;if(!o||ct<o.startSN||ct>o.endSN)return 0;let ht;const ft=ct-o.startSN,dt=o.fragments;for(dt[ft]=s,ht=ft;ht>0;ht--)updateFromToPTS(dt[ht],dt[ht-1]);for(ht=ft;ht<dt.length-1;ht++)updateFromToPTS(dt[ht],dt[ht+1]);return o.fragmentHint&&updateFromToPTS(dt[dt.length-1],o.fragmentHint),o.PTSKnown=o.alignedSliding=!0,lt}function mergeDetails(o,s){let a=null;const et=o.fragments;for(let st=et.length-1;st>=0;st--){const ot=et[st].initSegment;if(ot){a=ot;break}}o.fragmentHint&&delete o.fragmentHint.endPTS;let tt=0,rt;if(mapFragmentIntersection(o,s,(st,ot)=>{st.relurl&&(tt=st.cc-ot.cc),isFiniteNumber(st.startPTS)&&isFiniteNumber(st.endPTS)&&(ot.start=ot.startPTS=st.startPTS,ot.startDTS=st.startDTS,ot.maxStartPTS=st.maxStartPTS,ot.endPTS=st.endPTS,ot.endDTS=st.endDTS,ot.minEndPTS=st.minEndPTS,ot.duration=st.endPTS-st.startPTS,ot.duration&&(rt=ot),s.PTSKnown=s.alignedSliding=!0),ot.elementaryStreams=st.elementaryStreams,ot.loader=st.loader,ot.stats=st.stats,st.initSegment&&(ot.initSegment=st.initSegment,a=st.initSegment)}),a&&(s.fragmentHint?s.fragments.concat(s.fragmentHint):s.fragments).forEach(ot=>{var at;ot&&(!ot.initSegment||ot.initSegment.relurl===((at=a)==null?void 0:at.relurl))&&(ot.initSegment=a)}),s.skippedSegments)if(s.deltaUpdateFailed=s.fragments.some(st=>!st),s.deltaUpdateFailed){logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let st=s.skippedSegments;st--;)s.fragments.shift();s.startSN=s.fragments[0].sn,s.startCC=s.fragments[0].cc}else s.canSkipDateRanges&&(s.dateRanges=mergeDateRanges(o.dateRanges,s.dateRanges,s.recentlyRemovedDateranges));const nt=s.fragments;if(tt){logger.warn("discontinuity sliding from playlist, take drift into account");for(let st=0;st<nt.length;st++)nt[st].cc+=tt}s.skippedSegments&&(s.startCC=s.fragments[0].cc),mapPartIntersection(o.partList,s.partList,(st,ot)=>{ot.elementaryStreams=st.elementaryStreams,ot.stats=st.stats}),rt?updateFragPTSDTS(s,rt,rt.startPTS,rt.endPTS,rt.startDTS,rt.endDTS):adjustSliding(o,s),nt.length&&(s.totalduration=s.edge-nt[0].start),s.driftStartTime=o.driftStartTime,s.driftStart=o.driftStart;const it=s.advancedDateTime;if(s.advanced&&it){const st=s.edge;s.driftStart||(s.driftStartTime=it,s.driftStart=st),s.driftEndTime=it,s.driftEnd=st}else s.driftEndTime=o.driftEndTime,s.driftEnd=o.driftEnd,s.advancedDateTime=o.advancedDateTime}function mergeDateRanges(o,s,a){const et=_extends({},o);return a&&a.forEach(tt=>{delete et[tt]}),Object.keys(s).forEach(tt=>{const rt=new DateRange(s[tt].attr,et[tt]);rt.isValid?et[tt]=rt:logger.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(s[tt].attr)}"`)}),et}function mapPartIntersection(o,s,a){if(o&&s){let et=0;for(let tt=0,rt=o.length;tt<=rt;tt++){const nt=o[tt],it=s[tt+et];nt&&it&&nt.index===it.index&&nt.fragment.sn===it.fragment.sn?a(nt,it):et--}}}function mapFragmentIntersection(o,s,a){const et=s.skippedSegments,tt=Math.max(o.startSN,s.startSN)-s.startSN,rt=(o.fragmentHint?1:0)+(et?s.endSN:Math.min(o.endSN,s.endSN))-s.startSN,nt=s.startSN-o.startSN,it=s.fragmentHint?s.fragments.concat(s.fragmentHint):s.fragments,st=o.fragmentHint?o.fragments.concat(o.fragmentHint):o.fragments;for(let ot=tt;ot<=rt;ot++){const at=st[nt+ot];let lt=it[ot];et&&!lt&&ot<et&&(lt=s.fragments[ot]=at),at&&lt&&a(at,lt)}}function adjustSliding(o,s){const a=s.startSN+s.skippedSegments-o.startSN,et=o.fragments;a<0||a>=et.length||addSliding(s,et[a].start)}function addSliding(o,s){if(s){const a=o.fragments;for(let et=o.skippedSegments;et<a.length;et++)a[et].start+=s;o.fragmentHint&&(o.fragmentHint.start+=s)}}function computeReloadInterval(o,s=1/0){let a=1e3*o.targetduration;if(o.updated){const et=o.fragments;if(et.length&&a*4>s){const rt=et[et.length-1].duration*1e3;rt<a&&(a=rt)}}else a/=2;return Math.round(a)}function getFragmentWithSN(o,s,a){if(!(o!=null&&o.details))return null;const et=o.details;let tt=et.fragments[s-et.startSN];return tt||(tt=et.fragmentHint,tt&&tt.sn===s)?tt:s<et.startSN&&a&&a.sn===s?a:null}function getPartWith(o,s,a){var et;return o!=null&&o.details?findPart((et=o.details)==null?void 0:et.partList,s,a):null}function findPart(o,s,a){if(o)for(let et=o.length;et--;){const tt=o[et];if(tt.index===a&&tt.fragment.sn===s)return tt}return null}function reassignFragmentLevelIndexes(o){o.forEach((s,a)=>{const{details:et}=s;et!=null&&et.fragments&&et.fragments.forEach(tt=>{tt.level=a})})}function isTimeoutError(o){switch(o.details){case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_TIMEOUT:case ErrorDetails.LEVEL_LOAD_TIMEOUT:case ErrorDetails.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function getRetryConfig(o,s){const a=isTimeoutError(s);return o.default[`${a?"timeout":"error"}Retry`]}function getRetryDelay(o,s){const a=o.backoff==="linear"?1:Math.pow(2,s);return Math.min(a*o.retryDelayMs,o.maxRetryDelayMs)}function getLoaderConfigWithoutReties(o){return _objectSpread2(_objectSpread2({},o),{errorRetry:null,timeoutRetry:null})}function shouldRetry(o,s,a,et){if(!o)return!1;const tt=et?.code,rt=s<o.maxNumRetry&&(retryForHttpStatus(tt)||!!a);return o.shouldRetry?o.shouldRetry(o,s,a,et,rt):rt}function retryForHttpStatus(o){return o===0&&navigator.onLine===!1||!!o&&(o<400||o>499)}const BinarySearch={search:function(o,s){let a=0,et=o.length-1,tt=null,rt=null;for(;a<=et;){tt=(a+et)/2|0,rt=o[tt];const nt=s(rt);if(nt>0)a=tt+1;else if(nt<0)et=tt-1;else return rt}return null}};function findFragmentByPDT(o,s,a){if(s===null||!Array.isArray(o)||!o.length||!isFiniteNumber(s))return null;const et=o[0].programDateTime;if(s<(et||0))return null;const tt=o[o.length-1].endProgramDateTime;if(s>=(tt||0))return null;a=a||0;for(let rt=0;rt<o.length;++rt){const nt=o[rt];if(pdtWithinToleranceTest(s,a,nt))return nt}return null}function findFragmentByPTS(o,s,a=0,et=0,tt=.005){let rt=null;if(o){rt=s[o.sn-s[0].sn+1]||null;const it=o.endDTS-a;it>0&&it<15e-7&&(a+=15e-7)}else a===0&&s[0].start===0&&(rt=s[0]);if(rt&&((!o||o.level===rt.level)&&fragmentWithinToleranceTest(a,et,rt)===0||fragmentWithinFastStartSwitch(rt,o,Math.min(tt,et))))return rt;const nt=BinarySearch.search(s,fragmentWithinToleranceTest.bind(null,a,et));return nt&&(nt!==o||!rt)?nt:rt}function fragmentWithinFastStartSwitch(o,s,a){if(s&&s.start===0&&s.level<o.level&&(s.endPTS||0)>0){const et=s.tagList.reduce((tt,rt)=>(rt[0]==="INF"&&(tt+=parseFloat(rt[1])),tt),a);return o.start<=et}return!1}function fragmentWithinToleranceTest(o=0,s=0,a){if(a.start<=o&&a.start+a.duration>o)return 0;const et=Math.min(s,a.duration+(a.deltaPTS?a.deltaPTS:0));return a.start+a.duration-et<=o?1:a.start-et>o&&a.start?-1:0}function pdtWithinToleranceTest(o,s,a){const et=Math.min(s,a.duration+(a.deltaPTS?a.deltaPTS:0))*1e3;return(a.endProgramDateTime||0)-et>o}function findFragWithCC(o,s){return BinarySearch.search(o,a=>a.cc<s?1:a.cc>s?-1:0)}var NetworkErrorAction={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},ErrorActionFlags={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class ErrorController{constructor(s){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=s,this.log=logger.log.bind(logger,"[info]:"),this.warn=logger.warn.bind(logger,"[warning]:"),this.error=logger.error.bind(logger,"[error]:"),this.registerListeners()}registerListeners(){const s=this.hls;s.on(Events.ERROR,this.onError,this),s.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const s=this.hls;s&&(s.off(Events.ERROR,this.onError,this),s.off(Events.ERROR,this.onErrorOut,this),s.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(s){}stopLoad(){this.playlistError=0}getVariantLevelIndex(s){return s?.type===PlaylistLevelType.MAIN?s.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(s,a){var et,tt;if(a.fatal)return;const rt=this.hls,nt=a.context;switch(a.details){case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:a.errorAction=this.getFragRetryOrSwitchAction(a);return;case ErrorDetails.FRAG_PARSING_ERROR:if((et=a.frag)!=null&&et.gap){a.errorAction={action:NetworkErrorAction.DoNothing,flags:ErrorActionFlags.None};return}case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_DECRYPT_ERROR:{a.errorAction=this.getFragRetryOrSwitchAction(a),a.errorAction.action=NetworkErrorAction.SendAlternateToPenaltyBox;return}case ErrorDetails.LEVEL_EMPTY_ERROR:case ErrorDetails.LEVEL_PARSING_ERROR:{var it,st;const ot=a.parent===PlaylistLevelType.MAIN?a.level:rt.loadLevel;a.details===ErrorDetails.LEVEL_EMPTY_ERROR&&((it=a.context)!=null&&(st=it.levelDetails)!=null&&st.live)?a.errorAction=this.getPlaylistRetryOrSwitchAction(a,ot):(a.levelRetry=!1,a.errorAction=this.getLevelSwitchAction(a,ot))}return;case ErrorDetails.LEVEL_LOAD_ERROR:case ErrorDetails.LEVEL_LOAD_TIMEOUT:typeof nt?.level=="number"&&(a.errorAction=this.getPlaylistRetryOrSwitchAction(a,nt.level));return;case ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case ErrorDetails.SUBTITLE_LOAD_ERROR:case ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:if(nt){const ot=rt.levels[rt.loadLevel];if(ot&&(nt.type===PlaylistContextType.AUDIO_TRACK&&ot.hasAudioGroup(nt.groupId)||nt.type===PlaylistContextType.SUBTITLE_TRACK&&ot.hasSubtitleGroup(nt.groupId))){a.errorAction=this.getPlaylistRetryOrSwitchAction(a,rt.loadLevel),a.errorAction.action=NetworkErrorAction.SendAlternateToPenaltyBox,a.errorAction.flags=ErrorActionFlags.MoveAllAlternatesMatchingHost;return}}return;case ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const ot=rt.levels[rt.loadLevel],at=ot?.attrs["HDCP-LEVEL"];at?a.errorAction={action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.MoveAllAlternatesMatchingHDCP,hdcpLevel:at}:this.keySystemError(a)}return;case ErrorDetails.BUFFER_ADD_CODEC_ERROR:case ErrorDetails.REMUX_ALLOC_ERROR:case ErrorDetails.BUFFER_APPEND_ERROR:a.errorAction=this.getLevelSwitchAction(a,(tt=a.level)!=null?tt:rt.loadLevel);return;case ErrorDetails.INTERNAL_EXCEPTION:case ErrorDetails.BUFFER_APPENDING_ERROR:case ErrorDetails.BUFFER_FULL_ERROR:case ErrorDetails.LEVEL_SWITCH_ERROR:case ErrorDetails.BUFFER_STALLED_ERROR:case ErrorDetails.BUFFER_SEEK_OVER_HOLE:case ErrorDetails.BUFFER_NUDGE_ON_STALL:a.errorAction={action:NetworkErrorAction.DoNothing,flags:ErrorActionFlags.None};return}a.type===ErrorTypes.KEY_SYSTEM_ERROR&&this.keySystemError(a)}keySystemError(s){const a=this.getVariantLevelIndex(s.frag);s.levelRetry=!1,s.errorAction=this.getLevelSwitchAction(s,a)}getPlaylistRetryOrSwitchAction(s,a){const et=this.hls,tt=getRetryConfig(et.config.playlistLoadPolicy,s),rt=this.playlistError++;if(shouldRetry(tt,rt,isTimeoutError(s),s.response))return{action:NetworkErrorAction.RetryRequest,flags:ErrorActionFlags.None,retryConfig:tt,retryCount:rt};const it=this.getLevelSwitchAction(s,a);return tt&&(it.retryConfig=tt,it.retryCount=rt),it}getFragRetryOrSwitchAction(s){const a=this.hls,et=this.getVariantLevelIndex(s.frag),tt=a.levels[et],{fragLoadPolicy:rt,keyLoadPolicy:nt}=a.config,it=getRetryConfig(s.details.startsWith("key")?nt:rt,s),st=a.levels.reduce((at,lt)=>at+lt.fragmentError,0);if(tt&&(s.details!==ErrorDetails.FRAG_GAP&&tt.fragmentError++,shouldRetry(it,st,isTimeoutError(s),s.response)))return{action:NetworkErrorAction.RetryRequest,flags:ErrorActionFlags.None,retryConfig:it,retryCount:st};const ot=this.getLevelSwitchAction(s,et);return it&&(ot.retryConfig=it,ot.retryCount=st),ot}getLevelSwitchAction(s,a){const et=this.hls;a==null&&(a=et.loadLevel);const tt=this.hls.levels[a];if(tt){var rt,nt;const ot=s.details;tt.loadError++,ot===ErrorDetails.BUFFER_APPEND_ERROR&&tt.fragmentError++;let at=-1;const{levels:lt,loadLevel:ct,minAutoLevel:ht,maxAutoLevel:ft}=et;et.autoLevelEnabled||(et.loadLevel=-1);const dt=(rt=s.frag)==null?void 0:rt.type,gt=(dt===PlaylistLevelType.AUDIO&&ot===ErrorDetails.FRAG_PARSING_ERROR||s.sourceBufferName==="audio"&&(ot===ErrorDetails.BUFFER_ADD_CODEC_ERROR||ot===ErrorDetails.BUFFER_APPEND_ERROR))&&lt.some(({audioCodec:xt})=>tt.audioCodec!==xt),yt=s.sourceBufferName==="video"&&(ot===ErrorDetails.BUFFER_ADD_CODEC_ERROR||ot===ErrorDetails.BUFFER_APPEND_ERROR)&&lt.some(({codecSet:xt,audioCodec:wt})=>tt.codecSet!==xt&&tt.audioCodec===wt),{type:vt,groupId:Et}=(nt=s.context)!=null?nt:{};for(let xt=lt.length;xt--;){const wt=(xt+ct)%lt.length;if(wt!==ct&&wt>=ht&&wt<=ft&&lt[wt].loadError===0){var it,st;const Rt=lt[wt];if(ot===ErrorDetails.FRAG_GAP&&dt===PlaylistLevelType.MAIN&&s.frag){const Ct=lt[wt].details;if(Ct){const Ft=findFragmentByPTS(s.frag,Ct.fragments,s.frag.start);if(Ft!=null&&Ft.gap)continue}}else{if(vt===PlaylistContextType.AUDIO_TRACK&&Rt.hasAudioGroup(Et)||vt===PlaylistContextType.SUBTITLE_TRACK&&Rt.hasSubtitleGroup(Et))continue;if(dt===PlaylistLevelType.AUDIO&&(it=tt.audioGroups)!=null&&it.some(Ct=>Rt.hasAudioGroup(Ct))||dt===PlaylistLevelType.SUBTITLE&&(st=tt.subtitleGroups)!=null&&st.some(Ct=>Rt.hasSubtitleGroup(Ct))||gt&&tt.audioCodec===Rt.audioCodec||!gt&&tt.audioCodec!==Rt.audioCodec||yt&&tt.codecSet===Rt.codecSet)continue}at=wt;break}}if(at>-1&&et.loadLevel!==at)return s.levelRetry=!0,this.playlistError=0,{action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.None,nextAutoLevel:at}}return{action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.MoveAllAlternatesMatchingHost}}onErrorOut(s,a){var et;switch((et=a.errorAction)==null?void 0:et.action){case NetworkErrorAction.DoNothing:break;case NetworkErrorAction.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(a),!a.errorAction.resolved&&a.details!==ErrorDetails.FRAG_GAP?a.fatal=!0:/MediaSource readyState: ended/.test(a.error.message)&&(this.warn(`MediaSource ended after "${a.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(a.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(s){const a=this.hls,et=s.errorAction;if(!et)return;const{flags:tt,hdcpLevel:rt,nextAutoLevel:nt}=et;switch(tt){case ErrorActionFlags.None:this.switchLevel(s,nt);break;case ErrorActionFlags.MoveAllAlternatesMatchingHDCP:rt&&(a.maxHdcpLevel=HdcpLevels[HdcpLevels.indexOf(rt)-1],et.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${a.maxHdcpLevel}" or lower`);break}et.resolved||this.switchLevel(s,nt)}switchLevel(s,a){a!==void 0&&s.errorAction&&(this.warn(`switching to level ${a} after ${s.details}`),this.hls.nextAutoLevel=a,s.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}}class BasePlaylistController{constructor(s,a){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=logger.log.bind(logger,`${a}:`),this.warn=logger.warn.bind(logger,`${a}:`),this.hls=s}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(s,a,et){const tt=a?.renditionReports;if(tt){let rt=-1;for(let nt=0;nt<tt.length;nt++){const it=tt[nt];let st;try{st=new self.URL(it.URI,a.url).href}catch(ot){logger.warn(`Could not construct new URL for Rendition Report: ${ot}`),st=it.URI||""}if(st===s){rt=nt;break}else st===s.substring(0,st.length)&&(rt=nt)}if(rt!==-1){const nt=tt[rt],it=parseInt(nt["LAST-MSN"])||a?.lastPartSn;let st=parseInt(nt["LAST-PART"])||a?.lastPartIndex;if(this.hls.config.lowLatencyMode){const at=Math.min(a.age-a.partTarget,a.targetduration);st>=0&&at>a.partTarget&&(st+=1)}const ot=et&&getSkipValue(et);return new HlsUrlParameters(it,st>=0?st:void 0,ot)}}}loadPlaylist(s){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(s){return this.canLoad&&!!s&&!!s.url&&(!s.details||s.details.live)}shouldReloadPlaylist(s){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(s)}playlistLoaded(s,a,et){const{details:tt,stats:rt}=a,nt=self.performance.now(),it=rt.loading.first?Math.max(0,nt-rt.loading.first):0;if(tt.advancedDateTime=Date.now()-it,tt.live||et!=null&&et.live){if(tt.reloaded(et),et&&this.log(`live playlist ${s} ${tt.advanced?"REFRESHED "+tt.lastPartSn+"-"+tt.lastPartIndex:tt.updated?"UPDATED":"MISSED"}`),et&&tt.fragments.length>0&&mergeDetails(et,tt),!this.canLoad||!tt.live)return;let st,ot,at;if(tt.canBlockReload&&tt.endSN&&tt.advanced){const pt=this.hls.config.lowLatencyMode,gt=tt.lastPartSn,mt=tt.endSN,yt=tt.lastPartIndex,vt=yt!==-1,Et=gt===mt,xt=pt?0:yt;vt?(ot=Et?mt+1:gt,at=Et?xt:yt+1):ot=mt+1;const wt=tt.age,Rt=wt+tt.ageHeader;let Ct=Math.min(Rt-tt.partTarget,tt.targetduration*1.5);if(Ct>0){if(et&&Ct>et.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${et.tuneInGoal} to: ${Ct} with playlist age: ${tt.age}`),Ct=0;else{const Ft=Math.floor(Ct/tt.targetduration);if(ot+=Ft,at!==void 0){const zt=Math.round(Ct%tt.targetduration/tt.partTarget);at+=zt}this.log(`CDN Tune-in age: ${tt.ageHeader}s last advanced ${wt.toFixed(2)}s goal: ${Ct} skip sn ${Ft} to part ${at}`)}tt.tuneInGoal=Ct}if(st=this.getDeliveryDirectives(tt,a.deliveryDirectives,ot,at),pt||!Et){this.loadPlaylist(st);return}}else(tt.canBlockReload||tt.canSkipUntil)&&(st=this.getDeliveryDirectives(tt,a.deliveryDirectives,ot,at));const lt=this.hls.mainForwardBufferInfo,ct=lt?lt.end-lt.len:0,ht=(tt.edge-ct)*1e3,ft=computeReloadInterval(tt,ht);tt.updated&&nt>this.requestScheduled+ft&&(this.requestScheduled=rt.loading.start),ot!==void 0&&tt.canBlockReload?this.requestScheduled=rt.loading.first+ft-(tt.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+ft<nt?this.requestScheduled=nt:this.requestScheduled-nt<=0&&(this.requestScheduled+=ft);let dt=this.requestScheduled-nt;dt=Math.max(0,dt),this.log(`reload live playlist ${s} in ${Math.round(dt)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(st),dt)}else this.clearTimer()}getDeliveryDirectives(s,a,et,tt){let rt=getSkipValue(s);return a!=null&&a.skip&&s.deltaUpdateFailed&&(et=a.msn,tt=a.part,rt=HlsSkip.No),new HlsUrlParameters(et,tt,rt)}checkRetry(s){const a=s.details,et=isTimeoutError(s),tt=s.errorAction,{action:rt,retryCount:nt=0,retryConfig:it}=tt||{},st=!!tt&&!!it&&(rt===NetworkErrorAction.RetryRequest||!tt.resolved&&rt===NetworkErrorAction.SendAlternateToPenaltyBox);if(st){var ot;if(this.requestScheduled=-1,nt>=it.maxNumRetry)return!1;if(et&&(ot=s.context)!=null&&ot.deliveryDirectives)this.warn(`Retrying playlist loading ${nt+1}/${it.maxNumRetry} after "${a}" without delivery-directives`),this.loadPlaylist();else{const at=getRetryDelay(it,nt);this.timer=self.setTimeout(()=>this.loadPlaylist(),at),this.warn(`Retrying playlist loading ${nt+1}/${it.maxNumRetry} after "${a}" in ${at}ms`)}s.levelRetry=!0,tt.resolved=!0}return st}}class EWMA{constructor(s,a=0,et=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=s,this.alpha_=s?Math.exp(Math.log(.5)/s):0,this.estimate_=a,this.totalWeight_=et}sample(s,a){const et=Math.pow(this.alpha_,s);this.estimate_=a*(1-et)+et*this.estimate_,this.totalWeight_+=s}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const s=1-Math.pow(this.alpha_,this.totalWeight_);if(s)return this.estimate_/s}return this.estimate_}}class EwmaBandWidthEstimator{constructor(s,a,et,tt=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=et,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new EWMA(s),this.fast_=new EWMA(a),this.defaultTTFB_=tt,this.ttfb_=new EWMA(s)}update(s,a){const{slow_:et,fast_:tt,ttfb_:rt}=this;et.halfLife!==s&&(this.slow_=new EWMA(s,et.getEstimate(),et.getTotalWeight())),tt.halfLife!==a&&(this.fast_=new EWMA(a,tt.getEstimate(),tt.getTotalWeight())),rt.halfLife!==s&&(this.ttfb_=new EWMA(s,rt.getEstimate(),rt.getTotalWeight()))}sample(s,a){s=Math.max(s,this.minDelayMs_);const et=8*a,tt=s/1e3,rt=et/tt;this.fast_.sample(tt,rt),this.slow_.sample(tt,rt)}sampleTTFB(s){const a=s/1e3,et=Math.sqrt(2)*Math.exp(-Math.pow(a,2)/2);this.ttfb_.sample(et,Math.max(s,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}const SUPPORTED_INFO_DEFAULT={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},SUPPORTED_INFO_CACHE={};function requiresMediaCapabilitiesDecodingInfo(o,s,a,et,tt,rt){const nt=o.audioCodec?o.audioGroups:null,it=rt?.audioCodec,st=rt?.channels,ot=st?parseInt(st):it?1/0:2;let at=null;if(nt!=null&&nt.length)try{nt.length===1&&nt[0]?at=s.groups[nt[0]].channels:at=nt.reduce((lt,ct)=>{if(ct){const ht=s.groups[ct];if(!ht)throw new Error(`Audio track group ${ct} not found`);Object.keys(ht.channels).forEach(ft=>{lt[ft]=(lt[ft]||0)+ht.channels[ft]})}return lt},{2:0})}catch{return!0}return o.videoCodec!==void 0&&(o.width>1920&&o.height>1088||o.height>1920&&o.width>1088||o.frameRate>Math.max(et,30)||o.videoRange!=="SDR"&&o.videoRange!==a||o.bitrate>Math.max(tt,8e6))||!!at&&isFiniteNumber(ot)&&Object.keys(at).some(lt=>parseInt(lt)>ot)}function getMediaDecodingInfoPromise(o,s,a){const et=o.videoCodec,tt=o.audioCodec;if(!et||!tt||!a)return Promise.resolve(SUPPORTED_INFO_DEFAULT);const rt={width:o.width,height:o.height,bitrate:Math.ceil(Math.max(o.bitrate*.9,o.averageBitrate)),framerate:o.frameRate||30},nt=o.videoRange;nt!=="SDR"&&(rt.transferFunction=nt.toLowerCase());const it=et.split(",").map(st=>({type:"media-source",video:_objectSpread2(_objectSpread2({},rt),{},{contentType:mimeTypeForCodec(st,"video")})}));return tt&&o.audioGroups&&o.audioGroups.forEach(st=>{var ot;st&&((ot=s.groups[st])==null||ot.tracks.forEach(at=>{if(at.groupId===st){const lt=at.channels||"",ct=parseFloat(lt);isFiniteNumber(ct)&&ct>2&&it.push.apply(it,tt.split(",").map(ht=>({type:"media-source",audio:{contentType:mimeTypeForCodec(ht,"audio"),channels:""+ct}})))}}))}),Promise.all(it.map(st=>{const ot=getMediaDecodingInfoKey(st);return SUPPORTED_INFO_CACHE[ot]||(SUPPORTED_INFO_CACHE[ot]=a.decodingInfo(st))})).then(st=>({supported:!st.some(ot=>!ot.supported),configurations:it,decodingInfoResults:st})).catch(st=>({supported:!1,configurations:it,decodingInfoResults:[],error:st}))}function getMediaDecodingInfoKey(o){const{audio:s,video:a}=o,et=a||s;if(et){const tt=et.contentType.split('"')[1];if(a)return`r${a.height}x${a.width}f${Math.ceil(a.framerate)}${a.transferFunction||"sd"}_${tt}_${Math.ceil(a.bitrate/1e5)}`;if(s)return`c${s.channels}${s.spatialRendering?"s":"n"}_${tt}`}return""}function isHdrSupported(){if(typeof matchMedia=="function"){const o=matchMedia("(dynamic-range: high)"),s=matchMedia("bad query");if(o.media!==s.media)return o.matches===!0}return!1}function getVideoSelectionOptions(o,s){let a=!1,et=[];return o&&(a=o!=="SDR",et=[o]),s&&(et=s.allowedVideoRanges||VideoRangeValues.slice(0),a=s.preferHDR!==void 0?s.preferHDR:isHdrSupported(),a?et=et.filter(tt=>tt!=="SDR"):et=["SDR"]),{preferHDR:a,allowedVideoRanges:et}}function getStartCodecTier(o,s,a,et,tt){const rt=Object.keys(o),nt=et?.channels,it=et?.audioCodec,st=nt&&parseInt(nt)===2;let ot=!0,at=!1,lt=1/0,ct=1/0,ht=1/0,ft=0,dt=[];const{preferHDR:pt,allowedVideoRanges:gt}=getVideoSelectionOptions(s,tt);for(let Et=rt.length;Et--;){const xt=o[rt[Et]];ot=xt.channels[2]>0,lt=Math.min(lt,xt.minHeight),ct=Math.min(ct,xt.minFramerate),ht=Math.min(ht,xt.minBitrate);const wt=gt.filter(Rt=>xt.videoRanges[Rt]>0);wt.length>0&&(at=!0,dt=wt)}lt=isFiniteNumber(lt)?lt:0,ct=isFiniteNumber(ct)?ct:0;const mt=Math.max(1080,lt),yt=Math.max(30,ct);return ht=isFiniteNumber(ht)?ht:a,a=Math.max(ht,a),at||(s=void 0,dt=[]),{codecSet:rt.reduce((Et,xt)=>{const wt=o[xt];if(xt===Et)return Et;if(wt.minBitrate>a)return logStartCodecCandidateIgnored(xt,`min bitrate of ${wt.minBitrate} > current estimate of ${a}`),Et;if(!wt.hasDefaultAudio)return logStartCodecCandidateIgnored(xt,"no renditions with default or auto-select sound found"),Et;if(it&&xt.indexOf(it.substring(0,4))%5!==0)return logStartCodecCandidateIgnored(xt,`audio codec preference "${it}" not found`),Et;if(nt&&!st){if(!wt.channels[nt])return logStartCodecCandidateIgnored(xt,`no renditions with ${nt} channel sound found (channels options: ${Object.keys(wt.channels)})`),Et}else if((!it||st)&&ot&&wt.channels[2]===0)return logStartCodecCandidateIgnored(xt,"no renditions with stereo sound found"),Et;return wt.minHeight>mt?(logStartCodecCandidateIgnored(xt,`min resolution of ${wt.minHeight} > maximum of ${mt}`),Et):wt.minFramerate>yt?(logStartCodecCandidateIgnored(xt,`min framerate of ${wt.minFramerate} > maximum of ${yt}`),Et):dt.some(Rt=>wt.videoRanges[Rt]>0)?wt.maxScore<ft?(logStartCodecCandidateIgnored(xt,`max score of ${wt.maxScore} < selected max of ${ft}`),Et):Et&&(codecsSetSelectionPreferenceValue(xt)>=codecsSetSelectionPreferenceValue(Et)||wt.fragmentError>o[Et].fragmentError)?Et:(ft=wt.maxScore,xt):(logStartCodecCandidateIgnored(xt,`no variants with VIDEO-RANGE of ${JSON.stringify(dt)} found`),Et)},void 0),videoRanges:dt,preferHDR:pt,minFramerate:ct,minBitrate:ht}}function logStartCodecCandidateIgnored(o,s){logger.log(`[abr] start candidates with "${o}" ignored because ${s}`)}function getAudioTracksByGroup(o){return o.reduce((s,a)=>{let et=s.groups[a.groupId];et||(et=s.groups[a.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),et.tracks.push(a);const tt=a.channels||"2";return et.channels[tt]=(et.channels[tt]||0)+1,et.hasDefault=et.hasDefault||a.default,et.hasAutoSelect=et.hasAutoSelect||a.autoselect,et.hasDefault&&(s.hasDefaultAudio=!0),et.hasAutoSelect&&(s.hasAutoSelectAudio=!0),s},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function getCodecTiers(o,s,a,et){return o.slice(a,et+1).reduce((tt,rt)=>{if(!rt.codecSet)return tt;const nt=rt.audioGroups;let it=tt[rt.codecSet];it||(tt[rt.codecSet]=it={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!nt,fragmentError:0}),it.minBitrate=Math.min(it.minBitrate,rt.bitrate);const st=Math.min(rt.height,rt.width);return it.minHeight=Math.min(it.minHeight,st),it.minFramerate=Math.min(it.minFramerate,rt.frameRate),it.maxScore=Math.max(it.maxScore,rt.score),it.fragmentError+=rt.fragmentError,it.videoRanges[rt.videoRange]=(it.videoRanges[rt.videoRange]||0)+1,nt&&nt.forEach(ot=>{if(!ot)return;const at=s.groups[ot];at&&(it.hasDefaultAudio=it.hasDefaultAudio||s.hasDefaultAudio?at.hasDefault:at.hasAutoSelect||!s.hasDefaultAudio&&!s.hasAutoSelectAudio,Object.keys(at.channels).forEach(lt=>{it.channels[lt]=(it.channels[lt]||0)+at.channels[lt]}))}),tt},{})}function findMatchingOption(o,s,a){if("attrs"in o){const et=s.indexOf(o);if(et!==-1)return et}for(let et=0;et<s.length;et++){const tt=s[et];if(matchesOption(o,tt,a))return et}return-1}function matchesOption(o,s,a){const{groupId:et,name:tt,lang:rt,assocLang:nt,characteristics:it,default:st}=o,ot=o.forced;return(et===void 0||s.groupId===et)&&(tt===void 0||s.name===tt)&&(rt===void 0||s.lang===rt)&&(rt===void 0||s.assocLang===nt)&&(st===void 0||s.default===st)&&(ot===void 0||s.forced===ot)&&(it===void 0||characteristicsMatch(it,s.characteristics))&&(a===void 0||a(o,s))}function characteristicsMatch(o,s=""){const a=o.split(","),et=s.split(",");return a.length===et.length&&!a.some(tt=>et.indexOf(tt)===-1)}function audioMatchPredicate(o,s){const{audioCodec:a,channels:et}=o;return(a===void 0||(s.audioCodec||"").substring(0,4)===a.substring(0,4))&&(et===void 0||et===(s.channels||"2"))}function findClosestLevelWithAudioGroup(o,s,a,et,tt){const rt=s[et],it=s.reduce((ct,ht,ft)=>{const dt=ht.uri;return(ct[dt]||(ct[dt]=[])).push(ft),ct},{})[rt.uri];it.length>1&&(et=Math.max.apply(Math,it));const st=rt.videoRange,ot=rt.frameRate,at=rt.codecSet.substring(0,4),lt=searchDownAndUpList(s,et,ct=>{if(ct.videoRange!==st||ct.frameRate!==ot||ct.codecSet.substring(0,4)!==at)return!1;const ht=ct.audioGroups,ft=a.filter(dt=>!ht||ht.indexOf(dt.groupId)!==-1);return findMatchingOption(o,ft,tt)>-1});return lt>-1?lt:searchDownAndUpList(s,et,ct=>{const ht=ct.audioGroups,ft=a.filter(dt=>!ht||ht.indexOf(dt.groupId)!==-1);return findMatchingOption(o,ft,tt)>-1})}function searchDownAndUpList(o,s,a){for(let et=s;et;et--)if(a(o[et]))return et;for(let et=s+1;et<o.length;et++)if(a(o[et]))return et;return-1}class AbrController{constructor(s){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=()=>{const{fragCurrent:a,partCurrent:et,hls:tt}=this,{autoLevelEnabled:rt,media:nt}=tt;if(!a||!nt)return;const it=performance.now(),st=et?et.stats:a.stats,ot=et?et.duration:a.duration,at=it-st.loading.start,lt=tt.minAutoLevel;if(st.aborted||st.loaded&&st.loaded===st.total||a.level<=lt){this.clearTimer(),this._nextAutoLevel=-1;return}if(!rt||nt.paused||!nt.playbackRate||!nt.readyState)return;const ct=tt.mainForwardBufferInfo;if(ct===null)return;const ht=this.bwEstimator.getEstimateTTFB(),ft=Math.abs(nt.playbackRate);if(at<=Math.max(ht,1e3*(ot/(ft*2))))return;const dt=ct.len/ft,pt=st.loading.first?st.loading.first-st.loading.start:-1,gt=st.loaded&&pt>-1,mt=this.getBwEstimate(),yt=tt.levels,vt=yt[a.level],Et=st.total||Math.max(st.loaded,Math.round(ot*vt.averageBitrate/8));let xt=gt?at-pt:at;xt<1&&gt&&(xt=Math.min(at,st.loaded*8/mt));const wt=gt?st.loaded*1e3/xt:0,Rt=wt?(Et-st.loaded)/wt:Et*8/mt+ht/1e3;if(Rt<=dt)return;const Ct=wt?wt*8:mt;let Ft=Number.POSITIVE_INFINITY,zt;for(zt=a.level-1;zt>lt;zt--){const Kt=yt[zt].maxBitrate;if(Ft=this.getTimeToLoadFrag(ht/1e3,Ct,ot*Kt,!yt[zt].details),Ft<dt)break}if(Ft>=Rt||Ft>ot*10)return;tt.nextLoadLevel=tt.nextAutoLevel=zt,gt?this.bwEstimator.sample(at-Math.min(ht,pt),st.loaded):this.bwEstimator.sampleTTFB(at);const Nt=yt[zt].maxBitrate;this.getBwEstimate()*this.hls.config.abrBandWidthUpFactor>Nt&&this.resetEstimator(Nt),this.clearTimer(),logger.warn(`[abr] Fragment ${a.sn}${et?" part "+et.index:""} of level ${a.level} is loading too slowly;
      Time to underbuffer: ${dt.toFixed(3)} s
      Estimated load time for current fragment: ${Rt.toFixed(3)} s
      Estimated load time for down switch fragment: ${Ft.toFixed(3)} s
      TTFB estimate: ${pt|0} ms
      Current BW estimate: ${isFiniteNumber(mt)?mt|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${zt} @ ${Nt|0} bps`),tt.trigger(Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:a,part:et,stats:st})},this.hls=s,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(s){s&&(logger.log(`setting initial bwe to ${s}`),this.hls.config.abrEwmaDefaultEstimate=s),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const s=this.hls.config;return new EwmaBandWidthEstimator(s.abrEwmaSlowVoD,s.abrEwmaFastVoD,s.abrEwmaDefaultEstimate)}registerListeners(){const{hls:s}=this;s.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(Events.FRAG_LOADING,this.onFragLoading,this),s.on(Events.FRAG_LOADED,this.onFragLoaded,this),s.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),s.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),s.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),s.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),s.on(Events.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),s.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:s}=this;s&&(s.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(Events.FRAG_LOADING,this.onFragLoading,this),s.off(Events.FRAG_LOADED,this.onFragLoaded,this),s.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),s.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),s.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),s.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),s.off(Events.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),s.off(Events.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(s,a){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(s,a){const et=a.frag;if(!this.ignoreFragment(et)){if(!et.bitrateTest){var tt;this.fragCurrent=et,this.partCurrent=(tt=a.part)!=null?tt:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(s,a){this.clearTimer()}onError(s,a){if(!a.fatal)switch(a.details){case ErrorDetails.BUFFER_ADD_CODEC_ERROR:case ErrorDetails.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case ErrorDetails.FRAG_LOAD_TIMEOUT:{const et=a.frag,{fragCurrent:tt,partCurrent:rt}=this;if(et&&tt&&et.sn===tt.sn&&et.level===tt.level){const nt=performance.now(),it=rt?rt.stats:et.stats,st=nt-it.loading.start,ot=it.loading.first?it.loading.first-it.loading.start:-1;if(it.loaded&&ot>-1){const lt=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(st-Math.min(lt,ot),it.loaded)}else this.bwEstimator.sampleTTFB(st)}break}}}getTimeToLoadFrag(s,a,et,tt){const rt=s+et/a,nt=tt?this.lastLevelLoadSec:0;return rt+nt}onLevelLoaded(s,a){const et=this.hls.config,{loading:tt}=a.stats,rt=tt.end-tt.start;isFiniteNumber(rt)&&(this.lastLevelLoadSec=rt/1e3),a.details.live?this.bwEstimator.update(et.abrEwmaSlowLive,et.abrEwmaFastLive):this.bwEstimator.update(et.abrEwmaSlowVoD,et.abrEwmaFastVoD)}onFragLoaded(s,{frag:a,part:et}){const tt=et?et.stats:a.stats;if(a.type===PlaylistLevelType.MAIN&&this.bwEstimator.sampleTTFB(tt.loading.first-tt.loading.start),!this.ignoreFragment(a)){if(this.clearTimer(),a.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const rt=et?et.duration:a.duration,nt=this.hls.levels[a.level],it=(nt.loaded?nt.loaded.bytes:0)+tt.loaded,st=(nt.loaded?nt.loaded.duration:0)+rt;nt.loaded={bytes:it,duration:st},nt.realBitrate=Math.round(8*it/st)}if(a.bitrateTest){const rt={stats:tt,frag:a,part:et,id:a.type};this.onFragBuffered(Events.FRAG_BUFFERED,rt),a.bitrateTest=!1}else this.lastLoadedFragLevel=a.level}}onFragBuffered(s,a){const{frag:et,part:tt}=a,rt=tt!=null&&tt.stats.loaded?tt.stats:et.stats;if(rt.aborted||this.ignoreFragment(et))return;const nt=rt.parsing.end-rt.loading.start-Math.min(rt.loading.first-rt.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(nt,rt.loaded),rt.bwEstimate=this.getBwEstimate(),et.bitrateTest?this.bitrateTestDelay=nt/1e3:this.bitrateTestDelay=0}ignoreFragment(s){return s.type!==PlaylistLevelType.MAIN||s.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:s,minAutoLevel:a}=this.hls,et=this.getBwEstimate(),tt=this.hls.config.maxStarvationDelay,rt=this.findBestLevel(et,a,s,0,tt,1,1);if(rt>-1)return rt;const nt=this.hls.firstLevel,it=Math.min(Math.max(nt,a),s);return logger.warn(`[abr] Could not find best starting auto level. Defaulting to first in playlist ${nt} clamped to ${it}`),it}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const s=this.forcedAutoLevel,et=this.bwEstimator.canEstimate(),tt=this.lastLoadedFragLevel>-1;if(s!==-1&&(!et||!tt||this.nextAutoLevelKey===this.getAutoLevelKey()))return s;const rt=et&&tt?this.getNextABRAutoLevel():this.firstAutoLevel;if(s!==-1){const nt=this.hls.levels;if(nt.length>Math.max(s,rt)&&nt[s].loadError<=nt[rt].loadError)return s}return this._nextAutoLevel=rt,this.nextAutoLevelKey=this.getAutoLevelKey(),rt}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:s,partCurrent:a,hls:et}=this,{maxAutoLevel:tt,config:rt,minAutoLevel:nt}=et,it=a?a.duration:s?s.duration:0,st=this.getBwEstimate(),ot=this.getStarvationDelay();let at=rt.abrBandWidthFactor,lt=rt.abrBandWidthUpFactor;if(ot){const pt=this.findBestLevel(st,nt,tt,ot,0,at,lt);if(pt>=0)return pt}let ct=it?Math.min(it,rt.maxStarvationDelay):rt.maxStarvationDelay;if(!ot){const pt=this.bitrateTestDelay;pt&&(ct=(it?Math.min(it,rt.maxLoadingDelay):rt.maxLoadingDelay)-pt,logger.info(`[abr] bitrate test took ${Math.round(1e3*pt)}ms, set first fragment max fetchDuration to ${Math.round(1e3*ct)} ms`),at=lt=1)}const ht=this.findBestLevel(st,nt,tt,ot,ct,at,lt);if(logger.info(`[abr] ${ot?"rebuffering expected":"buffer is empty"}, optimal quality level ${ht}`),ht>-1)return ht;const ft=et.levels[nt],dt=et.levels[et.loadLevel];return ft?.bitrate<dt?.bitrate?nt:et.loadLevel}getStarvationDelay(){const s=this.hls,a=s.media;if(!a)return 1/0;const et=a&&a.playbackRate!==0?Math.abs(a.playbackRate):1,tt=s.mainForwardBufferInfo;return(tt?tt.len:0)/et}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(s,a,et,tt,rt,nt,it){var st;const ot=tt+rt,at=this.lastLoadedFragLevel,lt=at===-1?this.hls.firstLevel:at,{fragCurrent:ct,partCurrent:ht}=this,{levels:ft,allAudioTracks:dt,loadLevel:pt,config:gt}=this.hls;if(ft.length===1)return 0;const mt=ft[lt],yt=!!(mt!=null&&(st=mt.details)!=null&&st.live),vt=pt===-1||at===-1;let Et,xt="SDR",wt=mt?.frameRate||0;const{audioPreference:Rt,videoPreference:Ct}=gt,Ft=this.audioTracksByGroup||(this.audioTracksByGroup=getAudioTracksByGroup(dt));if(vt){if(this.firstSelection!==-1)return this.firstSelection;const Bt=this.codecTiers||(this.codecTiers=getCodecTiers(ft,Ft,a,et)),Pt=getStartCodecTier(Bt,xt,s,Rt,Ct),{codecSet:Dt,videoRanges:Tt,minFramerate:St,minBitrate:Mt,preferHDR:jt}=Pt;Et=Dt,xt=jt?Tt[Tt.length-1]:Tt[0],wt=St,s=Math.max(s,Mt),logger.log(`[abr] picked start tier ${JSON.stringify(Pt)}`)}else Et=mt?.codecSet,xt=mt?.videoRange;const zt=ht?ht.duration:ct?ct.duration:0,Nt=this.bwEstimator.getEstimateTTFB()/1e3,Kt=[];for(let Bt=et;Bt>=a;Bt--){var Yt;const Pt=ft[Bt],Dt=Bt>lt;if(!Pt)continue;if(gt.useMediaCapabilities&&!Pt.supportedResult&&!Pt.supportedPromise){const At=navigator.mediaCapabilities;typeof At?.decodingInfo=="function"&&requiresMediaCapabilitiesDecodingInfo(Pt,Ft,xt,wt,s,Rt)?(Pt.supportedPromise=getMediaDecodingInfoPromise(Pt,Ft,At),Pt.supportedPromise.then($t=>{if(!this.hls)return;Pt.supportedResult=$t;const kt=this.hls.levels,Lt=kt.indexOf(Pt);$t.error?logger.warn(`[abr] MediaCapabilities decodingInfo error: "${$t.error}" for level ${Lt} ${JSON.stringify($t)}`):$t.supported||(logger.warn(`[abr] Unsupported MediaCapabilities decodingInfo result for level ${Lt} ${JSON.stringify($t)}`),Lt>-1&&kt.length>1&&(logger.log(`[abr] Removing unsupported level ${Lt}`),this.hls.removeLevel(Lt)))})):Pt.supportedResult=SUPPORTED_INFO_DEFAULT}if(Et&&Pt.codecSet!==Et||xt&&Pt.videoRange!==xt||Dt&&wt>Pt.frameRate||!Dt&&wt>0&&wt<Pt.frameRate||Pt.supportedResult&&!((Yt=Pt.supportedResult.decodingInfoResults)!=null&&Yt[0].smooth)){Kt.push(Bt);continue}const Tt=Pt.details,St=(ht?Tt?.partTarget:Tt?.averagetargetduration)||zt;let Mt;Dt?Mt=it*s:Mt=nt*s;const jt=zt&&tt>=zt*2&&rt===0?ft[Bt].averageBitrate:ft[Bt].maxBitrate,Gt=this.getTimeToLoadFrag(Nt,Mt,jt*St,Tt===void 0);if(Mt>=jt&&(Bt===at||Pt.loadError===0&&Pt.fragmentError===0)&&(Gt<=Nt||!isFiniteNumber(Gt)||yt&&!this.bitrateTestDelay||Gt<ot)){const At=this.forcedAutoLevel;return Bt!==pt&&(At===-1||At!==pt)&&(Kt.length&&logger.trace(`[abr] Skipped level(s) ${Kt.join(",")} of ${et} max with CODECS and VIDEO-RANGE:"${ft[Kt[0]].codecs}" ${ft[Kt[0]].videoRange}; not compatible with "${mt.codecs}" ${xt}`),logger.info(`[abr] switch candidate:${lt}->${Bt} adjustedbw(${Math.round(Mt)})-bitrate=${Math.round(Mt-jt)} ttfb:${Nt.toFixed(1)} avgDuration:${St.toFixed(1)} maxFetchDuration:${ot.toFixed(1)} fetchDuration:${Gt.toFixed(1)} firstSelection:${vt} codecSet:${Et} videoRange:${xt} hls.loadLevel:${pt}`)),vt&&(this.firstSelection=Bt),Bt}}return-1}set nextAutoLevel(s){const{maxAutoLevel:a,minAutoLevel:et}=this.hls,tt=Math.min(Math.max(s,et),a);this._nextAutoLevel!==tt&&(this.nextAutoLevelKey="",this._nextAutoLevel=tt)}}class TaskLoop{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(s){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,s),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}var FragmentState={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class FragmentTracker{constructor(s){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=s,this._registerListeners()}_registerListeners(){const{hls:s}=this;s.on(Events.BUFFER_APPENDED,this.onBufferAppended,this),s.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),s.on(Events.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:s}=this;s.off(Events.BUFFER_APPENDED,this.onBufferAppended,this),s.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),s.off(Events.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(s,a){const et=this.activePartLists[a];if(et)for(let tt=et.length;tt--;){const rt=et[tt];if(!rt)break;const nt=rt.end;if(rt.start<=s&&nt!==null&&s<=nt)return rt}return this.getBufferedFrag(s,a)}getBufferedFrag(s,a){const{fragments:et}=this,tt=Object.keys(et);for(let rt=tt.length;rt--;){const nt=et[tt[rt]];if(nt?.body.type===a&&nt.buffered){const it=nt.body;if(it.start<=s&&s<=it.end)return it}}return null}detectEvictedFragments(s,a,et,tt){this.timeRanges&&(this.timeRanges[s]=a);const rt=tt?.fragment.sn||-1;Object.keys(this.fragments).forEach(nt=>{const it=this.fragments[nt];if(!it||rt>=it.body.sn)return;if(!it.buffered&&!it.loaded){it.body.type===et&&this.removeFragment(it.body);return}const st=it.range[s];st&&st.time.some(ot=>{const at=!this.isTimeBuffered(ot.startPTS,ot.endPTS,a);return at&&this.removeFragment(it.body),at})})}detectPartialFragments(s){const a=this.timeRanges,{frag:et,part:tt}=s;if(!a||et.sn==="initSegment")return;const rt=getFragmentKey(et),nt=this.fragments[rt];if(!nt||nt.buffered&&et.gap)return;const it=!et.relurl;Object.keys(a).forEach(st=>{const ot=et.elementaryStreams[st];if(!ot)return;const at=a[st],lt=it||ot.partial===!0;nt.range[st]=this.getBufferedTimes(et,tt,lt,at)}),nt.loaded=null,Object.keys(nt.range).length?(nt.buffered=!0,(nt.body.endList=et.endList||nt.body.endList)&&(this.endListFragments[nt.body.type]=nt),isPartial(nt)||this.removeParts(et.sn-1,et.type)):this.removeFragment(nt.body)}removeParts(s,a){const et=this.activePartLists[a];et&&(this.activePartLists[a]=et.filter(tt=>tt.fragment.sn>=s))}fragBuffered(s,a){const et=getFragmentKey(s);let tt=this.fragments[et];!tt&&a&&(tt=this.fragments[et]={body:s,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},s.gap&&(this.hasGaps=!0)),tt&&(tt.loaded=null,tt.buffered=!0)}getBufferedTimes(s,a,et,tt){const rt={time:[],partial:et},nt=s.start,it=s.end,st=s.minEndPTS||it,ot=s.maxStartPTS||nt;for(let at=0;at<tt.length;at++){const lt=tt.start(at)-this.bufferPadding,ct=tt.end(at)+this.bufferPadding;if(ot>=lt&&st<=ct){rt.time.push({startPTS:Math.max(nt,tt.start(at)),endPTS:Math.min(it,tt.end(at))});break}else if(nt<ct&&it>lt){const ht=Math.max(nt,tt.start(at)),ft=Math.min(it,tt.end(at));ft>ht&&(rt.partial=!0,rt.time.push({startPTS:ht,endPTS:ft}))}else if(it<=lt)break}return rt}getPartialFragment(s){let a=null,et,tt,rt,nt=0;const{bufferPadding:it,fragments:st}=this;return Object.keys(st).forEach(ot=>{const at=st[ot];at&&isPartial(at)&&(tt=at.body.start-it,rt=at.body.end+it,s>=tt&&s<=rt&&(et=Math.min(s-tt,rt-s),nt<=et&&(a=at.body,nt=et)))}),a}isEndListAppended(s){const a=this.endListFragments[s];return a!==void 0&&(a.buffered||isPartial(a))}getState(s){const a=getFragmentKey(s),et=this.fragments[a];return et?et.buffered?isPartial(et)?FragmentState.PARTIAL:FragmentState.OK:FragmentState.APPENDING:FragmentState.NOT_LOADED}isTimeBuffered(s,a,et){let tt,rt;for(let nt=0;nt<et.length;nt++){if(tt=et.start(nt)-this.bufferPadding,rt=et.end(nt)+this.bufferPadding,s>=tt&&a<=rt)return!0;if(a<=tt)return!1}return!1}onFragLoaded(s,a){const{frag:et,part:tt}=a;if(et.sn==="initSegment"||et.bitrateTest)return;const rt=tt?null:a,nt=getFragmentKey(et);this.fragments[nt]={body:et,appendedPTS:null,loaded:rt,buffered:!1,range:Object.create(null)}}onBufferAppended(s,a){const{frag:et,part:tt,timeRanges:rt}=a;if(et.sn==="initSegment")return;const nt=et.type;if(tt){let it=this.activePartLists[nt];it||(this.activePartLists[nt]=it=[]),it.push(tt)}this.timeRanges=rt,Object.keys(rt).forEach(it=>{const st=rt[it];this.detectEvictedFragments(it,st,nt,tt)})}onFragBuffered(s,a){this.detectPartialFragments(a)}hasFragment(s){const a=getFragmentKey(s);return!!this.fragments[a]}hasParts(s){var a;return!!((a=this.activePartLists[s])!=null&&a.length)}removeFragmentsInRange(s,a,et,tt,rt){tt&&!this.hasGaps||Object.keys(this.fragments).forEach(nt=>{const it=this.fragments[nt];if(!it)return;const st=it.body;st.type!==et||tt&&!st.gap||st.start<a&&st.end>s&&(it.buffered||rt)&&this.removeFragment(st)})}removeFragment(s){const a=getFragmentKey(s);s.stats.loaded=0,s.clearElementaryStreamInfo();const et=this.activePartLists[s.type];if(et){const tt=s.sn;this.activePartLists[s.type]=et.filter(rt=>rt.fragment.sn!==tt)}delete this.fragments[a],s.endList&&delete this.endListFragments[s.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function isPartial(o){var s,a,et;return o.buffered&&(o.body.gap||((s=o.range.video)==null?void 0:s.partial)||((a=o.range.audio)==null?void 0:a.partial)||((et=o.range.audiovideo)==null?void 0:et.partial))}function getFragmentKey(o){return`${o.type}_${o.level}_${o.sn}`}const noopBuffered={length:0,start:()=>0,end:()=>0};class BufferHelper{static isBuffered(s,a){try{if(s){const et=BufferHelper.getBuffered(s);for(let tt=0;tt<et.length;tt++)if(a>=et.start(tt)&&a<=et.end(tt))return!0}}catch{}return!1}static bufferInfo(s,a,et){try{if(s){const tt=BufferHelper.getBuffered(s),rt=[];let nt;for(nt=0;nt<tt.length;nt++)rt.push({start:tt.start(nt),end:tt.end(nt)});return this.bufferedInfo(rt,a,et)}}catch{}return{len:0,start:a,end:a,nextStart:void 0}}static bufferedInfo(s,a,et){a=Math.max(0,a),s.sort(function(ot,at){const lt=ot.start-at.start;return lt||at.end-ot.end});let tt=[];if(et)for(let ot=0;ot<s.length;ot++){const at=tt.length;if(at){const lt=tt[at-1].end;s[ot].start-lt<et?s[ot].end>lt&&(tt[at-1].end=s[ot].end):tt.push(s[ot])}else tt.push(s[ot])}else tt=s;let rt=0,nt,it=a,st=a;for(let ot=0;ot<tt.length;ot++){const at=tt[ot].start,lt=tt[ot].end;if(a+et>=at&&a<lt)it=at,st=lt,rt=st-a;else if(a+et<at){nt=at;break}}return{len:rt,start:it||0,end:st||0,nextStart:nt}}static getBuffered(s){try{return s.buffered}catch(a){return logger.log("failed to get media.buffered",a),noopBuffered}}}class ChunkMetadata{constructor(s,a,et,tt=0,rt=-1,nt=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=getNewPerformanceTiming(),this.buffering={audio:getNewPerformanceTiming(),video:getNewPerformanceTiming(),audiovideo:getNewPerformanceTiming()},this.level=s,this.sn=a,this.id=et,this.size=tt,this.part=rt,this.partial=nt}}function getNewPerformanceTiming(){return{start:0,executeStart:0,executeEnd:0,end:0}}function findFirstFragWithCC(o,s){for(let et=0,tt=o.length;et<tt;et++){var a;if(((a=o[et])==null?void 0:a.cc)===s)return o[et]}return null}function shouldAlignOnDiscontinuities(o,s,a){return!!(s&&(a.endCC>a.startCC||o&&o.cc<a.startCC))}function findDiscontinuousReferenceFrag(o,s){const a=o.fragments,et=s.fragments;if(!et.length||!a.length){logger.log("No fragments to align");return}const tt=findFirstFragWithCC(a,et[0].cc);if(!tt||tt&&!tt.startPTS){logger.log("No frag in previous level to align on");return}return tt}function adjustFragmentStart(o,s){if(o){const a=o.start+s;o.start=o.startPTS=a,o.endPTS=a+o.duration}}function adjustSlidingStart(o,s){const a=s.fragments;for(let et=0,tt=a.length;et<tt;et++)adjustFragmentStart(a[et],o);s.fragmentHint&&adjustFragmentStart(s.fragmentHint,o),s.alignedSliding=!0}function alignStream(o,s,a){s&&(alignDiscontinuities(o,a,s),!a.alignedSliding&&s&&alignMediaPlaylistByPDT(a,s),!a.alignedSliding&&s&&!a.skippedSegments&&adjustSliding(s,a))}function alignDiscontinuities(o,s,a){if(shouldAlignOnDiscontinuities(o,a,s)){const et=findDiscontinuousReferenceFrag(a,s);et&&isFiniteNumber(et.start)&&(logger.log(`Adjusting PTS using last level due to CC increase within current level ${s.url}`),adjustSlidingStart(et.start,s))}}function alignMediaPlaylistByPDT(o,s){if(!o.hasProgramDateTime||!s.hasProgramDateTime)return;const a=o.fragments,et=s.fragments;if(!a.length||!et.length)return;let tt,rt;const nt=Math.min(s.endCC,o.endCC);s.startCC<nt&&o.startCC<nt&&(tt=findFirstFragWithCC(et,nt),rt=findFirstFragWithCC(a,nt)),(!tt||!rt)&&(tt=et[Math.floor(et.length/2)],rt=findFirstFragWithCC(a,tt.cc)||a[Math.floor(a.length/2)]);const it=tt.programDateTime,st=rt.programDateTime;if(!it||!st)return;const ot=(st-it)/1e3-(rt.start-tt.start);adjustSlidingStart(ot,o)}const MIN_CHUNK_SIZE=Math.pow(2,17);class FragmentLoader{constructor(s){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=s}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(s,a){const et=s.url;if(!et)return Promise.reject(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:s,error:new Error(`Fragment does not have a ${et?"part list":"url"}`),networkDetails:null}));this.abort();const tt=this.config,rt=tt.fLoader,nt=tt.loader;return new Promise((it,st)=>{if(this.loader&&this.loader.destroy(),s.gap)if(s.tagList.some(ht=>ht[0]==="GAP")){st(createGapLoadError(s));return}else s.gap=!1;const ot=this.loader=s.loader=rt?new rt(tt):new nt(tt),at=createLoaderContext(s),lt=getLoaderConfigWithoutReties(tt.fragLoadPolicy.default),ct={loadPolicy:lt,timeout:lt.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:s.sn==="initSegment"?1/0:MIN_CHUNK_SIZE};s.stats=ot.stats,ot.load(at,ct,{onSuccess:(ht,ft,dt,pt)=>{this.resetLoader(s,ot);let gt=ht.data;dt.resetIV&&s.decryptdata&&(s.decryptdata.iv=new Uint8Array(gt.slice(0,16)),gt=gt.slice(16)),it({frag:s,part:null,payload:gt,networkDetails:pt})},onError:(ht,ft,dt,pt)=>{this.resetLoader(s,ot),st(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:s,response:_objectSpread2({url:et,data:void 0},ht),error:new Error(`HTTP Error ${ht.code} ${ht.text}`),networkDetails:dt,stats:pt}))},onAbort:(ht,ft,dt)=>{this.resetLoader(s,ot),st(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:s,error:new Error("Aborted"),networkDetails:dt,stats:ht}))},onTimeout:(ht,ft,dt)=>{this.resetLoader(s,ot),st(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:s,error:new Error(`Timeout after ${ct.timeout}ms`),networkDetails:dt,stats:ht}))},onProgress:(ht,ft,dt,pt)=>{a&&a({frag:s,part:null,payload:dt,networkDetails:pt})}})})}loadPart(s,a,et){this.abort();const tt=this.config,rt=tt.fLoader,nt=tt.loader;return new Promise((it,st)=>{if(this.loader&&this.loader.destroy(),s.gap||a.gap){st(createGapLoadError(s,a));return}const ot=this.loader=s.loader=rt?new rt(tt):new nt(tt),at=createLoaderContext(s,a),lt=getLoaderConfigWithoutReties(tt.fragLoadPolicy.default),ct={loadPolicy:lt,timeout:lt.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:MIN_CHUNK_SIZE};a.stats=ot.stats,ot.load(at,ct,{onSuccess:(ht,ft,dt,pt)=>{this.resetLoader(s,ot),this.updateStatsFromPart(s,a);const gt={frag:s,part:a,payload:ht.data,networkDetails:pt};et(gt),it(gt)},onError:(ht,ft,dt,pt)=>{this.resetLoader(s,ot),st(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:s,part:a,response:_objectSpread2({url:at.url,data:void 0},ht),error:new Error(`HTTP Error ${ht.code} ${ht.text}`),networkDetails:dt,stats:pt}))},onAbort:(ht,ft,dt)=>{s.stats.aborted=a.stats.aborted,this.resetLoader(s,ot),st(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:s,part:a,error:new Error("Aborted"),networkDetails:dt,stats:ht}))},onTimeout:(ht,ft,dt)=>{this.resetLoader(s,ot),st(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:s,part:a,error:new Error(`Timeout after ${ct.timeout}ms`),networkDetails:dt,stats:ht}))}})})}updateStatsFromPart(s,a){const et=s.stats,tt=a.stats,rt=tt.total;if(et.loaded+=tt.loaded,rt){const st=Math.round(s.duration/a.duration),ot=Math.min(Math.round(et.loaded/rt),st),lt=(st-ot)*Math.round(et.loaded/ot);et.total=et.loaded+lt}else et.total=Math.max(et.loaded,et.total);const nt=et.loading,it=tt.loading;nt.start?nt.first+=it.first-it.start:(nt.start=it.start,nt.first=it.first),nt.end=it.end}resetLoader(s,a){s.loader=null,this.loader===a&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),a.destroy()}}function createLoaderContext(o,s=null){const a=s||o,et={frag:o,part:s,responseType:"arraybuffer",url:a.url,headers:{},rangeStart:0,rangeEnd:0},tt=a.byteRangeStartOffset,rt=a.byteRangeEndOffset;if(isFiniteNumber(tt)&&isFiniteNumber(rt)){var nt;let it=tt,st=rt;if(o.sn==="initSegment"&&((nt=o.decryptdata)==null?void 0:nt.method)==="AES-128"){const ot=rt-tt;ot%16&&(st=rt+(16-ot%16)),tt!==0&&(et.resetIV=!0,it=tt-16)}et.rangeStart=it,et.rangeEnd=st}return et}function createGapLoadError(o,s){const a=new Error(`GAP ${o.gap?"tag":"attribute"} found`),et={type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_GAP,fatal:!1,frag:o,error:a,networkDetails:null};return s&&(et.part=s),(s||o).stats.aborted=!0,new LoadError(et)}class LoadError extends Error{constructor(s){super(s.error.message),this.data=void 0,this.data=s}}class AESCrypto{constructor(s,a){this.subtle=void 0,this.aesIV=void 0,this.subtle=s,this.aesIV=a}decrypt(s,a){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},a,s)}}class FastAESKey{constructor(s,a){this.subtle=void 0,this.key=void 0,this.subtle=s,this.key=a}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}function removePadding(o){const s=o.byteLength,a=s&&new DataView(o.buffer).getUint8(s-1);return a?sliceUint8(o,0,s-a):o}class AESDecryptor{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(s){const a=new DataView(s),et=new Uint32Array(4);for(let tt=0;tt<4;tt++)et[tt]=a.getUint32(tt*4);return et}initTable(){const s=this.sBox,a=this.invSBox,et=this.subMix,tt=et[0],rt=et[1],nt=et[2],it=et[3],st=this.invSubMix,ot=st[0],at=st[1],lt=st[2],ct=st[3],ht=new Uint32Array(256);let ft=0,dt=0,pt=0;for(pt=0;pt<256;pt++)pt<128?ht[pt]=pt<<1:ht[pt]=pt<<1^283;for(pt=0;pt<256;pt++){let gt=dt^dt<<1^dt<<2^dt<<3^dt<<4;gt=gt>>>8^gt&255^99,s[ft]=gt,a[gt]=ft;const mt=ht[ft],yt=ht[mt],vt=ht[yt];let Et=ht[gt]*257^gt*16843008;tt[ft]=Et<<24|Et>>>8,rt[ft]=Et<<16|Et>>>16,nt[ft]=Et<<8|Et>>>24,it[ft]=Et,Et=vt*16843009^yt*65537^mt*257^ft*16843008,ot[gt]=Et<<24|Et>>>8,at[gt]=Et<<16|Et>>>16,lt[gt]=Et<<8|Et>>>24,ct[gt]=Et,ft?(ft=mt^ht[ht[ht[vt^mt]]],dt^=ht[ht[dt]]):ft=dt=1}}expandKey(s){const a=this.uint8ArrayToUint32Array_(s);let et=!0,tt=0;for(;tt<a.length&&et;)et=a[tt]===this.key[tt],tt++;if(et)return;this.key=a;const rt=this.keySize=a.length;if(rt!==4&&rt!==6&&rt!==8)throw new Error("Invalid aes key size="+rt);const nt=this.ksRows=(rt+6+1)*4;let it,st;const ot=this.keySchedule=new Uint32Array(nt),at=this.invKeySchedule=new Uint32Array(nt),lt=this.sBox,ct=this.rcon,ht=this.invSubMix,ft=ht[0],dt=ht[1],pt=ht[2],gt=ht[3];let mt,yt;for(it=0;it<nt;it++){if(it<rt){mt=ot[it]=a[it];continue}yt=mt,it%rt===0?(yt=yt<<8|yt>>>24,yt=lt[yt>>>24]<<24|lt[yt>>>16&255]<<16|lt[yt>>>8&255]<<8|lt[yt&255],yt^=ct[it/rt|0]<<24):rt>6&&it%rt===4&&(yt=lt[yt>>>24]<<24|lt[yt>>>16&255]<<16|lt[yt>>>8&255]<<8|lt[yt&255]),ot[it]=mt=(ot[it-rt]^yt)>>>0}for(st=0;st<nt;st++)it=nt-st,st&3?yt=ot[it]:yt=ot[it-4],st<4||it<=4?at[st]=yt:at[st]=ft[lt[yt>>>24]]^dt[lt[yt>>>16&255]]^pt[lt[yt>>>8&255]]^gt[lt[yt&255]],at[st]=at[st]>>>0}networkToHostOrderSwap(s){return s<<24|(s&65280)<<8|(s&16711680)>>8|s>>>24}decrypt(s,a,et){const tt=this.keySize+6,rt=this.invKeySchedule,nt=this.invSBox,it=this.invSubMix,st=it[0],ot=it[1],at=it[2],lt=it[3],ct=this.uint8ArrayToUint32Array_(et);let ht=ct[0],ft=ct[1],dt=ct[2],pt=ct[3];const gt=new Int32Array(s),mt=new Int32Array(gt.length);let yt,vt,Et,xt,wt,Rt,Ct,Ft,zt,Nt,Kt,Yt,Bt,Pt;const Dt=this.networkToHostOrderSwap;for(;a<gt.length;){for(zt=Dt(gt[a]),Nt=Dt(gt[a+1]),Kt=Dt(gt[a+2]),Yt=Dt(gt[a+3]),wt=zt^rt[0],Rt=Yt^rt[1],Ct=Kt^rt[2],Ft=Nt^rt[3],Bt=4,Pt=1;Pt<tt;Pt++)yt=st[wt>>>24]^ot[Rt>>16&255]^at[Ct>>8&255]^lt[Ft&255]^rt[Bt],vt=st[Rt>>>24]^ot[Ct>>16&255]^at[Ft>>8&255]^lt[wt&255]^rt[Bt+1],Et=st[Ct>>>24]^ot[Ft>>16&255]^at[wt>>8&255]^lt[Rt&255]^rt[Bt+2],xt=st[Ft>>>24]^ot[wt>>16&255]^at[Rt>>8&255]^lt[Ct&255]^rt[Bt+3],wt=yt,Rt=vt,Ct=Et,Ft=xt,Bt=Bt+4;yt=nt[wt>>>24]<<24^nt[Rt>>16&255]<<16^nt[Ct>>8&255]<<8^nt[Ft&255]^rt[Bt],vt=nt[Rt>>>24]<<24^nt[Ct>>16&255]<<16^nt[Ft>>8&255]<<8^nt[wt&255]^rt[Bt+1],Et=nt[Ct>>>24]<<24^nt[Ft>>16&255]<<16^nt[wt>>8&255]<<8^nt[Rt&255]^rt[Bt+2],xt=nt[Ft>>>24]<<24^nt[wt>>16&255]<<16^nt[Rt>>8&255]<<8^nt[Ct&255]^rt[Bt+3],mt[a]=Dt(yt^ht),mt[a+1]=Dt(xt^ft),mt[a+2]=Dt(Et^dt),mt[a+3]=Dt(vt^pt),ht=zt,ft=Nt,dt=Kt,pt=Yt,a=a+4}return mt.buffer}}const CHUNK_SIZE=16;class Decrypter{constructor(s,{removePKCS7Padding:a=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=s.enableSoftwareAES,this.removePKCS7Padding=a,a)try{const et=self.crypto;et&&(this.subtle=et.subtle||et.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:s,remainderData:a}=this;if(!s||a)return this.reset(),null;const et=new Uint8Array(s);return this.reset(),this.removePKCS7Padding?removePadding(et):et}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(s,a,et){return this.useSoftware?new Promise((tt,rt)=>{this.softwareDecrypt(new Uint8Array(s),a,et);const nt=this.flush();nt?tt(nt.buffer):rt(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(s),a,et)}softwareDecrypt(s,a,et){const{currentIV:tt,currentResult:rt,remainderData:nt}=this;this.logOnce("JS AES decrypt"),nt&&(s=appendUint8Array(nt,s),this.remainderData=null);const it=this.getValidChunk(s);if(!it.length)return null;tt&&(et=tt);let st=this.softwareDecrypter;st||(st=this.softwareDecrypter=new AESDecryptor),st.expandKey(a);const ot=rt;return this.currentResult=st.decrypt(it.buffer,0,et),this.currentIV=sliceUint8(it,-16).buffer,ot||null}webCryptoDecrypt(s,a,et){if(this.key!==a||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(s,a,et));this.key=a,this.fastAesKey=new FastAESKey(this.subtle,a)}return this.fastAesKey.expandKey().then(tt=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new AESCrypto(this.subtle,new Uint8Array(et)).decrypt(s.buffer,tt)):Promise.reject(new Error("web crypto not initialized"))).catch(tt=>(logger.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${tt.name}: ${tt.message}`),this.onWebCryptoError(s,a,et)))}onWebCryptoError(s,a,et){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(s,a,et);const tt=this.flush();if(tt)return tt.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(s){let a=s;const et=s.length-s.length%CHUNK_SIZE;return et!==s.length&&(a=sliceUint8(s,0,et),this.remainderData=sliceUint8(s,et)),a}logOnce(s){this.logEnabled&&(logger.log(`[decrypter]: ${s}`),this.logEnabled=!1)}}const TimeRanges={toString:function(o){let s="";const a=o.length;for(let et=0;et<a;et++)s+=`[${o.start(et).toFixed(3)}-${o.end(et).toFixed(3)}]`;return s}},State={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class BaseStreamController extends TaskLoop{constructor(s,a,et,tt,rt){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=State.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=rt,this.logPrefix=tt,this.log=logger.log.bind(logger,`${tt}:`),this.warn=logger.warn.bind(logger,`${tt}:`),this.hls=s,this.fragmentLoader=new FragmentLoader(s.config),this.keyLoader=et,this.fragmentTracker=a,this.config=s.config,this.decrypter=new Decrypter(s.config),s.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(s){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const s=this.fragCurrent;s!=null&&s.loader&&(s.abortRequests(),this.fragmentTracker.removeFragment(s)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=State.STOPPED}_streamEnded(s,a){if(a.live||s.nextStart||!s.end||!this.media)return!1;const et=a.partList;if(et!=null&&et.length){const rt=et[et.length-1];return BufferHelper.isBuffered(this.media,rt.start+rt.duration/2)}const tt=a.fragments[a.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(tt)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var s;return(s=this.levelLastLoaded)==null?void 0:s.details}}onMediaAttached(s,a){const et=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),et.addEventListener("seeking",this.onvseeking),et.addEventListener("ended",this.onvended);const tt=this.config;this.levels&&tt.autoStartLoad&&this.state===State.STOPPED&&this.startLoad(tt.startPosition)}onMediaDetaching(){const s=this.media;s!=null&&s.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),s&&this.onvseeking&&this.onvended&&(s.removeEventListener("seeking",this.onvseeking),s.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:s,fragCurrent:a,media:et,mediaBuffer:tt,state:rt}=this,nt=et?et.currentTime:0,it=BufferHelper.bufferInfo(tt||et,nt,s.maxBufferHole);if(this.log(`media seeking to ${isFiniteNumber(nt)?nt.toFixed(3):nt}, state: ${rt}`),this.state===State.ENDED)this.resetLoadingState();else if(a){const st=s.maxFragLookUpTolerance,ot=a.start-st,at=a.start+a.duration+st;if(!it.len||at<it.start||ot>it.end){const lt=nt>at;(nt<ot||lt)&&(lt&&a.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),a.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}et&&(this.fragmentTracker.removeFragmentsInRange(nt,1/0,this.playlistType,!0),this.lastCurrentTime=nt),!this.loadedmetadata&&!it.len&&(this.nextLoadPosition=this.startPosition=nt),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(s,a){this.startTimeOffset=a.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.hls.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),super.onHandlerDestroying(),this.hls=null}onHandlerDestroyed(){this.state=State.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(s,a,et){this._loadFragForPlayback(s,a,et)}_loadFragForPlayback(s,a,et){const tt=rt=>{if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${rt.part?" p: "+rt.part.index:""} of level ${s.level} was dropped during download.`),this.fragmentTracker.removeFragment(s);return}s.stats.chunkCount++,this._handleFragmentLoadProgress(rt)};this._doFragLoad(s,a,et,tt).then(rt=>{if(!rt)return;const nt=this.state;if(this.fragContextChanged(s)){(nt===State.FRAG_LOADING||!this.fragCurrent&&nt===State.PARSING)&&(this.fragmentTracker.removeFragment(s),this.state=State.IDLE);return}"payload"in rt&&(this.log(`Loaded fragment ${s.sn} of level ${s.level}`),this.hls.trigger(Events.FRAG_LOADED,rt)),this._handleFragmentLoadComplete(rt)}).catch(rt=>{this.state===State.STOPPED||this.state===State.ERROR||(this.warn(`Frag error: ${rt?.message||rt}`),this.resetFragmentLoading(s))})}clearTrackerIfNeeded(s){var a;const{fragmentTracker:et}=this;if(et.getState(s)===FragmentState.APPENDING){const rt=s.type,nt=this.getFwdBufferInfo(this.mediaBuffer,rt),it=Math.max(s.duration,nt?nt.len:this.config.maxBufferLength),st=this.backtrackFragment;((st?s.sn-st.sn:0)===1||this.reduceMaxBufferLength(it))&&et.removeFragment(s)}else((a=this.mediaBuffer)==null?void 0:a.buffered.length)===0?et.removeAllFragments():et.hasParts(s.type)&&(et.detectPartialFragments({frag:s,part:null,stats:s.stats,id:s.type}),et.getState(s)===FragmentState.PARTIAL&&et.removeFragment(s))}checkLiveUpdate(s){if(s.updated&&!s.live){const a=s.fragments[s.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:a,part:null,stats:a.stats,id:a.type})}s.fragments[0]||(s.deltaUpdateFailed=!0)}flushMainBuffer(s,a,et=null){if(!(s-a))return;const tt={startOffset:s,endOffset:a,type:et};this.hls.trigger(Events.BUFFER_FLUSHING,tt)}_loadInitSegment(s,a){this._doFragLoad(s,a).then(et=>{if(!et||this.fragContextChanged(s)||!this.levels)throw new Error("init load aborted");return et}).then(et=>{const{hls:tt}=this,{payload:rt}=et,nt=s.decryptdata;if(rt&&rt.byteLength>0&&nt!=null&&nt.key&&nt.iv&&nt.method==="AES-128"){const it=self.performance.now();return this.decrypter.decrypt(new Uint8Array(rt),nt.key.buffer,nt.iv.buffer).catch(st=>{throw tt.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!1,error:st,reason:st.message,frag:s}),st}).then(st=>{const ot=self.performance.now();return tt.trigger(Events.FRAG_DECRYPTED,{frag:s,payload:st,stats:{tstart:it,tdecrypt:ot}}),et.payload=st,this.completeInitSegmentLoad(et)})}return this.completeInitSegmentLoad(et)}).catch(et=>{this.state===State.STOPPED||this.state===State.ERROR||(this.warn(et),this.resetFragmentLoading(s))})}completeInitSegmentLoad(s){const{levels:a}=this;if(!a)throw new Error("init load aborted, missing levels");const et=s.frag.stats;this.state=State.IDLE,s.frag.data=new Uint8Array(s.payload),et.parsing.start=et.buffering.start=self.performance.now(),et.parsing.end=et.buffering.end=self.performance.now(),this.tick()}fragContextChanged(s){const{fragCurrent:a}=this;return!s||!a||s.sn!==a.sn||s.level!==a.level}fragBufferedComplete(s,a){var et,tt,rt,nt;const it=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${s.type} sn: ${s.sn}${a?" part: "+a.index:""} of ${this.playlistType===PlaylistLevelType.MAIN?"level":"track"} ${s.level} (frag:[${((et=s.startPTS)!=null?et:NaN).toFixed(3)}-${((tt=s.endPTS)!=null?tt:NaN).toFixed(3)}] > buffer:${it?TimeRanges.toString(BufferHelper.getBuffered(it)):"(detached)"})`),s.sn!=="initSegment"){var st;if(s.type!==PlaylistLevelType.SUBTITLE){const at=s.elementaryStreams;if(!Object.keys(at).some(lt=>!!at[lt])){this.state=State.IDLE;return}}const ot=(st=this.levels)==null?void 0:st[s.level];ot!=null&&ot.fragmentError&&(this.log(`Resetting level fragment error count of ${ot.fragmentError} on frag buffered`),ot.fragmentError=0)}this.state=State.IDLE,it&&(!this.loadedmetadata&&s.type==PlaylistLevelType.MAIN&&it.buffered.length&&((rt=this.fragCurrent)==null?void 0:rt.sn)===((nt=this.fragPrevious)==null?void 0:nt.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(s){const{transmuxer:a}=this;if(!a)return;const{frag:et,part:tt,partsLoaded:rt}=s,nt=!rt||rt.length===0||rt.some(st=>!st),it=new ChunkMetadata(et.level,et.sn,et.stats.chunkCount+1,0,tt?tt.index:-1,!nt);a.flush(it)}_handleFragmentLoadProgress(s){}_doFragLoad(s,a,et=null,tt){var rt;const nt=a?.details;if(!this.levels||!nt)throw new Error(`frag load aborted, missing level${nt?"":" detail"}s`);let it=null;if(s.encrypted&&!((rt=s.decryptdata)!=null&&rt.key)?(this.log(`Loading key for ${s.sn} of [${nt.startSN}-${nt.endSN}], ${this.logPrefix==="[stream-controller]"?"level":"track"} ${s.level}`),this.state=State.KEY_LOADING,this.fragCurrent=s,it=this.keyLoader.load(s).then(at=>{if(!this.fragContextChanged(at.frag))return this.hls.trigger(Events.KEY_LOADED,at),this.state===State.KEY_LOADING&&(this.state=State.IDLE),at}),this.hls.trigger(Events.KEY_LOADING,{frag:s}),this.fragCurrent===null&&(it=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!s.encrypted&&nt.encryptedFragments.length&&this.keyLoader.loadClear(s,nt.encryptedFragments),et=Math.max(s.start,et||0),this.config.lowLatencyMode&&s.sn!=="initSegment"){const at=nt.partList;if(at&&tt){et>s.end&&nt.fragmentHint&&(s=nt.fragmentHint);const lt=this.getNextPart(at,s,et);if(lt>-1){const ct=at[lt];this.log(`Loading part sn: ${s.sn} p: ${ct.index} cc: ${s.cc} of playlist [${nt.startSN}-${nt.endSN}] parts [0-${lt}-${at.length-1}] ${this.logPrefix==="[stream-controller]"?"level":"track"}: ${s.level}, target: ${parseFloat(et.toFixed(3))}`),this.nextLoadPosition=ct.start+ct.duration,this.state=State.FRAG_LOADING;let ht;return it?ht=it.then(ft=>!ft||this.fragContextChanged(ft.frag)?null:this.doFragPartsLoad(s,ct,a,tt)).catch(ft=>this.handleFragLoadError(ft)):ht=this.doFragPartsLoad(s,ct,a,tt).catch(ft=>this.handleFragLoadError(ft)),this.hls.trigger(Events.FRAG_LOADING,{frag:s,part:ct,targetBufferTime:et}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):ht}else if(!s.url||this.loadedEndOfParts(at,et))return Promise.resolve(null)}}this.log(`Loading fragment ${s.sn} cc: ${s.cc} ${nt?"of ["+nt.startSN+"-"+nt.endSN+"] ":""}${this.logPrefix==="[stream-controller]"?"level":"track"}: ${s.level}, target: ${parseFloat(et.toFixed(3))}`),isFiniteNumber(s.sn)&&!this.bitrateTest&&(this.nextLoadPosition=s.start+s.duration),this.state=State.FRAG_LOADING;const st=this.config.progressive;let ot;return st&&it?ot=it.then(at=>!at||this.fragContextChanged(at?.frag)?null:this.fragmentLoader.load(s,tt)).catch(at=>this.handleFragLoadError(at)):ot=Promise.all([this.fragmentLoader.load(s,st?tt:void 0),it]).then(([at])=>(!st&&at&&tt&&tt(at),at)).catch(at=>this.handleFragLoadError(at)),this.hls.trigger(Events.FRAG_LOADING,{frag:s,targetBufferTime:et}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):ot}doFragPartsLoad(s,a,et,tt){return new Promise((rt,nt)=>{var it;const st=[],ot=(it=et.details)==null?void 0:it.partList,at=lt=>{this.fragmentLoader.loadPart(s,lt,tt).then(ct=>{st[lt.index]=ct;const ht=ct.part;this.hls.trigger(Events.FRAG_LOADED,ct);const ft=getPartWith(et,s.sn,lt.index+1)||findPart(ot,s.sn,lt.index+1);if(ft)at(ft);else return rt({frag:s,part:ht,partsLoaded:st})}).catch(nt)};at(a)})}handleFragLoadError(s){if("data"in s){const a=s.data;s.data&&a.details===ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(a.frag,a.part):this.hls.trigger(Events.ERROR,a)}else this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,err:s,error:s,fatal:!0});return null}_handleTransmuxerFlush(s){const a=this.getCurrentContext(s);if(!a||this.state!==State.PARSING){!this.fragCurrent&&this.state!==State.STOPPED&&this.state!==State.ERROR&&(this.state=State.IDLE);return}const{frag:et,part:tt,level:rt}=a,nt=self.performance.now();et.stats.parsing.end=nt,tt&&(tt.stats.parsing.end=nt),this.updateLevelTiming(et,tt,rt,s.partial)}getCurrentContext(s){const{levels:a,fragCurrent:et}=this,{level:tt,sn:rt,part:nt}=s;if(!(a!=null&&a[tt]))return this.warn(`Levels object was unset while buffering fragment ${rt} of level ${tt}. The current chunk will not be buffered.`),null;const it=a[tt],st=nt>-1?getPartWith(it,rt,nt):null,ot=st?st.fragment:getFragmentWithSN(it,rt,et);return ot?(et&&et!==ot&&(ot.stats=et.stats),{frag:ot,part:st,level:it}):null}bufferFragmentData(s,a,et,tt,rt){var nt;if(!s||this.state!==State.PARSING)return;const{data1:it,data2:st}=s;let ot=it;if(it&&st&&(ot=appendUint8Array(it,st)),!((nt=ot)!=null&&nt.length))return;const at={type:s.type,frag:a,part:et,chunkMeta:tt,parent:a.type,data:ot};if(this.hls.trigger(Events.BUFFER_APPENDING,at),s.dropped&&s.independent&&!et){if(rt)return;this.flushBufferGap(a)}}flushBufferGap(s){const a=this.media;if(!a)return;if(!BufferHelper.isBuffered(a,a.currentTime)){this.flushMainBuffer(0,s.start);return}const et=a.currentTime,tt=BufferHelper.bufferInfo(a,et,0),rt=s.duration,nt=Math.min(this.config.maxFragLookUpTolerance*2,rt*.25),it=Math.max(Math.min(s.start-nt,tt.end-nt),et+nt);s.start-it>nt&&this.flushMainBuffer(it,s.start)}getFwdBufferInfo(s,a){const et=this.getLoadPosition();return isFiniteNumber(et)?this.getFwdBufferInfoAtPos(s,et,a):null}getFwdBufferInfoAtPos(s,a,et){const{config:{maxBufferHole:tt}}=this,rt=BufferHelper.bufferInfo(s,a,tt);if(rt.len===0&&rt.nextStart!==void 0){const nt=this.fragmentTracker.getBufferedFrag(a,et);if(nt&&rt.nextStart<nt.end)return BufferHelper.bufferInfo(s,a,Math.max(rt.nextStart,tt))}return rt}getMaxBufferLength(s){const{config:a}=this;let et;return s?et=Math.max(8*a.maxBufferSize/s,a.maxBufferLength):et=a.maxBufferLength,Math.min(et,a.maxMaxBufferLength)}reduceMaxBufferLength(s){const a=this.config,et=s||a.maxBufferLength,tt=a.maxMaxBufferLength/2;return tt>=et?(a.maxMaxBufferLength=tt,this.warn(`Reduce max buffer length to ${tt}s`),!0):!1}getAppendedFrag(s,a=PlaylistLevelType.MAIN){const et=this.fragmentTracker.getAppendedFrag(s,PlaylistLevelType.MAIN);return et&&"fragment"in et?et.fragment:et}getNextFragment(s,a){const et=a.fragments,tt=et.length;if(!tt)return null;const{config:rt}=this,nt=et[0].start;let it;if(a.live){const st=rt.initialLiveManifestSize;if(tt<st)return this.warn(`Not enough fragments to start playback (have: ${tt}, need: ${st})`),null;(!a.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||s<nt)&&(it=this.getInitialLiveFragment(a,et),this.startPosition=this.nextLoadPosition=it?this.hls.liveSyncPosition||it.start:s)}else s<=nt&&(it=et[0]);if(!it){const st=rt.lowLatencyMode?a.partEnd:a.fragmentEnd;it=this.getFragmentAtPosition(s,st,a)}return this.mapToInitFragWhenRequired(it)}isLoopLoading(s,a){const et=this.fragmentTracker.getState(s);return(et===FragmentState.OK||et===FragmentState.PARTIAL&&!!s.gap)&&this.nextLoadPosition>a}getNextFragmentLoopLoading(s,a,et,tt,rt){const nt=s.gap,it=this.getNextFragment(this.nextLoadPosition,a);if(it===null)return it;if(s=it,nt&&s&&!s.gap&&et.nextStart){const st=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,et.nextStart,tt);if(st!==null&&et.len+st.len>=rt)return this.log(`buffer full after gaps in "${tt}" playlist starting at sn: ${s.sn}`),null}return s}mapToInitFragWhenRequired(s){return s!=null&&s.initSegment&&!(s!=null&&s.initSegment.data)&&!this.bitrateTest?s.initSegment:s}getNextPart(s,a,et){let tt=-1,rt=!1,nt=!0;for(let it=0,st=s.length;it<st;it++){const ot=s[it];if(nt=nt&&!ot.independent,tt>-1&&et<ot.start)break;const at=ot.loaded;at?tt=-1:(rt||ot.independent||nt)&&ot.fragment===a&&(tt=it),rt=at}return tt}loadedEndOfParts(s,a){const et=s[s.length-1];return et&&a>et.start&&et.loaded}getInitialLiveFragment(s,a){const et=this.fragPrevious;let tt=null;if(et){if(s.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${et.programDateTime}`),tt=findFragmentByPDT(a,et.endProgramDateTime,this.config.maxFragLookUpTolerance)),!tt){const rt=et.sn+1;if(rt>=s.startSN&&rt<=s.endSN){const nt=a[rt-s.startSN];et.cc===nt.cc&&(tt=nt,this.log(`Live playlist, switching playlist, load frag with next SN: ${tt.sn}`))}tt||(tt=findFragWithCC(a,et.cc),tt&&this.log(`Live playlist, switching playlist, load frag with same CC: ${tt.sn}`))}}else{const rt=this.hls.liveSyncPosition;rt!==null&&(tt=this.getFragmentAtPosition(rt,this.bitrateTest?s.fragmentEnd:s.edge,s))}return tt}getFragmentAtPosition(s,a,et){const{config:tt}=this;let{fragPrevious:rt}=this,{fragments:nt,endSN:it}=et;const{fragmentHint:st}=et,{maxFragLookUpTolerance:ot}=tt,at=et.partList,lt=!!(tt.lowLatencyMode&&at!=null&&at.length&&st);lt&&st&&!this.bitrateTest&&(nt=nt.concat(st),it=st.sn);let ct;if(s<a){const ht=s>a-ot?0:ot;ct=findFragmentByPTS(rt,nt,s,ht)}else ct=nt[nt.length-1];if(ct){const ht=ct.sn-et.startSN,ft=this.fragmentTracker.getState(ct);if((ft===FragmentState.OK||ft===FragmentState.PARTIAL&&ct.gap)&&(rt=ct),rt&&ct.sn===rt.sn&&(!lt||at[0].fragment.sn>ct.sn)&&rt&&ct.level===rt.level){const pt=nt[ht+1];ct.sn<it&&this.fragmentTracker.getState(pt)!==FragmentState.OK?ct=pt:ct=null}}return ct}synchronizeToLiveEdge(s){const{config:a,media:et}=this;if(!et)return;const tt=this.hls.liveSyncPosition,rt=et.currentTime,nt=s.fragments[0].start,it=s.edge,st=rt>=nt-a.maxFragLookUpTolerance&&rt<=it;if(tt!==null&&et.duration>tt&&(rt<tt||!st)){const ot=a.liveMaxLatencyDuration!==void 0?a.liveMaxLatencyDuration:a.liveMaxLatencyDurationCount*s.targetduration;(!st&&et.readyState<4||rt<it-ot)&&(this.loadedmetadata||(this.nextLoadPosition=tt),et.readyState&&(this.warn(`Playback: ${rt.toFixed(3)} is located too far from the end of live sliding playlist: ${it}, reset currentTime to : ${tt.toFixed(3)}`),et.currentTime=tt))}}alignPlaylists(s,a,et){const tt=s.fragments.length;if(!tt)return this.warn("No fragments in live playlist"),0;const rt=s.fragments[0].start,nt=!a,it=s.alignedSliding&&isFiniteNumber(rt);if(nt||!it&&!rt){const{fragPrevious:st}=this;alignStream(st,et,s);const ot=s.fragments[0].start;return this.log(`Live playlist sliding: ${ot.toFixed(2)} start-sn: ${a?a.startSN:"na"}->${s.startSN} prev-sn: ${st?st.sn:"na"} fragments: ${tt}`),ot}return rt}waitForCdnTuneIn(s){return s.live&&s.canBlockReload&&s.partTarget&&s.tuneInGoal>Math.max(s.partHoldBack,s.partTarget*3)}setStartPosition(s,a){let et=this.startPosition;if(et<a&&(et=-1),et===-1||this.lastCurrentTime===-1){const tt=this.startTimeOffset!==null,rt=tt?this.startTimeOffset:s.startTimeOffset;rt!==null&&isFiniteNumber(rt)?(et=a+rt,rt<0&&(et+=s.totalduration),et=Math.min(Math.max(a,et),a+s.totalduration),this.log(`Start time offset ${rt} found in ${tt?"multivariant":"media"} playlist, adjust startPosition to ${et}`),this.startPosition=et):s.live?et=this.hls.liveSyncPosition||a:this.startPosition=et=0,this.lastCurrentTime=et}this.nextLoadPosition=et}getLoadPosition(){const{media:s}=this;let a=0;return this.loadedmetadata&&s?a=s.currentTime:this.nextLoadPosition&&(a=this.nextLoadPosition),a}handleFragLoadAborted(s,a){this.transmuxer&&s.sn!=="initSegment"&&s.stats.aborted&&(this.warn(`Fragment ${s.sn}${a?" part "+a.index:""} of level ${s.level} was aborted`),this.resetFragmentLoading(s))}resetFragmentLoading(s){(!this.fragCurrent||!this.fragContextChanged(s)&&this.state!==State.FRAG_LOADING_WAITING_RETRY)&&(this.state=State.IDLE)}onFragmentOrKeyLoadError(s,a){if(a.chunkMeta&&!a.frag){const at=this.getCurrentContext(a.chunkMeta);at&&(a.frag=at.frag)}const et=a.frag;if(!et||et.type!==s||!this.levels)return;if(this.fragContextChanged(et)){var tt;this.warn(`Frag load error must match current frag to retry ${et.url} > ${(tt=this.fragCurrent)==null?void 0:tt.url}`);return}const rt=a.details===ErrorDetails.FRAG_GAP;rt&&this.fragmentTracker.fragBuffered(et,!0);const nt=a.errorAction,{action:it,retryCount:st=0,retryConfig:ot}=nt||{};if(nt&&it===NetworkErrorAction.RetryRequest&&ot){this.resetStartWhenNotLoaded(this.levelLastLoaded);const at=getRetryDelay(ot,st);this.warn(`Fragment ${et.sn} of ${s} ${et.level} errored with ${a.details}, retrying loading ${st+1}/${ot.maxNumRetry} in ${at}ms`),nt.resolved=!0,this.retryDate=self.performance.now()+at,this.state=State.FRAG_LOADING_WAITING_RETRY}else if(ot&&nt)if(this.resetFragmentErrors(s),st<ot.maxNumRetry)!rt&&it!==NetworkErrorAction.RemoveAlternatePermanently&&(nt.resolved=!0);else{logger.warn(`${a.details} reached or exceeded max retry (${st})`);return}else nt?.action===NetworkErrorAction.SendAlternateToPenaltyBox?this.state=State.WAITING_LEVEL:this.state=State.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(s){if(this.state===State.PARSING||this.state===State.PARSED){const a=s.parent,et=this.getFwdBufferInfo(this.mediaBuffer,a),tt=et&&et.len>.5;tt&&this.reduceMaxBufferLength(et.len);const rt=!tt;return rt&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${a} buffer`),s.frag&&(this.fragmentTracker.removeFragment(s.frag),this.nextLoadPosition=s.frag.start),this.resetLoadingState(),rt}return!1}resetFragmentErrors(s){s===PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==State.STOPPED&&(this.state=State.IDLE)}afterBufferFlushed(s,a,et){if(!s)return;const tt=BufferHelper.getBuffered(s);this.fragmentTracker.detectEvictedFragments(a,tt,et),this.state===State.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=State.IDLE}resetStartWhenNotLoaded(s){if(!this.loadedmetadata){this.startFragRequested=!1;const a=s?s.details:null;a!=null&&a.live?(this.startPosition=-1,this.setStartPosition(a,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(s){this.warn(`The loading context changed while buffering fragment ${s.sn} of level ${s.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(s=0){this.fragmentTracker.removeFragmentsInRange(s,1/0,this.playlistType,!1,!0)}updateLevelTiming(s,a,et,tt){var rt;const nt=et.details;if(!nt){this.warn("level.details undefined");return}if(!Object.keys(s.elementaryStreams).reduce((st,ot)=>{const at=s.elementaryStreams[ot];if(at){const lt=at.endPTS-at.startPTS;if(lt<=0)return this.warn(`Could not parse fragment ${s.sn} ${ot} duration reliably (${lt})`),st||!1;const ct=tt?0:updateFragPTSDTS(nt,s,at.startPTS,at.endPTS,at.startDTS,at.endDTS);return this.hls.trigger(Events.LEVEL_PTS_UPDATED,{details:nt,level:et,drift:ct,type:ot,frag:s,start:at.startPTS,end:at.endPTS}),!0}return st},!1)&&((rt=this.transmuxer)==null?void 0:rt.error)===null){const st=new Error(`Found no media in fragment ${s.sn} of level ${s.level} resetting transmuxer to fallback to playlist timing`);if(et.fragmentError===0&&(et.fragmentError++,s.gap=!0,this.fragmentTracker.removeFragment(s),this.fragmentTracker.fragBuffered(s,!0)),this.warn(st.message),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:st,frag:s,reason:`Found no media in msn ${s.sn} of level "${et.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=State.PARSED,this.hls.trigger(Events.FRAG_PARSED,{frag:s,part:a})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(s){s.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(s){const a=this._state;a!==s&&(this._state=s,this.log(`${a}->${s}`))}get state(){return this._state}}class ChunkCache{constructor(){this.chunks=[],this.dataLength=0}push(s){this.chunks.push(s),this.dataLength+=s.length}flush(){const{chunks:s,dataLength:a}=this;let et;if(s.length)s.length===1?et=s[0]:et=concatUint8Arrays(s,a);else return new Uint8Array(0);return this.reset(),et}reset(){this.chunks.length=0,this.dataLength=0}}function concatUint8Arrays(o,s){const a=new Uint8Array(s);let et=0;for(let tt=0;tt<o.length;tt++){const rt=o[tt];a.set(rt,et),et+=rt.length}return a}function hasUMDWorker(){return typeof __HLS_WORKER_BUNDLE__=="function"}function injectWorker(){const o=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),s=self.URL.createObjectURL(o);return{worker:new self.Worker(s),objectURL:s}}function loadWorker(o){const s=new self.URL(o,self.location.href).href;return{worker:new self.Worker(s),scriptURL:s}}function dummyTrack(o="",s=9e4){return{type:o,id:-1,pid:-1,inputTimeScale:s,sequenceNumber:-1,samples:[],dropped:0}}class BaseAudioDemuxer{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(s,a,et,tt){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(s){this.initPTS=s,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(s,a){return!1}appendFrame(s,a,et){}demux(s,a){this.cachedData&&(s=appendUint8Array(this.cachedData,s),this.cachedData=null);let et=getID3Data(s,0),tt=et?et.length:0,rt;const nt=this._audioTrack,it=this._id3Track,st=et?getTimeStamp(et):void 0,ot=s.length;for((this.basePTS===null||this.frameIndex===0&&isFiniteNumber(st))&&(this.basePTS=initPTSFn(st,a,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),et&&et.length>0&&it.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:et,type:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});tt<ot;){if(this.canParse(s,tt)){const at=this.appendFrame(nt,s,tt);at?(this.frameIndex++,this.lastPTS=at.sample.pts,tt+=at.length,rt=tt):tt=ot}else canParse$2(s,tt)?(et=getID3Data(s,tt),it.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:et,type:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),tt+=et.length,rt=tt):tt++;if(tt===ot&&rt!==ot){const at=sliceUint8(s,rt);this.cachedData?this.cachedData=appendUint8Array(this.cachedData,at):this.cachedData=at}}return{audioTrack:nt,videoTrack:dummyTrack(),id3Track:it,textTrack:dummyTrack()}}demuxSampleAes(s,a,et){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(s){const a=this.cachedData;return a&&(this.cachedData=null,this.demux(a,0)),{audioTrack:this._audioTrack,videoTrack:dummyTrack(),id3Track:this._id3Track,textTrack:dummyTrack()}}destroy(){}}const initPTSFn=(o,s,a)=>{if(isFiniteNumber(o))return o*90;const et=a?a.baseTime*9e4/a.timescale:0;return s*9e4+et};function getAudioConfig(o,s,a,et){let tt,rt,nt,it;const st=navigator.userAgent.toLowerCase(),ot=et,at=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];tt=((s[a+2]&192)>>>6)+1;const lt=(s[a+2]&60)>>>2;if(lt>at.length-1){const ct=new Error(`invalid ADTS sampling index:${lt}`);o.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,error:ct,reason:ct.message});return}return nt=(s[a+2]&1)<<2,nt|=(s[a+3]&192)>>>6,logger.log(`manifest codec:${et}, ADTS type:${tt}, samplingIndex:${lt}`),/firefox/i.test(st)?lt>=6?(tt=5,it=new Array(4),rt=lt-3):(tt=2,it=new Array(2),rt=lt):st.indexOf("android")!==-1?(tt=2,it=new Array(2),rt=lt):(tt=5,it=new Array(4),et&&(et.indexOf("mp4a.40.29")!==-1||et.indexOf("mp4a.40.5")!==-1)||!et&&lt>=6?rt=lt-3:((et&&et.indexOf("mp4a.40.2")!==-1&&(lt>=6&&nt===1||/vivaldi/i.test(st))||!et&&nt===1)&&(tt=2,it=new Array(2)),rt=lt)),it[0]=tt<<3,it[0]|=(lt&14)>>1,it[1]|=(lt&1)<<7,it[1]|=nt<<3,tt===5&&(it[1]|=(rt&14)>>1,it[2]=(rt&1)<<7,it[2]|=8,it[3]=0),{config:it,samplerate:at[lt],channelCount:nt,codec:"mp4a.40."+tt,manifestCodec:ot}}function isHeaderPattern$1(o,s){return o[s]===255&&(o[s+1]&246)===240}function getHeaderLength(o,s){return o[s+1]&1?7:9}function getFullFrameLength(o,s){return(o[s+3]&3)<<11|o[s+4]<<3|(o[s+5]&224)>>>5}function canGetFrameLength(o,s){return s+5<o.length}function isHeader$1(o,s){return s+1<o.length&&isHeaderPattern$1(o,s)}function canParse$1(o,s){return canGetFrameLength(o,s)&&isHeaderPattern$1(o,s)&&getFullFrameLength(o,s)<=o.length-s}function probe$1(o,s){if(isHeader$1(o,s)){const a=getHeaderLength(o,s);if(s+a>=o.length)return!1;const et=getFullFrameLength(o,s);if(et<=a)return!1;const tt=s+et;return tt===o.length||isHeader$1(o,tt)}return!1}function initTrackConfig(o,s,a,et,tt){if(!o.samplerate){const rt=getAudioConfig(s,a,et,tt);if(!rt)return;o.config=rt.config,o.samplerate=rt.samplerate,o.channelCount=rt.channelCount,o.codec=rt.codec,o.manifestCodec=rt.manifestCodec,logger.log(`parsed codec:${o.codec}, rate:${rt.samplerate}, channels:${rt.channelCount}`)}}function getFrameDuration(o){return 1024*9e4/o}function parseFrameHeader(o,s){const a=getHeaderLength(o,s);if(s+a<=o.length){const et=getFullFrameLength(o,s)-a;if(et>0)return{headerLength:a,frameLength:et}}}function appendFrame$2(o,s,a,et,tt){const rt=getFrameDuration(o.samplerate),nt=et+tt*rt,it=parseFrameHeader(s,a);let st;if(it){const{frameLength:lt,headerLength:ct}=it,ht=ct+lt,ft=Math.max(0,a+ht-s.length);ft?(st=new Uint8Array(ht-ct),st.set(s.subarray(a+ct,s.length),0)):st=s.subarray(a+ct,a+ht);const dt={unit:st,pts:nt};return ft||o.samples.push(dt),{sample:dt,length:ht,missing:ft}}const ot=s.length-a;return st=new Uint8Array(ot),st.set(s.subarray(a,s.length),0),{sample:{unit:st,pts:nt},length:ot,missing:-1}}let chromeVersion$1=null;const BitratesMap=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot=[0,1,1,4];function appendFrame$1(o,s,a,et,tt){if(a+24>s.length)return;const rt=parseHeader(s,a);if(rt&&a+rt.frameLength<=s.length){const nt=rt.samplesPerFrame*9e4/rt.sampleRate,it=et+tt*nt,st={unit:s.subarray(a,a+rt.frameLength),pts:it,dts:it};return o.config=[],o.channelCount=rt.channelCount,o.samplerate=rt.sampleRate,o.samples.push(st),{sample:st,length:rt.frameLength,missing:0}}}function parseHeader(o,s){const a=o[s+1]>>3&3,et=o[s+1]>>1&3,tt=o[s+2]>>4&15,rt=o[s+2]>>2&3;if(a!==1&&tt!==0&&tt!==15&&rt!==3){const nt=o[s+2]>>1&1,it=o[s+3]>>6,st=a===3?3-et:et===3?3:4,ot=BitratesMap[st*14+tt-1]*1e3,lt=SamplingRateMap[(a===3?0:a===2?1:2)*3+rt],ct=it===3?1:2,ht=SamplesCoefficients[a][et],ft=BytesInSlot[et],dt=ht*8*ft,pt=Math.floor(ht*ot/lt+nt)*ft;if(chromeVersion$1===null){const yt=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);chromeVersion$1=yt?parseInt(yt[1]):0}return!!chromeVersion$1&&chromeVersion$1<=87&&et===2&&ot>=224e3&&it===0&&(o[s+3]=o[s+3]|128),{sampleRate:lt,channelCount:ct,frameLength:pt,samplesPerFrame:dt}}}function isHeaderPattern(o,s){return o[s]===255&&(o[s+1]&224)===224&&(o[s+1]&6)!==0}function isHeader(o,s){return s+1<o.length&&isHeaderPattern(o,s)}function canParse(o,s){return isHeaderPattern(o,s)&&4<=o.length-s}function probe(o,s){if(s+1<o.length&&isHeaderPattern(o,s)){const et=parseHeader(o,s);let tt=4;et!=null&&et.frameLength&&(tt=et.frameLength);const rt=s+tt;return rt===o.length||isHeader(o,rt)}return!1}class AACDemuxer extends BaseAudioDemuxer{constructor(s,a){super(),this.observer=void 0,this.config=void 0,this.observer=s,this.config=a}resetInitSegment(s,a,et,tt){super.resetInitSegment(s,a,et,tt),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:a,duration:tt,inputTimeScale:9e4,dropped:0}}static probe(s){if(!s)return!1;const a=getID3Data(s,0);let et=a?.length||0;if(probe(s,et))return!1;for(let tt=s.length;et<tt;et++)if(probe$1(s,et))return logger.log("ADTS sync word found !"),!0;return!1}canParse(s,a){return canParse$1(s,a)}appendFrame(s,a,et){initTrackConfig(s,this.observer,a,et,s.manifestCodec);const tt=appendFrame$2(s,a,et,this.basePTS,this.frameIndex);if(tt&&tt.missing===0)return tt}}const emsgSchemePattern=/\/emsg[-/]ID3/i;class MP4Demuxer{constructor(s,a){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=a}resetTimeStamp(){}resetInitSegment(s,a,et,tt){const rt=this.videoTrack=dummyTrack("video",1),nt=this.audioTrack=dummyTrack("audio",1),it=this.txtTrack=dummyTrack("text",1);if(this.id3Track=dummyTrack("id3",1),this.timeOffset=0,!(s!=null&&s.byteLength))return;const st=parseInitSegment(s);if(st.video){const{id:ot,timescale:at,codec:lt}=st.video;rt.id=ot,rt.timescale=it.timescale=at,rt.codec=lt}if(st.audio){const{id:ot,timescale:at,codec:lt}=st.audio;nt.id=ot,nt.timescale=at,nt.codec=lt}it.id=RemuxerTrackIdConfig.text,rt.sampleDuration=0,rt.duration=nt.duration=tt}resetContiguity(){this.remainderData=null}static probe(s){return hasMoofData(s)}demux(s,a){this.timeOffset=a;let et=s;const tt=this.videoTrack,rt=this.txtTrack;if(this.config.progressive){this.remainderData&&(et=appendUint8Array(this.remainderData,s));const it=segmentValidRange(et);this.remainderData=it.remainder,tt.samples=it.valid||new Uint8Array}else tt.samples=et;const nt=this.extractID3Track(tt,a);return rt.samples=parseSamples(a,tt),{videoTrack:tt,audioTrack:this.audioTrack,id3Track:nt,textTrack:this.txtTrack}}flush(){const s=this.timeOffset,a=this.videoTrack,et=this.txtTrack;a.samples=this.remainderData||new Uint8Array,this.remainderData=null;const tt=this.extractID3Track(a,this.timeOffset);return et.samples=parseSamples(s,a),{videoTrack:a,audioTrack:dummyTrack(),id3Track:tt,textTrack:dummyTrack()}}extractID3Track(s,a){const et=this.id3Track;if(s.samples.length){const tt=findBox(s.samples,["emsg"]);tt&&tt.forEach(rt=>{const nt=parseEmsg(rt);if(emsgSchemePattern.test(nt.schemeIdUri)){const it=isFiniteNumber(nt.presentationTime)?nt.presentationTime/nt.timeScale:a+nt.presentationTimeDelta/nt.timeScale;let st=nt.eventDuration===4294967295?Number.POSITIVE_INFINITY:nt.eventDuration/nt.timeScale;st<=.001&&(st=Number.POSITIVE_INFINITY);const ot=nt.payload;et.samples.push({data:ot,len:ot.byteLength,dts:it,pts:it,type:MetadataSchema.emsg,duration:st})}})}return et}demuxSampleAes(s,a,et){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}}const getAudioBSID=(o,s)=>{let a=0,et=5;s+=et;const tt=new Uint32Array(1),rt=new Uint32Array(1),nt=new Uint8Array(1);for(;et>0;){nt[0]=o[s];const it=Math.min(et,8),st=8-it;rt[0]=4278190080>>>24+st<<st,tt[0]=(nt[0]&rt[0])>>st,a=a?a<<it|tt[0]:tt[0],s+=1,et-=it}return a};class AC3Demuxer extends BaseAudioDemuxer{constructor(s){super(),this.observer=void 0,this.observer=s}resetInitSegment(s,a,et,tt){super.resetInitSegment(s,a,et,tt),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:a,duration:tt,inputTimeScale:9e4,dropped:0}}canParse(s,a){return a+64<s.length}appendFrame(s,a,et){const tt=appendFrame(s,a,et,this.basePTS,this.frameIndex);if(tt!==-1)return{sample:s.samples[s.samples.length-1],length:tt,missing:0}}static probe(s){if(!s)return!1;const a=getID3Data(s,0);if(!a)return!1;const et=a.length;return s[et]===11&&s[et+1]===119&&getTimeStamp(a)!==void 0&&getAudioBSID(s,et)<16}}function appendFrame(o,s,a,et,tt){if(a+8>s.length||s[a]!==11||s[a+1]!==119)return-1;const rt=s[a+4]>>6;if(rt>=3)return-1;const it=[48e3,44100,32e3][rt],st=s[a+4]&63,at=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][st*3+rt]*2;if(a+at>s.length)return-1;const lt=s[a+6]>>5;let ct=0;lt===2?ct+=2:(lt&1&&lt!==1&&(ct+=2),lt&4&&(ct+=2));const ht=(s[a+6]<<8|s[a+7])>>12-ct&1,dt=[2,1,2,3,3,4,4,5][lt]+ht,pt=s[a+5]>>3,gt=s[a+5]&7,mt=new Uint8Array([rt<<6|pt<<1|gt>>2,(gt&3)<<6|lt<<3|ht<<2|st>>4,st<<4&224]),yt=1536/it*9e4,vt=et+tt*yt,Et=s.subarray(a,a+at);return o.config=mt,o.channelCount=dt,o.samplerate=it,o.samples.push({unit:Et,pts:vt}),at}class BaseVideoParser{constructor(){this.VideoSample=null}createVideoSample(s,a,et,tt){return{key:s,frame:!1,pts:a,dts:et,units:[],debug:tt,length:0}}getLastNalUnit(s){var a;let et=this.VideoSample,tt;if((!et||et.units.length===0)&&(et=s[s.length-1]),(a=et)!=null&&a.units){const rt=et.units;tt=rt[rt.length-1]}return tt}pushAccessUnit(s,a){if(s.units.length&&s.frame){if(s.pts===void 0){const et=a.samples,tt=et.length;if(tt){const rt=et[tt-1];s.pts=rt.pts,s.dts=rt.dts}else{a.dropped++;return}}a.samples.push(s)}s.debug.length&&logger.log(s.pts+"/"+s.dts+":"+s.debug)}}class ExpGolomb{constructor(s){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=s,this.bytesAvailable=s.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const s=this.data,a=this.bytesAvailable,et=s.byteLength-a,tt=new Uint8Array(4),rt=Math.min(4,a);if(rt===0)throw new Error("no bytes available");tt.set(s.subarray(et,et+rt)),this.word=new DataView(tt.buffer).getUint32(0),this.bitsAvailable=rt*8,this.bytesAvailable-=rt}skipBits(s){let a;s=Math.min(s,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>s?(this.word<<=s,this.bitsAvailable-=s):(s-=this.bitsAvailable,a=s>>3,s-=a<<3,this.bytesAvailable-=a,this.loadWord(),this.word<<=s,this.bitsAvailable-=s)}readBits(s){let a=Math.min(this.bitsAvailable,s);const et=this.word>>>32-a;if(s>32&&logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=a,this.bitsAvailable>0)this.word<<=a;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return a=s-a,a>0&&this.bitsAvailable?et<<a|this.readBits(a):et}skipLZ(){let s;for(s=0;s<this.bitsAvailable;++s)if(this.word&2147483648>>>s)return this.word<<=s,this.bitsAvailable-=s,s;return this.loadWord(),s+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const s=this.skipLZ();return this.readBits(s+1)-1}readEG(){const s=this.readUEG();return 1&s?1+s>>>1:-1*(s>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(s){let a=8,et=8,tt;for(let rt=0;rt<s;rt++)et!==0&&(tt=this.readEG(),et=(a+tt+256)%256),a=et===0?a:et}readSPS(){let s=0,a=0,et=0,tt=0,rt,nt,it;const st=this.readUByte.bind(this),ot=this.readBits.bind(this),at=this.readUEG.bind(this),lt=this.readBoolean.bind(this),ct=this.skipBits.bind(this),ht=this.skipEG.bind(this),ft=this.skipUEG.bind(this),dt=this.skipScalingList.bind(this);st();const pt=st();if(ot(5),ct(3),st(),ft(),pt===100||pt===110||pt===122||pt===244||pt===44||pt===83||pt===86||pt===118||pt===128){const xt=at();if(xt===3&&ct(1),ft(),ft(),ct(1),lt())for(nt=xt!==3?8:12,it=0;it<nt;it++)lt()&&(it<6?dt(16):dt(64))}ft();const gt=at();if(gt===0)at();else if(gt===1)for(ct(1),ht(),ht(),rt=at(),it=0;it<rt;it++)ht();ft(),ct(1);const mt=at(),yt=at(),vt=ot(1);vt===0&&ct(1),ct(1),lt()&&(s=at(),a=at(),et=at(),tt=at());let Et=[1,1];if(lt()&&lt())switch(st()){case 1:Et=[1,1];break;case 2:Et=[12,11];break;case 3:Et=[10,11];break;case 4:Et=[16,11];break;case 5:Et=[40,33];break;case 6:Et=[24,11];break;case 7:Et=[20,11];break;case 8:Et=[32,11];break;case 9:Et=[80,33];break;case 10:Et=[18,11];break;case 11:Et=[15,11];break;case 12:Et=[64,33];break;case 13:Et=[160,99];break;case 14:Et=[4,3];break;case 15:Et=[3,2];break;case 16:Et=[2,1];break;case 255:{Et=[st()<<8|st(),st()<<8|st()];break}}return{width:Math.ceil((mt+1)*16-s*2-a*2),height:(2-vt)*(yt+1)*16-(vt?2:4)*(et+tt),pixelRatio:Et}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class AvcVideoParser extends BaseVideoParser{parseAVCPES(s,a,et,tt,rt){const nt=this.parseAVCNALu(s,et.data);let it=this.VideoSample,st,ot=!1;et.data=null,it&&nt.length&&!s.audFound&&(this.pushAccessUnit(it,s),it=this.VideoSample=this.createVideoSample(!1,et.pts,et.dts,"")),nt.forEach(at=>{var lt;switch(at.type){case 1:{let dt=!1;st=!0;const pt=at.data;if(ot&&pt.length>4){const gt=new ExpGolomb(pt).readSliceType();(gt===2||gt===4||gt===7||gt===9)&&(dt=!0)}if(dt){var ct;(ct=it)!=null&&ct.frame&&!it.key&&(this.pushAccessUnit(it,s),it=this.VideoSample=null)}it||(it=this.VideoSample=this.createVideoSample(!0,et.pts,et.dts,"")),it.frame=!0,it.key=dt;break}case 5:st=!0,(lt=it)!=null&&lt.frame&&!it.key&&(this.pushAccessUnit(it,s),it=this.VideoSample=null),it||(it=this.VideoSample=this.createVideoSample(!0,et.pts,et.dts,"")),it.key=!0,it.frame=!0;break;case 6:{st=!0,parseSEIMessageFromNALu(at.data,1,et.pts,a.samples);break}case 7:{var ht,ft;st=!0,ot=!0;const dt=at.data,gt=new ExpGolomb(dt).readSPS();if(!s.sps||s.width!==gt.width||s.height!==gt.height||((ht=s.pixelRatio)==null?void 0:ht[0])!==gt.pixelRatio[0]||((ft=s.pixelRatio)==null?void 0:ft[1])!==gt.pixelRatio[1]){s.width=gt.width,s.height=gt.height,s.pixelRatio=gt.pixelRatio,s.sps=[dt],s.duration=rt;const mt=dt.subarray(1,4);let yt="avc1.";for(let vt=0;vt<3;vt++){let Et=mt[vt].toString(16);Et.length<2&&(Et="0"+Et),yt+=Et}s.codec=yt}break}case 8:st=!0,s.pps=[at.data];break;case 9:st=!0,s.audFound=!0,it&&this.pushAccessUnit(it,s),it=this.VideoSample=this.createVideoSample(!1,et.pts,et.dts,"");break;case 12:st=!0;break;default:st=!1,it&&(it.debug+="unknown NAL "+at.type+" ");break}it&&st&&it.units.push(at)}),tt&&it&&(this.pushAccessUnit(it,s),this.VideoSample=null)}parseAVCNALu(s,a){const et=a.byteLength;let tt=s.naluState||0;const rt=tt,nt=[];let it=0,st,ot,at,lt=-1,ct=0;for(tt===-1&&(lt=0,ct=a[0]&31,tt=0,it=1);it<et;){if(st=a[it++],!tt){tt=st?0:1;continue}if(tt===1){tt=st?0:2;continue}if(!st)tt=3;else if(st===1){if(ot=it-tt-1,lt>=0){const ht={data:a.subarray(lt,ot),type:ct};nt.push(ht)}else{const ht=this.getLastNalUnit(s.samples);ht&&(rt&&it<=4-rt&&ht.state&&(ht.data=ht.data.subarray(0,ht.data.byteLength-rt)),ot>0&&(ht.data=appendUint8Array(ht.data,a.subarray(0,ot)),ht.state=0))}it<et?(at=a[it]&31,lt=it,ct=at,tt=0):tt=-1}else tt=0}if(lt>=0&&tt>=0){const ht={data:a.subarray(lt,et),type:ct,state:tt};nt.push(ht)}if(nt.length===0){const ht=this.getLastNalUnit(s.samples);ht&&(ht.data=appendUint8Array(ht.data,a))}return s.naluState=tt,nt}}class SampleAesDecrypter{constructor(s,a,et){this.keyData=void 0,this.decrypter=void 0,this.keyData=et,this.decrypter=new Decrypter(a,{removePKCS7Padding:!1})}decryptBuffer(s){return this.decrypter.decrypt(s,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(s,a,et){const tt=s[a].unit;if(tt.length<=16)return;const rt=tt.subarray(16,tt.length-tt.length%16),nt=rt.buffer.slice(rt.byteOffset,rt.byteOffset+rt.length);this.decryptBuffer(nt).then(it=>{const st=new Uint8Array(it);tt.set(st,16),this.decrypter.isSync()||this.decryptAacSamples(s,a+1,et)})}decryptAacSamples(s,a,et){for(;;a++){if(a>=s.length){et();return}if(!(s[a].unit.length<32)&&(this.decryptAacSample(s,a,et),!this.decrypter.isSync()))return}}getAvcEncryptedData(s){const a=Math.floor((s.length-48)/160)*16+16,et=new Int8Array(a);let tt=0;for(let rt=32;rt<s.length-16;rt+=160,tt+=16)et.set(s.subarray(rt,rt+16),tt);return et}getAvcDecryptedUnit(s,a){const et=new Uint8Array(a);let tt=0;for(let rt=32;rt<s.length-16;rt+=160,tt+=16)s.set(et.subarray(tt,tt+16),rt);return s}decryptAvcSample(s,a,et,tt,rt){const nt=discardEPB(rt.data),it=this.getAvcEncryptedData(nt);this.decryptBuffer(it.buffer).then(st=>{rt.data=this.getAvcDecryptedUnit(nt,st),this.decrypter.isSync()||this.decryptAvcSamples(s,a,et+1,tt)})}decryptAvcSamples(s,a,et,tt){if(s instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;a++,et=0){if(a>=s.length){tt();return}const rt=s[a].units;for(;!(et>=rt.length);et++){const nt=rt[et];if(!(nt.data.length<=48||nt.type!==1&&nt.type!==5)&&(this.decryptAvcSample(s,a,et,tt,nt),!this.decrypter.isSync()))return}}}}const PACKET_LENGTH=188;class TSDemuxer{constructor(s,a,et){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=s,this.config=a,this.typeSupported=et,this.videoParser=new AvcVideoParser}static probe(s){const a=TSDemuxer.syncOffset(s);return a>0&&logger.warn(`MPEG2-TS detected but first sync word found @ offset ${a}`),a!==-1}static syncOffset(s){const a=s.length;let et=Math.min(PACKET_LENGTH*5,a-PACKET_LENGTH)+1,tt=0;for(;tt<et;){let rt=!1,nt=-1,it=0;for(let st=tt;st<a;st+=PACKET_LENGTH)if(s[st]===71&&(a-st===PACKET_LENGTH||s[st+PACKET_LENGTH]===71)){if(it++,nt===-1&&(nt=st,nt!==0&&(et=Math.min(nt+PACKET_LENGTH*99,s.length-PACKET_LENGTH)+1)),rt||(rt=parsePID(s,st)===0),rt&&it>1&&(nt===0&&it>2||st+PACKET_LENGTH>et))return nt}else{if(it)return-1;break}tt++}return-1}static createTrack(s,a){return{container:s==="video"||s==="audio"?"video/mp2t":void 0,type:s,id:RemuxerTrackIdConfig[s],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:s==="audio"?a:void 0}}resetInitSegment(s,a,et,tt){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=TSDemuxer.createTrack("video"),this._audioTrack=TSDemuxer.createTrack("audio",tt),this._id3Track=TSDemuxer.createTrack("id3"),this._txtTrack=TSDemuxer.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=a,this.videoCodec=et,this._duration=tt}resetTimeStamp(){}resetContiguity(){const{_audioTrack:s,_videoTrack:a,_id3Track:et}=this;s&&(s.pesData=null),a&&(a.pesData=null),et&&(et.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(s,a,et=!1,tt=!1){et||(this.sampleAes=null);let rt;const nt=this._videoTrack,it=this._audioTrack,st=this._id3Track,ot=this._txtTrack;let at=nt.pid,lt=nt.pesData,ct=it.pid,ht=st.pid,ft=it.pesData,dt=st.pesData,pt=null,gt=this.pmtParsed,mt=this._pmtId,yt=s.length;if(this.remainderData&&(s=appendUint8Array(this.remainderData,s),yt=s.length,this.remainderData=null),yt<PACKET_LENGTH&&!tt)return this.remainderData=s,{audioTrack:it,videoTrack:nt,id3Track:st,textTrack:ot};const vt=Math.max(0,TSDemuxer.syncOffset(s));yt-=(yt-vt)%PACKET_LENGTH,yt<s.byteLength&&!tt&&(this.remainderData=new Uint8Array(s.buffer,yt,s.buffer.byteLength-yt));let Et=0;for(let wt=vt;wt<yt;wt+=PACKET_LENGTH)if(s[wt]===71){const Rt=!!(s[wt+1]&64),Ct=parsePID(s,wt),Ft=(s[wt+3]&48)>>4;let zt;if(Ft>1){if(zt=wt+5+s[wt+4],zt===wt+PACKET_LENGTH)continue}else zt=wt+4;switch(Ct){case at:Rt&&(lt&&(rt=parsePES(lt))&&this.videoParser.parseAVCPES(nt,ot,rt,!1,this._duration),lt={data:[],size:0}),lt&&(lt.data.push(s.subarray(zt,wt+PACKET_LENGTH)),lt.size+=wt+PACKET_LENGTH-zt);break;case ct:if(Rt){if(ft&&(rt=parsePES(ft)))switch(it.segmentCodec){case"aac":this.parseAACPES(it,rt);break;case"mp3":this.parseMPEGPES(it,rt);break;case"ac3":this.parseAC3PES(it,rt);break}ft={data:[],size:0}}ft&&(ft.data.push(s.subarray(zt,wt+PACKET_LENGTH)),ft.size+=wt+PACKET_LENGTH-zt);break;case ht:Rt&&(dt&&(rt=parsePES(dt))&&this.parseID3PES(st,rt),dt={data:[],size:0}),dt&&(dt.data.push(s.subarray(zt,wt+PACKET_LENGTH)),dt.size+=wt+PACKET_LENGTH-zt);break;case 0:Rt&&(zt+=s[zt]+1),mt=this._pmtId=parsePAT(s,zt);break;case mt:{Rt&&(zt+=s[zt]+1);const Nt=parsePMT(s,zt,this.typeSupported,et,this.observer);at=Nt.videoPid,at>0&&(nt.pid=at,nt.segmentCodec=Nt.segmentVideoCodec),ct=Nt.audioPid,ct>0&&(it.pid=ct,it.segmentCodec=Nt.segmentAudioCodec),ht=Nt.id3Pid,ht>0&&(st.pid=ht),pt!==null&&!gt&&(logger.warn(`MPEG-TS PMT found at ${wt} after unknown PID '${pt}'. Backtracking to sync byte @${vt} to parse all TS packets.`),pt=null,wt=vt-188),gt=this.pmtParsed=!0;break}case 17:case 8191:break;default:pt=Ct;break}}else Et++;Et>0&&emitParsingError(this.observer,new Error(`Found ${Et} TS packet/s that do not start with 0x47`)),nt.pesData=lt,it.pesData=ft,st.pesData=dt;const xt={audioTrack:it,videoTrack:nt,id3Track:st,textTrack:ot};return tt&&this.extractRemainingSamples(xt),xt}flush(){const{remainderData:s}=this;this.remainderData=null;let a;return s?a=this.demux(s,-1,!1,!0):a={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(a),this.sampleAes?this.decrypt(a,this.sampleAes):a}extractRemainingSamples(s){const{audioTrack:a,videoTrack:et,id3Track:tt,textTrack:rt}=s,nt=et.pesData,it=a.pesData,st=tt.pesData;let ot;if(nt&&(ot=parsePES(nt))?(this.videoParser.parseAVCPES(et,rt,ot,!0,this._duration),et.pesData=null):et.pesData=nt,it&&(ot=parsePES(it))){switch(a.segmentCodec){case"aac":this.parseAACPES(a,ot);break;case"mp3":this.parseMPEGPES(a,ot);break;case"ac3":this.parseAC3PES(a,ot);break}a.pesData=null}else it!=null&&it.size&&logger.log("last AAC PES packet truncated,might overlap between fragments"),a.pesData=it;st&&(ot=parsePES(st))?(this.parseID3PES(tt,ot),tt.pesData=null):tt.pesData=st}demuxSampleAes(s,a,et){const tt=this.demux(s,et,!0,!this.config.progressive),rt=this.sampleAes=new SampleAesDecrypter(this.observer,this.config,a);return this.decrypt(tt,rt)}decrypt(s,a){return new Promise(et=>{const{audioTrack:tt,videoTrack:rt}=s;tt.samples&&tt.segmentCodec==="aac"?a.decryptAacSamples(tt.samples,0,()=>{rt.samples?a.decryptAvcSamples(rt.samples,0,0,()=>{et(s)}):et(s)}):rt.samples&&a.decryptAvcSamples(rt.samples,0,0,()=>{et(s)})})}destroy(){this._duration=0}parseAACPES(s,a){let et=0;const tt=this.aacOverFlow;let rt=a.data;if(tt){this.aacOverFlow=null;const lt=tt.missing,ct=tt.sample.unit.byteLength;if(lt===-1)rt=appendUint8Array(tt.sample.unit,rt);else{const ht=ct-lt;tt.sample.unit.set(rt.subarray(0,lt),ht),s.samples.push(tt.sample),et=tt.missing}}let nt,it;for(nt=et,it=rt.length;nt<it-1&&!isHeader$1(rt,nt);nt++);if(nt!==et){let lt;const ct=nt<it-1;if(ct?lt=`AAC PES did not start with ADTS header,offset:${nt}`:lt="No ADTS header found in AAC PES",emitParsingError(this.observer,new Error(lt),ct),!ct)return}initTrackConfig(s,this.observer,rt,nt,this.audioCodec);let st;if(a.pts!==void 0)st=a.pts;else if(tt){const lt=getFrameDuration(s.samplerate);st=tt.sample.pts+lt}else{logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let ot=0,at;for(;nt<it;)if(at=appendFrame$2(s,rt,nt,st,ot),nt+=at.length,at.missing){this.aacOverFlow=at;break}else for(ot++;nt<it-1&&!isHeader$1(rt,nt);nt++);}parseMPEGPES(s,a){const et=a.data,tt=et.length;let rt=0,nt=0;const it=a.pts;if(it===void 0){logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;nt<tt;)if(isHeader(et,nt)){const st=appendFrame$1(s,et,nt,it,rt);if(st)nt+=st.length,rt++;else break}else nt++}parseAC3PES(s,a){{const et=a.data,tt=a.pts;if(tt===void 0){logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const rt=et.length;let nt=0,it=0,st;for(;it<rt&&(st=appendFrame(s,et,it,tt,nt++))>0;)it+=st}}parseID3PES(s,a){if(a.pts===void 0){logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const et=_extends({},a,{type:this._videoTrack?MetadataSchema.emsg:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});s.samples.push(et)}}function parsePID(o,s){return((o[s+1]&31)<<8)+o[s+2]}function parsePAT(o,s){return(o[s+10]&31)<<8|o[s+11]}function parsePMT(o,s,a,et,tt){const rt={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},nt=(o[s+1]&15)<<8|o[s+2],it=s+3+nt-4,st=(o[s+10]&15)<<8|o[s+11];for(s+=12+st;s<it;){const ot=parsePID(o,s),at=(o[s+3]&15)<<8|o[s+4];switch(o[s]){case 207:if(!et){logEncryptedSamplesFoundInUnencryptedStream("ADTS AAC");break}case 15:rt.audioPid===-1&&(rt.audioPid=ot);break;case 21:rt.id3Pid===-1&&(rt.id3Pid=ot);break;case 219:if(!et){logEncryptedSamplesFoundInUnencryptedStream("H.264");break}case 27:rt.videoPid===-1&&(rt.videoPid=ot,rt.segmentVideoCodec="avc");break;case 3:case 4:!a.mpeg&&!a.mp3?logger.log("MPEG audio found, not supported in this browser"):rt.audioPid===-1&&(rt.audioPid=ot,rt.segmentAudioCodec="mp3");break;case 193:if(!et){logEncryptedSamplesFoundInUnencryptedStream("AC-3");break}case 129:a.ac3?rt.audioPid===-1&&(rt.audioPid=ot,rt.segmentAudioCodec="ac3"):logger.log("AC-3 audio found, not supported in this browser");break;case 6:if(rt.audioPid===-1&&at>0){let lt=s+5,ct=at;for(;ct>2;){switch(o[lt]){case 106:a.ac3!==!0?logger.log("AC-3 audio found, not supported in this browser for now"):(rt.audioPid=ot,rt.segmentAudioCodec="ac3");break}const ft=o[lt+1]+2;lt+=ft,ct-=ft}}break;case 194:case 135:return emitParsingError(tt,new Error("Unsupported EC-3 in M2TS found")),rt;case 36:return emitParsingError(tt,new Error("Unsupported HEVC in M2TS found")),rt}s+=at+5}return rt}function emitParsingError(o,s,a){logger.warn(`parsing error: ${s.message}`),o.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,levelRetry:a,error:s,reason:s.message})}function logEncryptedSamplesFoundInUnencryptedStream(o){logger.log(`${o} with AES-128-CBC encryption found in unencrypted stream`)}function parsePES(o){let s=0,a,et,tt,rt,nt;const it=o.data;if(!o||o.size===0)return null;for(;it[0].length<19&&it.length>1;)it[0]=appendUint8Array(it[0],it[1]),it.splice(1,1);if(a=it[0],(a[0]<<16)+(a[1]<<8)+a[2]===1){if(et=(a[4]<<8)+a[5],et&&et>o.size-6)return null;const ot=a[7];ot&192&&(rt=(a[9]&14)*536870912+(a[10]&255)*4194304+(a[11]&254)*16384+(a[12]&255)*128+(a[13]&254)/2,ot&64?(nt=(a[14]&14)*536870912+(a[15]&255)*4194304+(a[16]&254)*16384+(a[17]&255)*128+(a[18]&254)/2,rt-nt>60*9e4&&(logger.warn(`${Math.round((rt-nt)/9e4)}s delta between PTS and DTS, align them`),rt=nt)):nt=rt),tt=a[8];let at=tt+9;if(o.size<=at)return null;o.size-=at;const lt=new Uint8Array(o.size);for(let ct=0,ht=it.length;ct<ht;ct++){a=it[ct];let ft=a.byteLength;if(at)if(at>ft){at-=ft;continue}else a=a.subarray(at),ft-=at,at=0;lt.set(a,s),s+=ft}return et&&(et-=tt+3),{data:lt,pts:rt,dts:nt,len:et}}return null}class MP3Demuxer extends BaseAudioDemuxer{resetInitSegment(s,a,et,tt){super.resetInitSegment(s,a,et,tt),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:a,duration:tt,inputTimeScale:9e4,dropped:0}}static probe(s){if(!s)return!1;const a=getID3Data(s,0);let et=a?.length||0;if(a&&s[et]===11&&s[et+1]===119&&getTimeStamp(a)!==void 0&&getAudioBSID(s,et)<=16)return!1;for(let tt=s.length;et<tt;et++)if(probe(s,et))return logger.log("MPEG Audio sync word found !"),!0;return!1}canParse(s,a){return canParse(s,a)}appendFrame(s,a,et){if(this.basePTS!==null)return appendFrame$1(s,a,et,this.basePTS,this.frameIndex)}}class AAC{static getSilentFrame(s,a){switch(s){case"mp4a.40.2":if(a===1)return new Uint8Array([0,200,0,128,35,128]);if(a===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(a===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(a===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(a===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(a===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(a===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(a===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(a===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const UINT32_MAX=Math.pow(2,32)-1;class MP4{static init(){MP4.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let s;for(s in MP4.types)MP4.types.hasOwnProperty(s)&&(MP4.types[s]=[s.charCodeAt(0),s.charCodeAt(1),s.charCodeAt(2),s.charCodeAt(3)]);const a=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),et=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);MP4.HDLR_TYPES={video:a,audio:et};const tt=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),rt=new Uint8Array([0,0,0,0,0,0,0,0]);MP4.STTS=MP4.STSC=MP4.STCO=rt,MP4.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),MP4.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),MP4.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),MP4.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const nt=new Uint8Array([105,115,111,109]),it=new Uint8Array([97,118,99,49]),st=new Uint8Array([0,0,0,1]);MP4.FTYP=MP4.box(MP4.types.ftyp,nt,st,nt,it),MP4.DINF=MP4.box(MP4.types.dinf,MP4.box(MP4.types.dref,tt))}static box(s,...a){let et=8,tt=a.length;const rt=tt;for(;tt--;)et+=a[tt].byteLength;const nt=new Uint8Array(et);for(nt[0]=et>>24&255,nt[1]=et>>16&255,nt[2]=et>>8&255,nt[3]=et&255,nt.set(s,4),tt=0,et=8;tt<rt;tt++)nt.set(a[tt],et),et+=a[tt].byteLength;return nt}static hdlr(s){return MP4.box(MP4.types.hdlr,MP4.HDLR_TYPES[s])}static mdat(s){return MP4.box(MP4.types.mdat,s)}static mdhd(s,a){a*=s;const et=Math.floor(a/(UINT32_MAX+1)),tt=Math.floor(a%(UINT32_MAX+1));return MP4.box(MP4.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,s>>24&255,s>>16&255,s>>8&255,s&255,et>>24,et>>16&255,et>>8&255,et&255,tt>>24,tt>>16&255,tt>>8&255,tt&255,85,196,0,0]))}static mdia(s){return MP4.box(MP4.types.mdia,MP4.mdhd(s.timescale,s.duration),MP4.hdlr(s.type),MP4.minf(s))}static mfhd(s){return MP4.box(MP4.types.mfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255]))}static minf(s){return s.type==="audio"?MP4.box(MP4.types.minf,MP4.box(MP4.types.smhd,MP4.SMHD),MP4.DINF,MP4.stbl(s)):MP4.box(MP4.types.minf,MP4.box(MP4.types.vmhd,MP4.VMHD),MP4.DINF,MP4.stbl(s))}static moof(s,a,et){return MP4.box(MP4.types.moof,MP4.mfhd(s),MP4.traf(et,a))}static moov(s){let a=s.length;const et=[];for(;a--;)et[a]=MP4.trak(s[a]);return MP4.box.apply(null,[MP4.types.moov,MP4.mvhd(s[0].timescale,s[0].duration)].concat(et).concat(MP4.mvex(s)))}static mvex(s){let a=s.length;const et=[];for(;a--;)et[a]=MP4.trex(s[a]);return MP4.box.apply(null,[MP4.types.mvex,...et])}static mvhd(s,a){a*=s;const et=Math.floor(a/(UINT32_MAX+1)),tt=Math.floor(a%(UINT32_MAX+1)),rt=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,s>>24&255,s>>16&255,s>>8&255,s&255,et>>24,et>>16&255,et>>8&255,et&255,tt>>24,tt>>16&255,tt>>8&255,tt&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return MP4.box(MP4.types.mvhd,rt)}static sdtp(s){const a=s.samples||[],et=new Uint8Array(4+a.length);let tt,rt;for(tt=0;tt<a.length;tt++)rt=a[tt].flags,et[tt+4]=rt.dependsOn<<4|rt.isDependedOn<<2|rt.hasRedundancy;return MP4.box(MP4.types.sdtp,et)}static stbl(s){return MP4.box(MP4.types.stbl,MP4.stsd(s),MP4.box(MP4.types.stts,MP4.STTS),MP4.box(MP4.types.stsc,MP4.STSC),MP4.box(MP4.types.stsz,MP4.STSZ),MP4.box(MP4.types.stco,MP4.STCO))}static avc1(s){let a=[],et=[],tt,rt,nt;for(tt=0;tt<s.sps.length;tt++)rt=s.sps[tt],nt=rt.byteLength,a.push(nt>>>8&255),a.push(nt&255),a=a.concat(Array.prototype.slice.call(rt));for(tt=0;tt<s.pps.length;tt++)rt=s.pps[tt],nt=rt.byteLength,et.push(nt>>>8&255),et.push(nt&255),et=et.concat(Array.prototype.slice.call(rt));const it=MP4.box(MP4.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|s.sps.length].concat(a).concat([s.pps.length]).concat(et))),st=s.width,ot=s.height,at=s.pixelRatio[0],lt=s.pixelRatio[1];return MP4.box(MP4.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,st>>8&255,st&255,ot>>8&255,ot&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),it,MP4.box(MP4.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),MP4.box(MP4.types.pasp,new Uint8Array([at>>24,at>>16&255,at>>8&255,at&255,lt>>24,lt>>16&255,lt>>8&255,lt&255])))}static esds(s){const a=s.config.length;return new Uint8Array([0,0,0,0,3,23+a,0,1,0,4,15+a,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([a]).concat(s.config).concat([6,1,2]))}static audioStsd(s){const a=s.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,s.channelCount,0,16,0,0,0,0,a>>8&255,a&255,0,0])}static mp4a(s){return MP4.box(MP4.types.mp4a,MP4.audioStsd(s),MP4.box(MP4.types.esds,MP4.esds(s)))}static mp3(s){return MP4.box(MP4.types[".mp3"],MP4.audioStsd(s))}static ac3(s){return MP4.box(MP4.types["ac-3"],MP4.audioStsd(s),MP4.box(MP4.types.dac3,s.config))}static stsd(s){return s.type==="audio"?s.segmentCodec==="mp3"&&s.codec==="mp3"?MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp3(s)):s.segmentCodec==="ac3"?MP4.box(MP4.types.stsd,MP4.STSD,MP4.ac3(s)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp4a(s)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.avc1(s))}static tkhd(s){const a=s.id,et=s.duration*s.timescale,tt=s.width,rt=s.height,nt=Math.floor(et/(UINT32_MAX+1)),it=Math.floor(et%(UINT32_MAX+1));return MP4.box(MP4.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,a>>24&255,a>>16&255,a>>8&255,a&255,0,0,0,0,nt>>24,nt>>16&255,nt>>8&255,nt&255,it>>24,it>>16&255,it>>8&255,it&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,tt>>8&255,tt&255,0,0,rt>>8&255,rt&255,0,0]))}static traf(s,a){const et=MP4.sdtp(s),tt=s.id,rt=Math.floor(a/(UINT32_MAX+1)),nt=Math.floor(a%(UINT32_MAX+1));return MP4.box(MP4.types.traf,MP4.box(MP4.types.tfhd,new Uint8Array([0,0,0,0,tt>>24,tt>>16&255,tt>>8&255,tt&255])),MP4.box(MP4.types.tfdt,new Uint8Array([1,0,0,0,rt>>24,rt>>16&255,rt>>8&255,rt&255,nt>>24,nt>>16&255,nt>>8&255,nt&255])),MP4.trun(s,et.length+16+20+8+16+8+8),et)}static trak(s){return s.duration=s.duration||4294967295,MP4.box(MP4.types.trak,MP4.tkhd(s),MP4.mdia(s))}static trex(s){const a=s.id;return MP4.box(MP4.types.trex,new Uint8Array([0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(s,a){const et=s.samples||[],tt=et.length,rt=12+16*tt,nt=new Uint8Array(rt);let it,st,ot,at,lt,ct;for(a+=8+rt,nt.set([s.type==="video"?1:0,0,15,1,tt>>>24&255,tt>>>16&255,tt>>>8&255,tt&255,a>>>24&255,a>>>16&255,a>>>8&255,a&255],0),it=0;it<tt;it++)st=et[it],ot=st.duration,at=st.size,lt=st.flags,ct=st.cts,nt.set([ot>>>24&255,ot>>>16&255,ot>>>8&255,ot&255,at>>>24&255,at>>>16&255,at>>>8&255,at&255,lt.isLeading<<2|lt.dependsOn,lt.isDependedOn<<6|lt.hasRedundancy<<4|lt.paddingValue<<1|lt.isNonSync,lt.degradPrio&61440,lt.degradPrio&15,ct>>>24&255,ct>>>16&255,ct>>>8&255,ct&255],12+16*it);return MP4.box(MP4.types.trun,nt)}static initSegment(s){MP4.types||MP4.init();const a=MP4.moov(s);return appendUint8Array(MP4.FTYP,a)}}MP4.types=void 0;MP4.HDLR_TYPES=void 0;MP4.STTS=void 0;MP4.STSC=void 0;MP4.STCO=void 0;MP4.STSZ=void 0;MP4.VMHD=void 0;MP4.SMHD=void 0;MP4.STSD=void 0;MP4.FTYP=void 0;MP4.DINF=void 0;const MPEG_TS_CLOCK_FREQ_HZ=9e4;function toTimescaleFromBase(o,s,a=1,et=!1){const tt=o*s*a;return et?Math.round(tt):tt}function toTimescaleFromScale(o,s,a=1,et=!1){return toTimescaleFromBase(o,s,1/a,et)}function toMsFromMpegTsClock(o,s=!1){return toTimescaleFromBase(o,1e3,1/MPEG_TS_CLOCK_FREQ_HZ,s)}function toMpegTsClockFromTimescale(o,s=1){return toTimescaleFromBase(o,MPEG_TS_CLOCK_FREQ_HZ,1/s)}const MAX_SILENT_FRAME_DURATION=10*1e3,AAC_SAMPLES_PER_FRAME=1024,MPEG_AUDIO_SAMPLE_PER_FRAME=1152,AC3_SAMPLES_PER_FRAME=1536;let chromeVersion=null,safariWebkitVersion=null;class MP4Remuxer{constructor(s,a,et,tt=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=s,this.config=a,this.typeSupported=et,this.ISGenerated=!1,chromeVersion===null){const nt=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);chromeVersion=nt?parseInt(nt[1]):0}if(safariWebkitVersion===null){const rt=navigator.userAgent.match(/Safari\/(\d+)/i);safariWebkitVersion=rt?parseInt(rt[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(s){logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=s}resetNextTimestamp(){logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(s){let a=!1;const et=s.reduce((tt,rt)=>{const nt=rt.pts-tt;return nt<-4294967296?(a=!0,normalizePts(tt,rt.pts)):nt>0?tt:rt.pts},s[0].pts);return a&&logger.debug("PTS rollover detected"),et}remux(s,a,et,tt,rt,nt,it,st){let ot,at,lt,ct,ht,ft,dt=rt,pt=rt;const gt=s.pid>-1,mt=a.pid>-1,yt=a.samples.length,vt=s.samples.length>0,Et=it&&yt>0||yt>1;if((!gt||vt)&&(!mt||Et)||this.ISGenerated||it){if(this.ISGenerated){var wt,Rt,Ct,Ft;const Yt=this.videoTrackConfig;Yt&&(a.width!==Yt.width||a.height!==Yt.height||((wt=a.pixelRatio)==null?void 0:wt[0])!==((Rt=Yt.pixelRatio)==null?void 0:Rt[0])||((Ct=a.pixelRatio)==null?void 0:Ct[1])!==((Ft=Yt.pixelRatio)==null?void 0:Ft[1]))&&this.resetInitSegment()}else lt=this.generateIS(s,a,rt,nt);const zt=this.isVideoContiguous;let Nt=-1,Kt;if(Et&&(Nt=findKeyframeIndex(a.samples),!zt&&this.config.forceKeyFrameOnDiscontinuity))if(ft=!0,Nt>0){logger.warn(`[mp4-remuxer]: Dropped ${Nt} out of ${yt} video samples due to a missing keyframe`);const Yt=this.getVideoStartPts(a.samples);a.samples=a.samples.slice(Nt),a.dropped+=Nt,pt+=(a.samples[0].pts-Yt)/a.inputTimeScale,Kt=pt}else Nt===-1&&(logger.warn(`[mp4-remuxer]: No keyframe found out of ${yt} video samples`),ft=!1);if(this.ISGenerated){if(vt&&Et){const Yt=this.getVideoStartPts(a.samples),Pt=(normalizePts(s.samples[0].pts,Yt)-Yt)/a.inputTimeScale;dt+=Math.max(0,Pt),pt+=Math.max(0,-Pt)}if(vt){if(s.samplerate||(logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),lt=this.generateIS(s,a,rt,nt)),at=this.remuxAudio(s,dt,this.isAudioContiguous,nt,mt||Et||st===PlaylistLevelType.AUDIO?pt:void 0),Et){const Yt=at?at.endPTS-at.startPTS:0;a.inputTimeScale||(logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),lt=this.generateIS(s,a,rt,nt)),ot=this.remuxVideo(a,pt,zt,Yt)}}else Et&&(ot=this.remuxVideo(a,pt,zt,0));ot&&(ot.firstKeyFrame=Nt,ot.independent=Nt!==-1,ot.firstKeyFramePTS=Kt)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(et.samples.length&&(ht=flushTextTrackMetadataCueSamples(et,rt,this._initPTS,this._initDTS)),tt.samples.length&&(ct=flushTextTrackUserdataCueSamples(tt,rt,this._initPTS))),{audio:at,video:ot,initSegment:lt,independent:ft,text:ct,id3:ht}}generateIS(s,a,et,tt){const rt=s.samples,nt=a.samples,it=this.typeSupported,st={},ot=this._initPTS;let at=!ot||tt,lt="audio/mp4",ct,ht,ft;if(at&&(ct=ht=1/0),s.config&&rt.length){switch(s.timescale=s.samplerate,s.segmentCodec){case"mp3":it.mpeg?(lt="audio/mpeg",s.codec=""):it.mp3&&(s.codec="mp3");break;case"ac3":s.codec="ac-3";break}st.audio={id:"audio",container:lt,codec:s.codec,initSegment:s.segmentCodec==="mp3"&&it.mpeg?new Uint8Array(0):MP4.initSegment([s]),metadata:{channelCount:s.channelCount}},at&&(ft=s.inputTimeScale,!ot||ft!==ot.timescale?ct=ht=rt[0].pts-Math.round(ft*et):at=!1)}if(a.sps&&a.pps&&nt.length){if(a.timescale=a.inputTimeScale,st.video={id:"main",container:"video/mp4",codec:a.codec,initSegment:MP4.initSegment([a]),metadata:{width:a.width,height:a.height}},at)if(ft=a.inputTimeScale,!ot||ft!==ot.timescale){const dt=this.getVideoStartPts(nt),pt=Math.round(ft*et);ht=Math.min(ht,normalizePts(nt[0].dts,dt)-pt),ct=Math.min(ct,dt-pt)}else at=!1;this.videoTrackConfig={width:a.width,height:a.height,pixelRatio:a.pixelRatio}}if(Object.keys(st).length)return this.ISGenerated=!0,at?(this._initPTS={baseTime:ct,timescale:ft},this._initDTS={baseTime:ht,timescale:ft}):ct=ft=void 0,{tracks:st,initPTS:ct,timescale:ft}}remuxVideo(s,a,et,tt){const rt=s.inputTimeScale,nt=s.samples,it=[],st=nt.length,ot=this._initPTS;let at=this.nextAvcDts,lt=8,ct=this.videoSampleDuration,ht,ft,dt=Number.POSITIVE_INFINITY,pt=Number.NEGATIVE_INFINITY,gt=!1;if(!et||at===null){const St=a*rt,Mt=nt[0].pts-normalizePts(nt[0].dts,nt[0].pts);chromeVersion&&at!==null&&Math.abs(St-Mt-at)<15e3?et=!0:at=St-Mt}const mt=ot.baseTime*rt/ot.timescale;for(let St=0;St<st;St++){const Mt=nt[St];Mt.pts=normalizePts(Mt.pts-mt,at),Mt.dts=normalizePts(Mt.dts-mt,at),Mt.dts<nt[St>0?St-1:St].dts&&(gt=!0)}gt&&nt.sort(function(St,Mt){const jt=St.dts-Mt.dts,Gt=St.pts-Mt.pts;return jt||Gt}),ht=nt[0].dts,ft=nt[nt.length-1].dts;const yt=ft-ht,vt=yt?Math.round(yt/(st-1)):ct||s.inputTimeScale/30;if(et){const St=ht-at,Mt=St>vt,jt=St<-1;if((Mt||jt)&&(Mt?logger.warn(`AVC: ${toMsFromMpegTsClock(St,!0)} ms (${St}dts) hole between fragments detected at ${a.toFixed(3)}`):logger.warn(`AVC: ${toMsFromMpegTsClock(-St,!0)} ms (${St}dts) overlapping between fragments detected at ${a.toFixed(3)}`),!jt||at>=nt[0].pts||chromeVersion)){ht=at;const Gt=nt[0].pts-St;if(Mt)nt[0].dts=ht,nt[0].pts=Gt;else for(let Ht=0;Ht<nt.length&&!(nt[Ht].dts>Gt);Ht++)nt[Ht].dts-=St,nt[Ht].pts-=St;logger.log(`Video: Initial PTS/DTS adjusted: ${toMsFromMpegTsClock(Gt,!0)}/${toMsFromMpegTsClock(ht,!0)}, delta: ${toMsFromMpegTsClock(St,!0)} ms`)}}ht=Math.max(0,ht);let Et=0,xt=0,wt=ht;for(let St=0;St<st;St++){const Mt=nt[St],jt=Mt.units,Gt=jt.length;let Ht=0;for(let At=0;At<Gt;At++)Ht+=jt[At].data.length;xt+=Ht,Et+=Gt,Mt.length=Ht,Mt.dts<wt?(Mt.dts=wt,wt+=vt/4|0||1):wt=Mt.dts,dt=Math.min(Mt.pts,dt),pt=Math.max(Mt.pts,pt)}ft=nt[st-1].dts;const Rt=xt+4*Et+8;let Ct;try{Ct=new Uint8Array(Rt)}catch(St){this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MUX_ERROR,details:ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,error:St,bytes:Rt,reason:`fail allocating video mdat ${Rt}`});return}const Ft=new DataView(Ct.buffer);Ft.setUint32(0,Rt),Ct.set(MP4.types.mdat,4);let zt=!1,Nt=Number.POSITIVE_INFINITY,Kt=Number.POSITIVE_INFINITY,Yt=Number.NEGATIVE_INFINITY,Bt=Number.NEGATIVE_INFINITY;for(let St=0;St<st;St++){const Mt=nt[St],jt=Mt.units;let Gt=0;for(let $t=0,kt=jt.length;$t<kt;$t++){const Lt=jt[$t],bt=Lt.data,It=Lt.data.byteLength;Ft.setUint32(lt,It),lt+=4,Ct.set(bt,lt),lt+=It,Gt+=4+It}let Ht;if(St<st-1)ct=nt[St+1].dts-Mt.dts,Ht=nt[St+1].pts-Mt.pts;else{const $t=this.config,kt=St>0?Mt.dts-nt[St-1].dts:vt;if(Ht=St>0?Mt.pts-nt[St-1].pts:vt,$t.stretchShortVideoTrack&&this.nextAudioPts!==null){const Lt=Math.floor($t.maxBufferHole*rt),bt=(tt?dt+tt*rt:this.nextAudioPts)-Mt.pts;bt>Lt?(ct=bt-kt,ct<0?ct=kt:zt=!0,logger.log(`[mp4-remuxer]: It is approximately ${bt/90} ms to the next segment; using duration ${ct/90} ms for the last video frame.`)):ct=kt}else ct=kt}const At=Math.round(Mt.pts-Mt.dts);Nt=Math.min(Nt,ct),Yt=Math.max(Yt,ct),Kt=Math.min(Kt,Ht),Bt=Math.max(Bt,Ht),it.push(new Mp4Sample(Mt.key,ct,Gt,At))}if(it.length){if(chromeVersion){if(chromeVersion<70){const St=it[0].flags;St.dependsOn=2,St.isNonSync=0}}else if(safariWebkitVersion&&Bt-Kt<Yt-Nt&&vt/Yt<.025&&it[0].cts===0){logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let St=ht;for(let Mt=0,jt=it.length;Mt<jt;Mt++){const Gt=St+it[Mt].duration,Ht=St+it[Mt].cts;if(Mt<jt-1){const At=Gt+it[Mt+1].cts;it[Mt].duration=At-Ht}else it[Mt].duration=Mt?it[Mt-1].duration:vt;it[Mt].cts=0,St=Gt}}}ct=zt||!ct?vt:ct,this.nextAvcDts=at=ft+ct,this.videoSampleDuration=ct,this.isVideoContiguous=!0;const Tt={data1:MP4.moof(s.sequenceNumber++,ht,_extends({},s,{samples:it})),data2:Ct,startPTS:dt/rt,endPTS:(pt+ct)/rt,startDTS:ht/rt,endDTS:at/rt,type:"video",hasAudio:!1,hasVideo:!0,nb:it.length,dropped:s.dropped};return s.samples=[],s.dropped=0,Tt}getSamplesPerFrame(s){switch(s.segmentCodec){case"mp3":return MPEG_AUDIO_SAMPLE_PER_FRAME;case"ac3":return AC3_SAMPLES_PER_FRAME;default:return AAC_SAMPLES_PER_FRAME}}remuxAudio(s,a,et,tt,rt){const nt=s.inputTimeScale,it=s.samplerate?s.samplerate:nt,st=nt/it,ot=this.getSamplesPerFrame(s),at=ot*st,lt=this._initPTS,ct=s.segmentCodec==="mp3"&&this.typeSupported.mpeg,ht=[],ft=rt!==void 0;let dt=s.samples,pt=ct?0:8,gt=this.nextAudioPts||-1;const mt=a*nt,yt=lt.baseTime*nt/lt.timescale;if(this.isAudioContiguous=et=et||dt.length&&gt>0&&(tt&&Math.abs(mt-gt)<9e3||Math.abs(normalizePts(dt[0].pts-yt,mt)-gt)<20*at),dt.forEach(function(Pt){Pt.pts=normalizePts(Pt.pts-yt,mt)}),!et||gt<0){if(dt=dt.filter(Pt=>Pt.pts>=0),!dt.length)return;rt===0?gt=0:tt&&!ft?gt=Math.max(0,mt):gt=dt[0].pts}if(s.segmentCodec==="aac"){const Pt=this.config.maxAudioFramesDrift;for(let Dt=0,Tt=gt;Dt<dt.length;Dt++){const St=dt[Dt],Mt=St.pts,jt=Mt-Tt,Gt=Math.abs(1e3*jt/nt);if(jt<=-Pt*at&&ft)Dt===0&&(logger.warn(`Audio frame @ ${(Mt/nt).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*jt/nt)} ms.`),this.nextAudioPts=gt=Tt=Mt);else if(jt>=Pt*at&&Gt<MAX_SILENT_FRAME_DURATION&&ft){let Ht=Math.round(jt/at);Tt=Mt-Ht*at,Tt<0&&(Ht--,Tt+=at),Dt===0&&(this.nextAudioPts=gt=Tt),logger.warn(`[mp4-remuxer]: Injecting ${Ht} audio frame @ ${(Tt/nt).toFixed(3)}s due to ${Math.round(1e3*jt/nt)} ms gap.`);for(let At=0;At<Ht;At++){const $t=Math.max(Tt,0);let kt=AAC.getSilentFrame(s.manifestCodec||s.codec,s.channelCount);kt||(logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),kt=St.unit.subarray()),dt.splice(Dt,0,{unit:kt,pts:$t}),Tt+=at,Dt++}}St.pts=Tt,Tt+=at}}let vt=null,Et=null,xt,wt=0,Rt=dt.length;for(;Rt--;)wt+=dt[Rt].unit.byteLength;for(let Pt=0,Dt=dt.length;Pt<Dt;Pt++){const Tt=dt[Pt],St=Tt.unit;let Mt=Tt.pts;if(Et!==null){const Gt=ht[Pt-1];Gt.duration=Math.round((Mt-Et)/st)}else if(et&&s.segmentCodec==="aac"&&(Mt=gt),vt=Mt,wt>0){wt+=pt;try{xt=new Uint8Array(wt)}catch(Gt){this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MUX_ERROR,details:ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,error:Gt,bytes:wt,reason:`fail allocating audio mdat ${wt}`});return}ct||(new DataView(xt.buffer).setUint32(0,wt),xt.set(MP4.types.mdat,4))}else return;xt.set(St,pt);const jt=St.byteLength;pt+=jt,ht.push(new Mp4Sample(!0,ot,jt,0)),Et=Mt}const Ct=ht.length;if(!Ct)return;const Ft=ht[ht.length-1];this.nextAudioPts=gt=Et+st*Ft.duration;const zt=ct?new Uint8Array(0):MP4.moof(s.sequenceNumber++,vt/st,_extends({},s,{samples:ht}));s.samples=[];const Nt=vt/nt,Kt=gt/nt,Bt={data1:zt,data2:xt,startPTS:Nt,endPTS:Kt,startDTS:Nt,endDTS:Kt,type:"audio",hasAudio:!0,hasVideo:!1,nb:Ct};return this.isAudioContiguous=!0,Bt}remuxEmptyAudio(s,a,et,tt){const rt=s.inputTimeScale,nt=s.samplerate?s.samplerate:rt,it=rt/nt,st=this.nextAudioPts,ot=this._initDTS,at=ot.baseTime*9e4/ot.timescale,lt=(st!==null?st:tt.startDTS*rt)+at,ct=tt.endDTS*rt+at,ht=it*AAC_SAMPLES_PER_FRAME,ft=Math.ceil((ct-lt)/ht),dt=AAC.getSilentFrame(s.manifestCodec||s.codec,s.channelCount);if(logger.warn("[mp4-remuxer]: remux empty Audio"),!dt){logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}const pt=[];for(let gt=0;gt<ft;gt++){const mt=lt+gt*ht;pt.push({unit:dt,pts:mt,dts:mt})}return s.samples=pt,this.remuxAudio(s,a,et,!1)}}function normalizePts(o,s){let a;if(s===null)return o;for(s<o?a=-8589934592:a=8589934592;Math.abs(o-s)>4294967296;)o+=a;return o}function findKeyframeIndex(o){for(let s=0;s<o.length;s++)if(o[s].key)return s;return-1}function flushTextTrackMetadataCueSamples(o,s,a,et){const tt=o.samples.length;if(!tt)return;const rt=o.inputTimeScale;for(let it=0;it<tt;it++){const st=o.samples[it];st.pts=normalizePts(st.pts-a.baseTime*rt/a.timescale,s*rt)/rt,st.dts=normalizePts(st.dts-et.baseTime*rt/et.timescale,s*rt)/rt}const nt=o.samples;return o.samples=[],{samples:nt}}function flushTextTrackUserdataCueSamples(o,s,a){const et=o.samples.length;if(!et)return;const tt=o.inputTimeScale;for(let nt=0;nt<et;nt++){const it=o.samples[nt];it.pts=normalizePts(it.pts-a.baseTime*tt/a.timescale,s*tt)/tt}o.samples.sort((nt,it)=>nt.pts-it.pts);const rt=o.samples;return o.samples=[],{samples:rt}}class Mp4Sample{constructor(s,a,et,tt){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=a,this.size=et,this.cts=tt,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:s?2:1,isNonSync:s?0:1}}}class PassThroughRemuxer{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(s){this.initPTS=s,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(s,a,et,tt){this.audioCodec=a,this.videoCodec=et,this.generateInitSegment(patchEncyptionData(s,tt)),this.emitInitSegment=!0}generateInitSegment(s){let{audioCodec:a,videoCodec:et}=this;if(!(s!=null&&s.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const tt=this.initData=parseInitSegment(s);tt.audio&&(a=getParsedTrackCodec(tt.audio,ElementaryStreamTypes.AUDIO)),tt.video&&(et=getParsedTrackCodec(tt.video,ElementaryStreamTypes.VIDEO));const rt={};tt.audio&&tt.video?rt.audiovideo={container:"video/mp4",codec:a+","+et,initSegment:s,id:"main"}:tt.audio?rt.audio={container:"audio/mp4",codec:a,initSegment:s,id:"audio"}:tt.video?rt.video={container:"video/mp4",codec:et,initSegment:s,id:"main"}:logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=rt}remux(s,a,et,tt,rt,nt){var it,st;let{initPTS:ot,lastEndTime:at}=this;const lt={audio:void 0,video:void 0,text:tt,id3:et,initSegment:void 0};isFiniteNumber(at)||(at=this.lastEndTime=rt||0);const ct=a.samples;if(!(ct!=null&&ct.length))return lt;const ht={initPTS:void 0,timescale:1};let ft=this.initData;if((it=ft)!=null&&it.length||(this.generateInitSegment(ct),ft=this.initData),!((st=ft)!=null&&st.length))return logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),lt;this.emitInitSegment&&(ht.tracks=this.initTracks,this.emitInitSegment=!1);const dt=getDuration(ct,ft),pt=getStartDTS(ft,ct),gt=pt===null?rt:pt;(isInvalidInitPts(ot,gt,rt,dt)||ht.timescale!==ot.timescale&&nt)&&(ht.initPTS=gt-rt,ot&&ot.timescale===1&&logger.warn(`Adjusting initPTS by ${ht.initPTS-ot.baseTime}`),this.initPTS=ot={baseTime:ht.initPTS,timescale:1});const mt=s?gt-ot.baseTime/ot.timescale:at,yt=mt+dt;offsetStartDTS(ft,ct,ot.baseTime/ot.timescale),dt>0?this.lastEndTime=yt:(logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const vt=!!ft.audio,Et=!!ft.video;let xt="";vt&&(xt+="audio"),Et&&(xt+="video");const wt={data1:ct,startPTS:mt,startDTS:mt,endPTS:yt,endDTS:yt,type:xt,hasAudio:vt,hasVideo:Et,nb:1,dropped:0};return lt.audio=wt.type==="audio"?wt:void 0,lt.video=wt.type!=="audio"?wt:void 0,lt.initSegment=ht,lt.id3=flushTextTrackMetadataCueSamples(et,rt,ot,ot),tt.samples.length&&(lt.text=flushTextTrackUserdataCueSamples(tt,rt,ot)),lt}}function isInvalidInitPts(o,s,a,et){if(o===null)return!0;const tt=Math.max(et,1),rt=s-o.baseTime/o.timescale;return Math.abs(rt-a)>tt}function getParsedTrackCodec(o,s){const a=o?.codec;if(a&&a.length>4)return a;if(s===ElementaryStreamTypes.AUDIO){if(a==="ec-3"||a==="ac-3"||a==="alac")return a;if(a==="fLaC"||a==="Opus")return getCodecCompatibleName(a,!1);const et="mp4a.40.5";return logger.info(`Parsed audio codec "${a}" or audio object type not handled. Using "${et}"`),et}return logger.warn(`Unhandled video codec "${a}"`),a==="hvc1"||a==="hev1"?"hvc1.1.6.L120.90":a==="av01"?"av01.0.04M.08":"avc1.42e01e"}let now;try{now=self.performance.now.bind(self.performance)}catch(o){logger.debug("Unable to use Performance API on this environment"),now=optionalSelf?.Date.now}const muxConfig=[{demux:MP4Demuxer,remux:PassThroughRemuxer},{demux:TSDemuxer,remux:MP4Remuxer},{demux:AACDemuxer,remux:MP4Remuxer},{demux:MP3Demuxer,remux:MP4Remuxer}];muxConfig.splice(2,0,{demux:AC3Demuxer,remux:MP4Remuxer});class Transmuxer{constructor(s,a,et,tt,rt){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=s,this.typeSupported=a,this.config=et,this.vendor=tt,this.id=rt}configure(s){this.transmuxConfig=s,this.decrypter&&this.decrypter.reset()}push(s,a,et,tt){const rt=et.transmuxing;rt.executeStart=now();let nt=new Uint8Array(s);const{currentTransmuxState:it,transmuxConfig:st}=this;tt&&(this.currentTransmuxState=tt);const{contiguous:ot,discontinuity:at,trackSwitch:lt,accurateTimeOffset:ct,timeOffset:ht,initSegmentChange:ft}=tt||it,{audioCodec:dt,videoCodec:pt,defaultInitPts:gt,duration:mt,initSegmentData:yt}=st,vt=getEncryptionType(nt,a);if(vt&&vt.method==="AES-128"){const Rt=this.getDecrypter();if(Rt.isSync()){let Ct=Rt.softwareDecrypt(nt,vt.key.buffer,vt.iv.buffer);if(et.part>-1&&(Ct=Rt.flush()),!Ct)return rt.executeEnd=now(),emptyResult(et);nt=new Uint8Array(Ct)}else return this.decryptionPromise=Rt.webCryptoDecrypt(nt,vt.key.buffer,vt.iv.buffer).then(Ct=>{const Ft=this.push(Ct,null,et);return this.decryptionPromise=null,Ft}),this.decryptionPromise}const Et=this.needsProbing(at,lt);if(Et){const Rt=this.configureTransmuxer(nt);if(Rt)return logger.warn(`[transmuxer] ${Rt.message}`),this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:Rt,reason:Rt.message}),rt.executeEnd=now(),emptyResult(et)}(at||lt||ft||Et)&&this.resetInitSegment(yt,dt,pt,mt,a),(at||ft||Et)&&this.resetInitialTimestamp(gt),ot||this.resetContiguity();const xt=this.transmux(nt,vt,ht,ct,et),wt=this.currentTransmuxState;return wt.contiguous=!0,wt.discontinuity=!1,wt.trackSwitch=!1,rt.executeEnd=now(),xt}flush(s){const a=s.transmuxing;a.executeStart=now();const{decrypter:et,currentTransmuxState:tt,decryptionPromise:rt}=this;if(rt)return rt.then(()=>this.flush(s));const nt=[],{timeOffset:it}=tt;if(et){const lt=et.flush();lt&&nt.push(this.push(lt,null,s))}const{demuxer:st,remuxer:ot}=this;if(!st||!ot)return a.executeEnd=now(),[emptyResult(s)];const at=st.flush(it);return isPromise(at)?at.then(lt=>(this.flushRemux(nt,lt,s),nt)):(this.flushRemux(nt,at,s),nt)}flushRemux(s,a,et){const{audioTrack:tt,videoTrack:rt,id3Track:nt,textTrack:it}=a,{accurateTimeOffset:st,timeOffset:ot}=this.currentTransmuxState;logger.log(`[transmuxer.ts]: Flushed fragment ${et.sn}${et.part>-1?" p: "+et.part:""} of level ${et.level}`);const at=this.remuxer.remux(tt,rt,nt,it,ot,st,!0,this.id);s.push({remuxResult:at,chunkMeta:et}),et.transmuxing.executeEnd=now()}resetInitialTimestamp(s){const{demuxer:a,remuxer:et}=this;!a||!et||(a.resetTimeStamp(s),et.resetTimeStamp(s))}resetContiguity(){const{demuxer:s,remuxer:a}=this;!s||!a||(s.resetContiguity(),a.resetNextTimestamp())}resetInitSegment(s,a,et,tt,rt){const{demuxer:nt,remuxer:it}=this;!nt||!it||(nt.resetInitSegment(s,a,et,tt),it.resetInitSegment(s,a,et,rt))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(s,a,et,tt,rt){let nt;return a&&a.method==="SAMPLE-AES"?nt=this.transmuxSampleAes(s,a,et,tt,rt):nt=this.transmuxUnencrypted(s,et,tt,rt),nt}transmuxUnencrypted(s,a,et,tt){const{audioTrack:rt,videoTrack:nt,id3Track:it,textTrack:st}=this.demuxer.demux(s,a,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(rt,nt,it,st,a,et,!1,this.id),chunkMeta:tt}}transmuxSampleAes(s,a,et,tt,rt){return this.demuxer.demuxSampleAes(s,a,et).then(nt=>({remuxResult:this.remuxer.remux(nt.audioTrack,nt.videoTrack,nt.id3Track,nt.textTrack,et,tt,!1,this.id),chunkMeta:rt}))}configureTransmuxer(s){const{config:a,observer:et,typeSupported:tt,vendor:rt}=this;let nt;for(let ct=0,ht=muxConfig.length;ct<ht;ct++){var it;if((it=muxConfig[ct].demux)!=null&&it.probe(s)){nt=muxConfig[ct];break}}if(!nt)return new Error("Failed to find demuxer by probing fragment data");const st=this.demuxer,ot=this.remuxer,at=nt.remux,lt=nt.demux;(!ot||!(ot instanceof at))&&(this.remuxer=new at(et,a,tt,rt)),(!st||!(st instanceof lt))&&(this.demuxer=new lt(et,a,tt),this.probe=lt.probe)}needsProbing(s,a){return!this.demuxer||!this.remuxer||s||a}getDecrypter(){let s=this.decrypter;return s||(s=this.decrypter=new Decrypter(this.config)),s}}function getEncryptionType(o,s){let a=null;return o.byteLength>0&&s?.key!=null&&s.iv!==null&&s.method!=null&&(a=s),a}const emptyResult=o=>({remuxResult:{},chunkMeta:o});function isPromise(o){return"then"in o&&o.then instanceof Function}class TransmuxConfig{constructor(s,a,et,tt,rt){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=s,this.videoCodec=a,this.initSegmentData=et,this.duration=tt,this.defaultInitPts=rt||null}}class TransmuxState{constructor(s,a,et,tt,rt,nt){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=s,this.contiguous=a,this.accurateTimeOffset=et,this.trackSwitch=tt,this.timeOffset=rt,this.initSegmentChange=nt}}var eventemitter3={exports:{}};(function(o){var s=Object.prototype.hasOwnProperty,a="~";function et(){}Object.create&&(et.prototype=Object.create(null),new et().__proto__||(a=!1));function tt(st,ot,at){this.fn=st,this.context=ot,this.once=at||!1}function rt(st,ot,at,lt,ct){if(typeof at!="function")throw new TypeError("The listener must be a function");var ht=new tt(at,lt||st,ct),ft=a?a+ot:ot;return st._events[ft]?st._events[ft].fn?st._events[ft]=[st._events[ft],ht]:st._events[ft].push(ht):(st._events[ft]=ht,st._eventsCount++),st}function nt(st,ot){--st._eventsCount===0?st._events=new et:delete st._events[ot]}function it(){this._events=new et,this._eventsCount=0}it.prototype.eventNames=function(){var ot=[],at,lt;if(this._eventsCount===0)return ot;for(lt in at=this._events)s.call(at,lt)&&ot.push(a?lt.slice(1):lt);return Object.getOwnPropertySymbols?ot.concat(Object.getOwnPropertySymbols(at)):ot},it.prototype.listeners=function(ot){var at=a?a+ot:ot,lt=this._events[at];if(!lt)return[];if(lt.fn)return[lt.fn];for(var ct=0,ht=lt.length,ft=new Array(ht);ct<ht;ct++)ft[ct]=lt[ct].fn;return ft},it.prototype.listenerCount=function(ot){var at=a?a+ot:ot,lt=this._events[at];return lt?lt.fn?1:lt.length:0},it.prototype.emit=function(ot,at,lt,ct,ht,ft){var dt=a?a+ot:ot;if(!this._events[dt])return!1;var pt=this._events[dt],gt=arguments.length,mt,yt;if(pt.fn){switch(pt.once&&this.removeListener(ot,pt.fn,void 0,!0),gt){case 1:return pt.fn.call(pt.context),!0;case 2:return pt.fn.call(pt.context,at),!0;case 3:return pt.fn.call(pt.context,at,lt),!0;case 4:return pt.fn.call(pt.context,at,lt,ct),!0;case 5:return pt.fn.call(pt.context,at,lt,ct,ht),!0;case 6:return pt.fn.call(pt.context,at,lt,ct,ht,ft),!0}for(yt=1,mt=new Array(gt-1);yt<gt;yt++)mt[yt-1]=arguments[yt];pt.fn.apply(pt.context,mt)}else{var vt=pt.length,Et;for(yt=0;yt<vt;yt++)switch(pt[yt].once&&this.removeListener(ot,pt[yt].fn,void 0,!0),gt){case 1:pt[yt].fn.call(pt[yt].context);break;case 2:pt[yt].fn.call(pt[yt].context,at);break;case 3:pt[yt].fn.call(pt[yt].context,at,lt);break;case 4:pt[yt].fn.call(pt[yt].context,at,lt,ct);break;default:if(!mt)for(Et=1,mt=new Array(gt-1);Et<gt;Et++)mt[Et-1]=arguments[Et];pt[yt].fn.apply(pt[yt].context,mt)}}return!0},it.prototype.on=function(ot,at,lt){return rt(this,ot,at,lt,!1)},it.prototype.once=function(ot,at,lt){return rt(this,ot,at,lt,!0)},it.prototype.removeListener=function(ot,at,lt,ct){var ht=a?a+ot:ot;if(!this._events[ht])return this;if(!at)return nt(this,ht),this;var ft=this._events[ht];if(ft.fn)ft.fn===at&&(!ct||ft.once)&&(!lt||ft.context===lt)&&nt(this,ht);else{for(var dt=0,pt=[],gt=ft.length;dt<gt;dt++)(ft[dt].fn!==at||ct&&!ft[dt].once||lt&&ft[dt].context!==lt)&&pt.push(ft[dt]);pt.length?this._events[ht]=pt.length===1?pt[0]:pt:nt(this,ht)}return this},it.prototype.removeAllListeners=function(ot){var at;return ot?(at=a?a+ot:ot,this._events[at]&&nt(this,at)):(this._events=new et,this._eventsCount=0),this},it.prototype.off=it.prototype.removeListener,it.prototype.addListener=it.prototype.on,it.prefixed=a,it.EventEmitter=it,o.exports=it})(eventemitter3);var eventemitter3Exports=eventemitter3.exports,EventEmitter=getDefaultExportFromCjs(eventemitter3Exports);class TransmuxerInterface{constructor(s,a,et,tt){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const rt=s.config;this.hls=s,this.id=a,this.useWorker=!!rt.enableWorker,this.onTransmuxComplete=et,this.onFlush=tt;const nt=(ot,at)=>{at=at||{},at.frag=this.frag,at.id=this.id,ot===Events.ERROR&&(this.error=at.error),this.hls.trigger(ot,at)};this.observer=new EventEmitter,this.observer.on(Events.FRAG_DECRYPTED,nt),this.observer.on(Events.ERROR,nt);const it=getMediaSource(rt.preferManagedMediaSource)||{isTypeSupported:()=>!1},st={mpeg:it.isTypeSupported("audio/mpeg"),mp3:it.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:it.isTypeSupported('audio/mp4; codecs="ac-3"')};if(this.useWorker&&typeof Worker<"u"&&(rt.workerPath||hasUMDWorker())){try{rt.workerPath?(logger.log(`loading Web Worker ${rt.workerPath} for "${a}"`),this.workerContext=loadWorker(rt.workerPath)):(logger.log(`injecting Web Worker for "${a}"`),this.workerContext=injectWorker()),this.onwmsg=lt=>this.onWorkerMessage(lt);const{worker:at}=this.workerContext;at.addEventListener("message",this.onwmsg),at.onerror=lt=>{const ct=new Error(`${lt.message}  (${lt.filename}:${lt.lineno})`);rt.enableWorker=!1,logger.warn(`Error in "${a}" Web Worker, fallback to inline`),this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:ct})},at.postMessage({cmd:"init",typeSupported:st,vendor:"",id:a,config:JSON.stringify(rt)})}catch(at){logger.warn(`Error setting up "${a}" Web Worker, fallback to inline`,at),this.resetWorker(),this.error=null,this.transmuxer=new Transmuxer(this.observer,st,rt,"",a)}return}this.transmuxer=new Transmuxer(this.observer,st,rt,"",a)}resetWorker(){if(this.workerContext){const{worker:s,objectURL:a}=this.workerContext;a&&self.URL.revokeObjectURL(a),s.removeEventListener("message",this.onwmsg),s.onerror=null,s.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const a=this.transmuxer;a&&(a.destroy(),this.transmuxer=null)}const s=this.observer;s&&s.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(s,a,et,tt,rt,nt,it,st,ot,at){var lt,ct;ot.transmuxing.start=self.performance.now();const{transmuxer:ht}=this,ft=nt?nt.start:rt.start,dt=rt.decryptdata,pt=this.frag,gt=!(pt&&rt.cc===pt.cc),mt=!(pt&&ot.level===pt.level),yt=pt?ot.sn-pt.sn:-1,vt=this.part?ot.part-this.part.index:-1,Et=yt===0&&ot.id>1&&ot.id===pt?.stats.chunkCount,xt=!mt&&(yt===1||yt===0&&(vt===1||Et&&vt<=0)),wt=self.performance.now();(mt||yt||rt.stats.parsing.start===0)&&(rt.stats.parsing.start=wt),nt&&(vt||!xt)&&(nt.stats.parsing.start=wt);const Rt=!(pt&&((lt=rt.initSegment)==null?void 0:lt.url)===((ct=pt.initSegment)==null?void 0:ct.url)),Ct=new TransmuxState(gt,xt,st,mt,ft,Rt);if(!xt||gt||Rt){logger.log(`[transmuxer-interface, ${rt.type}]: Starting new transmux session for sn: ${ot.sn} p: ${ot.part} level: ${ot.level} id: ${ot.id}
        discontinuity: ${gt}
        trackSwitch: ${mt}
        contiguous: ${xt}
        accurateTimeOffset: ${st}
        timeOffset: ${ft}
        initSegmentChange: ${Rt}`);const Ft=new TransmuxConfig(et,tt,a,it,at);this.configureTransmuxer(Ft)}if(this.frag=rt,this.part=nt,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:s,decryptdata:dt,chunkMeta:ot,state:Ct},s instanceof ArrayBuffer?[s]:[]);else if(ht){const Ft=ht.push(s,dt,ot,Ct);isPromise(Ft)?(ht.async=!0,Ft.then(zt=>{this.handleTransmuxComplete(zt)}).catch(zt=>{this.transmuxerError(zt,ot,"transmuxer-interface push error")})):(ht.async=!1,this.handleTransmuxComplete(Ft))}}flush(s){s.transmuxing.start=self.performance.now();const{transmuxer:a}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:s});else if(a){let et=a.flush(s);isPromise(et)||a.async?(isPromise(et)||(et=Promise.resolve(et)),et.then(rt=>{this.handleFlushResult(rt,s)}).catch(rt=>{this.transmuxerError(rt,s,"transmuxer-interface flush error")})):this.handleFlushResult(et,s)}}transmuxerError(s,a,et){this.hls&&(this.error=s,this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:a,frag:this.frag||void 0,fatal:!1,error:s,err:s,reason:et}))}handleFlushResult(s,a){s.forEach(et=>{this.handleTransmuxComplete(et)}),this.onFlush(a)}onWorkerMessage(s){const a=s.data;if(!(a!=null&&a.event)){logger.warn(`worker message received with no ${a?"event name":"data"}`);return}const et=this.hls;if(this.hls)switch(a.event){case"init":{var tt;const rt=(tt=this.workerContext)==null?void 0:tt.objectURL;rt&&self.URL.revokeObjectURL(rt);break}case"transmuxComplete":{this.handleTransmuxComplete(a.data);break}case"flush":{this.onFlush(a.data);break}case"workerLog":logger[a.data.logType]&&logger[a.data.logType](a.data.message);break;default:{a.data=a.data||{},a.data.frag=this.frag,a.data.id=this.id,et.trigger(a.event,a.data);break}}}configureTransmuxer(s){const{transmuxer:a}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:s}):a&&a.configure(s)}handleTransmuxComplete(s){s.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(s)}}function subtitleOptionsIdentical(o,s){if(o.length!==s.length)return!1;for(let a=0;a<o.length;a++)if(!mediaAttributesIdentical(o[a].attrs,s[a].attrs))return!1;return!0}function mediaAttributesIdentical(o,s,a){const et=o["STABLE-RENDITION-ID"];return et&&!a?et===s["STABLE-RENDITION-ID"]:!(a||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(tt=>o[tt]!==s[tt])}function subtitleTrackMatchesTextTrack(o,s){return s.label.toLowerCase()===o.name.toLowerCase()&&(!s.language||s.language.toLowerCase()===(o.lang||"").toLowerCase())}const TICK_INTERVAL$2=100;class AudioStreamController extends BaseStreamController{constructor(s,a,et){super(s,a,et,"[audio-stream-controller]",PlaylistLevelType.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:s}=this;s.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),s.on(Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),s.on(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.on(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.on(Events.ERROR,this.onError,this),s.on(Events.BUFFER_RESET,this.onBufferReset,this),s.on(Events.BUFFER_CREATED,this.onBufferCreated,this),s.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),s.on(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.on(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),s.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:s}=this;s.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),s.off(Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),s.off(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.off(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.off(Events.ERROR,this.onError,this),s.off(Events.BUFFER_RESET,this.onBufferReset,this),s.off(Events.BUFFER_CREATED,this.onBufferCreated,this),s.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),s.off(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.off(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),s.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(s,{frag:a,id:et,initPTS:tt,timescale:rt}){if(et==="main"){const nt=a.cc;this.initPTS[a.cc]={baseTime:tt,timescale:rt},this.log(`InitPTS for cc: ${nt} found from main: ${tt}`),this.videoTrackCC=nt,this.state===State.WAITING_INIT_PTS&&this.tick()}}startLoad(s){if(!this.levels){this.startPosition=s,this.state=State.STOPPED;return}const a=this.lastCurrentTime;this.stopLoad(),this.setInterval(TICK_INTERVAL$2),a>0&&s===-1?(this.log(`Override startPosition with lastCurrentTime @${a.toFixed(3)}`),s=a,this.state=State.IDLE):(this.loadedmetadata=!1,this.state=State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=s,this.tick()}doTick(){switch(this.state){case State.IDLE:this.doTickIdle();break;case State.WAITING_TRACK:{var s;const{levels:et,trackId:tt}=this,rt=et==null||(s=et[tt])==null?void 0:s.details;if(rt){if(this.waitForCdnTuneIn(rt))break;this.state=State.WAITING_INIT_PTS}break}case State.FRAG_LOADING_WAITING_RETRY:{var a;const et=performance.now(),tt=this.retryDate;if(!tt||et>=tt||(a=this.media)!=null&&a.seeking){const{levels:rt,trackId:nt}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(rt?.[nt]||null),this.state=State.IDLE}break}case State.WAITING_INIT_PTS:{const et=this.waitingData;if(et){const{frag:tt,part:rt,cache:nt,complete:it}=et;if(this.initPTS[tt.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=State.FRAG_LOADING;const st=nt.flush(),ot={frag:tt,part:rt,payload:st,networkDetails:null};this._handleFragmentLoadProgress(ot),it&&super._handleFragmentLoadComplete(ot)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${tt.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const st=this.getLoadPosition(),ot=BufferHelper.bufferInfo(this.mediaBuffer,st,this.config.maxBufferHole);fragmentWithinToleranceTest(ot.end,this.config.maxFragLookUpTolerance,tt)<0&&(this.log(`Waiting fragment cc (${tt.cc}) @ ${tt.start} cancelled because another fragment at ${ot.end} is needed`),this.clearWaitingFragment())}}else this.state=State.IDLE}}this.onTickEnd()}clearWaitingFragment(){const s=this.waitingData;s&&(this.fragmentTracker.removeFragment(s.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=State.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:s}=this;s!=null&&s.readyState&&(this.lastCurrentTime=s.currentTime)}doTickIdle(){const{hls:s,levels:a,media:et,trackId:tt}=this,rt=s.config;if(!et&&(this.startFragRequested||!rt.startFragPrefetch)||!(a!=null&&a[tt]))return;const nt=a[tt],it=nt.details;if(!it||it.live&&this.levelLastLoaded!==nt||this.waitForCdnTuneIn(it)){this.state=State.WAITING_TRACK;return}const st=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&st&&(this.bufferFlushed=!1,this.afterBufferFlushed(st,ElementaryStreamTypes.AUDIO,PlaylistLevelType.AUDIO));const ot=this.getFwdBufferInfo(st,PlaylistLevelType.AUDIO);if(ot===null)return;const{bufferedTrack:at,switchingTrack:lt}=this;if(!lt&&this._streamEnded(ot,it)){s.trigger(Events.BUFFER_EOS,{type:"audio"}),this.state=State.ENDED;return}const ct=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,PlaylistLevelType.MAIN),ht=ot.len,ft=this.getMaxBufferLength(ct?.len),dt=it.fragments,pt=dt[0].start;let gt=this.flushing?this.getLoadPosition():ot.end;if(lt&&et){const Et=this.getLoadPosition();at&&!mediaAttributesIdentical(lt.attrs,at.attrs)&&(gt=Et),it.PTSKnown&&Et<pt&&(ot.end>pt||ot.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),et.currentTime=pt+.05)}if(ht>=ft&&!lt&&gt<dt[dt.length-1].start)return;let mt=this.getNextFragment(gt,it),yt=!1;if(mt&&this.isLoopLoading(mt,gt)&&(yt=!!mt.gap,mt=this.getNextFragmentLoopLoading(mt,it,ot,PlaylistLevelType.MAIN,ft)),!mt){this.bufferFlushed=!0;return}const vt=ct&&mt.start>ct.end+it.targetduration;if(vt||!(ct!=null&&ct.len)&&ot.len){const Et=this.getAppendedFrag(mt.start,PlaylistLevelType.MAIN);if(Et===null||(yt||(yt=!!Et.gap||!!vt&&ct.len===0),vt&&!yt||yt&&ot.nextStart&&ot.nextStart<Et.end))return}this.loadFragment(mt,nt,gt)}getMaxBufferLength(s){const a=super.getMaxBufferLength();return s?Math.min(Math.max(a,s),this.config.maxMaxBufferLength):a}onMediaDetaching(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,super.onMediaDetaching()}onAudioTracksUpdated(s,{audioTracks:a}){this.resetTransmuxer(),this.levels=a.map(et=>new Level(et))}onAudioTrackSwitching(s,a){const et=!!a.url;this.trackId=a.id;const{fragCurrent:tt}=this;tt&&(tt.abortRequests(),this.removeUnbufferedFrags(tt.start)),this.resetLoadingState(),et?this.setInterval(TICK_INTERVAL$2):this.resetTransmuxer(),et?(this.switchingTrack=a,this.state=State.IDLE,this.flushAudioIfNeeded(a)):(this.switchingTrack=null,this.bufferedTrack=a,this.state=State.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(s,a){this.mainDetails=a.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(s,a){var et;if(this.mainDetails==null){this.cachedTrackLoadedData=a;return}const{levels:tt}=this,{details:rt,id:nt}=a;if(!tt){this.warn(`Audio tracks were reset while loading level ${nt}`);return}this.log(`Audio track ${nt} loaded [${rt.startSN},${rt.endSN}]${rt.lastPartSn?`[part-${rt.lastPartSn}-${rt.lastPartIndex}]`:""},duration:${rt.totalduration}`);const it=tt[nt];let st=0;if(rt.live||(et=it.details)!=null&&et.live){this.checkLiveUpdate(rt);const at=this.mainDetails;if(rt.deltaUpdateFailed||!at)return;if(!it.details&&rt.hasProgramDateTime&&at.hasProgramDateTime)alignMediaPlaylistByPDT(rt,at),st=rt.fragments[0].start;else{var ot;st=this.alignPlaylists(rt,it.details,(ot=this.levelLastLoaded)==null?void 0:ot.details)}}it.details=rt,this.levelLastLoaded=it,!this.startFragRequested&&(this.mainDetails||!rt.live)&&this.setStartPosition(this.mainDetails||rt,st),this.state===State.WAITING_TRACK&&!this.waitForCdnTuneIn(rt)&&(this.state=State.IDLE),this.tick()}_handleFragmentLoadProgress(s){var a;const{frag:et,part:tt,payload:rt}=s,{config:nt,trackId:it,levels:st}=this;if(!st){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${et.sn} of level ${et.level} will not be buffered`);return}const ot=st[it];if(!ot){this.warn("Audio track is undefined on fragment load progress");return}const at=ot.details;if(!at){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(et.start);return}const lt=nt.defaultAudioCodec||ot.audioCodec||"mp4a.40.2";let ct=this.transmuxer;ct||(ct=this.transmuxer=new TransmuxerInterface(this.hls,PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const ht=this.initPTS[et.cc],ft=(a=et.initSegment)==null?void 0:a.data;if(ht!==void 0){const pt=tt?tt.index:-1,gt=pt!==-1,mt=new ChunkMetadata(et.level,et.sn,et.stats.chunkCount,rt.byteLength,pt,gt);ct.push(rt,ft,lt,"",et,tt,at.totalduration,!1,mt,ht)}else{this.log(`Unknown video PTS for cc ${et.cc}, waiting for video PTS before demuxing audio frag ${et.sn} of [${at.startSN} ,${at.endSN}],track ${it}`);const{cache:dt}=this.waitingData=this.waitingData||{frag:et,part:tt,cache:new ChunkCache,complete:!1};dt.push(new Uint8Array(rt)),this.waitingVideoCC=this.videoTrackCC,this.state=State.WAITING_INIT_PTS}}_handleFragmentLoadComplete(s){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(s)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(s,a){const et=a.tracks.audio;et&&(this.mediaBuffer=et.buffer||null),a.tracks.video&&(this.videoBuffer=a.tracks.video.buffer||null)}onFragBuffered(s,a){const{frag:et,part:tt}=a;if(et.type!==PlaylistLevelType.AUDIO){if(!this.loadedmetadata&&et.type===PlaylistLevelType.MAIN){const rt=this.videoBuffer||this.media;rt&&BufferHelper.getBuffered(rt).length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(et)){this.warn(`Fragment ${et.sn}${tt?" p: "+tt.index:""} of level ${et.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(et.sn!=="initSegment"){this.fragPrevious=et;const rt=this.switchingTrack;rt&&(this.bufferedTrack=rt,this.switchingTrack=null,this.hls.trigger(Events.AUDIO_TRACK_SWITCHED,_objectSpread2({},rt)))}this.fragBufferedComplete(et,tt)}onError(s,a){var et;if(a.fatal){this.state=State.ERROR;return}switch(a.details){case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_PARSING_ERROR:case ErrorDetails.FRAG_DECRYPT_ERROR:case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(PlaylistLevelType.AUDIO,a);break;case ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case ErrorDetails.LEVEL_PARSING_ERROR:!a.levelRetry&&this.state===State.WAITING_TRACK&&((et=a.context)==null?void 0:et.type)===PlaylistContextType.AUDIO_TRACK&&(this.state=State.IDLE);break;case ErrorDetails.BUFFER_APPEND_ERROR:case ErrorDetails.BUFFER_FULL_ERROR:if(!a.parent||a.parent!=="audio")return;if(a.details===ErrorDetails.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(a)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case ErrorDetails.INTERNAL_EXCEPTION:this.recoverWorkerError(a);break}}onBufferFlushing(s,{type:a}){a!==ElementaryStreamTypes.VIDEO&&(this.flushing=!0)}onBufferFlushed(s,{type:a}){if(a!==ElementaryStreamTypes.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===State.ENDED&&(this.state=State.IDLE);const et=this.mediaBuffer||this.media;et&&(this.afterBufferFlushed(et,a,PlaylistLevelType.AUDIO),this.tick())}}_handleTransmuxComplete(s){var a;const et="audio",{hls:tt}=this,{remuxResult:rt,chunkMeta:nt}=s,it=this.getCurrentContext(nt);if(!it){this.resetWhenMissingContext(nt);return}const{frag:st,part:ot,level:at}=it,{details:lt}=at,{audio:ct,text:ht,id3:ft,initSegment:dt}=rt;if(this.fragContextChanged(st)||!lt){this.fragmentTracker.removeFragment(st);return}if(this.state=State.PARSING,this.switchingTrack&&ct&&this.completeAudioSwitch(this.switchingTrack),dt!=null&&dt.tracks){const pt=st.initSegment||st;this._bufferInitSegment(at,dt.tracks,pt,nt),tt.trigger(Events.FRAG_PARSING_INIT_SEGMENT,{frag:pt,id:et,tracks:dt.tracks})}if(ct){const{startPTS:pt,endPTS:gt,startDTS:mt,endDTS:yt}=ct;ot&&(ot.elementaryStreams[ElementaryStreamTypes.AUDIO]={startPTS:pt,endPTS:gt,startDTS:mt,endDTS:yt}),st.setElementaryStreamInfo(ElementaryStreamTypes.AUDIO,pt,gt,mt,yt),this.bufferFragmentData(ct,st,ot,nt)}if(ft!=null&&(a=ft.samples)!=null&&a.length){const pt=_extends({id:et,frag:st,details:lt},ft);tt.trigger(Events.FRAG_PARSING_METADATA,pt)}if(ht){const pt=_extends({id:et,frag:st,details:lt},ht);tt.trigger(Events.FRAG_PARSING_USERDATA,pt)}}_bufferInitSegment(s,a,et,tt){if(this.state!==State.PARSING)return;a.video&&delete a.video;const rt=a.audio;if(!rt)return;rt.id="audio";const nt=s.audioCodec;this.log(`Init audio buffer, container:${rt.container}, codecs[level/parsed]=[${nt}/${rt.codec}]`),nt&&nt.split(",").length===1&&(rt.levelCodec=nt),this.hls.trigger(Events.BUFFER_CODECS,a);const it=rt.initSegment;if(it!=null&&it.byteLength){const st={type:"audio",frag:et,part:null,chunkMeta:tt,parent:et.type,data:it};this.hls.trigger(Events.BUFFER_APPENDING,st)}this.tickImmediate()}loadFragment(s,a,et){const tt=this.fragmentTracker.getState(s);if(this.fragCurrent=s,this.switchingTrack||tt===FragmentState.NOT_LOADED||tt===FragmentState.PARTIAL){var rt;if(s.sn==="initSegment")this._loadInitSegment(s,a);else if((rt=a.details)!=null&&rt.live&&!this.initPTS[s.cc]){this.log(`Waiting for video PTS in continuity counter ${s.cc} of live stream before loading audio fragment ${s.sn} of level ${this.trackId}`),this.state=State.WAITING_INIT_PTS;const nt=this.mainDetails;nt&&nt.fragments[0].start!==a.details.fragments[0].start&&alignMediaPlaylistByPDT(a.details,nt)}else this.startFragRequested=!0,super.loadFragment(s,a,et)}else this.clearTrackerIfNeeded(s)}flushAudioIfNeeded(s){const{media:a,bufferedTrack:et}=this,tt=et?.attrs,rt=s.attrs;a&&tt&&(tt.CHANNELS!==rt.CHANNELS||et.name!==s.name||et.lang!==s.lang)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)}completeAudioSwitch(s){const{hls:a}=this;this.flushAudioIfNeeded(s),this.bufferedTrack=s,this.switchingTrack=null,a.trigger(Events.AUDIO_TRACK_SWITCHED,_objectSpread2({},s))}}class AudioTrackController extends BasePlaylistController{constructor(s){super(s,"[audio-track-controller]"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:s}=this;s.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),s.on(Events.LEVEL_LOADING,this.onLevelLoading,this),s.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),s.on(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:s}=this;s.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),s.off(Events.LEVEL_LOADING,this.onLevelLoading,this),s.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),s.off(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.off(Events.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(s,a){this.tracks=a.audioTracks||[]}onAudioTrackLoaded(s,a){const{id:et,groupId:tt,details:rt}=a,nt=this.tracksInGroup[et];if(!nt||nt.groupId!==tt){this.warn(`Audio track with id:${et} and group:${tt} not found in active group ${nt?.groupId}`);return}const it=nt.details;nt.details=a.details,this.log(`Audio track ${et} "${nt.name}" lang:${nt.lang} group:${tt} loaded [${rt.startSN}-${rt.endSN}]`),et===this.trackId&&this.playlistLoaded(et,a,it)}onLevelLoading(s,a){this.switchLevel(a.level)}onLevelSwitching(s,a){this.switchLevel(a.level)}switchLevel(s){const a=this.hls.levels[s];if(!a)return;const et=a.audioGroups||null,tt=this.groupIds;let rt=this.currentTrack;if(!et||tt?.length!==et?.length||et!=null&&et.some(it=>tt?.indexOf(it)===-1)){this.groupIds=et,this.trackId=-1,this.currentTrack=null;const it=this.tracks.filter(ct=>!et||et.indexOf(ct.groupId)!==-1);if(it.length)this.selectDefaultTrack&&!it.some(ct=>ct.default)&&(this.selectDefaultTrack=!1),it.forEach((ct,ht)=>{ct.id=ht});else if(!rt&&!this.tracksInGroup.length)return;this.tracksInGroup=it;const st=this.hls.config.audioPreference;if(!rt&&st){const ct=findMatchingOption(st,it,audioMatchPredicate);if(ct>-1)rt=it[ct];else{const ht=findMatchingOption(st,this.tracks);rt=this.tracks[ht]}}let ot=this.findTrackId(rt);ot===-1&&rt&&(ot=this.findTrackId(null));const at={audioTracks:it};this.log(`Updating audio tracks, ${it.length} track(s) found in group(s): ${et?.join(",")}`),this.hls.trigger(Events.AUDIO_TRACKS_UPDATED,at);const lt=this.trackId;if(ot!==-1&&lt===-1)this.setAudioTrack(ot);else if(it.length&&lt===-1){var nt;const ct=new Error(`No audio track selected for current audio group-ID(s): ${(nt=this.groupIds)==null?void 0:nt.join(",")} track count: ${it.length}`);this.warn(ct.message),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:ct})}}else this.shouldReloadPlaylist(rt)&&this.setAudioTrack(this.trackId)}onError(s,a){a.fatal||!a.context||a.context.type===PlaylistContextType.AUDIO_TRACK&&a.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(a.context.groupId)!==-1)&&(this.requestScheduled=-1,this.checkRetry(a))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(s){this.selectDefaultTrack=!1,this.setAudioTrack(s)}setAudioOption(s){const a=this.hls;if(a.config.audioPreference=s,s){const et=this.allAudioTracks;if(this.selectDefaultTrack=!1,et.length){const tt=this.currentTrack;if(tt&&matchesOption(s,tt,audioMatchPredicate))return tt;const rt=findMatchingOption(s,this.tracksInGroup,audioMatchPredicate);if(rt>-1){const nt=this.tracksInGroup[rt];return this.setAudioTrack(rt),nt}else if(tt){let nt=a.loadLevel;nt===-1&&(nt=a.firstAutoLevel);const it=findClosestLevelWithAudioGroup(s,a.levels,et,nt,audioMatchPredicate);if(it===-1)return null;a.nextLoadLevel=it}if(s.channels||s.audioCodec){const nt=findMatchingOption(s,et);if(nt>-1)return et[nt]}}}return null}setAudioTrack(s){const a=this.tracksInGroup;if(s<0||s>=a.length){this.warn(`Invalid audio track id: ${s}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const et=this.currentTrack,tt=a[s],rt=tt.details&&!tt.details.live;if(s===this.trackId&&tt===et&&rt||(this.log(`Switching to audio-track ${s} "${tt.name}" lang:${tt.lang} group:${tt.groupId} channels:${tt.channels}`),this.trackId=s,this.currentTrack=tt,this.hls.trigger(Events.AUDIO_TRACK_SWITCHING,_objectSpread2({},tt)),rt))return;const nt=this.switchParams(tt.url,et?.details,tt.details);this.loadPlaylist(nt)}findTrackId(s){const a=this.tracksInGroup;for(let et=0;et<a.length;et++){const tt=a[et];if(!(this.selectDefaultTrack&&!tt.default)&&(!s||matchesOption(s,tt,audioMatchPredicate)))return et}if(s){const{name:et,lang:tt,assocLang:rt,characteristics:nt,audioCodec:it,channels:st}=s;for(let ot=0;ot<a.length;ot++){const at=a[ot];if(matchesOption({name:et,lang:tt,assocLang:rt,characteristics:nt,audioCodec:it,channels:st},at,audioMatchPredicate))return ot}for(let ot=0;ot<a.length;ot++){const at=a[ot];if(mediaAttributesIdentical(s.attrs,at.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return ot}for(let ot=0;ot<a.length;ot++){const at=a[ot];if(mediaAttributesIdentical(s.attrs,at.attrs,["LANGUAGE"]))return ot}}return-1}loadPlaylist(s){const a=this.currentTrack;if(this.shouldLoadPlaylist(a)&&a){super.loadPlaylist();const et=a.id,tt=a.groupId;let rt=a.url;if(s)try{rt=s.addDirectives(rt)}catch(nt){this.warn(`Could not construct new URL with HLS Delivery Directives: ${nt}`)}this.log(`loading audio-track playlist ${et} "${a.name}" lang:${a.lang} group:${tt}`),this.clearTimer(),this.hls.trigger(Events.AUDIO_TRACK_LOADING,{url:rt,id:et,groupId:tt,deliveryDirectives:s||null})}}}const TICK_INTERVAL$1=500;class SubtitleStreamController extends BaseStreamController{constructor(s,a,et){super(s,a,et,"[subtitle-stream-controller]",PlaylistLevelType.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}_registerListeners(){const{hls:s}=this;s.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),s.on(Events.ERROR,this.onError,this),s.on(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),s.on(Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),s.on(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),s.on(Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),s.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),s.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:s}=this;s.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),s.off(Events.ERROR,this.onError,this),s.off(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),s.off(Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),s.off(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),s.off(Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),s.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),s.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(s){this.stopLoad(),this.state=State.IDLE,this.setInterval(TICK_INTERVAL$1),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=s,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(s,a){this.mainDetails=a.details}onSubtitleFragProcessed(s,a){const{frag:et,success:tt}=a;if(this.fragPrevious=et,this.state=State.IDLE,!tt)return;const rt=this.tracksBuffered[this.currentTrackId];if(!rt)return;let nt;const it=et.start;for(let ot=0;ot<rt.length;ot++)if(it>=rt[ot].start&&it<=rt[ot].end){nt=rt[ot];break}const st=et.start+et.duration;nt?nt.end=st:(nt={start:it,end:st},rt.push(nt)),this.fragmentTracker.fragBuffered(et),this.fragBufferedComplete(et,null)}onBufferFlushing(s,a){const{startOffset:et,endOffset:tt}=a;if(et===0&&tt!==Number.POSITIVE_INFINITY){const rt=tt-1;if(rt<=0)return;a.endOffsetSubtitles=Math.max(0,rt),this.tracksBuffered.forEach(nt=>{for(let it=0;it<nt.length;){if(nt[it].end<=rt){nt.shift();continue}else if(nt[it].start<rt)nt[it].start=rt;else break;it++}}),this.fragmentTracker.removeFragmentsInRange(et,rt,PlaylistLevelType.SUBTITLE)}}onFragBuffered(s,a){if(!this.loadedmetadata&&a.frag.type===PlaylistLevelType.MAIN){var et;(et=this.media)!=null&&et.buffered.length&&(this.loadedmetadata=!0)}}onError(s,a){const et=a.frag;et?.type===PlaylistLevelType.SUBTITLE&&(a.details===ErrorDetails.FRAG_GAP&&this.fragmentTracker.fragBuffered(et,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==State.STOPPED&&(this.state=State.IDLE))}onSubtitleTracksUpdated(s,{subtitleTracks:a}){if(this.levels&&subtitleOptionsIdentical(this.levels,a)){this.levels=a.map(et=>new Level(et));return}this.tracksBuffered=[],this.levels=a.map(et=>{const tt=new Level(et);return this.tracksBuffered[tt.id]=[],tt}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,PlaylistLevelType.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(s,a){var et;if(this.currentTrackId=a.id,!((et=this.levels)!=null&&et.length)||this.currentTrackId===-1){this.clearInterval();return}const tt=this.levels[this.currentTrackId];tt!=null&&tt.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,tt&&this.setInterval(TICK_INTERVAL$1)}onSubtitleTrackLoaded(s,a){var et;const{currentTrackId:tt,levels:rt}=this,{details:nt,id:it}=a;if(!rt){this.warn(`Subtitle tracks were reset while loading level ${it}`);return}const st=rt[it];if(it>=rt.length||!st)return;this.log(`Subtitle track ${it} loaded [${nt.startSN},${nt.endSN}]${nt.lastPartSn?`[part-${nt.lastPartSn}-${nt.lastPartIndex}]`:""},duration:${nt.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let ot=0;if(nt.live||(et=st.details)!=null&&et.live){const lt=this.mainDetails;if(nt.deltaUpdateFailed||!lt)return;const ct=lt.fragments[0];if(!st.details)nt.hasProgramDateTime&&lt.hasProgramDateTime?(alignMediaPlaylistByPDT(nt,lt),ot=nt.fragments[0].start):ct&&(ot=ct.start,addSliding(nt,ot));else{var at;ot=this.alignPlaylists(nt,st.details,(at=this.levelLastLoaded)==null?void 0:at.details),ot===0&&ct&&(ot=ct.start,addSliding(nt,ot))}}st.details=nt,this.levelLastLoaded=st,it===tt&&(!this.startFragRequested&&(this.mainDetails||!nt.live)&&this.setStartPosition(this.mainDetails||nt,ot),this.tick(),nt.live&&!this.fragCurrent&&this.media&&this.state===State.IDLE&&(findFragmentByPTS(null,nt.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),st.details=void 0)))}_handleFragmentLoadComplete(s){const{frag:a,payload:et}=s,tt=a.decryptdata,rt=this.hls;if(!this.fragContextChanged(a)&&et&&et.byteLength>0&&tt!=null&&tt.key&&tt.iv&&tt.method==="AES-128"){const nt=performance.now();this.decrypter.decrypt(new Uint8Array(et),tt.key.buffer,tt.iv.buffer).catch(it=>{throw rt.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!1,error:it,reason:it.message,frag:a}),it}).then(it=>{const st=performance.now();rt.trigger(Events.FRAG_DECRYPTED,{frag:a,payload:it,stats:{tstart:nt,tdecrypt:st}})}).catch(it=>{this.warn(`${it.name}: ${it.message}`),this.state=State.IDLE})}}doTick(){if(!this.media){this.state=State.IDLE;return}if(this.state===State.IDLE){const{currentTrackId:s,levels:a}=this,et=a?.[s];if(!et||!a.length||!et.details)return;const{config:tt}=this,rt=this.getLoadPosition(),nt=BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],rt,tt.maxBufferHole),{end:it,len:st}=nt,ot=this.getFwdBufferInfo(this.media,PlaylistLevelType.MAIN),at=et.details,lt=this.getMaxBufferLength(ot?.len)+at.levelTargetDuration;if(st>lt)return;const ct=at.fragments,ht=ct.length,ft=at.edge;let dt=null;const pt=this.fragPrevious;if(it<ft){const gt=tt.maxFragLookUpTolerance,mt=it>ft-gt?0:gt;dt=findFragmentByPTS(pt,ct,Math.max(ct[0].start,it),mt),!dt&&pt&&pt.start<ct[0].start&&(dt=ct[0])}else dt=ct[ht-1];if(!dt)return;if(dt=this.mapToInitFragWhenRequired(dt),dt.sn!=="initSegment"){const gt=dt.sn-at.startSN,mt=ct[gt-1];mt&&mt.cc===dt.cc&&this.fragmentTracker.getState(mt)===FragmentState.NOT_LOADED&&(dt=mt)}this.fragmentTracker.getState(dt)===FragmentState.NOT_LOADED&&this.loadFragment(dt,et,it)}}getMaxBufferLength(s){const a=super.getMaxBufferLength();return s?Math.max(a,s):a}loadFragment(s,a,et){this.fragCurrent=s,s.sn==="initSegment"?this._loadInitSegment(s,a):(this.startFragRequested=!0,super.loadFragment(s,a,et))}get mediaBufferTimeRanges(){return new BufferableInstance(this.tracksBuffered[this.currentTrackId]||[])}}class BufferableInstance{constructor(s){this.buffered=void 0;const a=(et,tt,rt)=>{if(tt=tt>>>0,tt>rt-1)throw new DOMException(`Failed to execute '${et}' on 'TimeRanges': The index provided (${tt}) is greater than the maximum bound (${rt})`);return s[tt][et]};this.buffered={get length(){return s.length},end(et){return a("end",et,s.length)},start(et){return a("start",et,s.length)}}}}class SubtitleTrackController extends BasePlaylistController{constructor(s){super(s,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let a=null;const et=filterSubtitleTracks(this.media.textTracks);for(let rt=0;rt<et.length;rt++)if(et[rt].mode==="hidden")a=et[rt];else if(et[rt].mode==="showing"){a=et[rt];break}const tt=this.findTrackForTextTrack(a);this.subtitleTrack!==tt&&this.setSubtitleTrack(tt)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(s){this._subtitleDisplay=s,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:s}=this;s.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),s.on(Events.LEVEL_LOADING,this.onLevelLoading,this),s.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),s.on(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),s.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:s}=this;s.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),s.off(Events.LEVEL_LOADING,this.onLevelLoading,this),s.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),s.off(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),s.off(Events.ERROR,this.onError,this)}onMediaAttached(s,a){this.media=a.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(s){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,s)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),filterSubtitleTracks(this.media.textTracks).forEach(a=>{clearCurrentCues(a)}),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(s,a){this.tracks=a.subtitleTracks}onSubtitleTrackLoaded(s,a){const{id:et,groupId:tt,details:rt}=a,nt=this.tracksInGroup[et];if(!nt||nt.groupId!==tt){this.warn(`Subtitle track with id:${et} and group:${tt} not found in active group ${nt?.groupId}`);return}const it=nt.details;nt.details=a.details,this.log(`Subtitle track ${et} "${nt.name}" lang:${nt.lang} group:${tt} loaded [${rt.startSN}-${rt.endSN}]`),et===this.trackId&&this.playlistLoaded(et,a,it)}onLevelLoading(s,a){this.switchLevel(a.level)}onLevelSwitching(s,a){this.switchLevel(a.level)}switchLevel(s){const a=this.hls.levels[s];if(!a)return;const et=a.subtitleGroups||null,tt=this.groupIds;let rt=this.currentTrack;if(!et||tt?.length!==et?.length||et!=null&&et.some(nt=>tt?.indexOf(nt)===-1)){this.groupIds=et,this.trackId=-1,this.currentTrack=null;const nt=this.tracks.filter(at=>!et||et.indexOf(at.groupId)!==-1);if(nt.length)this.selectDefaultTrack&&!nt.some(at=>at.default)&&(this.selectDefaultTrack=!1),nt.forEach((at,lt)=>{at.id=lt});else if(!rt&&!this.tracksInGroup.length)return;this.tracksInGroup=nt;const it=this.hls.config.subtitlePreference;if(!rt&&it){this.selectDefaultTrack=!1;const at=findMatchingOption(it,nt);if(at>-1)rt=nt[at];else{const lt=findMatchingOption(it,this.tracks);rt=this.tracks[lt]}}let st=this.findTrackId(rt);st===-1&&rt&&(st=this.findTrackId(null));const ot={subtitleTracks:nt};this.log(`Updating subtitle tracks, ${nt.length} track(s) found in "${et?.join(",")}" group-id`),this.hls.trigger(Events.SUBTITLE_TRACKS_UPDATED,ot),st!==-1&&this.trackId===-1&&this.setSubtitleTrack(st)}else this.shouldReloadPlaylist(rt)&&this.setSubtitleTrack(this.trackId)}findTrackId(s){const a=this.tracksInGroup,et=this.selectDefaultTrack;for(let tt=0;tt<a.length;tt++){const rt=a[tt];if(!(et&&!rt.default||!et&&!s)&&(!s||matchesOption(rt,s)))return tt}if(s){for(let tt=0;tt<a.length;tt++){const rt=a[tt];if(mediaAttributesIdentical(s.attrs,rt.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return tt}for(let tt=0;tt<a.length;tt++){const rt=a[tt];if(mediaAttributesIdentical(s.attrs,rt.attrs,["LANGUAGE"]))return tt}}return-1}findTrackForTextTrack(s){if(s){const a=this.tracksInGroup;for(let et=0;et<a.length;et++){const tt=a[et];if(subtitleTrackMatchesTextTrack(tt,s))return et}}return-1}onError(s,a){a.fatal||!a.context||a.context.type===PlaylistContextType.SUBTITLE_TRACK&&a.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(a.context.groupId)!==-1)&&this.checkRetry(a)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(s){this.selectDefaultTrack=!1,this.setSubtitleTrack(s)}setSubtitleOption(s){if(this.hls.config.subtitlePreference=s,s){const a=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,a.length){const et=this.currentTrack;if(et&&matchesOption(s,et))return et;const tt=findMatchingOption(s,this.tracksInGroup);if(tt>-1){const rt=this.tracksInGroup[tt];return this.setSubtitleTrack(tt),rt}else{if(et)return null;{const rt=findMatchingOption(s,a);if(rt>-1)return a[rt]}}}}return null}loadPlaylist(s){super.loadPlaylist();const a=this.currentTrack;if(this.shouldLoadPlaylist(a)&&a){const et=a.id,tt=a.groupId;let rt=a.url;if(s)try{rt=s.addDirectives(rt)}catch(nt){this.warn(`Could not construct new URL with HLS Delivery Directives: ${nt}`)}this.log(`Loading subtitle playlist for id ${et}`),this.hls.trigger(Events.SUBTITLE_TRACK_LOADING,{url:rt,id:et,groupId:tt,deliveryDirectives:s||null})}}toggleTrackModes(){const{media:s}=this;if(!s)return;const a=filterSubtitleTracks(s.textTracks),et=this.currentTrack;let tt;if(et&&(tt=a.filter(rt=>subtitleTrackMatchesTextTrack(et,rt))[0],tt||this.warn(`Unable to find subtitle TextTrack with name "${et.name}" and language "${et.lang}"`)),[].slice.call(a).forEach(rt=>{rt.mode!=="disabled"&&rt!==tt&&(rt.mode="disabled")}),tt){const rt=this.subtitleDisplay?"showing":"hidden";tt.mode!==rt&&(tt.mode=rt)}}setSubtitleTrack(s){const a=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=s;return}if(s<-1||s>=a.length||!isFiniteNumber(s)){this.warn(`Invalid subtitle track id: ${s}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const et=this.currentTrack,tt=a[s]||null;if(this.trackId=s,this.currentTrack=tt,this.toggleTrackModes(),!tt){this.hls.trigger(Events.SUBTITLE_TRACK_SWITCH,{id:s});return}const rt=!!tt.details&&!tt.details.live;if(s===this.trackId&&tt===et&&rt)return;this.log(`Switching to subtitle-track ${s}`+(tt?` "${tt.name}" lang:${tt.lang} group:${tt.groupId}`:""));const{id:nt,groupId:it="",name:st,type:ot,url:at}=tt;this.hls.trigger(Events.SUBTITLE_TRACK_SWITCH,{id:nt,groupId:it,name:st,type:ot,url:at});const lt=this.switchParams(tt.url,et?.details,tt.details);this.loadPlaylist(lt)}}class BufferOperationQueue{constructor(s){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=s}append(s,a,et){const tt=this.queues[a];tt.push(s),tt.length===1&&!et&&this.executeNext(a)}insertAbort(s,a){this.queues[a].unshift(s),this.executeNext(a)}appendBlocker(s){let a;const et=new Promise(rt=>{a=rt}),tt={execute:a,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(tt,s),et}executeNext(s){const a=this.queues[s];if(a.length){const et=a[0];try{et.execute()}catch(tt){logger.warn(`[buffer-operation-queue]: Exception executing "${s}" SourceBuffer operation: ${tt}`),et.onError(tt);const rt=this.buffers[s];rt!=null&&rt.updating||this.shiftAndExecuteNext(s)}}}shiftAndExecuteNext(s){this.queues[s].shift(),this.executeNext(s)}current(s){return this.queues[s][0]}}const VIDEO_CODEC_PROFILE_REPLACE=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/;class BufferController{constructor(s){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=et=>{this.hls&&this.hls.pauseBuffering()},this._onStartStreaming=et=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=()=>{const{media:et,mediaSource:tt}=this;this.log("Media source opened"),et&&(et.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(Events.MEDIA_ATTACHED,{media:et,mediaSource:tt})),tt&&tt.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:et,_objectUrl:tt}=this;et!==tt&&logger.error(`Media element src was set while attaching MediaSource (${tt} > ${et})`)},this.hls=s;const a="[buffer-controller]";this.appendSource=isManagedMediaSource(getMediaSource(s.config.preferManagedMediaSource)),this.log=logger.log.bind(logger,a),this.warn=logger.warn.bind(logger,a),this.error=logger.error.bind(logger,a),this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null}registerListeners(){const{hls:s}=this;s.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),s.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),s.on(Events.BUFFER_RESET,this.onBufferReset,this),s.on(Events.BUFFER_APPENDING,this.onBufferAppending,this),s.on(Events.BUFFER_CODECS,this.onBufferCodecs,this),s.on(Events.BUFFER_EOS,this.onBufferEos,this),s.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),s.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this),s.on(Events.FRAG_PARSED,this.onFragParsed,this),s.on(Events.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:s}=this;s.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),s.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),s.off(Events.BUFFER_RESET,this.onBufferReset,this),s.off(Events.BUFFER_APPENDING,this.onBufferAppending,this),s.off(Events.BUFFER_CODECS,this.onBufferCodecs,this),s.off(Events.BUFFER_EOS,this.onBufferEos,this),s.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),s.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this),s.off(Events.FRAG_PARSED,this.onFragParsed,this),s.off(Events.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new BufferOperationQueue(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(s,a){let et=2;(a.audio&&!a.video||!a.altAudio)&&(et=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=et,this.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(s,a){const et=this.media=a.media,tt=getMediaSource(this.appendSource);if(et&&tt){var rt;const nt=this.mediaSource=new tt;this.log(`created media source: ${(rt=nt.constructor)==null?void 0:rt.name}`),nt.addEventListener("sourceopen",this._onMediaSourceOpen),nt.addEventListener("sourceended",this._onMediaSourceEnded),nt.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(nt.addEventListener("startstreaming",this._onStartStreaming),nt.addEventListener("endstreaming",this._onEndStreaming));const it=this._objectUrl=self.URL.createObjectURL(nt);if(this.appendSource)try{et.removeAttribute("src");const st=self.ManagedMediaSource;et.disableRemotePlayback=et.disableRemotePlayback||st&&nt instanceof st,removeSourceChildren(et),addSource(et,it),et.load()}catch{et.src=it}else et.src=it;et.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:s,mediaSource:a,_objectUrl:et}=this;if(a){if(this.log("media source detaching"),a.readyState==="open")try{a.endOfStream()}catch(tt){this.warn(`onMediaDetaching: ${tt.message} while calling endOfStream`)}this.onBufferReset(),a.removeEventListener("sourceopen",this._onMediaSourceOpen),a.removeEventListener("sourceended",this._onMediaSourceEnded),a.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(a.removeEventListener("startstreaming",this._onStartStreaming),a.removeEventListener("endstreaming",this._onEndStreaming)),s&&(s.removeEventListener("emptied",this._onMediaEmptied),et&&self.URL.revokeObjectURL(et),this.mediaSrc===et?(s.removeAttribute("src"),this.appendSource&&removeSourceChildren(s),s.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(Events.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(s=>{this.resetBuffer(s)}),this._initSourceBuffer()}resetBuffer(s){const a=this.sourceBuffer[s];try{if(a){var et;this.removeBufferListeners(s),this.sourceBuffer[s]=void 0,(et=this.mediaSource)!=null&&et.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(a)}}catch(tt){this.warn(`onBufferReset ${s}`,tt)}}onBufferCodecs(s,a){const et=this.getSourceBufferTypes().length,tt=Object.keys(a);if(tt.forEach(nt=>{if(et){const st=this.tracks[nt];if(st&&typeof st.buffer.changeType=="function"){var it;const{id:ot,codec:at,levelCodec:lt,container:ct,metadata:ht}=a[nt],ft=pickMostCompleteCodecName(st.codec,st.levelCodec),dt=ft?.replace(VIDEO_CODEC_PROFILE_REPLACE,"$1");let pt=pickMostCompleteCodecName(at,lt);const gt=(it=pt)==null?void 0:it.replace(VIDEO_CODEC_PROFILE_REPLACE,"$1");if(pt&&dt!==gt){nt.slice(0,5)==="audio"&&(pt=getCodecCompatibleName(pt,this.appendSource));const mt=`${ct};codecs=${pt}`;this.appendChangeType(nt,mt),this.log(`switching codec ${ft} to ${pt}`),this.tracks[nt]={buffer:st.buffer,codec:at,container:ct,levelCodec:lt,metadata:ht,id:ot}}}}else this.pendingTracks[nt]=a[nt]}),et)return;const rt=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==rt&&(this.log(`${rt} bufferCodec event(s) expected ${tt.join(",")}`),this.bufferCodecEventsExpected=rt),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks()}appendChangeType(s,a){const{operationQueue:et}=this,tt={execute:()=>{const rt=this.sourceBuffer[s];rt&&(this.log(`changing ${s} sourceBuffer type to ${a}`),rt.changeType(a)),et.shiftAndExecuteNext(s)},onStart:()=>{},onComplete:()=>{},onError:rt=>{this.warn(`Failed to change ${s} SourceBuffer type`,rt)}};et.append(tt,s,!!this.pendingTracks[s])}onBufferAppending(s,a){const{hls:et,operationQueue:tt,tracks:rt}=this,{data:nt,type:it,frag:st,part:ot,chunkMeta:at}=a,lt=at.buffering[it],ct=self.performance.now();lt.start=ct;const ht=st.stats.buffering,ft=ot?ot.stats.buffering:null;ht.start===0&&(ht.start=ct),ft&&ft.start===0&&(ft.start=ct);const dt=rt.audio;let pt=!1;it==="audio"&&dt?.container==="audio/mpeg"&&(pt=!this.lastMpegAudioChunk||at.id===1||this.lastMpegAudioChunk.sn!==at.sn,this.lastMpegAudioChunk=at);const gt=st.start,mt={execute:()=>{if(lt.executeStart=self.performance.now(),pt){const yt=this.sourceBuffer[it];if(yt){const vt=gt-yt.timestampOffset;Math.abs(vt)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${gt} (delta: ${vt}) sn: ${st.sn})`),yt.timestampOffset=gt)}}this.appendExecutor(nt,it)},onStart:()=>{},onComplete:()=>{const yt=self.performance.now();lt.executeEnd=lt.end=yt,ht.first===0&&(ht.first=yt),ft&&ft.first===0&&(ft.first=yt);const{sourceBuffer:vt}=this,Et={};for(const xt in vt)Et[xt]=BufferHelper.getBuffered(vt[xt]);this.appendErrors[it]=0,it==="audio"||it==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(Events.BUFFER_APPENDED,{type:it,frag:st,part:ot,chunkMeta:at,parent:st.type,timeRanges:Et})},onError:yt=>{const vt={type:ErrorTypes.MEDIA_ERROR,parent:st.type,details:ErrorDetails.BUFFER_APPEND_ERROR,sourceBufferName:it,frag:st,part:ot,chunkMeta:at,error:yt,err:yt,fatal:!1};if(yt.code===DOMException.QUOTA_EXCEEDED_ERR)vt.details=ErrorDetails.BUFFER_FULL_ERROR;else{const Et=++this.appendErrors[it];vt.details=ErrorDetails.BUFFER_APPEND_ERROR,this.warn(`Failed ${Et}/${et.config.appendErrorMaxRetry} times to append segment in "${it}" sourceBuffer`),Et>=et.config.appendErrorMaxRetry&&(vt.fatal=!0)}et.trigger(Events.ERROR,vt)}};tt.append(mt,it,!!this.pendingTracks[it])}onBufferFlushing(s,a){const{operationQueue:et}=this,tt=rt=>({execute:this.removeExecutor.bind(this,rt,a.startOffset,a.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(Events.BUFFER_FLUSHED,{type:rt})},onError:nt=>{this.warn(`Failed to remove from ${rt} SourceBuffer`,nt)}});a.type?et.append(tt(a.type),a.type):this.getSourceBufferTypes().forEach(rt=>{et.append(tt(rt),rt)})}onFragParsed(s,a){const{frag:et,part:tt}=a,rt=[],nt=tt?tt.elementaryStreams:et.elementaryStreams;nt[ElementaryStreamTypes.AUDIOVIDEO]?rt.push("audiovideo"):(nt[ElementaryStreamTypes.AUDIO]&&rt.push("audio"),nt[ElementaryStreamTypes.VIDEO]&&rt.push("video"));const it=()=>{const st=self.performance.now();et.stats.buffering.end=st,tt&&(tt.stats.buffering.end=st);const ot=tt?tt.stats:et.stats;this.hls.trigger(Events.FRAG_BUFFERED,{frag:et,part:tt,stats:ot,id:et.type})};rt.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${et.type} level: ${et.level} sn: ${et.sn}`),this.blockBuffers(it,rt)}onFragChanged(s,a){this.trimBuffers()}onBufferEos(s,a){this.getSourceBufferTypes().reduce((tt,rt)=>{const nt=this.sourceBuffer[rt];return nt&&(!a.type||a.type===rt)&&(nt.ending=!0,nt.ended||(nt.ended=!0,this.log(`${rt} sourceBuffer now EOS`))),tt&&!!(!nt||nt.ended)},!0)&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(rt=>{const nt=this.sourceBuffer[rt];nt&&(nt.ending=!1)});const{mediaSource:tt}=this;if(!tt||tt.readyState!=="open"){tt&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${tt.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),tt.endOfStream()}))}onLevelUpdated(s,{details:a}){a.fragments.length&&(this.details=a,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}trimBuffers(){const{hls:s,details:a,media:et}=this;if(!et||a===null||!this.getSourceBufferTypes().length)return;const rt=s.config,nt=et.currentTime,it=a.levelTargetDuration,st=a.live&&rt.liveBackBufferLength!==null?rt.liveBackBufferLength:rt.backBufferLength;if(isFiniteNumber(st)&&st>0){const ot=Math.max(st,it),at=Math.floor(nt/it)*it-ot;this.flushBackBuffer(nt,it,at)}if(isFiniteNumber(rt.frontBufferFlushThreshold)&&rt.frontBufferFlushThreshold>0){const ot=Math.max(rt.maxBufferLength,rt.frontBufferFlushThreshold),at=Math.max(ot,it),lt=Math.floor(nt/it)*it+at;this.flushFrontBuffer(nt,it,lt)}}flushBackBuffer(s,a,et){const{details:tt,sourceBuffer:rt}=this;this.getSourceBufferTypes().forEach(it=>{const st=rt[it];if(st){const ot=BufferHelper.getBuffered(st);if(ot.length>0&&et>ot.start(0)){if(this.hls.trigger(Events.BACK_BUFFER_REACHED,{bufferEnd:et}),tt!=null&&tt.live)this.hls.trigger(Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:et});else if(st.ended&&ot.end(ot.length-1)-s<a*2){this.log(`Cannot flush ${it} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(Events.BUFFER_FLUSHING,{startOffset:0,endOffset:et,type:it})}}})}flushFrontBuffer(s,a,et){const{sourceBuffer:tt}=this;this.getSourceBufferTypes().forEach(nt=>{const it=tt[nt];if(it){const st=BufferHelper.getBuffered(it),ot=st.length;if(ot<2)return;const at=st.start(ot-1),lt=st.end(ot-1);if(et>at||s>=at&&s<=lt)return;if(it.ended&&s-lt<2*a){this.log(`Cannot flush ${nt} front buffer while SourceBuffer is in ended state`);return}this.hls.trigger(Events.BUFFER_FLUSHING,{startOffset:at,endOffset:1/0,type:nt})}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")return;const{details:s,hls:a,media:et,mediaSource:tt}=this,rt=s.fragments[0].start+s.totalduration,nt=et.duration,it=isFiniteNumber(tt.duration)?tt.duration:0;s.live&&a.config.liveDurationInfinity?(tt.duration=1/0,this.updateSeekableRange(s)):(rt>it&&rt>nt||!isFiniteNumber(nt))&&(this.log(`Updating Media Source duration to ${rt.toFixed(3)}`),tt.duration=rt)}updateSeekableRange(s){const a=this.mediaSource,et=s.fragments;if(et.length&&s.live&&a!=null&&a.setLiveSeekableRange){const rt=Math.max(0,et[0].start),nt=Math.max(rt,rt+s.totalduration);this.log(`Media Source duration is set to ${a.duration}. Setting seekable range to ${rt}-${nt}.`),a.setLiveSeekableRange(rt,nt)}}checkPendingTracks(){const{bufferCodecEventsExpected:s,operationQueue:a,pendingTracks:et}=this,tt=Object.keys(et).length;if(tt&&(!s||tt===2||"audiovideo"in et)){this.createSourceBuffers(et),this.pendingTracks={};const rt=this.getSourceBufferTypes();if(rt.length)this.hls.trigger(Events.BUFFER_CREATED,{tracks:this.tracks}),rt.forEach(nt=>{a.executeNext(nt)});else{const nt=new Error("could not create source buffer for media codec(s)");this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:nt,reason:nt.message})}}}createSourceBuffers(s){const{sourceBuffer:a,mediaSource:et}=this;if(!et)throw Error("createSourceBuffers called when mediaSource was null");for(const rt in s)if(!a[rt]){var tt;const nt=s[rt];if(!nt)throw Error(`source buffer exists for track ${rt}, however track does not`);let it=((tt=nt.levelCodec)==null?void 0:tt.indexOf(","))===-1?nt.levelCodec:nt.codec;it&&rt.slice(0,5)==="audio"&&(it=getCodecCompatibleName(it,this.appendSource));const st=`${nt.container};codecs=${it}`;this.log(`creating sourceBuffer(${st})`);try{const ot=a[rt]=et.addSourceBuffer(st),at=rt;this.addBufferListener(at,"updatestart",this._onSBUpdateStart),this.addBufferListener(at,"updateend",this._onSBUpdateEnd),this.addBufferListener(at,"error",this._onSBUpdateError),this.appendSource&&this.addBufferListener(at,"bufferedchange",(lt,ct)=>{const ht=ct.removedRanges;ht!=null&&ht.length&&this.hls.trigger(Events.BUFFER_FLUSHED,{type:rt})}),this.tracks[rt]={buffer:ot,codec:it,container:nt.container,levelCodec:nt.levelCodec,metadata:nt.metadata,id:nt.id}}catch(ot){this.error(`error while trying to add sourceBuffer: ${ot.message}`),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:ot,sourceBufferName:rt,mimeType:st})}}}get mediaSrc(){var s;const a=((s=this.media)==null?void 0:s.firstChild)||this.media;return a?.src}_onSBUpdateStart(s){const{operationQueue:a}=this;a.current(s).onStart()}_onSBUpdateEnd(s){var a;if(((a=this.mediaSource)==null?void 0:a.readyState)==="closed"){this.resetBuffer(s);return}const{operationQueue:et}=this;et.current(s).onComplete(),et.shiftAndExecuteNext(s)}_onSBUpdateError(s,a){var et;const tt=new Error(`${s} SourceBuffer error. MediaSource readyState: ${(et=this.mediaSource)==null?void 0:et.readyState}`);this.error(`${tt}`,a),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_APPENDING_ERROR,sourceBufferName:s,error:tt,fatal:!1});const rt=this.operationQueue.current(s);rt&&rt.onError(tt)}removeExecutor(s,a,et){const{media:tt,mediaSource:rt,operationQueue:nt,sourceBuffer:it}=this,st=it[s];if(!tt||!rt||!st){this.warn(`Attempting to remove from the ${s} SourceBuffer, but it does not exist`),nt.shiftAndExecuteNext(s);return}const ot=isFiniteNumber(tt.duration)?tt.duration:1/0,at=isFiniteNumber(rt.duration)?rt.duration:1/0,lt=Math.max(0,a),ct=Math.min(et,ot,at);ct>lt&&(!st.ending||st.ended)?(st.ended=!1,this.log(`Removing [${lt},${ct}] from the ${s} SourceBuffer`),st.remove(lt,ct)):nt.shiftAndExecuteNext(s)}appendExecutor(s,a){const et=this.sourceBuffer[a];if(!et){if(!this.pendingTracks[a])throw new Error(`Attempting to append to the ${a} SourceBuffer, but it does not exist`);return}et.ended=!1,et.appendBuffer(s)}blockBuffers(s,a=this.getSourceBufferTypes()){if(!a.length){this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(s);return}const{operationQueue:et}=this,tt=a.map(rt=>et.appendBlocker(rt));Promise.all(tt).then(()=>{s(),a.forEach(rt=>{const nt=this.sourceBuffer[rt];nt!=null&&nt.updating||et.shiftAndExecuteNext(rt)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(s,a,et){const tt=this.sourceBuffer[s];if(!tt)return;const rt=et.bind(this,s);this.listeners[s].push({event:a,listener:rt}),tt.addEventListener(a,rt)}removeBufferListeners(s){const a=this.sourceBuffer[s];a&&this.listeners[s].forEach(et=>{a.removeEventListener(et.event,et.listener)})}}function removeSourceChildren(o){const s=o.querySelectorAll("source");[].slice.call(s).forEach(a=>{o.removeChild(a)})}function addSource(o,s){const a=self.document.createElement("source");a.type="video/mp4",a.src=s,o.appendChild(a)}const specialCea608CharsCodes={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},getCharForByte=o=>String.fromCharCode(specialCea608CharsCodes[o]||o),NR_ROWS=15,NR_COLS=100,rowsLowCh1={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},rowsHighCh1={17:2,18:4,21:6,22:8,23:10,19:13,20:15},rowsLowCh2={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},rowsHighCh2={25:2,26:4,29:6,30:8,31:10,27:13,28:15},backgroundColors=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class CaptionsLogger{constructor(){this.time=null,this.verboseLevel=0}log(s,a){if(this.verboseLevel>=s){const et=typeof a=="function"?a():a;logger.log(`${this.time} [${s}] ${et}`)}}}const numArrayToHexArray=function o(s){const a=[];for(let et=0;et<s.length;et++)a.push(s[et].toString(16));return a};class PenState{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(s){const a=["foreground","underline","italics","background","flash"];for(let et=0;et<a.length;et++){const tt=a[et];s.hasOwnProperty(tt)&&(this[tt]=s[tt])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(s){return this.foreground===s.foreground&&this.underline===s.underline&&this.italics===s.italics&&this.background===s.background&&this.flash===s.flash}copy(s){this.foreground=s.foreground,this.underline=s.underline,this.italics=s.italics,this.background=s.background,this.flash=s.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class StyledUnicodeChar{constructor(){this.uchar=" ",this.penState=new PenState}reset(){this.uchar=" ",this.penState.reset()}setChar(s,a){this.uchar=s,this.penState.copy(a)}setPenState(s){this.penState.copy(s)}equals(s){return this.uchar===s.uchar&&this.penState.equals(s.penState)}copy(s){this.uchar=s.uchar,this.penState.copy(s.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class Row{constructor(s){this.chars=[],this.pos=0,this.currPenState=new PenState,this.cueStartTime=null,this.logger=void 0;for(let a=0;a<NR_COLS;a++)this.chars.push(new StyledUnicodeChar);this.logger=s}equals(s){for(let a=0;a<NR_COLS;a++)if(!this.chars[a].equals(s.chars[a]))return!1;return!0}copy(s){for(let a=0;a<NR_COLS;a++)this.chars[a].copy(s.chars[a])}isEmpty(){let s=!0;for(let a=0;a<NR_COLS;a++)if(!this.chars[a].isEmpty()){s=!1;break}return s}setCursor(s){this.pos!==s&&(this.pos=s),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>NR_COLS&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=NR_COLS)}moveCursor(s){const a=this.pos+s;if(s>1)for(let et=this.pos+1;et<a+1;et++)this.chars[et].setPenState(this.currPenState);this.setCursor(a)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(s){s>=144&&this.backSpace();const a=getCharForByte(s);if(this.pos>=NR_COLS){this.logger.log(0,()=>"Cannot insert "+s.toString(16)+" ("+a+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(a,this.currPenState),this.moveCursor(1)}clearFromPos(s){let a;for(a=s;a<NR_COLS;a++)this.chars[a].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const s=[];let a=!0;for(let et=0;et<NR_COLS;et++){const tt=this.chars[et].uchar;tt!==" "&&(a=!1),s.push(tt)}return a?"":s.join("")}setPenStyles(s){this.currPenState.setStyles(s),this.chars[this.pos].setPenState(this.currPenState)}}class CaptionScreen{constructor(s){this.rows=[],this.currRow=NR_ROWS-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let a=0;a<NR_ROWS;a++)this.rows.push(new Row(s));this.logger=s}reset(){for(let s=0;s<NR_ROWS;s++)this.rows[s].clear();this.currRow=NR_ROWS-1}equals(s){let a=!0;for(let et=0;et<NR_ROWS;et++)if(!this.rows[et].equals(s.rows[et])){a=!1;break}return a}copy(s){for(let a=0;a<NR_ROWS;a++)this.rows[a].copy(s.rows[a])}isEmpty(){let s=!0;for(let a=0;a<NR_ROWS;a++)if(!this.rows[a].isEmpty()){s=!1;break}return s}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(s){this.rows[this.currRow].insertChar(s)}setPen(s){this.rows[this.currRow].setPenStyles(s)}moveCursor(s){this.rows[this.currRow].moveCursor(s)}setCursor(s){this.logger.log(2,"setCursor: "+s),this.rows[this.currRow].setCursor(s)}setPAC(s){this.logger.log(2,()=>"pacData = "+JSON.stringify(s));let a=s.row-1;if(this.nrRollUpRows&&a<this.nrRollUpRows-1&&(a=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==a){for(let it=0;it<NR_ROWS;it++)this.rows[it].clear();const rt=this.currRow+1-this.nrRollUpRows,nt=this.lastOutputScreen;if(nt){const it=nt.rows[rt].cueStartTime,st=this.logger.time;if(it!==null&&st!==null&&it<st)for(let ot=0;ot<this.nrRollUpRows;ot++)this.rows[a-this.nrRollUpRows+ot+1].copy(nt.rows[rt+ot])}}this.currRow=a;const et=this.rows[this.currRow];if(s.indent!==null){const rt=s.indent,nt=Math.max(rt-1,0);et.setCursor(s.indent),s.color=et.chars[nt].penState.foreground}const tt={foreground:s.color,underline:s.underline,italics:s.italics,background:"black",flash:!1};this.setPen(tt)}setBkgData(s){this.logger.log(2,()=>"bkgData = "+JSON.stringify(s)),this.backSpace(),this.setPen(s),this.insertChar(32)}setRollUpRows(s){this.nrRollUpRows=s}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const s=this.currRow+1-this.nrRollUpRows,a=this.rows.splice(s,1)[0];a.clear(),this.rows.splice(this.currRow,0,a),this.logger.log(2,"Rolling up")}getDisplayText(s){s=s||!1;const a=[];let et="",tt=-1;for(let rt=0;rt<NR_ROWS;rt++){const nt=this.rows[rt].getTextString();nt&&(tt=rt+1,s?a.push("Row "+tt+": '"+nt+"'"):a.push(nt.trim()))}return a.length>0&&(s?et="["+a.join(" | ")+"]":et=a.join(`
`)),et}getTextAndFormat(){return this.rows}}class Cea608Channel{constructor(s,a,et){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=s,this.outputFilter=a,this.mode=null,this.verbose=0,this.displayedMemory=new CaptionScreen(et),this.nonDisplayedMemory=new CaptionScreen(et),this.lastOutputScreen=new CaptionScreen(et),this.currRollUpRow=this.displayedMemory.rows[NR_ROWS-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=et}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[NR_ROWS-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(s){this.outputFilter=s}setPAC(s){this.writeScreen.setPAC(s)}setBkgData(s){this.writeScreen.setBkgData(s)}setMode(s){s!==this.mode&&(this.mode=s,this.logger.log(2,()=>"MODE="+s),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=s)}insertChars(s){for(let et=0;et<s.length;et++)this.writeScreen.insertChar(s[et]);const a=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>a+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(s){this.logger.log(2,"RU("+s+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(s)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const s=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=s,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(s){this.logger.log(2,"TO("+s+") - Tab Offset"),this.writeScreen.moveCursor(s)}ccMIDROW(s){const a={flash:!1};if(a.underline=s%2===1,a.italics=s>=46,a.italics)a.foreground="white";else{const et=Math.floor(s/2)-16,tt=["white","green","blue","cyan","red","yellow","magenta"];a.foreground=tt[et]}this.logger.log(2,"MIDROW: "+JSON.stringify(a)),this.writeScreen.setPen(a)}outputDataUpdate(s=!1){const a=this.logger.time;a!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=a:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,a,this.lastOutputScreen),s&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:a),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(s){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,s,this.displayedMemory),this.cueStartTime=s))}}class Cea608Parser{constructor(s,a,et){this.channels=void 0,this.currentChannel=0,this.cmdHistory=createCmdHistory(),this.logger=void 0;const tt=this.logger=new CaptionsLogger;this.channels=[null,new Cea608Channel(s,a,tt),new Cea608Channel(s+1,et,tt)]}getHandler(s){return this.channels[s].getHandler()}setHandler(s,a){this.channels[s].setHandler(a)}addData(s,a){this.logger.time=s;for(let et=0;et<a.length;et+=2){const tt=a[et]&127,rt=a[et+1]&127;let nt=!1,it=null;if(tt===0&&rt===0)continue;this.logger.log(3,()=>"["+numArrayToHexArray([a[et],a[et+1]])+"] -> ("+numArrayToHexArray([tt,rt])+")");const st=this.cmdHistory;if(tt>=16&&tt<=31){if(hasCmdRepeated(tt,rt,st)){setLastCmd(null,null,st),this.logger.log(3,()=>"Repeated command ("+numArrayToHexArray([tt,rt])+") is dropped");continue}setLastCmd(tt,rt,this.cmdHistory),nt=this.parseCmd(tt,rt),nt||(nt=this.parseMidrow(tt,rt)),nt||(nt=this.parsePAC(tt,rt)),nt||(nt=this.parseBackgroundAttributes(tt,rt))}else setLastCmd(null,null,st);if(!nt&&(it=this.parseChars(tt,rt),it)){const at=this.currentChannel;at&&at>0?this.channels[at].insertChars(it):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!nt&&!it&&this.logger.log(2,()=>"Couldn't parse cleaned data "+numArrayToHexArray([tt,rt])+" orig: "+numArrayToHexArray([a[et],a[et+1]]))}}parseCmd(s,a){const et=(s===20||s===28||s===21||s===29)&&a>=32&&a<=47,tt=(s===23||s===31)&&a>=33&&a<=35;if(!(et||tt))return!1;const rt=s===20||s===21||s===23?1:2,nt=this.channels[rt];return s===20||s===21||s===28||s===29?a===32?nt.ccRCL():a===33?nt.ccBS():a===34?nt.ccAOF():a===35?nt.ccAON():a===36?nt.ccDER():a===37?nt.ccRU(2):a===38?nt.ccRU(3):a===39?nt.ccRU(4):a===40?nt.ccFON():a===41?nt.ccRDC():a===42?nt.ccTR():a===43?nt.ccRTD():a===44?nt.ccEDM():a===45?nt.ccCR():a===46?nt.ccENM():a===47&&nt.ccEOC():nt.ccTO(a-32),this.currentChannel=rt,!0}parseMidrow(s,a){let et=0;if((s===17||s===25)&&a>=32&&a<=47){if(s===17?et=1:et=2,et!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const tt=this.channels[et];return tt?(tt.ccMIDROW(a),this.logger.log(3,()=>"MIDROW ("+numArrayToHexArray([s,a])+")"),!0):!1}return!1}parsePAC(s,a){let et;const tt=(s>=17&&s<=23||s>=25&&s<=31)&&a>=64&&a<=127,rt=(s===16||s===24)&&a>=64&&a<=95;if(!(tt||rt))return!1;const nt=s<=23?1:2;a>=64&&a<=95?et=nt===1?rowsLowCh1[s]:rowsLowCh2[s]:et=nt===1?rowsHighCh1[s]:rowsHighCh2[s];const it=this.channels[nt];return it?(it.setPAC(this.interpretPAC(et,a)),this.currentChannel=nt,!0):!1}interpretPAC(s,a){let et;const tt={color:null,italics:!1,indent:null,underline:!1,row:s};return a>95?et=a-96:et=a-64,tt.underline=(et&1)===1,et<=13?tt.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(et/2)]:et<=15?(tt.italics=!0,tt.color="white"):tt.indent=Math.floor((et-16)/2)*4,tt}parseChars(s,a){let et,tt=null,rt=null;if(s>=25?(et=2,rt=s-8):(et=1,rt=s),rt>=17&&rt<=19){let nt;rt===17?nt=a+80:rt===18?nt=a+112:nt=a+144,this.logger.log(2,()=>"Special char '"+getCharForByte(nt)+"' in channel "+et),tt=[nt]}else s>=32&&s<=127&&(tt=a===0?[s]:[s,a]);return tt&&this.logger.log(3,()=>"Char codes =  "+numArrayToHexArray(tt).join(",")),tt}parseBackgroundAttributes(s,a){const et=(s===16||s===24)&&a>=32&&a<=47,tt=(s===23||s===31)&&a>=45&&a<=47;if(!(et||tt))return!1;let rt;const nt={};s===16||s===24?(rt=Math.floor((a-32)/2),nt.background=backgroundColors[rt],a%2===1&&(nt.background=nt.background+"_semi")):a===45?nt.background="transparent":(nt.foreground="black",a===47&&(nt.underline=!0));const it=s<=23?1:2;return this.channels[it].setBkgData(nt),!0}reset(){for(let s=0;s<Object.keys(this.channels).length;s++){const a=this.channels[s];a&&a.reset()}setLastCmd(null,null,this.cmdHistory)}cueSplitAtTime(s){for(let a=0;a<this.channels.length;a++){const et=this.channels[a];et&&et.cueSplitAtTime(s)}}}function setLastCmd(o,s,a){a.a=o,a.b=s}function hasCmdRepeated(o,s,a){return a.a===o&&a.b===s}function createCmdHistory(){return{a:null,b:null}}class OutputFilter{constructor(s,a){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=s,this.trackName=a}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(s,a,et){(this.startTime===null||this.startTime>s)&&(this.startTime=s),this.endTime=a,this.screen=et,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var VTTCue=function(){if(optionalSelf!=null&&optionalSelf.VTTCue)return self.VTTCue;const o=["","lr","rl"],s=["start","middle","end","left","right"];function a(it,st){if(typeof st!="string"||!Array.isArray(it))return!1;const ot=st.toLowerCase();return~it.indexOf(ot)?ot:!1}function et(it){return a(o,it)}function tt(it){return a(s,it)}function rt(it,...st){let ot=1;for(;ot<arguments.length;ot++){const at=arguments[ot];for(const lt in at)it[lt]=at[lt]}return it}function nt(it,st,ot){const at=this,lt={enumerable:!0};at.hasBeenReset=!1;let ct="",ht=!1,ft=it,dt=st,pt=ot,gt=null,mt="",yt=!0,vt="auto",Et="start",xt=50,wt="middle",Rt=50,Ct="middle";Object.defineProperty(at,"id",rt({},lt,{get:function(){return ct},set:function(Ft){ct=""+Ft}})),Object.defineProperty(at,"pauseOnExit",rt({},lt,{get:function(){return ht},set:function(Ft){ht=!!Ft}})),Object.defineProperty(at,"startTime",rt({},lt,{get:function(){return ft},set:function(Ft){if(typeof Ft!="number")throw new TypeError("Start time must be set to a number.");ft=Ft,this.hasBeenReset=!0}})),Object.defineProperty(at,"endTime",rt({},lt,{get:function(){return dt},set:function(Ft){if(typeof Ft!="number")throw new TypeError("End time must be set to a number.");dt=Ft,this.hasBeenReset=!0}})),Object.defineProperty(at,"text",rt({},lt,{get:function(){return pt},set:function(Ft){pt=""+Ft,this.hasBeenReset=!0}})),Object.defineProperty(at,"region",rt({},lt,{get:function(){return gt},set:function(Ft){gt=Ft,this.hasBeenReset=!0}})),Object.defineProperty(at,"vertical",rt({},lt,{get:function(){return mt},set:function(Ft){const zt=et(Ft);if(zt===!1)throw new SyntaxError("An invalid or illegal string was specified.");mt=zt,this.hasBeenReset=!0}})),Object.defineProperty(at,"snapToLines",rt({},lt,{get:function(){return yt},set:function(Ft){yt=!!Ft,this.hasBeenReset=!0}})),Object.defineProperty(at,"line",rt({},lt,{get:function(){return vt},set:function(Ft){if(typeof Ft!="number"&&Ft!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");vt=Ft,this.hasBeenReset=!0}})),Object.defineProperty(at,"lineAlign",rt({},lt,{get:function(){return Et},set:function(Ft){const zt=tt(Ft);if(!zt)throw new SyntaxError("An invalid or illegal string was specified.");Et=zt,this.hasBeenReset=!0}})),Object.defineProperty(at,"position",rt({},lt,{get:function(){return xt},set:function(Ft){if(Ft<0||Ft>100)throw new Error("Position must be between 0 and 100.");xt=Ft,this.hasBeenReset=!0}})),Object.defineProperty(at,"positionAlign",rt({},lt,{get:function(){return wt},set:function(Ft){const zt=tt(Ft);if(!zt)throw new SyntaxError("An invalid or illegal string was specified.");wt=zt,this.hasBeenReset=!0}})),Object.defineProperty(at,"size",rt({},lt,{get:function(){return Rt},set:function(Ft){if(Ft<0||Ft>100)throw new Error("Size must be between 0 and 100.");Rt=Ft,this.hasBeenReset=!0}})),Object.defineProperty(at,"align",rt({},lt,{get:function(){return Ct},set:function(Ft){const zt=tt(Ft);if(!zt)throw new SyntaxError("An invalid or illegal string was specified.");Ct=zt,this.hasBeenReset=!0}})),at.displayState=void 0}return nt.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},nt}();class StringDecoder{decode(s,a){if(!s)return"";if(typeof s!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(s))}}function parseTimeStamp(o){function s(et,tt,rt,nt){return(et|0)*3600+(tt|0)*60+(rt|0)+parseFloat(nt||0)}const a=o.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return a?parseFloat(a[2])>59?s(a[2],a[3],0,a[4]):s(a[1],a[2],a[3],a[4]):null}class Settings{constructor(){this.values=Object.create(null)}set(s,a){!this.get(s)&&a!==""&&(this.values[s]=a)}get(s,a,et){return et?this.has(s)?this.values[s]:a[et]:this.has(s)?this.values[s]:a}has(s){return s in this.values}alt(s,a,et){for(let tt=0;tt<et.length;++tt)if(a===et[tt]){this.set(s,a);break}}integer(s,a){/^-?\d+$/.test(a)&&this.set(s,parseInt(a,10))}percent(s,a){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(a)){const et=parseFloat(a);if(et>=0&&et<=100)return this.set(s,et),!0}return!1}}function parseOptions(o,s,a,et){const tt=et?o.split(et):[o];for(const rt in tt){if(typeof tt[rt]!="string")continue;const nt=tt[rt].split(a);if(nt.length!==2)continue;const it=nt[0],st=nt[1];s(it,st)}}const defaults=new VTTCue(0,0,""),center=defaults.align==="middle"?"middle":"center";function parseCue(o,s,a){const et=o;function tt(){const it=parseTimeStamp(o);if(it===null)throw new Error("Malformed timestamp: "+et);return o=o.replace(/^[^\sa-zA-Z-]+/,""),it}function rt(it,st){const ot=new Settings;parseOptions(it,function(ct,ht){let ft;switch(ct){case"region":for(let dt=a.length-1;dt>=0;dt--)if(a[dt].id===ht){ot.set(ct,a[dt].region);break}break;case"vertical":ot.alt(ct,ht,["rl","lr"]);break;case"line":ft=ht.split(","),ot.integer(ct,ft[0]),ot.percent(ct,ft[0])&&ot.set("snapToLines",!1),ot.alt(ct,ft[0],["auto"]),ft.length===2&&ot.alt("lineAlign",ft[1],["start",center,"end"]);break;case"position":ft=ht.split(","),ot.percent(ct,ft[0]),ft.length===2&&ot.alt("positionAlign",ft[1],["start",center,"end","line-left","line-right","auto"]);break;case"size":ot.percent(ct,ht);break;case"align":ot.alt(ct,ht,["start",center,"end","left","right"]);break}},/:/,/\s/),st.region=ot.get("region",null),st.vertical=ot.get("vertical","");let at=ot.get("line","auto");at==="auto"&&defaults.line===-1&&(at=-1),st.line=at,st.lineAlign=ot.get("lineAlign","start"),st.snapToLines=ot.get("snapToLines",!0),st.size=ot.get("size",100),st.align=ot.get("align",center);let lt=ot.get("position","auto");lt==="auto"&&defaults.position===50&&(lt=st.align==="start"||st.align==="left"?0:st.align==="end"||st.align==="right"?100:50),st.position=lt}function nt(){o=o.replace(/^\s+/,"")}if(nt(),s.startTime=tt(),nt(),o.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+et);o=o.slice(3),nt(),s.endTime=tt(),nt(),rt(o,s)}function fixLineBreaks(o){return o.replace(/<br(?: \/)?>/gi,`
`)}class VTTParser{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new StringDecoder,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(s){const a=this;s&&(a.buffer+=a.decoder.decode(s,{stream:!0}));function et(){let rt=a.buffer,nt=0;for(rt=fixLineBreaks(rt);nt<rt.length&&rt[nt]!=="\r"&&rt[nt]!==`
`;)++nt;const it=rt.slice(0,nt);return rt[nt]==="\r"&&++nt,rt[nt]===`
`&&++nt,a.buffer=rt.slice(nt),it}function tt(rt){parseOptions(rt,function(nt,it){},/:/)}try{let rt="";if(a.state==="INITIAL"){if(!/\r\n|\n/.test(a.buffer))return this;rt=et();const it=rt.match(/^()?WEBVTT([ \t].*)?$/);if(!(it!=null&&it[0]))throw new Error("Malformed WebVTT signature.");a.state="HEADER"}let nt=!1;for(;a.buffer;){if(!/\r\n|\n/.test(a.buffer))return this;switch(nt?nt=!1:rt=et(),a.state){case"HEADER":/:/.test(rt)?tt(rt):rt||(a.state="ID");continue;case"NOTE":rt||(a.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(rt)){a.state="NOTE";break}if(!rt)continue;if(a.cue=new VTTCue(0,0,""),a.state="CUE",rt.indexOf("-->")===-1){a.cue.id=rt;continue}case"CUE":if(!a.cue){a.state="BADCUE";continue}try{parseCue(rt,a.cue,a.regionList)}catch{a.cue=null,a.state="BADCUE";continue}a.state="CUETEXT";continue;case"CUETEXT":{const it=rt.indexOf("-->")!==-1;if(!rt||it&&(nt=!0)){a.oncue&&a.cue&&a.oncue(a.cue),a.cue=null,a.state="ID";continue}if(a.cue===null)continue;a.cue.text&&(a.cue.text+=`
`),a.cue.text+=rt}continue;case"BADCUE":rt||(a.state="ID")}}}catch{a.state==="CUETEXT"&&a.cue&&a.oncue&&a.oncue(a.cue),a.cue=null,a.state=a.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const s=this;try{if((s.cue||s.state==="HEADER")&&(s.buffer+=`

`,s.parse()),s.state==="INITIAL"||s.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(a){s.onparsingerror&&s.onparsingerror(a)}return s.onflush&&s.onflush(),this}}const LINEBREAKS=/\r\n|\n\r|\n|\r/g,startsWith=function o(s,a,et=0){return s.slice(et,et+a.length)===a},cueString2millis=function o(s){let a=parseInt(s.slice(-3));const et=parseInt(s.slice(-6,-4)),tt=parseInt(s.slice(-9,-7)),rt=s.length>9?parseInt(s.substring(0,s.indexOf(":"))):0;if(!isFiniteNumber(a)||!isFiniteNumber(et)||!isFiniteNumber(tt)||!isFiniteNumber(rt))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${s}`);return a+=1e3*et,a+=60*1e3*tt,a+=60*60*1e3*rt,a},hash=function o(s){let a=5381,et=s.length;for(;et;)a=a*33^s.charCodeAt(--et);return(a>>>0).toString()};function generateCueId(o,s,a){return hash(o.toString())+hash(s.toString())+hash(a)}const calculateOffset=function o(s,a,et){let tt=s[a],rt=s[tt.prevCC];if(!rt||!rt.new&&tt.new){s.ccOffset=s.presentationOffset=tt.start,tt.new=!1;return}for(;(nt=rt)!=null&&nt.new;){var nt;s.ccOffset+=tt.start-rt.start,tt.new=!1,tt=rt,rt=s[tt.prevCC]}s.presentationOffset=et};function parseWebVTT(o,s,a,et,tt,rt,nt){const it=new VTTParser,st=utf8ArrayToStr(new Uint8Array(o)).trim().replace(LINEBREAKS,`
`).split(`
`),ot=[],at=s?toMpegTsClockFromTimescale(s.baseTime,s.timescale):0;let lt="00:00.000",ct=0,ht=0,ft,dt=!0;it.oncue=function(pt){const gt=a[et];let mt=a.ccOffset;const yt=(ct-at)/9e4;if(gt!=null&&gt.new&&(ht!==void 0?mt=a.ccOffset=gt.start:calculateOffset(a,et,yt)),yt){if(!s){ft=new Error("Missing initPTS for VTT MPEGTS");return}mt=yt-a.presentationOffset}const vt=pt.endTime-pt.startTime,Et=normalizePts((pt.startTime+mt-ht)*9e4,tt*9e4)/9e4;pt.startTime=Math.max(Et,0),pt.endTime=Math.max(Et+vt,0);const xt=pt.text.trim();pt.text=decodeURIComponent(encodeURIComponent(xt)),pt.id||(pt.id=generateCueId(pt.startTime,pt.endTime,xt)),pt.endTime>0&&ot.push(pt)},it.onparsingerror=function(pt){ft=pt},it.onflush=function(){if(ft){nt(ft);return}rt(ot)},st.forEach(pt=>{if(dt)if(startsWith(pt,"X-TIMESTAMP-MAP=")){dt=!1,pt.slice(16).split(",").forEach(gt=>{startsWith(gt,"LOCAL:")?lt=gt.slice(6):startsWith(gt,"MPEGTS:")&&(ct=parseInt(gt.slice(7)))});try{ht=cueString2millis(lt)/1e3}catch(gt){ft=gt}return}else pt===""&&(dt=!1);it.parse(pt+`
`)}),it.flush()}const IMSC1_CODEC="stpp.ttml.im1t",HMSF_REGEX=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,TIME_UNIT_REGEX=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,textAlignToLineAlign={left:"start",center:"center",right:"end",start:"start",end:"end"};function parseIMSC1(o,s,a,et){const tt=findBox(new Uint8Array(o),["mdat"]);if(tt.length===0){et(new Error("Could not parse IMSC1 mdat"));return}const rt=tt.map(it=>utf8ArrayToStr(it)),nt=toTimescaleFromScale(s.baseTime,1,s.timescale);try{rt.forEach(it=>a(parseTTML(it,nt)))}catch(it){et(it)}}function parseTTML(o,s){const tt=new DOMParser().parseFromString(o,"text/xml").getElementsByTagName("tt")[0];if(!tt)throw new Error("Invalid ttml");const rt={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},nt=Object.keys(rt).reduce((lt,ct)=>(lt[ct]=tt.getAttribute(`ttp:${ct}`)||rt[ct],lt),{}),it=tt.getAttribute("xml:space")!=="preserve",st=collectionToDictionary(getElementCollection(tt,"styling","style")),ot=collectionToDictionary(getElementCollection(tt,"layout","region")),at=getElementCollection(tt,"body","[begin]");return[].map.call(at,lt=>{const ct=getTextContent(lt,it);if(!ct||!lt.hasAttribute("begin"))return null;const ht=parseTtmlTime(lt.getAttribute("begin"),nt),ft=parseTtmlTime(lt.getAttribute("dur"),nt);let dt=parseTtmlTime(lt.getAttribute("end"),nt);if(ht===null)throw timestampParsingError(lt);if(dt===null){if(ft===null)throw timestampParsingError(lt);dt=ht+ft}const pt=new VTTCue(ht-s,dt-s,ct);pt.id=generateCueId(pt.startTime,pt.endTime,pt.text);const gt=ot[lt.getAttribute("region")],mt=st[lt.getAttribute("style")],yt=getTtmlStyles(gt,mt,st),{textAlign:vt}=yt;if(vt){const Et=textAlignToLineAlign[vt];Et&&(pt.lineAlign=Et),pt.align=vt}return _extends(pt,yt),pt}).filter(lt=>lt!==null)}function getElementCollection(o,s,a){const et=o.getElementsByTagName(s)[0];return et?[].slice.call(et.querySelectorAll(a)):[]}function collectionToDictionary(o){return o.reduce((s,a)=>{const et=a.getAttribute("xml:id");return et&&(s[et]=a),s},{})}function getTextContent(o,s){return[].slice.call(o.childNodes).reduce((a,et,tt)=>{var rt;return et.nodeName==="br"&&tt?a+`
`:(rt=et.childNodes)!=null&&rt.length?getTextContent(et,s):s?a+et.textContent.trim().replace(/\s+/g," "):a+et.textContent},"")}function getTtmlStyles(o,s,a){const et="http://www.w3.org/ns/ttml#styling";let tt=null;const rt=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],nt=o!=null&&o.hasAttribute("style")?o.getAttribute("style"):null;return nt&&a.hasOwnProperty(nt)&&(tt=a[nt]),rt.reduce((it,st)=>{const ot=getAttributeNS(s,et,st)||getAttributeNS(o,et,st)||getAttributeNS(tt,et,st);return ot&&(it[st]=ot),it},{})}function getAttributeNS(o,s,a){return o&&o.hasAttributeNS(s,a)?o.getAttributeNS(s,a):null}function timestampParsingError(o){return new Error(`Could not parse ttml timestamp ${o}`)}function parseTtmlTime(o,s){if(!o)return null;let a=parseTimeStamp(o);return a===null&&(HMSF_REGEX.test(o)?a=parseHoursMinutesSecondsFrames(o,s):TIME_UNIT_REGEX.test(o)&&(a=parseTimeUnits(o,s))),a}function parseHoursMinutesSecondsFrames(o,s){const a=HMSF_REGEX.exec(o),et=(a[4]|0)+(a[5]|0)/s.subFrameRate;return(a[1]|0)*3600+(a[2]|0)*60+(a[3]|0)+et/s.frameRate}function parseTimeUnits(o,s){const a=TIME_UNIT_REGEX.exec(o),et=Number(a[1]);switch(a[2]){case"h":return et*3600;case"m":return et*60;case"ms":return et*1e3;case"f":return et/s.frameRate;case"t":return et/s.tickRate}return et}class TimelineController{constructor(s){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=newVTTCCs(),this.captionsProperties=void 0,this.hls=s,this.config=s.config,this.Cues=s.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},s.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),s.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),s.on(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),s.on(Events.FRAG_LOADING,this.onFragLoading,this),s.on(Events.FRAG_LOADED,this.onFragLoaded,this),s.on(Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),s.on(Events.FRAG_DECRYPTED,this.onFragDecrypted,this),s.on(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),s.on(Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),s.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:s}=this;s.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),s.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),s.off(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),s.off(Events.FRAG_LOADING,this.onFragLoading,this),s.off(Events.FRAG_LOADED,this.onFragLoaded,this),s.off(Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),s.off(Events.FRAG_DECRYPTED,this.onFragDecrypted,this),s.off(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),s.off(Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),s.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){const s=new OutputFilter(this,"textTrack1"),a=new OutputFilter(this,"textTrack2"),et=new OutputFilter(this,"textTrack3"),tt=new OutputFilter(this,"textTrack4");this.cea608Parser1=new Cea608Parser(1,s,a),this.cea608Parser2=new Cea608Parser(3,et,tt)}}addCues(s,a,et,tt,rt){let nt=!1;for(let it=rt.length;it--;){const st=rt[it],ot=intersection(st[0],st[1],a,et);if(ot>=0&&(st[0]=Math.min(st[0],a),st[1]=Math.max(st[1],et),nt=!0,ot/(et-a)>.5))return}if(nt||rt.push([a,et]),this.config.renderTextTracksNatively){const it=this.captionsTracks[s];this.Cues.newCue(it,a,et,tt)}else{const it=this.Cues.newCue(null,a,et,tt);this.hls.trigger(Events.CUES_PARSED,{type:"captions",cues:it,track:s})}}onInitPtsFound(s,{frag:a,id:et,initPTS:tt,timescale:rt}){const{unparsedVttFrags:nt}=this;et==="main"&&(this.initPTS[a.cc]={baseTime:tt,timescale:rt}),nt.length&&(this.unparsedVttFrags=[],nt.forEach(it=>{this.onFragLoaded(Events.FRAG_LOADED,it)}))}getExistingTrack(s,a){const{media:et}=this;if(et)for(let tt=0;tt<et.textTracks.length;tt++){const rt=et.textTracks[tt];if(canReuseVttTextTrack(rt,{name:s,lang:a,attrs:{}}))return rt}return null}createCaptionsTrack(s){this.config.renderTextTracksNatively?this.createNativeTrack(s):this.createNonNativeTrack(s)}createNativeTrack(s){if(this.captionsTracks[s])return;const{captionsProperties:a,captionsTracks:et,media:tt}=this,{label:rt,languageCode:nt}=a[s],it=this.getExistingTrack(rt,nt);if(it)et[s]=it,clearCurrentCues(et[s]),sendAddTrackEvent(et[s],tt);else{const st=this.createTextTrack("captions",rt,nt);st&&(st[s]=!0,et[s]=st)}}createNonNativeTrack(s){if(this.nonNativeCaptionsTracks[s])return;const a=this.captionsProperties[s];if(!a)return;const et=a.label,tt={_id:s,label:et,kind:"captions",default:a.media?!!a.media.default:!1,closedCaptions:a.media};this.nonNativeCaptionsTracks[s]=tt,this.hls.trigger(Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[tt]})}createTextTrack(s,a,et){const tt=this.media;if(tt)return tt.addTextTrack(s,a,et)}onMediaAttaching(s,a){this.media=a.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:s}=this;Object.keys(s).forEach(a=>{clearCurrentCues(s[a]),delete s[a]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=newVTTCCs(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:s}=this;if(!s)return;const a=s.textTracks;if(a)for(let et=0;et<a.length;et++)clearCurrentCues(a[et])}onSubtitleTracksUpdated(s,a){const et=a.subtitleTracks||[],tt=et.some(rt=>rt.textCodec===IMSC1_CODEC);if(this.config.enableWebVTT||tt&&this.config.enableIMSC1){if(subtitleOptionsIdentical(this.tracks,et)){this.tracks=et;return}if(this.textTracks=[],this.tracks=et,this.config.renderTextTracksNatively){const nt=this.media,it=nt?filterSubtitleTracks(nt.textTracks):null;if(this.tracks.forEach((st,ot)=>{let at;if(it){let lt=null;for(let ct=0;ct<it.length;ct++)if(it[ct]&&canReuseVttTextTrack(it[ct],st)){lt=it[ct],it[ct]=null;break}lt&&(at=lt)}if(at)clearCurrentCues(at);else{const lt=captionsOrSubtitlesFromCharacteristics(st);at=this.createTextTrack(lt,st.name,st.lang),at&&(at.mode="disabled")}at&&this.textTracks.push(at)}),it!=null&&it.length){const st=it.filter(ot=>ot!==null).map(ot=>ot.label);st.length&&logger.warn(`Media element contains unused subtitle tracks: ${st.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const nt=this.tracks.map(it=>({label:it.name,kind:it.type.toLowerCase(),default:it.default,subtitleTrack:it}));this.hls.trigger(Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:nt})}}}onManifestLoaded(s,a){this.config.enableCEA708Captions&&a.captions&&a.captions.forEach(et=>{const tt=/(?:CC|SERVICE)([1-4])/.exec(et.instreamId);if(!tt)return;const rt=`textTrack${tt[1]}`,nt=this.captionsProperties[rt];nt&&(nt.label=et.name,et.lang&&(nt.languageCode=et.lang),nt.media=et)})}closedCaptionsForLevel(s){const a=this.hls.levels[s.level];return a?.attrs["CLOSED-CAPTIONS"]}onFragLoading(s,a){if(this.enabled&&a.frag.type===PlaylistLevelType.MAIN){var et,tt;const{cea608Parser1:rt,cea608Parser2:nt,lastSn:it}=this,{cc:st,sn:ot}=a.frag,at=(et=(tt=a.part)==null?void 0:tt.index)!=null?et:-1;rt&&nt&&(ot!==it+1||ot===it&&at!==this.lastPartIndex+1||st!==this.lastCc)&&(rt.reset(),nt.reset()),this.lastCc=st,this.lastSn=ot,this.lastPartIndex=at}}onFragLoaded(s,a){const{frag:et,payload:tt}=a;if(et.type===PlaylistLevelType.SUBTITLE)if(tt.byteLength){const rt=et.decryptdata,nt="stats"in a;if(rt==null||!rt.encrypted||nt){const it=this.tracks[et.level],st=this.vttCCs;st[et.cc]||(st[et.cc]={start:et.start,prevCC:this.prevCC,new:!0},this.prevCC=et.cc),it&&it.textCodec===IMSC1_CODEC?this._parseIMSC1(et,tt):this._parseVTTs(a)}}else this.hls.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:et,error:new Error("Empty subtitle payload")})}_parseIMSC1(s,a){const et=this.hls;parseIMSC1(a,this.initPTS[s.cc],tt=>{this._appendCues(tt,s.level),et.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:s})},tt=>{logger.log(`Failed to parse IMSC1: ${tt}`),et.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:tt})})}_parseVTTs(s){var a;const{frag:et,payload:tt}=s,{initPTS:rt,unparsedVttFrags:nt}=this,it=rt.length-1;if(!rt[et.cc]&&it===-1){nt.push(s);return}const st=this.hls,ot=(a=et.initSegment)!=null&&a.data?appendUint8Array(et.initSegment.data,new Uint8Array(tt)):tt;parseWebVTT(ot,this.initPTS[et.cc],this.vttCCs,et.cc,et.start,at=>{this._appendCues(at,et.level),st.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:et})},at=>{const lt=at.message==="Missing initPTS for VTT MPEGTS";lt?nt.push(s):this._fallbackToIMSC1(et,tt),logger.log(`Failed to parse VTT cue: ${at}`),!(lt&&it>et.cc)&&st.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:et,error:at})})}_fallbackToIMSC1(s,a){const et=this.tracks[s.level];et.textCodec||parseIMSC1(a,this.initPTS[s.cc],()=>{et.textCodec=IMSC1_CODEC,this._parseIMSC1(s,a)},()=>{et.textCodec="wvtt"})}_appendCues(s,a){const et=this.hls;if(this.config.renderTextTracksNatively){const tt=this.textTracks[a];if(!tt||tt.mode==="disabled")return;s.forEach(rt=>addCueToTrack(tt,rt))}else{const tt=this.tracks[a];if(!tt)return;const rt=tt.default?"default":"subtitles"+a;et.trigger(Events.CUES_PARSED,{type:"subtitles",cues:s,track:rt})}}onFragDecrypted(s,a){const{frag:et}=a;et.type===PlaylistLevelType.SUBTITLE&&this.onFragLoaded(Events.FRAG_LOADED,a)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(s,a){this.initCea608Parsers();const{cea608Parser1:et,cea608Parser2:tt}=this;if(!this.enabled||!et||!tt)return;const{frag:rt,samples:nt}=a;if(!(rt.type===PlaylistLevelType.MAIN&&this.closedCaptionsForLevel(rt)==="NONE"))for(let it=0;it<nt.length;it++){const st=nt[it].bytes;if(st){const ot=this.extractCea608Data(st);et.addData(nt[it].pts,ot[0]),tt.addData(nt[it].pts,ot[1])}}}onBufferFlushing(s,{startOffset:a,endOffset:et,endOffsetSubtitles:tt,type:rt}){const{media:nt}=this;if(!(!nt||nt.currentTime<et)){if(!rt||rt==="video"){const{captionsTracks:it}=this;Object.keys(it).forEach(st=>removeCuesInRange(it[st],a,et))}if(this.config.renderTextTracksNatively&&a===0&&tt!==void 0){const{textTracks:it}=this;Object.keys(it).forEach(st=>removeCuesInRange(it[st],a,tt))}}}extractCea608Data(s){const a=[[],[]],et=s[0]&31;let tt=2;for(let rt=0;rt<et;rt++){const nt=s[tt++],it=127&s[tt++],st=127&s[tt++];if(it===0&&st===0)continue;if((4&nt)!==0){const at=3&nt;(at===0||at===1)&&(a[at].push(it),a[at].push(st))}}return a}}function captionsOrSubtitlesFromCharacteristics(o){return o.characteristics&&/transcribes-spoken-dialog/gi.test(o.characteristics)&&/describes-music-and-sound/gi.test(o.characteristics)?"captions":"subtitles"}function canReuseVttTextTrack(o,s){return!!o&&o.kind===captionsOrSubtitlesFromCharacteristics(s)&&subtitleTrackMatchesTextTrack(s,o)}function intersection(o,s,a,et){return Math.min(s,et)-Math.max(o,a)}function newVTTCCs(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class CapLevelController{constructor(s){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=s,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(s){this.streamController=s}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:s}=this;s.on(Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),s.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),s.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),s.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),s.on(Events.BUFFER_CODECS,this.onBufferCodecs,this),s.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:s}=this;s.off(Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),s.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),s.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),s.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),s.off(Events.BUFFER_CODECS,this.onBufferCodecs,this),s.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(s,a){const et=this.hls.levels[a.droppedLevel];this.isLevelAllowed(et)&&this.restrictedLevels.push({bitrate:et.bitrate,height:et.height,width:et.width})}onMediaAttaching(s,a){this.media=a.media instanceof HTMLVideoElement?a.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(s,a){const et=this.hls;this.restrictedLevels=[],this.firstLevel=a.firstLevel,et.config.capLevelToPlayerSize&&a.video&&this.startCapping()}onLevelsUpdated(s,a){this.timer&&isFiniteNumber(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(s,a){this.hls.config.capLevelToPlayerSize&&a.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const s=this.hls.levels;if(s.length){const a=this.hls,et=this.getMaxLevel(s.length-1);et!==this.autoLevelCapping&&logger.log(`Setting autoLevelCapping to ${et}: ${s[et].height}p@${s[et].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),a.autoLevelCapping=et,a.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=a.autoLevelCapping}}}getMaxLevel(s){const a=this.hls.levels;if(!a.length)return-1;const et=a.filter((tt,rt)=>this.isLevelAllowed(tt)&&rt<=s);return this.clientRect=null,CapLevelController.getMaxLevelByMediaSize(et,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const s=this.media,a={width:0,height:0};if(s){const et=s.getBoundingClientRect();a.width=et.width,a.height=et.height,!a.width&&!a.height&&(a.width=et.right-et.left||s.width||0,a.height=et.bottom-et.top||s.height||0)}return this.clientRect=a,a}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let s=1;if(!this.hls.config.ignoreDevicePixelRatio)try{s=self.devicePixelRatio}catch{}return s}isLevelAllowed(s){return!this.restrictedLevels.some(et=>s.bitrate===et.bitrate&&s.width===et.width&&s.height===et.height)}static getMaxLevelByMediaSize(s,a,et){if(!(s!=null&&s.length))return-1;const tt=(it,st)=>st?it.width!==st.width||it.height!==st.height:!0;let rt=s.length-1;const nt=Math.max(a,et);for(let it=0;it<s.length;it+=1){const st=s[it];if((st.width>=nt||st.height>=nt)&&tt(st,s[it+1])){rt=it;break}}return rt}}class FPSController{constructor(s){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=s,this.registerListeners()}setStreamController(s){this.streamController=s}registerListeners(){this.hls.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(s,a){const et=this.hls.config;if(et.capLevelOnFPSDrop){const tt=a.media instanceof self.HTMLVideoElement?a.media:null;this.media=tt,tt&&typeof tt.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),et.fpsDroppedMonitoringPeriod)}}checkFPS(s,a,et){const tt=performance.now();if(a){if(this.lastTime){const rt=tt-this.lastTime,nt=et-this.lastDroppedFrames,it=a-this.lastDecodedFrames,st=1e3*nt/rt,ot=this.hls;if(ot.trigger(Events.FPS_DROP,{currentDropped:nt,currentDecoded:it,totalDroppedFrames:et}),st>0&&nt>ot.config.fpsDroppedMonitoringThreshold*it){let at=ot.currentLevel;logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+at),at>0&&(ot.autoLevelCapping===-1||ot.autoLevelCapping>=at)&&(at=at-1,ot.trigger(Events.FPS_DROP_LEVEL_CAPPING,{level:at,droppedLevel:ot.currentLevel}),ot.autoLevelCapping=at,this.streamController.nextLevelSwitch())}}this.lastTime=tt,this.lastDroppedFrames=et,this.lastDecodedFrames=a}}checkFPSInterval(){const s=this.media;if(s)if(this.isVideoPlaybackQualityAvailable){const a=s.getVideoPlaybackQuality();this.checkFPS(s,a.totalVideoFrames,a.droppedVideoFrames)}else this.checkFPS(s,s.webkitDecodedFrameCount,s.webkitDroppedFrameCount)}}const LOGGER_PREFIX="[eme]";class EMEController{constructor(s){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=EMEController.CDMCleanupPromise?[EMEController.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=logger.debug.bind(logger,LOGGER_PREFIX),this.log=logger.log.bind(logger,LOGGER_PREFIX),this.warn=logger.warn.bind(logger,LOGGER_PREFIX),this.error=logger.error.bind(logger,LOGGER_PREFIX),this.hls=s,this.config=s.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const s=this.config;s.requestMediaKeySystemAccessFunc=null,s.licenseXhrSetup=s.licenseResponseCallback=void 0,s.drmSystems=s.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(s){const{drmSystems:a,widevineLicenseUrl:et}=this.config,tt=a[s];if(tt)return tt.licenseUrl;if(s===KeySystems.WIDEVINE&&et)return et;throw new Error(`no license server URL configured for key-system "${s}"`)}getServerCertificateUrl(s){const{drmSystems:a}=this.config,et=a[s];if(et)return et.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${s}"]`)}attemptKeySystemAccess(s){const a=this.hls.levels,et=(nt,it,st)=>!!nt&&st.indexOf(nt)===it,tt=a.map(nt=>nt.audioCodec).filter(et),rt=a.map(nt=>nt.videoCodec).filter(et);return tt.length+rt.length===0&&rt.push("avc1.42e01e"),new Promise((nt,it)=>{const st=ot=>{const at=ot.shift();this.getMediaKeysPromise(at,tt,rt).then(lt=>nt({keySystem:at,mediaKeys:lt})).catch(lt=>{ot.length?st(ot):lt instanceof EMEKeyError?it(lt):it(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_ACCESS,error:lt,fatal:!0},lt.message))})};st(s)})}requestMediaKeySystemAccess(s,a){const{requestMediaKeySystemAccessFunc:et}=this.config;if(typeof et!="function"){let tt=`Configured requestMediaKeySystemAccess is not a function ${et}`;return requestMediaKeySystemAccess===null&&self.location.protocol==="http:"&&(tt=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(tt))}return et(s,a)}getMediaKeysPromise(s,a,et){const tt=getSupportedMediaKeySystemConfigurations(s,a,et,this.config.drmSystemOptions),rt=this.keySystemAccessPromises[s];let nt=rt?.keySystemAccess;if(!nt){this.log(`Requesting encrypted media "${s}" key-system access with config: ${JSON.stringify(tt)}`),nt=this.requestMediaKeySystemAccess(s,tt);const it=this.keySystemAccessPromises[s]={keySystemAccess:nt};return nt.catch(st=>{this.log(`Failed to obtain access to key-system "${s}": ${st}`)}),nt.then(st=>{this.log(`Access for key-system "${st.keySystem}" obtained`);const ot=this.fetchServerCertificate(s);return this.log(`Create media-keys for "${s}"`),it.mediaKeys=st.createMediaKeys().then(at=>(this.log(`Media-keys created for "${s}"`),ot.then(lt=>lt?this.setMediaKeysServerCertificate(at,s,lt):at))),it.mediaKeys.catch(at=>{this.error(`Failed to create media-keys for "${s}"}: ${at}`)}),it.mediaKeys})}return nt.then(()=>rt.mediaKeys)}createMediaKeySessionContext({decryptdata:s,keySystem:a,mediaKeys:et}){this.log(`Creating key-system session "${a}" keyId: ${Hex.hexDump(s.keyId||[])}`);const tt=et.createSession(),rt={decryptdata:s,keySystem:a,mediaKeys:et,mediaKeysSession:tt,keyStatus:"status-pending"};return this.mediaKeySessions.push(rt),rt}renewKeySession(s){const a=s.decryptdata;if(a.pssh){const et=this.createMediaKeySessionContext(s),tt=this.getKeyIdString(a),rt="cenc";this.keyIdToKeySessionPromise[tt]=this.generateRequestWithPreferredKeySession(et,rt,a.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(s)}getKeyIdString(s){if(!s)throw new Error("Could not read keyId of undefined decryptdata");if(s.keyId===null)throw new Error("keyId is null");return Hex.hexDump(s.keyId)}updateKeySession(s,a){var et;const tt=s.mediaKeysSession;return this.log(`Updating key-session "${tt.sessionId}" for keyID ${Hex.hexDump(((et=s.decryptdata)==null?void 0:et.keyId)||[])}
      } (data length: ${a&&a.byteLength})`),tt.update(a)}selectKeySystemFormat(s){const a=Object.keys(s.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${s.sn} ${s.type}: ${s.level}) key formats ${a.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(a)),this.keyFormatPromise}getKeyFormatPromise(s){return new Promise((a,et)=>{const tt=getKeySystemsForConfig(this.config),rt=s.map(keySystemFormatToKeySystemDomain).filter(nt=>!!nt&&tt.indexOf(nt)!==-1);return this.getKeySystemSelectionPromise(rt).then(({keySystem:nt})=>{const it=keySystemDomainToKeySystemFormat(nt);it?a(it):et(new Error(`Unable to find format for key-system "${nt}"`))}).catch(et)})}loadKey(s){const a=s.keyInfo.decryptdata,et=this.getKeyIdString(a),tt=`(keyId: ${et} format: "${a.keyFormat}" method: ${a.method} uri: ${a.uri})`;this.log(`Starting session for key ${tt}`);let rt=this.keyIdToKeySessionPromise[et];return rt||(rt=this.keyIdToKeySessionPromise[et]=this.getKeySystemForKeyPromise(a).then(({keySystem:nt,mediaKeys:it})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${s.frag.sn} ${s.frag.type}: ${s.frag.level} using key ${tt}`),this.attemptSetMediaKeys(nt,it).then(()=>{this.throwIfDestroyed();const st=this.createMediaKeySessionContext({keySystem:nt,mediaKeys:it,decryptdata:a});return this.generateRequestWithPreferredKeySession(st,"cenc",a.pssh,"playlist-key")}))),rt.catch(nt=>this.handleError(nt))),rt}throwIfDestroyed(s="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(s){this.hls&&(this.error(s.message),s instanceof EMEKeyError?this.hls.trigger(Events.ERROR,s.data):this.hls.trigger(Events.ERROR,{type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_KEYS,error:s,fatal:!0}))}getKeySystemForKeyPromise(s){const a=this.getKeyIdString(s),et=this.keyIdToKeySessionPromise[a];if(!et){const tt=keySystemFormatToKeySystemDomain(s.keyFormat),rt=tt?[tt]:getKeySystemsForConfig(this.config);return this.attemptKeySystemAccess(rt)}return et}getKeySystemSelectionPromise(s){if(s.length||(s=getKeySystemsForConfig(this.config)),s.length===0)throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(s)}_onMediaEncrypted(s){const{initDataType:a,initData:et}=s;if(this.debug(`"${s.type}" event: init data type: "${a}"`),et===null)return;let tt,rt;if(a==="sinf"&&this.config.drmSystems[KeySystems.FAIRPLAY]){const at=bin2str(new Uint8Array(et));try{const lt=base64Decode(JSON.parse(at).sinf),ct=parseSinf(new Uint8Array(lt));if(!ct)return;tt=ct.subarray(8,24),rt=KeySystems.FAIRPLAY}catch{this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{const at=parsePssh(et);if(at===null)return;at.version===0&&at.systemId===KeySystemIds.WIDEVINE&&at.data&&(tt=at.data.subarray(8,24)),rt=keySystemIdToKeySystemDomain(at.systemId)}if(!rt||!tt)return;const nt=Hex.hexDump(tt),{keyIdToKeySessionPromise:it,mediaKeySessions:st}=this;let ot=it[nt];for(let at=0;at<st.length;at++){const lt=st[at],ct=lt.decryptdata;if(ct.pssh||!ct.keyId)continue;const ht=Hex.hexDump(ct.keyId);if(nt===ht||ct.uri.replace(/-/g,"").indexOf(nt)!==-1){ot=it[ht],delete it[ht],ct.pssh=new Uint8Array(et),ct.keyId=tt,ot=it[nt]=ot.then(()=>this.generateRequestWithPreferredKeySession(lt,a,et,"encrypted-event-key-match"));break}}ot||(ot=it[nt]=this.getKeySystemSelectionPromise([rt]).then(({keySystem:at,mediaKeys:lt})=>{var ct;this.throwIfDestroyed();const ht=new LevelKey("ISO-23001-7",nt,(ct=keySystemDomainToKeySystemFormat(at))!=null?ct:"");return ht.pssh=new Uint8Array(et),ht.keyId=tt,this.attemptSetMediaKeys(at,lt).then(()=>{this.throwIfDestroyed();const ft=this.createMediaKeySessionContext({decryptdata:ht,keySystem:at,mediaKeys:lt});return this.generateRequestWithPreferredKeySession(ft,a,et,"encrypted-event-no-match")})})),ot.catch(at=>this.handleError(at))}_onWaitingForKey(s){this.log(`"${s.type}" event`)}attemptSetMediaKeys(s,a){const et=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${s}"`);const tt=Promise.all(et).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(a)});return this.setMediaKeysQueue.push(tt),tt.then(()=>{this.log(`Media-keys set for "${s}"`),et.push(tt),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(rt=>et.indexOf(rt)===-1)})}generateRequestWithPreferredKeySession(s,a,et,tt){var rt,nt;const it=(rt=this.config.drmSystems)==null||(nt=rt[s.keySystem])==null?void 0:nt.generateRequest;if(it)try{const ft=it.call(this.hls,a,et,s);if(!ft)throw new Error("Invalid response from configured generateRequest filter");a=ft.initDataType,et=s.decryptdata.pssh=ft.initData?new Uint8Array(ft.initData):null}catch(ft){var st;if(this.warn(ft.message),(st=this.hls)!=null&&st.config.debug)throw ft}if(et===null)return this.log(`Skipping key-session request for "${tt}" (no initData)`),Promise.resolve(s);const ot=this.getKeyIdString(s.decryptdata);this.log(`Generating key-session request for "${tt}": ${ot} (init data type: ${a} length: ${et?et.byteLength:null})`);const at=new EventEmitter,lt=s._onmessage=ft=>{const dt=s.mediaKeysSession;if(!dt){at.emit("error",new Error("invalid state"));return}const{messageType:pt,message:gt}=ft;this.log(`"${pt}" message event for session "${dt.sessionId}" message size: ${gt.byteLength}`),pt==="license-request"||pt==="license-renewal"?this.renewLicense(s,gt).catch(mt=>{this.handleError(mt),at.emit("error",mt)}):pt==="license-release"?s.keySystem===KeySystems.FAIRPLAY&&(this.updateKeySession(s,strToUtf8array("acknowledged")),this.removeSession(s)):this.warn(`unhandled media key message type "${pt}"`)},ct=s._onkeystatuseschange=ft=>{if(!s.mediaKeysSession){at.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(s);const pt=s.keyStatus;at.emit("keyStatus",pt),pt==="expired"&&(this.warn(`${s.keySystem} expired for key ${ot}`),this.renewKeySession(s))};s.mediaKeysSession.addEventListener("message",lt),s.mediaKeysSession.addEventListener("keystatuseschange",ct);const ht=new Promise((ft,dt)=>{at.on("error",dt),at.on("keyStatus",pt=>{pt.startsWith("usable")?ft():pt==="output-restricted"?dt(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):pt==="internal-error"?dt(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${pt}"`)):pt==="expired"?dt(new Error("key expired while generating request")):this.warn(`unhandled key status change "${pt}"`)})});return s.mediaKeysSession.generateRequest(a,et).then(()=>{var ft;this.log(`Request generated for key-session "${(ft=s.mediaKeysSession)==null?void 0:ft.sessionId}" keyId: ${ot}`)}).catch(ft=>{throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_SESSION,error:ft,fatal:!1},`Error generating key-session request: ${ft}`)}).then(()=>ht).catch(ft=>{throw at.removeAllListeners(),this.removeSession(s),ft}).then(()=>(at.removeAllListeners(),s))}onKeyStatusChange(s){s.mediaKeysSession.keyStatuses.forEach((a,et)=>{this.log(`key status change "${a}" for keyStatuses keyId: ${Hex.hexDump("buffer"in et?new Uint8Array(et.buffer,et.byteOffset,et.byteLength):new Uint8Array(et))} session keyId: ${Hex.hexDump(new Uint8Array(s.decryptdata.keyId||[]))} uri: ${s.decryptdata.uri}`),s.keyStatus=a})}fetchServerCertificate(s){const a=this.config,et=a.loader,tt=new et(a),rt=this.getServerCertificateUrl(s);return rt?(this.log(`Fetching server certificate for "${s}"`),new Promise((nt,it)=>{const st={responseType:"arraybuffer",url:rt},ot=a.certLoadPolicy.default,at={loadPolicy:ot,timeout:ot.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},lt={onSuccess:(ct,ht,ft,dt)=>{nt(ct.data)},onError:(ct,ht,ft,dt)=>{it(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:ft,response:_objectSpread2({url:st.url,data:void 0},ct)},`"${s}" certificate request failed (${rt}). Status: ${ct.code} (${ct.text})`))},onTimeout:(ct,ht,ft)=>{it(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:ft,response:{url:st.url,data:void 0}},`"${s}" certificate request timed out (${rt})`))},onAbort:(ct,ht,ft)=>{it(new Error("aborted"))}};tt.load(st,at,lt)})):Promise.resolve()}setMediaKeysServerCertificate(s,a,et){return new Promise((tt,rt)=>{s.setServerCertificate(et).then(nt=>{this.log(`setServerCertificate ${nt?"success":"not supported by CDM"} (${et?.byteLength}) on "${a}"`),tt(s)}).catch(nt=>{rt(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:nt,fatal:!0},nt.message))})})}renewLicense(s,a){return this.requestLicense(s,new Uint8Array(a)).then(et=>this.updateKeySession(s,new Uint8Array(et)).catch(tt=>{throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:tt,fatal:!0},tt.message)}))}unpackPlayReadyKeyMessage(s,a){const et=String.fromCharCode.apply(null,new Uint16Array(a.buffer));if(!et.includes("PlayReadyKeyMessage"))return s.setRequestHeader("Content-Type","text/xml; charset=utf-8"),a;const tt=new DOMParser().parseFromString(et,"application/xml"),rt=tt.querySelectorAll("HttpHeader");if(rt.length>0){let at;for(let lt=0,ct=rt.length;lt<ct;lt++){var nt,it;at=rt[lt];const ht=(nt=at.querySelector("name"))==null?void 0:nt.textContent,ft=(it=at.querySelector("value"))==null?void 0:it.textContent;ht&&ft&&s.setRequestHeader(ht,ft)}}const st=tt.querySelector("Challenge"),ot=st?.textContent;if(!ot)throw new Error("Cannot find <Challenge> in key message");return strToUtf8array(atob(ot))}setupLicenseXHR(s,a,et,tt){const rt=this.config.licenseXhrSetup;return rt?Promise.resolve().then(()=>{if(!et.decryptdata)throw new Error("Key removed");return rt.call(this.hls,s,a,et,tt)}).catch(nt=>{if(!et.decryptdata)throw nt;return s.open("POST",a,!0),rt.call(this.hls,s,a,et,tt)}).then(nt=>(s.readyState||s.open("POST",a,!0),{xhr:s,licenseChallenge:nt||tt})):(s.open("POST",a,!0),Promise.resolve({xhr:s,licenseChallenge:tt}))}requestLicense(s,a){const et=this.config.keyLoadPolicy.default;return new Promise((tt,rt)=>{const nt=this.getLicenseServerUrl(s.keySystem);this.log(`Sending license request to URL: ${nt}`);const it=new XMLHttpRequest;it.responseType="arraybuffer",it.onreadystatechange=()=>{if(!this.hls||!s.mediaKeysSession)return rt(new Error("invalid state"));if(it.readyState===4)if(it.status===200){this._requestLicenseFailureCount=0;let st=it.response;this.log(`License received ${st instanceof ArrayBuffer?st.byteLength:st}`);const ot=this.config.licenseResponseCallback;if(ot)try{st=ot.call(this.hls,it,nt,s)}catch(at){this.error(at)}tt(st)}else{const st=et.errorRetry,ot=st?st.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>ot||it.status>=400&&it.status<500)rt(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:it,response:{url:nt,data:void 0,code:it.status,text:it.statusText}},`License Request XHR failed (${nt}). Status: ${it.status} (${it.statusText})`));else{const at=ot-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${at} attempts left`),this.requestLicense(s,a).then(tt,rt)}}},s.licenseXhr&&s.licenseXhr.readyState!==XMLHttpRequest.DONE&&s.licenseXhr.abort(),s.licenseXhr=it,this.setupLicenseXHR(it,nt,s,a).then(({xhr:st,licenseChallenge:ot})=>{s.keySystem==KeySystems.PLAYREADY&&(ot=this.unpackPlayReadyKeyMessage(st,ot)),st.send(ot)})})}onMediaAttached(s,a){if(!this.config.emeEnabled)return;const et=a.media;this.media=et,et.addEventListener("encrypted",this.onMediaEncrypted),et.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const s=this.media,a=this.mediaKeySessions;s&&(s.removeEventListener("encrypted",this.onMediaEncrypted),s.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},LevelKey.clearKeyUriToKeyIdMap();const et=a.length;EMEController.CDMCleanupPromise=Promise.all(a.map(tt=>this.removeSession(tt)).concat(s?.setMediaKeys(null).catch(tt=>{this.log(`Could not clear media keys: ${tt}`)}))).then(()=>{et&&(this.log("finished closing key sessions and clearing media keys"),a.length=0)}).catch(tt=>{this.log(`Could not close sessions and clear media keys: ${tt}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(s,{sessionKeys:a}){if(!(!a||!this.config.emeEnabled)&&!this.keyFormatPromise){const et=a.reduce((tt,rt)=>(tt.indexOf(rt.keyFormat)===-1&&tt.push(rt.keyFormat),tt),[]);this.log(`Selecting key-system from session-keys ${et.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(et)}}removeSession(s){const{mediaKeysSession:a,licenseXhr:et}=s;if(a){this.log(`Remove licenses and keys and close session ${a.sessionId}`),s._onmessage&&(a.removeEventListener("message",s._onmessage),s._onmessage=void 0),s._onkeystatuseschange&&(a.removeEventListener("keystatuseschange",s._onkeystatuseschange),s._onkeystatuseschange=void 0),et&&et.readyState!==XMLHttpRequest.DONE&&et.abort(),s.mediaKeysSession=s.decryptdata=s.licenseXhr=void 0;const tt=this.mediaKeySessions.indexOf(s);return tt>-1&&this.mediaKeySessions.splice(tt,1),a.remove().catch(rt=>{this.log(`Could not remove session: ${rt}`)}).then(()=>a.close()).catch(rt=>{this.log(`Could not close session: ${rt}`)})}}}EMEController.CDMCleanupPromise=void 0;class EMEKeyError extends Error{constructor(s,a){super(a),this.data=void 0,s.error||(s.error=new Error(a)),this.data=s,s.err=s.error}}var CmObjectType;(function(o){o.MANIFEST="m",o.AUDIO="a",o.VIDEO="v",o.MUXED="av",o.INIT="i",o.CAPTION="c",o.TIMED_TEXT="tt",o.KEY="k",o.OTHER="o"})(CmObjectType||(CmObjectType={}));var CmStreamingFormat;(function(o){o.DASH="d",o.HLS="h",o.SMOOTH="s",o.OTHER="o"})(CmStreamingFormat||(CmStreamingFormat={}));var CmcdHeaderField;(function(o){o.OBJECT="CMCD-Object",o.REQUEST="CMCD-Request",o.SESSION="CMCD-Session",o.STATUS="CMCD-Status"})(CmcdHeaderField||(CmcdHeaderField={}));const CmcdHeaderMap={[CmcdHeaderField.OBJECT]:["br","d","ot","tb"],[CmcdHeaderField.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[CmcdHeaderField.SESSION]:["cid","pr","sf","sid","st","v"],[CmcdHeaderField.STATUS]:["bs","rtp"]};class SfItem{constructor(s,a){this.value=void 0,this.params=void 0,Array.isArray(s)&&(s=s.map(et=>et instanceof SfItem?et:new SfItem(et))),this.value=s,this.params=a}}class SfToken{constructor(s){this.description=void 0,this.description=s}}const DICT="Dict";function format(o){return Array.isArray(o)?JSON.stringify(o):o instanceof Map?"Map{}":o instanceof Set?"Set{}":typeof o=="object"?JSON.stringify(o):String(o)}function throwError(o,s,a,et){return new Error(`failed to ${o} "${format(s)}" as ${a}`,{cause:et})}const BARE_ITEM="Bare Item",BOOLEAN="Boolean",BYTES="Byte Sequence",DECIMAL="Decimal",INTEGER="Integer";function isInvalidInt(o){return o<-999999999999999||999999999999999<o}const STRING_REGEX=/[\x00-\x1f\x7f]+/,TOKEN="Token",KEY="Key";function serializeError(o,s,a){return throwError("serialize",o,s,a)}function serializeBoolean(o){if(typeof o!="boolean")throw serializeError(o,BOOLEAN);return o?"?1":"?0"}function base64encode(o){return btoa(String.fromCharCode(...o))}function serializeByteSequence(o){if(ArrayBuffer.isView(o)===!1)throw serializeError(o,BYTES);return`:${base64encode(o)}:`}function serializeInteger(o){if(isInvalidInt(o))throw serializeError(o,INTEGER);return o.toString()}function serializeDate(o){return`@${serializeInteger(o.getTime()/1e3)}`}function roundToEven(o,s){if(o<0)return-roundToEven(-o,s);const a=Math.pow(10,s);if(Math.abs(o*a%1-.5)<Number.EPSILON){const tt=Math.floor(o*a);return(tt%2===0?tt:tt+1)/a}else return Math.round(o*a)/a}function serializeDecimal(o){const s=roundToEven(o,3);if(Math.floor(Math.abs(s)).toString().length>12)throw serializeError(o,DECIMAL);const a=s.toString();return a.includes(".")?a:`${a}.0`}const STRING="String";function serializeString(o){if(STRING_REGEX.test(o))throw serializeError(o,STRING);return`"${o.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function symbolToStr(o){return o.description||o.toString().slice(7,-1)}function serializeToken(o){const s=symbolToStr(o);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(s)===!1)throw serializeError(s,TOKEN);return s}function serializeBareItem(o){switch(typeof o){case"number":if(!isFiniteNumber(o))throw serializeError(o,BARE_ITEM);return Number.isInteger(o)?serializeInteger(o):serializeDecimal(o);case"string":return serializeString(o);case"symbol":return serializeToken(o);case"boolean":return serializeBoolean(o);case"object":if(o instanceof Date)return serializeDate(o);if(o instanceof Uint8Array)return serializeByteSequence(o);if(o instanceof SfToken)return serializeToken(o);default:throw serializeError(o,BARE_ITEM)}}function serializeKey(o){if(/^[a-z*][a-z0-9\-_.*]*$/.test(o)===!1)throw serializeError(o,KEY);return o}function serializeParams(o){return o==null?"":Object.entries(o).map(([s,a])=>a===!0?`;${serializeKey(s)}`:`;${serializeKey(s)}=${serializeBareItem(a)}`).join("")}function serializeItem(o){return o instanceof SfItem?`${serializeBareItem(o.value)}${serializeParams(o.params)}`:serializeBareItem(o)}function serializeInnerList(o){return`(${o.value.map(serializeItem).join(" ")})${serializeParams(o.params)}`}function serializeDict(o,s={whitespace:!0}){if(typeof o!="object")throw serializeError(o,DICT);const a=o instanceof Map?o.entries():Object.entries(o),et=s!=null&&s.whitespace?" ":"";return Array.from(a).map(([tt,rt])=>{rt instanceof SfItem||(rt=new SfItem(rt));let nt=serializeKey(tt);return rt.value===!0?nt+=serializeParams(rt.params):(nt+="=",Array.isArray(rt.value)?nt+=serializeInnerList(rt):nt+=serializeItem(rt)),nt}).join(`,${et}`)}function encodeSfDict(o,s){return serializeDict(o,s)}const isTokenField=o=>o==="ot"||o==="sf"||o==="st",isValid=o=>typeof o=="number"?isFiniteNumber(o):o!=null&&o!==""&&o!==!1;function urlToRelativePath(o,s){const a=new URL(o),et=new URL(s);if(a.origin!==et.origin)return o;const tt=a.pathname.split("/").slice(1),rt=et.pathname.split("/").slice(1,-1);for(;tt[0]===rt[0];)tt.shift(),rt.shift();for(;rt.length;)rt.shift(),tt.unshift("..");return tt.join("/")}function uuid(){try{return crypto.randomUUID()}catch{try{const s=URL.createObjectURL(new Blob),a=s.toString();return URL.revokeObjectURL(s),a.slice(a.lastIndexOf("/")+1)}catch{let a=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,tt=>{const rt=(a+Math.random()*16)%16|0;return a=Math.floor(a/16),(tt=="x"?rt:rt&3|8).toString(16)})}}}const toRounded=o=>Math.round(o),toUrlSafe=(o,s)=>(s!=null&&s.baseUrl&&(o=urlToRelativePath(o,s.baseUrl)),encodeURIComponent(o)),toHundred=o=>toRounded(o/100)*100,CmcdFormatters={br:toRounded,d:toRounded,bl:toHundred,dl:toHundred,mtp:toHundred,nor:toUrlSafe,rtp:toHundred,tb:toRounded};function processCmcd(o,s){const a={};if(o==null||typeof o!="object")return a;const et=Object.keys(o).sort(),tt=_extends({},CmcdFormatters,s?.formatters),rt=s?.filter;return et.forEach(nt=>{if(rt!=null&&rt(nt))return;let it=o[nt];const st=tt[nt];st&&(it=st(it,s)),!(nt==="v"&&it===1)&&(nt=="pr"&&it===1||isValid(it)&&(isTokenField(nt)&&typeof it=="string"&&(it=new SfToken(it)),a[nt]=it))}),a}function encodeCmcd(o,s={}){return o?encodeSfDict(processCmcd(o,s),_extends({whitespace:!1},s)):""}function toCmcdHeaders(o,s={}){if(!o)return{};const a=Object.entries(o),et=Object.entries(CmcdHeaderMap).concat(Object.entries(s?.customHeaderMap||{})),tt=a.reduce((rt,nt)=>{var it,st;const[ot,at]=nt,lt=((it=et.find(ct=>ct[1].includes(ot)))==null?void 0:it[0])||CmcdHeaderField.REQUEST;return(st=rt[lt])!=null||(rt[lt]={}),rt[lt][ot]=at,rt},{});return Object.entries(tt).reduce((rt,[nt,it])=>(rt[nt]=encodeCmcd(it,s),rt),{})}function appendCmcdHeaders(o,s,a){return _extends(o,toCmcdHeaders(s,a))}const CMCD_PARAM="CMCD";function toCmcdQuery(o,s={}){if(!o)return"";const a=encodeCmcd(o,s);return`${CMCD_PARAM}=${encodeURIComponent(a)}`}const REGEX=/CMCD=[^&#]+/;function appendCmcdQuery(o,s,a){const et=toCmcdQuery(s,a);if(!et)return o;if(REGEX.test(o))return o.replace(REGEX,et);const tt=o.includes("?")?"&":"?";return`${o}${tt}${et}`}class CMCDController{constructor(s){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=tt=>{try{this.apply(tt,{ot:CmObjectType.MANIFEST,su:!this.initialized})}catch(rt){logger.warn("Could not generate manifest CMCD data.",rt)}},this.applyFragmentData=tt=>{try{const rt=tt.frag,nt=this.hls.levels[rt.level],it=this.getObjectType(rt),st={d:rt.duration*1e3,ot:it};(it===CmObjectType.VIDEO||it===CmObjectType.AUDIO||it==CmObjectType.MUXED)&&(st.br=nt.bitrate/1e3,st.tb=this.getTopBandwidth(it)/1e3,st.bl=this.getBufferLength(it)),this.apply(tt,st)}catch(rt){logger.warn("Could not generate segment CMCD data.",rt)}},this.hls=s;const a=this.config=s.config,{cmcd:et}=a;et!=null&&(a.pLoader=this.createPlaylistLoader(),a.fLoader=this.createFragmentLoader(),this.sid=et.sessionId||uuid(),this.cid=et.contentId,this.useHeaders=et.useHeaders===!0,this.includeKeys=et.includeKeys,this.registerListeners())}registerListeners(){const s=this.hls;s.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.on(Events.MEDIA_DETACHED,this.onMediaDetached,this),s.on(Events.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const s=this.hls;s.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.off(Events.MEDIA_DETACHED,this.onMediaDetached,this),s.off(Events.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null}onMediaAttached(s,a){this.media=a.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(s,a){var et,tt;this.audioBuffer=(et=a.tracks.audio)==null?void 0:et.buffer,this.videoBuffer=(tt=a.tracks.video)==null?void 0:tt.buffer}createData(){var s;return{v:1,sf:CmStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(s=this.media)==null?void 0:s.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(s,a={}){_extends(a,this.createData());const et=a.ot===CmObjectType.INIT||a.ot===CmObjectType.VIDEO||a.ot===CmObjectType.MUXED;this.starved&&et&&(a.bs=!0,a.su=!0,this.starved=!1),a.su==null&&(a.su=this.buffering);const{includeKeys:tt}=this;tt&&(a=Object.keys(a).reduce((rt,nt)=>(tt.includes(nt)&&(rt[nt]=a[nt]),rt),{})),this.useHeaders?(s.headers||(s.headers={}),appendCmcdHeaders(s.headers,a)):s.url=appendCmcdQuery(s.url,a)}getObjectType(s){const{type:a}=s;if(a==="subtitle")return CmObjectType.TIMED_TEXT;if(s.sn==="initSegment")return CmObjectType.INIT;if(a==="audio")return CmObjectType.AUDIO;if(a==="main")return this.hls.audioTracks.length?CmObjectType.VIDEO:CmObjectType.MUXED}getTopBandwidth(s){let a=0,et;const tt=this.hls;if(s===CmObjectType.AUDIO)et=tt.audioTracks;else{const rt=tt.maxAutoLevel,nt=rt>-1?rt+1:tt.levels.length;et=tt.levels.slice(0,nt)}for(const rt of et)rt.bitrate>a&&(a=rt.bitrate);return a>0?a:NaN}getBufferLength(s){const a=this.hls.media,et=s===CmObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return!et||!a?NaN:BufferHelper.bufferInfo(et,a.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:s}=this.config,a=this.applyPlaylistData,et=s||this.config.loader;return class{constructor(rt){this.loader=void 0,this.loader=new et(rt)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(rt,nt,it){a(rt),this.loader.load(rt,nt,it)}}}createFragmentLoader(){const{fLoader:s}=this.config,a=this.applyFragmentData,et=s||this.config.loader;return class{constructor(rt){this.loader=void 0,this.loader=new et(rt)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(rt,nt,it){a(rt),this.loader.load(rt,nt,it)}}}}const PATHWAY_PENALTY_DURATION_MS=3e5;class ContentSteeringController{constructor(s){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=s,this.log=logger.log.bind(logger,"[content-steering]:"),this.registerListeners()}registerListeners(){const s=this.hls;s.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),s.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),s.on(Events.ERROR,this.onError,this)}unregisterListeners(){const s=this.hls;s&&(s.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),s.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),s.off(Events.ERROR,this.onError,this))}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const s=this.timeToLoad*1e3-(performance.now()-this.updated);if(s>0){this.scheduleRefresh(this.uri,s);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(s){const a=this.levels;a&&(this.levels=a.filter(et=>et!==s))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(s,a){const{contentSteering:et}=a;et!==null&&(this.pathwayId=et.pathwayId,this.uri=et.uri,this.started&&this.startLoad())}onManifestParsed(s,a){this.audioTracks=a.audioTracks,this.subtitleTracks=a.subtitleTracks}onError(s,a){const{errorAction:et}=a;if(et?.action===NetworkErrorAction.SendAlternateToPenaltyBox&&et.flags===ErrorActionFlags.MoveAllAlternatesMatchingHost){const tt=this.levels;let rt=this.pathwayPriority,nt=this.pathwayId;if(a.context){const{groupId:it,pathwayId:st,type:ot}=a.context;it&&tt?nt=this.getPathwayForGroupId(it,ot,nt):st&&(nt=st)}nt in this.penalizedPathways||(this.penalizedPathways[nt]=performance.now()),!rt&&tt&&(rt=tt.reduce((it,st)=>(it.indexOf(st.pathwayId)===-1&&it.push(st.pathwayId),it),[])),rt&&rt.length>1&&(this.updatePathwayPriority(rt),et.resolved=this.pathwayId!==nt),et.resolved||logger.warn(`Could not resolve ${a.details} ("${a.error.message}") with content-steering for Pathway: ${nt} levels: ${tt&&tt.length} priorities: ${JSON.stringify(rt)} penalized: ${JSON.stringify(this.penalizedPathways)}`)}}filterParsedLevels(s){this.levels=s;let a=this.getLevelsForPathway(this.pathwayId);if(a.length===0){const et=s[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${et}"`),a=this.getLevelsForPathway(et),this.pathwayId=et}return a.length!==s.length?(this.log(`Found ${a.length}/${s.length} levels in Pathway "${this.pathwayId}"`),a):s}getLevelsForPathway(s){return this.levels===null?[]:this.levels.filter(a=>s===a.pathwayId)}updatePathwayPriority(s){this.pathwayPriority=s;let a;const et=this.penalizedPathways,tt=performance.now();Object.keys(et).forEach(rt=>{tt-et[rt]>PATHWAY_PENALTY_DURATION_MS&&delete et[rt]});for(let rt=0;rt<s.length;rt++){const nt=s[rt];if(nt in et)continue;if(nt===this.pathwayId)return;const it=this.hls.nextLoadLevel,st=this.hls.levels[it];if(a=this.getLevelsForPathway(nt),a.length>0){this.log(`Setting Pathway to "${nt}"`),this.pathwayId=nt,reassignFragmentLevelIndexes(a),this.hls.trigger(Events.LEVELS_UPDATED,{levels:a});const ot=this.hls.levels[it];st&&ot&&this.levels&&(ot.attrs["STABLE-VARIANT-ID"]!==st.attrs["STABLE-VARIANT-ID"]&&ot.bitrate!==st.bitrate&&this.log(`Unstable Pathways change from bitrate ${st.bitrate} to ${ot.bitrate}`),this.hls.nextLoadLevel=it);break}}}getPathwayForGroupId(s,a,et){const tt=this.getLevelsForPathway(et).concat(this.levels||[]);for(let rt=0;rt<tt.length;rt++)if(a===PlaylistContextType.AUDIO_TRACK&&tt[rt].hasAudioGroup(s)||a===PlaylistContextType.SUBTITLE_TRACK&&tt[rt].hasSubtitleGroup(s))return tt[rt].pathwayId;return et}clonePathways(s){const a=this.levels;if(!a)return;const et={},tt={};s.forEach(rt=>{const{ID:nt,"BASE-ID":it,"URI-REPLACEMENT":st}=rt;if(a.some(at=>at.pathwayId===nt))return;const ot=this.getLevelsForPathway(it).map(at=>{const lt=new AttrList(at.attrs);lt["PATHWAY-ID"]=nt;const ct=lt.AUDIO&&`${lt.AUDIO}_clone_${nt}`,ht=lt.SUBTITLES&&`${lt.SUBTITLES}_clone_${nt}`;ct&&(et[lt.AUDIO]=ct,lt.AUDIO=ct),ht&&(tt[lt.SUBTITLES]=ht,lt.SUBTITLES=ht);const ft=performUriReplacement(at.uri,lt["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",st),dt=new Level({attrs:lt,audioCodec:at.audioCodec,bitrate:at.bitrate,height:at.height,name:at.name,url:ft,videoCodec:at.videoCodec,width:at.width});if(at.audioGroups)for(let pt=1;pt<at.audioGroups.length;pt++)dt.addGroupId("audio",`${at.audioGroups[pt]}_clone_${nt}`);if(at.subtitleGroups)for(let pt=1;pt<at.subtitleGroups.length;pt++)dt.addGroupId("text",`${at.subtitleGroups[pt]}_clone_${nt}`);return dt});a.push(...ot),cloneRenditionGroups(this.audioTracks,et,st,nt),cloneRenditionGroups(this.subtitleTracks,tt,st,nt)})}loadSteeringManifest(s){const a=this.hls.config,et=a.loader;this.loader&&this.loader.destroy(),this.loader=new et(a);let tt;try{tt=new self.URL(s)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${s}`);return}if(tt.protocol!=="data:"){const at=(this.hls.bandwidthEstimate||a.abrEwmaDefaultEstimate)|0;tt.searchParams.set("_HLS_pathway",this.pathwayId),tt.searchParams.set("_HLS_throughput",""+at)}const rt={responseType:"json",url:tt.href},nt=a.steeringManifestLoadPolicy.default,it=nt.errorRetry||nt.timeoutRetry||{},st={loadPolicy:nt,timeout:nt.maxLoadTimeMs,maxRetry:it.maxNumRetry||0,retryDelay:it.retryDelayMs||0,maxRetryDelay:it.maxRetryDelayMs||0},ot={onSuccess:(at,lt,ct,ht)=>{this.log(`Loaded steering manifest: "${tt}"`);const ft=at.data;if(ft.VERSION!==1){this.log(`Steering VERSION ${ft.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=ft.TTL;const{"RELOAD-URI":dt,"PATHWAY-CLONES":pt,"PATHWAY-PRIORITY":gt}=ft;if(dt)try{this.uri=new self.URL(dt,tt).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${dt}`);return}this.scheduleRefresh(this.uri||ct.url),pt&&this.clonePathways(pt);const mt={steeringManifest:ft,url:tt.toString()};this.hls.trigger(Events.STEERING_MANIFEST_LOADED,mt),gt&&this.updatePathwayPriority(gt)},onError:(at,lt,ct,ht)=>{if(this.log(`Error loading steering manifest: ${at.code} ${at.text} (${lt.url})`),this.stopLoad(),at.code===410){this.enabled=!1,this.log(`Steering manifest ${lt.url} no longer available`);return}let ft=this.timeToLoad*1e3;if(at.code===429){const dt=this.loader;if(typeof dt?.getResponseHeader=="function"){const pt=dt.getResponseHeader("Retry-After");pt&&(ft=parseFloat(pt)*1e3)}this.log(`Steering manifest ${lt.url} rate limited`);return}this.scheduleRefresh(this.uri||lt.url,ft)},onTimeout:(at,lt,ct)=>{this.log(`Timeout loading steering manifest (${lt.url})`),this.scheduleRefresh(this.uri||lt.url)}};this.log(`Requesting steering manifest: ${tt}`),this.loader.load(rt,st,ot)}scheduleRefresh(s,a=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var et;const tt=(et=this.hls)==null?void 0:et.media;if(tt&&!tt.ended){this.loadSteeringManifest(s);return}this.scheduleRefresh(s,this.timeToLoad*1e3)},a)}}function cloneRenditionGroups(o,s,a,et){o&&Object.keys(s).forEach(tt=>{const rt=o.filter(nt=>nt.groupId===tt).map(nt=>{const it=_extends({},nt);return it.details=void 0,it.attrs=new AttrList(it.attrs),it.url=it.attrs.URI=performUriReplacement(nt.url,nt.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",a),it.groupId=it.attrs["GROUP-ID"]=s[tt],it.attrs["PATHWAY-ID"]=et,it});o.push(...rt)})}function performUriReplacement(o,s,a,et){const{HOST:tt,PARAMS:rt,[a]:nt}=et;let it;s&&(it=nt?.[s],it&&(o=it));const st=new self.URL(o);return tt&&!it&&(st.host=tt),rt&&Object.keys(rt).sort().forEach(ot=>{ot&&st.searchParams.set(ot,rt[ot])}),st.href}const AGE_HEADER_LINE_REGEX=/^age:\s*[\d.]+\s*$/im;class XhrLoader{constructor(s){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=s&&s.xhrSetup||null,this.stats=new LoadStats,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const s=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),s&&(s.onreadystatechange=null,s.onprogress=null,s.readyState!==4&&(this.stats.aborted=!0,s.abort()))}abort(){var s;this.abortInternal(),(s=this.callbacks)!=null&&s.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(s,a,et){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=s,this.config=a,this.callbacks=et,this.loadInternal()}loadInternal(){const{config:s,context:a}=this;if(!s||!a)return;const et=this.loader=new self.XMLHttpRequest,tt=this.stats;tt.loading.first=0,tt.loaded=0,tt.aborted=!1;const rt=this.xhrSetup;rt?Promise.resolve().then(()=>{if(!(this.loader!==et||this.stats.aborted))return rt(et,a.url)}).catch(nt=>{if(!(this.loader!==et||this.stats.aborted))return et.open("GET",a.url,!0),rt(et,a.url)}).then(()=>{this.loader!==et||this.stats.aborted||this.openAndSendXhr(et,a,s)}).catch(nt=>{this.callbacks.onError({code:et.status,text:nt.message},a,et,tt)}):this.openAndSendXhr(et,a,s)}openAndSendXhr(s,a,et){s.readyState||s.open("GET",a.url,!0);const tt=a.headers,{maxTimeToFirstByteMs:rt,maxLoadTimeMs:nt}=et.loadPolicy;if(tt)for(const it in tt)s.setRequestHeader(it,tt[it]);a.rangeEnd&&s.setRequestHeader("Range","bytes="+a.rangeStart+"-"+(a.rangeEnd-1)),s.onreadystatechange=this.readystatechange.bind(this),s.onprogress=this.loadprogress.bind(this),s.responseType=a.responseType,self.clearTimeout(this.requestTimeout),et.timeout=rt&&isFiniteNumber(rt)?rt:nt,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),et.timeout),s.send()}readystatechange(){const{context:s,loader:a,stats:et}=this;if(!s||!a)return;const tt=a.readyState,rt=this.config;if(!et.aborted&&tt>=2&&(et.loading.first===0&&(et.loading.first=Math.max(self.performance.now(),et.loading.start),rt.timeout!==rt.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),rt.timeout=rt.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),rt.loadPolicy.maxLoadTimeMs-(et.loading.first-et.loading.start)))),tt===4)){self.clearTimeout(this.requestTimeout),a.onreadystatechange=null,a.onprogress=null;const nt=a.status,it=a.responseType!=="text";if(nt>=200&&nt<300&&(it&&a.response||a.responseText!==null)){et.loading.end=Math.max(self.performance.now(),et.loading.first);const st=it?a.response:a.responseText,ot=a.responseType==="arraybuffer"?st.byteLength:st.length;if(et.loaded=et.total=ot,et.bwEstimate=et.total*8e3/(et.loading.end-et.loading.first),!this.callbacks)return;const at=this.callbacks.onProgress;if(at&&at(et,s,st,a),!this.callbacks)return;const lt={url:a.responseURL,data:st,code:nt};this.callbacks.onSuccess(lt,et,s,a)}else{const st=rt.loadPolicy.errorRetry,ot=et.retry,at={url:s.url,data:void 0,code:nt};shouldRetry(st,ot,!1,at)?this.retry(st):(logger.error(`${nt} while loading ${s.url}`),this.callbacks.onError({code:nt,text:a.statusText},s,a,et))}}}loadtimeout(){if(!this.config)return;const s=this.config.loadPolicy.timeoutRetry,a=this.stats.retry;if(shouldRetry(s,a,!0))this.retry(s);else{var et;logger.warn(`timeout while loading ${(et=this.context)==null?void 0:et.url}`);const tt=this.callbacks;tt&&(this.abortInternal(),tt.onTimeout(this.stats,this.context,this.loader))}}retry(s){const{context:a,stats:et}=this;this.retryDelay=getRetryDelay(s,et.retry),et.retry++,logger.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${a?.url}, retrying ${et.retry}/${s.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(s){const a=this.stats;a.loaded=s.loaded,s.lengthComputable&&(a.total=s.total)}getCacheAge(){let s=null;if(this.loader&&AGE_HEADER_LINE_REGEX.test(this.loader.getAllResponseHeaders())){const a=this.loader.getResponseHeader("age");s=a?parseFloat(a):null}return s}getResponseHeader(s){return this.loader&&new RegExp(`^${s}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(s):null}}function fetchSupported(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const BYTERANGE=/(\d+)-(\d+)\/(\d+)/;class FetchLoader{constructor(s){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=s.fetchSetup||getRequest,this.controller=new self.AbortController,this.stats=new LoadStats}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var s;this.abortInternal(),(s=this.callbacks)!=null&&s.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(s,a,et){const tt=this.stats;if(tt.loading.start)throw new Error("Loader can only be used once.");tt.loading.start=self.performance.now();const rt=getRequestParameters(s,this.controller.signal),nt=et.onProgress,it=s.responseType==="arraybuffer",st=it?"byteLength":"length",{maxTimeToFirstByteMs:ot,maxLoadTimeMs:at}=a.loadPolicy;this.context=s,this.config=a,this.callbacks=et,this.request=this.fetchSetup(s,rt),self.clearTimeout(this.requestTimeout),a.timeout=ot&&isFiniteNumber(ot)?ot:at,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),et.onTimeout(tt,s,this.response)},a.timeout),self.fetch(this.request).then(lt=>{this.response=this.loader=lt;const ct=Math.max(self.performance.now(),tt.loading.start);if(self.clearTimeout(this.requestTimeout),a.timeout=at,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),et.onTimeout(tt,s,this.response)},at-(ct-tt.loading.start)),!lt.ok){const{status:ht,statusText:ft}=lt;throw new FetchError(ft||"fetch, bad network response",ht,lt)}return tt.loading.first=ct,tt.total=getContentLength(lt.headers)||tt.total,nt&&isFiniteNumber(a.highWaterMark)?this.loadProgressively(lt,tt,s,a.highWaterMark,nt):it?lt.arrayBuffer():s.responseType==="json"?lt.json():lt.text()}).then(lt=>{const ct=this.response;if(!ct)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),tt.loading.end=Math.max(self.performance.now(),tt.loading.first);const ht=lt[st];ht&&(tt.loaded=tt.total=ht);const ft={url:ct.url,data:lt,code:ct.status};nt&&!isFiniteNumber(a.highWaterMark)&&nt(tt,s,lt,ct),et.onSuccess(ft,tt,s,ct)}).catch(lt=>{if(self.clearTimeout(this.requestTimeout),tt.aborted)return;const ct=lt&&lt.code||0,ht=lt?lt.message:null;et.onError({code:ct,text:ht},s,lt?lt.details:null,tt)})}getCacheAge(){let s=null;if(this.response){const a=this.response.headers.get("age");s=a?parseFloat(a):null}return s}getResponseHeader(s){return this.response?this.response.headers.get(s):null}loadProgressively(s,a,et,tt=0,rt){const nt=new ChunkCache,it=s.body.getReader(),st=()=>it.read().then(ot=>{if(ot.done)return nt.dataLength&&rt(a,et,nt.flush(),s),Promise.resolve(new ArrayBuffer(0));const at=ot.value,lt=at.length;return a.loaded+=lt,lt<tt||nt.dataLength?(nt.push(at),nt.dataLength>=tt&&rt(a,et,nt.flush(),s)):rt(a,et,at,s),st()}).catch(()=>Promise.reject());return st()}}function getRequestParameters(o,s){const a={method:"GET",mode:"cors",credentials:"same-origin",signal:s,headers:new self.Headers(_extends({},o.headers))};return o.rangeEnd&&a.headers.set("Range","bytes="+o.rangeStart+"-"+String(o.rangeEnd-1)),a}function getByteRangeLength(o){const s=BYTERANGE.exec(o);if(s)return parseInt(s[2])-parseInt(s[1])+1}function getContentLength(o){const s=o.get("Content-Range");if(s){const et=getByteRangeLength(s);if(isFiniteNumber(et))return et}const a=o.get("Content-Length");if(a)return parseInt(a)}function getRequest(o,s){return new self.Request(o.url,s)}class FetchError extends Error{constructor(s,a,et){super(s),this.code=void 0,this.details=void 0,this.code=a,this.details=et}}const WHITESPACE_CHAR=/\s/,Cues={newCue(o,s,a,et){const tt=[];let rt,nt,it,st,ot;const at=self.VTTCue||self.TextTrackCue;for(let ct=0;ct<et.rows.length;ct++)if(rt=et.rows[ct],it=!0,st=0,ot="",!rt.isEmpty()){var lt;for(let dt=0;dt<rt.chars.length;dt++)WHITESPACE_CHAR.test(rt.chars[dt].uchar)&&it?st++:(ot+=rt.chars[dt].uchar,it=!1);rt.cueStartTime=s,s===a&&(a+=1e-4),st>=16?st--:st++;const ht=fixLineBreaks(ot.trim()),ft=generateCueId(s,a,ht);o!=null&&(lt=o.cues)!=null&&lt.getCueById(ft)||(nt=new at(s,a,ht),nt.id=ft,nt.line=ct+1,nt.align="left",nt.position=10+Math.min(80,Math.floor(st*8/32)*10),tt.push(nt))}return o&&tt.length&&(tt.sort((ct,ht)=>ct.line==="auto"||ht.line==="auto"?0:ct.line>8&&ht.line>8?ht.line-ct.line:ct.line-ht.line),tt.forEach(ct=>addCueToTrack(o,ct))),tt}},defaultLoadPolicy={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},hlsDefaultConfig=_objectSpread2(_objectSpread2({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:XhrLoader,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:AbrController,bufferController:BufferController,capLevelController:CapLevelController,errorController:ErrorController,fpsController:FPSController,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!0,certLoadPolicy:{default:defaultLoadPolicy},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},timelineConfig()),{},{subtitleStreamController:SubtitleStreamController,subtitleTrackController:SubtitleTrackController,timelineController:TimelineController,audioStreamController:AudioStreamController,audioTrackController:AudioTrackController,emeController:EMEController,cmcdController:CMCDController,contentSteeringController:ContentSteeringController});function timelineConfig(){return{cueHandler:Cues,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function mergeConfig(o,s){if((s.liveSyncDurationCount||s.liveMaxLatencyDurationCount)&&(s.liveSyncDuration||s.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(s.liveMaxLatencyDurationCount!==void 0&&(s.liveSyncDurationCount===void 0||s.liveMaxLatencyDurationCount<=s.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(s.liveMaxLatencyDuration!==void 0&&(s.liveSyncDuration===void 0||s.liveMaxLatencyDuration<=s.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const a=deepCpy(o),et=["manifest","level","frag"],tt=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return et.forEach(rt=>{const nt=`${rt==="level"?"playlist":rt}LoadPolicy`,it=s[nt]===void 0,st=[];tt.forEach(ot=>{const at=`${rt}Loading${ot}`,lt=s[at];if(lt!==void 0&&it){st.push(at);const ct=a[nt].default;switch(s[nt]={default:ct},ot){case"TimeOut":ct.maxLoadTimeMs=lt,ct.maxTimeToFirstByteMs=lt;break;case"MaxRetry":ct.errorRetry.maxNumRetry=lt,ct.timeoutRetry.maxNumRetry=lt;break;case"RetryDelay":ct.errorRetry.retryDelayMs=lt,ct.timeoutRetry.retryDelayMs=lt;break;case"MaxRetryTimeout":ct.errorRetry.maxRetryDelayMs=lt,ct.timeoutRetry.maxRetryDelayMs=lt;break}}}),st.length&&logger.warn(`hls.js config: "${st.join('", "')}" setting(s) are deprecated, use "${nt}": ${JSON.stringify(s[nt])}`)}),_objectSpread2(_objectSpread2({},a),s)}function deepCpy(o){return o&&typeof o=="object"?Array.isArray(o)?o.map(deepCpy):Object.keys(o).reduce((s,a)=>(s[a]=deepCpy(o[a]),s),{}):o}function enableStreamingMode(o){const s=o.loader;s!==FetchLoader&&s!==XhrLoader?(logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),o.progressive=!1):fetchSupported()&&(o.loader=FetchLoader,o.progressive=!0,o.enableSoftwareAES=!0,logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}let chromeOrFirefox;class LevelController extends BasePlaylistController{constructor(s,a){super(s,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=a,this._registerListeners()}_registerListeners(){const{hls:s}=this;s.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),s.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),s.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),s.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),s.on(Events.ERROR,this.onError,this)}_unregisterListeners(){const{hls:s}=this;s.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),s.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),s.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),s.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),s.off(Events.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(a=>{a.loadError=0,a.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(s,a){this.resetLevels()}onManifestLoaded(s,a){const et=this.hls.config.preferManagedMediaSource,tt=[],rt={},nt={};let it=!1,st=!1,ot=!1;a.levels.forEach(at=>{var lt,ct;const ht=at.attrs;let{audioCodec:ft,videoCodec:dt}=at;((lt=ft)==null?void 0:lt.indexOf("mp4a.40.34"))!==-1&&(chromeOrFirefox||(chromeOrFirefox=/chrome|firefox/i.test(navigator.userAgent)),chromeOrFirefox&&(at.audioCodec=ft=void 0)),ft&&(at.audioCodec=ft=getCodecCompatibleName(ft,et)),((ct=dt)==null?void 0:ct.indexOf("avc1"))===0&&(dt=at.videoCodec=convertAVC1ToAVCOTI(dt));const{width:pt,height:gt,unknownCodecs:mt}=at;if(it||(it=!!(pt&&gt)),st||(st=!!dt),ot||(ot=!!ft),mt!=null&&mt.length||ft&&!areCodecsMediaSourceSupported(ft,"audio",et)||dt&&!areCodecsMediaSourceSupported(dt,"video",et))return;const{CODECS:yt,"FRAME-RATE":vt,"HDCP-LEVEL":Et,"PATHWAY-ID":xt,RESOLUTION:wt,"VIDEO-RANGE":Rt}=ht,Ft=`${`${xt||"."}-`}${at.bitrate}-${wt}-${vt}-${yt}-${Rt}-${Et}`;if(rt[Ft])if(rt[Ft].uri!==at.url&&!at.attrs["PATHWAY-ID"]){const zt=nt[Ft]+=1;at.attrs["PATHWAY-ID"]=new Array(zt+1).join(".");const Nt=new Level(at);rt[Ft]=Nt,tt.push(Nt)}else rt[Ft].addGroupId("audio",ht.AUDIO),rt[Ft].addGroupId("text",ht.SUBTITLES);else{const zt=new Level(at);rt[Ft]=zt,nt[Ft]=1,tt.push(zt)}}),this.filterAndSortMediaOptions(tt,a,it,st,ot)}filterAndSortMediaOptions(s,a,et,tt,rt){let nt=[],it=[],st=s;if((et||tt)&&rt&&(st=st.filter(({videoCodec:ft,videoRange:dt,width:pt,height:gt})=>(!!ft||!!(pt&&gt))&&isVideoRange(dt))),st.length===0){Promise.resolve().then(()=>{if(this.hls){a.levels.length&&this.warn(`One or more CODECS in variant not supported: ${JSON.stringify(a.levels[0].attrs)}`);const ft=new Error("no level with compatible codecs found in manifest");this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:a.url,error:ft,reason:ft.message})}});return}if(a.audioTracks){const{preferManagedMediaSource:ft}=this.hls.config;nt=a.audioTracks.filter(dt=>!dt.audioCodec||areCodecsMediaSourceSupported(dt.audioCodec,"audio",ft)),assignTrackIdsByGroup(nt)}a.subtitles&&(it=a.subtitles,assignTrackIdsByGroup(it));const ot=st.slice(0);st.sort((ft,dt)=>{if(ft.attrs["HDCP-LEVEL"]!==dt.attrs["HDCP-LEVEL"])return(ft.attrs["HDCP-LEVEL"]||"")>(dt.attrs["HDCP-LEVEL"]||"")?1:-1;if(et&&ft.height!==dt.height)return ft.height-dt.height;if(ft.frameRate!==dt.frameRate)return ft.frameRate-dt.frameRate;if(ft.videoRange!==dt.videoRange)return VideoRangeValues.indexOf(ft.videoRange)-VideoRangeValues.indexOf(dt.videoRange);if(ft.videoCodec!==dt.videoCodec){const pt=videoCodecPreferenceValue(ft.videoCodec),gt=videoCodecPreferenceValue(dt.videoCodec);if(pt!==gt)return gt-pt}if(ft.uri===dt.uri&&ft.codecSet!==dt.codecSet){const pt=codecsSetSelectionPreferenceValue(ft.codecSet),gt=codecsSetSelectionPreferenceValue(dt.codecSet);if(pt!==gt)return gt-pt}return ft.averageBitrate!==dt.averageBitrate?ft.averageBitrate-dt.averageBitrate:0});let at=ot[0];if(this.steering&&(st=this.steering.filterParsedLevels(st),st.length!==ot.length)){for(let ft=0;ft<ot.length;ft++)if(ot[ft].pathwayId===st[0].pathwayId){at=ot[ft];break}}this._levels=st;for(let ft=0;ft<st.length;ft++)if(st[ft]===at){var lt;this._firstLevel=ft;const dt=at.bitrate,pt=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${st.length} level(s) found, first bitrate: ${dt}`),((lt=this.hls.userConfig)==null?void 0:lt.abrEwmaDefaultEstimate)===void 0){const gt=Math.min(dt,this.hls.config.abrEwmaDefaultEstimateMax);gt>pt&&pt===hlsDefaultConfig.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=gt)}break}const ct=rt&&!tt,ht={levels:st,audioTracks:nt,subtitleTracks:it,sessionData:a.sessionData,sessionKeys:a.sessionKeys,firstLevel:this._firstLevel,stats:a.stats,audio:rt,video:tt,altAudio:!ct&&nt.some(ft=>!!ft.url)};this.hls.trigger(Events.MANIFEST_PARSED,ht),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return this._levels.length===0?null:this._levels}get level(){return this.currentLevelIndex}set level(s){const a=this._levels;if(a.length===0)return;if(s<0||s>=a.length){const at=new Error("invalid level idx"),lt=s<0;if(this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.LEVEL_SWITCH_ERROR,level:s,fatal:lt,error:at,reason:at.message}),lt)return;s=Math.min(s,a.length-1)}const et=this.currentLevelIndex,tt=this.currentLevel,rt=tt?tt.attrs["PATHWAY-ID"]:void 0,nt=a[s],it=nt.attrs["PATHWAY-ID"];if(this.currentLevelIndex=s,this.currentLevel=nt,et===s&&nt.details&&tt&&rt===it)return;this.log(`Switching to level ${s} (${nt.height?nt.height+"p ":""}${nt.videoRange?nt.videoRange+" ":""}${nt.codecSet?nt.codecSet+" ":""}@${nt.bitrate})${it?" with Pathway "+it:""} from level ${et}${rt?" with Pathway "+rt:""}`);const st={level:s,attrs:nt.attrs,details:nt.details,bitrate:nt.bitrate,averageBitrate:nt.averageBitrate,maxBitrate:nt.maxBitrate,realBitrate:nt.realBitrate,width:nt.width,height:nt.height,codecSet:nt.codecSet,audioCodec:nt.audioCodec,videoCodec:nt.videoCodec,audioGroups:nt.audioGroups,subtitleGroups:nt.subtitleGroups,loaded:nt.loaded,loadError:nt.loadError,fragmentError:nt.fragmentError,name:nt.name,id:nt.id,uri:nt.uri,url:nt.url,urlId:0,audioGroupIds:nt.audioGroupIds,textGroupIds:nt.textGroupIds};this.hls.trigger(Events.LEVEL_SWITCHING,st);const ot=nt.details;if(!ot||ot.live){const at=this.switchParams(nt.uri,tt?.details,ot);this.loadPlaylist(at)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(s){this.manualLevelIndex=s,this._startLevel===void 0&&(this._startLevel=s),s!==-1&&(this.level=s)}get firstLevel(){return this._firstLevel}set firstLevel(s){this._firstLevel=s}get startLevel(){if(this._startLevel===void 0){const s=this.hls.config.startLevel;return s!==void 0?s:this.hls.firstAutoLevel}return this._startLevel}set startLevel(s){this._startLevel=s}onError(s,a){a.fatal||!a.context||a.context.type===PlaylistContextType.LEVEL&&a.context.level===this.level&&this.checkRetry(a)}onFragBuffered(s,{frag:a}){if(a!==void 0&&a.type===PlaylistLevelType.MAIN){const et=a.elementaryStreams;if(!Object.keys(et).some(rt=>!!et[rt]))return;const tt=this._levels[a.level];tt!=null&&tt.loadError&&(this.log(`Resetting level error count of ${tt.loadError} on frag buffered`),tt.loadError=0)}}onLevelLoaded(s,a){var et;const{level:tt,details:rt}=a,nt=this._levels[tt];if(!nt){var it;this.warn(`Invalid level index ${tt}`),(it=a.deliveryDirectives)!=null&&it.skip&&(rt.deltaUpdateFailed=!0);return}tt===this.currentLevelIndex?(nt.fragmentError===0&&(nt.loadError=0),this.playlistLoaded(tt,a,nt.details)):(et=a.deliveryDirectives)!=null&&et.skip&&(rt.deltaUpdateFailed=!0)}loadPlaylist(s){super.loadPlaylist();const a=this.currentLevelIndex,et=this.currentLevel;if(et&&this.shouldLoadPlaylist(et)){let tt=et.uri;if(s)try{tt=s.addDirectives(tt)}catch(nt){this.warn(`Could not construct new URL with HLS Delivery Directives: ${nt}`)}const rt=et.attrs["PATHWAY-ID"];this.log(`Loading level index ${a}${s?.msn!==void 0?" at sn "+s.msn+" part "+s.part:""} with${rt?" Pathway "+rt:""} ${tt}`),this.clearTimer(),this.hls.trigger(Events.LEVEL_LOADING,{url:tt,level:a,pathwayId:et.attrs["PATHWAY-ID"],id:0,deliveryDirectives:s||null})}}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(s){this.level=s,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=s)}removeLevel(s){var a;const et=this._levels.filter((tt,rt)=>rt!==s?!0:(this.steering&&this.steering.removeLevel(tt),tt===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,tt.details&&tt.details.fragments.forEach(nt=>nt.level=-1)),!1));reassignFragmentLevelIndexes(et),this._levels=et,this.currentLevelIndex>-1&&(a=this.currentLevel)!=null&&a.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(Events.LEVELS_UPDATED,{levels:et})}onLevelsUpdated(s,{levels:a}){this._levels=a}checkMaxAutoUpdated(){const{autoLevelCapping:s,maxAutoLevel:a,maxHdcpLevel:et}=this.hls;this._maxAutoLevel!==a&&(this._maxAutoLevel=a,this.hls.trigger(Events.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:s,levels:this.levels,maxAutoLevel:a,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:et}))}}function assignTrackIdsByGroup(o){const s={};o.forEach(a=>{const et=a.groupId||"";a.id=s[et]=s[et]||0,s[et]++})}class KeyLoader{constructor(s){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=s}abort(s){for(const et in this.keyUriToKeyInfo){const tt=this.keyUriToKeyInfo[et].loader;if(tt){var a;if(s&&s!==((a=tt.context)==null?void 0:a.frag.type))return;tt.abort()}}}detach(){for(const s in this.keyUriToKeyInfo){const a=this.keyUriToKeyInfo[s];(a.mediaKeySessionContext||a.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[s]}}destroy(){this.detach();for(const s in this.keyUriToKeyInfo){const a=this.keyUriToKeyInfo[s].loader;a&&a.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(s,a=ErrorDetails.KEY_LOAD_ERROR,et,tt,rt){return new LoadError({type:ErrorTypes.NETWORK_ERROR,details:a,fatal:!1,frag:s,response:rt,error:et,networkDetails:tt})}loadClear(s,a){if(this.emeController&&this.config.emeEnabled){const{sn:et,cc:tt}=s;for(let rt=0;rt<a.length;rt++){const nt=a[rt];if(tt<=nt.cc&&(et==="initSegment"||nt.sn==="initSegment"||et<nt.sn)){this.emeController.selectKeySystemFormat(nt).then(it=>{nt.setKeyFormat(it)});break}}}}load(s){return!s.decryptdata&&s.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(s).then(a=>this.loadInternal(s,a)):this.loadInternal(s)}loadInternal(s,a){var et,tt;a&&s.setKeyFormat(a);const rt=s.decryptdata;if(!rt){const ot=new Error(a?`Expected frag.decryptdata to be defined after setting format ${a}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(s,ErrorDetails.KEY_LOAD_ERROR,ot))}const nt=rt.uri;if(!nt)return Promise.reject(this.createKeyLoadError(s,ErrorDetails.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${nt}"`)));let it=this.keyUriToKeyInfo[nt];if((et=it)!=null&&et.decryptdata.key)return rt.key=it.decryptdata.key,Promise.resolve({frag:s,keyInfo:it});if((tt=it)!=null&&tt.keyLoadPromise){var st;switch((st=it.mediaKeySessionContext)==null?void 0:st.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return it.keyLoadPromise.then(ot=>(rt.key=ot.keyInfo.decryptdata.key,{frag:s,keyInfo:it}))}}switch(it=this.keyUriToKeyInfo[nt]={decryptdata:rt,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},rt.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return rt.keyFormat==="identity"?this.loadKeyHTTP(it,s):this.loadKeyEME(it,s);case"AES-128":return this.loadKeyHTTP(it,s);default:return Promise.reject(this.createKeyLoadError(s,ErrorDetails.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${rt.method}"`)))}}loadKeyEME(s,a){const et={frag:a,keyInfo:s};if(this.emeController&&this.config.emeEnabled){const tt=this.emeController.loadKey(et);if(tt)return(s.keyLoadPromise=tt.then(rt=>(s.mediaKeySessionContext=rt,et))).catch(rt=>{throw s.keyLoadPromise=null,rt})}return Promise.resolve(et)}loadKeyHTTP(s,a){const et=this.config,tt=et.loader,rt=new tt(et);return a.keyLoader=s.loader=rt,s.keyLoadPromise=new Promise((nt,it)=>{const st={keyInfo:s,frag:a,responseType:"arraybuffer",url:s.decryptdata.uri},ot=et.keyLoadPolicy.default,at={loadPolicy:ot,timeout:ot.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},lt={onSuccess:(ct,ht,ft,dt)=>{const{frag:pt,keyInfo:gt,url:mt}=ft;if(!pt.decryptdata||gt!==this.keyUriToKeyInfo[mt])return it(this.createKeyLoadError(pt,ErrorDetails.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),dt));gt.decryptdata.key=pt.decryptdata.key=new Uint8Array(ct.data),pt.keyLoader=null,gt.loader=null,nt({frag:pt,keyInfo:gt})},onError:(ct,ht,ft,dt)=>{this.resetLoader(ht),it(this.createKeyLoadError(a,ErrorDetails.KEY_LOAD_ERROR,new Error(`HTTP Error ${ct.code} loading key ${ct.text}`),ft,_objectSpread2({url:st.url,data:void 0},ct)))},onTimeout:(ct,ht,ft)=>{this.resetLoader(ht),it(this.createKeyLoadError(a,ErrorDetails.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),ft))},onAbort:(ct,ht,ft)=>{this.resetLoader(ht),it(this.createKeyLoadError(a,ErrorDetails.INTERNAL_ABORTED,new Error("key loading aborted"),ft))}};rt.load(st,at,lt)})}resetLoader(s){const{frag:a,keyInfo:et,url:tt}=s,rt=et.loader;a.keyLoader===rt&&(a.keyLoader=null,et.loader=null),delete this.keyUriToKeyInfo[tt],rt&&rt.destroy()}}function getSourceBuffer(){return self.SourceBuffer||self.WebKitSourceBuffer}function isMSESupported(){if(!getMediaSource())return!1;const s=getSourceBuffer();return!s||s.prototype&&typeof s.prototype.appendBuffer=="function"&&typeof s.prototype.remove=="function"}function isSupported(){if(!isMSESupported())return!1;const o=getMediaSource();return typeof o?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(s=>o.isTypeSupported(mimeTypeForCodec(s,"video")))||["mp4a.40.2","fLaC"].some(s=>o.isTypeSupported(mimeTypeForCodec(s,"audio"))))}function changeTypeSupported(){var o;const s=getSourceBuffer();return typeof(s==null||(o=s.prototype)==null?void 0:o.changeType)=="function"}const STALL_MINIMUM_DURATION_MS=250,MAX_START_GAP_JUMP=2,SKIP_BUFFER_HOLE_STEP_SECONDS=.1,SKIP_BUFFER_RANGE_START=.05;class GapController{constructor(s,a,et,tt){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=s,this.media=a,this.fragmentTracker=et,this.hls=tt}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(s,a){const{config:et,media:tt,stalled:rt}=this;if(tt===null)return;const{currentTime:nt,seeking:it}=tt,st=this.seeking&&!it,ot=!this.seeking&&it;if(this.seeking=it,nt!==s){if(this.moved=!0,it||(this.nudgeRetry=0),rt!==null){if(this.stallReported){const pt=self.performance.now()-rt;logger.warn(`playback not stuck anymore @${nt}, after ${Math.round(pt)}ms`),this.stallReported=!1}this.stalled=null}return}if(ot||st){this.stalled=null;return}if(tt.paused&&!it||tt.ended||tt.playbackRate===0||!BufferHelper.getBuffered(tt).length){this.nudgeRetry=0;return}const at=BufferHelper.bufferInfo(tt,nt,0),lt=at.nextStart||0;if(it){const pt=at.len>MAX_START_GAP_JUMP,gt=!lt||a&&a.start<=nt||lt-nt>MAX_START_GAP_JUMP&&!this.fragmentTracker.getPartialFragment(nt);if(pt||gt)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var ct;if(!(at.len>0)&&!lt)return;const gt=Math.max(lt,at.start||0)-nt,mt=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,vt=(mt==null||(ct=mt.details)==null?void 0:ct.live)?mt.details.targetduration*2:MAX_START_GAP_JUMP,Et=this.fragmentTracker.getPartialFragment(nt);if(gt>0&&(gt<=vt||Et)){tt.paused||this._trySkipBufferHole(Et);return}}const ht=self.performance.now();if(rt===null){this.stalled=ht;return}const ft=ht-rt;if(!it&&ft>=STALL_MINIMUM_DURATION_MS&&(this._reportStall(at),!this.media))return;const dt=BufferHelper.bufferInfo(tt,nt,et.maxBufferHole);this._tryFixBufferStall(dt,ft)}_tryFixBufferStall(s,a){const{config:et,fragmentTracker:tt,media:rt}=this;if(rt===null)return;const nt=rt.currentTime,it=tt.getPartialFragment(nt);it&&(this._trySkipBufferHole(it)||!this.media)||(s.len>et.maxBufferHole||s.nextStart&&s.nextStart-nt<et.maxBufferHole)&&a>et.highBufferWatchdogPeriod*1e3&&(logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(s){const{hls:a,media:et,stallReported:tt}=this;if(!tt&&et){this.stallReported=!0;const rt=new Error(`Playback stalling at @${et.currentTime} due to low buffer (${JSON.stringify(s)})`);logger.warn(rt.message),a.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,error:rt,buffer:s.len})}}_trySkipBufferHole(s){const{config:a,hls:et,media:tt}=this;if(tt===null)return 0;const rt=tt.currentTime,nt=BufferHelper.bufferInfo(tt,rt,0),it=rt<nt.start?nt.start:nt.nextStart;if(it){const st=nt.len<=a.maxBufferHole,ot=nt.len>0&&nt.len<1&&tt.readyState<3,at=it-rt;if(at>0&&(st||ot)){if(at>a.maxBufferHole){const{fragmentTracker:ct}=this;let ht=!1;if(rt===0){const ft=ct.getAppendedFrag(0,PlaylistLevelType.MAIN);ft&&it<ft.end&&(ht=!0)}if(!ht){const ft=s||ct.getAppendedFrag(rt,PlaylistLevelType.MAIN);if(ft){let dt=!1,pt=ft.end;for(;pt<it;){const gt=ct.getPartialFragment(pt);if(gt)pt+=gt.duration;else{dt=!0;break}}if(dt)return 0}}}const lt=Math.max(it+SKIP_BUFFER_RANGE_START,rt+SKIP_BUFFER_HOLE_STEP_SECONDS);if(logger.warn(`skipping hole, adjusting currentTime from ${rt} to ${lt}`),this.moved=!0,this.stalled=null,tt.currentTime=lt,s&&!s.gap){const ct=new Error(`fragment loaded with buffer holes, seeking from ${rt} to ${lt}`);et.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:ct,reason:ct.message,frag:s})}return lt}}return 0}_tryNudgeBuffer(){const{config:s,hls:a,media:et,nudgeRetry:tt}=this;if(et===null)return;const rt=et.currentTime;if(this.nudgeRetry++,tt<s.nudgeMaxRetry){const nt=rt+(tt+1)*s.nudgeOffset,it=new Error(`Nudging 'currentTime' from ${rt} to ${nt}`);logger.warn(it.message),et.currentTime=nt,a.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_NUDGE_ON_STALL,error:it,fatal:!1})}else{const nt=new Error(`Playhead still not moving while enough data buffered @${rt} after ${s.nudgeMaxRetry} nudges`);logger.error(nt.message),a.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_STALLED_ERROR,error:nt,fatal:!0})}}}const TICK_INTERVAL=100;class StreamController extends BaseStreamController{constructor(s,a,et){super(s,a,et,"[stream-controller]",PlaylistLevelType.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:s}=this;s.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),s.on(Events.LEVEL_LOADING,this.onLevelLoading,this),s.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),s.on(Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),s.on(Events.ERROR,this.onError,this),s.on(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.on(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),s.on(Events.BUFFER_CREATED,this.onBufferCreated,this),s.on(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),s.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:s}=this;s.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),s.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),s.off(Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),s.off(Events.ERROR,this.onError,this),s.off(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.off(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),s.off(Events.BUFFER_CREATED,this.onBufferCreated,this),s.off(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),s.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying()}startLoad(s){if(this.levels){const{lastCurrentTime:a,hls:et}=this;if(this.stopLoad(),this.setInterval(TICK_INTERVAL),this.level=-1,!this.startFragRequested){let tt=et.startLevel;tt===-1&&(et.config.testBandwidth&&this.levels.length>1?(tt=0,this.bitrateTest=!0):tt=et.firstAutoLevel),et.nextLoadLevel=tt,this.level=et.loadLevel,this.loadedmetadata=!1}a>0&&s===-1&&(this.log(`Override startPosition with lastCurrentTime @${a.toFixed(3)}`),s=a),this.state=State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=s,this.tick()}else this._forceStartLoad=!0,this.state=State.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case State.WAITING_LEVEL:{const{levels:a,level:et}=this,tt=a?.[et],rt=tt?.details;if(rt&&(!rt.live||this.levelLastLoaded===tt)){if(this.waitForCdnTuneIn(rt))break;this.state=State.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=State.IDLE;break}break}case State.FRAG_LOADING_WAITING_RETRY:{var s;const a=self.performance.now(),et=this.retryDate;if(!et||a>=et||(s=this.media)!=null&&s.seeking){const{levels:tt,level:rt}=this,nt=tt?.[rt];this.resetStartWhenNotLoaded(nt||null),this.state=State.IDLE}}break}this.state===State.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:s,levelLastLoaded:a,levels:et,media:tt}=this;if(a===null||!tt&&(this.startFragRequested||!s.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const rt=s.nextLoadLevel;if(!(et!=null&&et[rt]))return;const nt=et[rt],it=this.getMainFwdBufferInfo();if(it===null)return;const st=this.getLevelDetails();if(st&&this._streamEnded(it,st)){const dt={};this.altAudio&&(dt.type="video"),this.hls.trigger(Events.BUFFER_EOS,dt),this.state=State.ENDED;return}s.loadLevel!==rt&&s.manualLevel===-1&&this.log(`Adapting to level ${rt} from level ${this.level}`),this.level=s.nextLoadLevel=rt;const ot=nt.details;if(!ot||this.state===State.WAITING_LEVEL||ot.live&&this.levelLastLoaded!==nt){this.level=rt,this.state=State.WAITING_LEVEL;return}const at=it.len,lt=this.getMaxBufferLength(nt.maxBitrate);if(at>=lt)return;this.backtrackFragment&&this.backtrackFragment.start>it.end&&(this.backtrackFragment=null);const ct=this.backtrackFragment?this.backtrackFragment.start:it.end;let ht=this.getNextFragment(ct,ot);if(this.couldBacktrack&&!this.fragPrevious&&ht&&ht.sn!=="initSegment"&&this.fragmentTracker.getState(ht)!==FragmentState.OK){var ft;const pt=((ft=this.backtrackFragment)!=null?ft:ht).sn-ot.startSN,gt=ot.fragments[pt-1];gt&&ht.cc===gt.cc&&(ht=gt,this.fragmentTracker.removeFragment(gt))}else this.backtrackFragment&&it.len&&(this.backtrackFragment=null);if(ht&&this.isLoopLoading(ht,ct)){if(!ht.gap){const pt=this.audioOnly&&!this.altAudio?ElementaryStreamTypes.AUDIO:ElementaryStreamTypes.VIDEO,gt=(pt===ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;gt&&this.afterBufferFlushed(gt,pt,PlaylistLevelType.MAIN)}ht=this.getNextFragmentLoopLoading(ht,ot,it,PlaylistLevelType.MAIN,lt)}ht&&(ht.initSegment&&!ht.initSegment.data&&!this.bitrateTest&&(ht=ht.initSegment),this.loadFragment(ht,nt,ct))}loadFragment(s,a,et){const tt=this.fragmentTracker.getState(s);this.fragCurrent=s,tt===FragmentState.NOT_LOADED||tt===FragmentState.PARTIAL?s.sn==="initSegment"?this._loadInitSegment(s,a):this.bitrateTest?(this.log(`Fragment ${s.sn} of level ${s.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(s,a)):(this.startFragRequested=!0,super.loadFragment(s,a,et)):this.clearTrackerIfNeeded(s)}getBufferedFrag(s){return this.fragmentTracker.getBufferedFrag(s,PlaylistLevelType.MAIN)}followingBufferedFrag(s){return s?this.getBufferedFrag(s.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:s,media:a}=this;if(a!=null&&a.readyState){let et;const tt=this.getAppendedFrag(a.currentTime);tt&&tt.start>1&&this.flushMainBuffer(0,tt.start-1);const rt=this.getLevelDetails();if(rt!=null&&rt.live){const it=this.getMainFwdBufferInfo();if(!it||it.len<rt.targetduration*2)return}if(!a.paused&&s){const it=this.hls.nextLoadLevel,st=s[it],ot=this.fragLastKbps;ot&&this.fragCurrent?et=this.fragCurrent.duration*st.maxBitrate/(1e3*ot)+1:et=0}else et=0;const nt=this.getBufferedFrag(a.currentTime+et);if(nt){const it=this.followingBufferedFrag(nt);if(it){this.abortCurrentFrag();const st=it.maxStartPTS?it.maxStartPTS:it.start,ot=it.duration,at=Math.max(nt.end,st+Math.min(Math.max(ot-this.config.maxFragLookUpTolerance,ot*(this.couldBacktrack?.5:.125)),ot*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(at,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const s=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,s&&(s.abortRequests(),this.fragmentTracker.removeFragment(s)),this.state){case State.KEY_LOADING:case State.FRAG_LOADING:case State.FRAG_LOADING_WAITING_RETRY:case State.PARSING:case State.PARSED:this.state=State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(s,a){super.flushMainBuffer(s,a,this.altAudio?"video":null)}onMediaAttached(s,a){super.onMediaAttached(s,a);const et=a.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),et.addEventListener("playing",this.onvplaying),et.addEventListener("seeked",this.onvseeked),this.gapController=new GapController(this.config,et,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:s}=this;s&&this.onvplaying&&this.onvseeked&&(s.removeEventListener("playing",this.onvplaying),s.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const s=this.media,a=s?s.currentTime:null;isFiniteNumber(a)&&this.log(`Media seeked to ${a.toFixed(3)}`);const et=this.getMainFwdBufferInfo();if(et===null||et.len===0){this.warn(`Main forward buffer length on "seeked" event ${et?et.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1}onManifestParsed(s,a){let et=!1,tt=!1;a.levels.forEach(rt=>{const nt=rt.audioCodec;nt&&(et=et||nt.indexOf("mp4a.40.2")!==-1,tt=tt||nt.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=et&&tt&&!changeTypeSupported(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=a.levels,this.startFragRequested=!1}onLevelLoading(s,a){const{levels:et}=this;if(!et||this.state!==State.IDLE)return;const tt=et[a.level];(!tt.details||tt.details.live&&this.levelLastLoaded!==tt||this.waitForCdnTuneIn(tt.details))&&(this.state=State.WAITING_LEVEL)}onLevelLoaded(s,a){var et;const{levels:tt}=this,rt=a.level,nt=a.details,it=nt.totalduration;if(!tt){this.warn(`Levels were reset while loading level ${rt}`);return}this.log(`Level ${rt} loaded [${nt.startSN},${nt.endSN}]${nt.lastPartSn?`[part-${nt.lastPartSn}-${nt.lastPartIndex}]`:""}, cc [${nt.startCC}, ${nt.endCC}] duration:${it}`);const st=tt[rt],ot=this.fragCurrent;ot&&(this.state===State.FRAG_LOADING||this.state===State.FRAG_LOADING_WAITING_RETRY)&&ot.level!==a.level&&ot.loader&&this.abortCurrentFrag();let at=0;if(nt.live||(et=st.details)!=null&&et.live){var lt;if(this.checkLiveUpdate(nt),nt.deltaUpdateFailed)return;at=this.alignPlaylists(nt,st.details,(lt=this.levelLastLoaded)==null?void 0:lt.details)}if(st.details=nt,this.levelLastLoaded=st,this.hls.trigger(Events.LEVEL_UPDATED,{details:nt,level:rt}),this.state===State.WAITING_LEVEL){if(this.waitForCdnTuneIn(nt))return;this.state=State.IDLE}this.startFragRequested?nt.live&&this.synchronizeToLiveEdge(nt):this.setStartPosition(nt,at),this.tick()}_handleFragmentLoadProgress(s){var a;const{frag:et,part:tt,payload:rt}=s,{levels:nt}=this;if(!nt){this.warn(`Levels were reset while fragment load was in progress. Fragment ${et.sn} of level ${et.level} will not be buffered`);return}const it=nt[et.level],st=it.details;if(!st){this.warn(`Dropping fragment ${et.sn} of level ${et.level} after level details were reset`),this.fragmentTracker.removeFragment(et);return}const ot=it.videoCodec,at=st.PTSKnown||!st.live,lt=(a=et.initSegment)==null?void 0:a.data,ct=this._getAudioCodec(it),ht=this.transmuxer=this.transmuxer||new TransmuxerInterface(this.hls,PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),ft=tt?tt.index:-1,dt=ft!==-1,pt=new ChunkMetadata(et.level,et.sn,et.stats.chunkCount,rt.byteLength,ft,dt),gt=this.initPTS[et.cc];ht.push(rt,lt,ct,ot,et,tt,st.totalduration,at,pt,gt)}onAudioTrackSwitching(s,a){const et=this.altAudio;if(!!!a.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const nt=this.fragCurrent;nt&&(this.log("Switching to main audio track, cancel main fragment load"),nt.abortRequests(),this.fragmentTracker.removeFragment(nt)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const rt=this.hls;et&&(rt.trigger(Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),rt.trigger(Events.AUDIO_TRACK_SWITCHED,a)}}onAudioTrackSwitched(s,a){const et=a.id,tt=!!this.hls.audioTracks[et].url;if(tt){const rt=this.videoBuffer;rt&&this.mediaBuffer!==rt&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=rt)}this.altAudio=tt,this.tick()}onBufferCreated(s,a){const et=a.tracks;let tt,rt,nt=!1;for(const it in et){const st=et[it];if(st.id==="main"){if(rt=it,tt=st,it==="video"){const ot=et[it];ot&&(this.videoBuffer=ot.buffer)}}else nt=!0}nt&&tt?(this.log(`Alternate track found, use ${rt}.buffered to schedule main fragment loading`),this.mediaBuffer=tt.buffer):this.mediaBuffer=this.media}onFragBuffered(s,a){const{frag:et,part:tt}=a;if(et&&et.type!==PlaylistLevelType.MAIN)return;if(this.fragContextChanged(et)){this.warn(`Fragment ${et.sn}${tt?" p: "+tt.index:""} of level ${et.level} finished buffering, but was aborted. state: ${this.state}`),this.state===State.PARSED&&(this.state=State.IDLE);return}const rt=tt?tt.stats:et.stats;this.fragLastKbps=Math.round(8*rt.total/(rt.buffering.end-rt.loading.first)),et.sn!=="initSegment"&&(this.fragPrevious=et),this.fragBufferedComplete(et,tt)}onError(s,a){var et;if(a.fatal){this.state=State.ERROR;return}switch(a.details){case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_PARSING_ERROR:case ErrorDetails.FRAG_DECRYPT_ERROR:case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(PlaylistLevelType.MAIN,a);break;case ErrorDetails.LEVEL_LOAD_ERROR:case ErrorDetails.LEVEL_LOAD_TIMEOUT:case ErrorDetails.LEVEL_PARSING_ERROR:!a.levelRetry&&this.state===State.WAITING_LEVEL&&((et=a.context)==null?void 0:et.type)===PlaylistContextType.LEVEL&&(this.state=State.IDLE);break;case ErrorDetails.BUFFER_APPEND_ERROR:case ErrorDetails.BUFFER_FULL_ERROR:if(!a.parent||a.parent!=="main")return;if(a.details===ErrorDetails.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(a)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case ErrorDetails.INTERNAL_EXCEPTION:this.recoverWorkerError(a);break}}checkBuffer(){const{media:s,gapController:a}=this;if(!(!s||!a||!s.readyState)){if(this.loadedmetadata||!BufferHelper.getBuffered(s).length){const et=this.state!==State.IDLE?this.fragCurrent:null;a.poll(this.lastCurrentTime,et)}this.lastCurrentTime=s.currentTime}}onFragLoadEmergencyAborted(){this.state=State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(s,{type:a}){if(a!==ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){const et=(a===ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(et,a,PlaylistLevelType.MAIN),this.tick()}}onLevelsUpdated(s,a){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=a.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:s}=this;if(!s)return;const a=s.currentTime;let et=this.startPosition;if(et>=0&&a<et){if(s.seeking){this.log(`could not seek to ${et}, already seeking at ${a}`);return}const tt=BufferHelper.getBuffered(s),nt=(tt.length?tt.start(0):0)-et;nt>0&&(nt<this.config.maxBufferHole||nt<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${nt} to match buffer start`),et+=nt,this.startPosition=et),this.log(`seek to target start position ${et} from current time ${a}`),s.currentTime=et}}_getAudioCodec(s){let a=this.config.defaultAudioCodec||s.audioCodec;return this.audioCodecSwap&&a&&(this.log("Swapping audio codec"),a.indexOf("mp4a.40.5")!==-1?a="mp4a.40.2":a="mp4a.40.5"),a}_loadBitrateTestFrag(s,a){s.bitrateTest=!0,this._doFragLoad(s,a).then(et=>{const{hls:tt}=this;if(!et||this.fragContextChanged(s))return;a.fragmentError=0,this.state=State.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const rt=s.stats;rt.parsing.start=rt.parsing.end=rt.buffering.start=rt.buffering.end=self.performance.now(),tt.trigger(Events.FRAG_LOADED,et),s.bitrateTest=!1})}_handleTransmuxComplete(s){var a;const et="main",{hls:tt}=this,{remuxResult:rt,chunkMeta:nt}=s,it=this.getCurrentContext(nt);if(!it){this.resetWhenMissingContext(nt);return}const{frag:st,part:ot,level:at}=it,{video:lt,text:ct,id3:ht,initSegment:ft}=rt,{details:dt}=at,pt=this.altAudio?void 0:rt.audio;if(this.fragContextChanged(st)){this.fragmentTracker.removeFragment(st);return}if(this.state=State.PARSING,ft){if(ft!=null&&ft.tracks){const yt=st.initSegment||st;this._bufferInitSegment(at,ft.tracks,yt,nt),tt.trigger(Events.FRAG_PARSING_INIT_SEGMENT,{frag:yt,id:et,tracks:ft.tracks})}const gt=ft.initPTS,mt=ft.timescale;isFiniteNumber(gt)&&(this.initPTS[st.cc]={baseTime:gt,timescale:mt},tt.trigger(Events.INIT_PTS_FOUND,{frag:st,id:et,initPTS:gt,timescale:mt}))}if(lt&&dt&&st.sn!=="initSegment"){const gt=dt.fragments[st.sn-1-dt.startSN],mt=st.sn===dt.startSN,yt=!gt||st.cc>gt.cc;if(rt.independent!==!1){const{startPTS:vt,endPTS:Et,startDTS:xt,endDTS:wt}=lt;if(ot)ot.elementaryStreams[lt.type]={startPTS:vt,endPTS:Et,startDTS:xt,endDTS:wt};else if(lt.firstKeyFrame&&lt.independent&&nt.id===1&&!yt&&(this.couldBacktrack=!0),lt.dropped&&lt.independent){const Rt=this.getMainFwdBufferInfo(),Ct=(Rt?Rt.end:this.getLoadPosition())+this.config.maxBufferHole,Ft=lt.firstKeyFramePTS?lt.firstKeyFramePTS:vt;if(!mt&&Ct<Ft-this.config.maxBufferHole&&!yt){this.backtrack(st);return}else yt&&(st.gap=!0);st.setElementaryStreamInfo(lt.type,st.start,Et,st.start,wt,!0)}else mt&&vt>MAX_START_GAP_JUMP&&(st.gap=!0);st.setElementaryStreamInfo(lt.type,vt,Et,xt,wt),this.backtrackFragment&&(this.backtrackFragment=st),this.bufferFragmentData(lt,st,ot,nt,mt||yt)}else if(mt||yt)st.gap=!0;else{this.backtrack(st);return}}if(pt){const{startPTS:gt,endPTS:mt,startDTS:yt,endDTS:vt}=pt;ot&&(ot.elementaryStreams[ElementaryStreamTypes.AUDIO]={startPTS:gt,endPTS:mt,startDTS:yt,endDTS:vt}),st.setElementaryStreamInfo(ElementaryStreamTypes.AUDIO,gt,mt,yt,vt),this.bufferFragmentData(pt,st,ot,nt)}if(dt&&ht!=null&&(a=ht.samples)!=null&&a.length){const gt={id:et,frag:st,details:dt,samples:ht.samples};tt.trigger(Events.FRAG_PARSING_METADATA,gt)}if(dt&&ct){const gt={id:et,frag:st,details:dt,samples:ct.samples};tt.trigger(Events.FRAG_PARSING_USERDATA,gt)}}_bufferInitSegment(s,a,et,tt){if(this.state!==State.PARSING)return;this.audioOnly=!!a.audio&&!a.video,this.altAudio&&!this.audioOnly&&delete a.audio;const{audio:rt,video:nt,audiovideo:it}=a;if(rt){let st=s.audioCodec;const ot=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){st&&(st.indexOf("mp4a.40.5")!==-1?st="mp4a.40.2":st="mp4a.40.5");const at=rt.metadata;at&&"channelCount"in at&&(at.channelCount||1)!==1&&ot.indexOf("firefox")===-1&&(st="mp4a.40.5")}st&&st.indexOf("mp4a.40.5")!==-1&&ot.indexOf("android")!==-1&&rt.container!=="audio/mpeg"&&(st="mp4a.40.2",this.log(`Android: force audio codec to ${st}`)),s.audioCodec&&s.audioCodec!==st&&this.log(`Swapping manifest audio codec "${s.audioCodec}" for "${st}"`),rt.levelCodec=st,rt.id="main",this.log(`Init audio buffer, container:${rt.container}, codecs[selected/level/parsed]=[${st||""}/${s.audioCodec||""}/${rt.codec}]`)}nt&&(nt.levelCodec=s.videoCodec,nt.id="main",this.log(`Init video buffer, container:${nt.container}, codecs[level/parsed]=[${s.videoCodec||""}/${nt.codec}]`)),it&&this.log(`Init audiovideo buffer, container:${it.container}, codecs[level/parsed]=[${s.codecs}/${it.codec}]`),this.hls.trigger(Events.BUFFER_CODECS,a),Object.keys(a).forEach(st=>{const at=a[st].initSegment;at!=null&&at.byteLength&&this.hls.trigger(Events.BUFFER_APPENDING,{type:st,data:at,frag:et,part:null,chunkMeta:tt,parent:et.type})}),this.tickImmediate()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,PlaylistLevelType.MAIN)}backtrack(s){this.couldBacktrack=!0,this.backtrackFragment=s,this.resetTransmuxer(),this.flushBufferGap(s),this.fragmentTracker.removeFragment(s),this.fragPrevious=null,this.nextLoadPosition=s.start,this.state=State.IDLE}checkFragmentChanged(){const s=this.media;let a=null;if(s&&s.readyState>1&&s.seeking===!1){const et=s.currentTime;if(BufferHelper.isBuffered(s,et)?a=this.getAppendedFrag(et):BufferHelper.isBuffered(s,et+.1)&&(a=this.getAppendedFrag(et+.1)),a){this.backtrackFragment=null;const tt=this.fragPlaying,rt=a.level;(!tt||a.sn!==tt.sn||tt.level!==rt)&&(this.fragPlaying=a,this.hls.trigger(Events.FRAG_CHANGED,{frag:a}),(!tt||tt.level!==rt)&&this.hls.trigger(Events.LEVEL_SWITCHED,{level:rt}))}}}get nextLevel(){const s=this.nextBufferedFrag;return s?s.level:-1}get currentFrag(){const s=this.media;return s?this.fragPlaying||this.getAppendedFrag(s.currentTime):null}get currentProgramDateTime(){const s=this.media;if(s){const a=s.currentTime,et=this.currentFrag;if(et&&isFiniteNumber(a)&&isFiniteNumber(et.programDateTime)){const tt=et.programDateTime+(a-et.start)*1e3;return new Date(tt)}}return null}get currentLevel(){const s=this.currentFrag;return s?s.level:-1}get nextBufferedFrag(){const s=this.currentFrag;return s?this.followingBufferedFrag(s):null}get forceStartLoad(){return this._forceStartLoad}}class Hls{static get version(){return"1.5.11"}static isMSESupported(){return isMSESupported()}static isSupported(){return isSupported()}static getMediaSource(){return getMediaSource()}static get Events(){return Events}static get ErrorTypes(){return ErrorTypes}static get ErrorDetails(){return ErrorDetails}static get DefaultConfig(){return Hls.defaultConfig?Hls.defaultConfig:hlsDefaultConfig}static set DefaultConfig(s){Hls.defaultConfig=s}constructor(s={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new EventEmitter,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,enableLogs(s.debug||!1,"Hls instance");const a=this.config=mergeConfig(Hls.DefaultConfig,s);this.userConfig=s,a.progressive&&enableStreamingMode(a);const{abrController:et,bufferController:tt,capLevelController:rt,errorController:nt,fpsController:it}=a,st=new nt(this),ot=this.abrController=new et(this),at=this.bufferController=new tt(this),lt=this.capLevelController=new rt(this),ct=new it(this),ht=new PlaylistLoader(this),ft=new ID3TrackController(this),dt=a.contentSteeringController,pt=dt?new dt(this):null,gt=this.levelController=new LevelController(this,pt),mt=new FragmentTracker(this),yt=new KeyLoader(this.config),vt=this.streamController=new StreamController(this,mt,yt);lt.setStreamController(vt),ct.setStreamController(vt);const Et=[ht,gt,vt];pt&&Et.splice(1,0,pt),this.networkControllers=Et;const xt=[ot,at,lt,ct,ft,mt];this.audioTrackController=this.createController(a.audioTrackController,Et);const wt=a.audioStreamController;wt&&Et.push(new wt(this,mt,yt)),this.subtitleTrackController=this.createController(a.subtitleTrackController,Et);const Rt=a.subtitleStreamController;Rt&&Et.push(new Rt(this,mt,yt)),this.createController(a.timelineController,xt),yt.emeController=this.emeController=this.createController(a.emeController,xt),this.cmcdController=this.createController(a.cmcdController,xt),this.latencyController=this.createController(LatencyController,xt),this.coreComponents=xt,Et.push(st);const Ct=st.onErrorOut;typeof Ct=="function"&&this.on(Events.ERROR,Ct,st)}createController(s,a){if(s){const et=new s(this);return a&&a.push(et),et}return null}on(s,a,et=this){this._emitter.on(s,a,et)}once(s,a,et=this){this._emitter.once(s,a,et)}removeAllListeners(s){this._emitter.removeAllListeners(s)}off(s,a,et=this,tt){this._emitter.off(s,a,et,tt)}listeners(s){return this._emitter.listeners(s)}emit(s,a,et){return this._emitter.emit(s,a,et)}trigger(s,a){if(this.config.debug)return this.emit(s,s,a);try{return this.emit(s,s,a)}catch(et){if(logger.error("An internal error happened while handling event "+s+'. Error message: "'+et.message+'". Here is a stacktrace:',et),!this.triggeringException){this.triggeringException=!0;const tt=s===Events.ERROR;this.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,fatal:tt,event:s,error:et}),this.triggeringException=!1}}return!1}listenerCount(s){return this._emitter.listenerCount(s)}destroy(){logger.log("destroy"),this.trigger(Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(a=>a.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(a=>a.destroy()),this.coreComponents.length=0;const s=this.config;s.xhrSetup=s.fetchSetup=void 0,this.userConfig=null}attachMedia(s){logger.log("attachMedia"),this._media=s,this.trigger(Events.MEDIA_ATTACHING,{media:s})}detachMedia(){logger.log("detachMedia"),this.trigger(Events.MEDIA_DETACHING,void 0),this._media=null}loadSource(s){this.stopLoad();const a=this.media,et=this.url,tt=this.url=urlToolkitExports.buildAbsoluteURL(self.location.href,s,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,logger.log(`loadSource:${tt}`),a&&et&&(et!==tt||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(a)),this.trigger(Events.MANIFEST_LOADING,{url:s})}startLoad(s=-1){logger.log(`startLoad(${s})`),this.started=!0,this.networkControllers.forEach(a=>{a.startLoad(s)})}stopLoad(){logger.log("stopLoad"),this.started=!1,this.networkControllers.forEach(s=>{s.stopLoad()})}resumeBuffering(){this.started&&this.networkControllers.forEach(s=>{"fragmentLoader"in s&&s.startLoad(-1)})}pauseBuffering(){this.networkControllers.forEach(s=>{"fragmentLoader"in s&&s.stopLoad()})}swapAudioCodec(){logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){logger.log("recoverMediaError");const s=this._media;this.detachMedia(),s&&this.attachMedia(s)}removeLevel(s){this.levelController.removeLevel(s)}get levels(){const s=this.levelController.levels;return s||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(s){logger.log(`set currentLevel:${s}`),this.levelController.manualLevel=s,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(s){logger.log(`set nextLevel:${s}`),this.levelController.manualLevel=s,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(s){logger.log(`set loadLevel:${s}`),this.levelController.manualLevel=s}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(s){this.levelController.nextLoadLevel=s}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(s){logger.log(`set firstLevel:${s}`),this.levelController.firstLevel=s}get startLevel(){const s=this.levelController.startLevel;return s===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:s}set startLevel(s){logger.log(`set startLevel:${s}`),s!==-1&&(s=Math.max(s,this.minAutoLevel)),this.levelController.startLevel=s}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(s){const a=!!s;a!==this.config.capLevelToPlayerSize&&(a?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=a)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:s}=this.abrController;return s?s.getEstimate():NaN}set bandwidthEstimate(s){this.abrController.resetEstimator(s)}get ttfbEstimate(){const{bwEstimator:s}=this.abrController;return s?s.getEstimateTTFB():NaN}set autoLevelCapping(s){this._autoLevelCapping!==s&&(logger.log(`set autoLevelCapping:${s}`),this._autoLevelCapping=s,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(s){isHdcpLevel(s)&&this._maxHdcpLevel!==s&&(this._maxHdcpLevel=s,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:s,config:{minAutoBitrate:a}}=this;if(!s)return 0;const et=s.length;for(let tt=0;tt<et;tt++)if(s[tt].maxBitrate>=a)return tt;return 0}get maxAutoLevel(){const{levels:s,autoLevelCapping:a,maxHdcpLevel:et}=this;let tt;if(a===-1&&s!=null&&s.length?tt=s.length-1:tt=a,et)for(let rt=tt;rt--;){const nt=s[rt].attrs["HDCP-LEVEL"];if(nt&&nt<=et)return rt}return tt}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(s){this.abrController.nextAutoLevel=s}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}setAudioOption(s){var a;return(a=this.audioTrackController)==null?void 0:a.setAudioOption(s)}setSubtitleOption(s){var a;return(a=this.subtitleTrackController)==null||a.setSubtitleOption(s),null}get allAudioTracks(){const s=this.audioTrackController;return s?s.allAudioTracks:[]}get audioTracks(){const s=this.audioTrackController;return s?s.audioTracks:[]}get audioTrack(){const s=this.audioTrackController;return s?s.audioTrack:-1}set audioTrack(s){const a=this.audioTrackController;a&&(a.audioTrack=s)}get allSubtitleTracks(){const s=this.subtitleTrackController;return s?s.allSubtitleTracks:[]}get subtitleTracks(){const s=this.subtitleTrackController;return s?s.subtitleTracks:[]}get subtitleTrack(){const s=this.subtitleTrackController;return s?s.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(s){const a=this.subtitleTrackController;a&&(a.subtitleTrack=s)}get subtitleDisplay(){const s=this.subtitleTrackController;return s?s.subtitleDisplay:!1}set subtitleDisplay(s){const a=this.subtitleTrackController;a&&(a.subtitleDisplay=s)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(s){this.config.lowLatencyMode=s}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}Hls.defaultConfig=void 0;const CONF={manifestLoadingMaxRetry:2,manifestLoadingTimeOut:5*1e3,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:60*1e3},DEFAULT_PLAYER_CONTROLS=["play-large","restart","rewind","play","fast-forward","progress","current-time","duration","mute","quality","volume","captions","settings","fullscreen"];class HLSStreamer extends EventEmitter$4{constructor(s){super(s),this.mime="application/x-mpegURL",this.hls=null,this.player=null}get[Symbol.toStringTag](){return"HLSStreaming"}static getInstance(){return new HLSStreamer}play(s,{videoRef:a}){const et="application/vnd.apple.mpegURL",tt=a.canPlayType(et);if(Hls.isSupported())log$d.warn(`Loading manifest: ${s}`),this.hls=new Hls(CONF),this.hls.loadSource(s),this.hls.on(Hls.Events.ERROR,(rt,nt)=>this.emitError(rt,nt)),this.hls.on(Hls.Events.LEVEL_SWITCHING,(rt,nt)=>log$d.info(`ABR: ${nt.height}p`)),this.hls.on(Hls.Events.MEDIA_ATTACHED,()=>log$d.info("Media attached")),this.hls.on(Hls.Events.MANIFEST_PARSED,(rt,nt)=>{log$d.info("m3u8 manifest loaded"),this.hls.attachMedia(a),this.setup(a,{})});else if(tt){const rt=document.createElement("source");rt.src=s,rt.type=et,a.append(rt),this.setup(a)}return this}quality(s){const a=s.levels.map(et=>et.height).reverse();return{quality:{forced:!0,default:a[0],options:a,onChange:et=>this.updateQuality(et)}}}subs(){return{}}emitError(s,a){if(a.fatal)switch(a.type){case Hls.ErrorTypes.MEDIA_ERROR:console.log("Fatal media error encountered, try to recover"),this.hls.recoverMediaError();break;case Hls.ErrorTypes.NETWORK_ERROR:default:this.stop(),this.emit("error",a);break}}setup(s,a={}){log$d.info("Setting up player");const et={settings:["captions","speed","quality"],controls:DEFAULT_PLAYER_CONTROLS,...a};this.player=new Plyr$1(s,et),this.player.on("error",tt=>this.emit("error",tt)),this.player.on("canplay",()=>{this.emit("ready")})}updateQuality(s){this.hls.levels.forEach((a,et)=>{a.height===s&&(log$d.info(`Found quality match with ${s}`),this.hls.currentLevel=et)})}stop(){this?.player?.stop(),this?.player?.destroy(),this?.hls?.destroy()}}class Player extends React.Component{constructor(s={canPlay:!1}){super(s),this.v=null,this.player=null,this.streamer=HLSStreamer.getInstance(),this.state={}}shouldComponentUpdate(s){return s.canPlay}static get propTypes(){return{movie:PropTypes.object.isRequired,canPlay:PropTypes.bool.isRequired}}async componentDidMount(){this.startStreaming()}_initPlaying=()=>{this.props.onCanPlay&&!this.props.canPlay&&this.props.onCanPlay()};_ready(){log$d.info("Player ready"),this._initPlaying()}startStreaming(){log$d.info("Streaming Movie: "+this.props.movie.title.toUpperCase());const s=`${gateway.parse(this.props.movie.video)}/index.m3u8`,a=this.streamer.play(s,{videoRef:this.v.video});a.on("error",this.onError),a.on("ready",()=>this._ready())}stopStreaming(){this.streamer.stop(),this.streamer.removeAllListeners()}componentDidCatch(s,a){log$d.error("Component Did Catch Error"),log$d.error(s),log$d.info(a)}componentWillUnmount(){log$d.warn("STREAMING STOPPED BY USER"),this.stopStreaming()}onError=s=>{this.props.onError&&this.props.onError(s),log$d.error(`Error while streaming ${JSON.stringify(s)}`),log$d.warn("Retrying..."),this.stopStreaming(),this.startStreaming()};getVideoRef=s=>{this.v=s};render(){return jsxRuntimeExports.jsxs("div",{className:this.props.canPlay&&"left relative full-height full-width"||"invisible",children:[this.props.onClose&&jsxRuntimeExports.jsx(ButtonClose,{onClose:this.props.onClose}),jsxRuntimeExports.jsx(PlayerVideo,{ref:this.getVideoRef})]})}}class PlayerHeader extends React.PureComponent{render(){return jsxRuntimeExports.jsxs("header",{className:"row absolute z-index-100 top-2-vh left-2-vw clearfix",children:[jsxRuntimeExports.jsx("div",{className:"row",children:jsxRuntimeExports.jsx("h4",{className:"white-text bold font-type-titles",children:this.props.title})}),jsxRuntimeExports.jsx("div",{children:this.props.children})]})}}class PlayerHLS extends React.PureComponent{constructor(s){super(s),this.state={canPlay:!1,state:"Connecting"}}static get propTypes(){return{movie:PropTypes.object.isRequired}}handleCanPlay=()=>{this.setState({canPlay:!0})};render(){return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[!this.state.canPlay&&jsxRuntimeExports.jsxs("div",{className:"absolute full-width full-height player-overlay-loader",children:[this.props.onClose&&jsxRuntimeExports.jsx(ButtonClose,{onClose:this.props.onClose}),jsxRuntimeExports.jsx(MainLoader,{content:"Loading movie..."})]}),jsxRuntimeExports.jsxs("section",{className:"absolute full-height full-width clearfix video-stream",children:[this.state.canPlay&&jsxRuntimeExports.jsx(PlayerHeader,{title:this.props.movie.title}),jsxRuntimeExports.jsx("div",{className:"full-height movie-box",children:jsxRuntimeExports.jsx(Player,{movie:this.props.movie,canPlay:this.state.canPlay,onCanPlay:this.handleCanPlay,onClose:this.props.onClose})})]})]})}}const MoviePlayer=o=>{const s=reactExports.useContext(Context),[a,et]=reactExports.useState(!1),[tt,rt]=reactExports.useState({});return reactExports.useEffect(()=>{(async()=>{const it=await s.db.connect(o.cid).get(o.id);rt(it),et(!0)})()},[o.id]),a&&jsxRuntimeExports.jsx(MoviePlayerContainer,{children:jsxRuntimeExports.jsx(MoviePlayerWrapper,{className:"background movie-details",children:jsxRuntimeExports.jsx(Grid,{sx:{zIndex:"99",height:"100%",background:"#000"},children:jsxRuntimeExports.jsx(PlayerHLS,{movie:{...tt.meta,video:tt.video},onClose:o.onClose})})})})||jsxRuntimeExports.jsx(MainLoader,{})},MoviePlayerContainer=styled(Box)(()=>({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",height:"100%",width:"100%",zIndex:"97",position:"absolute",top:"0",left:"0",backgroundColor:"#22232a",overflow:"hidden"})),MoviePlayerWrapper=styled(Box)(()=>({display:"flex",flexDirection:"column",height:"100%",width:"100%",zIndex:"10",position:"relative",overflow:"hidden",backgroundColor:"transparent","&::-webkit-scrollbar":{width:"0",background:"transparent "},"&::-webkit-scrollbar-thumb":{background:"transparent"}})),ChannelItem=o=>jsxRuntimeExports.jsxs(Box,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",sx:{cursor:"pointer"},children:[jsxRuntimeExports.jsx(ChannelItemWrapper$1,{onClick:o.onClick,selected:!!o.selected,"data-testid":"channel-item-wrapper",sx:{padding:o.borderWidth?`${o.borderWidth}px`:"5px",width:`${o.size??100}px`,height:`${o.size??100}px`},children:jsxRuntimeExports.jsx(ChannelItemContent,{display:"flex",alignItems:"center",justifyContent:"center","data-testid":"channel-item-content",sx:{borderWidth:o.borderWidth?`${o.borderWidth}px`:"5px",fontSize:`${o.innerLetterSize??40}px`},children:o.innerLetter[o.innerLetter.length-1]})}),o.label?jsxRuntimeExports.jsx(ChannelItemText,{fontSize:o.labelLetterSize,variant:"body1",children:o.label}):jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{})]}),ChannelItemWrapper$1=styled(Box)(o=>({backgroundColor:o.selected?"rgba(209,210,211,1)":"transparent",borderRadius:"13px",display:"flex",alignItems:"center",justifyContent:"center",color:"#212328",position:"relative","&:hover":{backgroundColor:"rgba(209,210,211,0.5)"},"&:hover .delete-channel":{opacity:1,transform:"translateX(0)"}})),ChannelItemContent=styled(Box)(()=>({backgroundColor:"#D1D2D3",borderRadius:"10px",border:"5px solid #1A1C20",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",textTransform:"uppercase",fontWeight:500}));styled(Box)(()=>({position:"absolute",bottom:"0",left:"-19px",backgroundColor:"#e50915",color:"#fff",borderTopRightRadius:"1rem",borderBottomRightRadius:"1rem",width:"11px",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",opacity:0,transform:"translateX(-12px)",transition:"opacity 0.3s ease, transform 0.3s ease",paddingRight:"2px","&:hover":{backgroundColor:"#ff1744"}}));const ChannelItemText=styled(Typography)(o=>({fontSize:o.fontSize,fontWeight:500,color:"#D1D2D3",textTransform:"uppercase",marginTop:"1rem",maxWidth:"100%"})),name="watchit",author="WatchItDev",version="1.0.0-beta.0",main="./out/main/index.js",description="Open movies everywhere",email="info@watchit.movie",license="LICENSE.md",type="module",repository={type:"git",url:"https://github.com/WatchItDev/watchit-app.git"},engines={node:">=18"},build={productName:"watchit",appId:"org.team.WatchIt",publish:[{provider:"github",owner:"WatchItDev",repo:"watchit-app",private:!1}],files:["!**/node_modules/*/{CHANGELOG.md,README.md,README,readme.md,readme}","!**/node_modules/*/{test,__tests__,tests,powered-test,example,examples}","!**/node_modules/*.d.ts","!**/node_modules/.bin","!**/*.{iml,o,hprof,orig,pyc,pyo,rbc,swp,csproj,sln,xproj}","!**/._*","!**/{.DS_Store,.git,.hg,.svn,CVS,RCS,SCCS,.gitignore,.gitattributes}","!**/{__pycache__,thumbs.db,.flowconfig,.idea,.vs,.nyc_output}","!**/{appveyor.yml,.travis.yml,circle.yml}","!**/{npm-debug.log,yarn.lock,.yarn-integrity,.yarn-metadata.json}","src/build/**/*","src/main/**/*","src/render/media/icons/*","package.json"],dmg:{contents:[{x:130,y:220},{x:410,y:220,type:"link",path:"/Applications"}]},win:{target:["nsis","msi"]},nsis:{deleteAppDataOnUninstall:!0,allowToChangeInstallationDirectory:!1,runAfterFinish:!0},linux:{target:["deb","AppImage","tar.gz"],category:"Video",maintainer:"WatchItDev",icon:"src/render/media/icons/icon.icns"},directories:{buildResources:"src/render/media/icons",output:"release"}},scripts={start:"cross-env LOG=* RUNTIME=electron WEBPACK_IS_DEV_SERVER=false NODE_ENV=development webpack --config webpack.config.babel.js --watch",build:"cross-env RUNTIME=electron NODE_ENV=production webpack","start:web":"cross-env RUNTIME=web WEBPACK_IS_DEV_SERVER=true NODE_ENV=development webpack serve --config webpack.config.babel.js","build:web":"cross-env RUNTIME=web NODE_ENV=production webpack",test:"jest --verbose --runInBand --detectOpenHandles --forceExit",lint:'standard "src/{main,render}/**/*.{js,jsx}"',format:"npm run lint -- --fix",electron:"NODE_ENV=development npx electron .",package:"npm run build && electron-builder build","package:mac":"npm run package -- --mac","package:linux":"npm run package -- --linux","package:win":"npm run package -- --win --x64 --ia32","publish:mac":"npm run package:mac -- --publish always","publish:linux":"npm run package:linux -- --publish always","publish:win":"npm run package:win -- --publish always"},overrides={react:"^18.2.0","react-dom":"^18.2.0"},dependencies={"@chainsafe/libp2p-gossipsub":"^13.0.0","@electron-toolkit/preload":"^3.0.0","@electron-toolkit/utils":"^3.0.0","@emotion/react":"^11.11.1","@emotion/styled":"^11.11.0","@helia/unixfs":"^3.0.6","@libp2p/pubsub-peer-discovery":"^10.0.2","@tabler/icons":"^2.28.0","electron-updater":"^6.1.7","fs-extra":"^9.0.1",helia:"^4.2.3","hls.js":"^1.5.11","it-all":"^1.0.6",jschardet:"^2.1.1","level-js":"6.1.0",leveldown:"^5.6.0",linvodb3:"^3.19.0","lottie-react":"^2.4.0",memfs:"^4.9.3",mime:"^2.4.6",plyr:"^3.7.8","plyr-react":"^5.3.0","react-custom-scrollbars":"^4.2.1","react-refresh":"^0.14.2","react-window":"^1.8.10","react-window-infinite-loader":"^1.0.9",shortid:"^2.2.15",subtitle:"^2.0.3",uint8arrays:"^3.0.0",winston:"^3.13.0"},devDependencies={"@esbuild-plugins/node-globals-polyfill":"^0.2.3","@esbuild-plugins/node-modules-polyfill":"^0.2.2","@mui/icons-material":"^5.15.20","@mui/material":"^5.15.20","@rollup/plugin-node-resolve":"^15.2.3","@types/react":"^18.2.66","@types/react-dom":"^18.2.22","@vitejs/plugin-react":"^4.2.1","@welldone-software/why-did-you-render":"^8.0.1",electron:"^29.1.4","electron-builder":"^24.13.3","electron-vite":"^2.2.0",eslint:"^8.57.0","eslint-plugin-react":"^7.34.1","eslint-plugin-react-hooks":"^4.6.0","eslint-plugin-react-refresh":"^0.4.6",events:"^3.3.0",jest:"^29.7.0","normalize.css":"^8.0.1",prompts:"2.4.0",react:"^18.2.0","react-dom":"^18.2.0","rollup-plugin-polyfill-node":"^0.13.0",sass:"^1.77.6","styled-components":"^5.3.0",vite:"^5.3.1","vite-plugin-handlebars":"^2.0.0","vite-plugin-node-polyfills":"^0.22.0"},browserslist=[">0.2%","not dead","not op_mini all","last 1 chrome version","last 1 firefox version","last 1 safari version"],setting={name,author,version,private:!0,main,description,email,license,type,repository,engines,build,scripts,overrides,dependencies,devDependencies,browserslist},FooterWrapper=qe.div`
  height: auto;
  width: 100%;
  position: absolute;
  display: flex;
  align-items: center;
  justify-content: flex-start;
  left: 0;
  bottom: 0;
  padding: 0.7rem 1rem;
`,Version=qe.div`
  color: #999;
  letter-spacing: 2px;
  font-size: 0.9rem;
  line-height: 1;
`,Footer=()=>jsxRuntimeExports.jsx(FooterWrapper,{children:jsxRuntimeExports.jsx(Version,{children:setting.version})}),Footer$1=React.memo(Footer),Wrapper=styled(Box)(()=>({display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:"100%",backgroundColor:"#212328",borderRadius:"1rem",boxShadow:24,padding:"0 1rem",margin:0,opacity:.8})),Collections=o=>{const s=a=>{o?.onButtonClick(a)};return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsx(CustomScrollbars,{autoHide:!0,autoHeight:!0,autoHeightMax:500,autoHideTimeout:1e3,autoHideDuration:200,thumbMinSize:20,universal:!0,children:jsxRuntimeExports.jsx(Box,{display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"center",children:settings.featuredCollections.map(a=>jsxRuntimeExports.jsx(Box,{display:"flex",alignItems:"center",justifyContent:"center",width:"33%",mb:4,children:jsxRuntimeExports.jsx(ChannelItem,{label:a.label,innerLetter:a.cid,onClick:()=>s(a.cid)})},a.cid))})})})},Blankslate=o=>{const[s,a]=reactExports.useState(""),et=()=>{s&&(o?.onButtonClick(s),a(""))};return jsxRuntimeExports.jsxs(Box,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",height:"calc(100% - 6rem)",children:[jsxRuntimeExports.jsx(Typography,{variant:"h4",color:"#eee",gutterBottom:!0,children:"New collection."}),jsxRuntimeExports.jsx(Typography,{variant:"body1",color:"#eee",gutterBottom:!0,children:"Find the collection CID in the creator's profile."}),jsxRuntimeExports.jsxs(Wrapper,{children:[jsxRuntimeExports.jsx(TextField,{fullWidth:!0,value:s,label:"Collection CID",onChange:tt=>a(tt.target.value),sx:{marginY:2,fieldset:{borderColor:"#eee !important"},"label,input":{color:"#eee !important"}}}),jsxRuntimeExports.jsx(CustomButton,{variant:"filled",onClick:et,width:"100%",padding:"8px 16px",children:"Connect"})]})]})},EmptyPage=o=>jsxRuntimeExports.jsxs(Box,{sx:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:[jsxRuntimeExports.jsxs(Box,{display:"flex",width:"100%",height:"100%",alignItems:"center",justifyContent:"center",sx:{maxWidth:"1200px"},children:[jsxRuntimeExports.jsx(Box,{display:"flex",flexDirection:"column",width:"40%",alignItems:"center",justifyContent:"center",children:jsxRuntimeExports.jsx(Collections,{onButtonClick:o.onButtonClick})}),jsxRuntimeExports.jsxs(Box,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",sx:{height:"50%",opacity:.4,overflow:"hidden"},children:[jsxRuntimeExports.jsx(Divider,{orientation:"vertical",sx:{height:"100%",mx:2,borderColor:"#eee"}}),jsxRuntimeExports.jsx(Typography,{variant:"body1",color:"#eee",gutterBottom:!0,children:"or"}),jsxRuntimeExports.jsx(Divider,{orientation:"vertical",sx:{height:"100%",mx:2,borderColor:"#eee"}})]}),jsxRuntimeExports.jsx(Box,{display:"flex",justifyContent:"center",alignItems:"center",width:"60%",children:jsxRuntimeExports.jsx(Blankslate,{onButtonClick:o.onButtonClick})})]}),jsxRuntimeExports.jsx(Footer$1,{})]}),EmptyBlankSlate=React.memo(EmptyPage),ChannelsMenu=o=>{const s=reactExports.useMemo(()=>({color:"#D1D2D3"}),[]);return jsxRuntimeExports.jsx(ChannelMenuWrapper,{open:o.isOpen,children:jsxRuntimeExports.jsx(ChannelItemWrapper,{children:jsxRuntimeExports.jsxs(Grid,{container:!0,justifyContent:"center",spacing:1,children:[o?.channels?.map?.((a,et)=>jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,children:jsxRuntimeExports.jsx(ChannelItem,{innerLetter:a,size:40,labelLetterSize:"0.5rem",innerLetterSize:15,selected:a===o.selected,borderWidth:2,onClick:()=>{o?.onChannelClick?.(a)}})},et)),jsxRuntimeExports.jsx(Grid,{alignItems:"start",item:!0,xs:12,children:jsxRuntimeExports.jsx(AddChannelWrapper,{children:jsxRuntimeExports.jsx(CustomButton,{margin:"5px",height:"40px",width:"40px",borderRadius:"10px !important",icon:jsxRuntimeExports.jsx(Add,{style:s}),variant:"flat",backgroundColor:"transparent",onClick:()=>{o?.onAddChannel?.()}})})})]})})})},ChannelMenuWrapper=styled(Box)(()=>({display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"start",height:"100%",width:"100%",backgroundColor:"#1A1C20"})),ChannelItemWrapper=styled(Box)(()=>({display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",rowGap:"5px",margin:"1rem 0.5rem"})),AddChannelWrapper=styled(Box)(()=>({display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer"})),Blocked="/assets/blocked-BtLhPF14.png",BlockedBlankslate=()=>jsxRuntimeExports.jsx(Blocker,{children:jsxRuntimeExports.jsxs(Box,{display:"flex",flexDirection:"column",width:"100%",height:"100%",alignItems:"center",justifyContent:"center",sx:{maxWidth:"350px"},children:[jsxRuntimeExports.jsx(Box,{display:"flex",alignItems:"center",mb:4,children:jsxRuntimeExports.jsx(Box,{component:"img",src:Blocked,alt:"blocked",width:"20rem"})}),jsxRuntimeExports.jsx(Typography,{variant:"h4",sx:{opacity:.7},children:"Our mobile app is currently in development."}),jsxRuntimeExports.jsx(Typography,{variant:"h5",sx:{mt:1,opacity:.5},children:"At this time, mobile web support is not available."})]})}),Blocker=styled(Box)(()=>({display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",width:"100%",backgroundColor:"#1A1C20",color:"#fff",textAlign:"center",padding:"1rem"})),OpenCollective="/assets/openCollective-gdOHaoB3.png";var define_import_meta_env_default={WATCHIT_DEFAULT_PDM_KEY:"bafkreiaenzlqmc34crc7sfsr3wanvbdwovsgfgggm2am7lafeejn6orghi",WATCHIT_DEFAULT_PDM_LABEL:"Public Domain",WATCHIT_PUBSUB_PEER_DISCOVERY:"watchit-pubsub-discovery",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const runtime=define_import_meta_env_default.WATCHIT_RUNTIME;function MovieIndex(){const o=reactExports.useContext(Context),[s,a]=reactExports.useState([]),[et,tt]=reactExports.useState(),[rt,nt]=reactExports.useState(),[it,st]=reactExports.useState(!0),[ot,at]=reactExports.useState(!0),[lt,ct]=reactExports.useState(!1),[ht,ft]=reactExports.useState(!1),dt=reactExports.useRef(null),pt=rt&&!et,gt=et&&rt&&!lt,mt=()=>o.db.connect("collections"),yt=zt=>{tt(zt)},vt=zt=>{tt(zt),ct(!0)},Et=()=>{tt(null)},xt=()=>{tt(null),ct(!1)},wt=()=>{at(!0)},Rt=async zt=>{nt(zt),at(!1)},Ct=reactExports.useCallback(async zt=>{const Nt={_id:zt};await mt().insert(Nt),log$d.info(`New collection stored: ${zt}`),a(Yt=>[...Yt,...Yt.includes(zt)?[]:[zt]]),nt(zt),at(!1)},[]),Ft=async zt=>{const Nt=s.filter(Kt=>Kt!=zt);await mt().delete({_id:zt}),a(Nt),nt(null),at(!0)};return reactExports.useEffect(()=>{(async()=>{const Pt=await mt().all();a(Pt.map(Dt=>Dt._id))})();const zt=navigator.userAgent.toLowerCase(),Nt=/mobile|android|iphone|ipad|tablet/i.test(zt),Kt=window.innerWidth<900;ft(Nt||Kt),st(!1);const Bt=()=>{ft(window.innerWidth<900)};return window.addEventListener("resize",Bt),()=>window.removeEventListener("resize",Bt)},[]),it?jsxRuntimeExports.jsx(MainLoader,{}):ht?jsxRuntimeExports.jsx(BlockedBlankslate,{}):jsxRuntimeExports.jsxs(MainContainer,{children:[jsxRuntimeExports.jsxs(ChannelsMenuWrapper,{children:[jsxRuntimeExports.jsx(Box,{className:"hide-on-desktop",sx:{marginTop:"1rem"},children:jsxRuntimeExports.jsx(Logo,{size:50})}),jsxRuntimeExports.jsx(ChannelsMenu,{channels:s,selected:rt,onAddChannel:wt,onChannelClick:Rt}),jsxRuntimeExports.jsx(Box,{sx:{marginTop:"auto",display:"flex",padding:"1rem",width:"100%",alignItems:"center",justifyContent:"center"},children:jsxRuntimeExports.jsx(OpenCollectiveLogo,{src:OpenCollective,alt:"OpenCollective",onClick:()=>window.open("https://opencollective.com/watchit","_blank")})})]}),jsxRuntimeExports.jsxs(MainContent,{ref:dt,sx:{borderTopLeftRadius:runtime==="browser"?"0":"1rem"},children:[ot?jsxRuntimeExports.jsx(EmptyBlankSlate,{onButtonClick:Ct}):jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{}),pt?jsxRuntimeExports.jsx(Catalog,{cid:rt,onClickMovie:yt,onPlayMovie:vt,onSignOut:Ft}):jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{}),gt?jsxRuntimeExports.jsx(Details,{id:et,onClose:Et,onPlay:vt,cid:rt}):jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{})]}),lt&&jsxRuntimeExports.jsx(MoviePlayer,{id:et,cid:rt,onClose:xt})]})}const MainContainer=styled(Box)(()=>({display:"flex",height:"100vh",width:"100%",backgroundColor:"#1A1C20",position:"relative"}));styled(Box)(()=>({justifyContent:"center",width:400,backgroundColor:"#212328",borderRadius:"1rem",boxShadow:24,padding:"1rem"}));const OpenCollectiveLogo=styled("img")(()=>({marginTop:"auto",width:"70%",opacity:.5,cursor:"pointer",transition:"opacity 0.3s, transform 0.3s","&:hover":{opacity:1,transform:"scale(1.2)"}})),ChannelsMenuWrapper=styled(Box)(()=>({display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",height:"100%",maxWidth:"80px",minWidth:"80px",top:0,left:0,zIndex:"10",backgroundColor:"#1A1C20"})),MainContent=styled(Box)(()=>({width:"calc(100% - 80px)",backgroundColor:"#212328",height:"100%",position:"relative",borderTopLeftRadius:"1rem",overflow:"hidden","&::-webkit-scrollbar":{width:"0",background:"transparent "}}));styled(Box)(()=>({width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:"#212328",padding:"0.5rem",borderTopLeftRadius:"1rem",borderBottom:"1px solid #444",marginBottom:"0.5rem",position:"relative",zIndex:10}));styled(Box)(()=>({position:"absolute",top:-55,width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}));const App=()=>jsxRuntimeExports.jsx(MovieIndex,{}),db=DBFactory(),broker=BrokerFactory(webIPC),webRenderer=broker.getIPC();await Bootstrap$1(webRenderer,{Helia,runtime:"web"});client.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(React.StrictMode,{children:jsxRuntimeExports.jsx(ContextProvider,{value:{broker,db},children:jsxRuntimeExports.jsx(App,{})})}));
